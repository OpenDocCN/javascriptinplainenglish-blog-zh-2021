<html>
<head>
<title>How to Create a React-Leaflet Control Component with Leaflet-Routing-Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用活页路由机器创建反应式活页控制组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-react-leaflet-control-component-with-leaflet-routing-machine-8eef98259f20?source=collection_archive---------2-----------------------#2021-06-06">https://javascript.plainenglish.io/how-to-create-a-react-leaflet-control-component-with-leaflet-routing-machine-8eef98259f20?source=collection_archive---------2-----------------------#2021-06-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3cbb3da0fd777c92b407e4a005c6ba34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Neu8_Icau6GpujBEMgy32A.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@hjkp?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">henry perks</a> on <a class="ae jz" href="https://unsplash.com/s/photos/maps?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c081" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://stackblitz.com/edit/react-leaflet-routing-machine-starter?file=src%2FMap.jsx" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="ky">跟随本沙盒一起上栈</em> </strong> </a></p><p id="f534" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/react-leaflet-v3-creating-a-mapping-application-d5477f19bdeb">使用React-Leaflet </a>时，有时我们会想在地图上添加我们自己的自定义控件。假设我们想向用户展示如何从A点到b点。<a class="ae jz" href="https://react-leaflet.js.org/" rel="noopener ugc nofollow" target="_blank">React-传单</a>没有开箱即用的路由功能，但我们可以使用<a class="ae jz" href="https://leafletjs.com/plugins.html" rel="noopener ugc nofollow" target="_blank">第三方插件</a>快速轻松地完成这项工作。<a class="ae jz" href="http://www.liedman.net/leaflet-routing-machine/" rel="noopener ugc nofollow" target="_blank">传单发送机</a>给了我们想要的功能，但是我们如何让这个普通的传单控制插件与我们的React-Leaflet应用程序一起工作呢？</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="2e80" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">使用React的useRef钩子</h1><p id="ae98" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">重要的是要记住，即使我们使用React，<a class="ae jz" href="https://react-leaflet.js.org/docs/start-introduction#dom-rendering" rel="noopener ugc nofollow" target="_blank"> Leaflet也将为我们的地图</a>处理DOM渲染。这意味着我们可以通过使用<a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank"> React的</a> <code class="fe mj mk ml mm b"><a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank">useRef</a></code> <a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useref" rel="noopener ugc nofollow" target="_blank">钩子</a>来访问我们的传单元素。</p><p id="9588" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们看一下MapContainer组件的<a class="ae jz" href="https://react-leaflet.js.org/docs/api-map#mapcontainer" rel="noopener ugc nofollow" target="_blank">文档，我们会看到它有一个<code class="fe mj mk ml mm b">whenCreated</code>属性:</a></p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/ef57a3eb2c419af9c182d43b10f19e41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pbdHuUXmtol_7UPOizacYA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Map Container Props list from the documentation</figcaption></figure><p id="e885" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我们访问地图实例的方式。这个<code class="fe mj mk ml mm b">whenCreated</code>道具是一个函数，它接收传单地图实例，并允许我们将地图实例设置为渲染后的状态。这样我们就可以访问它，这样我们就可以在实例中添加和删除层。这是我们在演示中设置的地图:</p><h2 id="dff9" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">Map.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="b5df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经将地图保存到了state，我们可以使用它来添加传单-路由-机器控制。为了实例化<a class="ae jz" href="http://www.liedman.net/leaflet-routing-machine/#getting-started" rel="noopener ugc nofollow" target="_blank">传单路由机器</a>，我们将需要调用<code class="fe mj mk ml mm b">L.Routing.control(&lt;<a class="ae jz" href="http://www.liedman.net/leaflet-routing-machine/api/#routingcontroloptions" rel="noopener ugc nofollow" target="_blank">RoutingControlOptions</a>&gt; options?)</code>，它接受一个<a class="ae jz" href="http://www.liedman.net/leaflet-routing-machine/api/#l-routing-control" rel="noopener ugc nofollow" target="_blank">选项对象</a>。出于我们的目的，我们将只使用<code class="fe mj mk ml mm b">position</code>、<code class="fe mj mk ml mm b">waypoints</code>和<code class="fe mj mk ml mm b">lineOptions</code>选项。我们将使用<a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank"> React的</a> <code class="fe mj mk ml mm b"><a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank">useEffect</a></code> <a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useeffect" rel="noopener ugc nofollow" target="_blank">钩子</a>来确保在我们尝试实例化我们的控件之前已经渲染了地图。一旦控件被实例化，我们可以用<code class="fe mj mk ml mm b">useRef</code>钩子将这个实例分配给一个React ref，并保存ref到状态以观察更新。然后，在一个单独的<code class="fe mj mk ml mm b">useEffect</code>函数中，我们将使用<code class="fe mj mk ml mm b">.addTo(map)</code>将控件实例添加到我们的地图中。</p><h2 id="53d1" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">Map.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="1e08" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在应该有两个路点，华盛顿DC和三藩市，由一条蓝线连接。在地图的左侧还应该有一个方框，标明A点和B点的往返方向。在下面的演示中尝试一些选项和方法！</p><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ng nf l"/></div></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h1 id="c48a" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">react-活页v3核心API</h1><p id="90a8" class="pw-post-body-paragraph ka kb in kc b kd me kf kg kh mf kj kk kl mg kn ko kp mh kr ks kt mi kv kw kx ig bi translated">第二种方法是使用React-Leaflet核心API创建一个定制的React组件。如果您不熟悉React-传单的这一部分，请查看此处的<a class="ae jz" href="https://react-leaflet.js.org/docs/core-introduction" rel="noopener ugc nofollow" target="_blank">介绍部分</a>。只要确保你已经安装了<code class="fe mj mk ml mm b">@react-leaflet/core</code>。如果我们看一下核心API文档的<a class="ae jz" href="https://react-leaflet.js.org/docs/core-api/#hook-factories" rel="noopener ugc nofollow" target="_blank">钩子工厂部分，我们会发现一堆React-Leaflet钩子，它们允许我们创建各种定制的React-Leaflet组件。在这里，我们将找到<code class="fe mj mk ml mm b"><a class="ae jz" href="https://react-leaflet.js.org/docs/core-api/#createcontrolhook" rel="noopener ugc nofollow" target="_blank">createControlHook</a></code> </a><a class="ae jz" href="https://react-leaflet.js.org/docs/core-api/#createcontrolhook" rel="noopener ugc nofollow" target="_blank">钩子</a>，它接受一个小叶控件的实例并返回一个小叶元素。</p><figure class="mo mp mq mr gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/c3bd2876075187488f0be8a18cf9158a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ixT14tGnma5Ua_CmDPmFqQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">createControlHook from the documentation</figcaption></figure><p id="4b9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们使用我在本文开头提供的<a class="ae jz" href="https://stackblitz.com/edit/react-leaflet-routing-machine-starter?file=src/Map.jsx" rel="noopener ugc nofollow" target="_blank">初学者沙箱</a>。在项目的src目录下创建一个名为<code class="fe mj mk ml mm b">RoutingControl.jsx</code>的新文件，并从传单、反应传单和传单路由机器中导入必要的项目。</p><h2 id="55b3" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">RoutingControl.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="83d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的导入下，我们将创建一个函数，它接收<code class="fe mj mk ml mm b">props</code>，实例化我们的路由控制，并返回该实例。它看起来非常类似于我们在前一个例子中为控件创建的ref。</p><h2 id="b2c5" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">RoutingControl.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6ef2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我们取这个函数，把它传递给<code class="fe mj mk ml mm b">createControlHook</code>，并把它赋给一个变量。最后，我们导出这个新的定制控件组件，将其导入到我们的<code class="fe mj mk ml mm b">Map.jsx</code>文件中，并将其放在<code class="fe mj mk ml mm b">MapContainer</code>中。</p><h2 id="03be" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">RoutingControl.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><h2 id="ba7a" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">Map.jsx</h2><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="a2be" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">仅此而已。虽然React-Leaflet核心API文档起初看起来有点吓人，但使用它可以使事情变得非常简单。现在，我们在React-fleet map中有了一个定制的全功能传单路由机器实例。<a class="ae jz" href="https://stackblitz.com/edit/react-leaflet-routing-machine-core-api?file=src/RoutingControl.jsx" rel="noopener ugc nofollow" target="_blank">用完成的代码</a>来看看这个真实的沙盒。</p><figure class="mo mp mq mr gt jo"><div class="bz fp l di"><div class="ng nf l"/></div></figure></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><p id="f1b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">React-Leaflet核心API提供了各种各样的钩子和函数，它们在几乎每个项目中都非常有用。一定要通读文档，看看哪个对你的地图有用！你也可以<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/creating-an-ellipse-in-react-leaflet-72e2c5beff03"> <strong class="kc io">看看这篇文章</strong> </a>如何使用leafle-Ellipse和React-leafle核心API创建一个自定义标记层组件。感谢阅读！</p></div><div class="ab cl kz la hr lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ig ih ii ij ik"><h2 id="ee25" class="ms lh in bd li mt mu dn lm mv mw dp lq kl mx my lu kp mz na ly kt nb nc mc nd bi translated">乔希·哈里斯报道:</h2><ul class=""><li id="ba0d" class="ni nj in kc b kd me kh mf kl nk kp nl kt nm kx nn no np nq bi translated"><a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/using-leaflet-js-in-a-react-project-6b23c30ed464">在React项目中使用fleet . js:构建一个地图应用</a></li><li id="c04b" class="ni nj in kc b kd nr kh ns kl nt kp nu kt nv kx nn no np nq bi translated"><a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/react-leaflet-v3-creating-a-mapping-application-d5477f19bdeb">React-传单v3:创建地图应用</a></li><li id="6b29" class="ni nj in kc b kd nr kh ns kl nt kp nu kt nv kx nn no np nq bi translated"><a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/creating-an-ellipse-in-react-leaflet-72e2c5beff03">如何在反应传单中创建椭圆</a></li><li id="2975" class="ni nj in kc b kd nr kh ns kl nt kp nu kt nv kx nn no np nq bi translated"><a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-datetime-filter-in-ag-grid-react-e2e1ba2fc80">如何在Ag-Grid/React中创建日期时间过滤器</a></li></ul><p id="48fb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="ky">plain English . io</em></a></p></div></div>    
</body>
</html>