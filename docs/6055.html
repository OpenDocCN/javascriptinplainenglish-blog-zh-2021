<html>
<head>
<title>How to Use Svelte and D3 to Create an Interactive Data Visualisation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Svelte和D3创建一个交互式数据可视化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-svelte-and-d3-to-create-an-interactive-data-visualisation-d52e848fd995?source=collection_archive---------3-----------------------#2021-12-28">https://javascript.plainenglish.io/how-to-use-svelte-and-d3-to-create-an-interactive-data-visualisation-d52e848fd995?source=collection_archive---------3-----------------------#2021-12-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="15e4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">分析婴儿名字:条形图+单词云</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2369f2204e256879df9811ad83233c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AjkF5-8yBdM6i7BYQPpHUA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image by author</figcaption></figure><p id="47b9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在过去的10年里，D3一直是在web上创建交互式数据可视化的头号工具。现在，Svelte在所有类型的web应用程序中越来越受欢迎，尤其是在在线数据可视化领域。</p><p id="be16" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">本文提供了一个例子，说明如何将Svelte和D3结合起来创建一个定制的数据可视化。数据是来自美国社保的<a class="ae lr" href="https://www.ssa.gov/oact/babynames/limits.html" rel="noopener ugc nofollow" target="_blank">婴儿名字数据</a>；可视化是一个带有单词云的条形图，在条形图上显示最受欢迎的名字。在上一篇文章中，我解释了如何“使用d3.js和100行JavaScript”创建这样的图表。</p><div class="ls lt gp gr lu lv"><a href="https://russelllim22.medium.com/bar-chart-with-word-cloud-filled-bars-695947f35874" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">带有单词云填充条的条形图</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">使用D3.js和仅仅100行JavaScript</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">russelllim22.medium.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj kp lv"/></div></div></a></div><p id="7097" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里，我使用Svelte来呈现SVG图表，并添加了一些交互性:一个下拉框，允许用户选择年份，然后立即用该年的婴儿姓名数据更新图表。</p><p id="a833" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个显示交互式图表的动画截图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mk"><img src="../Images/db747cf92b5f8eefe2e656646a4644c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WHz90wVvw1aKbpX8NKgmTg.gif"/></div></div></figure><p id="c06f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关键步骤是</p><ul class=""><li id="8aad" class="ml mm iq kx b ky kz lb lc le mn li mo lm mp lq mq mr ms mt bi translated">获取并准备数据</li><li id="b986" class="ml mm iq kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated">生成SVG条形图</li><li id="94cf" class="ml mm iq kx b ky mu lb mv le mw li mx lm my lq mq mr ms mt bi translated">生成单词云</li></ul></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="802c" class="ng nh iq bd ni nj nk nl nm nn no np nq jw nr jx ns jz nt ka nu kc nv kd nw nx bi translated">获取并准备数据</h1><p id="d1c1" class="pw-post-body-paragraph kv kw iq kx b ky ny jr la lb nz ju ld le oa lg lh li ob lk ll lm oc lo lp lq ij bi translated">我将fetch调用放在HTML <code class="fe od oe of og b">select</code>元素的<a class="ae lr" href="https://svelte.dev/tutorial/inline-handlers" rel="noopener ugc nofollow" target="_blank">事件处理程序</a>中，使用Svelte的<a class="ae lr" href="https://svelte.dev/tutorial/select-bindings" rel="noopener ugc nofollow" target="_blank">双向绑定</a>来立即更新<code class="fe od oe of og b">selectedYear</code>变量:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="2748" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">即使您以前从未使用过Svelte，但是熟悉HTML，您也可能已经对上面的代码有了大致的了解。</p><p id="c463" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第12到14行的<code class="fe od oe of og b">{#each}</code>代码块是使用循环编写HTML的简单语法。在这种情况下，它需要一个年份数组，并将每一年作为<code class="fe od oe of og b">select</code>下拉列表中的一个<code class="fe od oe of og b">option</code>。</p><p id="8bde" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">功能<code class="fe od oe of og b">showBars()</code>在同一个<code class="fe od oe of og b">.svelte</code>文件的<code class="fe od oe of og b">&lt;script&gt;</code>标签中定义。它使用D3(以与我的前一篇文章相似的方式)将数据准备为一个对象数组。每个条目包含一个<code class="fe od oe of og b">letter</code>，一个那年出生的婴儿的<code class="fe od oe of og b">count</code>，以及一个名为<code class="fe od oe of og b">words</code>的数组，其中包含单词cloud的所有必要数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/519e873b1229edb6b97fadca608d25c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTfrlGNeVV301O1YkDp3jg.png"/></div></div></figure></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="9cda" class="ng nh iq bd ni nj nk nl nm nn no np nq jw nr jx ns jz nt ka nu kc nv kd nw nx bi translated">生成SVG条形图</h1><p id="6df0" class="pw-post-body-paragraph kv kw iq kx b ky ny jr la lb nz ju ld le oa lg lh li ob lk ll lm oc lo lp lq ij bi translated">下面是将条形渲染为SVG矩形的简单代码。同样，如果你熟悉HTML和SVG，看起来应该很熟悉。</p><p id="23f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">第4行的<code class="fe od oe of og b">{#if}</code>语句是用于条件渲染的简单语法；只有当数据数组<code class="fe od oe of og b">letterCounts</code>不为空时，它才会尝试呈现条形。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="6305" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用D3标度设置矩形的尺寸。</p><p id="bcfc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">动画是用一个<a class="ae lr" href="https://svelte.dev/tutorial/in-and-out" rel="noopener ugc nofollow" target="_blank">纤细的过渡</a>完成的:</p><p id="9b4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe od oe of og b">in:fly=”{{ x: -1000, duration: 1000, delay: 1000*i}}</code></p><p id="37e1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这种情况下，我希望小节一个接一个地飞入，每个小节之间有1000毫秒。1000毫秒的异常长延迟的原因是，为每个条形生成单词云的函数需要一些时间来运行。每个云只有几百毫秒，所以我可以通过使用Svelte的<code class="fe od oe of og b">{#await}</code>语法在每个单词云准备好的时候渲染它来加快速度。但我认为每个条形之间的时间间隔一致看起来不错。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="52a8" class="ng nh iq bd ni nj nk nl nm nn no np nq jw nr jx ns jz nt ka nu kc nv kd nw nx bi translated">生成单词云</h1><p id="1e7f" class="pw-post-body-paragraph kv kw iq kx b ky ny jr la lb nz ju ld le oa lg lh li ob lk ll lm oc lo lp lq ij bi translated">我以1000毫秒的时间间隔对每个条形运行<code class="fe od oe of og b">d3-cloud</code>函数。该函数给出一个名为<code class="fe od oe of og b">words</code>的数组，其中包含每个婴儿名字的数据(字体大小、位置等。)需要生成单词云。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/8c81c1caa692cb5b4a48839a871edfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LI2JcDs3GQMnGYkfv-soQ.png"/></div></div></figure><p id="df37" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我没有使用D3将单词cloud附加到DOM，而是使用Svelte将单词作为SVG文本节点放置，如下所示。我遵循Amelia Wattenberger在本次峰会演讲中的建议，使用D3来帮助准备数据、计算比例和元素位置，然后让Svelte处理DOM的更新。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oh oi l"/></div></figure><p id="0bba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">苗条默认是反应性的。因为上面的标记使用了<code class="fe od oe of og b">letterCounts</code>变量，Svelte会观察这个变量，并检查当<code class="fe od oe of og b">letterCounts</code>变量改变时DOM是否需要更新。关于Svelte如何识别数组和对象的变化的更多细节，请参见<a class="ae lr" href="https://svelte.dev/tutorial/updating-arrays-and-objects" rel="noopener ugc nofollow" target="_blank">这里的</a>。</p><h1 id="4dc5" class="ng nh iq bd ni nj ok nl nm nn ol np nq jw om jx ns jz on ka nu kc oo kd nw nx bi translated">响应窗口大小调整</h1><p id="484e" class="pw-post-body-paragraph kv kw iq kx b ky ny jr la lb nz ju ld le oa lg lh li ob lk ll lm oc lo lp lq ij bi translated">Svelte的另一个便利特性是能够立即响应浏览器窗口宽度的变化。</p><p id="881b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><code class="fe od oe of og b">&lt;svelte:window bind:innerWidth={width}/&gt;</code></p><p id="4604" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">包含上述语句后，每当窗口宽度改变时(例如，如果移动用户旋转他们的设备)，任何包含<code class="fe od oe of og b">width</code>变量的HTML标记都将被重新呈现。</p></div><div class="ab cl mz na hu nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ij ik il im in"><h1 id="8daf" class="ng nh iq bd ni nj nk nl nm nn no np nq jw nr jx ns jz nt ka nu kc nv kd nw nx bi translated">数据可视化的优势</h1><p id="7132" class="pw-post-body-paragraph kv kw iq kx b ky ny jr la lb nz ju ld le oa lg lh li ob lk ll lm oc lo lp lq ij bi translated">这张图表的完整代码可以在<a class="ae lr" href="https://gist.github.com/russelllim22/00b621bd7bfbb2e18913de5d14a0c655" rel="noopener ugc nofollow" target="_blank">这里</a>找到。这是一个有大约160行代码的单个<code class="fe od oe of og b">.svelte</code>文件，包括JavaScript、HTML和一些基本的CSS。这是一个非常小的例子，显然可以不用svelet来构建，但我认为它仍然展示了svelet在数据可视化方面的一些优秀特性。</p><p id="2f3c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">“苗条”是由里奇·哈里斯创造的，当时他正在《纽约时报》从事数据可视化工作，目的是“搔自己的痒处”。10年前，Mike Bostock在相同的环境下创建了D3。两个令人难以置信的有影响力的开源软件的极好例子，它们开始于一个人的激情项目。</p><p id="69ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Svelte允许web开发人员用更少的代码完成更多的工作。更少的代码也意味着更少的错误和更容易的调试。</p><p id="5d25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Svelte的语法非常用户友好，在HTML、CSS和JavaScript的熟悉基础上增加了它的反应“魔力”。在HTML标记中包含HTML元素的条件逻辑使其易于理解，也便于新手学习。</p><p id="3353" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Svelte也是一个非常轻量级和高性能的框架，因为它将<code class="fe od oe of og b">.svelte</code>文件编译成纯HTML、CSS和JavaScript / Typescript。</p><p id="707c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，随着围绕Svelte的势头和生态系统的增长，从社区中找到组件库、插件、灵感和支持变得越来越容易。现在Svelte得到了Vercel的资金支持，这一势头无疑将继续增强。</p><p id="2f0d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我期待在接下来的一年里更深入地了解苗条身材！</p><div class="ls lt gp gr lu lv"><a href="https://medium.com/geekculture/animated-trigonometry-quiz-88958b0ac206" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">动画三角学测验</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">由身材苗条的初学者建造</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">medium.com</p></div></div><div class="me l"><div class="op l mg mh mi me mj kp lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://www.cantorsparadise.com/the-web-of-mathematics-a-data-visualisation-baa5d478d908" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">数学网络——数据可视化</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">调查数学研究中的联系</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">www.cantorsparadise.com</p></div></div><div class="me l"><div class="oq l mg mh mi me mj kp lv"/></div></div></a></div><div class="ls lt gp gr lu lv"><a href="https://russelllim22.medium.com/top-trending-videos-on-youtube-in-2021-d576fa1f4c34" rel="noopener follow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd ir gy z fp ma fr fs mb fu fw ip bi translated">2021年YouTube上的热门视频</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">按国家、月份和类别查看最受欢迎的YouTube视频。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">russelllim22.medium.com</p></div></div><div class="me l"><div class="or l mg mh mi me mj kp lv"/></div></div></a></div><p id="9c43" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="os">更多内容看</em> <a class="ae lr" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="os">说白了. io </em> </a> <em class="os">。报名参加我们的</em> <a class="ae lr" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="os">免费周报</em> </a> <em class="os">。在我们的</em> <a class="ae lr" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="os">社区</em> </a> <em class="os">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>