<html>
<head>
<title>Express.js as a Google Cloud Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Express.js作为谷歌云功能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/google-cloud-function-with-express-df6951521ded?source=collection_archive---------2-----------------------#2021-09-12">https://javascript.plainenglish.io/google-cloud-function-with-express-df6951521ded?source=collection_archive---------2-----------------------#2021-09-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8d8d9bbac97e4076d911b03fb9ed996c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HhhUxpVEBkzf6nlL"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@mitchel3uo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mitchell Luo</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="62cc" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">谷歌云功能是什么？</h1><p id="e2a9" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">如果我们按照定义来看，那么GCF(Google Cloud Function)就是一段简单且用途单一的代码，在被触发时绑定到一个事件。它在无服务器架构上工作，因此消除了服务器、部署、配置软件和打补丁的工作</p><h2 id="9220" class="lw kb in bd kc lx ly dn kg lz ma dp kk lj mb mc ko ln md me ks lr mf mg kw mh bi translated">用例</h2><ul class=""><li id="2369" class="mi mj in la b lb lc lf lg lj mk ln ml lr mm lv mn mo mp mq bi translated">当数据发生任何变化时触发客户端API的webhook</li><li id="e88b" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">物联网和移动系统上的读/写操作</li><li id="85a8" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">独立异步代码</li></ul><h1 id="9e8d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">开始</h1><p id="a98f" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">本文将只关注express与google cloud功能的连接。我在这篇文章里考虑了一个快递的基础知识。你可以在这里找到GitHub回购<a class="ae jz" href="https://github.com/Piyush-Use-Personal/gcf-with-express" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ae08" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">我们开始吧！</p><h2 id="e560" class="lw kb in bd kc lx ly dn kg lz ma dp kk lj mb mc ko ln md me ks lr mf mg kw mh bi translated">第一步。创建快速应用程序</h2><p id="5af3" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在这里，我们将创建一个简单的Express应用程序，具有最小的依赖性</p><p id="bec5" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">请遵循以下步骤</p><ul class=""><li id="8683" class="mi mj in la b lb mw lf mx lj nb ln nc lr nd lv mn mo mp mq bi translated"><code class="fe ne nf ng nh b">npm init -y</code></li><li id="573d" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated"><code class="fe ne nf ng nh b">yarn add express http-errors cookie-parser morgan cors helmet dotev</code></li><li id="9fcb" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">创建一个<code class="fe ne nf ng nh b">index.js</code>文件</li><li id="4a01" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">把这些代码放在一起，你可以从头开始从附加的存储库中获取</li><li id="2f58" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">运行<code class="fe ne nf ng nh b">yarn run dev</code></li></ul><p id="c749" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">一旦你的服务器开始运行，你就可以找到这条路线，一切都会好的</p><blockquote class="ni nj nk"><p id="be46" class="ky kz nl la b lb mw ld le lf mx lh li nm my ll lm nn mz lp lq no na lt lu lv ig bi translated">这里有一个问题，根据定义，函数是独立的代码片段，但是在express routes中是耦合的，所以让我们把它们隔离开来</p></blockquote><h2 id="e2b3" class="lw kb in bd kc lx ly dn kg lz ma dp kk lj mb mc ko ln md me ks lr mf mg kw mh bi translated">第二步。创建独立模块</h2><p id="41c1" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">让我们在名为index.js的文件中创建名为controller的新文件夹</p><p id="133b" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">出于本文的目的，我只是将一些原始项目放入其中:</p><figure class="nq nr ns nt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/c9c0965522e682a8d7e364d0764e739b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lr1OnXQYcwhReU2Xib340Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Some sample route</figcaption></figure><p id="6357" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">在主index.js中创建一个路由，并将控制器连接到它</p><p id="099d" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">对于我来说，我已经创建了一个名为<code class="fe ne nf ng nh b">/test</code>的路线来查看输出。</p><blockquote class="ni nj nk"><p id="2d8b" class="ky kz nl la b lb mw ld le lf mx lh li nm my ll lm nn mz lp lq no na lt lu lv ig bi translated">您可以根据需要为项目创建多达n条路线</p></blockquote><p id="8ca3" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">让我们从命令中直接调用每条路由，您可以使用一个新的dep来帮助您在本地运行名为<code class="fe ne nf ng nh b">functions-framework</code>的路由</p><ul class=""><li id="c36a" class="mi mj in la b lb mw lf mx lj nb ln nc lr nd lv mn mo mp mq bi translated">安装dep组件<code class="fe ne nf ng nh b">npm install @google-cloud/functions-framework</code></li><li id="6066" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">将index.js中的<code class="fe ne nf ng nh b">main</code>键更改为<code class="fe ne nf ng nh b">/controller/index.js</code>来运行您的函数</li><li id="2564" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">运行命令<code class="fe ne nf ng nh b">npx functions-framework someRoute</code></li><li id="cc34" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">这将使用您的运行功能打开端口8080</li></ul><p id="14e1" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">这将调用您的函数</p><p id="ad41" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">但是如果你想看到你所有的功能都在运行，那么你可以使用express power来实现它</p><h2 id="55d8" class="lw kb in bd kc lx ly dn kg lz ma dp kk lj mb mc ko ln md me ks lr mf mg kw mh bi translated">第三步。查看所有活动</h2><p id="14ce" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">要在一个命令中包含所有功能并通过route进行管理，您可以将express用作救星。首先，您需要再次将<code class="fe ne nf ng nh b">main</code>字段恢复为index.js，以确定express被托管在哪里</p><ul class=""><li id="5f71" class="mi mj in la b lb mw lf mx lj nb ln nc lr nd lv mn mo mp mq bi translated">让每个人都可以使用你的应用</li><li id="6842" class="mi mj in la b lb mr lf ms lj mt ln mu lr mv lv mn mo mp mq bi translated">像普通函数一样调用它</li></ul><h2 id="8473" class="lw kb in bd kc lx ly dn kg lz ma dp kk lj mb mc ko ln md me ks lr mf mg kw mh bi translated">第四步。试验</h2><p id="3e7d" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">你可以通过进入每条路线来测试应用程序，看看是否有效，对于示例回购，你可以使用<code class="fe ne nf ng nh b">/</code>和<code class="fe ne nf ng nh b">/test</code>路线</p><p id="4f28" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">您可以添加任意多的路由，并在您的主无服务器应用程序中调用</p><h1 id="8e2a" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">结论</h1><p id="3b96" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">希望这个小教程对用GCF设置express有帮助，你也可以在这里找到源代码<a class="ae jz" href="https://github.com/Piyush-Use-Personal/gcf-with-express" rel="noopener ugc nofollow" target="_blank">。如果你喜欢这个内容，请留下你的关注。</a></p><p id="56a5" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated">谢了。</p><p id="c37f" class="pw-post-body-paragraph ky kz in la b lb mw ld le lf mx lh li lj my ll lm ln mz lp lq lr na lt lu lv ig bi translated"><em class="nl">更多内容请看</em><a class="ae jz" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="la io"><em class="nl">plain English . io</em></strong></a></p></div></div>    
</body>
</html>