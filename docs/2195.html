<html>
<head>
<title>Continuously Deploy Static Pages with Github Actions &amp; gh-pages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Github动作和gh-pages持续部署静态页面</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/continuously-deploy-static-pages-with-github-actions-gh-pages-207e4a009d1c?source=collection_archive---------6-----------------------#2021-05-08">https://javascript.plainenglish.io/continuously-deploy-static-pages-with-github-actions-gh-pages-207e4a009d1c?source=collection_archive---------6-----------------------#2021-05-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/5a1f4c399c7643668354d4afc85c49bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*fGfCDsnfQi0GMQOHN_p-ig.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">A Static Page ( Darth Vader CSS from: <a class="ae jy" href="https://codepen.io/poziomq/pen/Lbyomj" rel="noopener ugc nofollow" target="_blank">https://codepen.io/poziomq/pen/Lbyomj</a>)</figcaption></figure><p id="c35e" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在这篇初学者友好、简短且实用的文章中，让我们看看如何使用Github操作，轻松地建立一个连续部署管道，以构建静态站点并将其部署到gh-pages。</p><h2 id="a7f8" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第一步。创建一个文件夹&amp;初始化package.json和git</h2><p id="bee6" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">我们可以使用<code class="fe lv lw lx ly b">mkdir</code>命令来创建我们的文件夹。它可能类似于以下内容:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="295a" class="kx ky iq ly b gy mh mi l mj mk">mkdir demo-static-deployment</span></pre><p id="1338" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在，我们将工作目录更改为新创建的目录。</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="ef11" class="kx ky iq ly b gy mh mi l mj mk">cd demo-static-deployment</span></pre><p id="f822" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">让我们为我们的目录初始化package.json和git。</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="a622" class="kx ky iq ly b gy mh mi l mj mk">yarn init -y</span><span id="66f5" class="kx ky iq ly b gy ml mi l mj mk">git init</span></pre><p id="31db" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在这篇文章中，我使用的是yarn package manager，但是如果你愿意，也可以使用npm。在这里没多大区别。</p><h2 id="7adb" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第二步。填充package.json文件</h2><p id="67da" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">对于这个演示，我使用Webpack来最小化HTML和CSS文件。这是一种矫枉过正的做法，因为在我们的演示页面中并没有大量使用javascript，但是我们使用的工具的主要任务是绑定javascript。</p><p id="feb2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如果你想做的只是缩小和破坏文件，请随意使用任务运行器，如<a class="ae jy" href="https://gruntjs.com/" rel="noopener ugc nofollow" target="_blank"> Grunt </a>或<a class="ae jy" href="https://gulpjs.com/" rel="noopener ugc nofollow" target="_blank"> Gulp </a>。您必须在package.json文件中相应地更改构建脚本。</p><p id="6465" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">在这个演示中，考虑到我使用的是Webpack，我在package.json中有以下配置:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="f486" class="kx ky iq ly b gy mh mi l mj mk">{<br/>  "name": "darth-vader-fanpage",<br/>  "version": "1.0.0",<br/>  "main": "index.js",<br/>  "license": "MIT",<br/>  "scripts": {<br/>    "build": "node_modules/.bin/webpack --config webpack.config.js"<br/>  },<br/>  "devDependencies": {<br/>    "copy-webpack-plugin": "^7.0.0",<br/>    "css-minimizer-webpack-plugin": "^1.2.0",<br/>    "html-minimizer-webpack-plugin": "^2.1.0",<br/>    "webpack": "^5.15.0",<br/>    "webpack-cli": "^4.3.1",<br/>    "webpack-dev-server": "^3.11.2"<br/>  }<br/>}</span></pre><h2 id="e798" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第三步。添加您的静态内容</h2><p id="0bf2" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">我们现在可以将HTML、CSS和JS文件添加到目录中。我为演示所做的是，我将它们放在一个名为<code class="fe lv lw lx ly b">src</code>的子目录中。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/08fa9b77a0c47c553e70cf23e155603d.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*Pk3eY_c-bjBQkxlg28LOLw.png"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">static content sub-directory</figcaption></figure><h2 id="b130" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第四步。创建Webpack配置文件</h2><p id="1a78" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">让我们在根目录下创建一个名为<code class="fe lv lw lx ly b">webpack.config.js</code>的文件，并用以下配置填充它:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="de45" class="kx ky iq ly b gy mh mi l mj mk">const CopyPlugin = require("copy-webpack-plugin");<br/>const HtmlMinimizerPlugin = require("html-minimizer-webpack-plugin");<br/>const CssMinimizerPlugin = require("css-minimizer-webpack-plugin");<br/>const TerserPlugin = require("terser-webpack-plugin");<br/><br/>module.exports = {<br/>  entry: "./src/index.js",<br/>  plugins: [<br/>    new CopyPlugin({<br/>      patterns: [<br/>        {<br/>          from: "./src/index.html",<br/>          to: `${__dirname}/dist/index.html`,<br/>        },<br/>        {<br/>          from: "./src/vader.css",<br/>          to: `${__dirname}/dist/vader.css`,<br/>        },<br/>      ],<br/>    }),<br/>  ],<br/>  optimization: {<br/>    minimize: true,<br/>    minimizer: [<br/>      new HtmlMinimizerPlugin(),<br/>      new CssMinimizerPlugin(),<br/>      new TerserPlugin(),<br/>    ],<br/>  },<br/>  output: {<br/>    path: `${__dirname}/dist`,<br/>    filename: "bundle.js",<br/>  },<br/>  mode: "production",<br/>  module: {},<br/>};</span></pre><p id="dc4c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">您可以随意使用任务运行器来代替这一步，还要确保根据您决定使用的工具来更改package.json中的构建脚本。</p><h2 id="b45c" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第五步。安装依赖项</h2><p id="e0de" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">为了在您的本地机器上工作，我们需要安装npm模块，这些模块在package.json文件中用作开发依赖项:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="bf4b" class="kx ky iq ly b gy mh mi l mj mk">yarn install</span></pre><h2 id="9113" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第六步。忽略node_modules和dist目录</h2><p id="c845" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">由于我们不想将我们的<code class="fe lv lw lx ly b">node_modules</code>和最终构建目录<code class="fe lv lw lx ly b">dist</code>(在我们的Webpack配置文件的输出部分中指定)添加到我们的git版本控制中，我们可以通过在我们的项目根目录中创建一个<code class="fe lv lw lx ly b">.gitignore</code>文件并用以下内容填充它来排除这两个子目录:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="446d" class="kx ky iq ly b gy mh mi l mj mk">node_modules<br/>dist</span></pre><h2 id="2381" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第七步。添加持续部署的YAML配置</h2><p id="f525" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">从项目的根文件夹中，创建以下子目录:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="fee6" class="kx ky iq ly b gy mh mi l mj mk">mkdir -p .github/workflows<br/>cd .github/workflows</span></pre><p id="9016" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">现在创建一个名为<code class="fe lv lw lx ly b">main.yml</code>的yml文件</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="d072" class="kx ky iq ly b gy mh mi l mj mk">touch main.yml</span></pre><p id="e7ef" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">将以下配置添加到<code class="fe lv lw lx ly b">main.yml</code>文件中:</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="e7b1" class="kx ky iq ly b gy mh mi l mj mk">name: Build and GH-Page Deploy<br/><br/>on:<br/>  push:<br/>    branches:<br/>      - main<br/><br/>jobs:<br/>  build:<br/>    runs-on: ubuntu-latest<br/><br/>    steps:<br/>      - name: Checkout<br/>        uses: actions/checkout@v2<br/>        with:<br/>          persist-credentials: false<br/><br/>      - name: Install<br/>        run: yarn install<br/><br/>      - name: Build<br/>        run: |<br/>          yarn autoclean<br/>          yarn build<br/><br/>      - name: Deploy to GH Page<br/>        uses: JamesIves/github-pages-deploy-action@4.1.1<br/>        with:<br/>          branch: gh-pages<br/>          folder: dist</span></pre><p id="323d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">基本上，这个配置告诉Github actions在每次成功推送到名为<code class="fe lv lw lx ly b">main</code>的分支时运行一个作业</p><p id="4783" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">该作业由4个任务组成，即，<em class="mn">检出</em>(从repo中克隆最新代码)、<em class="mn">安装</em>(依赖项安装)、<em class="mn">构建</em>(从Webpack中缩小文件)、<em class="mn">部署</em>(将构建操作的结果<code class="fe lv lw lx ly b">dist</code>文件夹的内容提交到名为<code class="fe lv lw lx ly b">gh-pages</code>的分支中)</p><h2 id="5c20" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第八步。将您的更改推送到远程</h2><p id="7265" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">现在，当我们将更改推送到主分支时，工作流操作将在第一次和后续推时自动触发。</p><pre class="lz ma mb mc gt md ly me mf aw mg bi"><span id="da17" class="kx ky iq ly b gy mh mi l mj mk">git push -u origin main</span></pre><h2 id="0ef5" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第九步。监测进度</h2><p id="6a6c" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">我们可以从存储库中的<code class="fe lv lw lx ly b">Actions</code>选项卡监控部署作业的进度:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/614116e5de3a94e3a6d8464e45a02de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ndiYa06rN32xaK7_ihnk4w.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Jobs run on previous pushes</figcaption></figure><p id="973d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们还可以单击单个作业并监控其任务进度:</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mt"><img src="../Images/719a54d8482d26fbea1edc3fe90f5b41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VKxjwfbUAxqF5Hb3VeQuzQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">build job</figcaption></figure><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mu"><img src="../Images/c0ebfd682945e122d056ee23abf99e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-JlFOsqRkVVYVkNxuy5Dw.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Task level status</figcaption></figure><h2 id="99bc" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">第十步。从存储库设置添加页面</h2><p id="4382" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">一旦上述工作成功，我们就可以进入回购中的<code class="fe lv lw lx ly b">settings</code>选项卡，并从侧边栏中选择<code class="fe lv lw lx ly b">pages</code>选项。在这里，我们可以将新创建的分支<code class="fe lv lw lx ly b">gh-pages</code>设置为我们的页面分支。</p><figure class="lz ma mb mc gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mv"><img src="../Images/4c537e08e5d571d0dd5260ad302860e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhUJN8VtTPgSDnJvX-EnAQ.png"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">set up gh-pages branch</figcaption></figure><p id="c705" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">这一步只需要在第一次完成，在连续的部署中我们不必担心这一点，除非我们需要更改域或页面分支。</p><h2 id="a98b" class="kx ky iq bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">结论</h2><p id="0e4b" class="pw-post-body-paragraph jz ka iq kb b kc lq ke kf kg lr ki kj kk ls km kn ko lt kq kr ks lu ku kv kw ij bi translated">因此，我们通过gh-pages和GitHub操作为静态内容建立了一个持续的部署管道。通过YAML配置，我们可以实现真正的创新。</p><p id="63f9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如果你有兴趣，你可以看看演示回购<a class="ae jy" href="https://github.com/Parthipan-Natkunam/github-actions-static-demo" rel="noopener ugc nofollow" target="_blank">这里</a>和部署页面<a class="ae jy" href="https://parthipan.co.in/github-actions-static-demo/" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="d325" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="mn">注:达斯维达CSS取自</em> <a class="ae jy" href="https://codepen.io/poziomq/pen/Lbyomj" rel="noopener ugc nofollow" target="_blank"> <em class="mn">本笔友链接</em> </a> <em class="mn">。填充的细节数据来自</em> <a class="ae jy" href="https://swapi.dev/" rel="noopener ugc nofollow" target="_blank"> <em class="mn"> SWAPI开源API </em> </a> <em class="mn">。(达斯维达端点:</em>https://swapi.dev/api/people/4/<em class="mn">)</em></p><p id="dafe" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">感谢您通读这篇文章，希望您觉得有用。</p><p id="e9d7" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><em class="mn">更多内容请看</em><a class="ae jy" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kb ir"><em class="mn">plain English . io</em></strong></a></p></div></div>    
</body>
</html>