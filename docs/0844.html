<html>
<head>
<title>Server-Side Development with Fastify — Server Options</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Fastify进行服务器端开发—服务器选项</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/server-side-development-with-fastify-server-options-166bad1fe4a9?source=collection_archive---------11-----------------------#2021-02-21">https://javascript.plainenglish.io/server-side-development-with-fastify-server-options-166bad1fe4a9?source=collection_archive---------11-----------------------#2021-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bd716bf38c06eac49864bacfa5013c04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JhmNf3cWdIxaDZKi"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@scienceinhd?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Science in HD</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fc9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fastify是一个用于开发后端web应用程序的小型节点框架。</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Fastify创建后端应用程序。</p><h1 id="0548" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">服务器选项</h1><p id="b577" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在需要<code class="fe me mf mg mh b">fastify</code>的时候设置一些选项。</p><p id="9d7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">http2</code>让我们使用HTTP/2来绑定套接字。</p><p id="5b3b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">https</code>让ys监听TLS连接。</p><p id="8f55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">connectionTimeout</code>让我们以毫秒为单位定义服务器超时。</p><p id="6d5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">keepAliveTimeout</code>让我们以毫秒为单位定义服务器保持活动超时。</p><p id="6629" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">ignoreTrailingSlash</code>使Fastify在匹配路线时忽略尾随斜线。</p><p id="f0f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b8ad" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')({<br/>  ignoreTrailingSlash: true<br/>})</span><span id="a5c7" class="mq lc iq mh b gy mv ms l mt mu">fastify.get('/foo/', function(req, reply) {<br/>  reply.send('foo')<br/>})</span><span id="d35c" class="mq lc iq mh b gy mv ms l mt mu">// registers both "/bar" and "/bar/"<br/>fastify.get('/bar', function(req, reply) {<br/>  reply.send('bar')<br/>})<br/>const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')<br/>  } catch (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="a0d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">/foo</code>和<code class="fe me mf mg mh b">/foo/</code>与<code class="fe me mf mg mh b">/foo/</code>路线相匹配。</p><p id="8398" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe me mf mg mh b">/bar</code>和<code class="fe me mf mg mh b">/bar/</code>与<code class="fe me mf mg mh b">/bar/</code>路线相匹配。</p><p id="0e7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">maxParamLength</code>设置路线参数的最大长度。任何超过长度的都不会被调用。</p><p id="3101" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">bodyLimit</code>设置最大请求体尺寸。</p><p id="be80" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">logger</code>让我们启用记录器。</p><p id="ce4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过编写以下代码将<code class="fe me mf mg mh b">pino</code>添加为自定义记录器:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e547" class="mq lc iq mh b gy mr ms l mt mu">const pino = require('pino')();</span><span id="940e" class="mq lc iq mh b gy mv ms l mt mu">const customLogger = {<br/>  info(o, ...n) { },<br/>  warn(o, ...n) { },<br/>  error(o, ...n) { },<br/>  fatal(o, ...n) { },<br/>  trace(o, ...n) { },<br/>  debug(o, ...n) { },<br/>  child() {<br/>    const child = Object.create(this);<br/>    child.pino = pino.child(...arguments);<br/>    return child;<br/>  },<br/>};</span><span id="6e7c" class="mq lc iq mh b gy mv ms l mt mu">const fastify = require('fastify')({<br/>  logger: customLogger<br/>})</span><span id="477f" class="mq lc iq mh b gy mv ms l mt mu">fastify.get('/foo/', function(req, reply) {<br/>  reply.send('foo')<br/>})</span><span id="74ab" class="mq lc iq mh b gy mv ms l mt mu">// registers both "/bar" and "/bar/"<br/>fastify.get('/bar', function(req, reply) {<br/>  reply.send('bar')<br/>})<br/>const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')<br/>  } catch (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="0ea4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">disableRequestLogging</code>让我们禁用请求日志记录。</p><p id="f111" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">serverFactory</code>让我们将一个定制的HTTP服务器传递给Fastify。</p><p id="1a6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="91e8" class="mq lc iq mh b gy mr ms l mt mu">const Fastify = require('fastify')<br/>const http = require('http')</span><span id="d130" class="mq lc iq mh b gy mv ms l mt mu">const serverFactory = (handler, opts) =&gt; {<br/>  const server = http.createServer((req, res) =&gt; {<br/>    handler(req, res)<br/>  })<br/>  return server<br/>}</span><span id="b282" class="mq lc iq mh b gy mv ms l mt mu">const fastify = Fastify({ serverFactory })</span><span id="1b06" class="mq lc iq mh b gy mv ms l mt mu">fastify.get('/', (req, reply) =&gt; {<br/>  reply.send({ hello: 'world' })<br/>})</span><span id="6426" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')<br/>  } catch (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="f876" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe me mf mg mh b">http</code>模块创建服务器。</p><p id="3583" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">caseSensitive</code>让我们设置是否以区分大小写的方式匹配路线。</p><p id="1ad7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6298" class="mq lc iq mh b gy mr ms l mt mu">const fastify = require('fastify')({<br/>  caseSensitive: false<br/>})</span><span id="7b75" class="mq lc iq mh b gy mv ms l mt mu">fastify.get('/user/:username', (request, reply) =&gt; {  <br/>  reply.send(request.params.username)<br/>})</span><span id="a151" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')<br/>  } catch (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="23e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后如果我们去<code class="fe me mf mg mh b">/USER/NODEJS</code>，我们看到<code class="fe me mf mg mh b">NODEJS</code>，因为<code class="fe me mf mg mh b">caseSensitive</code>是<code class="fe me mf mg mh b">false</code>。</p><p id="1cb1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">genReqId</code>选项让我们用自己的函数生成请求ID。</p><p id="a05d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3be3" class="mq lc iq mh b gy mr ms l mt mu">let i = 0<br/>const fastify = require('fastify')({<br/>  genReqId (req) { return i++ }<br/>})</span><span id="5097" class="mq lc iq mh b gy mv ms l mt mu">fastify.get('/', (request, reply) =&gt; {  <br/>  reply.send('hello world')<br/>})</span><span id="4ac9" class="mq lc iq mh b gy mv ms l mt mu">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')<br/>  } catch (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="5728" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建我们自己的函数来生成请求ID。</p><h1 id="4594" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e912" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Fastify服务器配置一些选项。</p><p id="18fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，在<a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir">plain English . io</strong></a>找到更多类似内容</p></div></div>    
</body>
</html>