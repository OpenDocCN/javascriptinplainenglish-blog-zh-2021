<html>
<head>
<title>Unit Testing of AWS Lambda Functions (Node.js) using Mocha and Chai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mocha和Chai对AWS Lambda函数(Node.js)进行单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unit-testing-of-aws-lambda-functions-node-js-using-mocha-and-chai-317353f8d60?source=collection_archive---------0-----------------------#2021-12-12">https://javascript.plainenglish.io/unit-testing-of-aws-lambda-functions-node-js-using-mocha-and-chai-317353f8d60?source=collection_archive---------0-----------------------#2021-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f44f0a1db5857ffb37ee8a024fe85541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*koBCYpFAbmoJBPzYPs6vqw.png"/></div></div></figure><p id="32e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单元测试是测试一段代码或模块并识别其中任何问题的过程。在单元测试中，我们用一些测试用例来测试一段代码/模块。在基于JavaScript的应用程序中，我们通常使用Mocha和Chai来编写测试用例。</p><p id="477f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们学习如何使用Mocha和Chai为AWS Lambda函数编写单元测试用例。</p><h2 id="cd3a" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">什么是AWS Lambda？</h2><blockquote class="lm ln lo"><p id="d3c1" class="jv jw lp jx b jy jz ka kb kc kd ke kf lq kh ki kj lr kl km kn ls kp kq kr ks ig bi translated">AWS Lambda是一种无服务器、事件驱动的计算服务，允许您为几乎任何类型的应用程序或后端服务运行代码，而无需配置或管理服务器。</p></blockquote><p id="94cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">AWS lambda函数的单元测试也很重要，因为它有助于我们发现lambda代码中的任何问题。在本文中，我们将学习更多关于lambda函数的单元测试。</p><p id="5bda" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们开始吧。</p><h2 id="3187" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">λ代码</h2><p id="8d51" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">让我们首先来看一个样例Lambda函数，它根据搜索输入和过滤器从数据库中获取搜索结果。该功能有两个输入— <code class="fe ly lz ma mb b"> searchText</code>和<code class="fe ly lz ma mb b">filterBy</code>T5。</p><ul class=""><li id="3d54" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated"><code class="fe ly lz ma mb b">searchText</code>将有我们要在数据库中搜索的文本</li><li id="e531" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated"><code class="fe ly lz ma mb b">filterBy</code>将具有我们希望对搜索结果进行排序所基于的字段名称。</li></ul><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Lambda function</figcaption></figure><h2 id="7fbf" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">lambda函数的单元测试</h2><p id="b243" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">现在让我们通过编写测试用例来测试上面的lambda代码。对于单元测试，我们将使用下面的包。</p><ul class=""><li id="1c9d" class="mc md in jx b jy jz kc kd kg me kk mf ko mg ks mh mi mj mk bi translated"><a class="ae na" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank">Mocha</a>——用于创建测试套件和运行测试用例。</li><li id="48e5" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated">Chai  -断言库，用于验证给定代码是否正确运行。</li><li id="bb73" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated"><a class="ae na" href="https://www.npmjs.com/package/proxyquire" rel="noopener ugc nofollow" target="_blank">proxy quire</a>——一个可以通过覆盖内部函数来代理依赖关系的包。</li><li id="ee6a" class="mc md in jx b jy ml kc mm kg mn kk mo ko mp ks mh mi mj mk bi translated"><a class="ae na" href="https://www.npmjs.com/package/lambda-tester" rel="noopener ugc nofollow" target="_blank"> Lambda Tester </a> —可以帮助在本地运行Lambda函数的包。</li></ul><p id="c6ac" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们深入研究一下。</p><h2 id="cd38" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">Lambda函数执行</h2><p id="7a96" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">为了测试lambda函数，我们需要一种从本地执行/调用lambda函数的方法。为此，我们可以使用名为<a class="ae na" href="https://www.npmjs.com/package/lambda-tester" rel="noopener ugc nofollow" target="_blank"> lambda-tester </a>的第三方软件包。Lambda-tester可以接受一个<code class="fe ly lz ma mb b">event</code>对象并执行Lambda函数来返回结果。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Test case with lambda invocation using lambda-tester</figcaption></figure><h2 id="9cf4" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">覆盖和模仿依赖关系</h2><p id="750a" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">现在我们知道了如何在本地调用/执行lambda函数。让我们学习如何模仿lambda函数内部的依赖关系。这些依赖项可以是任何第三方库或DB调用，甚至是API调用。为了覆盖和模仿这些依赖，我们可以使用<a class="ae na" href="https://www.npmjs.com/package/proxyquire" rel="noopener ugc nofollow" target="_blank"> proxyquire </a>包。</p><p id="2d3a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Proxyquire将帮助我们在不调用lambda函数的情况下导入它，并帮助我们模拟lambda函数内部使用的依赖关系。</p><p id="3153" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下面的例子中，我们有两个依赖项— <em class="lp"> utils </em>(实用函数)和<em class="lp"> dataService </em>(数据库函数)。我们将覆盖一个名为<em class="lp"> query </em>的数据库函数，并添加我们自己的逻辑来返回模拟结果。然而，我们不会覆盖实用函数文件(<em class="lp"> utils </em>)，因为它有独立的代码，没有任何第三方依赖。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Mocking dependencies using proxyquire</figcaption></figure><h2 id="2341" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">lambda函数的测试用例</h2><p id="36f3" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">既然我们已经学习了如何使用模拟依赖在本地调用lambda函数。现在让我们编写一个简单的测试用例。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Unit test case for the lambda function</figcaption></figure><p id="59b4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们使用命令<code class="fe ly lz ma mb b">mocha</code>运行测试用例，并检查它是否通过。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/1ad5db31805bb87ed74297ba3518ed24.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*PWcaoqXjcPxvWC56jn5fpw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Unit test results</figcaption></figure><p id="f1c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在<a class="ae na" href="https://github.com/SyedAfrozPasha/node-lambda-unit-test" rel="noopener ugc nofollow" target="_blank"> this </a> repo中找到本文讨论的所有代码。</p><p id="53e6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是我今天的全部内容。希望你喜欢。😉</p><p id="63db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">谢谢你的来访。如果你喜欢的内容，请支持我，并关注我更多这样的内容。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/SyedAfrozPasha"><div class="gh gi nc"><img src="../Images/c2f9098346d8af027a53983b34c16e21.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*KL5Ov4skms4ZEY32MY2wTQ.png"/></div></a></figure><p id="89d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<a class="ae na" href="https://www.linkedin.com/in/syedafrozpasha/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>、<a class="ae na" href="https://twitter.com/SyedAfroz_Pasha" rel="noopener ugc nofollow" target="_blank"> Twitter </a>和<a class="ae na" href="https://github.com/SyedAfrozPasha" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上与我联系。</p><p id="2f03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lp">更多内容看</em> <a class="ae na" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="lp">说白了就是</em> </strong> </a> <strong class="jx io"> <em class="lp">。</em> </strong> <em class="lp">报名参加我们的</em> <a class="ae na" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="lp">免费每周简讯这里</em> </strong> </a> <strong class="jx io"> <em class="lp">。</em> </strong></p></div></div>    
</body>
</html>