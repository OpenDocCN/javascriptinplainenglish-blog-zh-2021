<html>
<head>
<title>Multicasting with Zen Observables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有Zen可观测量的多播</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/multicasting-with-zen-observables-e428ac1eabf6?source=collection_archive---------10-----------------------#2021-01-22">https://javascript.plainenglish.io/multicasting-with-zen-observables-e428ac1eabf6?source=collection_archive---------10-----------------------#2021-01-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="ffbf" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">因为你太贱了，用不了RxJS</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/624e30d1f2d8b7d912849b04e31e3f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1A5PQy5B8XFx7den3vbrBg.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@feneek?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sergey Semin</a> on <a class="ae ks" href="https://unsplash.com/s/photos/observers?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ff53" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Zen Observables是RxJS的一个很好的轻量级替代品。如果您使用的是Apollo Client，那么您不会因为使用Zen而付出包大小的代价。不过，有一个问题是Zen不支持<a class="ae ks" href="https://www.learnrxjs.io/learn-rxjs/operators/multicasting/multicast" rel="noopener ugc nofollow" target="_blank">多播</a>。Github有一个<a class="ae ks" href="https://github.com/tc39/proposal-observable/issues/66" rel="noopener ugc nofollow" target="_blank">问题已经开放了好几年来解决这个问题。如果您正在寻找一种快速而简单的方法来为多播提供最少的支持，我在下面的TypeScript中准备了一个例子。</a></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="58ba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">值得注意的是，我们使用Ramda来<a class="ae ks" href="https://ramdajs.com/docs/#compose" rel="noopener ugc nofollow" target="_blank">组合</a>我们的<code class="fe lr ls lt lu b">register</code>和<code class="fe lr ls lt lu b">emit</code>函数。这允许我们在功能代码中利用单例。我们还返回了一个自定义的<code class="fe lr ls lt lu b">Subscription</code>，允许订阅者取消订阅事件流:</p><pre class="kd ke kf kg gt lv lu lw lx aw ly bi"><span id="d8c9" class="lz ma in lu b gy mb mc l md me">return {<br/>  closed: false,<br/>  unsubscribe() {<br/>    const index = subscriberMap.get(event.type).indexOf(onNext);<br/><br/>    this.closed = true;<br/>    // splice mutates the arra in<br/>    subscriberMap.get(event.type).splice(index, 1);<br/>  },<br/>};</span></pre><p id="ef3b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这保留了Zen Onsersable接口，其中subscribe调用返回一个<code class="fe lr ls lt lu b">Subscription</code>实例。</p><p id="ca58" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用一个<code class="fe lr ls lt lu b">subscriberMap</code>来提供过滤，这使得通知过程更加有效。<code class="fe lr ls lt lu b">interceptors</code>数组允许执行副作用，这确实有助于调试和进一步过滤。如果您不熟悉拦截器，请查看这篇<a class="ae ks" href="https://en.wikipedia.org/wiki/Interceptor_pattern" rel="noopener ugc nofollow" target="_blank">文章</a>。</p><p id="55b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们多播的主要用例是中央应用程序事件总线。滥用事件总线有很多弊端，所以请阅读<a class="ae ks" href="https://www.techyourchance.com/event-bus/" rel="noopener ugc nofollow" target="_blank">链接文章</a>。该实现允许解耦的应用程序组件订阅中央事件总线，并接收应该触发应用程序行为或向订阅者发送通知的通知。</p><p id="ae20" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要执行验证，请使用下面的测试。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="4581" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">编码快乐！</p></div></div>    
</body>
</html>