<html>
<head>
<title>How to Dynamically Load Scripts in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中动态加载脚本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-load-a-dynamic-script-in-react-2940d30998dd?source=collection_archive---------0-----------------------#2021-07-02">https://javascript.plainenglish.io/how-to-load-a-dynamic-script-in-react-2940d30998dd?source=collection_archive---------0-----------------------#2021-07-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8ce97721c5c4ddd11bc753b28097ea04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyvlyZTDn7SclGE5mJi7vA.jpeg"/></div></div></figure><p id="d98f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">向网站添加脚本是常见的要求。让我们假设网站正在使用一些外部工具。要正确使用它，您必须使用外部JavaScript。很简单的要求，是吧？</p><p id="d742" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以通过两种方式添加脚本——静态方式，只需添加脚本标签<strong class="jx io">index.html</strong>。</p><p id="f273" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是这种方式存在一些缺陷，例如:</p><ul class=""><li id="d866" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">它会增加网站的加载时间，从而影响网站的性能。</li><li id="7118" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">脚本将加载到根本不使用外部脚本的其他页面上。</li><li id="0846" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">您无法控制脚本何时/如何加载和执行。</li></ul><p id="2a60" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一种加载脚本的方式是<strong class="jx io">动态加载</strong>。</p><h1 id="5dc6" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">动态加载脚本的好处</h1><p id="95d7" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">一些好处是:</p><ul class=""><li id="5911" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">您可以在真正需要脚本页面上加载脚本</li><li id="31d2" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">这将减少页面初始加载时间</li><li id="6c58" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">在加载脚本之前，您可以有一个后备用户界面。它将改善用户体验。</li><li id="d997" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">简单干净的代码</li></ul></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><h1 id="cd6d" class="lh li in bd lj lk mr lm ln lo ms lq lr ls mt lu lv lw mu ly lz ma mv mc md me bi translated">使用钩子动态加载它</h1><p id="68c2" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">由于我们的网站在React中，我将使用<code class="fe mw mx my mz b">hooks</code>来动态加载脚本。</p><p id="8dde" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"><em class="na">useexternalscript . js:</em></strong></p><pre class="nb nc nd ne gt nf mz ng nh aw ni bi"><span id="4de0" class="nj li in mz b gy nk nl l nm nn">import { useEffect, useState } from "react";</span><span id="c035" class="nj li in mz b gy no nl l nm nn">export const useExternalScript = (url) =&gt; {<br/>  let [state, setState] = useState(url ? "loading" : "idle");<br/>  <br/>  useEffect(() =&gt; {<br/>    if (!url) {<br/>      setState("idle");<br/>      return;<br/>     }</span><span id="8eb9" class="nj li in mz b gy no nl l nm nn">    let script = document.querySelector(`script[src="${url}"]`);<br/>    <br/>    const handleScript = (e) =&gt; {<br/>      setState(e.type === "load" ? "ready" : "error");<br/>    };<br/>    <br/>    if (!script) {<br/>      script = document.createElement("script");<br/>      script.type = "application/javascript";<br/>      script.src = url;<br/>      script.async = true;<br/>      document.body.appendChild(script);<br/>      script.addEventListener("load", handleScript);<br/>      script.addEventListener("error", handleScript);<br/>    }<br/>   <br/>   script.addEventListener("load", handleScript);<br/>   script.addEventListener("error", handleScript);<br/>   <br/>   return () =&gt; {<br/>     script.removeEventListener("load", handleScript);<br/>     script.removeEventListener("error", handleScript);<br/>   };<br/>  }, [url]);<br/>  <br/>  return state;<br/>};</span></pre><p id="926e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面的代码块包含使用外部脚本所需的代码。首先，它将检查脚本标记是否已经存在。如果是，它将为事件<code class="fe mw mx my mz b">load</code>和<code class="fe mw mx my mz b">error</code>添加事件监听器</p><p id="f951" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果script标签不存在，它将创建一个script标签，设置它的<code class="fe mw mx my mz b">src</code>和其他属性，并将其附加到主体。还增加了<code class="fe mw mx my mz b">load</code>和<code class="fe mw mx my mz b">error</code>事件监听器。</p><p id="4550" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，你可以看到钩子外面是一个字符串<code class="fe mw mx my mz b">state</code>。有4种可能的输出，分别是<code class="fe mw mx my mz b">loading</code>、<code class="fe mw mx my mz b">idle</code>、<code class="fe mw mx my mz b">load</code>和<code class="fe mw mx my mz b">error</code>。</p><p id="88ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们的<code class="fe mw mx my mz b">useExternalScript</code>钩子准备好了。现在，让我们在组件中使用它。</p><h1 id="20ee" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated"><em class="np"> useExternalScript </em>钩子的用法</h1><p id="96dd" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">让我们假设组件:</p><p id="be8f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="na">演示:</em> </strong></p><pre class="nb nc nd ne gt nf mz ng nh aw ni bi"><span id="eb78" class="nj li in mz b gy nk nl l nm nn">import React from "react";<br/>import { useExternalScript } from "./hooks/useExternalScript";<br/>import { ComponentWithScript } from "./ComponentWithScript";</span><span id="62f5" class="nj li in mz b gy no nl l nm nn">export const Demo = () =&gt; {<br/>  const externalScript = "<em class="na">&lt;external-script-url&gt;</em>";<br/>  const state = useExternalScript(externalScript);<br/>  return (<br/>    &lt;div&gt;<br/>     {state === "loading" &amp;&amp; &lt;p&gt;Loading...&lt;/p&gt;}<br/>     {state === "ready" &amp;&amp; &lt;ComponentWithScript /&gt;}<br/>    &lt;/div&gt;<br/>  );<br/>};</span></pre><p id="803f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面的组件中，您可以看到相应的UI是基于状态值加载的。</p><p id="ebd9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是一个工作示例:</p><figure class="nb nc nd ne gt jo"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2ee4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！我希望您喜欢阅读这篇文章，并发现它很有用。请务必在评论中告诉我们你的想法。</p><p id="3255" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="na">更多内容请看</em><a class="ae ns" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="na">plain English . io</em></strong></a></p></div></div>    
</body>
</html>