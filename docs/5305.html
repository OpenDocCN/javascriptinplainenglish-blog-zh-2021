<html>
<head>
<title>Next.js 12 Performance Test: Builds Appear to be Slower, Not Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">js 12性能测试:构建似乎更慢，而不是更快</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/next-js-12-performance-test-builds-appear-to-be-slower-not-faster-9d3406362169?source=collection_archive---------6-----------------------#2021-11-01">https://javascript.plainenglish.io/next-js-12-performance-test-builds-appear-to-be-slower-not-faster-9d3406362169?source=collection_archive---------6-----------------------#2021-11-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7862bbaa0394b7c50f0ad81ea557f2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Me0foaEXIIJ_-r2z"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@dynamicwang?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dynamic Wang</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c931" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本周，Vercel <a class="ae jz" href="https://nextjs.org/blog/next-12" rel="noopener ugc nofollow" target="_blank">在<a class="ae jz" href="https://nextjs.org/conf" rel="noopener ugc nofollow" target="_blank"> Next.js conf </a>上宣布了Next.js 12 </a>的发布，让所有人感到惊讶，鉴于今年6月发布版本11以来的时间跨度相对较短。</p><p id="2abc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为一个框架，Next.js旨在为构建适合大多数(如果不是全部)用例的Jamstack应用程序提供一个完整的解决方案。这有点像编写一个React应用程序，而不必在SEO上妥协，下载几MB的JavaScript来加载任何页面等。请注意，这确实有它自己的警告。</p><p id="7a5d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为公告的一部分，Vercel推出了一系列令人兴奋的新功能。这些新特性包括一个用Rust编写的原生编译器(篡夺巴别塔！)、中间件支持、URL导入(像<a class="ae jz" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank"> Deno </a>！)，React 18和服务器组件API支持等等。</p><p id="745a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不想像很多人已经做的那样，去经历所有这些令人惊叹的新事物，而是想深入了解这次更新中影响最广泛的差异制造者:Rust编译器。使用Next.js构建的每个应用程序都会利用这一点，因此了解这将产生什么样的现实影响非常重要。</p><h1 id="87bb" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">感觉有点生疏</h1><p id="3f72" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">据报道，新的Rust编译器建立在“speedy web编译器”的基础上，这是一种基于Rust的JavaScript/TypeScript编译器，旨在提供本机级别的性能，将集成到web工具链中。最大的影响是取代Babel，这是最久经考验的transpilers之一，用于大多数现代web应用程序，当然是任何利用现代JS功能的应用程序，以便提供与尽可能多的浏览器的兼容性。随着更多本地代码驱动的工具链的建立，看看Babel项目将走向何方将会很有趣。</p><p id="a0da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是性能对比，来源于发布公告，在此处找到<a class="ae jz" href="https://nextjs.org/blog/next-12#faster-builds-and-fast-refresh-with-rust-compiler" rel="noopener ugc nofollow" target="_blank"/>:</p><figure class="mc md me mf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/149671d7a36213da73ef7846a5ecbefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FQZa1odmfY2Hw_OP"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">That’s <em class="mg">a lot faster</em>. But how much faster in practice?</figcaption></figure><p id="f837" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，这是一个发布公告，而不是一篇技术论文，所以我不打算批评那个数据演示。它看起来的确令人印象深刻，但缺乏内容和深度。这当然不是进行这种转换的真实世界里程的指标。我可以理解整个行业的工程经理对从像Babel这样成熟的东西转移到新的构建堆栈的疑虑，特别是如果他们没有更好地表明现实世界投资回报的深入数据(现在升级的风险回报更多)。</p><h1 id="123f" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">测试策略</h1><p id="e167" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我想为真实世界的用例提供一个合适的构建性能比较，以及一个“控制”，所以我选择了3个测试用例，在Next.js 11.1和Next.js 12之间进行测试:</p><ul class=""><li id="4f57" class="mh mi in kc b kd ke kh ki kl mj kp mk kt ml kx mm mn mo mp bi translated">一个全新的<code class="fe mq mr ms mt b">create-next-app</code>应用，有一个非常简单的主页(我们的控制)。</li><li id="aca7" class="mh mi in kc b kd mu kh mv kl mw kp mx kt my kx mm mn mo mp bi translated">一个静态网站使用SSG和ISR，以图像，博客帖子等为特色。(其实我的网站，<a class="ae jz" href="https://tpjnorton.com" rel="noopener ugc nofollow" target="_blank">tpjnorton.com</a>)。</li><li id="09e5" class="mh mi in kc b kd mu kh mv kl mw kp mx kt my kx mm mn mo mp bi translated">使用SSR、Next API routes等的复杂web应用程序。</li></ul><p id="55f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择这三个例子是为了提供一些常见用例的有意义的数字。</p><h2 id="9dd5" class="mz kz in bd la na nb dn le nc nd dp li kl ne nf lm kp ng nh lq kt ni nj lu nk bi translated">方法学</h2><p id="7546" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">很容易有意义地度量构建时间的改进，因为它们被很好地报道(刚刚脱离构建)并且容易重现。然而，获取用于快速更新的数据很难做到精确，以一种真正客观地传达改进的方式获得结果更难。因此，出于良好科学的目的，我将实际上只收集和报告构建数据。我还会澄清，所有这些应用程序都使用TypeScript。我在构建期间禁用了<code class="fe mq mr ms mt b">eslint</code>,以便更加关注实际的构建性能，并测量初始(没有<code class="fe mq mr ms mt b">.next</code>目录)和增量构建时间。哦，我用的是Windows 10。</p><p id="1454" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们走吧！</p><h2 id="79b1" class="mz kz in bd la na nb dn le nc nd dp li kl ne nf lm kp ng nh lq kt ni nj lu nk bi translated">案例1:入门应用</h2><p id="8fe1" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">首先，我们使用以下命令创建一个全新的next应用程序:</p><pre class="mc md me mf gt nl mt nm nn aw no bi"><span id="c114" class="mz kz in mt b gy np nq l nr ns">yarn create next-app --typescript</span></pre><p id="9df9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这让我们建立了一个非常基本的项目，使用Next 12。然后，我们可以通过做同样的事情并改变依赖关系来获得下一个11版本，以获得与Next.js 11相同的启动程序。</p><h2 id="2e63" class="mz kz in bd la na nb dn le nc nd dp li kl ne nf lm kp ng nh lq kt ni nj lu nk bi translated">案例2:静态网站</h2><p id="1b4f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">首先使用现有的Next.js 11.1应用程序执行测试，然后将站点升级到Next.js 12，并重新运行相同的初始和增量构建测试。</p><h2 id="c106" class="mz kz in bd la na nb dn le nc nd dp li kl ne nf lm kp ng nh lq kt ni nj lu nk bi translated">案例3:复杂的SSR应用程序</h2><p id="b190" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">对此，我采用了与静态网站相同的方法。首先使用Next.js 11测量初始和增量构建时间，然后在Next.js 12上再次测量。</p><h1 id="3305" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结果</h1><p id="8e3b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">哦，孩子，你不会喜欢这个的。</p><p id="0876" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一张显示我的结果的图表。栏目按照构建类型分组，每种颜色对应不同的用例(Google Sheet <a class="ae jz" href="https://docs.google.com/spreadsheets/d/1WcFkOcuOMAEzSnaVSjkIu4ypZaHu-JDYaRIuAioLfws/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里是</a>):</p><figure class="mc md me mf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/6ceaf97e540b033a467ee0cc9aa7309e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2oNphH76agFvSq4o"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">uh-oh…</figcaption></figure><p id="1234" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了starter应用程序之外，所有Next.js 12的版本都比Next 11慢<strong class="kc io"/>。我非常惊讶。对于初学者应用程序，我可以理解有一个较慢的构建过程，因为有很多非代码编译工作要做来完成<code class="fe mq mr ms mt b">next build</code>。然而，随着我们将静态应用程序全面转移到SSR应用程序，这也是转移到代码量越来越大的应用程序(静态应用程序是中小型的，而SSR应用程序是大型的)，相对而言，这种开销应该会减少，并且我们应该会看到<code class="fe mq mr ms mt b">swc</code>的一些健康的性能提升。</p><p id="eead" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">至少，这是我所期望的。</p><p id="51ae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我认为很难做出任何真正的猜测，为什么这可能是，充其量，这就是他们会为我，现在，猜测。我的直觉告诉我,<code class="fe mq mr ms mt b">swc </code>要快得多，但是新的工具链是如何被调用/使用的，这让我在实践中感觉迟钝。也许它还没有在视窗系统上测试过——很难确定。</p><h2 id="b604" class="mz kz in bd la na nb dn le nc nd dp li kl ne nf lm kp ng nh lq kt ni nj lu nk bi translated">糟糕的科学</h2><p id="37a5" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">澄清我的实验不是很严格是很重要的。我主要想得到一个大概的数字，知道构建会有多快，因为我对这个新版本的消息非常兴奋。像往常一样，软件项目(尤其是Next.js)不断发展，虽然重大变化会带来一些问题，但它们通常会很快得到解决。我还想澄清一下，我对这个也有个人偏见——我是Next.js的超级粉丝，并且已经在新的和移植的现有项目中使用过它，这种向本地工具链的转移虽然对我来说还没有结果，但却是网络世界中一个勇敢而强大的创新。所以我很想尽我所能让他们放松一下😄。</p><h1 id="4ee1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">包扎</h1><p id="224b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我认为很容易跳到像这样的新东西上，写一篇不完整的点击率文章来评论某样东西有多垃圾，因为“它对你不好”。这不是我想在这里做的。虽然我承认这些结果似乎有争议，但我觉得分享它们很重要，因为它给开发人员和经理们上了一堂有意义的课，教他们如何采用闪亮而令人兴奋的新技术——通常最好先等一会儿。</p><p id="c0a1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢你的阅读！</p><p id="9f54" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi">💙</p><p id="07a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nu">多内容于</em> <a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nu">中</em></strong></a></p></div></div>    
</body>
</html>