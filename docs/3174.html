<html>
<head>
<title>Read/Write Excel File in Node.js using XLSX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用XLSX在Node.js中读/写Excel文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/read-write-excel-file-in-node-js-using-xlsx-ab11881d00b4?source=collection_archive---------2-----------------------#2021-06-28">https://javascript.plainenglish.io/read-write-excel-file-in-node-js-using-xlsx-ab11881d00b4?source=collection_archive---------2-----------------------#2021-06-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8720e68233c0a374902000e725ab90b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyeycisFqDKzoweCCHyq-Q.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Source: Image by Esa Riutta from Pixabay</figcaption></figure><p id="8715" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">不管我们作为开发人员喜欢与否，Excel表格作为事实上的标准在商业世界中很受欢迎。有时，客户要求我们上传excel表格，所有的数据都应该存储在数据库中。XLSX就是解决这个问题的节点包。在这篇文章中，我们将使用busboy来处理表单数据。</p><h2 id="7f0e" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">这篇文章包含两个部分:</h2><ol class=""><li id="7668" class="lq lr in kb b kc ls kg lt kk lu ko lv ks lw kw lx ly lz ma bi translated">如何将excel表格解析成JSON格式？</li><li id="1942" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">如何使用JSON数据创建excel表格？</li></ol></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><p id="11ef" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤1:使用npm或bower安装XLSX包</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="2de1" class="kx ky in ms b gy mw mx l my mz">npm i --save xlsx <br/>//or<br/>bower install js-xlsx</span></pre><p id="a13d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤2:导入multer或busboy</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="35f9" class="kx ky in ms b gy mw mx l my mz">npm install --save multer</span></pre><p id="95a5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Multer是一个用于处理<strong class="kb io"> multipart/form-data </strong>的node.js中间件，主要用于上传文件。它写在<a class="ae na" href="https://github.com/mscdex/busboy" rel="noopener ugc nofollow" target="_blank">勤杂工</a>的顶部，以获得最大效率。</p><p id="acae" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Busboy是一个Node.js模块，用于解析传入的HTML表单数据。</p><p id="1d11" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤2:在index.js中导入XLSX</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="7015" class="kx ky in ms b gy mw mx l my mz">const XLSX = require('xlsx')</span></pre><h2 id="f637" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">解析Excel数据</h2><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="3b9f" class="kx ky in ms b gy mw mx l my mz">req.busboy.on('file', (fieldname, file, fname) =&gt; {<br/> if (fieldname === 'file') {<br/>  const buffers = []<br/>  file.on('data', (data) =&gt; {<br/>   buffers.push(data)<br/>  })<br/>  file.on('end', () =&gt; {<br/>   buffer = Buffer.concat(buffers)<br/>   workbook = XLSX.read(buffer, {<br/>    type: 'buffer',<br/>   })<br/>  })<br/> }<br/>})</span><span id="6772" class="kx ky in ms b gy nb mx l my mz">req.busboy.on('finish', () =&gt; {<br/> try {<br/>  const excelProducts =      XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {<br/>   raw: false,<br/>   header: 1,<br/>   dateNF: 'yyyy-mm-dd',<br/>   blankrows: false,<br/>  })<br/> } catch (err) {<br/>  console.log(err)<br/> }<br/>})<br/>req.pipe(req.busboy)</span></pre><ol class=""><li id="bed9" class="lq lr in kb b kc kd kg kh kk nc ko nd ks ne kw lx ly lz ma bi translated">使用缓冲区读取excel文件。我们使用busboy是因为这个文件是用户上传的。如果文件已经下载，可以使用XLSX.readFile(文件名:string，opts？:ParsingOptions)。</li><li id="ac7f" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">XLSX.utils.sheet_to_json()用于将工作表数据读入数组对象。传递其他选项以指定不同的参数，如使用原始值(true)或格式化字符串(false)，在输出中包含空行，默认日期格式，如果指定了标题，则第一行被视为数据行，否则第一行是标题行，而不被视为数据。</li></ol><p id="a2b6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe nf ng nh ms b">XLSX.utils</code>中的一些辅助功能生成不同的表单视图:</p><ul class=""><li id="88ee" class="lq lr in kb b kc kd kg kh kk nc ko nd ks ne kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_to_csv</code>生成CSV</li><li id="85be" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_to_txt</code>生成UTF16格式的文本</li><li id="9d04" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_to_html</code>生成HTML</li><li id="d42a" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_to_json</code>生成一个对象数组</li><li id="d79e" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_to_formulae</code>生成公式列表</li></ul><p id="4fdf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">创建Excel表</strong></p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="54b3" class="kx ky in ms b gy mw mx l my mz">data = [{<br/> firstName: 'John',<br/> lastName: 'Doe'<br/>}, {<br/> firstName: 'Smith',<br/> lastName: 'Peters'<br/>}, {<br/> firstName: 'Alice',<br/> lastName: 'Lee'<br/>}]</span><span id="d7b1" class="kx ky in ms b gy nb mx l my mz">const ws = XLSX.utils.json_to_sheet(data)<br/>const wb = XLSX.utils.book_new()<br/>XLSX.utils.book_append_sheet(wb, ws, 'Responses')<br/>XLSX.writeFile(wb, 'sampleData.export.xlsx')</span></pre><ol class=""><li id="de26" class="lq lr in kb b kc kd kg kh kk nc ko nd ks ne kw lx ly lz ma bi translated"><strong class="kb io"> json_to_sheet </strong>将JavaScript对象的数组转换成工作表。还有其他方法可以将数据转换成工作表，如aoa_to_sheet、table_to_sheet。sheet_add_json用于将一组JavaScript对象添加到现有的工作表中。</li><li id="2908" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated">在工作表中创建新的工作簿。</li><li id="752d" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated"><strong class="kb io"> book_append_sheet </strong>将工作表附加到名为“响应”的工作簿。</li><li id="4bd7" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw lx ly lz ma bi translated"><strong class="kb io"> XLSX.writeFile </strong> (wb，' sampleData.export.xlsx ')<strong class="kb io"/>试图将wb写入' sampledata . export . xlsx '。</li></ol><p id="6840" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您还可以指定每列的宽度&amp;也可以合并单元格。</p><p id="7ec8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一些帮助功能<code class="fe nf ng nh ms b">XLSX.utils</code>用于将不同的数据导入工作表:</p><ul class=""><li id="20f0" class="lq lr in kb b kc kd kg kh kk nc ko nd ks ne kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.aoa_to_sheet</code>将JavaScript数据数组转换为工作表。</li><li id="0c4f" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.json_to_sheet</code>将JavaScript对象数组转换为工作表。</li><li id="2b14" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.table_to_sheet</code>将DOM TABLE元素转换为工作表。</li><li id="8ead" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_add_aoa</code>将JavaScript数据数组的数组添加到工作表中。</li><li id="d789" class="lq lr in kb b kc mb kg mc kk md ko me ks mf kw ni ly lz ma bi translated"><code class="fe nf ng nh ms b">XLSX.utils.sheet_add_json</code>将JavaScript对象数组添加到工作表中。</li></ul></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><h2 id="53ab" class="kx ky in bd kz la lb dn lc ld le dp lf kk lg lh li ko lj lk ll ks lm ln lo lp bi translated">结论:</h2><p id="f127" class="pw-post-body-paragraph jz ka in kb b kc ls ke kf kg lt ki kj kk nj km kn ko nk kq kr ks nl ku kv kw ig bi translated">使用XLSX软件包，您可以读取任何excel文件，也可以创建一个excel文件。</p><p id="43aa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="nm">感谢阅读。</em> </strong></p><p id="bf5e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="nm">更多内容参见</em> <a class="ae na" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="nm">通俗易懂</em> </strong> </a></p></div></div>    
</body>
</html>