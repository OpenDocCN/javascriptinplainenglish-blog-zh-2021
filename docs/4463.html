<html>
<head>
<title>How to Reduce HTTP Calls From 15 Lines to 2 Lines Using React SWR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用React SWR将HTTP调用从15行减少到2行</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-reduce-http-calls-from-15-lines-to-2-lines-using-react-swr-50f59f086ed2?source=collection_archive---------3-----------------------#2021-09-06">https://javascript.plainenglish.io/how-to-reduce-http-calls-from-15-lines-to-2-lines-using-react-swr-50f59f086ed2?source=collection_archive---------3-----------------------#2021-09-06</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="b707" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">用更少的代码大幅改善用户体验。</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/803e0294e68ecaa2419eac306de56cdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQXJ4BkzMefPaCyyU3sCwg.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://www.pexels.com/@wendy-van-zyl-312082?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Wendy van Zyl</a> from <a class="ae kw" href="https://www.pexels.com/photo/brown-book-page-1112048/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="f452" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果您是React开发人员，您一定希望有一个库来管理所有的API调用。</p><p id="1b4a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我说的不是<code class="fe lt lu lv lw b">fetch</code>或者<code class="fe lt lu lv lw b">Axios</code>。而是一个管理所有加载状态、预取、缓存、分页、验证等的库。</p><p id="0acd" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我有好消息告诉你。今天我们将探索一个名为<a class="ae kw" href="https://swr.vercel.app/" rel="noopener ugc nofollow" target="_blank"> SWR </a>的包。其中承认自己为<code class="fe lt lu lv lw b">React Hooks for Data Fetching</code>。</p><p id="7a7b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们看看这个库能为我们做什么，以及我们什么时候可以使用它。</p><h1 id="ff44" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">步骤1:安装依赖项</h1><p id="3add" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">你可以通过输入来安装它</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="5064" class="my ly ir lw b gz mz na l nb nc">yarn add swr</span></pre><h1 id="eb50" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">步骤2:创建一个提取器函数</h1><p id="36c1" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">您可以使用各种fetcher函数，无论是REST还是GraphQL。</p><blockquote class="nd ne nf"><p id="4760" class="kx ky ng kz b la lb js lc ld le jv lf nh lh li lj ni ll lm ln nj lp lq lr ls ik bi translated">提取器函数可以只是本机提取函数的包装。如果你愿意，可以使用axios</p></blockquote><p id="da20" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">针对REST端点的带有<code class="fe lt lu lv lw b">fetch</code> API的典型提取器函数可以是</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="6f4c" class="my ly ir lw b gz mz na l nb nc"><strong class="lw is">const</strong> fetcher = (...args) =&gt; fetch(...args).then(res =&gt; res.json())</span></pre><p id="759d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">如果你想去T4，那就去吧</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="81a1" class="my ly ir lw b gz mz na l nb nc"><strong class="lw is">const</strong> fetcher = url =&gt; axios.get(url).then(res =&gt; res.data)</span></pre><h1 id="de14" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">第三步:使用SWR的时间</h1><p id="06bd" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">让我们在组件内部使用神奇的<code class="fe lt lu lv lw b">useSWR</code>钩子</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nk nl l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">normal use of useSWR hook</figcaption></figure><p id="5643" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这个<code class="fe lt lu lv lw b">useSWR</code>钩子接受两个参数。一个是键(在我们的例子中是<code class="fe lt lu lv lw b">/api/product/123</code>)，第二个是<code class="fe lt lu lv lw b">fetcher</code>函数。</p><p id="534d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这个钩子的作用是返回数据中的产品细节。但是现在你想知道它是如何有用的，因为我们可以通过直接在组件内部调用<code class="fe lt lu lv lw b">axios</code>或<code class="fe lt lu lv lw b">fetch</code>来做同样的事情。</p><p id="3fee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">好吧，让我给你看看。</p><h1 id="bc13" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">步骤4:如何减少代码？</h1><p id="eed9" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">在一个典型的应用程序中，我们通常像下面这样进行API调用。我们通常关心三件事。实际的<code class="fe lt lu lv lw b">data</code>、<code class="fe lt lu lv lw b">loading</code>状态，以及<code class="fe lt lu lv lw b">error</code>状态(如果有)。</p><h2 id="37bd" class="my ly ir bd lz nm nn dn md no np dp mh lg nq nr mj lk ns nt ml lo nu nv mn nw bi translated">以前</h2><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nk nl l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">manual data fetching</figcaption></figure><p id="3b94" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是在<code class="fe lt lu lv lw b">useSWR</code>钩子的帮助下，我们能做的就是</p><h2 id="d8cc" class="my ly ir bd lz nm nn dn md no np dp mh lg nq nr mj lk ns nt ml lo nu nv mn nw bi translated">在...之后</h2><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nk nl l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">power of swr</figcaption></figure><p id="f2ce" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">所以我们能够减少很多代码！这太好了！</p><h1 id="bf39" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">步骤5:全局错误处理</h1><p id="a166" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">如果您不够聪明，处理任何应用程序中的API错误都可能是一项痛苦的任务。SWR有一个非常好的功能，让你得到保障，减少更多的麻烦！</p><p id="2995" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">它导出一个名为<code class="fe lt lu lv lw b">SWRConfig</code>的上下文，该上下文可以对所有钩子进行全局控制。在下面的例子中，我们为所有的钩子定义了一个公共的获取函数，并且添加了全局错误处理程序。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nk nl l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">global handler with swr</figcaption></figure><p id="b39e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">所以现在你不必在使用<code class="fe lt lu lv lw b">useSWR</code>的任何地方处理错误。一旦你开始使用它，它就非常强大和方便。</p><h1 id="5355" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">第6步:预填充数据</h1><p id="7faa" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">如果你想通过提供一些默认数据使页面具有即时交互性，SWR也有这个选项。</p><p id="91e1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">当useSWR挂钩在后台获取数据并在数据加载完成后显示更新的数据时，您可以提供一些预先存在的数据(从缓存或其他地方)。</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="cb9d" class="my ly ir lw b gz mz na l nb nc">useSWR('/api/data', fetcher, { fallbackData: prefetchedData })</span></pre><p id="5d45" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这里我们将<code class="fe lt lu lv lw b">fallbackdata</code>属性定义为预先填充的数据。当您使用<code class="fe lt lu lv lw b">NextJS</code>并在<code class="fe lt lu lv lw b">getStaticProps</code>中生成一些数据时，这种技术特别有用。这样一切都变得超级快。</p><h1 id="94d7" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">第七步:突变</h1><p id="eb69" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">SWR的一个局限是它不直接支持突变。然而，我们可以通过使用一个名为<code class="fe lt lu lv lw b">mutate</code>的便利函数来实现类似的事情。</p><p id="e02c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">突变所做的是提供手动调用API的能力。例如当你想提交一个表格或什么的时候。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nk nl l"/></div></figure><p id="63ad" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这使得每个API调用都非常集中，有助于保持应用程序的整洁。</p><h1 id="b46f" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">你应该什么时候使用它？</h1><p id="7b3b" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">我已经展示了这个强大的库的基础。你可以用它走很长的路。还有更多类似缓存、变异等功能。它可以很好地覆盖95%的用例。</p><p id="ce94" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然而，<code class="fe lt lu lv lw b">SWR</code>的主要替代品是提供比SWR更多功能的<code class="fe lt lu lv lw b"><a class="ae kw" href="https://react-query.tanstack.com/" rel="noopener ugc nofollow" target="_blank">react-query</a></code>。</p><p id="d83a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我推荐使用<code class="fe lt lu lv lw b">react-query</code>,因为它涵盖了所有可能的场景。但是它有一个缺点。react-query的包大小几乎是SWR的3倍。这非常重要。</p><div class="kh ki kj kk gu ab cb"><figure class="nx kl ny nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/0436324b2b8b34e35750bbc3974f2bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9hiTnDQMXk0RetygkBfS-g.png"/></div></figure><figure class="nx kl ny nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><img src="../Images/7cd1390ad2e5e23fec5434f095a54798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*FoxQ5Wf8ZrjBWQaeSc4Ghw.png"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk od di oe of">SWR vs React Query Bundle size</figcaption></figure></div><p id="e6a7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">所以如果你正在构建一个小的应用程序，并且不需要很多复杂的特性，那么你应该选择SWR。对于其他场景，我建议使用react-query。</p><p id="f2f3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天到此为止。祝您愉快！</p><p id="0962" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">通过</strong> <a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> LinkedIn </strong> </a>联系我</p><div class="og oh gq gs oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="/45-npm-packages-to-solve-16-react-problems-a9ab18946224"><div class="ok ab fp"><div class="ol ab om cl cj on"><h2 class="bd is gz z fq oo fs ft op fv fx iq bi translated">45个NPM软件包解决16个React问题</h2><div class="oq l"><h3 class="bd b gz z fq oo fs ft op fv fx dk translated">关于如何选择完美的npm包的深入指导</h3></div><div class="or l"><p class="bd b dl z fq oo fs ft op fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kq oj"/></div></div></a></div><div class="og oh gq gs oi oj"><a rel="noopener  ugc nofollow" target="_blank" href="/the-greatest-react-developer-i-ever-met-1e58df22bb71"><div class="ok ab fp"><div class="ol ab om cl cj on"><h2 class="bd is gz z fq oo fs ft op fv fx iq bi translated">我见过的最伟大的React开发者</h2><div class="oq l"><h3 class="bd b gz z fq oo fs ft op fv fx dk translated">我们有分歧，但仍然…</h3></div><div class="or l"><p class="bd b dl z fq oo fs ft op fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="os l"><div class="oy l ou ov ow os ox kq oj"/></div></div></a></div><p id="2227" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><em class="ng">更多内容请看</em><a class="ae kw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is"><em class="ng">plain English . io</em></strong></a></p></div></div>    
</body>
</html>