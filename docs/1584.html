<html>
<head>
<title>Create a Debounced Ref in Vue 3 using Composition API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用合成API在Vue 3中创建一个去抖Ref</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-debounced-ref-in-vue-3-using-composition-api-c464cc39c82a?source=collection_archive---------7-----------------------#2021-04-05">https://javascript.plainenglish.io/how-to-create-a-debounced-ref-in-vue-3-using-composition-api-c464cc39c82a?source=collection_archive---------7-----------------------#2021-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f8d7a0ea9e64c2ddf375a8db1bd76a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7GXbX6VrbgVN73i6i0HNqw.png"/></div></div></figure><p id="cc5f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">本文最初发表在<a class="ae kw" href="https://theroadtoenterprise.com/blog/how-to-create-a-debounced-ref-in-vue-3-using-composition-api" rel="noopener ugc nofollow" target="_blank">通往<em class="kx">之路</em>企业</a>博客上。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><p id="c10e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着组合API的引入，我们得到了一种新的编写反应式逻辑的方式，即<em class="kx"> ref </em>和<em class="kx"> reactive </em>方法。在本文中，我想向您展示如何创建一个去抖ref，它只在指定的延迟后更新其值。例如，如果您有一个带有自动完成功能的输入字段，其中在搜索查询状态改变后发出一个API请求，那么公开的ref可能非常有用。</p><figure class="lg lh li lj gt jr gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/cc9330d04cc9cc7f6e8479ade830a977.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/1*1cGqeGFicIknbAOijiaqKg.gif"/></div></figure><p id="e7b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">去抖动是一个很好的优化模式，如果没有它，每次击键后都会发出一个API请求。攻击服务器不是最佳选择，所以让我们开始吧。</p><h1 id="2473" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">项目设置</h1><p id="9d7f" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">为了展示这个例子，我用<a class="ae kw" href="https://vitejs.dev" rel="noopener ugc nofollow" target="_blank"> Vite </a>创建了一个新项目。如果你想继续，你可以通过运行<em class="kx">yarn create @ vite js/app de bounce-ref-template vue</em>或<em class="kx">NPM init @ vite js/app de bounce-ref-template vue</em>来创建一个。你也可以在<a class="ae kw" href="https://github.com/ThomasFindlay/debounced-ref" rel="noopener ugc nofollow" target="_blank">这个GitHub repo </a>中找到完整的代码示例。</p><h2 id="ee2a" class="mn ll iq bd lm mo mp dn lq mq mr dp lu kj ms mt ly kn mu mv mc kr mw mx mg my bi translated">App.vue</h2><p id="59ee" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">正如我在开始时提到的，当用户在输入字段中输入搜索标准时，去抖ref可以用来延迟API请求。下面你可以看到它的设置。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="2d4b" class="mn ll iq na b gy ne nf l ng nh">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;label :class="$style.label"&gt;Search query&lt;/label&gt;<br/>    &lt;input :class="$style.input" v-model="query" type="text" /&gt;<br/>    &lt;div&gt;Value: {{ query }}&lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import { watch } from 'vue'<br/>import useDebouncedRef from './composables/useDebouncedRef'<br/>export default {<br/>  setup() {<br/>    const query = useDebouncedRef('', 400)<br/><br/>    watch(query, newQuery =&gt; {<br/>      console.log({ newQuery })<br/>      // init an API request<br/>    })<br/><br/>    return {<br/>      query,<br/>    }<br/>  },<br/>}<br/>&lt;/script&gt;<br/><br/>&lt;style module&gt;<br/>.label {<br/>  display: block;<br/>}<br/><br/>.input {<br/>  margin-top: 5px;<br/>  margin-bottom: 20px;<br/>}<br/>&lt;/style&gt;</span></pre><p id="b6c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在模板中，我们有一个<em class="kx">标签</em>、<em class="kx">输入</em>和包含<em class="kx">查询</em>值的<em class="kx"> div </em>。当我们完成时，您将看到值只是在一段延迟之后才更新。在<em class="kx"> setup </em>方法中，我们使用<em class="kx"> useDebouncedRef </em>函数创建一个去抖ref，并传递一个空字符串作为初始值以及400，即去抖延迟。我们将在稍后创建它。除此之外，我们还有一个观察器来观察查询引用。在那里你可以初始化一个函数来执行一个API请求。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><figure class="lg lh li lj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/b4544c664cc1aeb365b81d03d71fabd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFllclopsV5wVRBODsI6DA.png"/></div></div></figure><p id="96ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://theroadtoenterprise.com/?utm_source=medium&amp;utm_medium=post&amp;utm_campaign=easter" rel="noopener ugc nofollow" target="_blank">《Vue——企业之路》</a>现已七折发售。立即购买，获取奖励视频，内容包括:</p><p id="47be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">-组合API简介<br/> -复合组件模式<br/> -如何使用现代JavaScript特性编写更简洁的代码</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h2 id="fcc9" class="mn ll iq bd lm mo mp dn lq mq mr dp lu kj ms mt ly kn mu mv mc kr mw mx mg my bi translated">useDebouncedRef.js</h2><p id="8a05" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">下面是<em class="kx">useDebouncedRef</em>composable的实现。</p><pre class="lg lh li lj gt mz na nb nc aw nd bi"><span id="e635" class="mn ll iq na b gy ne nf l ng nh">import { ref, customRef } from 'vue'<br/><br/>const debounce = (fn, delay = 0, immediate = false) =&gt; {<br/>  let timeout<br/>  return (...args) =&gt; {<br/>    if (immediate &amp;&amp; !timeout) fn(...args)<br/>    clearTimeout(timeout)<br/><br/>    timeout = setTimeout(() =&gt; {<br/>      fn(...args)<br/>    }, delay)<br/>  }<br/>}<br/><br/>const useDebouncedRef = (initialValue, delay, immediate) =&gt; {<br/>  const state = ref(initialValue)<br/>  const debouncedRef = customRef((track, trigger) =&gt; ({<br/>    get() {<br/>      track()<br/>      return state.value<br/>    },<br/>    set: debounce(<br/>      value =&gt; {<br/>        state.value = value<br/>        trigger()<br/>      },<br/>      delay,<br/>      immediate<br/>    ),<br/>  }))<br/>  return debouncedRef<br/>}<br/><br/>export default useDebouncedRef</span></pre><p id="58fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<em class="kx"> _useDebouncedRef.js_ </em>文件中，我们有<em class="kx">去抖</em>和<em class="kx"> useDebouncedRef </em>函数。<em class="kx">去抖</em>功能负责在指定的延迟时间过后执行回调功能。除了回调函数和延迟数之外，它还接受第三个名为<em class="kx"> immediate </em>的参数。顾名思义，它用于指示回调是否应该立即执行。这个小助手函数可以抽象成自己的实用程序文件，并在应用程序的其他部分重用。</p><p id="e6c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<em class="kx">useDebouncedRef</em>composable中，我们使用从<em class="kx"> vue </em>包导入的<em class="kx"> ref </em>方法声明了一个新的反应值。然而，我们还使用了一个<em class="kx"> customRef </em>，这就是神奇之处。<em class="kx"> customRef </em>为我们提供了对跟踪依赖性和触发状态更新的显式控制。getter调用<em class="kx"> track </em>方法并返回当前<em class="kx">状态</em>值。对于setter，我们分配一个<em class="kx">反跳</em>函数的结果，该函数接收一个回调作为第一个参数，并转发<em class="kx">延迟</em>和<em class="kx">立即</em>参数。在回调中，我们更新<em class="kx">状态</em> ref并触发<em class="kx"> customRef </em>的更新。仅此而已。如果您尝试在输入字段中输入内容，您应该会看到，值文本只有在您停止输入一段时间后才会更新。</p><h2 id="b324" class="mn ll iq bd lm mo mp dn lq mq mr dp lu kj ms mt ly kn mu mv mc kr mw mx mg my bi translated">结论</h2><p id="d71c" class="pw-post-body-paragraph jy jz iq ka b kb mi kd ke kf mj kh ki kj mk kl km kn ml kp kq kr mm kt ku kv ij bi translated">我希望这篇文章对你有用。如果您想了解更多与Vue相关的技巧、高级模式、技术和最佳实践，您可能想要查看<a class="ae kw" href="https://theroadtoenterprise.com/?utm_source=theroadtoenterprise_blog&amp;utm_medium=article_learn_more&amp;utm_campaign=vue_the_road_to_enterprise" rel="noopener ugc nofollow" target="_blank">“Vue—通往企业之路”</a>一书，注册<a class="ae kw" href="https://theroadtoenterprise.com/blog/subscribe?utm_source=theroadtoenterprise_blog&amp;utm_medium=article_learn_more&amp;utm_campaign=vue_the_road_to_enterprise" rel="noopener ugc nofollow" target="_blank">时事通讯</a>，并在<a class="ae kw" href="https://twitter.com/@thomasfindlay94" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我。</p><p id="404d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kx">更多内容请看</em><a class="ae kw" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="kx">plain English . io</em></strong></a></p></div></div>    
</body>
</html>