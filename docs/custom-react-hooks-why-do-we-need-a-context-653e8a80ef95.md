# 自定义反应钩子:为什么我们需要一个上下文

> 原文：<https://javascript.plainenglish.io/custom-react-hooks-why-do-we-need-a-context-653e8a80ef95?source=collection_archive---------17----------------------->

![](img/f5cf8b61b754cfc09f7482ec5a61f3dc.png)

在我的 [*个人博客*](https://www.justjeb.com/blog) *上可以免费获得这篇文章和其他文章。请务必注册以获得最新最棒的！*

[TL；博士](#8ba5)

自定义 React 挂钩是封装逻辑和将数据传递到渲染树的一种非常方便的方式。

自定义 React 挂钩的规则非常简单:

> ***自定义钩子是一个 JavaScript 函数，名字以“use”开头，可能会调用其他钩子。***

# 纯钩子

考虑一下这个非常简单的自定义钩子的实现，它封装了一些共享文档服务的权限映射:

正如您所看到的，这个钩子非常简单——它使用了另一个自定义钩子，该钩子返回一个权限数组，并将它映射到一个简单的允许/不允许字典中。这将允许在整个应用程序中更好地重用代码，并帮助我们避免在每个需要这种检查的地方出现代码重复:

唯一的问题是，这个逻辑将在每次重新渲染时运行。在小数组的情况下，这可以忽略不计，但如果是大数组，那我们就有麻烦了。添加一个简单的定制钩子可以解决这个问题:

这样，只有当**权限**数组改变时，权限才会被重新匹配。

案子解决了。或者是？

官方 React [文档](https://reactjs.org/docs/hooks-custom.html#using-a-custom-hook)可以给我们提示这种方法可能有什么问题:

> ***两个组件使用同一个钩子共享状态吗？*** *不可以，自定义钩子是一种复用*有状态逻辑*(比如设置订阅，记住当前值)的机制，但是每次使用自定义钩子，里面的所有状态和效果都是完全隔离的。*
> 
> ***自定义钩子如何获得隔离状态？*** *各*谓*为一钩中计的孤立状态。因为我们直接调用 useFriendStatus，所以从 React 的角度来看，我们的组件只调用 useState 和 useEffect。而就像我们前面* [*学到的*](https://reactjs.org/docs/hooks-state.html#tip-using-multiple-state-variables)*[](https://reactjs.org/docs/hooks-effect.html#tip-use-multiple-effects-to-separate-concerns)**一样，我们可以在一个组件中多次调用 useState 和 useEffect，它们会完全独立。***

**这实际上意味着，如果我们从两个不同的组件调用 **useIsPermitted** (或者甚至从同一个组件调用两次)，逻辑将为 **useIsPermitted** 调用的每个实例执行，即使我们在内部使用了 **useMemo** 。**

# **带有上下文的自定义挂钩**

**解决这个问题的方法是将自定义挂钩与上下文结合起来。**

**让我们修改一下我们的 **useIsPermitted** 钩子实现:**

**现在，逻辑的作用域是特定的上下文提供者。这意味着，如果我们在应用程序的根中只使用这个提供程序一次，那么逻辑将只执行一次:**

**当然，我们可以决定将提供者放在渲染树的较低位置，以便仅在渲染相关部分时才执行逻辑，但底线是—我们现在对粒度有了更多的控制。**

# **什么时候用什么**

**虽然在性能和内存消耗方面，与上下文挂钩似乎是一个更健壮的解决方案，但这并不意味着您应该总是使用这种方法。**

**这两种方法都有用武之地，但是理解每一种方法的含义是很重要的。这里有一个简短的清单，可以帮助你决定正确的方法:**

****使用纯钩时:****

*   **自定义挂钩状态**必须**被隔离(每个实例不同)**或****
*   **在自定义钩子**或**中不执行繁重的计算**
*   **在应用程序中只使用钩子一次(作为一种沿渲染树向下传递数据的方式)**

****在下列情况下使用带上下文的钩子:****

*   **整个子树**必须**共享钩子的状态**或****
*   **钩子内部有一个繁重的计算，你希望它尽可能少地运行**

**如果你喜欢这篇文章，请关注我，在这里发表评论，或者如果你有任何问题，请在 [Twitter](https://twitter.com/jebbacca) 上给我发短信。**

***更多内容看* [***说白了. io***](http://plainenglish.io/) ***。*** *报名参加我们的**[***免费每周简讯这里***](http://newsletter.plainenglish.io/) ***。******