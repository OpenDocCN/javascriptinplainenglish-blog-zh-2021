<html>
<head>
<title>Easy Website Crawling with jsdom in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js中的jsdom轻松抓取网站</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/easy-website-crawling-with-jsdom-in-node-js-2ae15e126ed2?source=collection_archive---------3-----------------------#2021-01-06">https://javascript.plainenglish.io/easy-website-crawling-with-jsdom-in-node-js-2ae15e126ed2?source=collection_archive---------3-----------------------#2021-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b46" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用不到10行代码抓取网站</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/94bed3d109f96b6a0c93f60a0a25d8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qbnK5X2BMJyih09b"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@besluk" rel="noopener ugc nofollow" target="_blank">Luke Besley</a> on <a class="ae kv" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="f550" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">⚠️警告！⚠️</h2><p id="425c" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">在我们开始之前，请注意，不是互联网上的每个人都喜欢他的网站突然收到数百个来自你的爬行脚本的请求，只是因为你想从那里提取一些信息。因此，请确保您负责任地使用网站抓取。要么降低你对单页的要求，要么请求网站所有者的批准，这样你就不会被屏蔽或者使别人的生活变得困难。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h2 id="1101" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">编码前准备</h2><p id="0f24" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">你会有你爬某些网站的理由。例如，您可能只是想从一个网站中提取一些数据，而这些数据是无法通过API获得的。或者您希望在一切正常的情况下监控网站上的某些元素。或者完全不同的东西。</p><p id="5370" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">不管是什么，你首先要做一个快速的研究，看看你想在一个特定的网站上爬什么。这里有两个重要的通用参数(至少对于一个简单的用例来说):</p><ul class=""><li id="3a75" class="mx my iq lu b lv ms ly mt lf mz lj na ln nb mk nc nd ne nf bi translated">我们要抓取的URL</li><li id="1562" class="mx my iq lu b lv ng ly nh lf ni lj nj ln nk mk nc nd ne nf bi translated">我们想要抓取哪些元素，由一些CSS选择器定义</li></ul><p id="37ec" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">例如，您的理由可能是从特定网站上的一些HTML表中提取一些数据。所以你的URL可以是<a class="ae kv" href="https://www.mydatawebsite.com" rel="noopener ugc nofollow" target="_blank">https://www.xyz.com</a>，CSS选择器可以是<code class="fe nl nm nn no b">table tr</code>用于查找特定表格的行。</p><p id="edfd" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">对于我的例子，我决定要抓取<a class="ae kv" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a>并检查表单中第一个提交输入元素的值。</p><p id="c5a2" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">所以我访问了https://www.google.com，用Chrome开发工具检查了他们的HTML。只是快速检查了一下<code class="fe nl nm nn no b">document.querySelector('form input[type=submit]');</code>，我可以看到<code class="fe nl nm nn no b">submit</code>类型的第一个输入元素是他们的“谷歌搜索”，多巧啊，对吧？😉</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/6b5a9535ce7072d0fa0b19da967ba01d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QJLZng0kPZ6Cj5E6eCQwBw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Inspecting <a class="ae kv" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">https://www.google.com</a> with the Chrome Dev Tools</figcaption></figure><p id="fcf2" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">但是当然，你不希望每次都手动操作，也许有数百个网站需要你的数据，所以让我们创建一个超级短的爬行脚本。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h2 id="e3b9" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">让我们开始编码吧</h2><p id="3354" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">像往常一样，我在GitHub上为您准备了一个资源库，您可以克隆它作为一个小小的开端。我在我的知识库中使用了TypeScript，但是当然，你也可以自由地使用普通的JS。</p><div class="nq nr gp gr ns nt"><a href="https://github.com/Abszissex/medium-website-crawling" rel="noopener  ugc nofollow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">abszisex/medium-网站抓取</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">通过在GitHub上创建一个帐户，为abszisex/medium网站抓取开发做出贡献。</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">github.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kp nt"/></div></div></a></div><p id="4c7d" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">对于开始爬行，我们实际上只需要两个包。</p><ul class=""><li id="4ba9" class="mx my iq lu b lv ms ly mt lf mz lj na ln nb mk nc nd ne nf bi translated"><code class="fe nl nm nn no b">node-fetch</code> —它为node提供了使用便捷的<code class="fe nl nm nn no b">fetch()</code>方法来请求网站的可能性，因为Node.js本身并不支持它。</li><li id="a1f9" class="mx my iq lu b lv ng ly nh lf ni lj nj ln nk mk nc nd ne nf bi translated"><code class="fe nl nm nn no b">jsdom</code> —为了解析HTML，我们接收一个字符串，转换成我们可以处理的实际DOM。</li></ul><p id="e3e9" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">所以使用<code class="fe nl nm nn no b">npm install --save node-fetch jsdom</code>安装它们。</p><p id="ab0e" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">如果你正在使用TypeScript，你也应该安装他们的类型<code class="fe nl nm nn no b">npm install --save-dev @types/node-fetch @types/jsdom</code>。</p><p id="4b3a" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">安装完所需的模块后，我们可以开始实际的代码了:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="e58a" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">和往常一样，我尽量把更多的文档放在代码层面上，这样就很容易理解了。而是简单解释一下我们正在做的事情:</p><ul class=""><li id="956f" class="mx my iq lu b lv ms ly mt lf mz lj na ln nb mk nc nd ne nf bi translated">我们从准备变量的<code class="fe nl nm nn no b">main</code>方法开始，然后运行爬行(<code class="fe nl nm nn no b">scrape</code>)。之后，我们简单地输出参数和爬行结果。</li><li id="1a9b" class="mx my iq lu b lv ng ly nh lf ni lj nj ln nk mk nc nd ne nf bi translated">在<code class="fe nl nm nn no b">scrape</code>方法中，我们首先调用<code class="fe nl nm nn no b">getWebsiteContent()</code>方法，这样我们就可以以普通字符串的形式接收我们想要抓取的网站的HTML。</li><li id="21ab" class="mx my iq lu b lv ng ly nh lf ni lj nj ln nk mk nc nd ne nf bi translated">下一步，我们用我们的字符串初始化<code class="fe nl nm nn no b">JSDOM</code>，将它转换成一个实际的DOM，我们可以在那里工作。</li><li id="c63e" class="mx my iq lu b lv ng ly nh lf ni lj nj ln nk mk nc nd ne nf bi translated">最后但同样重要的是，我们用我们的<code class="fe nl nm nn no b">cssSelector</code>查询DOM，并尝试获得我们有希望找到的<code class="fe nl nm nn no b">HTMLInputElement</code>的<code class="fe nl nm nn no b">value</code>。</li></ul><p id="2470" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">所以现在让我们通过<code class="fe nl nm nn no b">npm run dev</code>直接运行我们的类型脚本代码:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/2cc144d3fbd429e8e3c1c1aa12644ebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8iLDw8Tb3SDSnctKwkppRA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Run crawling via ‘npm run dev’</figcaption></figure><p id="ba37" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">如你所见，该程序输出我们的参数和名为“Google Suche”的结果，这是“Google搜索”的德语版本。这正是我们想要的。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><h2 id="e105" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h2><p id="a566" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">我希望我能向你展示如何用几行代码就能轻松地抓取一个网站(如果你去掉所有的注释，实际代码将少于10行！).</p><p id="d90a" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">当然，您的实际用例很可能更复杂，您将使用一些循环和更复杂的查询机制，但这不会增加实际爬行的复杂性，它只是对结果的额外解析/处理😉</p><p id="8797" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">当你开始爬行时，不要忘记对网站所有者负责和“公平”。</p><p id="2ba4" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">感谢您花时间阅读我的文章。</p><h2 id="c117" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">如果你想联系我，请在LinkedIn上给我打电话。</p><p id="c598" class="pw-post-body-paragraph ls lt iq lu b lv ms jr lx ly mt ju ma lf mu mc md lj mv mf mg ln mw mi mj mk ij bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt nt"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">我的书籍推荐</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="oc l"><div class="ol l oe of og oc oh kp nt"/></div></div></a></div><div class="nq nr gp gr ns nt"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd ir gy z fp ny fr fs nz fu fw ip bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="oc l"><div class="om l oe of og oc oh kp nt"/></div></div></a></div></div></div>    
</body>
</html>