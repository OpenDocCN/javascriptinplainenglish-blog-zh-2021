<html>
<head>
<title>Next.js Firebase v9: Create AuthProvider with Next.js Nookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js Firebase v9:使用Next.js Nookies创建AuthProvider</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nextjs-firebase-v9-part-15-create-authprovider-with-next-js-nookies-6b80779bb551?source=collection_archive---------11-----------------------#2021-10-25">https://javascript.plainenglish.io/nextjs-firebase-v9-part-15-create-authprovider-with-next-js-nookies-6b80779bb551?source=collection_archive---------11-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1054" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第15部分:在React/Next.js应用程序中使用Firestore处理用户身份验证</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/81b0cdcc7d0e4bb0ce7dbd06a4baefef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dgJSNIzCkzJqQG1b.png"/></div></figure><p id="aaa1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">观看<a class="ae lj" href="https://www.youtube.com/watch?v=Sdv3bw2rIuQ&amp;list=PLC5vixW_4xSKqwpgaPEcLj7O3SvUNqC9L" rel="noopener ugc nofollow" target="_blank">视频系列</a>和<a class="ae lj" href="https://www.udemy.com/course/complete-nextjs-firebase-firestore-course/?referralCode=50C342DE4DD73B4428F4" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="21ad" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在根文件夹下，创建<strong class="kp ir"> Auth.js </strong>。</p><p id="6011" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后进入<strong class="kp ir"> Auth.js </strong>里面。首先，我们需要导入<code class="fe lr ls lt lu b">useEffect</code>、<code class="fe lr ls lt lu b">createContext</code>、<code class="fe lr ls lt lu b">getAuth</code>和<code class="fe lr ls lt lu b">nookies</code>。</p><pre class="kg kh ki kj gt lv lu lw lx aw ly bi"><span id="b5d2" class="lz ma iq lu b gy mb mc l md me">import { useEffect,createContext } from "react";</span><span id="0942" class="lz ma iq lu b gy mf mc l md me">import { getAuth } from 'firebase/auth';</span><span id="1a9f" class="lz ma iq lu b gy mf mc l md me">import nookies from 'nookies';</span></pre><p id="a2d7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后我们创造了<code class="fe lr ls lt lu b">AuthContext</code>。在<code class="fe lr ls lt lu b">useEffect</code>内部，我们将检查用户是否存在。如果没有，我们将<code class="fe lr ls lt lu b">console.log('no user')</code>并清除cookies。</p><p id="37bd" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果有用户，我们将获取令牌，然后将令牌存储在cookies中。</p><pre class="kg kh ki kj gt lv lu lw lx aw ly bi"><span id="6bb1" class="lz ma iq lu b gy mb mc l md me">const AuthContext = createContext({});</span><span id="4cd1" class="lz ma iq lu b gy mf mc l md me">export const AuthProvider = ({children})=&gt;{</span><span id="5744" class="lz ma iq lu b gy mf mc l md me">useEffect(() =&gt; {</span><span id="eade" class="lz ma iq lu b gy mf mc l md me">const auth = getAuth()</span><span id="897b" class="lz ma iq lu b gy mf mc l md me">return auth.onIdTokenChanged(async(user)=&gt;{</span><span id="cd1c" class="lz ma iq lu b gy mf mc l md me">if (!user) {</span><span id="16ec" class="lz ma iq lu b gy mf mc l md me">console.log('no user');</span><span id="b960" class="lz ma iq lu b gy mf mc l md me">return;</span><span id="4aa0" class="lz ma iq lu b gy mf mc l md me">}</span><span id="7658" class="lz ma iq lu b gy mf mc l md me">const token = await user.getIdToken();</span><span id="6d06" class="lz ma iq lu b gy mf mc l md me">console.log('token', token);</span><span id="f692" class="lz ma iq lu b gy mf mc l md me">console.log('user', user);</span><span id="4051" class="lz ma iq lu b gy mf mc l md me">})</span><span id="ea2a" class="lz ma iq lu b gy mf mc l md me">}, [])</span><span id="d556" class="lz ma iq lu b gy mf mc l md me">return (</span><span id="6156" class="lz ma iq lu b gy mf mc l md me">&lt;AuthContext.Provider value={{}}&gt;</span><span id="aef7" class="lz ma iq lu b gy mf mc l md me">{children}</span><span id="9f32" class="lz ma iq lu b gy mf mc l md me">&lt;/AuthContext.Provider&gt;</span><span id="f40c" class="lz ma iq lu b gy mf mc l md me">)</span><span id="128c" class="lz ma iq lu b gy mf mc l md me">}</span><span id="a754" class="lz ma iq lu b gy mf mc l md me">export const useAuth = () =&gt;useContext(AuthContext)</span></pre><p id="d6bb" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">稍后，我们会将用户值传递给<code class="fe lr ls lt lu b">Provider</code>，这样我们就可以通过使用<code class="fe lr ls lt lu b">useAuth</code>来获取它。</p><pre class="kg kh ki kj gt lv lu lw lx aw ly bi"><span id="c06e" class="lz ma iq lu b gy mb mc l md me">export const useAuth = () =&gt;useContext(AuthContext)</span></pre><h2 id="2e0e" class="lz ma iq bd mg mh mi dn mj mk ml dp mm kw mn mo mp la mq mr ms le mt mu mv mw bi translated">测试身份验证提供者</h2><p id="bfe5" class="pw-post-body-paragraph kn ko iq kp b kq mx jr ks kt my ju kv kw mz ky kz la na lc ld le nb lg lh li ij bi translated">转到_app.js，导入<code class="fe lr ls lt lu b">AuthProvider</code>，然后用<code class="fe lr ls lt lu b">&lt;AuthProvider&gt;</code>包装组件。</p><pre class="kg kh ki kj gt lv lu lw lx aw ly bi"><span id="7e3a" class="lz ma iq lu b gy mb mc l md me">import { AuthProvider } from '../Auth'</span><span id="4223" class="lz ma iq lu b gy mf mc l md me">import '../styles/globals.css'</span><span id="8c9d" class="lz ma iq lu b gy mf mc l md me">function MyApp({ Component, pageProps }) {</span><span id="89f8" class="lz ma iq lu b gy mf mc l md me">return (</span><span id="e099" class="lz ma iq lu b gy mf mc l md me">&lt;AuthProvider&gt;</span><span id="776a" class="lz ma iq lu b gy mf mc l md me">&lt;Component {...pageProps} /&gt;</span><span id="9025" class="lz ma iq lu b gy mf mc l md me">&lt;/AuthProvider&gt;</span><span id="6aa3" class="lz ma iq lu b gy mf mc l md me">)</span><span id="319f" class="lz ma iq lu b gy mf mc l md me">}</span><span id="790d" class="lz ma iq lu b gy mf mc l md me">export default MyApp</span></pre><p id="fd98" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，如果我们重新加载页面，我们可以看到“no user”出现在控制台上。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/f6a848f969d8e4da462d6a73cceaa076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUli8Gh43siHqCKFecZdhw.png"/></div></div></figure><p id="23b0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="nh">更多内容看</em> <a class="ae lj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="nh">说白了</em></strong></a></p></div></div>    
</body>
</html>