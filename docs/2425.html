<html>
<head>
<title>What is CORS (Cross-Origin Resource Sharing) and How to Fix the CORS Error?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是CORS(跨源资源共享),如何修复CORS错误？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-cors-cross-origin-resource-sharing-and-how-to-fix-the-cors-error-d10130e99dd0?source=collection_archive---------4-----------------------#2021-05-19">https://javascript.plainenglish.io/what-is-cors-cross-origin-resource-sharing-and-how-to-fix-the-cors-error-d10130e99dd0?source=collection_archive---------4-----------------------#2021-05-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="eddf" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">最后，摆脱CORS错误。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/18144a492d3100cfc8859dab5beb0a80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z6WIIQrsLK1GcSJW"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@elisa_ventur?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Elisa Ventur</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="84b4" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">什么是同源政策和CORS？</h2><p id="31ec" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">跨源资源共享是一种机制，允许一个URL上的网站从另一个URL请求数据。例如，您试图从一个API获取数据，而应用程序失败了，并在控制台中显示一个cors错误。这是因为浏览器实现了<em class="mi">同源策略</em>。该策略允许客户端从自己的URL自由请求数据，但阻止来自不同URL的任何内容，除非满足某些条件。</p><p id="bb09" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">当浏览器向服务器发出请求时，它会在请求中添加一个源头<code class="fe mo mp mq mr b">Origin: <a class="ae ks" href="https://localhost:3000" rel="noopener ugc nofollow" target="_blank">https://localhost:3000</a></code>。如果这个请求发送到一个具有相同来源的服务器，浏览器就会允许它。但是，如果请求去往不同的URL，称为<em class="mi">跨源请求</em>，那么服务器必须向响应消息添加一个<code class="fe mo mp mq mr b"><em class="mi">Access-Control-Allow-Origin</em></code> <em class="mi"> </em>报头。然后，浏览器会将此标题与原点进行匹配。如果不匹配，浏览器将拒绝响应，抛出一个cors错误。这是<em class="mi">同源</em>策略，实施该策略是为了防止<em class="mi">跨站点请求伪造攻击</em>，恶意网站利用浏览器的cookie存储系统。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ms"><img src="../Images/dc4d6a0633d4fb750acc2fbd062aa904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Lp4qegQyeTMhJCI-EyXWA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">This is what the CORS error looks like.</figcaption></figure><p id="700d" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">当使用API和/或托管时，这个错误经常困扰开发人员。下面是解决这个问题的一些方法。</p></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><h2 id="c63e" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">场景1 —构建全栈应用</h2><p id="d52e" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">在开发环境中，一切似乎都很好，因为您在同一台机器上运行服务器和客户机程序。然而，当您部署您的服务器(使用Heroku或一些其他服务)然后试图请求数据时，Snap！cors错误开始出现。</p><p id="93b0" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">好消息…修复真的很简单。您只需要将Access-Control-Allow-Origin头添加到服务器响应中。</p><blockquote class="na nb nc"><p id="dd31" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated"><code class="fe mo mp mq mr b">response.header('Access-Control-Allow-Origin', '*')</code></p></blockquote><p id="1dfd" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">这里，“*”指定通配符值，以允许所有域访问服务器资源。服务器也可以非常具体，只在头中包含可以访问资源的域的源URL。</p><p id="f710" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io"> —替代解决方案:使用cors包。</strong></p><blockquote class="na nb nc"><p id="aeff" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated">安装— <code class="fe mo mp mq mr b">npm install cors</code></p><p id="d9b2" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated">进口— <code class="fe mo mp mq mr b">const cors = require('cors')</code></p><p id="15e1" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated">为您的服务器添加中间件— <code class="fe mo mp mq mr b">app.use(cors())</code></p></blockquote><p id="6860" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">您可以配置cors选项，甚至只将它添加到特定的端点，而不是所有的响应。点击查看软件包文档<a class="ae ks" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><h2 id="d8de" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">场景2 —在前端从第三方API获取数据</h2><p id="1ba1" class="pw-post-body-paragraph lp lq in lr b ls lt jo lu lv lw jr lx lc ly lz ma lg mb mc md lk me mf mg mh ig bi translated">假设您的前端试图向<a class="ae ks" href="https://jobs.github.com/api" rel="noopener ugc nofollow" target="_blank"> GitHub作业API </a>发出GET请求。但是这个API没有在响应中包含一个<code class="fe mo mp mq mr b">Access-Control-Allow-Origin</code>头，这导致了一个cors错误。</p><p id="26dd" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io"> —解决方案1:将您的请求发送到获取代理(快速修复)</strong></p><p id="b2a0" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">代理服务器充当客户端和API之间的中间件。GET请求首先到达添加了<code class="fe mo mp mq mr b">Access-Control-Allow-Origin</code>头的代理，然后将请求转发给客户机。</p><p id="9a70" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">有许多免费的代理服务器可供选择，如cors anywhere、thingproxy、等。要使用获取代理，请将代理URL附加到API请求中。请参见下面的示例:</p><blockquote class="na nb nc"><p id="17c7" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated">上一个— <code class="fe mo mp mq mr b">axios.get(https://jobs.github.com/positions.json)</code></p><p id="2ef4" class="lp lq mi lr b ls mj jo lu lv mk jr lx nd ml lz ma ne mm mc md nf mn mf mg mh ig bi translated">已修改— <code class="fe mo mp mq mr b">axios.get(https://cors-anywhere.herokuapp.com/https://jobs.github.com/positions.json)</code></p></blockquote><p id="ea75" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">这里是你可以使用的10个免费代理服务器的列表。这个解决方案很棒，因为它易于实现。然而，这些代理中的大多数仅用于开发目的，或者仅提供临时使用的演示，或者不能在生产环境中工作。此外，通常需要一段时间才能收到影响应用程序性能的响应。</p><p id="c1f5" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io"> —解决方案2:构建自己的代理服务器</strong></p><p id="1bdf" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">不要担心，这比听起来容易得多，最好的解决方案是构建自己的代理，这将为您的设计和实现提供更多的灵活性和控制力。构建一个简单的服务器，从API获取数据，并将相同的数据发送到您的前端，同时将<code class="fe mo mp mq mr b">Access-Control-Allow-Origin</code>头添加到响应中。下面是一个使用restify从GitHub Jobs API获取数据的节点代理示例。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="2b5c" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated">带有非标准头(Put、Patch、Delete)的HTTP请求需要预先飞行。浏览器首先使用选项HTTP verb发出请求，服务器使用头<code class="fe mo mp mq mr b">Access-Control-Allow-Methods: PUT</code>使用该源允许的方法进行响应，之后可以发送实际的请求。服务器可以用一个<code class="fe mo mp mq mr b">Access-Control-Max-Age: 30000</code>头来响应，允许浏览器在一定时间内缓存预检，使过程更加高效。</p><p id="cddd" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">一些临时修复— </strong></p><ul class=""><li id="d146" class="ni nj in lr b ls mj lv mk lc nk lg nl lk nm mh nn no np nq bi translated">将<code class="fe mo mp mq mr b">"proxy": "API_URL"</code>添加到package.json文件中，并修改获取查询以将请求发送到“/”</li><li id="2e79" class="ni nj in lr b ls nr lv ns lc nt lg nu lk nv mh nn no np nq bi translated">安装允许-控制-允许-起源浏览器插件。</li></ul><p id="97a1" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><strong class="lr io">免责声明:</strong>这些解决方案只在开发中有效，在生产环境中会失败。</p><p id="9764" class="pw-post-body-paragraph lp lq in lr b ls mj jo lu lv mk jr lx lc ml lz ma lg mm mc md lk mn mf mg mh ig bi translated"><em class="mi">更多内容尽在</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lr io"><em class="mi">plain English . io</em></strong></a></p></div></div>    
</body>
</html>