<html>
<head>
<title>What’s New in Ionic Storage v3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">离子存储v3的新功能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/whats-new-in-ionic-storage-v3-851aff67d8e6?source=collection_archive---------11-----------------------#2021-03-25">https://javascript.plainenglish.io/whats-new-in-ionic-storage-v3-851aff67d8e6?source=collection_archive---------11-----------------------#2021-03-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3b87e189d27fdf4149daee1733e49bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyRe2sOaqLIa-CuommxNLg.jpeg"/></div></div></figure><h2 id="d3c9" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h2><p id="5af2" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">如果你熟悉移动应用程序开发，你应该听说过Ionic。</p><p id="d649" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">Ionic是一个开源的移动UI工具包，用于构建高质量、跨平台的本地和web应用程序体验。它共享一个代码库，允许你使用网络技术编写你的移动应用。Ionic最初只支持Angular。但是到今天为止，它们支持其他JavaScript框架，比如React和Vue。它们也支持普通Javascript的使用。</p><p id="2746" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">昨天，Ionic宣布发布Ionic Storage V3，这是一个开源库，提供了一种存储简单数据的简单方法。Ionic storage允许开发人员构建单一代码库应用程序，同时为他们提供使用应用程序运行平台上可用的最佳存储引擎的优势。</p><p id="ce1d" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">离子存储最初只考虑了角度支持。看看ionic社区有多受欢迎，以及ionic对其他框架的支持，他们认为将ionic存储带到Ionic生态系统的其余部分是合适的。</p><h2 id="293f" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">有什么新鲜事？</h2><p id="5428" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">Ionic storage v3现在增加了对Vue、React(包括普通JavaScript)的支持。v2中现有的角度实现仍然保留。</p><ol class=""><li id="5bc2" class="lr ls in kt b ku lm ky ln ke lt ki lu km lv ll lw lx ly lz bi translated">在以前的版本中，Ionic storage有一个名为<code class="fe ma mb mc md b">Localforage-cordovaSQLiteDriver</code>的驱动程序硬编码到库中，虽然它在原生移动设备上运行时更容易使用SQLite，但它限制了其他存储引擎的选项。这种依赖性已经被移除，但是您仍然可以按照这里的<a class="ae me" href="https://github.com/ionic-team/ionic-storage#sqlite-installation" rel="noopener ugc nofollow" target="_blank"> SQLite说明来安装它。</a></li></ol><p id="323f" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">2.最初为基于手动承诺的方法构建的<code class="fe ma mb mc md b"><strong class="kt io">ready()</strong></code>函数已经被删除，因为现在有了<code class="fe ma mb mc md b"><strong class="kt io">async/await</strong></code>模式，Ionic Storage v3现在用能够立即实例化数据库的<code class="fe ma mb mc md b"><strong class="kt io">create()</strong></code>函数代替了<code class="fe ma mb mc md b"><strong class="kt io">ready()</strong></code>。</p><h2 id="d736" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">装置</h2><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="0f31" class="jv jw in md b gy mn mo l mp mq">npm install @ionic/storage</span></pre><p id="8b62" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">使用Angular时，安装附加的<code class="fe ma mb mc md b">@ionic/storage-angular</code>库:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="16b0" class="jv jw in md b gy mn mo l mp mq">npm install @ionic/storage-angular</span></pre><p id="72cc" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果您想将SQLite用作存储引擎，请参见<a class="ae me" href="https://github.com/ionic-team/ionic-storage#sqlite-installation" rel="noopener ugc nofollow" target="_blank"> SQLite安装</a>说明。</p><h2 id="4f67" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用</h2><p id="b50f" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated"><strong class="kt io">使用React、Vue或普通JavaScript </strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="66be" class="jv jw in md b gy mn mo l mp mq">Import { Storage } from '@ionic/storage';</span><span id="acb3" class="jv jw in md b gy mr mo l mp mq">const store = new Storage({/* add your config here */});<br/>await store.create();</span></pre><p id="690d" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">带棱角</strong></p><p id="63ce" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在Angular using服务和依赖注入中的使用需要导入<code class="fe ma mb mc md b">IonicStorageModule</code>然后注入<code class="fe ma mb mc md b">Storage</code>类。</p><p id="5ad5" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">首先，在<code class="fe ma mb mc md b">src/app/app.module.ts</code>中编辑您的NgModule声明，或者在您将在其中使用存储库的页面的模块中编辑，并添加<code class="fe ma mb mc md b">IonicStorageModule</code>作为导入:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="1bdf" class="jv jw in md b gy mn mo l mp mq">import { IonicStorageModule } from '@ionic/storage-angular';</span><span id="2a05" class="jv jw in md b gy mr mo l mp mq">@NgModule({<br/>  imports: [<br/>    IonicStorageModule.forRoot()<br/>  ]<br/>})<br/>export class AppModule { }</span></pre><p id="d2e9" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">接下来，将<code class="fe ma mb mc md b">Storage</code>注入一个组件:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="e34f" class="jv jw in md b gy mn mo l mp mq">import { Component } from '@angular/core';<br/>import { Storage } from '@ionic/storage-angular';</span><span id="858e" class="jv jw in md b gy mr mo l mp mq">@Component({<br/>  selector: 'page-home',<br/>  templateUrl: 'home.html'<br/>})<br/>export class HomePage {</span><span id="b795" class="jv jw in md b gy mr mo l mp mq">  constructor(private storage: Storage) {<br/>  }</span><span id="d852" class="jv jw in md b gy mr mo l mp mq">  async ngOnInit() {<br/>    // If using a custom driver:<br/>    // await this.storage.defineDriver(MyCustomDriver)<br/>    await this.storage.create();<br/>  }<br/>}</span></pre><p id="3e9c" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">或者，可以创建一个Angular服务来管理应用程序中的所有数据库操作，并将所有配置和数据库初始化限制在一个位置。当这样做时，不要忘记在您的<code class="fe ma mb mc md b">NgModule</code>中的一个<code class="fe ma mb mc md b">providers</code>数组中注册这个服务，并确保<code class="fe ma mb mc md b">IonicStorageModule</code>已经在那个<code class="fe ma mb mc md b">NgModule</code>中初始化，如上所示。以下是该服务的一个示例:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="ff34" class="jv jw in md b gy mn mo l mp mq">import { Injectable } from '@angular/core';</span><span id="720a" class="jv jw in md b gy mr mo l mp mq">import { Storage } from '@ionic/storage-angular';</span><span id="b476" class="jv jw in md b gy mr mo l mp mq">@Injectable({<br/>  providedIn: 'root'<br/>})<br/>export class StorageService {<br/>  private _storage: Storage | null = null;</span><span id="df1d" class="jv jw in md b gy mr mo l mp mq">  constructor(private storage: Storage) {<br/>    this.init();<br/>  }</span><span id="eb42" class="jv jw in md b gy mr mo l mp mq">  async init() {<br/>    // If using, define drivers here: await this.storage.defineDriver(/*...*/);<br/>    const storage = await this.storage.create();<br/>    this._storage = storage;<br/>  }</span><span id="0872" class="jv jw in md b gy mr mo l mp mq">  // Create and expose methods that users of this service can<br/>  // call, for example:<br/>  public set(key: string, value: any) {<br/>    this._storage?.set(key, value);<br/>  }<br/>}</span></pre><h2 id="7f9d" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">应用程序接口</h2><p id="0e5b" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">存储API提供了设置、获取和删除与键相关联的值的方法，以及清除数据库、访问存储的键及其数量以及枚举数据库中的值的方法。</p><p id="e436" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">要设置一个项目，使用</strong> <code class="fe ma mb mc md b">set(key, value)</code>:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="3779" class="jv jw in md b gy mn mo l mp mq">await storage.set('name', 'Mr. Ionitron');</span></pre><p id="d37a" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">要取回项目，使用</strong> <code class="fe ma mb mc md b">get(name)</code>:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="1966" class="jv jw in md b gy mn mo l mp mq">const name = await storage.get('name');</span></pre><p id="d5ca" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">删除项目:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="c5fe" class="jv jw in md b gy mn mo l mp mq">await storage.remove(key);</span></pre><p id="906f" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">清除所有项目:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="abbd" class="jv jw in md b gy mn mo l mp mq">await storage.clear();</span></pre><p id="3ed1" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">保存所有密钥:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="ce0f" class="jv jw in md b gy mn mo l mp mq">await storage.keys()</span></pre><p id="bd66" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">获取存储的键/值对的数量:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="a635" class="jv jw in md b gy mn mo l mp mq">await storage.length()</span></pre><p id="dc1d" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">枚举存储的键/值对:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="0d12" class="jv jw in md b gy mn mo l mp mq">storage.forEach((key, value, index) =&gt; {<br/>});</span></pre><p id="53a1" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">启用加密时使用</strong> <a class="ae me" href="https://ionic.io/docs/secure-storage" rel="noopener ugc nofollow" target="_blank"> <strong class="kt io">离子安全存储</strong> </a> <strong class="kt io">驱动:</strong></p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="6a07" class="jv jw in md b gy mn mo l mp mq">storage.setEncryptionKey('mykey');</span></pre><p id="3891" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">查看此<a class="ae me" href="https://github.com/ionic-team/ionic-storage#encryption-support" rel="noopener ugc nofollow" target="_blank">加密支持</a>链接了解更多信息。</p><h2 id="814e" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">添加配置</h2><p id="b4c2" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">存储引擎既可以配置特定的存储引擎优先级，也可以配置自定义配置选项以传递给local feed。有关可能的选项，请参见本地饲料配置文件:<a class="ae me" href="https://github.com/localForage/localForage#configuration" rel="noopener ugc nofollow" target="_blank">https://github.com/localForage/localForage#configuration</a></p><p id="948b" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">在React/Vue/Vanilla JavaScript配置中</strong></p><p id="31c4" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在<code class="fe ma mb mc md b">Storage</code>构造函数中传递配置选项:</p><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="840e" class="jv jw in md b gy mn mo l mp mq">const storage = new Storage({<br/>  name: '__mydb',<br/>  driverOrder: [Drivers.IndexedDB, Drivers.LocalStorage]<br/>});</span></pre><h2 id="4775" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">角度配置</h2><pre class="mf mg mh mi gt mj md mk ml aw mm bi"><span id="85b3" class="jv jw in md b gy mn mo l mp mq">import { Drivers, Storage } from '@ionic/storage';<br/>import { IonicStorageModule } from '@ionic/storage-angular';</span><span id="33a9" class="jv jw in md b gy mr mo l mp mq">@NgModule({<br/>  //...<br/>  imports: [<br/>   IonicStorageModule.forRoot({<br/>     name: '__mydb',<br/>     driverOrder: [Drivers.IndexedDB, Drivers.LocalStorage]<br/>   })<br/> ],<br/> //...<br/>})<br/>export class AppModule { }</span></pre><h2 id="4536" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论。</h2><p id="15df" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">Ionic Storage v3不仅增加了对其他框架的支持，还定义了一种在应用中存储简单数据的现代方法，同时自动使用应用运行平台上可用的最佳存储引擎。</p><p id="0844" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">编码快乐！</strong></p></div></div>    
</body>
</html>