<html>
<head>
<title>How to implement ‘Shopping Cart’ features using Cookies in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中使用Cookies实现“购物车”功能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cookies-in-react-202c3df273c6?source=collection_archive---------8-----------------------#2021-04-12">https://javascript.plainenglish.io/cookies-in-react-202c3df273c6?source=collection_archive---------8-----------------------#2021-04-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="f3a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在项目中解决的问题实现了类似购物车的功能。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f17cb649f64ef172372c68a90ae4565f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-WCXcEsUJEfYp7bnvQeaQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Shopping cart resting on keyboard</figcaption></figure><h2 id="7f04" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><strong class="ak">背景</strong></h2><p id="99f7" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">当我在<a class="ae lw" href="https://flatironschool.com/" rel="noopener ugc nofollow" target="_blank">熨斗</a>为我的最终项目创建一个React应用程序时，我遇到了一个问题，我需要能够将我的应用程序的各个方面与不同的用户相关联，但不需要进行用户认证——我的应用程序中没有任何部分需要保密。</p><p id="3d3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我开发的应用程序的基础是允许用户查看由<a class="ae lw" href="https://picsum.photos/" rel="noopener ugc nofollow" target="_blank"> Picsum API </a>生成的随机图片，并对它们进行投票，因此，总的来说，用户会在互联网上找到“最好”的图片，或者至少是Picsum生成的最好的图片。</p><p id="6f5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户还可以查看一系列热门图片(基于喜好)，以及趋势图片(你可以在这里找到趋势/流行算法的介绍<a class="ae lw" href="https://www.akitaonrails.com/2016/10/31/ruby-on-rails-implementation-of-a-proper-ranking-popularity-system" rel="noopener ugc nofollow" target="_blank"/>)。用户喜欢的图片会被添加到他们的“收藏”中。用户不能对他们收藏的图片做任何事情，除了查看或下载，因此，我认为没有必要允许用户拥有个人资料。相反，我使用cookies来识别用户——类似于网站如何保存你的购物车，即使你从未登录或创建个人资料。</p><h2 id="cf1c" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><strong class="ak">使用Rails作为API </strong></h2><p id="c83e" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">顺便提一下，虽然我的应用前端使用React，但我在后端使用Rails来跟踪图片及其与用户的关联。我保持简单。用户可以通过客户端cookies中创建和存储的id找到或创建(稍后将详细介绍)，图片可以通过Picsum提供的id找到或创建。</p><p id="09c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当用户喜欢一张图片时，我的后端会检查用户是否存在，图片是否存在，用户和图片之间是否已经存在关联。用户可以从他们的收藏中删除图片，从而删除用户和pic之间的关系，但不能否决他们收藏中的图片。</p><h2 id="73e3" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><strong class="ak">创建cookie</strong></h2><p id="c41f" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">我能够保存用户的照片集合，同时通过在前端实现cookies来防止用户对同一张照片进行多次投票。其实很简单:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="4cb4" class="ky kz in ly b gy mc md l me mf">// add 'react-uuid' via yarn add or npm install<br/>// <em class="mg">cookieHelpers.js</em><br/>import uuid from 'react-uuid'</span><span id="8cd1" class="ky kz in ly b gy mh md l me mf">export const createCookie = () =&gt; {<br/>  if (document.cookie) {    <br/>    return document.cookie<br/>  } else {<br/>    // console.log(uuid()) =&gt; '57e1ef0-b8c3-3b81-252c-e54fb572dc'<br/>    const userUUID = `userUUID=${uuid()}`<br/>    <br/>    // make sure your cookies don't expire<br/>    const expiration = `expires=${new Date('01/01/2100').toUTCString()}`<br/>    <br/>    // SameSite=Lax should be default, but I had issues while<br/>    // testing on firefox<br/>    document.cookie = `${userUUID};${expiration};SameSite=Lax`;<br/>    return document.cookie</span><span id="dd41" class="ky kz in ly b gy mh md l me mf">// <em class="mg">App.js</em><br/>...<br/>import {createCookie} from './helpers/appHelpers'</span><span id="6fad" class="ky kz in ly b gy mh md l me mf">class App extends Component {<br/>  // Create and set the cookie when component mounts<br/>  componentDidMount() {<br/>    const cookie = createCookie()<br/>    // Assuming you have a redux store with a setCookie<br/>    // action and reducer<br/>    this.props.setCookie()<br/>  }<br/>}</span></pre><p id="6982" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是全部了。我也使用Redux，所以我将用户的标识符存储在应用程序的商店中。</p><h2 id="8a24" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><strong class="ak">使用创建的Cookie </strong></h2><p id="f015" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">由于我在用户启动应用程序时检索或分配用户的标识符，因此我可以在向后端发送获取请求时使用该id。我能够检索用户喜欢的图片集，并确保它们不会重复喜欢一张图片。</p><h2 id="15de" class="ky kz in bd la lb lc dn ld le lf dp lg jv lh li lj jz lk ll lm kd ln lo lp lq bi translated"><strong class="ak">结论</strong></h2><p id="68e3" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh ig bi translated">虽然我使用React只有几个星期，但我绝不是专家，我相信我在项目中试图解决的问题类似于让用户的“购物车”持久化的问题，因此上面的代码可以被派生和抽象用于广泛的应用程序。感谢阅读！</p><p id="0351" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mg">更多内容尽在</em><a class="ae lw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank">T5】plain English . ioT7】</a></p></div></div>    
</body>
</html>