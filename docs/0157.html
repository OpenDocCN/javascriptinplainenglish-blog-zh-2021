<html>
<head>
<title>Add Basic Authentication to Our Fastify App with fastify-basic-auth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用fastify-basic-auth向我们的Fastify应用程序添加基本身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-basic-authentication-to-our-fastify-app-with-fastify-basic-auth-98ce7c00b107?source=collection_archive---------6-----------------------#2021-01-09">https://javascript.plainenglish.io/add-basic-authentication-to-our-fastify-app-with-fastify-basic-auth-98ce7c00b107?source=collection_archive---------6-----------------------#2021-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fdfb4903544a3b88482e1ed3e2e5996e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8WKSMOquUjPlkwVH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@andersjilden?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anders Jildén</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9d61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过fastify-basic-auth库，我们可以快速地将基本身份验证添加到我们的fastify应用程序中。</p><p id="f3cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用这个库向我们的Fastify应用程序添加身份验证。</p><h1 id="079f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="851d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过运行以下命令来安装该软件包:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b4f0" class="mn lc iq mj b gy mo mp l mq mr">npm i fastify-basic-auth</span></pre><h1 id="ac31" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加基本身份验证</h1><p id="c940" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写一些代码将基本的auth添加到我们的Fastify应用程序中。</p><p id="5358" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6360" class="mn lc iq mj b gy mo mp l mq mr">const fastify = require('fastify')({<br/>  logger: true<br/>})</span><span id="c95e" class="mn lc iq mj b gy ms mp l mq mr">const authenticate = {realm: 'Westeros'}<br/>fastify.register(require('fastify-basic-auth'), { validate, authenticate })</span><span id="4664" class="mn lc iq mj b gy ms mp l mq mr">function validate (username, password, req, reply, done) {<br/>  if (username === 'foo' &amp;&amp; password === 'bar') {<br/>    done()<br/>  } else {<br/>    done(new Error('invalid user'))<br/>  }<br/>}</span><span id="c8d6" class="mn lc iq mj b gy ms mp l mq mr">fastify.after(() =&gt; {<br/>  fastify.addHook('onRequest', fastify.basicAuth)</span><span id="8cfa" class="mn lc iq mj b gy ms mp l mq mr">  fastify.get('/', (req, reply) =&gt; {<br/>    reply.send({ hello: 'world' })<br/>  })<br/>})</span><span id="6f1c" class="mn lc iq mj b gy ms mp l mq mr">fastify.listen(3000, '0.0.0.0',  function (err, address) {<br/>  if (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>  fastify.log.info(`server listening on ${address}`)<br/>})</span></pre><p id="cc41" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">validate</code>和<code class="fe mt mu mv mj b">authenticate</code>注册<code class="fe mt mu mv mj b">fastify-basic-auth</code>插件。</p><p id="3b1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">validate</code>是验证用户名和密码的功能。</p><p id="9895" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">authenticate</code>是设定境界的对象。</p><p id="8192" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了添加基本的auth，我们调用了<code class="fe mt mu mv mj b">addHook</code>来添加一个钩子，在每个请求上用<code class="fe mt mu mv mj b">validate</code>检查用户名和密码。</p><p id="7178" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">任何在<code class="fe mt mu mv mj b">after</code>钩子中注册的路由都有基本授权保护。</p><p id="eed3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">validate</code>功能可以是异步的。</p><p id="949d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9d64" class="mn lc iq mj b gy mo mp l mq mr">const fastify = require('fastify')({<br/>  logger: true<br/>})</span><span id="d7a5" class="mn lc iq mj b gy ms mp l mq mr">const authenticate = {realm: 'Westeros'}<br/>fastify.register(require('fastify-basic-auth'), { validate, authenticate })</span><span id="85b7" class="mn lc iq mj b gy ms mp l mq mr">async function validate (username, password, req, reply) {<br/>  if (username !== 'foo' || password !== 'bar') {    <br/>    return new Error('invalid user')<br/>  }<br/>}</span><span id="8cf4" class="mn lc iq mj b gy ms mp l mq mr">fastify.after(() =&gt; {<br/>  fastify.addHook('onRequest', fastify.basicAuth)</span><span id="0b55" class="mn lc iq mj b gy ms mp l mq mr">  fastify.get('/', (req, reply) =&gt; {<br/>    reply.send({ hello: 'world' })<br/>  })<br/>})</span><span id="8276" class="mn lc iq mj b gy ms mp l mq mr">fastify.listen(3000, '0.0.0.0',  function (err, address) {<br/>  if (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>  fastify.log.info(`server listening on ${address}`)<br/>})</span></pre><p id="f88a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe mt mu mv mj b">validate</code>是异步的，那么我们就不需要调用<code class="fe mt mu mv mj b">done</code>。</p><p id="54ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以将它与<code class="fe mt mu mv mj b">onRequest</code>属性一起使用:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="be46" class="mn lc iq mj b gy mo mp l mq mr">const fastify = require('fastify')({<br/>  logger: true<br/>})</span><span id="6c4c" class="mn lc iq mj b gy ms mp l mq mr">const authenticate = { realm: 'Westeros' }<br/>fastify.register(require('fastify-basic-auth'), { validate, authenticate })<br/>async function validate (username, password, req, reply) {<br/>  if (username !== 'foo' || password !== 'bar') {<br/>    return new Error('invalid user')<br/>  }<br/>}</span><span id="86b3" class="mn lc iq mj b gy ms mp l mq mr">fastify.after(() =&gt; {<br/>  fastify.route({<br/>    method: 'GET',<br/>    url: '/',<br/>    onRequest: fastify.basicAuth,<br/>    handler: async (req, reply) =&gt; {<br/>      return { hello: 'world' }<br/>    }<br/>  })<br/>})</span><span id="ee71" class="mn lc iq mj b gy ms mp l mq mr">fastify.listen(3000, '0.0.0.0',  function (err, address) {<br/>  if (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>  fastify.log.info(`server listening on ${address}`)<br/>})</span></pre><p id="424d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">fastify.basicAuth</code>设置为<code class="fe mt mu mv mj b">onRequest</code>的值，以向我们的GET <code class="fe mt mu mv mj b">/</code>路由添加基本auth。</p><p id="a3c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以将它与<code class="fe mt mu mv mj b">fastify-auth</code>一起使用:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="08c6" class="mn lc iq mj b gy mo mp l mq mr">const fastify = require('fastify')({<br/>  logger: true<br/>})</span><span id="f851" class="mn lc iq mj b gy ms mp l mq mr">const authenticate = {realm: 'Westeros'}<br/>fastify.register(require('fastify-auth'))<br/>fastify.register(require('fastify-basic-auth'), { validate, authenticate })<br/>async function validate (username, password, req, reply) {<br/>  if (username !== 'foo' || password !== 'bar') {<br/>    return new Error('invalid user')<br/>  }<br/>}</span><span id="93ea" class="mn lc iq mj b gy ms mp l mq mr">fastify.after(() =&gt; {<br/>  fastify.addHook('preHandler', fastify.auth([fastify.basicAuth]))</span><span id="57a2" class="mn lc iq mj b gy ms mp l mq mr">fastify.route({<br/>    method: 'GET',<br/>    url: '/',<br/>    onRequest: fastify.auth([fastify.basicAuth]),<br/>    handler: async (req, reply) =&gt; {<br/>      return { hello: 'world' }<br/>    }<br/>  })<br/>})</span><span id="6d32" class="mn lc iq mj b gy ms mp l mq mr">fastify.listen(3000, '0.0.0.0',  function (err, address) {<br/>  if (err) {<br/>    fastify.log.error(err)<br/>    process.exit(1)<br/>  }<br/>  fastify.log.info(`server listening on ${address}`)<br/>})</span></pre><p id="877a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在GET <code class="fe mt mu mv mj b">/</code>路径的<code class="fe mt mu mv mj b">adfter</code>钩子和<code class="fe mt mu mv mj b">onRequest</code>属性中注册了基本的auth处理程序。</p><h1 id="d340" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b8a7" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">fastify-basic-auth库允许我们用几行代码将基本身份验证添加到fastify应用程序中。</p><p id="63b0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>