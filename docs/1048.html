<html>
<head>
<title>Medium-like text highlighting in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的中等文本高亮显示</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/medium-like-text-highlighting-in-react-afa35a29a81a?source=collection_archive---------3-----------------------#2021-03-05">https://javascript.plainenglish.io/medium-like-text-highlighting-in-react-afa35a29a81a?source=collection_archive---------3-----------------------#2021-03-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/b20b7ccc100bc2c148f334940d5a70c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoshlxvG2HFU7FnW10uFLA.jpeg"/></div></div></figure><div class=""/><p id="9bd9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是关于成长型工程师的系列文章中的另一篇。这篇特别的文章是关于通过拓宽漏斗底部的<a class="ae kt" href="https://pixelme.me/blog/marketing-funnel" rel="noopener ugc nofollow" target="_blank">(富博)</a>来增加客户参与度和忠诚度，这个术语经常被市场营销和销售团队使用，也是成长工程师日常工作的一部分。</p><p id="939b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">尽管客户获取是初创公司最关注的领域之一，但产品参与也同样重要。想想一个投资组合；你可以将所有资金投资于短期股票，获得即时流动性，或者投资于长期股票，获得更好的回报。然而，两者兼顾通常是更安全的选择。同样适用于产品。</p><p id="791d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们以Pokemon Go为例。它的用户获得速度很快，玩家一度痴迷于它，但仅此而已；他们的产品没有粘住。<a class="ae kt" href="https://openviewpartners.com/blog/how-to-build-stickiness-into-your-product" rel="noopener ugc nofollow" target="_blank">这里有一篇文章</a>，它很好地概述了如何在你的产品中建立粘性。</p><p id="7ade" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ROSS growth团队的任务是构建一个类似媒体的文本突出显示，以平衡用户获取和用户参与。以下是一些验证其重要性的客户请求:</p><blockquote class="ku kv kw"><p id="0d60" class="jv jw kx jx b jy jz ka kb kc kd ke kf ky kh ki kj kz kl km kn la kp kq kr ks ig bi translated">“你能突出一下吗？如果是的话，你可以用多种颜色突出显示吗？这将是一个伟大的设计特点”</p><p id="2a20" class="jv jw kx jx b jy jz ka kb kc kd ke kf ky kh ki kj kz kl km kn la kp kq kr ks ig bi translated">“…阅读案例时没有明显的手动突出显示功能。如果我发现一些我认为相关的文本，我需要能够突出显示它们。”</p></blockquote><p id="255f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是一个gif图，展示了在生产中使用的第一个中等大小的文本高亮显示。我已经写了我们如何使用我在<a class="ae kt" href="https://pargles.medium.com/technical-sushi-burrito-brief-4c6e5d4c3ba6" rel="noopener">这篇文章</a>中描述的不同方法来解决这个项目的评估。</p><figure class="lc ld le lf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lb"><img src="../Images/a05d9d46d9ce25533b694a1441fac9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*a_Re5vS6G_epk3b0b9ttSg.gif"/></div></div></figure><p id="6b68" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来的部分将提供该特性实现的技术概述和我们面临的挑战，以及一些可以作为灵感来源的文章链接。</p></div><div class="ab cl lg lh hr li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ig ih ii ij ik"><h2 id="b4ff" class="ln lo iy bd lp lq lr dn ls lt lu dp lv kg lw lx ly kk lz ma mb ko mc md me mf bi translated">注意事项和第一步</h2><p id="6385" class="pw-post-body-paragraph jv jw iy jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">需求被很好地定义，所以是时候评估它的实现了。但是首先，我们需要重新发明轮子吗？一定有React或JavaScript库为我们做这些，对吗？在这种情况下，不完全是。事实证明，这是一个具有挑战性的领域，与其他突出显示相关的功能(如语法突出显示)有交集。</p><p id="1828" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当专门搜索“中等文本突出显示”时，我们大多会找到引用浮动操作菜单的库和文章，这是它的一部分，第一部分，但不是全部。第二部分是最具挑战性的，其中关键词“内容选择和突出”产生更好的结果和灵感。</p><p id="13b8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们最终实现了浮动动作菜单和内容选择，并从头开始高亮显示。然而，提及我们在限时研究中的发现仍然是有价值的，因为如果您的团队需要构建类似的东西，它可能会成为灵感。此外，我将提供一些我们内部解决方案的代码片段。</p><h2 id="4371" class="ln lo iy bd lp lq lr dn ls lt lu dp lv kg lw lx ly kk lz ma mb ko mc md me mf bi translated">浮动操作菜单</h2><figure class="lc ld le lf gt ip gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/ad042462d0a7a629ccc3522986f6f538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*qXxLeZoAOMBwrkGYNg_jhQ.png"/></div></figure><p id="3934" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有几个JavaScript(如<a class="ae kt" href="https://github.com/aruminant/tinyq" rel="noopener ugc nofollow" target="_blank"> <strong class="jx iz"> TinyQ </strong> </a> <strong class="jx iz"> </strong>)和React(如<a class="ae kt" href="https://github.com/codeshifu/react-highlight-pop" rel="noopener ugc nofollow" target="_blank"><strong class="jx iz">React-highlight-pop</strong></a>)库提供了一个开箱即用的浮动动作菜单，但它们在行为和样式方面限制了我们可以做的事情。</p><p id="572b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在ROSS使用<a class="ae kt" href="https://styled-components.com/" rel="noopener ugc nofollow" target="_blank">样式化组件</a>(组件时代的CSS)实现了浮动动作菜单。为了获取文本及其在文档中的位置，我们使用了浏览器的<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/getSelection" rel="noopener ugc nofollow" target="_blank"><strong class="jx iz">window . get selection</strong></a><strong class="jx iz">，</strong>和一个名为<a class="ae kt" href="https://www.npmjs.com/package/xpath-range" rel="noopener ugc nofollow" target="_blank"> xpath-range </a>的库。这个库以XPath格式为我们提供了高亮文本的路径，比如div[2]/p[7]/text[1]，这意味着第二个div、第七个段落和第一个文本块。文本部分可以有多个索引，因为其他HTML标记将文本分割成一个部分，如超链接和粗体。Xpath还提供了开始和结束偏移量，允许高亮显示的文本在以该格式加载后重新创建。</p><pre class="lc ld le lf gt mm mn mo mp aw mq bi"><span id="54dd" class="ln lo iy mn b gy mr ms l mt mu">npm install xpath-range</span></pre><p id="51ce" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的代码片段提供了三个函数:</p><ol class=""><li id="9814" class="mv mw iy jx b jy jz kc kd kg mx kk my ko mz ks na nb nc nd bi translated"><strong class="jx iz"> getSelection() </strong>:它返回关于被选中文本的元数据。点击可以了解更多关于<strong class="jx iz">window . get selection</strong>T24】的信息</li><li id="a610" class="mv mw iy jx b jy ne kc nf kg ng kk nh ko ni ks na nb nc nd bi translated"><strong class="jx iz">getxpath parameters(xpath)</strong>:这个函数返回选择的XPath、开始和结束偏移量，如上所述。</li><li id="50a9" class="mv mw iy jx b jy ne kc nf kg ng kk nh ko ni ks na nb nc nd bi translated"><strong class="jx iz">onHighlightAction(params)</strong>:我们正在使用redux，所以这个<a class="ae kt" href="https://redux-saga.js.org/docs/introduction/BeginnerTutorial.html" rel="noopener ugc nofollow" target="_blank">动作</a>将构建一个高亮类型的注释对象，而<a class="ae kt" href="https://redux-saga.js.org/docs/basics/DispatchingActions.html" rel="noopener ugc nofollow" target="_blank">将调度</a>一个<strong class="jx iz"> saveUserUserAnnotation </strong>将元数据保存到数据库中(更多细节将在数据库模型会话中介绍)。然后，一旦用户再次刷新或加载该页面，该元数据将用于重建高亮显示的文本。</li></ol><figure class="lc ld le lf gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="9e12" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还应该考虑存储文本本身，以便在HTML发生变化时可以进行模糊匹配作为后备。为了更安全，您还可以保留两个单词，继续进行选择，以覆盖突出显示单个单词的边缘情况，在这种情况下，模糊匹配将无助于重新创建选择。</p><h2 id="4ce6" class="ln lo iy bd lp lq lr dn ls lt lu dp lv kg lw lx ly kk lz ma mb ko mc md me mf bi translated">内容选择和突出显示</h2><figure class="lc ld le lf gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nl"><img src="../Images/e16f8f9be8f48c61714667add0ebf6bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiN9PVX6DGsHLN0Ed0lq_w.png"/></div></div></figure><p id="71e3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最具挑战性的部分来了，一旦我们有了xpath，我们如何动态地将文本包装在设置了不同背景颜色的类周围？知道我们还可以在文档打开后重建所有保存的精彩部分。</p><p id="ca45" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">事实证明，没有多少图书馆可以为我们做这件事。“10个文本荧光笔JavaScript库”博客文章是一个好的开始，JavaScript文本荧光笔库(<a class="ae kt" href="https://github.com/mir3z/texthighlighter" rel="noopener ugc nofollow" target="_blank"> Github </a>，<a class="ae kt" href="http://mir3z.github.io/texthighlighter/demos/simple.html" rel="noopener ugc nofollow" target="_blank">演示链接</a>)似乎非常适合我们。不幸的是，它对我们的用例不起作用。</p><div class="im in gp gr io nm"><a href="https://bashooka.com/coding/text-highlighter-javascript-libraries/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iz gy z fp nr fr fs ns fu fw ix bi translated">10个文本荧光笔Javascript库</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">因此，这里有10个最好的文字荧光笔Javascript库，让你突出显示特定的文本，添加搜索关键字…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">bashooka.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa iu nm"/></div></div></a></div><p id="880b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我们最终也通过利用另一个名为<a class="ae kt" href="https://github.com/wrakky/react-html-parser#readme" rel="noopener ugc nofollow" target="_blank"><strong class="jx iz">react-html-parser</strong></a><strong class="jx iz">:</strong>的库从头开始构建文本高亮显示逻辑</p><pre class="lc ld le lf gt mm mn mo mp aw mq bi"><span id="0c5d" class="ln lo iy mn b gy mr ms l mt mu">npm install react-html-parser</span></pre><p id="e277" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的代码片段提供了它如何工作的高级概述。它允许我们预处理<strong class="jx iz">用户注释</strong>(以及其他注释，如<strong class="jx iz">脚注</strong>和系统<strong class="jx iz">段落</strong>)列表，并在它们周围包装React组件，以便<strong class="jx iz">reacttmlparser</strong>可以获取原始HTML并将其转换为React组件。这就是总体思路，也是用highlightedText组件包装文本的逻辑所在。</p><figure class="lc ld le lf gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="4ef8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">高亮本身带来了几个挑战，因为你的HTML可能会包含其他标签，如<strong class="jx iz"> &lt; a href=""/ &gt; </strong>和bold<strong class="jx iz">&lt;b&gt;bold&lt;/b&gt;</strong>标签，所以你必须决定是否要为每个单词添加一个高亮类，或者将它分解成文本块并给它们一个CSS类。下面的帖子(“如何让用户突出你的HTML”)很好地涵盖了每种方法的利弊。</p><div class="im in gp gr io nm"><a href="https://blog.emumba.com/how-to-let-users-highlight-your-html-c1013abf68fb" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iz gy z fp nr fr fs ns fu fw ix bi translated">如何让用户突出你的HTML？</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">Medium已经成为一个非常受欢迎的博客有一段时间了，现在仍然如此。我被介绍到这个博客已经两个月了…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">blog.emumba.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa iu nm"/></div></div></a></div><h2 id="f298" class="ln lo iy bd lp lq lr dn ls lt lu dp lv kg lw lx ly kk lz ma mb ko mc md me mf bi translated">数据库模型</h2><p id="2803" class="pw-post-body-paragraph jv jw iy jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">很好，我们对前端是如何工作的有了一个大致的概念，但是后端呢？最能代表文本高亮的方式是什么？我们将该模型称为用户注释，因为它可以增长到用户评论和用户共享，使其可扩展，即使它目前只是文本高亮显示。我们还选择使用非SQL数据库(<a class="ae kt" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> AtlasDB </a>)，因为它是可伸缩的，是文本存储的完美用例。我们决定遵循<a class="ae kt" href="https://www.w3.org/TR/annotation-model/" rel="noopener ugc nofollow" target="_blank"> Web注释数据模型</a> (W3C)格式。</p><p id="3394" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是保存到数据库的数据的示例。正如你所看到的，我们使用了两个W3C选择器，一个是<strong class="jx iz"> W3CRangeSelector </strong>，然后由前端使用它来重新创建一个高亮显示的文本，另一个是<strong class="jx iz"> W3CTextQuoteSelector </strong>，作为将来HTML发生变化时的后备选择。</p><pre class="lc ld le lf gt mm mn mo mp aw mq bi"><span id="9323" class="ln lo iy mn b gy mr ms l mt mu">{<br/>  "_id": "ac93635f-689d-4d8b-a17b-3e8786b943f8",<br/>  "ownerId": "usr-4d0ee82b-b095-4a8d-8df0-d812c3ad2461",<br/>  "createdAt": 1607511518406,<br/>  "lastModified": 1607511518406,<br/>  "w3cAnnotation": {<br/>    "type": "Annotation",<br/>    "body": [<br/>      {<br/>        "type": "TextualBody",<br/>        "value": null,<br/>        "jsonValue": {<br/>          "meta": {<br/>            "color": "yellow"<br/>          }<br/>        },<br/>        "id": null,<br/>        "format": "application/vnd.ross.user-highlight-meta.v1+json"<br/>      }<br/>    ],<br/>    "target": {<br/>      "type": "W3CWebAnnotation",<br/>      "source": "decision:13349956",<br/>      "selector": [<br/>        {<br/>          "__typename": "W3CTextQuoteSelector",<br/>          "exact": "\"An action to enforce an affidavit of support . . . may be brought against a sponsor in any appropriate court.\" 8 U.S.C. 1183a(e). However, a trial court's judgment must be supported by the pleadings. Tex.R.Civ.P. 301.",<br/>          "type": "TextQuoteSelector"<br/>        },<br/>        {<br/>          "endOffset": 89,<br/>          "startOffset": 1,<br/>          "__typename": "W3CRangeSelector",<br/>          "endContainer": "/div[2]/div[3]/p[4]/text[2]",<br/>          "type": "RangeSelector",<br/>          "startContainer": "/div[2]/div[3]/p[4]/text[1]"<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><p id="d935" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望你喜欢这篇文章！祝您愉快！</p></div></div>    
</body>
</html>