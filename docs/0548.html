<html>
<head>
<title>Handle Integration and Production Deployments for Nuxt.js Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理Nuxt.js应用的集成和生产部署</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integration-and-production-deployment-for-nuxt-js-applications-amazing-scalable-and-configurable-7ea64bea77cc?source=collection_archive---------7-----------------------#2021-02-02">https://javascript.plainenglish.io/integration-and-production-deployment-for-nuxt-js-applications-amazing-scalable-and-configurable-7ea64bea77cc?source=collection_archive---------7-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1d24172a0d1031493d75a1785f1548be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m1ZrFV72mHVLacZ2"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Let’s build together — <a class="ae kc" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/</a></figcaption></figure><blockquote class="kd ke kf"><p id="72c6" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">本文主要关注Nuxt SSR应用程序的部署。但是这项技术可以在部署过程中用于任何类型的应用程序。</p></blockquote><p id="fd4b" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">首先在现实世界的部署过程中，我们需要测试是否一切都按预期运行。这就是为什么我们需要一种更加<strong class="kj ir">健壮</strong>和<strong class="kj ir">可扩展</strong>的方式来部署、测试，然后将一切发送到生产现场。</p><p id="0230" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">首先，如果你没有阅读前一篇文章，我强烈推荐<a class="ae kc" href="https://medium.com/js-dojo/how-to-deploy-nuxt-application-to-server-production-mode-on-db67633421fd?sk=32e2893ad759748e88cdaf7ecbf0b250" rel="noopener">在这里阅读</a>，因为我将在接下来的步骤中使用相同的应用程序。好了，让我们开始部署我们的应用程序吧。最终，我们的流程将会如下图所示:</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi li"><img src="../Images/03005b737243647aa27d664e94485c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_Om0Y3huJ9VRPulCOz4bQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Application deployment cycle</figcaption></figure><p id="f25c" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">最初，我们需要在服务器上创建<strong class="kj ir">集成</strong>和<strong class="kj ir">生产</strong>文件夹。所以我打开一个终端，连接到我的服务器<em class="ki">(换成你的IP或者连接你现有的服务。这里我用</em> <a class="ae kc" href="https://m.do.co/c/460c21eea24d" rel="noopener ugc nofollow" target="_blank"> <em class="ki">数字海洋</em> </a> <em class="ki"> ) </em>:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="a33d" class="ls lt iq lo b gy lu lv l lw lx">ssh root@<strong class="lo ir">64.225.8.116</strong> //<strong class="lo ir">your Droplet IP address here.</strong></span></pre><p id="5c54" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">然后，我们需要更改当前目录，并为我们的应用程序创建文件夹。<strong class="kj ir"> <em class="ki">如果你想要一个单行的解决方案，立即应用第6步:)</em> </strong></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="64a3" class="ls lt iq lo b gy lu lv l lw lx">1. cd /var/www<br/>2. mkdir my_app<br/>3. cd my_app<br/>4. mkdir prod.app //for production only<br/>5. mkdir int.app //testing new features before production<br/>6. cd /var/www &amp;&amp; mkdir my_app &amp;&amp; cd /var/www/my_app &amp;&amp; mkdir prod.app &amp;&amp; mkdir int.app</span></pre><p id="0393" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们的两个文件夹已经可以部署了。然后我们需要在我们的应用程序<em class="ki">中<strong class="kj ir">初始化git </strong>(如果你从未使用过git，请在你的系统中安装它，并学习如何使用它。</em> <a class="ae kc" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank"> <em class="ki">这里是所有系统下载的链接</em> </a> <em class="ki"> ) </em>。我们不会每次都做推拉循环。稍后我会向<strong class="kj ir">展示一个简单有效的</strong>方法。但是现在要确保git已经在应用程序源代码中初始化了。您可以在您的<strong class="kj ir">项目根目录</strong>中运行这个命令来测试它:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="99a3" class="ls lt iq lo b gy lu lv l lw lx">1. cd ~/Desktop/my-app //your app root<br/>2. git branch </span></pre><p id="7465" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">如果你看到<strong class="kj ir">不是git库错误</strong>在项目根文件夹中运行这个命令<strong class="kj ir">否则继续下一步:</strong></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="8532" class="ls lt iq lo b gy lu lv l lw lx">git init //initialize <br/>git add . //add everything into git<br/>git commit -m "first commit" //just commit initial data</span></pre><blockquote class="kd ke kf"><p id="ec69" class="kg kh ki kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我们不需要向Github推送任何东西。但是如果有兴趣我会分享源代码。<a class="ae kc" href="https://github.com/Abdulla1995/my-simple-app" rel="noopener ugc nofollow" target="_blank">你可以从这里进入。</a></p></blockquote><p id="f0e7" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在我们准备在服务器上配置git，并把它推到我们的集成和生产文件夹中。使用终端登录服务器，首先执行以下步骤<strong class="kj ir">进行生产发布</strong><em class="ki">(如果git </em>由于某种原因在您的服务器中不存在<em class="ki">，请首先安装它，然后执行以下步骤</em>:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b06a" class="ls lt iq lo b gy lu lv l lw lx">1. cd /var &amp;&amp; mkdir repo &amp;&amp; cd repo &amp;&amp; mkdir production.git &amp;&amp; cd production.git &amp;&amp; git init --bare &amp;&amp; cd hooks</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ly"><img src="../Images/067821d580f378ba33e4da7c1a78c855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5ei7WxVDn6T5s5hOXc62g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">command success info</figcaption></figure><p id="bc83" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们已经创建了一个空的git库来接受本地推送。然后，我们将使用<strong class="kj ir"> git挂钩</strong>来正确执行工作流:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="24cb" class="ls lt iq lo b gy lu lv l lw lx">2. nano post-receive<br/>3. Add the following into opened file<br/>git --work-tree=<strong class="lo ir">/var/www/my_app/prod.app</strong> --git-dir=<strong class="lo ir">/var/repo/production.git</strong> checkout -f<br/>4. Ctrl + X and type 'Y' then hit Enter to save the file</span></pre><p id="53b8" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们使用<strong class="kj ir"> git post-receive hook </strong>来立即接受推送的文件，并将它们直接复制到生产应用程序方向。<em class="ki">(git—work-tree =/var</em><strong class="kj ir"><em class="ki">/www/my _ app/prod . app</em></strong><em class="ki">)。</em>最后，我们需要给git文件权限，以便顺利完成操作:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="cd27" class="ls lt iq lo b gy lu lv l lw lx">5. chmod +x post-receive<br/>6. chown -R :www-data /var/www/my_app/prod.app //give permission to accepting folder also.</span></pre><p id="8f46" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在，我们的服务器已经准备好接受生产服务器上推送的文件。接下来，在您的本地计算机中打开项目根目录，并键入以下命令来创建远程生产源(<strong class="kj ir"> <em class="ki">将IP更改为您的)</em> </strong>):</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="8979" class="ls lt iq lo b gy lu lv l lw lx">1. git remote add production ssh://root@<strong class="lo ir">64.225.8.116</strong>/var/repo/production.git<br/>2. git push production //pushes to the server</span></pre><p id="8ef6" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">如果一切正常，您将在服务器上的<strong class="kj ir"> prod.app </strong>目录中看到生产文件。运行prod.app目录中的下一个命令以确保:)</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="e0bb" class="ls lt iq lo b gy lu lv l lw lx">ls -l // listing all files </span></pre><p id="ddf5" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们的文件在那里，我们准备在服务器上运行生产应用程序。<em class="ki">如果您来自上一篇文章，并且已经在后台运行app，请将其从</em><a class="ae kc" href="https://www.npmjs.com/package/pm2" rel="noopener ugc nofollow" target="_blank"><em class="ki">PM2</em></a><em class="ki">中删除，因为我们将使用最新的:</em></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="0564" class="ls lt iq lo b gy lu lv l lw lx">pm2 list // to see if the application running <br/>pm2 delete npm //npm is the name we gave it</span></pre><p id="1023" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">好了，让我们安装npm包并构建应用程序，看看是否一切正常。在prod.app根文件夹中运行以下命令:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b28b" class="ls lt iq lo b gy lu lv l lw lx">npm install &amp;&amp; npm run build &amp;&amp; npm run start //install, build, run</span></pre><p id="c65c" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">安装后，您可以通过在任何浏览器上输入您的IP地址来确认应用程序是否正常工作(<em class="ki">如果您没有进行Nginx配置，应用程序将无法工作。请阅读</em> <a class="ae kc" href="https://medium.com/js-dojo/how-to-deploy-nuxt-application-to-server-production-mode-on-db67633421fd?source=friends_link&amp;sk=32e2893ad759748e88cdaf7ecbf0b250" rel="noopener"> <em class="ki">上一篇</em> </a> <em class="ki"> </em>并做配置)。</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/dbaf6f24520d3fb6cacfb3e52c7b8962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBvo3k2_IzZ1pNQqqF4CDQ.png"/></div></div></figure><p id="c089" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在，让我们关闭应用程序并继续分离<strong class="kj ir">集成</strong>和<strong class="kj ir">生产</strong>构建。首先，我们需要添加“.env”文件放在我们的应用程序根文件夹中。因为。环境文件被忽略。g itignore“我们也创建“. env.sample”并将其添加到git中，并且不在其中添加机密信息。在您喜欢的代码编辑器中打开项目并创建这些文件<strong class="kj ir"> <em class="ki"> (.env.sample文件)</em> </strong> <em class="ki"> : </em></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="4478" class="ls lt iq lo b gy lu lv l lw lx">APP_NAME="App name here"<br/>PORT=3000<br/>HOST="localhost"<br/>BASE_URL="http://"</span></pre><p id="b835" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">然后将这个文件复制粘贴到根目录下。env或创建一个新的并给它一个名字”。env”。我们在端口<strong class="kj ir"> 3000 </strong>上使用生产，稍后在<strong class="kj ir"> 3100 </strong>上集成:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="7efe" class="ls lt iq lo b gy lu lv l lw lx"><strong class="lo ir">APP_NAME="My-app"</strong><br/>PORT=<strong class="lo ir">3000</strong><br/>HOST="localhost"<br/><strong class="lo ir">BASE_URL="http://localhost:3000"</strong></span></pre><p id="7964" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">然后打开nuxt.config.js文件，将下面几行添加到配置对象的顶部:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b264" class="ls lt iq lo b gy lu lv l lw lx">server: {<br/>  port: <em class="ki">process</em>.env.PORT, //take port from .env file automatically Thanks to NUXT<br/>},</span><span id="36b6" class="ls lt iq lo b gy ma lv l lw lx">//Also edit the title in head section to be sure .env is affecting on site title<br/>head {<br/>    title: <strong class="lo ir"><em class="ki">process</em></strong>.env.APP_NAME,<br/>...</span></pre><p id="5cb3" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在，如果您想确保可以通过更改端口号在本地运行应用程序。但是请记住，如果您在。环境文件。</p><p id="d279" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">接下来，我们将添加<strong class="kj ir">生态系统. config.js.sample </strong>文件，使用更加灵活的<a class="ae kc" href="https://www.npmjs.com/package/pm2" rel="noopener ugc nofollow" target="_blank"> pm2 </a>功能在后台运行我们的应用程序。创建文件并添加以下行:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="2241" class="ls lt iq lo b gy lu lv l lw lx">module.exports = {<br/>    apps: [<br/>        {<br/>            name: '<strong class="lo ir">app_running_name</strong>',<br/>            exec_mode: 'cluster',<br/>            <strong class="lo ir">instances: '2'</strong>, // Or "max" - for maximum available of     instances<br/>            script: './node_modules/nuxt/bin/nuxt.js',<br/>            args: 'start'<br/>        }<br/>    ]<br/>}</span></pre><p id="1314" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">您可以在pm2和Nuxt站点上了解更多有关设置的信息。我们将运行2个实例，发布版本的名称将会更改。然后向git添加新文件，并将它们推送到我们的生产服务器。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="f962" class="ls lt iq lo b gy lu lv l lw lx">1. git add --all<br/>2. git commit -m "added .env and pm2 config file"<br/>3. git push production</span></pre><p id="63d8" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">每个提交的更改都在我们的服务器上:)让我们打开服务器终端，确保我们的文件在那里。在prod.app根文件夹中运行命令:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="6e34" class="ls lt iq lo b gy lu lv l lw lx">ls -al // to see hidden .env.sample added - a</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/4b3b55ad68d33cbb072de631003b6702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*cxjQkTEilUqWzA3StBwIMg.png"/></div></figure><p id="01e9" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">如果看到新文件，最后一步是将. env.sample复制为。环境和编辑一点。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="0e40" class="ls lt iq lo b gy lu lv l lw lx">1. cp .env.sample .env<br/>2. nano .env<br/>3. Editing a little<br/>APP_NAME=<strong class="lo ir">"My production app"</strong><br/>PORT=3000<br/>HOST="localhost"<br/>BASE_URL=<strong class="lo ir">"http://localhost:3000"<br/></strong>4. Ctrl + X and Y and hit enter to save the edited file<br/>5. npm run build</span><span id="5241" class="ls lt iq lo b gy ma lv l lw lx">//Also need to copy ecosystem and set it <br/>1. cp ecosystem.config.js.sample ecosystem.config.js<br/>2. nano ecosystem.config.js<br/>3. Change as below<br/>module.exports = {<br/>  apps: [<br/>    {<br/>      name: <strong class="lo ir">'prod.app',</strong><br/>      exec_mode: 'cluster',<br/>      instances: '2', // Or "max" - for maximum available of instances<br/>      script: './node_modules/nuxt/bin/nuxt.js',<br/>      args: 'start'<br/>    }<br/>  ]<br/>}<br/>4. Ctrl + X and Y and hit enter to save the edited file.</span></pre><p id="c400" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们已经建立了应用程序，我们准备在后台运行应用程序。Pm2将帮助我们<em class="ki">(该命令自动运行生态系统配置文件)。</em> <strong class="kj ir">如果没有配置Nginx反向代理，app不会运行。请阅读</strong> <a class="ae kc" href="https://medium.com/js-dojo/how-to-deploy-nuxt-application-to-server-production-mode-on-db67633421fd?sk=32e2893ad759748e88cdaf7ecbf0b250" rel="noopener"> <strong class="kj ir">上一篇</strong> </a> <strong class="kj ir">正确配置。</strong></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="77ad" class="ls lt iq lo b gy lu lv l lw lx">pm2 start</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/4551840427a60dab3688e806882a7b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tn_dlKPICgrF_NZ3h0ZaJA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Running cluster mode pm2 application</figcaption></figure><p id="0655" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">刷新浏览器，您将看到标题更改为我们在。环境应用程序名称部分:</p><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/5417dda7880cd3e604d6482ad46abcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*3zDkaI6DTEUfOtrHe9D65g.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Title edited</figcaption></figure><p id="d61d" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">因此，我们的生产应用程序在两个实例上以<strong class="kj ir">集群</strong>模式完美运行。我们可以通过键入以下命令在新构建完成后重新加载应用程序:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="3819" class="ls lt iq lo b gy lu lv l lw lx">pm2 reload prod.app //the reloaded app name must be correct.</span></pre><p id="c86f" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在，我们知道了如何直接部署到服务器并运行生产环境。让我们开始我们的分离目标，也就是集成，并部署它。我们将迅速增加一个整合分支机构。会有细微的差别，但一般来说，过程是相同的。所以我会加快步伐。配置服务器:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="413b" class="ls lt iq lo b gy lu lv l lw lx">1. cd /var/repo &amp;&amp; mkdir integration.git &amp;&amp; cd <strong class="lo ir">integration</strong>.git &amp;&amp; git init --bare &amp;&amp; cd hooks<br/>2. nano post-receive<br/>3. Insert below line into opened file. (added integration to the end)<br/>git --work-tree=/var/www/my_app/<strong class="lo ir">int.app</strong> --git-dir=/var/repo/integration.git checkout -f <strong class="lo ir">integration<br/></strong>4. Ctrl + X and type 'y' and hit Enter<br/>5. chmod +x post-receive<br/>6. chown -R :www-data /var/www/my_app/int.app //give permission to accepting folder also.</span></pre><p id="4bc6" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">我们的服务器已经准备好接受集成推送。现在打开本地项目，并在终端中运行以下命令:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="2a73" class="ls lt iq lo b gy lu lv l lw lx">1. git remote add integration ssh://root@<strong class="lo ir">64.225.8.116</strong>/var/repo/integration.git<br/>2. git branch integration &amp;&amp; git checkout integration<br/>3. git push integration</span></pre><p id="fd23" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在转到服务器终端中的<strong class="kj ir"> int.app </strong>目录，然后ls查看是否所有内容都在那里:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="936a" class="ls lt iq lo b gy lu lv l lw lx">cd /var/www/my_app/int.app &amp;&amp; ls -al</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/a28893b710e290e23ce070c91561b712.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*xyUppjtW43xm7FtdsC9UbQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">integration files</figcaption></figure><p id="7dc9" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在我们需要创造。env并将端口更改为另一个数字，以用于测试目的。复制. env.sample并将端口号更改为<strong class="kj ir"> 3100 </strong> <em class="ki">(如果端口空闲，可以是任何数字):</em></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="6fed" class="ls lt iq lo b gy lu lv l lw lx">1.cp .env.sample .env &amp;&amp; nano .env<br/>2. Change as below<br/>APP_NAME=<strong class="lo ir">"Integration application"</strong><br/>PORT=<strong class="lo ir">3100</strong><br/>HOST="localhost"<br/>BASE_URL="http://localhost:3100"<br/>3. Ctrl + X and type 'y' and hit Enter to save edits.<br/>4. npm install<br/>5. npm run build</span></pre><p id="dd36" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">现在我们的应用程序已经构建好了，可以在端口号为3100的端口上运行了。让我们运行我们的应用程序。命令是相同的，将使用配置:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="c18e" class="ls lt iq lo b gy lu lv l lw lx">1. cp ecosystem.config.js.sample ecosystem.config.js<br/>2. nano ecosystem.config.js<br/>3. Change as below<br/>module.exports = {<br/>  apps: [<br/>    {<br/>      name: <strong class="lo ir">'int.app',</strong><br/>      exec_mode: 'cluster',<br/>      instances: '2', // Or "max" - for maximum available of instances<br/>      script: './node_modules/nuxt/bin/nuxt.js',<br/>      args: 'start'<br/>    }<br/>  ]<br/>}<br/>4. Ctrl + X and Y and hit enter to save the edited file.<br/>5. pm2 start</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/997d756063c7def178ffdd5d16d00bc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PomvD1WaOwYK_VhIYW3C_w.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">showing both int and prod apps</figcaption></figure><p id="e0ee" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">最后，我们需要设置<strong class="kj ir"> Nginx </strong>监听外部<strong class="kj ir"> 3101 </strong>端口，并将其重定向到<strong class="kj ir">3100</strong>端口，我们的集成应用程序正在该端口上运行:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="341a" class="ls lt iq lo b gy lu lv l lw lx">1. cd /etc/nginx/sites-available/<br/>2. There will be my.app file which created in the previous article. We will copy and edit it a bit - or jump 3rd step<br/><strong class="lo ir">cp my.app int.app</strong><br/>3. <strong class="lo ir">nano int.app</strong>  - then change it as below:<br/>server {<br/>    listen <strong class="lo ir">3101</strong>;<br/>    server_name 64.225.8.116; #<strong class="lo ir">droplet IP here<br/></strong><br/>    location / {<br/>        proxy_pass http://localhost:<strong class="lo ir">3100</strong>;<br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection 'upgrade';<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>    }<br/>}<br/>4. Ctrl + X and Y and hit enter to save the edited file. <br/>5. ln -s /etc/nginx/sites-available/int.app /etc/nginx/sites-enabled<br/>6. nginx -t  // if ok then restarting nginx server<br/>7. service nginx restart</span></pre><figure class="lj lk ll lm gt jr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/56dd446cfb8b2dfc23cada83511c8655.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*xBmb_21AcXWQqj7tckIisg.png"/></div></figure><p id="eb40" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">就这些！</strong>我们的生产和集成应用程序是分开运行的。转到浏览器中的链接并检查它。我的是-<a class="ae kc" href="http://64.225.8.116:3101/" rel="noopener ugc nofollow" target="_blank"><strong class="kj ir">http://64.225.8.116:3101/</strong></a></p><p id="8211" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">如果您有任何<strong class="kj ir">域</strong>，您可以使用一个子域作为测试环境。那么Nginx配置将如下所示:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b9c5" class="ls lt iq lo b gy lu lv l lw lx">//integration<br/>server {<br/>    listen 80;<br/>    server_name <strong class="lo ir">int.yourdomain.com</strong>; #subdomain here<br/><br/>    location / {<br/>        <strong class="lo ir">proxy_pass http://localhost:3100;</strong><br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection 'upgrade';<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>    }<br/>}</span><span id="fe39" class="ls lt iq lo b gy ma lv l lw lx">//production<br/>server {<br/>    listen 80;<br/>    server_name <strong class="lo ir">yourdomain.com</strong>; #domain here<br/><br/>    location / {<br/>        <strong class="lo ir">proxy_pass http://localhost:3000;</strong><br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection 'upgrade';<br/>        proxy_set_header Host $host;<br/>        proxy_cache_bypass $http_upgrade;<br/>    }<br/>}</span></pre><h1 id="e292" class="mg lt iq bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated"><strong class="ak">结论</strong></h1><p id="b158" class="pw-post-body-paragraph kg kh iq kj b kk nd km kn ko ne kq kr lf nf ku kv lg ng ky kz lh nh lc ld le ij bi translated">我已经谈到了我在测试和部署Nuxt应用程序到服务器时使用它的方式。这个版本部署最适合Nuxt SSR模式，它根据每个请求动态生成站点内容。稍后我还将写一篇文章来演示如何为Nuxt生成模式设置configure静态生成内容。将会有一些配置编辑，但过程基本相同。希望你在阅读的时候喜欢它。</p><p id="294b" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">好的编码日:)</p><p id="f9ec" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated"><strong class="kj ir">有用链接:</strong></p><p id="2ebe" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">1 .Pm2文档—<a class="ae kc" href="https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/" rel="noopener ugc nofollow" target="_blank">https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/</a></p><p id="9e1a" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">2.Nuxt部署—<a class="ae kc" href="https://nuxtjs.org/docs/2.x/get-started/commands/" rel="noopener ugc nofollow" target="_blank">https://nuxtjs.org/docs/2.x/get-started/commands/</a></p><p id="41fb" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">3.本文准备项目—<a class="ae kc" href="https://github.com/Abdulla1995/my-simple-app" rel="noopener ugc nofollow" target="_blank">https://github.com/Abdulla1995/my-simple-app</a></p><p id="c618" class="pw-post-body-paragraph kg kh iq kj b kk kl km kn ko kp kq kr lf kt ku kv lg kx ky kz lh lb lc ld le ij bi translated">4.通过注册此链接获得100美元的数字海洋免费积分—<a class="ae kc" href="https://m.do.co/c/460c21eea24d" rel="noopener ugc nofollow" target="_blank">https://m.do.co/c/460c21eea24d</a></p></div></div>    
</body>
</html>