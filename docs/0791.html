<html>
<head>
<title>Deno — OS Signals, File System Events, and Module Metadata</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno —操作系统信号、文件系统事件和模块元数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deno-os-signals-file-system-events-and-module-metadata-978702914dc1?source=collection_archive---------10-----------------------#2021-02-18">https://javascript.plainenglish.io/deno-os-signals-file-system-events-and-module-metadata-978702914dc1?source=collection_archive---------10-----------------------#2021-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8baf58271e9d2618a8aca42b3944c101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mV9xMPgII_h_t8ly"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@zeketucker?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Zeke Tucker</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="41be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deno是一个新的服务器端运行时环境，用于运行JavaScript和TypeScript应用程序。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始为Deno开发应用程序。</p><h1 id="f9e9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">处理操作系统信号</h1><p id="aa10" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">Deno.signal</code>方法处理信号。</p><p id="7477" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="1ee8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="bff4" class="mq lc iq mh b gy mr ms l mt mu">console.log("Press Ctrl-C");<br/>for await (const _ of Deno.signal(Deno.Signal.SIGINT)) {<br/>  console.log("interrupted!");<br/>  Deno.exit();<br/>}</span></pre><p id="fc83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们按Ctrl+C，我们将触发<code class="fe me mf mg mh b">sigint</code>信号来中断程序。</p><p id="6c2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用for-await-of循环来观察信号。</p><p id="1b63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Deno.Signal.SIGINT</code>是<code class="fe me mf mg mh b">sigint</code>信号的对象。</p><p id="d29e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">Deno.exit</code>退出程序。</p><p id="c538" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过运行以下命令来运行程序:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9e36" class="mq lc iq mh b gy mr ms l mt mu">deno run --unstable index.ts</span></pre><p id="3a55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还有，我们可以把它写成承诺。</p><p id="a969" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="1837" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="efd6" class="mq lc iq mh b gy mr ms l mt mu">console.log("Press Ctrl-C to end the program");<br/>await Deno.signal(Deno.Signal.SIGINT);<br/>console.log("interrupted!");<br/>Deno.exit();</span></pre><p id="4796" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">观察<code class="fe me mf mg mh b">sigint</code>信号。</p><h1 id="0ce9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">停止观察信号</h1><p id="3809" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过调用<code class="fe me mf mg mh b">sig.dispose</code>方法来停止观察信号。</p><p id="59ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="43f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="081b" class="mq lc iq mh b gy mr ms l mt mu">const sig = Deno.signal(Deno.Signal.SIGINT);<br/>setTimeout(() =&gt; {<br/>  sig.dispose();<br/>  console.log("No longer watching SIGINT signal");<br/>}, 5000);</span><span id="23e6" class="mq lc iq mh b gy mv ms l mt mu">console.log("Watching SIGINT signals");<br/>for await (const _ of sig) {<br/>  console.log("interrupted");<br/>}</span></pre><p id="1941" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">setTimeout</code>回调。我们调用<code class="fe me mf mg mh b">sig.dispose</code>方法来停止观察<code class="fe me mf mg mh b">sigint</code>信号。</p><p id="a576" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">调用<code class="fe me mf mg mh b">sig.dispose</code>时，for-await-of循环在5秒后退出。</p><h1 id="42b4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">文件系统事件</h1><p id="6725" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">Deno.watchFs</code>方法观察文件系统事件。</p><p id="0681" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="6f47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="cb27" class="mq lc iq mh b gy mr ms l mt mu">const watcher = Deno.watchFs(".");<br/>for await (const event of watcher) {<br/>  console.log(event);<br/>}</span></pre><p id="e3e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">Deno.watchFs</code>观看脚本所在的文件夹。</p><p id="fb6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">event</code>对象中获取事件。</p><p id="d98c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们就像这样:</p><p id="405c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6556" class="mq lc iq mh b gy mr ms l mt mu">{ kind: "create", paths: [ "/home/runner/IntelligentWorthwhileMice/./lock.json" ] }<br/>{ kind: "modify", paths: [ "/home/runner/IntelligentWorthwhileMice/./lock.json" ] }<br/>{ kind: "access", paths: [ "/home/runner/IntelligentWorthwhileMice/./lock.json" ] }<br/>{<br/>  kind: "create",<br/>  paths: [ "/home/runner/IntelligentWorthwhileMice/./.3s18gah600nwj.foo.txt~" ]<br/>}<br/>{<br/>  kind: "access",<br/>  paths: [ "/home/runner/IntelligentWorthwhileMice/./.3s18gah600nwj.foo.txt~" ]<br/>}<br/>{<br/>  kind: "modify",<br/>  paths: [ "/home/runner/IntelligentWorthwhileMice/./.3s18gah600nwj.foo.txt~" ]<br/>}<br/>{ kind: "modify", paths: [ "/home/runner/IntelligentWorthwhileMice/./foo.txt" ] }<br/>{<br/>  kind: "modify",<br/>  paths: [<br/>    "/home/runner/IntelligentWorthwhileMice/./.3s18gah600nwj.foo.txt~",<br/>    "/home/runner/IntelligentWorthwhileMice/./foo.txt"<br/>  ]<br/>}</span></pre><p id="bc87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已显示。</p><p id="f704" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以运行它:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="de26" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-read index.ts</span></pre><p id="39d0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">监视文件夹中的任何文件系统事件。</p><h1 id="001e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模块元数据</h1><p id="d833" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">import.meta</code>属性获得模块元。</p><p id="7c12" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c42e" class="mq lc iq mh b gy mr ms l mt mu">console.log(import.meta.url);<br/>console.log(Deno.mainModule);<br/>console.log(import.meta.main);</span></pre><p id="6918" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们会看到这样的情况:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="79cf" class="mq lc iq mh b gy mr ms l mt mu">file:///home/runner/IntelligentWorthwhileMice/index.ts<br/>file:///home/runner/IntelligentWorthwhileMice/index.ts<br/>true</span></pre><p id="1e92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行时，从控制台输出:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5afb" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-read --unstable index.ts</span></pre><p id="ae2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">import.meta.url</code>和<code class="fe me mf mg mh b">Deno.mainModule</code>都得到模块的路径。</p><p id="7a10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果是入口点模块,<code class="fe me mf mg mh b">import.meta.main</code>返回<code class="fe me mf mg mh b">true</code>。</p><h1 id="1340" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="00ab" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Deno处理OS信号，获取模块元数据，观察文件系统事件。</p><p id="fd7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>