<html>
<head>
<title>Next.js Firebase v9: Read ToDos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js Firebase v9:阅读ToDos</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nextjs-firebase-v9-part-2-read-todos-602be605aab6?source=collection_archive---------6-----------------------#2021-10-19">https://javascript.plainenglish.io/nextjs-firebase-v9-part-2-read-todos-602be605aab6?source=collection_archive---------6-----------------------#2021-10-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="06da" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第2部分:导入onSnapshot、orderBy、collection和query函数。</h2></div><p id="453d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将使用Firebase Firestore中的onSnapshot、orderBy、collection和query函数来读取文档。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/31d044bf9e8fa72a153d135d2ab09e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FM42EZcGI2BrC3u3.png"/></div></figure><p id="aeea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lj" href="https://youtu.be/A-Ce4YyHMGk" rel="noopener ugc nofollow" target="_blank">视频教程</a>和<a class="ae lj" href="https://www.udemy.com/course/complete-nextjs-firebase-firestore-course/?couponCode=FREESOURCE" rel="noopener ugc nofollow" target="_blank">源代码</a></p><p id="8c7d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">转到配置文件<strong class="kh ir"> firebase.js </strong>，导入getFirestore，并创建db。最后，我们导出数据库。</p><pre class="lc ld le lf gt lk ll lm ln aw lo bi"><span id="7cd3" class="lp lq iq ll b gy lr ls l lt lu">// Import the functions you need from the SDKs you need</span><span id="5e9f" class="lp lq iq ll b gy lv ls l lt lu">import { initializeApp } from "firebase/app";</span><span id="70fc" class="lp lq iq ll b gy lv ls l lt lu"><strong class="ll ir">import { getFirestore } from "firebase/firestore";</strong></span><span id="1bf6" class="lp lq iq ll b gy lv ls l lt lu">const firebaseConfig = {</span><span id="6c45" class="lp lq iq ll b gy lv ls l lt lu">apiKey: "AIzaSyCCKSzdjGpZUj9Gf2sEa2kCR_gAgrELUb0",</span><span id="7379" class="lp lq iq ll b gy lv ls l lt lu">authDomain: "nextjs-firebase-61239.firebaseapp.com",</span><span id="c36e" class="lp lq iq ll b gy lv ls l lt lu">projectId: "nextjs-firebase-61239",</span><span id="5c76" class="lp lq iq ll b gy lv ls l lt lu">storageBucket: "nextjs-firebase-61239.appspot.com",</span><span id="0d6a" class="lp lq iq ll b gy lv ls l lt lu">messagingSenderId: "122363745629",</span><span id="01f4" class="lp lq iq ll b gy lv ls l lt lu">appId: "1:122363745629:web:02de623d92474cd594c4b4"</span><span id="15bc" class="lp lq iq ll b gy lv ls l lt lu">};</span><span id="91cc" class="lp lq iq ll b gy lv ls l lt lu">// Initialize Firebase</span><span id="5025" class="lp lq iq ll b gy lv ls l lt lu">const app = initializeApp(firebaseConfig);</span><span id="dbaa" class="lp lq iq ll b gy lv ls l lt lu"><strong class="ll ir">const db = getFirestore()</strong></span><span id="ef40" class="lp lq iq ll b gy lv ls l lt lu"><strong class="ll ir">export {db}</strong></span></pre><p id="3aee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们转到根文件夹，创建“components”文件夹。在这个文件夹下，创建<strong class="kh ir"> TodoList.js </strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/b5df8a7ea2a5c7d008bf8a18444eab9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*w7vka2J0tHTiDYD0QHL2VQ.png"/></div></figure><p id="2ca2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加useEffect来获取按时间戳排序的ToDos集合。使用onSnapshot功能收听Firestore中的变化。我们还将文档id添加到ToDo对象中，并且我们还需要对时间戳对象进行转换。</p><p id="c7a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了让JavaScript理解Firestore时间戳，我们需要使用<code class="fe lx ly lz ll b">doc.data().timestamp?.toDate().getTime()</code>。我们加上“？”以防还没有添加时间戳。</p><pre class="lc ld le lf gt lk ll lm ln aw lo bi"><span id="8f2f" class="lp lq iq ll b gy lr ls l lt lu">import { db } from "../firebase";</span><span id="c951" class="lp lq iq ll b gy lv ls l lt lu">import { onSnapshot, collection, orderBy, query } from "firebase/firestore";</span><span id="20e9" class="lp lq iq ll b gy lv ls l lt lu">import { useEffect, useState } from "react";</span><span id="0172" class="lp lq iq ll b gy lv ls l lt lu">const TodoList = () =&gt; {</span><span id="7f90" class="lp lq iq ll b gy lv ls l lt lu">const [todos, setTodos] = useState([])</span><span id="3b17" class="lp lq iq ll b gy lv ls l lt lu">useEffect(() =&gt; {</span><span id="371e" class="lp lq iq ll b gy lv ls l lt lu">const collectionRef = collection(db, "todos")</span><span id="4f2e" class="lp lq iq ll b gy lv ls l lt lu">const q = query(collectionRef, orderBy("timestamp", "desc"));</span><span id="1435" class="lp lq iq ll b gy lv ls l lt lu">const unsubscribe = onSnapshot(q, (querySnapshot) =&gt; {</span><span id="15ba" class="lp lq iq ll b gy lv ls l lt lu">setTodos(querySnapshot.docs.map(doc =&gt; ({ ...doc.data(), id: doc.id, timestamp: doc.data().timestamp?.toDate().getTime() })))</span><span id="1877" class="lp lq iq ll b gy lv ls l lt lu">});</span><span id="5a6c" class="lp lq iq ll b gy lv ls l lt lu">return unsubscribe;</span><span id="bc6b" class="lp lq iq ll b gy lv ls l lt lu">}, [])</span><span id="9829" class="lp lq iq ll b gy lv ls l lt lu">return (</span><span id="9b6d" class="lp lq iq ll b gy lv ls l lt lu">&lt;div&gt;</span><span id="b804" class="lp lq iq ll b gy lv ls l lt lu">{todos.map(todo =&gt; &lt;p key={todo.id}&gt;{todo.title}&lt;/p&gt;)}</span><span id="91b6" class="lp lq iq ll b gy lv ls l lt lu">&lt;/div&gt;</span><span id="bf7b" class="lp lq iq ll b gy lv ls l lt lu">)</span><span id="ba8b" class="lp lq iq ll b gy lv ls l lt lu">}</span><span id="6377" class="lp lq iq ll b gy lv ls l lt lu">export default TodoList</span></pre><h2 id="c093" class="lp lq iq bd ma mb mc dn md me mf dp mg ko mh mi mj ks mk ml mm kw mn mo mp mq bi translated">呈现待办事项列表</h2><p id="f2c5" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">为了呈现ToDo列表，我们需要将ToDo list组件导入到<strong class="kh ir"> index.js </strong>中。</p><pre class="lc ld le lf gt lk ll lm ln aw lo bi"><span id="9271" class="lp lq iq ll b gy lr ls l lt lu">import { Container } from '@mui/material'</span><span id="acc5" class="lp lq iq ll b gy lv ls l lt lu">import TodoList from '../components/TodoList'</span><span id="adb9" class="lp lq iq ll b gy lv ls l lt lu">export default function Home() {</span><span id="9f03" class="lp lq iq ll b gy lv ls l lt lu">return (</span><span id="6ea1" class="lp lq iq ll b gy lv ls l lt lu">&lt;Container&gt;</span><span id="f3a4" class="lp lq iq ll b gy lv ls l lt lu">&lt;TodoList /&gt;</span><span id="e6cf" class="lp lq iq ll b gy lv ls l lt lu">&lt;/Container&gt;</span><span id="48d0" class="lp lq iq ll b gy lv ls l lt lu">)</span><span id="cf4c" class="lp lq iq ll b gy lv ls l lt lu">}</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/0a5586ce2313444e29caa792bed471cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G4Ns1dIGBC3jCth6NLcvoQ.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">the todos are rendered inside the web</figcaption></figure><h1 id="25f6" class="nf lq iq bd ma ng nh ni md nj nk nl mg jw nm jx mj jz nn ka mm kc no kd mp np bi translated">关注我们:<a class="ae lj" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae lj" href="https://ckmobile.medium.com/" rel="noopener"> Medium </a>，<a class="ae lj" href="https://www.udemy.com/user/cyruschan2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a>，<a class="ae lj" href="https://www.linkedin.com/company/ckmobi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae lj" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae lj" href="https://www.instagram.com/ckmobile8050" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae lj" href="https://app.gumroad.com/ckmobile" rel="noopener ugc nofollow" target="_blank"> Gumroad </a></h1><p id="f6d2" class="pw-post-body-paragraph kf kg iq kh b ki mr jr kk kl ms ju kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated"><em class="nq">更多内容请看</em><a class="ae lj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>