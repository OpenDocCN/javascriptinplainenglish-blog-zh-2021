<html>
<head>
<title>Refactoring with TypeScript Discriminated Union Types and Generics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript区分联合类型和泛型进行重构</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/case-study-a-practical-usage-of-typescript-discriminated-union-type-and-generics-87e75a2717f8?source=collection_archive---------6-----------------------#2021-02-28">https://javascript.plainenglish.io/case-study-a-practical-usage-of-typescript-discriminated-union-type-and-generics-87e75a2717f8?source=collection_archive---------6-----------------------#2021-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4cd1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过使用TypeScript的有区别的联合类型和泛型的实际例子来增强您的重构技能</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/110c3d30f08950e885f23a0dd62726c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*susz8siNot5RBPxMvAgLBw.png"/></div></div></figure><p id="5ebc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我喜欢TypeScript的是它的类型系统。它实用且功能丰富。在正确的用例中应用这些类型可以使我们的代码更干净，更容易维护。</p><p id="65d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">本文的目的是分享一个用TypeScript区分联合类型和泛型进行代码重构的例子。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="3b74" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">原始代码</h2><p id="1080" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">这段代码用于表示用户角色和功能/权限映射，以在Angular应用程序中构建用户访问矩阵。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ms"><img src="../Images/b3c2d0a680f232dfad2792cabe6ec3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QIpj0ZYnJxBlHUs5FeM1g.png"/></div></div></figure><p id="c60c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面的代码包含:</p><ol class=""><li id="3380" class="mt mu iq kt b ku kv kx ky la mv le mw li mx lm my mz na nb bi translated">FeatureAccess:表示两个特性(“<code class="fe nc nd ne nf b">UserManagement</code>”和“<code class="fe nc nd ne nf b">Order</code>”)及其权限的常数。</li><li id="8578" class="mt mu iq kt b ku ng kx nh la ni le nj li nk lm my mz na nb bi translated">SalesRole:一个角色类，描述销售用户拥有的权限列表和基于此的<code class="fe nc nd ne nf b">“canAccess</code>方法。</li></ol></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="7960" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">问题</h2><p id="1d2a" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">上面的代码有什么问题？</p><p id="f153" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，<code class="fe nc nd ne nf b">SalesRole </code>类中<code class="fe nc nd ne nf b">functions</code> Getter的返回类型不够强。在<code class="fe nc nd ne nf b">IUserPermission</code>界面中，权限是一个字符串数组。虽然在<code class="fe nc nd ne nf b">FeatureAccess </code>常量中明确说明了每个特性都有不同的权限(即Order特性不一定要有Create/Delete权限)，但是如果有人在<code class="fe nc nd ne nf b">SalesRole functions </code> Getter中添加了“Create”权限，编译器也不会抱怨。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/fef2610e85117e3af2901d6f27ecad96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*3XqL7qQ1n7zkRCpypJHb6A.png"/></div></figure><p id="8933" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">其次，代码没干。有许多重复的“名称空间”代码，如“<code class="fe nc nd ne nf b">FeatureAccess.UserManagement.Permissions.xxx</code>”，这是一种减少错误地将错误权限添加到角色功能列表中的方法。在有许多角色和权限的真实项目中，这使得代码难以阅读。</p><p id="8da6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我重构代码的第一次尝试是使用区分的联合类型。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="ea47" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">区别工会类型</h2><p id="daed" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">区分联合类型是通过一个名为<strong class="kt ir">鉴别器</strong>的属性来区分类型。辨别类型的强大之处在于，额外的类型检查是在编译时执行的，并且还将类型信息带入运行时。</p><p id="65af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过应用有区别的联合类型，代码被重构如下</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/08a14ba252779f1368e862e57719dbee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4nqfdYDlL-WWQh5kdY07_A.png"/></div></div></figure><p id="5235" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如上面的代码所示，新的<code class="fe nc nd ne nf b">UserTypes</code>和<code class="fe nc nd ne nf b">OrderTypes</code>是联合类型，表示每个特性允许的权限。新的<code class="fe nc nd ne nf b">functionList</code>类型是一个有区别的联合类型，它加强了特性和它的权限之间的关系。</p><p id="b677" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，如果有人添加了一个<code class="fe nc nd ne nf b">Create </code> permission to Order特性，编译器会不高兴。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/c80c753214ea877e9e656348c71937af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dG0fZxMRxrKSIb3VachNtA.png"/></div></div></figure><p id="a6f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重复的“名称空间”代码被删除，因为我们不必使用命名转换来使它“更安全”，相反，通过更好的编译器类型检查，我们可以使用简单的<code class="fe nc nd ne nf b">PermList</code>常量，而不必担心将错误的权限添加到角色函数列表中。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="3f50" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">作为常数</h2><p id="ddb6" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">另一件值得强调的事情是这里使用的“常量断言”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2925f8ee5d2c7f1b634c8788c54f07fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*jb4hkNA45P-gpsFUwxqusQ.png"/></div></figure><p id="711c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nc nd ne nf b">as const</code>是常量断言表达式。它有两个作用，使所有属性<code class="fe nc nd ne nf b">readonly </code>和防止字符串文字扩大。后者是一个经常被遗忘的特性，但有时会非常有用。例如，如果没有这个神奇的表达式，<code class="fe nc nd ne nf b">PermList.View</code>将是一个字符串，而不是一个字面上的“视图”类型，那么整个被区分的类型将不能用于这种情况。</p><p id="2222" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这还不是结束，我们还可以通过使用TypeScript中的泛型来进一步改进代码。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="20dd" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">无商标消费品</h2><p id="c4a9" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">您可能已经注意到<code class="fe nc nd ne nf b">IUserFunctions</code>和<code class="fe nc nd ne nf b">IOrderFunctions</code>是相似的，它们都有“名称”和“权限”属性。同样，在现实世界中，这些接口可以像副本一样快速增长。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/a6484d97e0094d790cf2ed3a398e22e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9YRfZe7zx_W3QDIi_-vZLQ.png"/></div></div></figure><p id="5a3e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如您所看到的，应用泛型后，它变得更加清晰。</p></div><div class="ab cl ln lo hu lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ij ik il im in"><h2 id="d5ab" class="lu lv iq bd lw lx ly dn lz ma mb dp mc la md me mf le mg mh mi li mj mk ml mm bi translated">结论</h2><p id="e97b" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">TypeScript类型系统是强大的，这个用例只是触及了表面，我希望它能引发您进一步探索它的兴趣。</p><p id="d5f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编程快乐！</p><p id="df9f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nq">如果您还不是Medium的付费会员，</em> <a class="ae nr" href="https://sunnysun-5694.medium.com/membership" rel="noopener"> <strong class="kt ir"> <em class="nq">您可以访问此链接</em> </strong> </a> <em class="nq">。你可以无限制地阅读媒体上的所有报道。我会收你一部分会员费作为介绍费。</em></p></div></div>    
</body>
</html>