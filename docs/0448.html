<html>
<head>
<title>How to Use the Geolocation API in Your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用中使用地理定位API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-the-geolocation-api-in-your-react-app-54e87c9c6c94?source=collection_archive---------1-----------------------#2021-01-27">https://javascript.plainenglish.io/how-to-use-the-geolocation-api-in-your-react-app-54e87c9c6c94?source=collection_archive---------1-----------------------#2021-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2bc7" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">获取用户的坐标，并在下一个React应用中使用它们</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ce7fe64bb9a4f2e707c7c6a2445ab614.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xYTFQCsKDmvhFCeh"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@dmjdenise?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Denise Jans</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f729" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我目前正在React中构建一个地图应用程序，需要使用地理定位API来获取用户的当前位置。我想分享一下我是如何实现它的，这样你也可以在你的应用中使用它。在我们的示例中，我们将构建一个简单的应用程序，在单击按钮时显示用户当前的纬度和经度坐标。</p><p id="2a1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有兴趣了解更多关于地理定位API的信息，你可以在<a class="ae kv" href="https://en.wikipedia.org/wiki/W3C_Geolocation_API" rel="noopener ugc nofollow" target="_blank">这里</a>阅读。让我们开始吧！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1a1a" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">入门指南</h1><p id="739e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们将使用create-react-app构建我们的应用程序。</p><p id="363d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在App.js文件中，使用<code class="fe mw mx my mz b">useState</code>钩子为<code class="fe mw mx my mz b">lat</code> <code class="fe mw mx my mz b">lng</code>和<code class="fe mw mx my mz b">status</code>声明状态变量。<code class="fe mw mx my mz b">lat</code>和<code class="fe mw mx my mz b">lng</code>会存储用户所在位置的经纬度坐标。<code class="fe mw mx my mz b">status</code>将用于跟踪装载和错误。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="e7c6" class="ne ma iq mz b gy nf ng l nh ni">const [lat, setLat] = useState(null);<br/>const [lng, setLng] = useState(null);<br/>const [status, setStatus] = useState(null);</span></pre><p id="462d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将保持返回语句简单，显示一个<button>、<h1>和一些</h1><p>标记。</p></button></p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="ed9d" class="ne ma iq mz b gy nf ng l nh ni">&lt;div className="App"&gt;<br/>  &lt;button onClick={getLocation}&gt;Get Location&lt;/button<br/>  &lt;h1&gt;Coordinates&lt;/h1&gt;<br/>  &lt;p&gt;{status}&lt;/p&gt;<br/>  {lat &amp;&amp; &lt;p&gt;Latitude: {lat}&lt;/p&gt;}<br/>  {lng &amp;&amp; &lt;p&gt;Longitude: {lng}&lt;/p&gt;}<br/>&lt;/div&gt;</span></pre><p id="5bad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们应该有一个基本的应用程序设置，看起来像这样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/53ec526c6a9e4a79164e1c652c046569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*DzvIMhmzANUMjepHLgOyDw.png"/></div></figure><h1 id="64fc" class="lz ma iq bd mb mc nk me mf mg nl mi mj jw nm jx ml jz nn ka mn kc no kd mp mq bi translated">地理定位API</h1><p id="5896" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">接下来，让我们实现地理定位API来获取用户的当前位置坐标。你可以在这里查看更多关于地理定位API的信息。</p><p id="6904" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将在我们的App组件中创建一个新的函数，名为<code class="fe mw mx my mz b">getLocation</code>。该功能将首先检查您的网络浏览器是否支持<code class="fe mw mx my mz b">navigator.geolocation</code>。在很大程度上，它应该兼容所有的浏览器，除了一些非常旧的版本。</p><p id="7d88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦我们检查了这个，我们就可以调用<code class="fe mw mx my mz b">navigator.geolocation.getCurrentPosition</code>方法。这个函数获取用户的当前位置，接受3个参数；成功回调函数、错误回调函数(可选)和位置选项对象(可选)。</p><p id="52c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果成功，我们将设置纬度和经度。这些值存储在<code class="fe mw mx my mz b">position.coords.latitude</code>和<code class="fe mw mx my mz b">position.coords.longitude</code>中。</p><p id="9c9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果出现错误，我们会将状态设置为显示错误。</p><p id="eb61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在位置选项对象中，您可以启用高精度、设置超时或设置缓存的位置年龄。在我们的例子中，我们将省略这些。</p><pre class="kg kh ki kj gt na mz nb nc aw nd bi"><span id="4fe8" class="ne ma iq mz b gy nf ng l nh ni">const getLocation = () =&gt; {<br/>  if (!navigator.geolocation) {<br/>    setStatus('Geolocation is not supported by your browser');<br/>  } else {<br/>    setStatus('Locating...');<br/>    navigator.geolocation.getCurrentPosition((<em class="np">position</em>) =&gt; {<br/>      setStatus(null);<br/>      setLat(position.coords.latitude);<br/>      setLng(position.coords.longitude);<br/>    }, () =&gt; {<br/>      setStatus('Unable to retrieve your location');<br/>    });<br/>  }<br/>}</span></pre><p id="05f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将为按钮设置一个<code class="fe mw mx my mz b">onClick</code>监听器，每当单击按钮时，这个监听器将运行<code class="fe mw mx my mz b">getLocation</code>方法。第一次单击该按钮时，您需要获得web浏览器的许可。我正在使用谷歌浏览器，它看起来像这样。根据您使用的web浏览器，这可能会有所不同。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/2a377d47f125a2bdc4521292d8455937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*zGaU9iyP6vyXd9FtvSDJhA.png"/></div></figure><p id="22c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击允许，你现在应该可以看到你的纬度和经度坐标。(顺便说一下，这些是日本东京的默认坐标！)</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3d57157c26c4137de9ed20113beab3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*FoDIblqHWSU54GNf1rk93A.png"/></div></figure><p id="23cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个<code class="fe mw mx my mz b">App.js</code>文件看起来会像下面这样。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e837" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">包扎</h1><p id="7fac" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">感谢阅读！如果你想看源代码，你可以在这里查看我的GitHub repo<a class="ae kv" href="https://github.com/chadmuro/medium-geolocation" rel="noopener ugc nofollow" target="_blank"/>。现在您已经有了用户的纬度和经度坐标，您可以继续将它用于您的应用程序。</p><p id="9412" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们结束这篇文章之前，这里有三个你可以使用地理定位API构建的东西的想法。</p><h2 id="c87c" class="ne ma iq bd mb nu nv dn mf nw nx dp mj lf ny nz ml lj oa ob mn ln oc od mp oe bi translated">天气应用程序—显示用户所在位置的当前天气</h2><div class="of og gp gr oh oi"><a href="https://openweathermap.org/api" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">天气API</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">简单快速和免费的天气API，你可以访问当前的天气数据，每小时，5天和16天…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">openweathermap.org</p></div></div><div class="or l"><div class="os l ot ou ov or ow kp oi"/></div></div></a></div><h2 id="3030" class="ne ma iq bd mb nu nv dn mf nw nx dp mj lf ny nz ml lj oa ob mn ln oc od mp oe bi translated">搜索应用——搜索用户位置周围的商家</h2><div class="of og gp gr oh oi"><a href="https://www.yelp.com/developers" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">Yelp开发者</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">面向开发者的Yelp——用Yelp构建</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">www.yelp.com</p></div></div><div class="or l"><div class="ox l ot ou ov or ow kp oi"/></div></div></a></div><h2 id="42e2" class="ne ma iq bd mb nu nv dn mf nw nx dp mj lf ny nz ml lj oa ob mn ln oc od mp oe bi translated">地图应用程序-在地图上显示用户的当前位置</h2><div class="of og gp gr oh oi"><a href="https://developers.google.com/maps/documentation/javascript/overview" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd ir gy z fp on fr fs oo fu fw ip bi translated">概述|地图JavaScript API | Google开发者</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">开始之前:在您开始使用Maps JavaScript API之前，您需要一个带有计费帐户和…</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">developers.google.com</p></div></div><div class="or l"><div class="oy l ot ou ov or ow kp oi"/></div></div></a></div></div></div>    
</body>
</html>