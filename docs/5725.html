<html>
<head>
<title>I Bravely Refactored Express MongoDB App and Won a Wow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我勇敢地重构了Express MongoDB App，赢得了一片叫好</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/i-bravely-refactored-express-mongodb-app-and-won-a-wow-220cae35be3f?source=collection_archive---------6-----------------------#2021-12-03">https://javascript.plainenglish.io/i-bravely-refactored-express-mongodb-app-and-won-a-wow-220cae35be3f?source=collection_archive---------6-----------------------#2021-12-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1dc5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">润色你的代码。了解如何修复千层面架构。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d8757534fb67b09f3ff9a32428c7b9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqnXIGz299y39iI6kC6ovw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Polish your code. Made by Roset from Shutterstock</figcaption></figure><p id="3d70" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我给你讲个故事吧。推特上有个家伙。他有3000名忠实粉丝，并且增长迅速。他贴了一个<a class="ae lo" href="https://twitter.com/SuhailKakar/status/1465386042849038337" rel="noopener ugc nofollow" target="_blank"> Express+MongoDB=CRUD </a>教程。人们喜欢这个教程！有人甚至称之为见解深刻。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lp"><img src="../Images/cb75b0161b0f95acf88a326336cc6fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zqWNnbYAn22fNu-BVdSdsw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">These are not bots but real developers with life</figcaption></figure><p id="3e8b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">教程看起来不错。它获得了很多好评。</p><p id="fa09" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">不过，代号是<em class="lq">就咩</em>。代码尝起来像<a class="ae lo" href="https://thevaluable.dev/kiss-principle-explained/#lasagna-architecture" rel="noopener ugc nofollow" target="_blank">千层面建筑</a>。</p><p id="dd80" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我发现了两层薄薄的千层面。路由器()API的误用。重复样板错误处理。这个项目比预期的要难两倍。</p><p id="68ee" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">就在这个时候，它让我大开眼界:</p><blockquote class="lr ls lt"><p id="26a9" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">Dev社区显然缺少了我所拥有的一项有价值的知识。我可以重构这个应用程序，并教其他人这个例子。</p></blockquote><p id="fc85" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我不只是说说而已，而且我也在行动。我重构了这个应用程序，使它缩小了两倍，可读性提高了两倍。我给原作者看了新版本，赢得了<strong class="ku io">的喝彩</strong>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lx ly l"/></div></figure><p id="b453" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">故事并没有到此结束。今天我想教你如何成为一个更好的开发者。让我向您展示我是如何重构原始应用程序的。我将解释我的思维过程。你会学到并获得有价值的见解。</p><p id="9c1d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将遵循以下计划:</p><ul class=""><li id="61ad" class="lz ma in ku b kv kw ky kz lb mb lf mc lj md ln me mf mg mh bi translated">首先，我们将研究原始应用程序</li><li id="a5f7" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">然后我们会把它擦亮</li></ul><p id="ea53" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果你想从这篇文章中记住一件事，就让它成为:</p><blockquote class="mn"><p id="70b0" class="mo mp in bd mq mr ms mt mu mv mw ln dk translated">薄薄的千层面会悄悄地吸干你的灵魂。毫无悔意地杀了他们。</p></blockquote><p id="3b23" class="pw-post-body-paragraph ks kt in ku b kv mx jo kx ky my jr la lb mz ld le lf na lh li lj nb ll lm ln ig bi translated">计算中的间接性意味着使用一个(或多个)中间人来调用某些东西。例如，从橙子到橙子的1:1转换。</p><blockquote class="lr ls lt"><p id="0498" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">间接可以使你的软件对变化更加灵活。请确定您需要这种灵活性！如果您打算交换一些实现，请确保您的代码库中现在有不止一个可用的实现。</p><p id="4905" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">— <a class="ae lo" href="https://thevaluable.dev/abstraction-type-software-example/" rel="noopener ugc nofollow" target="_blank">什么是软件工程中的抽象并举例</a></p></blockquote></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="4b0d" class="nj nk in bd nl nm nn no np nq nr ns nt jt nu ju nv jw nw jx nx jz ny ka nz oa bi translated">CRUD应用程序要求</h1><p id="7654" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我们希望有一个云中的消息集合。我们的应用程序允许您创建/阅读/更新/删除消息。</p><p id="73ea" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">90%的web应用都是这样。</p><h1 id="2f23" class="nj nk in bd nl nm og no np nq oh ns nt jt oi ju nv jw oj jx nx jz ok ka nz oa bi translated">应用架构</h1><p id="bbc7" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我们正在制作一个快递应用程序。然而，我们用require()以非规范的方式连接了额外的路由。require()返回一个函数，该函数向传递的应用程序添加更多路线:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="5448" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">当您有一个专门用于这种情况的快速路由器()时，这是一个奇怪的选择。</p><h2 id="91ab" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">薄薄的千层面</h2><p id="72f7" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">从require()中检查魔法函数。我称之为纸一样薄的千层面。如果您需要添加/删除/更新路线，您需要在两个文件中进行更改:</p><ul class=""><li id="60b8" class="lz ma in ku b kv kw ky kz lb mb lf mc lj md ln me mf mg mh bi translated">在这个<code class="fe oy oz pa pb b">app.routes.js</code></li><li id="76aa" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">而在<code class="fe oy oz pa pb b">app.controller.js</code></li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="48a8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">每增加一层，工作量就会增加一倍。添加的层越多，浏览和理解代码就越难。</p><blockquote class="lr ls lt"><p id="8409" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">这个代码库充满了良好的意图。负责这个庞然大物的开发人员并不想故意创建一个复杂的系统。他们想通过创造一些极其灵活、优雅、简洁、完美的软件来帮助每个人。</p><p id="6d14" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">— <a class="ae lo" href="https://thevaluable.dev/kiss-principle-explained/#lasagna-architecture" rel="noopener ugc nofollow" target="_blank">软件中KISS原理的详细说明</a></p></blockquote><p id="9c64" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">薄薄的千层面静静地躺在你的代码库中，慢慢地吸干你的灵魂。每当你添加一个特性或者重构的时候，他们都在浪费你的生命。当你看到一个薄的间接层时，考虑删除它。</p><h2 id="48ac" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">样板核心</h2><p id="b9ad" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">让我们无所畏惧地接近应用核心，钻到应用控制器。这是我们应用程序的核心。检查笨重的积垢路径。你可以立即看到他们有许多重复的代码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="8451" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">不要误会我的意思。在我们的工艺中到处复制粘贴是必不可少的，它节省了大量的时间。然而，这个文件有5个函数使用了同样庞大的样板文件。在这种情况下，复制粘贴会使代码更难阅读和维护。</p><h2 id="bdf4" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">孤独的猫鼬模型</h2><p id="b92e" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">最后，我们还有一个文件:孤独的猫鼬模型。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="ec37" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">它位于一个单独的文件夹中，一个单独的文件中。在那里感觉有点孤独。他正在考虑转向routes，这样开发者就可以访问它。</p><h1 id="da69" class="nj nk in bd nl nm og no np nq oh ns nt jt oi ju nv jw oj jx nx jz ok ka nz oa bi translated">判决</h1><p id="6de8" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我在这里看到一个很酷的小应用程序，但是这个应用程序有一些问题:</p><ul class=""><li id="a851" class="lz ma in ku b kv kw ky kz lb mb lf mc lj md ln me mf mg mh bi translated">薄薄的千层面。你能很容易地修理它。您需要删除路线文件和模型文件。这将使代码更容易阅读和维护</li><li id="7496" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">重复的样板文件。错误处理逻辑在每个路由中重复。404逻辑在每个路由中重复。这种样板文件使程序变得庞大。您可以通过提取一个函数来轻松修复它</li></ul></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="420b" class="nj nk in bd nl nm nn no np nq nr ns nt jt nu ju nv jw nw jx nx jz ny ka nz oa bi translated">重构的应用架构</h1><p id="ac12" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我们知道该怎么做:删除千层面的薄层，提取重复的代码。但首先，让我们修复应用程序路由。</p><h2 id="475e" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">重构路由</h2><p id="3476" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我们将使用<code class="fe oy oz pa pb b">messages = Router()</code>。这样，我们可以用<code class="fe oy oz pa pb b">app.use(path, router)</code>将我们的消息服务附加到一个特定的路径上。</p><p id="9040" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们也将通过<code class="fe oy oz pa pb b">app.use((err, req, res, next) =&gt;…)</code>来集中我们所有的错误处理。Express在每个错误时调用这个钩子。我们应用程序中的所有错误都将在这里出现——我们编写的样板文件更少。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="c8ab" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">另外，观察突然的变化。我们将“/消息”API重命名为“/消息”API:</p><blockquote class="lr ls lt"><p id="b7dc" class="ks kt lq ku b kv kw jo kx ky kz jr la lu lc ld le lv lg lh li lw lk ll lm ln ig bi translated">在API端点中资源应该总是复数<strong class="ku io"/>，如果我们想要访问资源的一个实例，我们可以总是在URL中传递id。— <a class="ae lo" href="https://medium.com/hackernoon/restful-api-designing-guidelines-the-best-practices-60e1d954e7c9" rel="noopener"> RESTful API设计指南</a></p></blockquote><h2 id="d2e2" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">重构的消息服务</h2><p id="9c3a" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">我们删除了2个多余的图层:<code class="fe oy oz pa pb b">app.routes.js</code>和<code class="fe oy oz pa pb b">app.model.js</code>。把所有的代码都放到一个文件里。我们还将路由样板文件提取到一个wrap()函数中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ol ly l"/></div></figure><p id="2289" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将项目大小从4个文件削减到2个。看看没有千层面的代码是如何容易阅读的。</p><h2 id="ba0b" class="om nk in bd nl on oo dn np op oq dp nt lb or os nv lf ot ou nx lj ov ow nz ox bi translated">现在轮到你了</h2><p id="aa48" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">如果你想从这篇文章中获得最大的收获，你需要练习:</p><ul class=""><li id="d9a4" class="lz ma in ku b kv kw ky kz lb mb lf mc lj md ln me mf mg mh bi translated">叉<a class="ae lo" href="https://github.com/suhailkakar/Node-Express-MongoDB-Restful-CRUD-API" rel="noopener ugc nofollow" target="_blank">原app回购</a></li><li id="77dd" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">重构它</li><li id="d073" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">将这篇文章作为指导方针</li></ul><p id="f29e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这样你将在安全的环境中学习，并获得最大的洞察力价值。</p><h1 id="aaf1" class="nj nk in bd nl nm og no np nq oh ns nt jt oi ju nv jw oj jx nx jz ok ka nz oa bi translated">结论</h1><p id="68cf" class="pw-post-body-paragraph ks kt in ku b kv ob jo kx ky oc jr la lb od ld le lf oe lh li lj of ll lm ln ig bi translated">从这个重构练习中，你应该学会3个要点:</p><ul class=""><li id="ed2c" class="lz ma in ku b kv kw ky kz lb mb lf mc lj md ln me mf mg mh bi translated">薄薄的千层面悄悄地吸干了开发者社区的灵魂。你应该尽量避免<a class="ae lo" href="https://thevaluable.dev/kiss-principle-explained/#lasagna-architecture" rel="noopener ugc nofollow" target="_blank">千层面架构</a>。这将使你的代码x2更小，你的x2更有生产力</li><li id="c691" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">集中你的错误处理，这将节省你的样板文件</li><li id="f40a" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">复制和粘贴是一个可怕的技术，你应该使用它。然而，当被误用时，它会降低代码的可读性</li></ul><p id="9d1d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我希望你从这篇文章中学到了什么，今天你会觉得更有灵感。再见。</p><h1 id="b7ed" class="nj nk in bd nl nm og no np nq oh ns nt jt oi ju nv jw oj jx nx jz ok ka nz oa bi translated">发送代码给我，我会免费重构它</h1><ul class=""><li id="8f20" class="lz ma in ku b kv ob ky oc lb pc lf pd lj pe ln me mf mg mh bi translated">不确定如何重构代码？</li><li id="c053" class="lz ma in ku b kv mi ky mj lb mk lf ml lj mm ln me mf mg mh bi translated">在Medium、Twitter或网络的其他地方找到了一段有趣的代码？</li></ul><p id="af0c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">把代码发给我，cirnotoss@gmail.com，我会把它打磨得闪闪发光。我们将一起帮助开发社区成长。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="c160" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lq">更多内容看</em> <a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="lq">说白了。</em> </strong> <em class="lq">报名参加我们的</em> </a><a class="ae lo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="lq">免费每周简讯这里</em> </strong> </a> <strong class="ku io"> <em class="lq">。</em> </strong></p></div></div>    
</body>
</html>