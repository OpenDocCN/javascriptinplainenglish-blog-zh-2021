<html>
<head>
<title>Handle Errors in Angular with HttpClient, RxJS, HttpInterceptor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用HttpClient、RxJS、HttpInterceptor处理Angular中的错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handle-errors-in-angular-with-httpclient-and-rxjs-34cf631e29a6?source=collection_archive---------0-----------------------#2021-10-03">https://javascript.plainenglish.io/handle-errors-in-angular-with-httpclient-and-rxjs-34cf631e29a6?source=collection_archive---------0-----------------------#2021-10-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1103f756b746bc6a801b7748f7c699af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j-EyHDPe059pzYz7"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@elisa_ventur?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Elisa Ventur</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3d4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">先来看看<strong class="kc io"> HttpClient </strong>。我们可以通过RxJS catchError/catchError操作符来处理错误。在Angular中处理错误的基本方法是使用Angular的HttpClient服务以及RxJS操作符<code class="fe ky kz la lb b">throwError</code>和<code class="fe ky kz la lb b">catchError.</code>。发出HTTP请求后，它返回带有响应的数据。如果发生任何错误，它将返回带有错误状态代码的错误对象。</p><p id="4a28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是我使用<strong class="kc io"> catchAuthError() </strong>函数处理Angular中的错误的服务。这是一个单一的服务，所有的HTTP请求都将通过这个服务。如果出现任何错误，它将处理它并向用户显示一条用户友好的消息。</p><p id="60ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> request.service.ts </strong></p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/74bb1c89ca8b28ef5e1420eeae9554b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*4wQfTxTW4DhinLwa4QjO8w.png"/></div></figure><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/1db2ceaed2c75baea8c190737732bc05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*vmAQ5NX8MKqk-0B3GBRZjg.png"/></div></figure><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/602d5a1fdcca3f129573c479e125c1ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*3D7sPPWuOGcjzJ2iZBWZWQ.png"/></div></figure><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/22f25b05324bd06157f5d53b6a1da840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*uwMYrIhlRDMbAL_PyDphiQ.png"/></div></figure><p id="83d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有两类错误需要进行不同的处理:</p><p id="3aec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">客户端:</strong>网络问题和前端代码错误。使用<code class="fe ky kz la lb b">HttpClient</code>，这些错误返回<code class="fe ky kz la lb b">ErrorEvent</code>个实例。<strong class="kc io">服务器端:</strong> AJAX错误、用户错误、后端代码错误、数据库错误、文件系统错误。使用<code class="fe ky kz la lb b">HttpClient</code>，这些错误返回HTTP错误响应。</p><p id="a375" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过验证<code class="fe ky kz la lb b">error.error</code>下是否有错误，我们可以找出我们有哪种类型的错误并相应地处理它。</p><p id="c703" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将此<strong class="kc io"> request.service.ts </strong>注入所有其他服务:</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/524a21320414c5aa8b64006fd289bb76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*oOXOPEh45YigVoCrEGSHgw.png"/></div></figure><p id="3d68" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们来看看用<strong class="kc io"> HttpInterceptor处理错误的最佳方式。</strong></p><p id="f482" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它是与Angular 4.3.1一起推出的。它为我们提供了截取HTTP请求和响应的选项，以便在将它们传递给服务器之前对它们进行转换或处理。</p><p id="888f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在可以编写一个非常干净的服务，所有的错误都将由<strong class="kc io"> HttpInterceptor自动处理。</strong>我们甚至可以使用<strong class="kc io">重试</strong>方法在所有请求失败之前重试它们。</p><p id="66df" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在发送给服务器之前，我们可以修改任何报头、认证令牌、请求体等。</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lk"><img src="../Images/83343c5aa05cdac01c3c486fee82ad9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oLJrnNfJ2GB6d9mUqu3yVA.png"/></div></div></figure><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/599a6877178c6705a676fb71632b1490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*_1czQzc60KpxQHmoAavndw.png"/></div></figure><h1 id="5846" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">结论</h1><p id="332d" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">我希望这篇文章能帮助你理解在Angular 12中用RxJS操作符和HttpInterceptor处理错误的基本方法。</p><p id="9e43" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐！:)</p><p id="863f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mp">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mp">plain English . io</em></strong></a></p></div></div>    
</body>
</html>