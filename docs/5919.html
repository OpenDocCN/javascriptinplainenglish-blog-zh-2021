<html>
<head>
<title>Use Node.js to control your Xmas Lights</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js来控制你的圣诞灯</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-node-js-to-control-your-xmas-lights-a856ded2988a?source=collection_archive---------5-----------------------#2021-12-19">https://javascript.plainenglish.io/use-node-js-to-control-your-xmas-lights-a856ded2988a?source=collection_archive---------5-----------------------#2021-12-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8fa1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">或者如何过度设计你的圣诞灯</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/0b2513fdbcb047ee69b4ad2201044afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*x2vma5nF4hv8lECw.jpg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@mkaminski" rel="noopener ugc nofollow" target="_blank">Madison Kaminski</a> on Unsplash</figcaption></figure><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="d2ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="le">最初发布于</em><a class="ae lb" href="https://fek.io/blog/use-node-js-to-control-your-xmas-lights/" rel="noopener ugc nofollow" target="_blank"><em class="le">https://fek . io</em></a><em class="le">。</em></p><p id="1156" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多年来，我一直想得到可以通过网络或智能手机控制的灯泡。我终于挥霍，得到了飞利浦色相桥和灯泡。你现在可以在大多数五金店找到这些。这座桥花了我大约59美元。你也可以花大约69美元购买带有一些灯泡的初学者工具包。</p><p id="2ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以购买一些智能灯泡，通过WiFi连接直接连接到互联网，但并不是所有的智能灯泡都具有相同的物联网功能。Hue bridge可以通过智能手机应用程序、Amazon Dots、Google Home以及一些开源API进行控制。</p><p id="db1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我有一个彩色灯泡，我想做一个在圣诞节期间在绿色和红色之间循环的灯。为了编写一个可以与Hue网桥通信的应用程序，您需要两条信息，即网络上网桥的IP地址和用户id。</p><p id="eefe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以通过使用用于配置和设置桥的smartphone应用程序来找到您的Hue桥的IP地址。在应用程序中，您可以选择设置选项卡，然后选择桥&gt;和您设置的桥。它将在网桥的信息中列出IP地址。</p><p id="6664" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">获得白名单用户的下一步是向Hue桥发送一个HTTP post。查看下面的说明；</p><div class="lf lg gp gr lh li"><a href="https://developers.meethue.com/develop/get-started-2/" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab fo"><div class="lk ab ll cl cj lm"><h2 class="bd ir gy z fp ln fr fs lo fu fw ip bi translated">开始行动-飞利浦色相开发者计划</h2><div class="lp l"><h3 class="bd b gy z fp ln fr fs lo fu fw dk translated">遵循3个简单的步骤第1步首先确保您的网桥连接到您的网络并且运行正常。测试…</h3></div><div class="lq l"><p class="bd b dl z fp ln fr fs lo fu fw dk translated">developers.meethue.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw kv li"/></div></div></a></div><p id="47b3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦有了IP地址和用户令牌，就有了控制桥上灯泡所需的所有信息。</p><h1 id="2edc" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">拿到你桥上灯泡的清单</h1><p id="731f" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">在我们可以向灯泡发送命令之前，我们需要找到灯泡及其id，这样我们就可以使用Hue REST API进行调用。下面是一个脚本，用于返回网桥上所有设备的列表；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ld l"/></div></figure><p id="2e28" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我只有一个灯泡亮着，所以我将只得到一个灯泡的结果；</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="57b0" class="ng ly iq nc b gy nh ni l nj nk">{<br/>  '1': {<br/>    state: {<br/>      on: true,<br/>      bri: 254,<br/>      hue: 41371,<br/>      sat: 82,<br/>      effect: 'none',<br/>      xy: [Array],<br/>      ct: 153,<br/>      alert: 'select',<br/>      colormode: 'xy',<br/>      mode: 'homeautomation',<br/>      reachable: true<br/>    },<br/>    ...<br/>  }<br/>}</span></pre><p id="c668" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我想获得特定灯泡的灯泡状态，我可以将灯泡的编号添加到端点。我们可以重写脚本，只返回第一个灯泡；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ld l"/></div></figure><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="ac6d" class="ng ly iq nc b gy nh ni l nj nk">{<br/>  state: {<br/>    on: true,<br/>    bri: 254,<br/>    hue: 41371,<br/>    sat: 82,<br/>    effect: 'none',<br/>    xy: [ 0.3085, 0.3266 ],<br/>    ct: 153,<br/>    alert: 'select',<br/>    colormode: 'xy',<br/>    mode: 'homeautomation',<br/>    reachable: true<br/>  },<br/>  ...<br/>}</span></pre><p id="5c99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我想将灯泡的颜色改为绿色，我可以使用PUT动词并在URL端点的末尾添加<code class="fe nl nm nn nc b">state</code>来向灯泡传递一个新的状态。下面是一个将灯泡设置为绿色的例子；</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ld l"/></div></figure><h1 id="7ce2" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">在绿色和红色之间切换灯泡</h1><p id="a506" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">为了给灯泡一种圣诞节的感觉，我将每两秒钟在绿色和红色之间切换灯泡。对于主脚本，我将使用一个<code class="fe nl nm nn nc b">setInterval</code>函数，并设置它每2000毫秒运行一次。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ld l"/></div></figure><p id="bbde" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的脚本应该如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="na ld l"/></div></figure><h1 id="fa93" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">作为服务运行</h1><p id="5ed1" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">如果我们想将我们的脚本作为服务运行，我们可以通过使用<code class="fe nl nm nn nc b">pm2</code>来实现。PM2是一个用Node编写的进程管理器，可以在任何操作系统上运行。使用以下命令在我们的计算机上安装pm2。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="d3fa" class="ng ly iq nc b gy nh ni l nj nk">npm i pm2 -g</span></pre><p id="14aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将在我们的系统上全局安装pm2。现在我们可以把我们的主脚本作为一个服务安装在我们的计算机上。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="8fea" class="ng ly iq nc b gy nh ni l nj nk">&gt; pm2 start cyclexmaslights.js --name xmaslights</span></pre><p id="979e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，如果我们想保存这个配置，让我们的计算机记住这个服务，我们可以使用下面的命令。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="720c" class="ng ly iq nc b gy nh ni l nj nk">pm2 save</span></pre><p id="c9ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们想在重启后继续使用我们的pm2配置，我们可以使用下面的命令来生成我们将需要用来使pm2成为系统服务的命令。</p><pre class="km kn ko kp gt nb nc nd ne aw nf bi"><span id="509a" class="ng ly iq nc b gy nh ni l nj nk">&gt; pm2 startup <br/># To setup the Startup Script, copy/paste the following command: sudo env = $PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u pi --hp /home/user</span></pre><p id="f75d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在Linux上，它很可能会使用<code class="fe nl nm nn nc b">systemd</code>。在Mac上，它可能会使用<code class="fe nl nm nn nc b">launchd</code>。</p><h1 id="0dc4" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">如果我的计算机进入睡眠状态或者我关闭了它，该怎么办？</h1><p id="849a" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">如果你和我一样，你想让你的灯整夜亮着，使用一台进入睡眠状态或者关机的电脑将会杀死脚本。这里一个很好的选择是使用像Raspberry Pi这样的计算机。它们不会消耗很多电能，你可以把它们放在家里的任何地方。</p><h1 id="7421" class="lx ly iq bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">结论</h1><p id="6a03" class="pw-post-body-paragraph jn jo iq jp b jq mv js jt ju mw jw jx jy mx ka kb kc my ke kf kg mz ki kj kk ij bi translated">像这样的物联网项目可以是与家人在家一起做的有趣项目。学习更多关于硬件和嵌入式系统的知识也很有趣。像这样的项目也帮助我们了解更多关于API和Rest的知识。</p><p id="b3ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Hue还有一个远程API，可以通过互联网控制Hue桥。有许多不同语言的开源框架可用于控制照明。</p><p id="6560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="le">更多内容看</em> <a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="le">说白了. io </em> </strong> </a> <strong class="jp ir"> <em class="le">。</em> </strong> <em class="le">报名参加我们的</em> <a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="le">免费每周简讯</em> </strong> </a> <strong class="jp ir"> <em class="le">。</em> </strong></p></div></div>    
</body>
</html>