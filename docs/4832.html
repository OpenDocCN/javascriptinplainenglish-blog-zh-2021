<html>
<head>
<title>How to Keep Your Secrets from Your Source Code in an Angular Project 🤫</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Angular项目中从源代码中保守秘密🤫</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-keep-your-secrets-from-your-source-code-in-an-angular-project-6963374b464e?source=collection_archive---------0-----------------------#2021-09-28">https://javascript.plainenglish.io/how-to-keep-your-secrets-from-your-source-code-in-an-angular-project-6963374b464e?source=collection_archive---------0-----------------------#2021-09-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eabc5aff315c7dc2c4dc254f0dc92e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOuy1ua7BoQjnG8mWyXbpA.png"/></div></div></figure><p id="120c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">面对现实吧，我们都有秘密，但那不是我想说的。</p><p id="ca08" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文向您展示了一种技术，可以轻松地使用Angular的<code class="fe kt ku kv kw b">environment.ts</code>文件来访问敏感数据，而不会泄露您的秘密。</p><h1 id="a280" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">什么是秘密？</h1><p id="3133" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">Secret是指任何不应该作为源代码的一部分被推送的敏感值。这可以是API密钥、OAuth令牌、证书和密码。</p><p id="2e6a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">作为构建或部署的一部分，这些秘密通常需要与其他提供者或服务集成。</p><p id="9146" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">基于不同的部署环境，秘密也可能不同。</p><p id="a6ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，您可以将一个测试帐户用于开发，而将不同的API密钥用于生产。</p><h1 id="5953" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">你为什么要在乎秘密？</h1><p id="0b96" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">许多项目利用基于云的Git和CI/CD工具来管理源代码、构建和部署。因此，防止秘密泄露到您的源代码中是至关重要的。</p><p id="9633" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在客户端项目中，您通常要处理两种类型的秘密。</p><h2 id="e12d" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">1.客户端应用程序在与提供商对话时需要使用的秘密。</h2><p id="bb4c" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这些秘密在JS包或API调用中仍然可见。例如，这些秘密就像你的Google API密钥，需要通过HTTP请求发送给Google。</p><p id="dec5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常对于这些类型的秘密，你需要伴随的安全措施。例如，Google允许您将一个API密钥限制在一个域中，或者将其限制在特定的Google服务中。</p><p id="7893" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">即使对于这种类型，不在源代码中进行硬编码也是一个好的做法。<br/>硬编码使得基于环境的秘密管理变得困难。</p><p id="d939" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设您有一个使用不同Google API键的测试和生产环境。</p><p id="c309" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这个秘密是源代码的一部分，那么每次你想把它从测试API密匙变成生产API密匙时，你都需要记住修改代码。</p><p id="a571" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，更新你的秘密来旋转它可能更具挑战性。</p><p id="65ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们补充一个事实，源代码将跨分支和设备传播。</p><p id="d10f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我想你明白了。这很重要，因此，有一些最佳实践和工具可以帮助您。</p><p id="6838" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，谷歌有<a class="ae mm" href="https://support.google.com/googleapi/answer/6310037?hl=en" rel="noopener ugc nofollow" target="_blank">“安全使用API密匙的最佳实践”</a> <br/>其中建议不要在源代码中存储API键。</p><p id="2883" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者如果你按下你的Google API键，Github会给你发一封警告邮件。他们正在进行自动秘密扫描。</p><h2 id="0b8b" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">2.秘密只是构建中需要的一部分，而不是之后。</h2><p id="8852" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">例如，如果我的构建过程可以查询我的内容存储库(headless CMS)来预呈现一些页面以生成静态页面。</p><p id="a69c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，构建完成后，我不需要内容存储库的API键。我将只采取结果(静态页面)来部署它们。因此，我可以通过不放入源代码来真正保护我的密钥。</p><p id="34b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你不相信，请阅读<a class="ae mm" href="https://blog.gitguardian.com/secrets-credentials-api-git/" rel="noopener ugc nofollow" target="_blank">为什么git中的秘密是这样一个问题——源代码中的秘密</a>。</p><h1 id="e500" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">利用Angular <code class="fe kt ku kv kw b">environment.ts</code>文件获取机密</h1><p id="881f" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">Angular官方管理环境配置的方式是使用提供的<a class="ae mm" href="https://angular.io/guide/build" rel="noopener ugc nofollow" target="_blank"> environment.ts文件</a>。</p><p id="b812" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以为每个环境创建一个文件。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="0541" class="ma ky in kw b gy mv mw l mx my">└──myProject/src/environments/<br/>                   └──environment.ts<br/>                   └──environment.prod.ts<br/>                   └──environment.stage.ts</span></pre><p id="e9b4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并像这样提供每个环境的配置</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="c6c6" class="ma ky in kw b gy mv mw l mx my">export const environment = {<br/>  production: true,<br/>  apiUrl: 'http://my-prod-url'<br/>};</span></pre><p id="3051" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在代码中轻松访问这种配置。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="dd11" class="ma ky in kw b gy mv mw l mx my">import { environment } from '../environments/environment';</span><span id="39d9" class="ma ky in kw b gy mz mw l mx my">  public getBooks() {<br/>    const url = `${environment.apiUrl}/books`;<br/>    return this.http.get&lt;Book&gt;(url);<br/>  }</span></pre><p id="e56f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要获得特定于环境的配置，您可以在构建中使用env名称。</p><p id="6c20" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe kt ku kv kw b">ng build --configuration=stage</code>或者用angular.json根据环境来定义同一个东西。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="94a6" class="ma ky in kw b gy mv mw l mx my">"serve": {<br/>  "builder": "@angular-devkit/build-angular:dev-server",<br/>  "options": {<br/>    "browserTarget": "your-project-name:build"<br/>  },<br/>  "configurations": {<br/>    "production": {<br/>      "browserTarget": "your-project-name:build:production"<br/>    },<br/>    "staging": {<br/>      "browserTarget": "your-project-name:build:staging"<br/>    }<br/>  }<br/>},</span></pre><p id="9f74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些配置被推送到您的源代码中以支持构建。因此任何有权访问源代码的人都可以以纯文本的形式看到这些配置。</p><p id="f2c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种技术对于像apiUrl这样的典型配置来说完全没问题，但是对于secrets来说就不够好了。</p><h1 id="9ff8" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">解决办法</h1><p id="6ac9" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">我们可以通过<code class="fe kt ku kv kw b">environemnt.ts</code>文件提供秘密，而不需要使用<a class="ae mm" href="https://en.wikipedia.org/wiki/Environment_variable#:~:text=An%20environment%20variable%20is%20a,in%20which%20a%20process%20runs" rel="noopener ugc nofollow" target="_blank">环境变量</a>将其推送到源代码。</p><p id="a1e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">环境变量是一个动态命名的值，它可以影响正在运行的进程在计算机上的行为。它们是流程运行环境的一部分。例如，正在运行的进程可以查询TEMP环境变量的值，以找到存储临时文件的合适位置，或者查询HOME或USERPROFILE变量，以找到运行该进程的用户所拥有的目录结构。</p><p id="de6a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些<code class="fe kt ku kv kw b">Environment variables</code>是在你的Angular build运行的构建机器上设置的。</p><p id="2cd4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">设置<code class="fe kt ku kv kw b">Environment variables</code>有不同的方法，可以根据上下文而有所不同。</p><p id="b33d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们不想手动设置这些变量，所以我们使用一个<a class="ae mm" href="https://www.freecodecamp.org/news/nodejs-custom-env-files-in-your-apps-fa7b3e67abe1/" rel="noopener ugc nofollow" target="_blank">。环境文件</a>。您可以一次轻松设置多个环境变量和值。</p><p id="9e98" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">稍后，您可以使用<code class="fe kt ku kv kw b">.env</code>文件根据环境读取这些变量。的内容。env长这样。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="7b04" class="ma ky in kw b gy mv mw l mx my">GOOGLE_API_KEY=34232423423423234233fsajgsaagdda<br/>AUTH0_CLIENT_ID=54235nfgde24gbdf235432<br/>PASSWORD=adjkvknh29827;nbv_</span></pre><p id="4f70" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，我们的想法是加载与环境(测试、生产)相关的<code class="fe kt ku kv kw b">.env</code>文件，并以某种方式将它们提供给Angular <code class="fe kt ku kv kw b">environment.ts</code>文件。</p><h2 id="6764" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">这种方法如何更安全？</h2><p id="ba3f" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">这种方法更安全，因为包含敏感值的<code class="fe kt ku kv kw b">.env</code>文件只存在于您的构建机器(私有服务器)上。</p><p id="2b61" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此只有有权访问构建服务器的人才能读取该文件。敏感值不再是源代码的一部分。</p><h2 id="d6ea" class="ma ky in bd kz mb mc dn ld md me dp lh kg mf mg ll kk mh mi lp ko mj mk lt ml bi translated">基于云的CI/CD呢？</h2><p id="a91d" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">所有基于云的CI/CDs都已经提供了定义和管理<code class="fe kt ku kv kw b">Environment variables</code>的方法。</p><p id="4773" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦设置好了，<code class="fe kt ku kv kw b">Environment variables</code>将在构建运行时可用，我们可以像访问我们的服务器一样访问它们。此外，<code class="fe kt ku kv kw b">Environment variables</code>将是安全的，因为它们只能通过基于云的CI/CD管理仪表板获得。</p><p id="91fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是一些流行的基于云的CI/CD示例。</p><p id="9ce8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mm" href="https://vercel.com/docs/concepts/projects/environment-variables" rel="noopener ugc nofollow" target="_blank">韦尔塞尔</a></p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/337be5ca55c877cd5847d6038205dcb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jQxcSSJiLNX2__4O"/></div></div></figure><p id="abce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mm" href="https://docs.github.com/en/actions/learn-github-actions/environment-variables" rel="noopener ugc nofollow" target="_blank"> Github动作</a></p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/6f60143e812f7bf2b837eefc793f5b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_wYYh2GnnobO_h9u"/></div></div></figure><p id="24f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae mm" href="https://docs.aws.amazon.com/amplify/latest/userguide/environment-variables.html" rel="noopener ugc nofollow" target="_blank"> AWS放大器</a></p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/7940d95bd5ae5c13775d5dc4ba885d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KY4j0fiTCGFVBvvx"/></div></div></figure><h1 id="a273" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">如何访问Angular environment.ts文件中的环境变量？</h1><p id="a884" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">Angular build已经在运行时利用Node.js来完成构建，我们可以添加一个npm脚本来生成<code class="fe kt ku kv kw b">environement.ts</code>作为构建的一部分。</p><p id="a3cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个脚本将读取环境变量并生成<code class="fe kt ku kv kw b">environement.ts</code>文件。这个脚本只是JavaScript，所以编写生成输出所需的任何逻辑。</p><p id="a81c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是该脚本的代码。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="000c" class="ma ky in kw b gy mv mw l mx my">const setEnv = () =&gt; {<br/>  const fs = require('fs');<br/>  const writeFile = fs.writeFile;<br/>// Configure Angular `environment.ts` file path<br/>  const targetPath = './src/environments/environment.ts';<br/>// Load node modules<br/>  const colors = require('colors');<br/>  const appVersion = require('../../package.json').version;<br/>  require('dotenv').config({<br/>    path: 'src/environments/.env'<br/>  });<br/>// `environment.ts` file structure<br/>  const envConfigFile = `export const environment = {<br/>  googleApiKey: '${process.env.GOOGLE_API_KEY}',<br/>  auth0ClientId: '${process.env.AUTH0_CLIENT_ID}',<br/>  appVersion: '${appVersion}',<br/>  production: true,<br/>};<br/>`;<br/>  console.log(colors.magenta('The file `environment.ts` will be written with the following content: \n'));<br/>  writeFile(targetPath, envConfigFile, (err) =&gt; {<br/>    if (err) {<br/>      console.error(err);<br/>      throw err;<br/>    } else {<br/>      console.log(colors.magenta(`Angular environment.ts file generated correctly at ${targetPath} \n`));<br/>    }<br/>  });<br/>};</span><span id="73d5" class="ma ky in kw b gy mz mw l mx my">setEnv();</span></pre><p id="82bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看这里发生了什么。</p><ul class=""><li id="22aa" class="nd ne in jx b jy jz kc kd kg nf kk ng ko nh ks ni nj nk nl bi translated"><code class="fe kt ku kv kw b">process.env</code>提供对Node.js中的环境变量的访问，因此构建机器上存在的任何变量都可以通过它获得。</li><li id="113b" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated">让我们创建一个文件并将内容写入其中。在本例中，生成environment.ts文件。</li><li id="a195" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated">作为奖励，我正在阅读<code class="fe kt ku kv kw b">package.json</code>，这样我就可以得到它的版本。这样，我们可以在UI中显示一个版本号。当将版本控制作为发布周期的一部分时，这种技术很方便。</li><li id="da17" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated"><code class="fe kt ku kv kw b">targetPath</code>指向目标文件应该存在的位置。</li><li id="0698" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated"><code class="fe kt ku kv kw b">envConfigFile</code>常量是一个模板文字，提供了<code class="fe kt ku kv kw b">environment.ts</code>文件的模板和内容。你可以在这里指定你想要的<code class="fe kt ku kv kw b">environment.ts</code>中的变量。</li><li id="8401" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated"><code class="fe kt ku kv kw b">console.log</code>是为了便于调试时查看文件生成的输出。确保不要在此记录敏感数据。构建完成后，日志通常会保留很长时间。</li><li id="716c" class="nd ne in jx b jy nm kc nn kg no kk np ko nq ks ni nj nk nl bi translated"><code class="fe kt ku kv kw b">dotenv</code>包可以加载一个<code class="fe kt ku kv kw b">.env</code>文件，这样你就可以访问你在那个文件中定义的变量。这个技巧有助于管理私有构建服务器，甚至是在本地开发机器上构建。如果<code class="fe kt ku kv kw b">dotenv</code>没有在指定位置找到文件，脚本不会失败。因此，您可以将它留在那里，以支持本地机器构建和基于云的CI/CDs。</li></ul><h1 id="7ed8" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">自动化it</h1><p id="fdcd" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">要把这些东西粘在一起，我们还需要做两件事。</p><ul class=""><li id="96d8" class="nd ne in jx b jy jz kc kd kg nf kk ng ko nh ks ni nj nk nl bi translated">首先，我们需要添加一个npm脚本来运行我们新添加的代码。这里，新的<code class="fe kt ku kv kw b">config</code> npm脚本将运行我们的代码。我们还为<code class="fe kt ku kv kw b">build</code>更新了npm脚本，以便在构建之前运行<code class="fe kt ku kv kw b">config</code>。</li></ul><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="33d7" class="ma ky in kw b gy mv mw l mx my">{<br/>  "name": "ionic-angular-cesium-3d-map",<br/>  "version": "0.0.1",<br/>  "author": "Ionic Framework",<br/>  "homepage": "https://ionicframework.com/",<br/>  "scripts": {<br/>    "ng": "ng",<br/>    "start": "ng serve",<br/>    "build": "npm run config &amp;&amp; ng build",<br/>    "config": "ts-node src/environments/set-env.ts",<br/>    "test": "ng test",<br/>    "lint": "ng lint",<br/>    "e2e": "ng e2e"<br/>  }<br/>}</span></pre><ul class=""><li id="2b8b" class="nd ne in jx b jy jz kc kd kg nf kk ng ko nh ks ni nj nk nl bi translated">最后但同样重要的是，我们需要从源代码中忽略生成的<code class="fe kt ku kv kw b">environment.ts</code>文件和<code class="fe kt ku kv kw b">.env</code>文件。更新您的<code class="fe kt ku kv kw b">.gitignore</code>以包含这些文件。</li></ul><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="df66" class="ma ky in kw b gy mv mw l mx my">src/environments/environment.ts <br/>src/environments/.env</span></pre><p id="0a5c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完成这些步骤后，当您运行<code class="fe kt ku kv kw b">build</code>或<code class="fe kt ku kv kw b">config</code> npm脚本时，它将生成一个<code class="fe kt ku kv kw b">environment.ts</code>并将其放在<code class="fe kt ku kv kw b">environment</code>文件夹中。文件内容会是这样的。</p><pre class="mn mo mp mq gt mr kw ms mt aw mu bi"><span id="5412" class="ma ky in kw b gy mv mw l mx my">export const environment = {<br/>    googleApiKey: 'YOUR_ACTUAL_GOOGLE_API_KEY_FROM_ENV_VARIABLES',<br/>    auth0ClientId: 'YOUR_ACTUAL_AUTH0_CLIENT_ID_FROM_ENV_VARIABLES',<br/>    appVersion: '1.0.0',<br/>    production: true,<br/>};</span></pre><p id="0619" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样。现在，您可以在Angular项目中访问这些环境配置。</p><h1 id="59d4" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="0149" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">我们学会了如何将操作层面<code class="fe kt ku kv kw b">Environment variables</code>与角度层面<code class="fe kt ku kv kw b">environment.ts</code>相结合，以达到两全其美并保护我们的秘密。</p><p id="8305" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于可能需要在不同构建机器上共享的秘密，有更多的方法可以使保存和共享秘密更加方便。我们在这篇文章中读到的只是第一步。</p><p id="4821" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读。像往常一样，如果你有任何问题，请在这里给我留言或在Twitter上给我发DM。</p><h1 id="ffb5" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">资源</h1><p id="b757" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">如果你需要一个利用这个解决方案的例子，请参考我的离子&amp;铯三维地图的例子。</p><p id="9e0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个项目使用相同的技术来隐藏源代码中使用的<code class="fe kt ku kv kw b">cesiumAccessToken</code>。</p><p id="25fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该项目构建于Vercel之上，并使用Vercel环境变量来提供cesiumAccessToken。</p><p id="9959" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是代码库:<a class="ae mm" href="https://github.com/pazel-io/ionic-angular-cesium-3d-map" rel="noopener ugc nofollow" target="_blank">离子角铯3d地图</a></p><h1 id="5c5a" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">接触</h1><p id="0c78" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">推特:<a class="ae mm" href="https://twitter.com/home" rel="noopener ugc nofollow" target="_blank">_帕泽尔</a></p><p id="9de6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nr">更多内容尽在</em><a class="ae mm" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nr">plain English . io</em></strong></a></p></div></div>    
</body>
</html>