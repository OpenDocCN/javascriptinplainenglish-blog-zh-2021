<html>
<head>
<title>A TypeScript Runtime Data Validators Comparison</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript运行时数据验证器比较</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-15f0ea2e3265?source=collection_archive---------8-----------------------#2021-03-16">https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-15f0ea2e3265?source=collection_archive---------8-----------------------#2021-03-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6d2f" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第四部分:是的</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/85897810ffbe8fc98a4e441c9a5b07fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I2Z806lZtMovGFbtwgLw3A.jpeg"/></div></div></figure><p id="5ee3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是基于我的实践经验的运行时数据验证器比较系列报告的第4篇。在继续本系列的其余部分之前，您应该阅读第一篇文章中的介绍，以理解制作该报告所涉及的目标和测试方法。</p><ol class=""><li id="b685" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-50a6abf3c559">简介</a></li><li id="effe" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-eeedc6b0583a"> io-ts </a></li><li id="c4bd" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-c422e431926a"> joi </a></li><li id="dda3" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated">是的</li><li id="0f65" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-cdbb532f0b89"> ajv </a></li><li id="436f" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated">佐德</li><li id="442e" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-67cb9abb599b">超级结构</a></li></ol><h1 id="9383" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">介绍</h1><p id="9c63" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Yup“深受joi的启发”，在很多方面与joi相似。然而，它声称“比joi更精简，以客户端验证为主要用例”。</p><h1 id="0428" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">设计目标的实现</h1><h2 id="8d81" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">1.一个定义，多种用途——通过小故障实现</h2><p id="9672" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Yup提供现成的类型推断。事实上，它更进一步，通过提供两个类型推断操作符，<code class="fe ni nj nk nl b">yup.TypeOf&lt;typeof schema&gt;</code>和<code class="fe ni nj nk nl b">yup.Asserts&lt;typeof schema&gt;</code>，分别提取可能是<strong class="kq io">转换(类型强制)</strong>结果的数据类型，以及将通过验证的<strong class="kq io">输入数据的类型。</strong></p><p id="f4ae" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面显示了“Person”模式是如何定义的。请注意，yup API与joi API是多么相似。另外，请注意“性别”属性的定义有点绕弯。它可以被更简单地定义，但是“性别”属性的推断类型将只是字符串，而不是文字类型的联合。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/10bf81d9803b9b34d32e81cfaf738d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sO4fPMi4KqoRtX5KEcLhVw.png"/></div></div></figure><p id="2b55" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">类型推理通常是可行的，但也有一些小问题。下面是从Person模式推断出的类型。注意,“sex”属性不是可选的，与模式不匹配。如果我在调用链的末尾添加一个<code class="fe ni nj nk nl b">.optional()</code>，那么“sex”属性的推断类型将变成<code class="fe ni nj nk nl b">any</code>。此外，<code class="fe ni nj nk nl b">TypeOf</code>操作符似乎只是将<code class="fe ni nj nk nl b">undefined</code>添加到由<code class="fe ni nj nk nl b">Asserts</code>操作符推断出的类型的联合中。在<a class="ae lt" href="https://colinhacks.com/essays/zod" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中对yup的类型推断的批评比较多。</p><p id="df05" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">yup文档承认“由于yup的动态性，并不是所有东西都可以安全地进行统计”，但认为它对大多数情况来说“足够好了”。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ad1f302fccea6a3ce6ee176619ade9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*J3PmbAjzxIidK-LqlDPd2A.png"/></div></figure><h2 id="0edb" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">2.可组合和可扩展的模式—已实现</h2><p id="53be" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">与joi类似,“Driver”模式是通过扩展“Person”模式定义的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/7a00f40ad2adaea2d89b2d8a2f8ca122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*F9YvPn4jQG-fzfUExPpXZQ.png"/></div></figure><p id="3944" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">“车队”模式是通过组装“驾驶员”和“车辆”模式来定义的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi np"><img src="../Images/128efc911e2cd6076dad102f633a44d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*w-40qtOZ_20uflGP1bR3gA.png"/></div></figure><p id="953d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是从Fleet模式推断出的类型在VS Code代码辅助中的样子，不是很整洁漂亮。然而，当用于类型检查时，推断的类型仍然可以工作——只是有一些小问题。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/ca84d2168fcf647559b23ed283a2f8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*925rLLMeW3jCm5pITgASzQ.png"/></div></div></figure><h2 id="60fb" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">3.丰富的功能集—已实现</h2><p id="36cc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Yup提供了丰富的开箱即用的特性。</p><h2 id="42dd" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">4.完成和中止-早期验证-已实现</h2><p id="9cd7" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">与joi类似，yup也接受一个<code class="fe ni nj nk nl b">abortEarly</code>选项来选择执行完整验证还是提前中止验证。完整验证的结果提供了数据中发现的所有故障的详细信息。下面是无效车队对象的验证结果的一部分。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/56cf43b49da63ed1eb86216bd31910bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvWoZ7O55zzH6NNhZJxB9Q.png"/></div></div></figure><h2 id="c0e7" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">5.可组合和可定制—存档</h2><p id="16ba" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">组合验证关键字和添加自定义验证函数非常容易。</p><p id="2548" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是PersonForm模式定义，带有一个自定义函数来验证重复密码是否与密码相同。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ns"><img src="../Images/57774b55829ff9710a5cc24108388a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGdZOjk4NVQVsrfbF3S__w.png"/></div></div></figure><h2 id="19bc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">6.类型强制和默认—已实现</h2><p id="a403" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">与joi类似，默认情况下，yup执行类型强制。如果不需要，可以通过在模式中链接一个<code class="fe ni nj nk nl b">.strict(true)</code>来跳过类型强制来关闭它。</p><p id="254a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了提供默认值，在模式中链接一个<code class="fe ni nj nk nl b">default()</code>调用。请参见上面Person模式中定义的“性别”属性作为示例。</p><h2 id="09cc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">7.可遍历模式—已实现</h2><p id="4ecc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">模式的内部配置可以通过调用它的<code class="fe ni nj nk nl b">describe()</code>方法来公开。可以在项目的<code class="fe ni nj nk nl b">/solutions/yup</code>目录下的<code class="fe ni nj nk nl b">traversable.test.ts</code>测试用例中找到对yup模式的探索演示。</p><h2 id="419a" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">8.标准—否</h2><h1 id="71c4" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">摘要</h1><p id="9bad" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Yup深受joi的启发，两者都以其流畅的API和丰富的现成特性提供了良好的开发人员体验。Yup进一步为TypeScript提供了类型推断。然而，当模式变得有点复杂时，yup类型推理也有其缺陷。</p><p id="aff0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Yup声称是joi的更精简和浏览器友好的替代品。yup和joi之间的相似性使得从一个转换到另一个很容易。</p></div></div>    
</body>
</html>