<html>
<head>
<title>Creating AMP Pages with Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js创建AMP页面</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/next-js-amp-list-65b27cef0db6?source=collection_archive---------5-----------------------#2021-01-02">https://javascript.plainenglish.io/next-js-amp-list-65b27cef0db6?source=collection_archive---------5-----------------------#2021-01-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="163f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在web开发者必须更快的建立web负载，提高用户体验和搜索引擎排名，少做跳出率，多做流量。AMP页面几乎可以立即加载，所以让我们用下一个Js试试AMP页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0f9a53d60052bdb3422701faa4623da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TbrbBfwBVJyyq7Gl"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Roman Synkevych</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c6b0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我使用的是来自<a class="ae ky" href="https://medium.com/javascript-in-plain-english/styled-components-in-next-js-9a4e84278bdb" rel="noopener">上一篇文章</a>的现有项目。我们将会使口袋妖怪列表变得更加有趣。你可以在这里克隆<a class="ae ky" href="https://github.com/jetlysandita/medium_pokemon" rel="noopener ugc nofollow" target="_blank">并使用分支风格的组件。</a></p><h1 id="820d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">1.启用放大器</h1><p id="94ff" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">要启用AMP支持，您必须将此代码添加到页面文件中。例如<strong class="jm io"> index.js. </strong></p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="167b" class="mh la in md b gy mi mj l mk ml">export const config = { amp: true }</span></pre><p id="54bc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ky" href="https://nextjs.org/docs/api-reference/next/amp" rel="noopener ugc nofollow" target="_blank">更多相关信息</a></p><p id="9a96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<a class="ae ky" href="https://chrome.google.com/webstore/detail/amp-validator/nmoffdblmcmgeicmolmhobpoocbbmknc?hl=en" rel="noopener ugc nofollow" target="_blank">放大器验证器</a>检查您的放大器页面工作。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mm"><img src="../Images/779f0edf1ed7aed66aed0f654293d436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMtuj8bJAr094QnZYsdGzw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image By <a class="ae ky" href="https://jetlysandita.medium.com/" rel="noopener">Jetly Sandita</a></figcaption></figure><p id="a1aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者你可以检查控制台。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="683c" class="mh la in md b gy mi mj l mk ml">Powered by AMP ⚡ HTML – Version 2011252111003 <a class="ae ky" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></span></pre><p id="0a8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您看到来自AMP验证器的错误，您必须修复它，但这一点。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="fe4f" class="mh la in md b gy mi mj l mk ml">Tag 'html' marked with attribute 'data-ampdevmode'. Validator will suppress errors regarding any other tag with this attribute.</span></pre><p id="9f29" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以忽略它，因为它是在构建后修复的。在我们的情况下，我们必须解决这个问题。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="3c3f" class="mh la in md b gy mi mj l mk ml">The attribute 'height' may not appear in tag 'div'.</span></pre><p id="d239" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用道具时要小心，将<strong class="jm io">高度</strong>改为<strong class="jm io">自定义高度。</strong></p><h1 id="7801" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">2.将列表更改为AMP列表</h1><p id="9081" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在此参见<a class="ae ky" href="https://amp.dev/documentation/components/amp-list/?format=websites" rel="noopener ugc nofollow" target="_blank">文档</a>。更改文件<strong class="jm io"> index.js. </strong></p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f4d6" class="mh la in md b gy mi mj l mk ml">import MainLayout from "../layouts/MainLayout";</span><span id="4d44" class="mh la in md b gy mn mj l mk ml">export const config = { amp: true };</span><span id="4420" class="mh la in md b gy mn mj l mk ml">export default function Home(props) {</span><span id="8605" class="mh la in md b gy mn mj l mk ml">const { data } = props;</span><span id="3338" class="mh la in md b gy mn mj l mk ml">return (</span><span id="7221" class="mh la in md b gy mn mj l mk ml">&lt;MainLayout&gt;</span><span id="4536" class="mh la in md b gy mn mj l mk ml">&lt;amp-state id="localState"&gt;</span><span id="37d2" class="mh la in md b gy mn mj l mk ml">&lt;script</span><span id="ea14" class="mh la in md b gy mn mj l mk ml">type="application/json"</span><span id="651c" class="mh la in md b gy mn mj l mk ml">dangerouslySetInnerHTML={{</span><span id="79de" class="mh la in md b gy mn mj l mk ml">__html: `</span><span id="8ac5" class="mh la in md b gy mn mj l mk ml">{</span><span id="381a" class="mh la in md b gy mn mj l mk ml">"items": ${JSON.stringify(data.results)}</span><span id="61da" class="mh la in md b gy mn mj l mk ml">}</span><span id="8a22" class="mh la in md b gy mn mj l mk ml">`,</span><span id="3610" class="mh la in md b gy mn mj l mk ml">}}</span><span id="66a7" class="mh la in md b gy mn mj l mk ml">/&gt;</span><span id="822f" class="mh la in md b gy mn mj l mk ml">&lt;/amp-state&gt;</span><span id="f244" class="mh la in md b gy mn mj l mk ml">&lt;amp-list</span><span id="3a48" class="mh la in md b gy mn mj l mk ml">width="auto"</span><span id="1069" class="mh la in md b gy mn mj l mk ml">height="100"</span><span id="a6f3" class="mh la in md b gy mn mj l mk ml">layout="fixed-height"</span><span id="0e52" class="mh la in md b gy mn mj l mk ml">src="amp-state:localState"</span><span id="48c9" class="mh la in md b gy mn mj l mk ml">&gt;</span><span id="609f" class="mh la in md b gy mn mj l mk ml">&lt;template type="amp-mustache"&gt;</span><span id="9eee" class="mh la in md b gy mn mj l mk ml">&lt;div&gt;</span><span id="8976" class="mh la in md b gy mn mj l mk ml">&lt;a href="{{url}}"&gt;{`{{ name }}`}&lt;/a&gt;</span><span id="0adb" class="mh la in md b gy mn mj l mk ml">&lt;/div&gt;</span><span id="3792" class="mh la in md b gy mn mj l mk ml">&lt;/template&gt;</span><span id="3638" class="mh la in md b gy mn mj l mk ml">&lt;/amp-list&gt;</span><span id="b3aa" class="mh la in md b gy mn mj l mk ml">&lt;/MainLayout&gt;</span><span id="e67d" class="mh la in md b gy mn mj l mk ml">);</span><span id="b0d8" class="mh la in md b gy mn mj l mk ml">}</span><span id="8992" class="mh la in md b gy mn mj l mk ml">export async function getServerSideProps() {</span><span id="ad5e" class="mh la in md b gy mn mj l mk ml">// Fetch data from external API</span><span id="5a8a" class="mh la in md b gy mn mj l mk ml">const res = await fetch(`${process.env.baseUrlApi}pokemon?limit=10`);</span><span id="5f01" class="mh la in md b gy mn mj l mk ml">const data = await res.json();</span><span id="a1c1" class="mh la in md b gy mn mj l mk ml">// Pass data to the page via props</span><span id="e082" class="mh la in md b gy mn mj l mk ml">return { props: { data } };</span><span id="c20e" class="mh la in md b gy mn mj l mk ml">}</span></pre><p id="3096" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你的API有这样的格式，那就更简单了。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="3797" class="mh la in md b gy mi mj l mk ml">{<br/>  "items": [...],<br/>  "next": "url"<br/>}</span></pre><h1 id="2d75" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.加载更多</h1><p id="de8d" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">如果你的API有正确的格式，你只能这样做。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="919e" class="mh la in md b gy mi mj l mk ml">&lt;amp-list<br/>  load-more="manual"<br/>  src="url"<br/>  width="400"<br/>  height="800"<br/>  load-more-bookmark="next"</span><span id="c4a3" class="mh la in md b gy mn mj l mk ml">&gt;  <br/>  ...<br/>&lt;/amp-list&gt;</span></pre><p id="541f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果没有，在文件夹API里面创建一个文件<strong class="jm io"> pokemon.js </strong>。安装查询字符串</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="198c" class="mh la in md b gy mi mj l mk ml">yarn add query-string</span></pre><p id="0bd2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这样写代码<strong class="jm io"> pokemon.js </strong>。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="016a" class="mh la in md b gy mi mj l mk ml">// Next.js API route support: https://nextjs.org/docs/api-routes/introduction</span><span id="02ef" class="mh la in md b gy mn mj l mk ml">import queryString from "query-string";</span><span id="0bde" class="mh la in md b gy mn mj l mk ml">async function handle(req, res) {</span><span id="5b63" class="mh la in md b gy mn mj l mk ml">const { query } = req;</span><span id="8e16" class="mh la in md b gy mn mj l mk ml">const urlParam = queryString.stringify(query);</span><span id="7fd2" class="mh la in md b gy mn mj l mk ml">try {</span><span id="c7f9" class="mh la in md b gy mn mj l mk ml">const resultApi = await fetch(</span><span id="a6f4" class="mh la in md b gy mn mj l mk ml">`${process.env.baseUrlApi}pokemon?${urlParam || `limit=5`}`,</span><span id="43e8" class="mh la in md b gy mn mj l mk ml">);</span><span id="dc33" class="mh la in md b gy mn mj l mk ml">const data = await resultApi.json();</span><span id="3750" class="mh la in md b gy mn mj l mk ml">const oldNext = new URL(data.next);</span><span id="244b" class="mh la in md b gy mn mj l mk ml">res.statusCode = 200;</span><span id="ecda" class="mh la in md b gy mn mj l mk ml">res.json({</span><span id="02b5" class="mh la in md b gy mn mj l mk ml">items: data.results,</span><span id="54a9" class="mh la in md b gy mn mj l mk ml">next: `/api/pokemon${oldNext.search}`,</span><span id="fb29" class="mh la in md b gy mn mj l mk ml">});</span><span id="93c1" class="mh la in md b gy mn mj l mk ml">} catch (error) {</span><span id="fae8" class="mh la in md b gy mn mj l mk ml">res.statusCode = 500;</span><span id="de35" class="mh la in md b gy mn mj l mk ml">res.json({ error });</span><span id="87a3" class="mh la in md b gy mn mj l mk ml">}</span><span id="83b4" class="mh la in md b gy mn mj l mk ml">}</span><span id="d360" class="mh la in md b gy mn mj l mk ml">export default handle;</span></pre><p id="ee12" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">把<strong class="jm io"> index.js </strong>也改一下。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="e389" class="mh la in md b gy mi mj l mk ml">import MainLayout from "../layouts/MainLayout";</span><span id="0ca1" class="mh la in md b gy mn mj l mk ml">export const config = { amp: true };</span><span id="d751" class="mh la in md b gy mn mj l mk ml">export default function Home() {</span><span id="0bd0" class="mh la in md b gy mn mj l mk ml">return (</span><span id="ef4b" class="mh la in md b gy mn mj l mk ml">&lt;MainLayout&gt;</span><span id="19b7" class="mh la in md b gy mn mj l mk ml">&lt;amp-list</span><span id="dd8d" class="mh la in md b gy mn mj l mk ml">load-more="manual"</span><span id="1dd2" class="mh la in md b gy mn mj l mk ml">width="auto"</span><span id="23c0" class="mh la in md b gy mn mj l mk ml">height="100"</span><span id="3e5b" class="mh la in md b gy mn mj l mk ml">src="/api/pokemon"</span><span id="eb3c" class="mh la in md b gy mn mj l mk ml">load-more-bookmark="next"</span><span id="89d1" class="mh la in md b gy mn mj l mk ml">&gt;</span><span id="0713" class="mh la in md b gy mn mj l mk ml">&lt;template type="amp-mustache"&gt;</span><span id="30b8" class="mh la in md b gy mn mj l mk ml">&lt;div&gt;</span><span id="b2bf" class="mh la in md b gy mn mj l mk ml">&lt;a href="{{url}}"&gt;{`{{ name }}`}&lt;/a&gt;</span><span id="31b3" class="mh la in md b gy mn mj l mk ml">&lt;/div&gt;</span><span id="ded0" class="mh la in md b gy mn mj l mk ml">&lt;/template&gt;</span><span id="4ddd" class="mh la in md b gy mn mj l mk ml">&lt;/amp-list&gt;</span><span id="ecd0" class="mh la in md b gy mn mj l mk ml">&lt;/MainLayout&gt;</span><span id="e069" class="mh la in md b gy mn mj l mk ml">);</span><span id="628b" class="mh la in md b gy mn mj l mk ml">}</span></pre><p id="b2e6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们不需要它。点击按钮<strong class="jm io">查看更多</strong>我们可以得到另一个口袋妖怪。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mr"><img src="../Images/20b267d1802d13756cf553711d4761c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3cJzLeN-0SGf5LJJ8CSPw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image By <a class="ae ky" href="https://jetlysandita.medium.com/" rel="noopener">Jetly Sandita</a></figcaption></figure><p id="432d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我修改了样式，所以你可以在这里克隆它。</p><p id="8a4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:</p><p id="7877" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果在yarn构建时，在文件<strong class="jm io">node _ modules/@ amp project/toolbox-optimizer/lib/htmldomhelper . js</strong>中出现错误<strong class="jm io">无法读取skipNodeAndChildren </strong>处null <br/>的属性‘next sibling’。我不知道这是不是一个错误，但现在，要解决这个问题，你可以在下一个放大器列表中添加放大器布局。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="baad" class="mh la in md b gy mi mj l mk ml">import PokemonCard from "../components/PokemonCard";</span><span id="fbc3" class="mh la in md b gy mn mj l mk ml">import MainLayout from "../layouts/MainLayout";</span><span id="73cd" class="mh la in md b gy mn mj l mk ml">export const config = { amp: true };</span><span id="9bea" class="mh la in md b gy mn mj l mk ml">export default function Home() {</span><span id="631a" class="mh la in md b gy mn mj l mk ml">return (</span><span id="7955" class="mh la in md b gy mn mj l mk ml">&lt;MainLayout&gt;</span><span id="217e" class="mh la in md b gy mn mj l mk ml">&lt;amp-list</span><span id="f66a" class="mh la in md b gy mn mj l mk ml">load-more="manual"</span><span id="6d9f" class="mh la in md b gy mn mj l mk ml">width="auto"</span><span id="904f" class="mh la in md b gy mn mj l mk ml">height="80"</span><span id="0433" class="mh la in md b gy mn mj l mk ml">src="/api/pokemon"</span><span id="38bd" class="mh la in md b gy mn mj l mk ml">load-more-bookmark="next"</span><span id="19b5" class="mh la in md b gy mn mj l mk ml">&gt;</span><span id="0949" class="mh la in md b gy mn mj l mk ml">&lt;template type="amp-mustache"&gt;</span><span id="bad6" class="mh la in md b gy mn mj l mk ml">&lt;PokemonCard url="{{url}}" name="{{name}}" /&gt;</span><span id="1bd0" class="mh la in md b gy mn mj l mk ml">&lt;/template&gt;</span><span id="868a" class="mh la in md b gy mn mj l mk ml">&lt;/amp-list&gt;</span><span id="3a4b" class="mh la in md b gy mn mj l mk ml">&lt;amp-layout layout="responsive" width="0" height="0"&gt;&lt;/amp-layout&gt;</span><span id="bfc1" class="mh la in md b gy mn mj l mk ml">&lt;/MainLayout&gt;</span><span id="5c31" class="mh la in md b gy mn mj l mk ml">);</span><span id="c497" class="mh la in md b gy mn mj l mk ml">}</span></pre><p id="a0ae" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我将分享另一个AMP组件，主题，扩展库组件的样式组件，等等。</p><p id="ca24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你知道任何其他方法，建议或问题，请在下面评论。谢谢:)</p></div></div>    
</body>
</html>