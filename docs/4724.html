<html>
<head>
<title>How to Create a “Read More” Collapsible Component in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中创建“阅读更多”可折叠组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-read-more-collapsible-component-in-reactjs-6d55fbc4ff0f?source=collection_archive---------1-----------------------#2021-09-21">https://javascript.plainenglish.io/creating-a-read-more-collapsible-component-in-reactjs-6d55fbc4ff0f?source=collection_archive---------1-----------------------#2021-09-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c0b5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">WebKit-线夹方式</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bafdc6531caa0dc4f88d741a6a75004a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iT56ALD8FSxuYJa7"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@jamie452?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jamie Street</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4f31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在过去，为了确定单行文本的高度/宽度，您必须做各种各样的工作(在您的字体大小中，根据您的字体类型，给出容器的宽度)。您可以在JavaScript代码中创建一个canvas元素，呈现文本并从中进行测量。如今，尽管仍然以厂商为前缀，<code class="fe lp lq lr ls b">line-clamp</code>提供了一个更加优雅的CSS驱动的解决方案——样式表完成了所有繁重的工作，我们所需要做的就是指定我们想要显示的行数。我将尝试在React应用程序的上下文中传达我实现它的方式。如果您想跳过这一步查看完整的解决方案(只是复制粘贴)，欢迎您基于这个<a class="ae ks" href="https://codepen.io/sinia-nimevi/pen/mdwLJXp?editors=1111" rel="noopener ugc nofollow" target="_blank">模板</a>进行工作。如果你不确定是否应该使用线夹，这些可以帮助你决定:</p><ul class=""><li id="ca19" class="lt lu in kv b kw kx kz la lc lv lg lw lk lx lo ly lz ma mb bi translated"><a class="ae ks" href="https://caniuse.com/?search=line-clamp" rel="noopener ugc nofollow" target="_blank">我可以用</a> <code class="fe lp lq lr ls b">line-clamp</code>吗？</li><li id="1d69" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated"><a class="ae ks" href="https://caniuse.com/?search=box-orient" rel="noopener ugc nofollow" target="_blank">我可以用</a>T2吗？</li></ul><p id="9a32" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我认为<a class="ae ks" href="https://caniuse.com/" rel="noopener ugc nofollow" target="_blank">can use</a>stats还不错(现在是2021年9月)，但这完全取决于你的用例。不管怎样，让我们开始吧。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mh"><img src="../Images/8723f9a7cba46164bd803d9545050610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KPzjVDLaqW9Lk0TN2_3WSg.gif"/></div></div></figure><h1 id="3455" class="mi mj in bd mk ml mm mn mo mp mq mr ms jt mt ju mu jw mv jx mw jz mx ka my mz bi translated">造型</h1><p id="a3f5" class="pw-post-body-paragraph kt ku in kv b kw na jo ky kz nb jr lb lc nc le lf lg nd li lj lk ne lm ln lo ig bi translated">简单的部分是造型。Mozzila有一个很好的<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/CSS/-webkit-line-clamp" rel="noopener ugc nofollow" target="_blank">指南</a>详细介绍，但是出于我们这篇文章的目的，我将只分享下面的片段。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="944c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将有条件地将这个CSS类应用于我们的元素，因为我们希望我们的组件能够在“多读”和“少读”状态之间切换。</p><h1 id="b33c" class="mi mj in bd mk ml mm mn mo mp mq mr ms jt mt ju mu jw mv jx mw jz mx ka my mz bi translated">该组件</h1><p id="34dd" class="pw-post-body-paragraph kt ku in kv b kw na jo ky kz nb jr lb lc nc le lf lg nd li lj lk ne lm ln lo ig bi translated">我们希望组件能够:</p><ul class=""><li id="0a4c" class="lt lu in kv b kw kx kz la lc lv lg lw lk lx lo ly lz ma mb bi translated">显示文本</li><li id="6ce0" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">将文本限制在特定的行数</li><li id="0b10" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">点击“阅读更多”时显示整个文本</li><li id="567d" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">点击“少读”时再次显示删节版</li><li id="a609" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated"><em class="nh">不</em>当文本长度不需要箝位时，渲染多读/少读按钮</li></ul><p id="6da4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该组件需要两个内部状态，<code class="fe lp lq lr ls b">clamped</code>，这将决定文本当前是否被截断(这将决定按钮是“多读”还是“少读”，以及是否应用了<code class="fe lp lq lr ls b">.clamp</code> CSS，以及<code class="fe lp lq lr ls b">showButton</code>，这将根据是否有必要来有条件地呈现按钮(这由动态文本长度和容器的流体大小决定)。</p><p id="9c25" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一个简单的点击处理程序可以翻转<code class="fe lp lq lr ls b">clamped</code>状态:</p><p id="0db0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b">const handleClick = () =&gt; setClamped(!clamped);</code></p><p id="7ea2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个状态将反过来控制我们是否应用<code class="fe lp lq lr ls b">.clamp</code>类</p><p id="5b69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe lp lq lr ls b">&lt;div className={classnames(“long-text”, clamped &amp;&amp; “clamp”)}&gt;</code></p><p id="a73f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">像这样。</p><p id="2933" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">注意:</strong> <em class="nh">我喜欢用</em> <code class="fe lp lq lr ls b"><a class="ae ks" href="https://www.npmjs.com/package/classnames" rel="noopener ugc nofollow" target="_blank"><em class="nh">classnames</em></a></code> <em class="nh">包作为条件CSS类的简写(关于它的</em><a class="ae ks" href="https://bundlephobia.com/package/classnames@2.3.1" rel="noopener ugc nofollow" target="_blank"><em class="nh">bundle phobia report</em></a><em class="nh">是亲切的，我倾向于在不止一个地方使用它)。</em></p><p id="0284" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们在组件结构中或多或少地涵盖了以下内容:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="6c68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们想要:</p><ul class=""><li id="5e48" class="lt lu in kv b kw kx kz la lc lv lg lw lk lx lo ly lz ma mb bi translated"><em class="nh">不</em>当文本长度不需要箝位时呈现按钮</li><li id="86bd" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">检查是否在调整窗口大小时呈现按钮(如果文本的容器是可变宽度的，调整窗口大小时可能会改变给定文本呈现的有效行数)</li></ul><p id="d84c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以用一个<code class="fe lp lq lr ls b">useEffect</code>钩子来实现。我们希望能够与包含文本的元素的DOM实例进行交互。我们想要比较元素的<code class="fe lp lq lr ls b">clientHeight</code>和<code class="fe lp lq lr ls b">scrollHeight</code>。这是检查一个元素是否应用了CSS箝位的“聪明”方法。为了与元素的DOM实例交互并读取这些值，我们用一个<code class="fe lp lq lr ls b">ref</code> prop设置元素，并为它分配一个对我们的<code class="fe lp lq lr ls b">useRef</code> hook结果的引用。</p><p id="b02c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以我们定义了一个类似于<code class="fe lp lq lr ls b">const containerRef = useRef(null);</code>的<code class="fe lp lq lr ls b">containerRef</code>常量，并将文本容器元素的<code class="fe lp lq lr ls b">ref</code>属性设置为<code class="fe lp lq lr ls b">ref={containerRef}</code>。鉴于这种设置，我们的<code class="fe lp lq lr ls b">useEffect</code>钩子将如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><ul class=""><li id="b910" class="lt lu in kv b kw kx kz la lc lv lg lw lk lx lo ly lz ma mb bi translated">我们根据对元素执行的检查来检查按钮是否可用——这就是<code class="fe lp lq lr ls b">hasClamping</code>函数。因此，如果一个元件应用了夹紧(如果是这种情况，则<code class="fe lp lq lr ls b">clientHeight</code>和<code class="fe lp lq lr ls b">scrollHeight</code>不同)，我们显示按钮。</li><li id="ae98" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">我们使用组件负载上的<code class="fe lp lq lr ls b">checkButtonAvailability</code>函数来执行该检查。使用<code class="fe lp lq lr ls b"><a class="ae ks" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank">lodash</a></code>，当我们将调用添加到事件监听器时，我们<a class="ae ks" href="https://medium.com/walkme-engineering/debounce-and-throttle-in-real-life-scenarios-1cc7e2e38c68" rel="noopener">去抖</a>调用，这样它就不会被频繁调用。</li><li id="b79f" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">我们确保使用<code class="fe lp lq lr ls b">useEffect</code>清理返回函数来移除所述监听器(这将帮助我们避免内存泄漏)</li></ul><p id="b850" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，简单介绍一下<code class="fe lp lq lr ls b">checkButtonAvailability</code>功能。当变异一个由<code class="fe lp lq lr ls b">useRef</code>钩子创建的引用时，我们不会触发React渲染过程。这就是为什么暂时将类<code class="fe lp lq lr ls b">.clamp</code>添加到我们的元素是安全的，以便查看箝位是否适用。这很重要，因为有一个小错误—如果我们不这样做，我们可以:</p><ul class=""><li id="716a" class="lt lu in kv b kw kx kz la lc lv lg lw lk lx lo ly lz ma mb bi translated">将窗口调整到较小的宽度，强制夹紧。</li><li id="fc8e" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">之后，如果我们点击“阅读更多”,整个文本就会显示出来。</li><li id="af18" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">如果我们将窗口调整到更大的宽度，这个按钮就不再需要并被隐藏。</li><li id="8098" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">如果我们将窗口大小调整回小尺寸，将显示整个文本，并且不会呈现任何按钮。</li></ul><p id="2def" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了解决这个问题，我们必须暂时应用<code class="fe lp lq lr ls b">.clamp</code>，让CSS发挥它的魔力，检查箝位是否适用，并基于此渲染按钮。我们还保存了原始状态，这样我们就可以重新应用它，否则每次你调整窗口大小时，你就会把“读得少”默认为“读得多”，这也比预期的要少。</p><h1 id="68ad" class="mi mj in bd mk ml mm mn mo mp mq mr ms jt mt ju mu jw mv jx mw jz mx ka my mz bi translated">结论</h1><p id="4b72" class="pw-post-body-paragraph kt ku in kv b kw na jo ky kz nb jr lb lc nc le lf lg nd li lj lk ne lm ln lo ig bi translated">我认为，即使我们有一套解决常见问题的方法，偶尔与同事(或互联网)核实一下是否有新的解决方案，检查一下<a class="ae ks" href="https://caniuse.com/" rel="noopener ugc nofollow" target="_blank">caniuse.com</a>看看这是否会得到你的用例足够广泛的支持并更新你的知识总是一个好的做法。此外，尝试在每次重新发明轮子和只是盲目地用npm包堆积你的项目之间找到一个平衡。</p><p id="1228" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nh">希望你觉得我的文章有用，我已经试着扩展了一段代码，在生产中我不会太看重它，但是希望它的细节可以让某人成为更好的开发人员。如果你想讨论我的DMs永远开放——你可以在</em><a class="ae ks" href="https://twitter.com/SNimcevic" rel="noopener ugc nofollow" target="_blank"><em class="nh">Twitter</em></a><em class="nh">和</em><a class="ae ks" href="https://www.linkedin.com/in/sini%C5%A1a-nim%C4%8Devi%C4%87-5b438996/" rel="noopener ugc nofollow" target="_blank"><em class="nh">LinkedIn</em></a><em class="nh">上找到我。</em></p><h1 id="1a96" class="mi mj in bd mk ml mm mn mo mp mq mr ms jt mt ju mu jw mv jx mw jz mx ka my mz bi translated">资源</h1><ul class=""><li id="a1a8" class="lt lu in kv b kw na kz nb lc ni lg nj lk nk lo ly lz ma mb bi translated"><a class="ae ks" href="https://codepen.io/sinia-nimevi/pen/mdwLJXp?editors=1111" rel="noopener ugc nofollow" target="_blank">https://codepen.io/sinia-nimevi/pen/mdwLJXp?editors=1111</a></li><li id="33a2" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">https://caniuse.com/?search=line-clamp<a class="ae ks" href="https://caniuse.com/?search=line-clamp" rel="noopener ugc nofollow" target="_blank"/></li><li id="f11b" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated">【https://caniuse.com/?search=box-orient T4】</li><li id="d6da" class="lt lu in kv b kw mc kz md lc me lg mf lk mg lo ly lz ma mb bi translated"><a class="ae ks" href="https://lodash.com/" rel="noopener ugc nofollow" target="_blank">https://lodash.com/</a></li></ul><p id="914c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nh">更多内容请看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nh">plain English . io</em></strong></a></p></div></div>    
</body>
</html>