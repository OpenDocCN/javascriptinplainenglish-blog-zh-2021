<html>
<head>
<title>Pipes: The Angular feature that you didn’t know you needed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">管道:你不知道你需要的棱角特征</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/pipes-the-angular-feature-that-you-didnt-know-you-needed-e2ea7ba69fc9?source=collection_archive---------14-----------------------#2021-02-13">https://javascript.plainenglish.io/pipes-the-angular-feature-that-you-didnt-know-you-needed-e2ea7ba69fc9?source=collection_archive---------14-----------------------#2021-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3ada" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在Angular中开发时，您有时会发现需要在将值呈现在模板中之前对其进行转换。为了实现这一点，Angular内置了称为管道的功能。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/65842a12191f90703f8fead15cacbfb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*zwQSTE0XR6RtinjR2aZaug.jpeg"/></div></figure><h1 id="e06a" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">什么是有角的管道？</h1><p id="24e9" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正如在<a class="ae mb" href="https://angular.io/guide/pipes" rel="noopener ugc nofollow" target="_blank"> angular官方文档</a>中所解释的，在angular中，管道用于转换显示数据。管道是简单的函数，您可以在模板表达式中使用它来接受输入值并返回转换后的值。示例:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="3633" class="mh ko iq md b gy mi mj l mk ml">&lt;p&gt; My name is {{ name | uppercase }}&lt;/p&gt;</span></pre><h1 id="1106" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">为什么要用有棱角的管子？</h1><p id="4ef4" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要理解为什么管道在Angular中很重要，我们必须经历两件事；问题和坚实的软件设计原则。</p><p id="23ab" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated"><strong class="lh ir">问题:</strong></p><p id="7b83" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">假设你想在你的角组件中显示一个名字。通常，这可以通过在组件中创建一个函数来实现，该函数将首先执行更改，然后将值添加到变量中。</p><p id="927b" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">在<code class="fe mr ms mt md b">app.component.html</code>文件中:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="b5ae" class="mh ko iq md b gy mi mj l mk ml">export class AppComponent { <br/> name = 'JOhn DoE'; <br/> ngOnInit(): void { <br/>  name = this.titleCase(name) <br/> } </span><span id="8394" class="mh ko iq md b gy mu mj l mk ml"> titleCase(value: string) { <br/>  return value.replace( unicodeWordMatch, (txt =&gt; txt[0].toUpperCase() + txt.substr(1).toLowerCase())); <br/>  } <br/> }</span></pre><p id="8329" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">并且在<code class="fe mr ms mt md b">app.component.ts</code>文件中:</p><p id="aef9" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">输出将是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/f26230df3a95590ce8575b957d277057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BIqh110B9-1ex_lj.png"/></div></div></figure><p id="d89c" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">这种方法带来了所需的结果，但反过来，它会有几个问题。仅举几个例子:</p><ol class=""><li id="e4bc" class="na nb iq lh b li mm ll mn lo nc ls nd lw ne ma nf ng nh ni bi translated">该函数不可测试。如果我们要测试<strong class="lh ir"> titleCase </strong>方法，我们必须首先初始化整个组件及其依赖项。</li><li id="bb97" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">这违反了实体设计模式中的单一责任原则。这意味着，每个需要将文本转换为标题大小写的组件，都必须定义这个方法，然后用它来改变大小写。<strong class="lh ir"> titleCase </strong>方法将被重复重新定义。代码中的任何重复都有从长远角度消除维护和扩展代码的能力的风险。</li></ol><p id="9c02" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated"><strong class="lh ir">备选方案:</strong></p><p id="0fae" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">这两种情况的替代解决方案是在一个单独的<code class="fe mr ms mt md b">.ts</code>文件中创建<strong class="lh ir"> titleCase </strong>方法，然后将其导出并导入到您希望使用它的每个组件中。在<code class="fe mr ms mt md b">utils.ts</code>中:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="790c" class="mh ko iq md b gy mi mj l mk ml">function titleCase(value: string){ <br/> return value.replace( unicodeWordMatch, (txt =&gt; txt[0].toUpperCase() + txt.substr(1).toLowerCase())); <br/>} </span><span id="8c0f" class="mh ko iq md b gy mu mj l mk ml">export default titleCase</span></pre><p id="bb71" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">然后在<code class="fe mr ms mt md b">app.component.ts</code>中再次修改，首先导入<strong class="lh ir"> titleCase </strong>方法，然后像我们之前做的那样使用它，但是去掉了this关键字。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="b30f" class="mh ko iq md b gy mi mj l mk ml">... <br/>import titleCase from './utils'; </span><span id="bb5c" class="mh ko iq md b gy mu mj l mk ml">.... <br/>export class AppComponent { <br/> <br/> name = 'JOhn DoE'; <br/> <br/> ngOnInit(): void { <br/>  this.name = titleCase(this.name) <br/> } <br/>}</span></pre><p id="173e" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">而<code class="fe mr ms mt md b">app.component.html</code>保持不变。这个方法管用。但是它有一个或多个缺点。</p><ol class=""><li id="8dba" class="na nb iq lh b li mm ll mn lo nc ls nd lw ne ma nf ng nh ni bi translated">您必须在使用该方法的每个组件中导入该文件。这在重构过程中会变得非常乏味。对于那些主要需要改变模板的方法，组件不应该知道它。这就是为什么angular有自己的<a class="ae mb" href="https://angular.io/guide/dependency-injection" rel="noopener ugc nofollow" target="_blank">依赖注入机制</a></li><li id="fd0d" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma nf ng nh ni bi translated">您将不得不手动有策略地调用此方法来对更改做出反应，并将它们应用到模板。在上面的示例代码中，它被放在<strong class="lh ir"> ngOnInit </strong>方法中，该方法在组件初始化时应用大小写变化。它不知道变化检测。</li></ol><h1 id="de4a" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">管道救援，如何使用角形管道</h1><p id="0a6a" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">管道旨在解决上述所有挑战。总之，您创建了一个扩展Angular <strong class="lh ir"> PipeTransform </strong>类的管道类，您在<strong class="lh ir"> Transform </strong>方法中定义了您的逻辑，transform方法的返回值是将传递给模板的值。然后将管道导入到模块中，并使用它作为模板。</p><p id="0bbe" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">要创建管道，请使用Angular CLI生成管道。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="f5ce" class="mh ko iq md b gy mi mj l mk ml">ng g pipe title-case</span></pre><p id="3e80" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">该命令将创建一个带有<strong class="lh ir"> TitleCasePipe </strong>类样板文件的<code class="fe mr ms mt md b">title-case.pipe.ts</code>文件。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="b84c" class="mh ko iq md b gy mi mj l mk ml">import { Pipe, PipeTransform } from '@angular/core'; <br/>@Pipe({ <br/> name: 'titleCase' <br/>}) <br/>export class TitleCasePipe implements PipeTransform{</span><span id="1394" class="mh ko iq md b gy mu mj l mk ml"> transform(value: unknown, ...args: unknown[]): unknown { <br/>  return null; <br/> } <br/>}</span></pre><p id="1c5c" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">Angular将调用transform方法来执行转换。这就是我们的逻辑。该类将变成:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="b2a9" class="mh ko iq md b gy mi mj l mk ml">... <br/>export class TitleCasePipe implements PipeTransform {<br/> transform(value: string, ...args: unknown[]): string { <br/>  const unicodeWordMatch = /\w\S*/g; <br/>  return value.replace( unicodeWordMatch, (txt =&gt; txt[0].toUpperCase() + txt.substr(1).toLowerCase())); <br/> } <br/>}</span></pre><p id="d804" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">CLI generate命令还将对app模块进行修改，以便在声明中包含管道。在声明中包含管道将告诉angular在运行时加载它，这意味着不需要在同一个模块的组件中导入它。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="0eaf" class="mh ko iq md b gy mi mj l mk ml">... <br/>@NgModule({ <br/> declarations: [ <br/>  AppComponent, <br/>  TitleCasePipe <br/> ], <br/> imports: [ <br/>  BrowserModule <br/> ], <br/> providers: [], <br/> bootstrap: [<br/>  AppComponent<br/> ]}) export class AppModule { }</span></pre><p id="af24" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">对于app模块内的所有组件，titleCase管道都是可用的。</p><p id="fa59" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated"><strong class="lh ir">管道语法</strong></p><p id="a2d5" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">管道用在模板内部，直接转换数据。管道语法可以写成:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="f724" class="mh ko iq md b gy mi mj l mk ml">{{ variable | pipe1: argument1 : ... : argumentn | pipe2: arguments...}}</span></pre><ul class=""><li id="b133" class="na nb iq lh b li mm ll mn lo nc ls nd lw ne ma no ng nh ni bi translated"><strong class="lh ir">变量</strong> —要转换其值的变量的名称。在前面的例子中，变量是name。</li><li id="7a15" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma no ng nh ni bi translated"><strong class="lh ir"> pipe1 </strong> —变量将通过的管道的第一个名称。</li><li id="f202" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma no ng nh ni bi translated"><strong class="lh ir"> argument1到argumentn </strong> —应该传递给管道以帮助转换的值的列表。参数可以是多个，用分号分隔。</li><li id="f873" class="na nb iq lh b li nj ll nk lo nl ls nm lw nn ma no ng nh ni bi translated"><strong class="lh ir"> pipe2 </strong> —第一个返回值应该传递到的第二个管道。该值从左到右依次通过管道传递。</li></ul><p id="ab00" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">继续前面的例子，<code class="fe mr ms mt md b">app.component.html</code>中的代码变成了:</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="369c" class="mh ko iq md b gy mi mj l mk ml">&lt;h1&gt;hello {{name | titleCase}}&lt;/h1&gt;</span></pre><p id="0bd4" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">恭喜你，现在你已经成功制造了一个功能齐全的管道。</p><h1 id="eca1" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">管道和变化检测</h1><p id="7c79" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当由管道转换的变量的值通过任何DOM事件或角度变化检测系统识别的其他事件而改变时，角度将通过管道传递新值，并且转换后的值将被返回并相应地分配给HTML模板。</p><p id="40ad" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">这直接解决了我们试图自己编写函数时所面临的问题。而且它们本质上是可测试的，事实上，当您运行生成管道的命令时，它将生成两个类，其中一个是对管道的测试。</p><h1 id="40ae" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">何时使用角形管</h1><p id="ad72" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正如所定义、解释和演示的，Angular中的管道是在模板中转换数据的函数。每当你想在模板渲染前改变一些值时，管道是你的首选工具。</p><p id="d5d7" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated">此外，管道的广泛可重复使用性使其甚至适用于最大的应用。角船与伟大的管道开箱，您可以立即在您的项目中使用。对于核心库中没有的管道，Angular提供了非常简单的机制，可以使用Angular CLI生成您自己的定制管道。下面将演示其中一些管道。</p><h1 id="d612" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">开箱后装运的角形管道示例</h1><h2 id="c740" class="mh ko iq bd kp np nq dn kt nr ns dp kx lo nt nu kz ls nv nw lb lw nx ny ld nz bi translated">标题案例管道</h2><p id="6c01" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将文本转换为标题大小写。其中每个单词的第一个字母大写，其余字母小写。单词由空格字符分隔，如空格、制表符或换行符。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="bcd8" class="mh ko iq md b gy mi mj l mk ml">@Component({ <br/> selector: 'titlecase-pipe', <br/> template: `&lt;div&gt; <br/>  &lt;p&gt;{{'some string' | titlecase}}&lt;/p&gt; &lt;!-- output: "Some String"-&gt;<br/>  &lt;p&gt;{{'one,two,three' | titlecase}}&lt;/p&gt; &lt;!-- output: "One,two,three" -&gt; <br/>  &lt;p&gt;{{'true|false' | titlecase}}&lt;/p&gt; &lt;!-- output: "True|false" -&gt;<br/>  &lt;p&gt;{{'foo-vs-bar' | titlecase}}&lt;/p&gt; &lt;!-- output: "Foo-vs-bar" -&gt;<br/>  &lt;/div&gt;` <br/>}) <br/>export class TitleCasePipeComponent { }</span></pre><h2 id="b696" class="mh ko iq bd kp np nq dn kt nr ns dp kx lo nt nu kz ls nv nw lb lw nx ny ld nz bi translated">上下套管</h2><p id="6682" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">将任何文本/单词全部转换为小写。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="35c8" class="mh ko iq md b gy mi mj l mk ml">@Component({ <br/> selector: 'lowerupper-pipe', <br/> template: `&lt;div&gt; <br/>  &lt;p&gt;In lowercase: &lt;pre&gt;'{{"I will be loWERed" | lowercase}}'&lt;/pre&gt;<br/>  &lt;p&gt;In uppercase: &lt;pre&gt;'{{"I will be capitalized" | uppercase}}'&lt;/pre&gt; &lt;/div&gt;` }) <br/>export class LowerUpperPipeComponent { }</span></pre><h2 id="5860" class="mh ko iq bd kp np nq dn kt nr ns dp kx lo nt nu kz ls nv nw lb lw nx ny ld nz bi translated">百分比管道</h2><p id="b4c4" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">百分比管道会将百分比管道附加到任何数字，并返回一个字符串。</p><pre class="kg kh ki kj gt mc md me mf aw mg bi"><span id="4564" class="mh ko iq md b gy mi mj l mk ml">@Component({ <br/> selector: 'percent-pipe', <br/> template: `&lt;div&gt; <br/>  &lt;!--output '26%'--&gt; <br/>  &lt;p&gt;A: {{a | percent}}&lt;/p&gt; &lt;!--output '0,134.950%'--&gt; <br/>  &lt;p&gt;B: {{b | percent:'4.3-5'}}&lt;/p&gt; &lt;!--output '0 134,950 %'--&gt;<br/>  &lt;p&gt;B: {{b | percent:'4.3-5':'fr'}}&lt;/p&gt; &lt;/div&gt;` <br/>}) <br/>export class PercentPipeComponent { <br/>  a: number = 0.259; <br/>  b: number = 1.3495; <br/>}</span></pre><h1 id="67a0" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">结论</h1><p id="f5df" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过深入研究角形管道，您可以轻松地将它们应用到您的应用或项目中，并充分受益。Angular管道是使用Angular的额外好处之一，因为你很难在其他前端框架中找到相同的构造。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="4363" class="pw-post-body-paragraph lf lg iq lh b li mm jr lk ll mn ju ln lo mo lq lr ls mp lu lv lw mq ly lz ma ij bi translated"><em class="oh">原载于2021年2月13日</em><a class="ae mb" href="https://whenprogramming.com/angular-feature-you-didnt-know-you-needed-pipes/" rel="noopener ugc nofollow" target="_blank"><em class="oh">【https://whenprogramming.com】</em></a><em class="oh">。</em></p></div></div>    
</body>
</html>