<html>
<head>
<title>Physical Computing with JavaScript (4/8) — LED Dimming</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JavaScript的物理计算(4/8) — LED调光</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/physical-computing-with-javascript-4-8-led-dimming-403696103d2f?source=collection_archive---------12-----------------------#2021-05-26">https://javascript.plainenglish.io/physical-computing-with-javascript-4-8-led-dimming-403696103d2f?source=collection_archive---------12-----------------------#2021-05-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4c135d499066c60fee5562cf52a63ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ctBs8BuFZ7_UezUMFPyPA.png"/></div></div></figure><p id="417a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我将尝试通过使用模拟输入和输出而不是数字I/O来调整LED的亮度。</p><blockquote class="kt ku kv"><p id="bc24" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><a class="ae la" href="https://niklauslee.medium.com/physical-computing-with-javascript-table-of-contents-69c38fd74e61" rel="noopener">目录</a></p></blockquote><h1 id="a91d" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">成分</h1><ul class=""><li id="df7d" class="lz ma in jx b jy mb kc mc kg md kk me ko mf ks mg mh mi mj bi translated">树莓派Pico — 1件。</li><li id="adb0" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">试验板— 1个。</li><li id="0630" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">发光二极管(5毫米)— 1个。</li><li id="da00" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">电阻器(330ω或220ω)—1个。</li><li id="53a1" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">电位计(10kω)—1个。</li><li id="13b3" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">跳线(M-M型)</li></ul><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3a6ad2e86377fd4125abe6408acc5209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKFDxKfJ6XrJMXDHhmuWdg.jpeg"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Components for LED dimming</figcaption></figure><h1 id="09ed" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模拟输出</h1><p id="35b8" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mx ki kj kk my km kn ko mz kq kr ks ig bi translated">当数字I/O读取或写入<code class="fe na nb nc nd b">LOW</code>和<code class="fe na nb nc nd b">HIGH</code>值时，模拟I/O可以具有0到1之间的多个值(0.0、0.23、0.756、0.99、1.0……)。首先，让我们按如下方式构成电路。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/94750c59c78e4c83e5503b0bbdc4deb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZh4yMyvwaZusZZOm4bpaA.jpeg"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Circuit for LED dimming</figcaption></figure><p id="cdf4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上次，我们使用数字输出，所以我们使用了<code class="fe na nb nc nd b">digitalWrite()</code>功能。但是现在这个时候我们会用<code class="fe na nb nc nd b">analogWrite()</code>。在终端中逐行输入以下代码，并检查LED的亮度。</p><pre class="mp mq mr ms gt nf nd ng nh aw ni bi"><span id="2e43" class="nj lc in nd b gy nk nl l nm nn">&gt; analogWrite(15, 1);<br/>&gt; analogWrite(15, 0.7);<br/>&gt; analogWrite(15, 0.5);<br/>&gt; analogWrite(15, 0.1);<br/>&gt; analogWrite(15, 0);</span></pre><p id="0996" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您输入<code class="fe na nb nc nd b">1</code>时，LED的亮度非常亮，然后当您输入较小的值时变暗。如果输入<code class="fe na nb nc nd b">0</code>，则完全关闭。这意味着当模拟输出为<code class="fe na nb nc nd b">1</code>时，3.3V的电压全部输出到管脚，当小于<code class="fe na nb nc nd b">1</code>时，电压逐渐低于3.3V，当<code class="fe na nb nc nd b">0</code>输入时，则完全变为0V。</p><h1 id="2a7a" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">脉宽调制</h1><p id="e8ec" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mx ki kj kk my km kn ko mz kq kr ks ig bi translated">之前说调整电压输出一个0~1之间的值，但严格来说这是不正确的。以Pico这样的数字计算机为例，为了创建一个介于0和1之间的值，它通过从每秒数百次到数万次非常快速地切换<code class="fe na nb nc nd b">HIGH</code>和<code class="fe na nb nc nd b">LOW</code>来创建一个值。例如，0.1这样的低值会缩短设置为<code class="fe na nb nc nd b">HIGH</code>的时间，并延长设置为<code class="fe na nb nc nd b">LOW</code>的时间。相反，高值如0.9会延长设置为<code class="fe na nb nc nd b">HIGH</code>的时间，并缩短设置为<code class="fe na nb nc nd b">LOW</code>的时间。这样，设定为<code class="fe na nb nc nd b">HIGH</code>的时间与<code class="fe na nb nc nd b">LOW</code>相比有多长就称为<strong class="jx io">占空比</strong>。并且<strong class="jx io">频率</strong>在一秒钟内被调用多少次在<code class="fe na nb nc nd b">HIGH</code>和<code class="fe na nb nc nd b">LOW</code>之间切换。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fa44857dfb5c4066112689930d8c8ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*VO9toUS0Ux3ZraaGp-Z8Vg.gif"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">PWM‘s Duty Cycle (from <a class="ae la" href="https://ko.wikipedia.org/wiki/%ED%8E%84%EC%8A%A4_%ED%8F%AD_%EB%B3%80%EC%A1%B0" rel="noopener ugc nofollow" target="_blank">Wikipedia</a>)</figcaption></figure><p id="f1fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这种通过频率和占空比控制数字脉冲的方法被称为<strong class="jx io"> PWM(脉宽调制)</strong>。Kaluma提供了一个可以直接处理PWM的模块。下面的代码与使用上面的<code class="fe na nb nc nd b">analogWrite()</code>函数具有相同的效果。让我们通过逐行输入终端来看看变化。PWM类不仅可以调节占空比，还可以调节频率，详情请参考<a class="ae la" href="https://kalumajs.org/docs/api/pwm/" rel="noopener ugc nofollow" target="_blank">参考</a>。</p><pre class="mp mq mr ms gt nf nd ng nh aw ni bi"><span id="67d0" class="nj lc in nd b gy nk nl l nm nn">&gt; const PWM = require('pwm').PWM;<br/>&gt; const led = new PWM(15, 450, 1); // frequency=450Hz, duty=100%<br/>&gt; led.start(); // start to pulse</span><span id="0d3d" class="nj lc in nd b gy np nl l nm nn">&gt; led.setDuty(0.7); // duty=70%<br/>&gt; led.setDuty(0.5); // duty=50%<br/>&gt; led.setDuty(0.1); // duty=10%<br/>&gt; led.setDuty(0); // duty=0%</span><span id="5672" class="nj lc in nd b gy np nl l nm nn">&gt; led.stop(); // stop the pulse</span></pre><h1 id="06d5" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模拟输入</h1><p id="e469" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mx ki kj kk my km kn ko mz kq kr ks ig bi translated">现在我们来读取模拟输入值。为了读取模拟值，我们将使用电位计。电位计是一个电阻值随手柄转动程度而变化的元件。你可能经常看到它用于控制普通音频设备的音量。</p><p id="f72e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将电位计的中心引脚连接到<strong class="jx io"> GPIO26 </strong>，左引脚连接到<strong class="jx io"> 3V3 </strong>，右引脚连接到<strong class="jx io"> GND </strong>。首先将电位器顺时针(右)转到底读取模拟值，然后逆时针(左)转到底，再读取模拟值。由于<strong class="jx io"> GND </strong>与右销相连，如果顺时针(右)旋转到底，会出现接近0的值，如果反向旋转，会出现接近1的值。</p><pre class="mp mq mr ms gt nf nd ng nh aw ni bi"><span id="c751" class="nj lc in nd b gy nk nl l nm nn">&gt; analogRead(26);<br/>0.0029296875</span><span id="ecfd" class="nj lc in nd b gy np nl l nm nn">&gt; analogRead(26);<br/>0.999755859375</span></pre><h1 id="12a3" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模数转换器</h1><p id="97d0" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mx ki kj kk my km kn ko mz kq kr ks ig bi translated">就像模拟输出实际上是用PWM产生脉冲一样，Pico是数字计算机，所以它需要一个把模拟值转换成数字的器件，这个器件就是<strong class="jx io"> ADC(模数转换器)</strong>。Pico内部有一个内置的ADC，所以你可以马上使用它，记住你只能在3个引脚上使用ADC功能(<strong class="jx io"> GPIO26=ADC0 </strong>、<strong class="jx io"> GPIO27=ADC1 </strong>、<strong class="jx io"> GPIO28=ADC2 </strong>)。这年头很多数字传感器都不错，也很普及，所以我们不需要用模拟部分，但是模拟部分还是很多的(温度，距离，磁场等。)连接到ADC引脚即可使用。</p><p id="8add" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Kaluma中，ADC还提供了一个单独的API。您可以创建一个<code class="fe na nb nc nd b">ADC</code>类的实例并读取值，如下面的代码所示。有关ADC的更多信息，请参考<a class="ae la" href="https://kalumajs.org/docs/api/adc/" rel="noopener ugc nofollow" target="_blank">参考文件</a>。</p><pre class="mp mq mr ms gt nf nd ng nh aw ni bi"><span id="4b61" class="nj lc in nd b gy nk nl l nm nn">&gt; var ADC = require('adc').ADC;<br/>&gt; var a = new ADC(26);<br/>&gt; console.log(a.read());</span></pre><h1 id="bb2d" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">把所有的放在一起</h1><p id="5e34" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mx ki kj kk my km kn ko mz kq kr ks ig bi translated">现在让我们连接所有的东西，编写一个程序，像转动电位器一样调节LED的亮度。下面的代码每0.1秒读取一次电位计的值，并将LED的亮度设置为该值。当然，您可以通过将电位器直接连接到LED来控制亮度，但这里我们使用这种方法来说明如何用程序处理它。</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/e9afd82d0760b148bf6d05e809f36ba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbuq51Jh3Z4wnpNAkNx7UA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">LED dimming with a potentiometer</figcaption></figure><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ad04cb2c7441a735c2da83550e572f60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*TcskR47-nXfMR8WnRqu1iA.gif"/></div></figure><p id="044a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程之前，我们已经讨论了数字I/O和模拟I/O，在下一个教程中，我们将讨论一种更实用的传感器，它可以测量温度和湿度。</p><div class="ns nt gp gr nu nv"><a href="https://niklauslee.medium.com/physical-computing-with-javascript-5-8-sensing-temperature-and-humidity-2040eb1d20e9" rel="noopener follow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd io gy z fp oa fr fs ob fu fw im bi translated">使用JavaScript的物理计算— (5/8)感测温度和湿度</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">在本教程中，我将解释数字脉冲，并使用DHT11传感器测量温度和湿度。</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">niklauslee.medium.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jt nv"/></div></div></a></div><p id="ab46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">更多内容尽在</em><a class="ae la" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="kw">plain English . io</em></a></p></div></div>    
</body>
</html>