<html>
<head>
<title>How to Write a Simple Test for Your Next.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为你的Next.js应用编写一个简单的测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-write-a-simple-test-for-your-next-js-app-7e7e83420d7a?source=collection_archive---------1-----------------------#2021-12-20">https://javascript.plainenglish.io/how-to-write-a-simple-test-for-your-next-js-app-7e7e83420d7a?source=collection_archive---------1-----------------------#2021-12-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2256" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">为Next.js应用程序编写简单测试的指南。</h2></div><h1 id="f396" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated"><strong class="ak">首先最重要的事情</strong></h1><p id="0b10" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">对软件开发人员来说，为他们的软件编写测试是很重要的，尤其是在生产中，以正确地确定它是否有效地工作，是否如预期的那样。我们不想假设它的工作只是为了以后失败。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/581b47bd641268c9627ab594a366cb8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GHgUPqdadA8z6EEVE319Hg.jpeg"/></div></figure><p id="e3cf" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">嗯，它可能“工作”,但您仍然需要编写测试:)</p><p id="fe12" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在本教程中，我将带您使用<a class="ae md" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>和<a class="ae md" href="https://testing-library.com/docs/react-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> React测试库</a>为您的<a class="ae md" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>应用程序中的表单编写一组简单的测试。让我们简要地看一下上面提到的这些工具，并设置我们的项目。</p><h1 id="0a82" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">Next.js</h1><p id="255b" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Next.js是由<a class="ae md" href="https://vercel.com/breezeio" rel="noopener ugc nofollow" target="_blank"> Vercel </a>构建的开源JavaScript框架，它提供了基于React的web应用功能。它支持诸如服务器端渲染、无服务器功能、静态应用等功能。</p><p id="2768" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们将通过创建一个新的Next.js应用程序来设置我们的项目。</p><p id="00fe" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">打开您的终端，导航到您保存回复的位置，然后键入下面的命令。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="12e1" class="mj kd in mf b gy mk ml l mm mn">$ npx create next-app@latest</span></pre><p id="fbac" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这将带您完成一些安装提示，然后在我们的文件夹中创建一个基本的Next.js应用程序。如果您更喜欢TypeScript设置，请添加如下所示的TypeScript标志:</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="8645" class="mj kd in mf b gy mk ml l mm mn">npx create-next-app@latest --typescript</span></pre><p id="5c50" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">现在我们已经设置了Next.js应用程序，让我们将测试工具添加到我们的应用程序中。</p><h1 id="de4c" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">玩笑</h1><p id="b872" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Jest是一个Javascript测试框架，由克里斯托夫·中泽友秀创建，目前由脸书维护。Jest的主要优点之一是简单。这相对容易设置，尤其是对于第一次使用的用户。</p><p id="5036" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">让我们使用npm安装Jest依赖项:</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="80ed" class="mj kd in mf b gy mk ml l mm mn">$ npm install -D jest babel-jest</span></pre><p id="0bd7" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这将安装Jest和<code class="fe mo mp mq mf b">Babel Jest</code>，确保Jest与Next.js一起正常工作。</p><p id="d4de" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来，我们将创建一个<code class="fe mo mp mq mf b">.babelrc</code>文件，并添加如下所示的配置。这将有助于配置我们已经安装的<code class="fe mo mp mq mf b">Babel Jest</code>。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="e00a" class="mj kd in mf b gy mk ml l mm mn">{  <br/> "presets": ["next/babel"] <br/>}</span></pre><p id="41dd" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这确保Jest在我们的应用程序中正常工作。</p><p id="f958" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">虽然Jest使我们能够轻松地测试javascript应用程序和代码，但它不能直接测试我们的Next.js应用程序，因为它没有呈现基于React的组件的功能。因此，我们需要一个可以与Jest一起工作的工具来呈现我们的Next.js应用程序，然后在其上运行测试。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/d8bec1ca439fc2d1bb00c420b12ef87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CACgabuoMFE_DUrXGAdcjQ.jpeg"/></div></div></figure><p id="7416" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这就是<strong class="kw io"> React测试库</strong>的用武之地。</p><h1 id="5e1e" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">反应测试库</h1><p id="da5f" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">React Testing Library是一个开源工具，通过呈现React.js应用程序并公开要查询的DOM来帮助测试它。这有助于测试React.js应用程序的使用意图，而不仅仅是实现细节。</p><p id="0f80" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">让我们将依赖项安装到我们的应用程序中。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="97d5" class="mj kd in mf b gy mk ml l mm mn">$ npm install -D @testing-library/jest-dom @testing-library/react</span></pre><p id="7da0" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这将安装React测试库和一个<code class="fe mo mp mq mf b">@testing-library/jest-dom</code>包，它将与Jest一起测试我们的应用程序。</p><p id="0bb1" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在我们开始编写测试之前，让我们对项目目录中的<code class="fe mo mp mq mf b">package.json</code>文件进行一些修改。</p><p id="65c9" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">第一个变化是在<code class="fe mo mp mq mf b">scripts</code>字段，它告诉npm如何在我们的应用上运行测试。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="4c73" class="mj kd in mf b gy mk ml l mm mn">“test”: “jest — watch”</span></pre><p id="69a7" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这告诉npm在我们运行<code class="fe mo mp mq mf b">npm test a </code>命令时，以监视模式运行jest(监视我们的更改并相应地运行测试)。我们的<code class="fe mo mp mq mf b">scripts</code>字段现在应该如下所示。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="f1cc" class="mj kd in mf b gy mk ml l mm mn">“scripts”: {<br/> “dev”: “next dev”,<br/> “build”: “next build”,<br/> “start”: “next start”,<br/> “test”: “jest — watch”<br/>},</span></pre><p id="98ab" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">其次，我们将向我们的<code class="fe mo mp mq mf b">package.json</code>添加一个名为<code class="fe mo mp mq mf b">jest</code>的新字段。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="4cb2" class="mj kd in mf b gy mk ml l mm mn">"jest": {<br/> "testEnvironment": "jsdom"<br/>}</span></pre><p id="66da" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">这告诉Node使用<code class="fe mo mp mq mf b">jsdom </code>作为我们的测试环境。默认的节点测试环境不允许我们使用浏览器环境进行测试。</p><p id="88c6" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">设置好这些工具后，我们现在可以开始编码和编写测试了。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mw"><img src="../Images/9797fe755237396ad615c06e5f36f1c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*8g1HtXc2IlMAD48S4TZh4w.jpeg"/></div></div></figure><p id="9ab1" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们将从创建一个基本的注册表单开始，然后我们将为它编写测试。</p><h1 id="2a5c" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">注册表单</h1><p id="0b30" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们将导航到我们的<code class="fe mo mp mq mf b">index.js</code>文件，删除它的所有内容，并导入<code class="fe mo mp mq mf b">useState</code>。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="9b5c" class="mj kd in mf b gy mk ml l mm mn">import { useState } from 'react';</span></pre><p id="302c" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来，我们创建一个<code class="fe mo mp mq mf b">RegisterPage</code>组件，并在其中创建一个我们将要测试的基本表单。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="f28c" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在这个<code class="fe mo mp mq mf b">RegisterPage</code>组件中，我们声明了一个<code class="fe mo mp mq mf b">isLoading</code>状态值，并将其设置为false。该值将指示我们是否正在提交(正在加载)。</p><p id="f90b" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">然后我们继续创建一个<code class="fe mo mp mq mf b">registerUser</code>函数，我们将使用它来模拟表单提交，它将阻止默认表单提交，将<code class="fe mo mp mq mf b">isLoading</code>设置为<code class="fe mo mp mq mf b">true</code>，并在5秒或5000毫秒后将其设置回<code class="fe mo mp mq mf b">false</code>。</p><p id="c18a" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来我们创建<code class="fe mo mp mq mf b">formInputs</code>，一个对象数组，包含表单输入，我们将在<code class="fe mo mp mq mf b">return</code>块中呈现它。</p><p id="c739" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来，在我们的组件中，我们将创建一个表单，映射我们的<code class="fe mo mp mq mf b">formInputs</code>数组，并添加一个按钮，当它被点击时调用<code class="fe mo mp mq mf b">registerUser</code>。我们现在可以导出我们的组件了。</p><h1 id="b51c" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">风格</h1><p id="5dfd" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">让我们给我们的<code class="fe mo mp mq mf b">styles/globals.css</code>添加一些基本的样式。如果您没有该文件，创建一个并导入到您的<code class="fe mo mp mq mf b">_app.js</code>文件中。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="f14d" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们现在将保存这些文件，并使用<code class="fe mo mp mq mf b">npm run dev</code>运行下一个应用程序。当我们打开浏览器到<code class="fe mo mp mq mf b"><a class="ae md" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a> </code>时，我们应该看到我们的应用程序已经启动并运行了。</p><p id="a79a" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">现在是时候为我们的应用程序中的表单编写测试了。</p><h1 id="7a78" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">测试应用程序</h1><p id="56a0" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">让我们首先创建一个<code class="fe mo mp mq mf b">tests</code>文件夹，在其中，我们将创建一个名为<code class="fe mo mp mq mf b">pages</code>的子文件夹。这是我们保存页面测试文件的地方(创建你的第一个测试文件并命名为<code class="fe mo mp mq mf b">index.test.js</code>)。</p><p id="bb72" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">首先，我们将对测试文件进行一些导入。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="ad11" class="mj kd in mf b gy mk ml l mm mn">import '@testing-library/jest-dom';</span><span id="4736" class="mj kd in mf b gy mz ml l mm mn">import { render, screen, fireEvent } from '@testing-library/react';</span></pre><p id="3a85" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们导入了之前安装的<code class="fe mo mp mq mf b">@testing-library/jest-dom</code>，我们还从<code class="fe mo mp mq mf b">@testing-library/react</code>中导入了<code class="fe mo mp mq mf b">render</code>、<code class="fe mo mp mq mf b">screen</code>和<code class="fe mo mp mq mf b">fireEvent</code>更多关于它们在本教程中的用法。</p><p id="ac36" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来，我们导入将要测试的<code class="fe mo mp mq mf b">Index</code>文件。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="9e7f" class="mj kd in mf b gy mk ml l mm mn">import Index from '../../pages/index';</span></pre><p id="6104" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在我们编写测试之前，让我们创建一个数组<code class="fe mo mp mq mf b">formInputValues</code>，它将包含我们将在测试表单时使用的模拟数据。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="e5cf" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">现在，测试。</p><p id="580b" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们将从描述我们测试的目的开始。我们将从创建一个<code class="fe mo mp mq mf b">describe</code>代码块开始。<code class="fe mo mp mq mf b">Describe</code>是一种Jest方法，用于将相关测试块分组在一起。它有两个参数:一个描述测试套件的字符串和一个包装将要编写的测试的回调函数。</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="afc3" class="mj kd in mf b gy mk ml l mm mn">describe(‘Simple working form’, () =&gt; {</span><span id="8218" class="mj kd in mf b gy mz ml l mm mn">});</span></pre><p id="e447" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">接下来，我们将在<code class="fe mo mp mq mf b">it</code>块中编写测试用例。<code class="fe mo mp mq mf b">it</code>是一个Jest方法，其中编写了实际的测试功能。就像一个<code class="fe mo mp mq mf b">describe</code>块一样，它有两个参数:一个描述测试套件的字符串和一个包装测试功能的回调函数。<code class="fe mo mp mq mf b">it</code>的替代方法是<code class="fe mo mp mq mf b">test</code>。让我们从编写一个测试所有表单输入是否正确呈现的程序开始。我们将在我们的<code class="fe mo mp mq mf b">describe</code>街区这样做。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3ba1" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在我们的<code class="fe mo mp mq mf b">it</code>块中，我们将把我们的<code class="fe mo mp mq mf b">Index</code>组件传递给一个<code class="fe mo mp mq mf b">render</code>方法。<code class="fe mo mp mq mf b">render</code>是一个<code class="fe mo mp mq mf b">@testing-library/react</code>方法，模拟作为参数传递的React组件的渲染。</p><p id="2793" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">然后我们使用<code class="fe mo mp mq mf b">forEach</code>继续循环我们的<code class="fe mo mp mq mf b">formInputValues</code>。对于每个<code class="fe mo mp mq mf b">value</code>，我们在<code class="fe mo mp mq mf b">value.label</code>上调用<code class="fe mo mp mq mf b">screen.getByLabelText</code>。<code class="fe mo mp mq mf b">screen</code>是一个<code class="fe mo mp mq mf b">@testing-library/react</code>对象，它公开了用于查询我们之前呈现的组件的方法，其中一个是<code class="fe mo mp mq mf b">getByLabelText</code>。<code class="fe mo mp mq mf b">getByLabelText</code>用于检索标签作为参数传递的一个元素。</p><p id="dc27" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们将从<code class="fe mo mp mq mf b">screen.getByLabelText</code>返回的值作为参数传递给<code class="fe mo mp mq mf b">expect </code>。<code class="fe mo mp mq mf b">expect</code>是一个Jest方法，它允许我们访问匹配器，帮助我们测试某些条件。我们使用的匹配器的一个例子是<code class="fe mo mp mq mf b">toBeInTheDocument</code>，在我们的expect函数上调用它，检查我们传递给expect的参数是否存在于我们呈现的组件中，即在文档中。</p><p id="4e37" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">本质上，我们期望在我们的<code class="fe mo mp mq mf b">formInputValues</code>数组中带有标签的元素存在于我们的组件中。</p><p id="5806" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">让我们再添加两个测试来完成我们的测试用例。一个将检查我们的按钮是否出现在文档中，另一个将检查我们的按钮被点击后是否加载。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="4d52" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在我们的第二个<code class="fe mo mp mq mf b">it</code>块中，我们渲染<code class="fe mo mp mq mf b">Index</code>，通过调用屏幕对象中的<code class="fe mo mp mq mf b">getByRole</code>方法检索我们的按钮，并用值初始化<code class="fe mo mp mq mf b">submitButton</code>。<code class="fe mo mp mq mf b">getByRole</code>有几个参数，但是对于本教程，我们只传递我们正在查询的角色的<code class="fe mo mp mq mf b">name</code>和一个包含按钮的<code class="fe mo mp mq mf b">name</code>的对象(按钮的文本)。我们使用两个匹配器来测试我们的按钮。<code class="fe mo mp mq mf b">toBeInTheDocument</code>和<code class="fe mo mp mq mf b">not.toBeDisabled</code>检查我们的按钮是否存在且未被禁用。</p><p id="2982" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated"><strong class="kw io">注意</strong>:在任何匹配器测试之前使用<code class="fe mo mp mq mf b">not</code>进行匹配器的反转。</p><p id="f4d4" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">在我们的第三个<code class="fe mo mp mq mf b">it</code>块中，我们渲染<code class="fe mo mp mq mf b">Index</code>并取回我们的<code class="fe mo mp mq mf b">submitButton</code>。我们循环遍历我们的<code class="fe mo mp mq mf b">inputFormValues array</code>，获得各自的输入，并使用<code class="fe mo mp mq mf b">fireEvent.change</code>来模拟用数组中的值填充每个输入。</p><p id="9d04" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">fireEvent是来自<code class="fe mo mp mq mf b">@testing-library/react</code>的一个对象，具有用于模拟真实dom事件的方法。我们使用<code class="fe mo mp mq mf b">change</code>来改变表单值，然后我们使用<code class="fe mo mp mq mf b">click</code>来模拟点击按钮。</p><p id="bab8" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">最后，我们检查我们的按钮的值在点击后是否已经变成了<code class="fe mo mp mq mf b">Loading…</code>。我们可以用另一种查询方法<code class="fe mo mp mq mf b">findByRole</code>来实现。它类似于<code class="fe mo mp mq mf b">getByRole</code>,但是它返回一个承诺，过一会儿就解决了。</p><p id="7c50" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated"><strong class="kw io">注意</strong>:如果您预计您的<code class="fe mo mp mq mf b">fireEvent</code>更改不会立即反映出来，请使用<code class="fe mo mp mq mf b">findBy</code>，而不是<code class="fe mo mp mq mf b">getBy</code>。</p><p id="fc4f" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我们的<code class="fe mo mp mq mf b">index.test.js</code>现在应该是这样的:</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="43ff" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">运行<code class="fe mo mp mq mf b">npm test a</code>来查看您的测试结果，您应该会看到类似这样的内容</p><pre class="lr ls lt lu gt me mf mg mh aw mi bi"><span id="15c0" class="mj kd in mf b gy mk ml l mm mn">PASS  tests/pages/index.test.js (14.833 s)<br/>  Simple working form<br/>    √ Should render all form inputs (208 ms)<br/>    √ Should render submit button (458 ms)<br/>    √ Should submit when inputs are filled and submit button clicked (303 ms)</span><span id="3cb0" class="mj kd in mf b gy mz ml l mm mn">Test Suites: 1 passed, 1 total<br/>Tests:       3 passed, 3 total<br/>Snapshots:   0 total<br/>Time:        30.426 s<br/>Ran all test suites matching /a/i.</span></pre><h1 id="7a48" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">结论</h1><p id="513a" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">恭喜，我们已经成功测试了Next.js应用程序。随意加入更多的测试案例/增加测试的范围。完整的项目可以在我的GitHub上的<a class="ae md" href="https://github.com/chani24/Testing-React-Form" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="b813" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">关于本教程中使用的工具的更多细节，请查看<a class="ae md" href="https://nextjs.org/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> Next.js </a>、<a class="ae md" href="https://jestjs.io/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> Jest </a>和<a class="ae md" href="https://testing-library.com/docs/react-testing-library/intro" rel="noopener ugc nofollow" target="_blank"> React测试库</a>文档。</p><p id="4d06" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated">我将感谢对本教程的反馈:)，好运编码！</p><p id="3a8a" class="pw-post-body-paragraph ku kv in kw b kx ly jo kz la lz jr lc ld ma lf lg lh mb lj lk ll mc ln lo lp ig bi translated"><em class="na">更多内容请看</em><a class="ae md" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="na">plain English . io</em></a><em class="na">。在这里注册我们的</em> <a class="ae md" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="na">免费周报</em> </a> <em class="na">。</em></p></div></div>    
</body>
</html>