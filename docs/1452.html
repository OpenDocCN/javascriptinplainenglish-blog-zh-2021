<html>
<head>
<title>How to Write PostgreSQL Queries for Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为Node.js编写PostgreSQL查询</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-write-postgresql-queries-for-node-js-714393c3fc04?source=collection_archive---------3-----------------------#2021-03-28">https://javascript.plainenglish.io/how-to-write-postgresql-queries-for-node-js-714393c3fc04?source=collection_archive---------3-----------------------#2021-03-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3ca9" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">您可以使用Node.js和PostgreSQL创建RESTful api的四个基本查询</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/1fea6f50fd72168531d3f6af7f839c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZEkRtESQLbUbbIp1tVmlA.png"/></div></div></figure><h2 id="6725" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">简介</strong></h2><p id="fc09" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">如果你在Node.js中编写一个RESTful api，你必须在关系数据库和非关系数据库之间做出选择。如果您决定选择前者，您将需要知道如何编写基本的CRUD查询，以便您的api能够以有意义的方式与您的数据库对话。在这篇博客中，我将介绍四个基本查询，您可以使用Node.js和PostgreSQL来创建RESTful api。<strong class="lm io">注意:</strong>本博客假设你已经安装了Node.js、PostgreSQL和pg。</p><h2 id="dee3" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">查询创建</strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi md"><img src="../Images/74b797c5fa35506ce0aec68331193e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VXebL0QJVB3iIETUD3giMw.png"/></div></div></figure><p id="179e" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">这里我们创建了一个路由来处理post请求，在这里我们将新数据插入到一个名为“todo”的表中。我们正在创建一个新的todo，其中我们的描述与用户在请求中输入的描述相同。“$1”充当变量的占位符，让我们可以在查询中插入任何想要的变量。确保写“RETURNING *”，因为这是从查询中接收信息的唯一方式。然后，我们用刚刚更新的数据发送一个json响应。</p><h2 id="06ac" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">代码创建</strong></h2><pre class="kd ke kf kg gt mj mk ml mm aw mn bi"><span id="5159" class="ko kp in mk b gy mo mp l mq mr">app.post("/todos", async (<em class="ms">req</em>, <em class="ms">res</em>) =&gt; {</span><span id="d117" class="ko kp in mk b gy mt mp l mq mr">try{</span><span id="6bfa" class="ko kp in mk b gy mt mp l mq mr">const {description} = <em class="ms">req</em>.body;</span><span id="5ecc" class="ko kp in mk b gy mt mp l mq mr"><em class="ms">//This takes our description that we sent in and inserts into the todo table</em></span><span id="ce5e" class="ko kp in mk b gy mt mp l mq mr">const newTodo = await pool.query("INSERT INTO todo (description) VALUES ($1) RETURNING *", [description]);</span><span id="387f" class="ko kp in mk b gy mt mp l mq mr"><em class="ms">res</em>.json(newTodo.rows[0]);</span><span id="2c8c" class="ko kp in mk b gy mt mp l mq mr">} catch(error){</span><span id="518d" class="ko kp in mk b gy mt mp l mq mr">console.log(error.message)</span><span id="f73b" class="ko kp in mk b gy mt mp l mq mr">}</span><span id="b6a2" class="ko kp in mk b gy mt mp l mq mr">});</span></pre><h2 id="3f8c" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">查询读取</strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mu"><img src="../Images/cc1b3eeb4b0892cb00796ed0d3dd522e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yGOIS4cro0FYu7fNRv1ZFQ.png"/></div></div></figure><p id="7e82" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">这个查询要简单得多。我们从params中获取id，并选择具有该id的所有数据。然后，我们发送包含该数据的响应。</p><h2 id="6fb7" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">用于读取的代码</strong></h2><pre class="kd ke kf kg gt mj mk ml mm aw mn bi"><span id="17ba" class="ko kp in mk b gy mo mp l mq mr">app.get("/todos/:id", async (<em class="ms">req</em>, <em class="ms">res</em>) =&gt; {</span><span id="6498" class="ko kp in mk b gy mt mp l mq mr">const { id } = <em class="ms">req</em>.params;</span><span id="498e" class="ko kp in mk b gy mt mp l mq mr">try {</span><span id="e092" class="ko kp in mk b gy mt mp l mq mr">const todo = await pool.query("SELECT * FROM todo WHERE todo_id = $1", [id]);</span><span id="0f57" class="ko kp in mk b gy mt mp l mq mr"><em class="ms">res</em>.json(todo.rows[0]);</span><span id="d704" class="ko kp in mk b gy mt mp l mq mr">} catch (error){</span><span id="d271" class="ko kp in mk b gy mt mp l mq mr">console.log(error.message);</span><span id="68b0" class="ko kp in mk b gy mt mp l mq mr">}</span><span id="49a4" class="ko kp in mk b gy mt mp l mq mr">});</span></pre><h2 id="6267" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">更新查询</strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mv"><img src="../Images/a3f340f216e89f86ca18f67db3419825.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TidY1CkX-UhbiuA-fAUdFQ.png"/></div></div></figure><p id="a24c" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">这里我们需要有要更新的todo的id，以及更新后的描述。然后，我们需要用该id更新todo，并将描述设置为等于更新后的描述。再次确保输入RETURNING *以返回更新的数据。</p><h2 id="f046" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">更新代码</strong></h2><pre class="kd ke kf kg gt mj mk ml mm aw mn bi"><span id="a586" class="ko kp in mk b gy mo mp l mq mr">app.delete("/todos/:id", async (<em class="ms">req</em>, <em class="ms">res</em>) =&gt; {</span><span id="96a3" class="ko kp in mk b gy mt mp l mq mr">try {</span><span id="9766" class="ko kp in mk b gy mt mp l mq mr">const { id } = <em class="ms">req</em>.params;</span><span id="404e" class="ko kp in mk b gy mt mp l mq mr">const deleteTodo = await pool.query("DELETE FROM todo WHERE todo_id = $1", [id]);</span><span id="6d17" class="ko kp in mk b gy mt mp l mq mr"><em class="ms">res</em>.status(500).json("Todo was deleted!")</span><span id="aa69" class="ko kp in mk b gy mt mp l mq mr">} catch (error){</span><span id="bcd2" class="ko kp in mk b gy mt mp l mq mr">console.error(error.message);</span><span id="3815" class="ko kp in mk b gy mt mp l mq mr">}</span><span id="e865" class="ko kp in mk b gy mt mp l mq mr">});</span></pre><h2 id="a0f0" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">删除查询</strong></h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mw"><img src="../Images/74d6a663ba25c156fb93282efb2328cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYYDXALuhBpBo3Cl49d3xw.png"/></div></div></figure><p id="473c" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">这里我们只需要我们想要删除的待办事项的id，并将其从表中删除。在这里，我只是向前端发回一条消息，说todo已被删除。</p><h2 id="f0ed" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">删除代码</strong></h2><pre class="kd ke kf kg gt mj mk ml mm aw mn bi"><span id="35d6" class="ko kp in mk b gy mo mp l mq mr">app.delete("/todos/:id", async (<em class="ms">req</em>, <em class="ms">res</em>) =&gt; {</span><span id="411d" class="ko kp in mk b gy mt mp l mq mr">try {</span><span id="806c" class="ko kp in mk b gy mt mp l mq mr">const { id } = <em class="ms">req</em>.params;</span><span id="8c68" class="ko kp in mk b gy mt mp l mq mr">const deletedTodo = await pool.query("DELETE FROM todo WHERE todo_id = $1", [id]);</span><span id="8a0c" class="ko kp in mk b gy mt mp l mq mr"><em class="ms">res</em>.status(500).json("Todo was deleted!")</span><span id="44cd" class="ko kp in mk b gy mt mp l mq mr">} catch (error){</span><span id="ee11" class="ko kp in mk b gy mt mp l mq mr">console.error(error.message);</span><span id="516b" class="ko kp in mk b gy mt mp l mq mr">}</span><span id="d0ab" class="ko kp in mk b gy mt mp l mq mr">});</span></pre><p id="6a14" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><strong class="lm io">来源:</strong></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5009" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><em class="ms">更多内容请看</em><a class="ae mz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="ms">plain English . io</em></strong></a></p></div></div>    
</body>
</html>