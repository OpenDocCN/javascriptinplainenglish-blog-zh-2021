<html>
<head>
<title>How to Create a GraphQL API Powered by MongoDB and Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个由MongoDB和Express支持的GraphQL API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-graphql-api-powered-by-mongodb-and-express-89119a25bb38?source=collection_archive---------15-----------------------#2021-04-22">https://javascript.plainenglish.io/how-to-create-a-graphql-api-powered-by-mongodb-and-express-89119a25bb38?source=collection_archive---------15-----------------------#2021-04-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1602e30b6c1dcc667bb8bbd2727c9a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P77Ryf-5_qy2T42YFItYxQ.jpeg"/></div></div></figure><p id="3875" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">GraphQL是一种主要为API使用而构建的语言。它很容易与JavaScript和其他语言交互。在本文中，让我们看看如何将Express、MongoDB和GraphQL结合到一个基本的API中，以便从数据库中获取标题和日期。</p><p id="9cf5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">GraphQL有点偏离经典的REST APIs，但是一旦您习惯了它，您就会知道它运行起来有多容易。让我们看看。</p><h1 id="53b8" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">安装GraphQL</h1><p id="e120" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">第一步是在Node.js服务器上安装标准的GraphQL包和Express，方法是在命令行上运行以下安装:</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="e479" class="mf ku in mb b gy mg mh l mi mj"><strong class="mb io"><em class="mk">npm</em></strong> i graphql<br/><strong class="mb io"><em class="mk">npm</em></strong> i graphql-express<br/><strong class="mb io"><em class="mk">npm</em></strong> i express<br/><strong class="mb io"><em class="mk">npm</em></strong> i mongoose</span></pre><h1 id="4ab1" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">一个基本的GraphQL Express端点</h1><p id="f620" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">让我们从一个功能强大的express/GraphQL服务器开始。创建一个名为<code class="fe ml mm mn mb b">index.js</code>的文件，并插入以下代码:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="ff4a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您所看到的，GraphQL需要三个主要部分。首先，我们定义一个模式，这是我们的端点将返回的数据类型。每个GraphQL都需要一个“<code class="fe ml mm mn mb b">type Query</code>”模式，但是在此之后，您可以使用任何您想要的名称来代替“Query”。例如，你可以有一个<code class="fe ml mm mn mb b">type TeamMember</code>模式。</p><p id="98b4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们有了我们的根本价值观。这些是模式中的项目，以及为每个项目返回一个值的相关函数。如果用户试图从API中获取“<code class="fe ml mm mn mb b">age</code>”，他们将得到5的返回。</p><p id="0e83" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，当用户从API发出<code class="fe ml mm mn mb b">GET</code>请求时，我们返回数据。如果您安装了<a class="ae mq" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>(我会在本教程中推荐)，您可以很容易地用GraphQL发送这样的查询，看看它是如何工作的。</p><p id="edb1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">GraphQL有一种非常简单的查询语言，我们只需要将我们想要的元素的键放在花括号中发送。您甚至可以为多级对象在多个级别执行此操作。示例如下所示:</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/57492368721500723efb408c6bb154a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NykMJxK-nWaiz3dsvdK1ag.png"/></div></div></figure><h1 id="3bb2" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">计划</h1><p id="ce13" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">GraphQL有一种特定的查询语言，允许我们创建模式。模式本质上是我们的API将返回的数据类型的定义。然后，用户可以发送查询，以选择该模式的特定组件。</p><h1 id="22d6" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">根值</h1><p id="24d6" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">根值是模式中所有事物的对象。</p><h1 id="38f4" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">变量</h1><p id="712b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">也可以将变量添加到组合中。为此，我们只需要在模式和根值中定义变量。我们必须将变量包装在<code class="fe ml mm mn mb b">{}</code>括号中的根值中。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="0666" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们可以使用以下查询在邮递员中查询标题变量:</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/5be353bc327ef98ca32186adb811fefb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IQPeNciFZj2mbqILyivHWg.png"/></div></div></figure><h1 id="0f55" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">与MongoDB结合</h1><p id="e7eb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">现在我们有了一个简单的GraphQL接口，让我们把它和MongoDB结合起来。用您的MongoDB模式创建一个文件。我的是关于文章的，所以看起来有点像我们下面的内容。注意，这里的数据库模式是不同的，但这不会阻止我们:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="1bd7" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">组合蒙古数据库</h1><p id="ac9c" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">因此，首先，将您的新模型添加到index.js文件中，之前您在该文件中有您的express router。如果需要，不要忘记连接到您的MongoDB:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="7058" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">更新我们的根和模型</h1><p id="962e" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">为此，我想在单独的数组中返回数据库中的所有标题和所有页面日期。首先，让我们更新我们的模式，以反映graphQL应该返回项目数组:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="97e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">简单。接下来，让我们更新我们的根变量。这一次，我们将连接到我们的MongoDB来返回文章，并将它们压缩成一维数组:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="388d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以像以前一样使用相同的查询样式运行API，以获取所有的文章日期和标题:</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/9db28f6f091ce437a165aa62b2e31127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZWSm8Fd0h2QQRmA1o9st6A.png"/></div></div></figure><h1 id="645d" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">结论</h1><p id="68ac" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">今天到此为止。如果你有兴趣了解更多，请通过@ T0 fjolt dev T1在Twitter上关注我，获取我的最新文章。</p><p id="cf30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是一些有用的资源，以及今天最后一个例子中的代码。</p><ul class=""><li id="7776" class="ms mt in jx b jy jz kc kd kg mu kk mv ko mw ks mx my mz na bi translated"><a class="ae mq" href="https://graphql.org/learn/" rel="noopener ugc nofollow" target="_blank"> GraphQL文档</a></li><li id="c850" class="ms mt in jx b jy nb kc nc kg nd kk ne ko nf ks mx my mz na bi translated"><a class="ae mq" href="https://github.com/smpnjn/graphql-mongodb-express" rel="noopener ugc nofollow" target="_blank">代码回购</a></li></ul><p id="f869" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mk">更多内容请看</em><a class="ae mq" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mk">plain English . io</em></a></p></div></div>    
</body>
</html>