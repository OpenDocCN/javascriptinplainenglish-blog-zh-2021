<html>
<head>
<title>How to Let Users Download a File from Node.js Server with Express?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何让用户用Express从Node.js服务器下载一个文件？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-let-users-download-a-file-from-node-js-server-with-express-8864c560247a?source=collection_archive---------12-----------------------#2021-06-20">https://javascript.plainenglish.io/how-to-let-users-download-a-file-from-node-js-server-with-express-8864c560247a?source=collection_archive---------12-----------------------#2021-06-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3a25cc484d86b94472e9e4c029cd2689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PcDyfeGl6QZicHjh"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@karim_manjra?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Karim MANJRA</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8f89" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们希望让用户在我们的Express应用程序中下载文件。</p><p id="9efc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看如何让用户从Express应用程序下载文件。</p><h1 id="a473" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">res .下载</h1><p id="fd92" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">让用户从Node.js服务器下载文件的一种方法是使用Express提供的<code class="fe me mf mg mh b">res.download</code>方法。</p><p id="350d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6da5" class="mq lc iq mh b gy mr ms l mt mu">const express = require('express')<br/>const app = express()<br/>const port = 3000</span><span id="b84f" class="mq lc iq mh b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('Hello World!')<br/>})</span><span id="50ba" class="mq lc iq mh b gy mv ms l mt mu">app.get('/download', (req, res) =&gt; {<br/>  const file = `${__dirname}/download/foo.txt`;<br/>  res.download(file);<br/>});</span><span id="6713" class="mq lc iq mh b gy mv ms l mt mu">app.listen(port, () =&gt; {<br/>  console.log(`Example app listening at http://localhost:${port}`)<br/>})</span></pre><p id="88b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只是用字符串变量<code class="fe me mf mg mh b">file</code>指定文件的路径。</p><p id="1f8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将它传递给<code class="fe me mf mg mh b">res.download</code>方法来下载文件。</p><p id="52b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">__dirname</code>是快递app的当前工作目录。</p><h1 id="f297" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将文件作为静态文件</h1><p id="98e2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以使用<code class="fe me mf mg mh b">express.static</code>中间件将服务器中的一个文件夹作为静态文件夹。</p><p id="4e29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="deb0" class="mq lc iq mh b gy mr ms l mt mu">const express = require('express')<br/>const app = express()<br/>const port = 3000<br/>app.use('/download', express.static('download'))</span><span id="bc75" class="mq lc iq mh b gy mv ms l mt mu">app.get('/', (req, res) =&gt; {<br/>  res.send('Hello World!')<br/>})</span><span id="f276" class="mq lc iq mh b gy mv ms l mt mu">app.listen(port, () =&gt; {<br/>  console.log(`Example app listening at http://localhost:${port}`)<br/>})</span></pre><p id="f3ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">app.use</code>来使用Express静态中间件。</p><p id="c45b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是用户用来访问静态文件夹内容的路径。</p><p id="70bf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个理由是快速静态中间件。</p><p id="7a57" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过用文件夹路径字符串调用<code class="fe me mf mg mh b">express.static</code>来创建中间件。</p><p id="fd69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们将服务器中的<code class="fe me mf mg mh b">download</code>文件夹作为静态文件夹。</p><h1 id="4a1e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">资源附件</h1><p id="124d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以用<code class="fe me mf mg mh b">route.attachment</code>方法在我们的路由中返回一个文件作为响应。</p><p id="2a47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它采用与<code class="fe me mf mg mh b">res.download</code>方法相同的参数。</p><p id="5f18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将<code class="fe me mf mg mh b">Content-Disposition</code>响应头设置为<code class="fe me mf mg mh b">attachment</code>。</p><p id="6d42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它还根据正在下载的文件类型设置<code class="fe me mf mg mh b">Content-Type</code>响应头。</p><p id="95f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ff85" class="mq lc iq mh b gy mr ms l mt mu">const express = require('express')<br/>const app = express()<br/>const port = 3000<br/>app.get('/', (req, res) =&gt; {<br/>  res.send('Hello World!')<br/>})</span><span id="b297" class="mq lc iq mh b gy mv ms l mt mu">app.get('/download', (req, res) =&gt; {<br/>  const file = `${__dirname}/download/foo.txt`;<br/>  res.attachment(file).send();<br/>});</span><span id="93b1" class="mq lc iq mh b gy mv ms l mt mu">app.listen(port, () =&gt; {<br/>  console.log(`Example app listening at http://localhost:${port}`)<br/>})</span></pre><p id="6b7c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">send</code>调用<code class="fe me mf mg mh b">res.attachment</code>向用户发送文件下载响应。</p><h1 id="0878" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="260c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用多种方式让用户通过Express端点将文件下载到他们(用户的)设备上。</p><p id="41ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容看</em> <a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>