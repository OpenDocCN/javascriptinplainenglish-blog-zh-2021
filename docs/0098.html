<html>
<head>
<title>3 Simple Optimizations for Your Express.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对Express.js应用程序的3个简单优化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/express-js-optimizations-52d8ef61bb27?source=collection_archive---------1-----------------------#2021-01-06">https://javascript.plainenglish.io/express-js-optimizations-52d8ef61bb27?source=collection_archive---------1-----------------------#2021-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3c1c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">生产就绪应用程序的简单而有效的技巧</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c787b0cb3378d66e56352da0e06cccb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ETcaw-gA1dYW4EFxqGK3w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: the author</figcaption></figure><h1 id="f035" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">1.修复结尾斜线</h1><p id="a609" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">尾随斜线是出现在URL末尾的斜线。看起来是这样的:<code class="fe mj mk ml mm b">localhost:8080/about/</code> —末尾的斜线就是所谓的<strong class="lp ir">尾随斜线</strong>。这实际上是为了标记在这个路径下可以找到更多的内容，所以它是一个目录。</p><p id="74a7" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">问题是，Express.js用相同的响应(相同的页面)来回答带有和不带有尾随斜杠的路径，因此它可以在带有和不带有尾随斜杠的情况下被调用。在下面的基本代码示例中，当我们打开<code class="fe mj mk ml mm b">localhost:8080/about</code>和<code class="fe mj mk ml mm b">localhost:8080/about/</code>时，So Express会提供相同的页面:</p><pre class="kg kh ki kj gt ms mm mt mu aw mv bi"><span id="2ba0" class="mw kw iq mm b gy mx my l mz na">app.get(‘/about’, (req, res) =&gt; {<br/>  res.send(‘about page’)<br/>})</span></pre><p id="380d" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">这些尾随斜线有什么问题？他们可能会导致一个糟糕的搜索引擎优化排名。搜索引擎区分两个URL，因此会注意到重复的内容出现在网站上。</p><p id="ebde" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">我在我的<a class="ae nb" href="http://codingcheats.io" rel="noopener ugc nofollow" target="_blank">网站</a>上遇到了这个问题，正如你所看到的，它被我使用的一个SEO工具归类为一个问题。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/5d71bbf89bf49f101b7b79d0477ed1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3wgfyPgQGIZdRZm6wBe7KA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Site audit from Ubersuggest</figcaption></figure><p id="055e" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">我不是SEO专家，也没有人真正知道搜索引擎的算法到底是如何工作的——但是在像Ubersuggest这样的SEO工具中，尾随斜线被认为是一个严重的SEO问题。</p><p id="45f4" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated"><strong class="lp ir">以下是修复方法。</strong></p><p id="046b" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">为此，我们可以使用一个简单的中间件来检查每个传入的请求。如果请求包含尾部斜杠，它将被删除。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/9052e5fb2c96028a125e5db750147050.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*8xWMq_mingKg60uVKWHf8w.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: the author</figcaption></figure><p id="5651" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">这个中间件应该没有问题地工作——甚至<a class="ae nb" href="https://medium.com/javascript-in-plain-english/query-strings-url-parameters-d1a35b9a694f" rel="noopener"> URL和查询参数</a>也应该仍然工作，因为中间件只删除了不必要的尾部斜杠。</p><h1 id="bca1" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">2.关闭由割台供电</h1><p id="2d40" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">你有没有想过像Wappalyzer这样的工具是怎么知道你的web服务器是基于Express.js的？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ng"><img src="../Images/59d974fae9cf2c100821944015ee90cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*12jCp_KwQWQmPDEfemoftw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: the author</figcaption></figure><p id="26fc" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">这是因为Express.js发送了一个默认的HTTP头——这个头叫做<em class="nh"> X-Powered-By </em>。您可以在浏览器的网络选项卡中轻松找到它:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/84f1d1fa93b8bd803b69b32e2efc8a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*3uY8rgyiCw2uL4gQAovvYQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: the author</figcaption></figure><p id="bec3" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated"><strong class="lp ir">但是我们为什么要禁用这个表头呢？</strong></p><p id="b976" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">首先，它使你的应用程序的整体响应更大——即使只是最小的。</p><p id="1a40" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">第二，它让每个人都看到你的应用是基于Express.js的，这没什么好羞愧的，但我们应该永远做最坏的打算。<br/>在这种情况下，潜在的攻击者会收集有关您系统的信息来寻找漏洞。</p><p id="fa03" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">好在失能，不费吹灰之力。我们只需要下面一行，我们应该将它插入实例创建的正下方:</p><pre class="kg kh ki kj gt ms mm mt mu aw mv bi"><span id="e494" class="mw kw iq mm b gy mx my l mz na">const app = express()</span><span id="2424" class="mw kw iq mm b gy nj my l mz na">app.disable('x-powered-by');</span></pre><h1 id="e0d6" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">3.压缩</h1><p id="2ddc" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">使用压缩可以如此简单。尤其是对于用Express.js交付的较大页面，这是值得的。多亏了NPM模块<em class="nh">压缩，</em>我们可以只用一行代码就大规模压缩我们的内容。<br/>这不仅适用于静态内容，也适用于res.send-responses。</p><p id="1362" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">可以用<code class="fe mj mk ml mm b">npm install compression</code>安装中间件。</p><p id="10a7" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">它必须包含在顶部，即在express.static之前，否则，它只能在有限的范围内工作。<br/>这里有一个正确整合的例子:</p><pre class="kg kh ki kj gt ms mm mt mu aw mv bi"><span id="b6ad" class="mw kw iq mm b gy mx my l mz na">const compression = require("compression")<br/>....</span><span id="f3ba" class="mw kw iq mm b gy nj my l mz na">app.use(compression())</span><span id="645c" class="mw kw iq mm b gy nj my l mz na">app.use('/static', express.static('public'))</span></pre><p id="fc92" class="pw-post-body-paragraph ln lo iq lp b lq mn jr ls lt mo ju lv lw mp ly lz ma mq mc md me mr mg mh mi ij bi translated">这一行做了很多。例如，我创建了一个静态页面，通常大小为18.7 kb——经过压缩；只有1.3 kb。一个巨大的差异，即使它总是依赖于文档。默认情况下，中间件使用gzip压缩。</p><h2 id="55d6" class="mw kw iq bd kx nk nl dn lb nm nn dp lf lw no np lh ma nq nr lj me ns nt ll nu bi translated"><a class="ae nb" href="http://eepurl.com/hacY0v" rel="noopener ugc nofollow" target="_blank">加入我的简讯，了解最新消息</a></h2></div></div>    
</body>
</html>