<html>
<head>
<title>How to Prevent Unexpected Variable Mutation in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何防止JavaScript中意外的变量突变</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-prevent-unexpected-variable-mutation-in-javascript-2612b898732c?source=collection_archive---------13-----------------------#2021-03-09">https://javascript.plainenglish.io/how-to-prevent-unexpected-variable-mutation-in-javascript-2612b898732c?source=collection_archive---------13-----------------------#2021-03-09</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="4a2d" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">有没有遇到过这样的问题，一个变量突然包含了你没有预料到的东西？有简单的方法来防止这种事情再次发生！</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/264fb5ac547e481a720b49af9989c2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*65EaealDWkW2ICmM"/></div></div></figure><p id="3cf0" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">所以当你使用JavaScript时，你可以灵活地用任何东西覆盖任何变量。这可能是有用的，但也可能是痛苦的。这也是为什么许多JavaScript开发人员转向TypeScript的原因。(还有很多好处，但那是以后的事了)</p><p id="4134" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">所以看看下面的代码样本，你会期望发生什么。你希望会发生什么？</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="8995" class="lt lu ir lp b gz lv lw l lx ly">var a = 'test';<br/>[50 lines of code]<br/>var a = 1;<br/>console.log(a);</span></pre><p id="8594" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">因此，对于上面的示例，您可能希望<code class="fe lz ma mb lp b">console.log</code>输出“test ”,因为这是您分配给它的。您可能忘记了变量的第二个声明，现在您很困惑为什么变量包含一个数字，而不是字符串<code class="fe lz ma mb lp b">test</code>。这可能是个问题。</p><p id="564b" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">幸运的是，IDE可以帮助您找到声明该变量的位置，但是情况可能比这复杂得多，并且需要您花费时间来调试这个问题。</p><p id="4a92" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">那么，如何在第一时间防止这种情况发生呢？好了，是时候研究一下作为变量声明的<code class="fe lz ma mb lp b">let</code>和<code class="fe lz ma mb lp b">const</code>了。</p><h1 id="e908" class="mc lu ir bd md me mf mg mh mi mj mk ml jx mm jy mn ka mo kb mp kd mq ke mr ms bi translated">转让var的好处</h1><p id="a781" class="pw-post-body-paragraph ks kt ir ku b kv mt js kx ky mu jv la lb mv ld le lf mw lh li lj mx ll lm ln ik bi translated">因此，首先我们将查看<code class="fe lz ma mb lp b">let</code>声明。与<code class="fe lz ma mb lp b">var</code>相比，<code class="fe lz ma mb lp b">let</code>有几个好处，这会让你永远不会再使用<code class="fe lz ma mb lp b">var</code>。让我们来看看上面的代码示例，但是用<code class="fe lz ma mb lp b">let</code>替换了<code class="fe lz ma mb lp b">var</code>。</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="8264" class="lt lu ir lp b gz lv lw l lx ly">let a = 'test';<br/>[50 lines of code]<br/>let a = 1;<br/>console.log(a);</span></pre><p id="1e76" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">你可能会想，<code class="fe lz ma mb lp b">console.log</code>会再输出<code class="fe lz ma mb lp b">1</code>，但是再猜一次。这是您现在运行这段代码时得到的结果:</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="7955" class="lt lu ir lp b gz lv lw l lx ly">SyntaxError: Identifier 'a' has already been declared</span></pre><p id="5497" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这里发生的是<code class="fe lz ma mb lp b">let</code>阻止你两次重新声明同一个变量。这将防止你意外地覆盖你已经声明的任何内容。</p><p id="8958" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">但是，这并不能防止变量被覆盖。因为，这还是有可能的:</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="084d" class="lt lu ir lp b gz lv lw l lx ly">let a = 'test';<br/>[50 lines of code]<br/>a = 1;<br/>console.log(a);</span></pre><p id="da70" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这里我们仍然会有一个<code class="fe lz ma mb lp b">1</code>的输出，并且不会有错误。这可能是您对代码的期望，在这种情况下，这是完全没问题的，但是如果变量应该保持不变，您可能希望防止这种情况。</p><p id="ab65" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">那么如何预防这种情况呢？好了，是时候看看<code class="fe lz ma mb lp b">const</code>了</p><h1 id="82fa" class="mc lu ir bd md me mf mg mh mi mj mk ml jx mm jy mn ka mo kb mp kd mq ke mr ms bi translated">const优于let的优势</h1><p id="3f3d" class="pw-post-body-paragraph ks kt ir ku b kv mt js kx ky mu jv la lb mv ld le lf mw lh li lj mx ll lm ln ik bi translated">查看<code class="fe lz ma mb lp b">const</code>时，你可能已经注意到它的名字应该是<code class="fe lz ma mb lp b">constant</code>。这正是它的用途。您在<code class="fe lz ma mb lp b">const</code>中设置的任何内容都将保持不变。再拿同样的代码来说:</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="3f1c" class="lt lu ir lp b gz lv lw l lx ly">const a = 'test';<br/>[50 lines of code]<br/>a = 1;<br/>console.log(a);</span></pre><p id="626f" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">那么您将得到以下错误:</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="869e" class="lt lu ir lp b gz lv lw l lx ly">TypeError: Assignment to constant variable.</span></pre><p id="995d" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">如果第二个赋值是一个字符串，而在我们的例子中没有显示数字，也会发生这种情况。</p><p id="6b98" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这将完全防止你用其他东西覆盖这个变量。老实说，你多久需要用一个不同的值覆盖一个变量？比你想象的要少得多。</p><h1 id="3c06" class="mc lu ir bd md me mf mg mh mi mj mk ml jx mm jy mn ka mo kb mp kd mq ke mr ms bi translated">结论</h1><p id="2cbd" class="pw-post-body-paragraph ks kt ir ku b kv mt js kx ky mu jv la lb mv ld le lf mw lh li lj mx ll lm ln ik bi translated">所以无论何时你声明了一个不需要改变的变量，使用<code class="fe lz ma mb lp b">const</code>。如果你设计你的代码有一个变化的变量，使用<code class="fe lz ma mb lp b">let</code>。一个很好的例子就是<code class="fe lz ma mb lp b">for</code>循环</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="3ce3" class="lt lu ir lp b gz lv lw l lx ly">for (let i = 0; i &lt; 10; i++)</span></pre><p id="d905" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">或者当你像这样处理文本操作时</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="7869" class="lt lu ir lp b gz lv lw l lx ly">let text = "a.d.c";<br/>text = text.replace('d','b');<br/>console.log(text);</span></pre><p id="14a5" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">但是在上面的例子中，您可能已经考虑过只保留原来的文本，而在一个新的变量中设置新的文本。</p><pre class="kh ki kj kk gu lo lp lq lr aw ls bi"><span id="fbb1" class="lt lu ir lp b gz lv lw l lx ly">const originalText = "a.d.c";<br/>const newText = originalText.replace('d','b');<br/>console.log(newText);</span></pre><p id="b2f3" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">声明一个新变量不仅没有什么不好的地方(除了临时的几个字节的内存)，还使得文本可读性更好。</p><p id="d7eb" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">但是总结一下，并引用<a class="ae my" href="https://evertpot.com/javascript-let-const/" rel="noopener ugc nofollow" target="_blank"> Evert Pot在他的博客</a></p><ul class=""><li id="9dda" class="mz na ir ku b kv kw ky kz lb nb lf nc lj nd ln ne nf ng nh bi translated">停止使用<code class="fe lz ma mb lp b">var</code>。</li><li id="7c5c" class="mz na ir ku b kv ni ky nj lb nk lf nl lj nm ln ne nf ng nh bi translated">默认使用<code class="fe lz ma mb lp b">const</code>，无处不在。</li><li id="6b3e" class="mz na ir ku b kv ni ky nj lb nk lf nl lj nm ln ne nf ng nh bi translated">如有必要，使用<code class="fe lz ma mb lp b">let</code></li></ul><h2 id="521e" class="lt lu ir bd md nn no dn mh np nq dp ml lb nr ns mn lf nt nu mp lj nv nw mr nx bi translated">进一步阅读</h2><ul class=""><li id="d6ea" class="mz na ir ku b kv mt ky mu lb ny lf nz lj oa ln ne nf ng nh bi translated"><a class="ae my" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let" rel="noopener ugc nofollow" target="_blank">打开MDN </a></li><li id="248a" class="mz na ir ku b kv ni ky nj lb nk lf nl lj nm ln ne nf ng nh bi translated"><a class="ae my" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const" rel="noopener ugc nofollow" target="_blank">MDN上的常量</a></li></ul></div></div>    
</body>
</html>