<html>
<head>
<title>How to Use NestJS Logger</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用NestJS记录器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-nestjs-logger-2a9cb107bce9?source=collection_archive---------2-----------------------#2021-07-13">https://javascript.plainenglish.io/how-to-use-nestjs-logger-2a9cb107bce9?source=collection_archive---------2-----------------------#2021-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0a2e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">NestJS中记录器的两大用例</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/013812a27dd02aaca0ba42d1cc0fd29c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GU9rpEpbwqWAFNzu"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cf28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在任何严肃的开发体验中，日志记录都是一个非常重要的方面。这在开发阶段至关重要，因为它有助于识别bug。</p><p id="afd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是日志在生产阶段也很重要，尤其是当涉及到<strong class="ky ir"> cron作业和其他异步任务</strong>时。这是因为您需要关注服务器上发生的事情。如果cron工作不正常，您应该第一个知道。</p><p id="44c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们将研究如何为您的应用程序实现NestJS记录器。</p><p id="c0fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您基本上想在两个级别使用日志:<strong class="ky ir"> HTTP请求级别</strong>和<strong class="ky ir">服务级别</strong>。</p><p id="2a6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们开始吧！😄</p><p id="16df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">PS:本教程也有视频形式:)</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="7e2a" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">1.安装NestJS记录器</h1><p id="11b0" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">NestJS有一个内置的日志记录器作为一个公共包。所以你不需要安装任何东西。可以对其进行定制，但在这一点上，我们只需按原样导入即可。您可以通过以下方式导入记录器服务:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="d490" class="nd mc iq mz b gy ne nf l ng nh">import { Logger } from '@nestjs/common';</span></pre><p id="c098" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用任何其他日志记录器，如Morgan或Winston，但由于NestJS已经有了一个，所以让我们使用它，不要让外部日志记录器(如Winston或morgan)使我们的生活变得复杂。</p><h1 id="7044" class="mb mc iq bd md me ni mg mh mi nj mk ml jw nk jx mn jz nl ka mp kc nm kd mr ms bi translated">2.在模块中使用NestJS日志记录器来记录业务逻辑</h1><p id="3434" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">记录器最常见的用例是在服务内部。当一些业务逻辑被执行时，或者当一个服务被启动或破坏时，记录值可能是有用的。</p><p id="dc1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个例子中，我们实例化logger对象，并在getHello()函数中记录一个字符串。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn lt l"/></div></figure><p id="d31c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这非常简单，同样的过程可以用于嵌套控制器或任何支持<strong class="ky ir">依赖注入</strong>的文件。</p><p id="634c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我发现服务记录器在处理cronjobs时特别有用。</p><h1 id="cae0" class="mb mc iq bd md me ni mg mh mi nj mk ml jw nk jx mn jz nl ka mp kc nm kd mr ms bi translated">3.在中间件中使用NestJS logger来记录传入的请求</h1><p id="df06" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">记录器最常见的用例之一是HTTP请求记录。您想要查看关于向您的服务器发出的API请求的信息。为了记录请求，我们需要将日志逻辑<a class="ae kv" href="https://docs.nestjs.com/middleware" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">放在中间件</strong> </a>中。</p><p id="b73c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">中间件<strong class="ky ir">在防护器之前运行，防护器在拦截器</strong>之前运行。因此，这是一个在请求被拒绝之前记录所有传入请求的绝佳位置。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/95f8b14015b8fb036970b5503e1f38b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CdBUp6ykh2COtae4Cxi2og.png"/></div></div></figure><p id="c666" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是如何做到这一点:</p><h2 id="6468" class="nd mc iq bd md np nq dn mh nr ns dp ml lf nt nu mn lj nv nw mp ln nx ny mr nz bi translated">1.创建一个日志中间件</h2><p id="7572" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">为了记录请求，我们首先要创建一个日志记录中间件。我们这里用快递。如果您使用的是fastify，您需要检查fastify的具体实现。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn lt l"/></div></figure><h2 id="6d50" class="nd mc iq bd md np nq dn mh nr ns dp ml lf nt nu mn lj nv nw mp ln nx ny mr nz bi translated">2.将中间件导入AppModule</h2><p id="24fa" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">一旦创建了日志中间件，就需要将其导入到应用程序的主模块AppModule中。</p><p id="1bc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以直接在main.ts中导入日志作为一个全局模块，但是我不推荐这样做。如果您在main.ts中导入它，您将失去在logger中间件中使用依赖注入的能力。这总是有用的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nn lt l"/></div></figure><p id="9055" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">开始了。我们现在可以记录请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/1a0c521244406d94b46b05cc5ee2371b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-V5QHzDZyvdl7CmLvwyG2w@2x.png"/></div></div></figure><h1 id="6bcf" class="mb mc iq bd md me ni mg mh mi nj mk ml jw nk jx mn jz nl ka mp kc nm kd mr ms bi translated">结论</h1><p id="b720" class="pw-post-body-paragraph kw kx iq ky b kz mt jr lb lc mu ju le lf mv lh li lj mw ll lm ln mx lp lq lr ij bi translated">日志记录是一个非常有用的特性，但是使用NestJS做好它需要一些技巧。</p><p id="f59d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我已经上传了包含代码的存储库，因此如果有些地方不适合您，您可以查看一下:</p><div class="ob oc gp gr od oe"><a href="https://github.com/vladwulf/nestjs-logger-tutorial" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">vladwulf/nestjs-logger-教程</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">一个渐进式Node.js框架，用于构建高效且可伸缩的服务器端应用程序。嵌套框架类型脚本…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">github.com</p></div></div><div class="on l"><div class="oo l op oq or on os kp oe"/></div></div></a></div><p id="59c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，可以考虑加入我的简讯<a class="ae kv" href="https://vladimiragaev.substack.com/embed" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"/></a><strong class="ky ir"/>并在Twitter  上关注我的<a class="ae kv" href="https://twitter.com/home" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">以获得最新内容。</strong></a></p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="aa3b" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">你可能想读的其他文章</h1><div class="ob oc gp gr od oe"><a href="https://www.codewithvlad.com/blog/nestjs-caching-with-redis" rel="noopener  ugc nofollow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">NestJs缓存与Redis |代码与Vlad博客</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">恭喜你！您已经部署了一个越来越受欢迎的NestJs应用程序！很多用户都在使用你的应用程序…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">www.codewithvlad.com</p></div></div><div class="on l"><div class="ot l op oq or on os kp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener  ugc nofollow" target="_blank" href="/10-things-every-nest-js-developer-should-know-911dec32f66a"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd ir gy z fp oj fr fs ok fu fw ip bi translated">每个Nest.js开发者都应该知道的10件事</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">如何像坏蛋一样使用Nest.js</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="on l"><div class="ou l op oq or on os kp oe"/></div></div></a></div><p id="f3c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ov">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ov">plain English . io</em></strong></a></p></div></div>    
</body>
</html>