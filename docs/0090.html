<html>
<head>
<title>Writing Asynchronous Code in JavaScript Using Async and Await</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Async和Await在JavaScript中编写异步代码</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/writing-asynchronous-code-in-javascript-using-async-and-await-5d43ddcfa31b?source=collection_archive---------16-----------------------#2021-01-05">https://javascript.plainenglish.io/writing-asynchronous-code-in-javascript-using-async-and-await-5d43ddcfa31b?source=collection_archive---------16-----------------------#2021-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0977" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用例子学习写异步JavaScript。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/66ce92ac6ed7839669ecc37e52a20f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hK2cUilm_6XssX9u"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@nubelsondev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nubelson Fernandes</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="13e3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="2479" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">JavaScript是一种单线程编程语言。这意味着它有一个调用堆栈和一个内存堆。正如预期的那样，它按顺序执行代码，并且必须先执行完一段代码，然后才能进入下一段。然而，由于V8引擎，JavaScript可以是异步的，这意味着我们可以一次在代码中执行多个任务。</p><p id="012c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，我们将了解如何使用Async和Await使JavaScript代码异步。让我们开始吧。</p><h1 id="054b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">同步与异步</h1><p id="7050" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在开始之前，我们先来谈谈同步代码和异步代码的区别。</p><p id="a323" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">JavaScript中的同步代码将从文件的顶部开始，一路执行到底部，每一行都按顺序执行，直到它到达底部，然后停止。例如，如果一个函数需要一段时间来执行或必须等待某个东西，它会同时冻结所有东西，因为JavaScript中的同步代码一次只能执行一个任务。它会一直等到某个特定的语句执行完毕，然后移动到下一个语句。</p><p id="14e6" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">另一方面，异步代码也将从文件的顶部到底部开始执行。但在执行过程中，它会遇到一些异步函数，在这些函数中，它会分离出异步代码，并与其余代码同时执行。</p><p id="f973" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">用JavaScript编写异步代码有多种方式，比如回调、承诺和async/await。在本文中，我们将使用Async和Await。</p><h1 id="86be" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">异步和等待</h1><p id="3187" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">引入Async和Await是为了减少嵌套回调带来的麻烦。</p><p id="064d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是一个使用Async和Await的异步代码示例:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="5245" class="mu kx iq mq b gy mv mw l mx my"><strong class="mq ir">async</strong> function functionName(){<br/>  let value = <strong class="mq ir">await</strong> functionReturningPromise();<br/>}<br/><br/>// ES6 syntax<br/>let functionName = <strong class="mq ir">async</strong> () =&gt; {<br/>   let value = <strong class="mq ir">await</strong> functionReturningPromise();<br/>}</span></pre><p id="5b99" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这是一个使用Async和Await的异步函数的例子。</p><p id="6c84" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">异步函数是用关键字<code class="fe mz na nb mq b"><strong class="lq ir">async</strong></code> <strong class="lq ir"> </strong>声明的，并且关键字<code class="fe mz na nb mq b"><strong class="lq ir">await</strong></code>允许出现在这些函数中。需要记住的一点是，关键字<code class="fe mz na nb mq b">await</code>只能在<code class="fe mz na nb mq b">async</code>函数内部使用。</p><p id="e1b1" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们看看下面的例子:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b02d" class="mu kx iq mq b gy mv mw l mx my">// async functions can be called befoe declaration.<strong class="mq ir"><br/>myDisplay()</strong>;</span><span id="16f8" class="mu kx iq mq b gy nc mw l mx my"><strong class="mq ir">async</strong> function myDisplay() {<br/>  let myPromise = new Promise(function(myResolve, myReject) {         setTimeout(function(){ myResolve("I love You !!");}, 3000)<br/>  });<br/>  console.log(<strong class="mq ir">await</strong> myPromise);<br/>}</span><span id="0376" class="mu kx iq mq b gy nc mw l mx my">// This will come before the promise even when it is called after.<br/>console.log("This will come before even when it is called after");<br/></span></pre><p id="d19a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nd">输出:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/3c7a083459f075ad091f85d34b5e59c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*eKPDHsj0FD9yPx8R-Pcs2g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The chrome console.</figcaption></figure><p id="80ad" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如你所看到的，承诺将出现在字符串之后，即使我们在函数中在字符串之前调用它。那是因为承诺需要3000毫秒才能执行。异步代码不会等待它，所以字符串会在承诺之前出现。即使函数在声明之前被调用，它仍然工作，因为它是一个异步函数。</p><h1 id="8ae2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">用异步提取并等待</h1><p id="6c6b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">有时，您需要从API中获取数据，以便在您的应用程序中使用。fetch API允许您这样做，但是我也建议让您的fetch调用异步。因为如果fetch调用花费了大量时间，且您的代码不是异步的，它将停止其他代码的执行并影响您的应用程序的性能。</p><p id="1296" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">看看下面的例子:</p><p id="d3a2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nd">同步码:</em></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="9293" class="mu kx iq mq b gy mv mw l mx my">function getUser(name){<br/> fetch(`https://api.github.com/users/${name}`)<br/>  .then(function(response) {<br/>    return response.json();<br/>  })<br/>  .then(function(json) {<br/>    console.log(json);<br/>  });<br/>};<br/><br/>//get user data<br/>getUser('yourUsernameHere');</span></pre><p id="b9b8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nd">异步代码:</em></p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="b92b" class="mu kx iq mq b gy mv mw l mx my"><strong class="mq ir">async</strong> function getUserAsync(name) <br/>{<br/>  let response = <strong class="mq ir">await</strong> fetch(`https://api.github.com/users/${name}`);<br/>  let data = <strong class="mq ir">await</strong> response.json()<br/>  return data;<br/>}<br/><br/>getUserAsync('yourUsernameHere')<br/>  .then(data =&gt; console.log(data));</span></pre><p id="836f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">并非所有浏览器都完全支持使用Async和Await。所以你要意识到这一点，在开发的时候检查自己的需求。</p><h1 id="25d4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="7b60" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">用JavaScript编写异步代码是所有开发人员都应该具备的技能。至少你需要知道如何处理承诺和异步/等待。</p><h1 id="152c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">更多阅读</h1><div class="nf ng gp gr nh ni"><a href="https://medium.com/javascript-in-plain-english/5-useful-and-tricky-javascript-questions-4b50b5106a2b" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">5个有用而棘手的JavaScript问题</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">JavaScript中需要知道的一些棘手问题。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kp ni"/></div></div></a></div></div></div>    
</body>
</html>