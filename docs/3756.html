<html>
<head>
<title>Create a Simple City Autocomplete Field in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中创建一个简单的城市自动完成字段</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-simple-city-autocomplete-field-in-react-f7675d249c74?source=collection_archive---------2-----------------------#2021-07-28">https://javascript.plainenglish.io/create-a-simple-city-autocomplete-field-in-react-f7675d249c74?source=collection_archive---------2-----------------------#2021-07-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="303d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何在React中创建一个简单的城市自动完成字段</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8dd1605e96967995b888a84228ca0673.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTidicosHZAnqkRX5j0vzg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The autocomplete function we will create</figcaption></figure><p id="fc3a" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">最近，我想实现一个功能，你可以要求纹身艺术家来你的城市。我们如何解决这个问题？我们需要这种格式一致的“城市数据”，以便能够统计向德国柏林等地发出了多少请求。我们需要的是一个API，可以提供所有的城市，让用户可以选择他们的城市。由于世界上所有的城市会形成一个非常长的下拉列表，我们需要让用户能够搜索这个城市列表，换句话说，我们需要一个自动完成功能。</p><p id="321f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">&gt;<a class="ae lo" href="#5057" rel="noopener ugc nofollow">跳到React实现</a></p><h2 id="4064" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">自动完成功能</h2><p id="7c77" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">我们可以使用一个NPM包来为我们的字段添加自动完成功能，但是我们真的需要一个吗？我隐约记得有一种本地方法可以使用一个<code class="fe mn mo mp mq b">input</code>字段和一个<code class="fe mn mo mp mq b">datalist</code>元素来创建一个自动完成字段。让我们来看看:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Native HTML autocomplete functionality</figcaption></figure><p id="006b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">正如你在上面的例子中看到的，我们可以通过给输入一个等于<code class="fe mn mo mp mq b">datalist</code>元素的<code class="fe mn mo mp mq b">id</code>的<code class="fe mn mo mp mq b">list property</code>来将一个<code class="fe mn mo mp mq b">datalist</code> <em class="mt"> </em>元素连接到一个<code class="fe mn mo mp mq b">input</code>字段。当用户开始在我们的输入字段中输入时，给定的选项被过滤，我们的输入字段就像一个选择框。我们已经建立了一个自动完成功能！</p><p id="46d8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">还有一个问题需要解决:我们不希望用户输入我们提供的选项之外的值。再一次，本地HTML拯救了我们。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mu"><img src="../Images/6ff972ee8160ba8613fc11b73eea6dae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPmsyzdBrqOYGyuLVQ1BeA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">We can restrict the input value by using a pattern on an input field.</figcaption></figure><p id="31c0" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">通过向输入字段添加一个<code class="fe mn mo mp mq b">pattern property</code>，我们限制了用户可以提交的允许值。有了这个，我们就可以继续前进了。</p><h2 id="3ec2" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">API</h2><p id="8e89" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">在寻找一个合适的API时，我偶然发现了Mapbox。正如他们的文档中所描述的，他们提供了一个获取城市(或者他们所说的地方)的端点。当玩<a class="ae lo" href="https://docs.mapbox.com/search-playground/#{%22url%22:%22%22,%22index%22:%22mapbox.places%22,%22approx%22:true,%22staging%22:false,%22onCountry%22:true,%22onWorldview%22:true,%22onType%22:true,%22onProximity%22:true,%22onBBOX%22:true,%22onLimit%22:true,%22onLanguage%22:true,%22countries%22:[],%22worldviews%22:[],%22proximity%22:%22%22,%22typeToggle%22:{%22country%22:false,%22region%22:false,%22district%22:false,%22postcode%22:false,%22locality%22:false,%22place%22:false,%22neighborhood%22:false,%22address%22:false,%22poi%22:false},%22types%22:[],%22bbox%22:%22%22,%22limit%22:%22%22,%22autocomplete%22:true,%22languages%22:[],%22languageStrict%22:false,%22onDebug%22:false,%22selectedLayer%22:%22%22,%22debugClick%22:{},%22localsearch%22:false,%22query%22:%22%22}" rel="noopener ugc nofollow" target="_blank">这个演示</a>时，它变得更加清晰，这就是我们正在寻找的。幸运的是，Mapbox提供了一个慷慨的免费层。<br/>要使用Mapbox，您需要<a class="ae lo" href="https://www.mapbox.com/signup" rel="noopener ugc nofollow" target="_blank">注册</a>并创建您的个人API密钥。我们将在我们的。env文件来获取城市。</p><h2 id="5057" class="lp lq in bd lr ls lt dn lu lv lw dp lx lb ly lz ma lf mb mc md lj me mf mg mh bi translated">我们城市自动完成的React实现</h2><p id="b130" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">事不宜迟，让我们看一下代码，然后一起浏览一下。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mv ms l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">cityAutocomplete.js</figcaption></figure><p id="242f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在render方法中，您将认识到我们前面描述的本机HTML自动完成功能。让我们放大功能。</p><p id="a462" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">首先是我们的<code class="fe mn mo mp mq b">input</code>领域。在改变时，调用<code class="fe mn mo mp mq b">handleCityChange</code>函数。这个函数使用输入字段的值来异步调用<code class="fe mn mo mp mq b">fetchPlace</code>函数。让我们看看我们的fetchPlace函数:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mv ms l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">fetchPlace.js</figcaption></figure><p id="536d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在我们的fetchPlace函数中，我们使用输入值将其插入到地理编码Api端点中(这是我从他们的演示中获得的)。我们还提供存储在环境变量中的访问令牌。</p><p id="fbe2" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">回到我们的<code class="fe mn mo mp mq b">handleCityChange</code>函数。当调用成功时，我们可以从结果的<code class="fe mn mo mp mq b">features</code>属性中提取我们的城市名称。在将这些数据存储到我们的<code class="fe mn mo mp mq b">autocompleteCities</code>状态之前，我们确保<code class="fe mn mo mp mq b">features</code> prop不是<em class="mt"> falsy </em>，并且我们检查该值是否已经在我们的<code class="fe mn mo mp mq b">autocompleteCities</code>状态中。我们这样做是为了防止当用户选择一个触发onChange事件的选项时，自动完成功能再次打开。最后，我们通过将它存储在我们的<code class="fe mn mo mp mq b">autocompleteErr</code>状态中来处理任何可能来自api调用的错误。</p><p id="0311" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们已经在de <code class="fe mn mo mp mq b">autocompleteCities</code> state中存储了我们的城市名称，我们可以在输入字段中添加它，用管道分隔，作为一种模式。这将限制我们的输入字段中允许的值。我们还使用我们的<code class="fe mn mo mp mq b">autocompleteCities</code>状态来生成数据表中的选项。</p><p id="6586" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">就是这样，我们已经创建了一个简单的自动完成功能来轻松地选择您的城市。🎉</p><p id="5343" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">你可以在GitHub 上查看完整的源代码<a class="ae lo" href="https://github.com/wendydek/citysearch" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="7cb7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">最后，如果你对“请求纹身师到我的城市”功能感兴趣，我需要这个功能的原因。你可以在这里查看:<a class="ae lo" href="https://www.winkt.io/tattoo-artist/happyfishhead#cityrequest" rel="noopener ugc nofollow" target="_blank">https://www . winkt . io/tattoo-artist/happy fishhead # city request</a></p><p id="0789" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="mt">更多内容看</em> <a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="mt">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>