<html>
<head>
<title>Build a Rich-Text Editor with React Draft Wysiwyg</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Draft Wysiwyg构建富文本编辑器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-rich-text-editor-with-react-draft-wysiwyg-2b2f99a57907?source=collection_archive---------2-----------------------#2021-04-10">https://javascript.plainenglish.io/building-a-rich-text-editor-with-react-draft-wysiwyg-2b2f99a57907?source=collection_archive---------2-----------------------#2021-04-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9c51805498affb8065ee933cbd1d1c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Sy--WZIx8DpAlFxeNFmGA.jpeg"/></div></div></figure><p id="dc00" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">富文本编辑器已经成为现代web中的一个常见组件。它使网站与用户的互动性更强。但是构建一个富文本编辑器真的很难。</p><p id="0ccf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于react社区，我们很幸运有react-draft-wysiwyg。这是一个强大的文本编辑器。在本文中，我将使用react-draft-wysiwyg构建一个富文本编辑器。然后保存内容并显示。我们开始吧！</p><div class="kt ku gp gr kv kw"><a href="https://jpuri.github.io/react-draft-wysiwyg/#/" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">反应草稿所见即所得</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">编辑描述</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">jpuri.github.io</p></div></div></div></a></div></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="09e6" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated"><strong class="ak">设置项目</strong></h1><p id="1419" class="pw-post-body-paragraph jv jw in jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">首先创建一个react项目。您可以使用create-react-app或以您喜欢的方式构建。完成后，让我们安装我们将需要的软件包。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="5a33" class="my ln in mu b gy mz na l nb nc">npm install -s draft-js</span><span id="afc8" class="my ln in mu b gy nd na l nb nc">npm install -s react-draft-wysiwyg</span><span id="611d" class="my ln in mu b gy nd na l nb nc">npm install -s draftjs-to-html</span></pre><p id="f723" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">或者</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="2d1f" class="my ln in mu b gy mz na l nb nc">yarn add draft-js</span><span id="bbc7" class="my ln in mu b gy nd na l nb nc">yarn add react-draft-wysiwyg</span><span id="0812" class="my ln in mu b gy nd na l nb nc">yarn add draftjs-to-html</span></pre><p id="3d9d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个Editor.js文件，然后将它们导入到我们的TextEditor组件。别忘了导入它的CSS模块。</p><p id="276b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们添加两个属性来设置编辑器的样式。它们是wrapperStyle和editorStyle。就这样，我们可以立即看到编辑器的用户界面。</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="f296" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们检查一下！</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/50734b8934f2b4cf411fb427fc394c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1310/format:webp/1*RQDaV1a4Ne1P4YbpWn9m-w.png"/></div></figure></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="9e80" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">自定义工具栏</h1><p id="3695" class="pw-post-body-paragraph jv jw in jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">现在我们可以看到我们的文本编辑器。它的工具栏看起来很强大。它有如此多的选择。但是如果我们不需要那么多选择呢？别担心，这个工具栏是完全定制的。它为我们提供了一个自定义的工具栏属性。第一个也是最重要的参数是选项。这是一个包含我们刚刚在工具栏中看到的所有选项的数组。以下是默认选项:</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="0ae3" class="my ln in mu b gy mz na l nb nc">options: ['inline', 'blockType', 'fontSize', 'fontFamily', 'list', 'textAlign', 'colorPicker', 'link', 'embedded', 'emoji', 'image', 'remove', 'history']</span></pre><p id="2c11" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要管理工具栏，我们所要做的就是从选项中删除那些我们不需要的。</p><p id="612f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在工具栏属性中，每个选项都有自己的参数供我们管理。让我们以“内联”为例。默认情况下，它看起来如下:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="4899" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在选项参数中，我们决定显示哪个选项。我们还可以通过给工具栏中的这些选项按钮赋予classname来增加它们的样式。如果你不想所有的选项都显示在工具栏上，只需设置' inDropDown '为真。那么所有的内嵌选项都将出现在一个下拉列表中。当然，我们可以通过设置dropdownClassName来编辑它的样式。</p></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="66a6" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">编辑器状态</h1><p id="5e0e" class="pw-post-body-paragraph jv jw in jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">我们已经做了用户界面部分，但功能还没有准备好。让我们让它活起来！</p><p id="a04a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先从draft-js导入EditorState，并调用它的方法createEmpty()。然后我们创建一个状态(editorState)来存储它。还要创建一个状态(rawMessage)来存储我们创建的字符串，并创建一个状态(Message)来显示我们的消息。</p><p id="ce37" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们需要一个函数来处理内容。因此，我们创建一个函数onEditorStateChange来设置onEditorStateChange属性。然后从draft-js导入convertToRaw，从draftjs-to-html导入draftToHtml。</p><p id="c01e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们在onEditorStateChange函数中施展一下魔法。当我们在编辑器中添加内容时，它们将被存储在EditorState中，这是一个对象。EditorState对象包括内容、样式和编辑记录。我们需要它的getCurrentContent()方法来只获取内容。我们从EditorState.getCurrentContent()得到的仍然是一个对象。所以我们使用convertToRaw()将其转换为raw JS结构。并使用draftToHtml将其转换为Html作为字符串类型，因为我们无法在React.DOM中显示JS。</p><p id="04ad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每次editorState更改时都会调用此函数。我们从editorState转换的内容将被设置为rawMessage。</p></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><h1 id="c23f" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">危险的</h1><p id="2e69" class="pw-post-body-paragraph jv jw in jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">最后，我们完成了EditorState到HTML的转换，并将其设置为rawMessage。是时候展示我们的原始信息内容了。我创建了一个提交按钮来将我们的内容设置为消息状态。一旦用户完成编辑，只需点击提交按钮，我们在编辑器中创建的内容就会显示在上面。</p><p id="065c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但问题是我们不能直接从React设置HTML。我们必须使用dangerouslySetInnerHTML属性。根据官方文档，它是React在浏览器DOM中使用innerHTML的替代品。</p><p id="90ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以我们将消息状态插入到dangerouslySetInnerHTML属性中的__html键。</p><p id="efed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">检查下面的代码:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="21c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">查看下面编辑器的工作方式:</p><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/a448e76999955e9a165a5aa95ad0a1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QmqhsHlBM8gfY2fzvmxHnA.gif"/></div></div></figure><h2 id="5e5a" class="my ln in bd lo ni nj dn ls nk nl dp lw kg nm nn ma kk no np me ko nq nr mi ns bi translated">结论</h2><p id="310f" class="pw-post-body-paragraph jv jw in jx b jy mk ka kb kc ml ke kf kg mm ki kj kk mn km kn ko mo kq kr ks ig bi translated">就是这个！我们现在有了一个富文本编辑器。我们可以将编辑器中的所有内容保存并显示为字符串。</p><p id="4c46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你也可以检查我下面的代码:</p><div class="kt ku gp gr kv kw"><a href="https://github.com/weianofsteel/react-text-editor" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab fo"><div class="ky ab kz cl cj la"><h2 class="bd io gy z fp lb fr fs lc fu fw im bi translated">weianofsteel/react-text-editor</h2><div class="ld l"><h3 class="bd b gy z fp lb fr fs lc fu fw dk translated">反应文本编辑器。在GitHub上创建一个帐户，为weianofsteel/react-text-editor的开发做出贡献。</h3></div><div class="le l"><p class="bd b dl z fp lb fr fs lc fu fw dk translated">github.com</p></div></div></div></a></div><p id="4c62" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nt">更多内容看</em><a class="ae nu" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nt">plain English . io</em></strong></a></p></div></div>    
</body>
</html>