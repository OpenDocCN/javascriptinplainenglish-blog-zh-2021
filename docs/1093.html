<html>
<head>
<title>API Server Setup with Express.js, TypeScript, and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express.js、TypeScript和MongoDB设置API服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/api-server-setup-with-express-js-typescript-and-mongodb-part-3-b02409f072e4?source=collection_archive---------12-----------------------#2021-03-07">https://javascript.plainenglish.io/api-server-setup-with-express-js-typescript-and-mongodb-part-3-b02409f072e4?source=collection_archive---------12-----------------------#2021-03-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c00c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第3部分:向我们的API添加MongoDB</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/e364986da625b162584f1c484adbdbbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*LkU6JjfNdYxv3Q8weUcnEg.jpeg"/></div></figure><p id="1d10" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">我们将从本教程系列的<a class="ae lg" href="https://wardprice.medium.com/api-server-setup-with-express-js-and-typescript-part-2-531f9546993c" rel="noopener">中停止的地方继续，向我们的API添加MongoDB。如果你现在刚刚开始，请随意在这里克隆上一篇教程</a><a class="ae lg" href="https://github.com/woink/expressBlog/tree/8400e6a999491bc5aeb384d326dafe718f0be617" rel="noopener ugc nofollow" target="_blank">中的所有代码。</a></p><p id="f47a" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">首先我们需要下载<a class="ae lg" href="https://www.mongodb.com/try/download/community" rel="noopener ugc nofollow" target="_blank"> MongoDB社区服务器</a>。确保为您的操作系统选择正确的下载，然后按照<a class="ae lg" href="https://docs.mongodb.com/manual/administration/install-community/" rel="noopener ugc nofollow" target="_blank">说明</a>在您的系统上安装并运行它。MongoDB社区服务器完全免费，任何人都可以使用！</p><p id="4e46" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在回到这个项目。在您的<code class="fe lh li lj lk b">/src</code>文件夹中创建一个名为<code class="fe lh li lj lk b">connect.ts</code>的文件。在这里，我们将为express编写连接到数据库的配置。为了连接到数据库，我们需要使用一个<strong class="km io">对象数据建模(ODM) </strong>工具。使用ODM将允许提供一些结构和内置的业务逻辑，这将使我们的生活变得容易得多，少写多做！可能MongoDB最流行的ODM是<a class="ae lg" href="https://mongoosejs.com" rel="noopener ugc nofollow" target="_blank">mongose</a>所以让我们安装它，因为我们使用的是typescript，它的类型。</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="ec73" class="lp lq in lk b gy lr ls l lt lu">$ npm i mongoose<br/>$ npm i -D @types/mongoose</span></pre><p id="3d35" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">打开<code class="fe lh li lj lk b">connect.ts</code>文件，用命令行导入猫鼬</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="da34" class="lp lq in lk b gy lr ls l lt lu">import mongoose from 'mongoose';</span></pre><p id="f039" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">接下来，我们需要创建一个函数，该函数将获取数据库地址，并在连接成功或出现错误时执行操作。</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="1897" class="lp lq in lk b gy lr ls l lt lu">export default ({ db }) =&gt; {<br/>  const connect = () =&gt; {<br/>    mongoose<br/>      .connect(db, {<br/>        useNewUrlParser: true,<br/>        useUnifiedTopology: true, <br/>        useCreateIndex: true<br/>      })<br/>      .then(() =&gt; {<br/>        return console.info('Successfully connected to Database');<br/>      })<br/>      .catch((error) =&gt; {<br/>        console.error('Error connecting to database: ", error);<br/>        return process.exit(1);<br/>      });<br/>  };<br/>  connect()</span><span id="04a3" class="lp lq in lk b gy lv ls l lt lu">  mongoose.connection.on('disconnected', connect);<br/>};</span></pre><p id="1fda" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">使用数据库字符串，我们尝试连接到数据库。如果成功，我们将打印到数据库<code class="fe lh li lj lk b">Successfully connected to Database</code>。否则，错误消息<code class="fe lh li lj lk b">Error connecting to database</code>将与系统错误消息一起被记录，连接尝试将被退出。</p><p id="89e1" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">然而，因为我们使用的是字体，你可能会在<code class="fe lh li lj lk b">db</code>下面看到一条红色的曲线。这是因为typescript不知道<code class="fe lh li lj lk b">db</code>应该是什么类型。我们知道它只会是一个字符串，所以让我们在<code class="fe lh li lj lk b">connect.ts</code>中创建一个新的类型来告诉typescript“嘿，这个变量<code class="fe lh li lj lk b">db</code>只会是一个字符串”</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="0c17" class="lp lq in lk b gy lr ls l lt lu">type TDBInput = {<br/>  db: string;<br/>};</span></pre><p id="9eea" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在我们需要做的就是告诉typescript使用该类型。方法是在函数参数中的<code class="fe lh li lj lk b">{ db }</code>后添加<code class="fe lh li lj lk b">: TDBInput</code>。你完整的<code class="fe lh li lj lk b">connect.ts</code>应该是这样的。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="d0ab" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">现在添加我们的MongoDB连接到我们的服务器打开<code class="fe lh li lj lk b">/src/index.ts</code>。让我们首先通过在导入语句中添加下面一行来导入我们刚刚创建的<code class="fe lh li lj lk b">connect.ts</code>文件。</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="c3ec" class="lp lq in lk b gy lr ls l lt lu">import connect from './connect';</span></pre><p id="bb38" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">在最底部声明常量<code class="fe lh li lj lk b">db</code>，并将其设置为应该运行的本地MongoDB实例。默认为<code class="fe lh li lj lk b">mongodb://localhost:27017</code>。在地址之后，您可以添加您想要创建的集合的名称，如果该集合不存在，MongoDB将自动创建它。由于我们正在制作一个电影查找应用程序，我们将命名我们的电影</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="c066" class="lp lq in lk b gy lr ls l lt lu">const db = 'mongodb://localhost:27017/movies';</span></pre><p id="fe8b" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">剩下唯一要做的就是使用我们导入的<code class="fe lh li lj lk b">connect</code>函数，并将其设置为我们的<code class="fe lh li lj lk b">db</code>常量。</p><pre class="kd ke kf kg gt ll lk lm ln aw lo bi"><span id="bf55" class="lp lq in lk b gy lr ls l lt lu">connect({ db });</span></pre><p id="2e16" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">您的<code class="fe lh li lj lk b">/src/index.ts</code>文件现在应该看起来像这样。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="lw lx l"/></div></figure><p id="c9ac" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您在终端中使用<code class="fe lh li lj lk b">$ npm start</code>命令启动服务器，这将需要一分钟的时间，但是您应该会收到消息，表明您成功连接到了数据库！</p><p id="ab8e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae lg" href="https://github.com/woink/expressBlog/tree/8a1592d4b963f91fe0d3fe91db6bbbcf3ef2d4a8" rel="noopener ugc nofollow" target="_blank">要克隆的完整代码</a></p><p id="be2e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">下次我们创建一些数据模型并开始向MongoDB提交数据</p><p id="a352" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">快乐编码</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h1 id="027e" class="mf lq in bd mg mh mi mj mk ml mm mn mo jt mp ju mq jw mr jx ms jz mt ka mu mv bi translated">系列教程</h1><p id="ae8d" class="pw-post-body-paragraph kk kl in km b kn mw jo kp kq mx jr ks kt my kv kw kx mz kz la lb na ld le lf ig bi translated"><a class="ae lg" href="https://wardprice.medium.com/api-server-setup-with-express-js-mongodb-and-typescript-part-1-bea7e4f5b526" rel="noopener"> <strong class="km io">第一部分:“你好世界！”</strong> </a></p><p id="a29e" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae lg" href="https://wardprice.medium.com/api-server-setup-with-express-js-and-typescript-part-2-531f9546993c" rel="noopener"> <strong class="km io">第二部分:设置路由器</strong> </a></p><p id="c84a" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="km io">第3部分:连接到MongoDB </strong></p></div></div>    
</body>
</html>