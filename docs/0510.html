<html>
<head>
<title>Seed Your Bulk Data To MongoDB In Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的批量数据植入Node.js中的MongoDB</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/seed-your-bulk-data-to-mongodb-in-node-js-57e9046e923d?source=collection_archive---------2-----------------------#2021-01-31">https://javascript.plainenglish.io/seed-your-bulk-data-to-mongodb-in-node-js-57e9046e923d?source=collection_archive---------2-----------------------#2021-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f55e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一名开发人员，我总是专注于让事情变得更简单的事情。以前我从事一个需要大量数据输入的项目。每次我都需要一个一个地输入数据。除了手动输入数据，没有什么让人头疼的了。我们可以用Node.js seeder轻松解决这个问题。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kl"><img src="../Images/30f12c44eb6d66eaf818ae6b388e560e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*7DaFzMm22-nkQfSD2B5alg.png"/></div></figure><p id="ad56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上图会让你大致了解发生了什么。在本文中，我将通过一个简单的场景向您展示如何将json文件(您的数据)直接植入数据库。</p><p id="41e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，您需要创建一个名为seeder.js的文件，我们将在这里编写一个函数，将数据从json文件导入数据库。然后导入以下内容。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/b8aef31f6c66c442f70fd10001ca49a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*4Rsh-AkHMOD6Qw3rRKwQcQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Imports</figcaption></figure><p id="4f3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经导入了Node附带的<code class="fe ky kz la lb b">fs</code>模块。所以我们不需要单独安装。然后我们需要安装<code class="fe ky kz la lb b">mongoose</code>和<code class="fe ky kz la lb b">dotenv</code>包并导入到我们的<strong class="jp ir"> seeder.js </strong>文件中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/6ce8455b62a7c86723324409f8cec604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*QJ_-nunRVIr-gyllnN3BFQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Load env and model</figcaption></figure><p id="35d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经导入了我在config.env中创建的mongo uri，并加载了包含用户模式的用户模型。在我们继续之前，我将向您展示我的用户模型的样本。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/4af9981a0d28e75f2a783d4b1dd1b2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*vWRxz-p6PPLSSm4WVXa9zg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">User Schema</figcaption></figure><p id="9a56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从上面的模式中，你可以了解我们导出到数据库的数据是什么。我将把我的json文件放到我们的数据所在的地方。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/166996e168c49110a2181b01dd71f93d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*Zjo5FO14hqNhWNW4ShatMg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">users.json</figcaption></figure><p id="0005" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是我们的json数据，我们将在seeder函数的帮助下批量上传。现在我们需要将文件连接到数据库。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/3c4ff008ec9fe7c00667a4dd3daaae0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*IH287WrOpXd1ltAzW5_1hQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Connect to database</figcaption></figure><p id="8ab9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">成功建立连接后，现在我们需要读取数据所在的json文件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/dc1d427089d4f9cd10e41d9cdbdc2f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*Mj8Bj4zsoxsuNTtsbsBNbw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Read JSON file</figcaption></figure><p id="2e27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要在<code class="fe ky kz la lb b">JSON.parse</code>的帮助下解析数据，通过<code class="fe ky kz la lb b">fs.readFileSync</code>我们可以定位我们的数据文件。<code class="fe ky kz la lb b">${__dirname}</code>表示当前文件目录，我们的数据驻留在folder _data中，文件名是users.json，然后我们将它赋给users变量。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/398d71acb21be294824bd889e6e953c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*VmiFCp3cuLM96todb3j2Og.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">import function</figcaption></figure><p id="01d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe ky kz la lb b">importData</code>异步函数，我们将数据导入数据库。这里的<code class="fe ky kz la lb b">User</code>是模型，我们使用mongoose中可用的create方法创建记录，并传递通过<code class="fe ky kz la lb b">fs</code>模块读取的用户。我们也可以为删除做类似的事情。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/7296253095c8a66d1e77e4ce0689137a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*bup-FrARnmra09RPcqp1Og.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Delete Function</figcaption></figure><p id="cceb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ky kz la lb b">deleteMany</code>是删除该模型中所有数据的功能。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/df71146fa2ba76fbcdcc95b8a910592b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*cH0GAgqiBKaa6lA1QshnvA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">setting up args</figcaption></figure><p id="109f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们运行文件节点种子时，我们需要指定决定是导入数据还是删除数据的参数。</p><p id="6ff0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，Seeder已经准备好导入和删除文件。在终端中键入以下代码，将数据导入数据库。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/e36b11c16fcde82aa8f87d3c1933b925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*NziReJ_XckNTwDMgNBoiig.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">import data</figcaption></figure><p id="b4ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以检查数据库中的数据是否正确导入。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/a515a0cd6e819f2203a80bc2103e66c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*TH3A6rH3vkOxSUftdC_lSw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Database</figcaption></figure><p id="a984" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如您所见，json文件中的所有数据都已成功导入到我们的数据库中。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ld"><img src="../Images/eb7af91df4aa3dfcf2525565c8189fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*atUjXZ8vRuajUvkoCCMryw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Delete Data</figcaption></figure><p id="66fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，使用上面的命令，您可以从数据库中完全删除数据。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="li lj l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">seeder.js</figcaption></figure><h2 id="9ad7" class="lk ll iq bd lm ln lo dn lp lq lr dp ls jy lt lu lv kc lw lx ly kg lz ma mb mc bi translated">结论</h2><p id="ec35" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">看看我们如何轻松地处理从数据库中导入和删除批量数据。希望你喜欢这篇文章。谢谢！</p></div></div>    
</body>
</html>