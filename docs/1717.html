<html>
<head>
<title>How to Access React Environment Variables on Netlify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在网络上访问React环境变量</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/accessing-react-environment-variables-on-netlify-6228c304f690?source=collection_archive---------7-----------------------#2021-04-12">https://javascript.plainenglish.io/accessing-react-environment-variables-on-netlify-6228c304f690?source=collection_archive---------7-----------------------#2021-04-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eb0c00bd13e7b38f3c5471e7d78fef45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uOHStudWuzTuG9IE.png"/></div></div></figure><p id="b01e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您刚刚完成了最新的React应用程序的开发，您已经准备好与世界其他地方分享它了。唯一阻碍您的是部署应用程序。</p><p id="6050" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有许多方法可以实现这一点，但是本文将指导您如何在Netlify上托管您的应用程序，以及如何正确配置任何前端环境变量。</p><h2 id="2114" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">什么是环境变量？</h2><p id="4389" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">环境变量是在程序外部定义的变量，由名称/值对组成。然后，您可以在代码中的任何位置引用该变量的名称，以便访问其值。</p><h2 id="76c4" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">先决条件</h2><ul class=""><li id="123e" class="lr ls in jx b jy lm kc ln kg lt kk lu ko lv ks lw lx ly lz bi translated">安装<code class="fe ma mb mc md b"><a class="ae me" href="https://www.npmjs.com/package/react-dotenv" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">react-dotenv</strong></a></code> npm包</li><li id="6135" class="lr ls in jx b jy mf kc mg kg mh kk mi ko mj ks lw lx ly lz bi translated">您的应用程序已正确同步到Github存储库</li><li id="2e5f" class="lr ls in jx b jy mf kc mg kg mh kk mi ko mj ks lw lx ly lz bi translated">你有一个净账户</li></ul><h2 id="2b6f" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">托管您的项目</h2><p id="7b1e" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">继续登录您的Netlify帐户，然后导航至<strong class="jx io">团队概述</strong>选项卡。点击按钮从Git 添加一个<strong class="jx io">新站点。从可用的提供者中选择<strong class="jx io"> GitHub </strong>，这将提示您允许GitHub访问您的凭证。登录后，您可以搜索您的存储库，选择要部署的分支，并配置构建设置。现在，我们可以让构建设置保持不变，然后单击<strong class="jx io">部署站点</strong>，但是一旦我们在应用程序中正确配置了<code class="fe ma mb mc md b">react-dotenv</code>，我们将稍后再回到这个问题。</strong></p><h2 id="40be" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">在react应用程序中配置“react-dotenv”库</h2><p id="8211" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">安装好<code class="fe ma mb mc md b"><strong class="jx io">react-dotenv</strong></code>后，让我们进入<code class="fe ma mb mc md b">package.json</code>文件并进行如下编辑。<code class="fe ma mb mc md b">"scripts"</code>键应该包括<code class="fe ma mb mc md b">react-dotenv</code>作为<code class="fe ma mb mc md b">"start"</code>和<code class="fe ma mb mc md b">"build"</code>命令的一部分，如下所示:</p><pre class="mk ml mm mn gt mo md mp mq aw mr bi"><span id="e343" class="kt ku in md b gy ms mt l mu mv">"scripts": {</span><span id="bf87" class="kt ku in md b gy mw mt l mu mv">  "start": "react-dotenv &amp;&amp; react-scripts start",</span><span id="b402" class="kt ku in md b gy mw mt l mu mv">  "build": "react-dotenv &amp;&amp; react-scripts build",</span><span id="6a8e" class="kt ku in md b gy mw mt l mu mv">  "test": "react-scripts test",</span><span id="c930" class="kt ku in md b gy mw mt l mu mv">  "eject": "react-scripts eject"</span><span id="91c6" class="kt ku in md b gy mw mt l mu mv">}</span></pre><p id="b31b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，假设我们有两个环境变量<code class="fe ma mb mc md b">ENV_VAR_1</code>和<code class="fe ma mb mc md b">ENV_VAR_2</code>，我们需要将下面的键/值对添加到我们的<code class="fe ma mb mc md b">package.json</code>文件的末尾:</p><pre class="mk ml mm mn gt mo md mp mq aw mr bi"><span id="8fbe" class="kt ku in md b gy ms mt l mu mv">"react-dotenv": {</span><span id="73ad" class="kt ku in md b gy mw mt l mu mv">  "whitelist": [</span><span id="c806" class="kt ku in md b gy mw mt l mu mv">    "ENV_VAR_1",</span><span id="52b7" class="kt ku in md b gy mw mt l mu mv">    "ENV_VAR_2"</span><span id="4e34" class="kt ku in md b gy mw mt l mu mv">  ]</span><span id="ab26" class="kt ku in md b gy mw mt l mu mv">}</span></pre><p id="a801" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常，我们会将环境变量存储在项目根文件夹中的<code class="fe ma mb mc md b">.env</code>文件中，但是我们绝不会将该文件推送到GitHub存储库中，因为它包含敏感数据(比如秘密的&amp;访问密钥)。</p><p id="1479" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了使用这些变量，我们可以简单地在我们的组件(<code class="fe ma mb mc md b">import env from 'react-dotenv'</code>)中导入<code class="fe ma mb mc md b">react-dotenv</code>，然后引用变量名<code class="fe ma mb mc md b">env.ENV_VAR_1</code>。</p><h2 id="4556" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">动态创建<code class="fe ma mb mc md b">.env</code>文件</h2><p id="bd43" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">由于我们从不将<code class="fe ma mb mc md b">.env</code>文件推送到GitHub仓库，我们可以编写一个小脚本，在Netlify部署我们的构建时生成这个文件。对于这个脚本，我们将使用来自<code class="fe ma mb mc md b">fs</code>库的JavaScript的<code class="fe ma mb mc md b">writeFileSync()</code>函数，看起来像这样:</p><pre class="mk ml mm mn gt mo md mp mq aw mr bi"><span id="3e93" class="kt ku in md b gy ms mt l mu mv">const fs = require('fs')<br/>const path = `./.env`<br/>const vars = `<br/> ENV_VAR_1=${process.env.ENV_VAR_1_NETLIFY}\n<br/> ENV_VAR_2=${process.env.ENV_VAR_2_NETLIFY}<br/>`</span><span id="3f9a" class="kt ku in md b gy mw mt l mu mv">fs.writeFileSync(path, vars)</span></pre><p id="8a7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:我们可以通过引用<code class="fe ma mb mc md b">process.env.ENV_VAR_NAME</code>来访问Netlify中定义的环境变量(详见下文)。</p><h2 id="404a" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">配置网络生活站点设置</h2><p id="6548" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">接下来，让我们登录我们的Netlify帐户，并导航到我们新站点的<strong class="jx io">站点设置</strong>选项卡。在<strong class="jx io">Build&amp;Deploy&gt;Environment</strong>下，我们可以指定我们希望在程序中使用的环境变量，应该如下所示:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/3374b01909c6d95021fcdf5145f7d3ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c89SbCPvRltsQTEMQbFlbQ.png"/></div></div></figure><p id="58c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是我们应该指定环境变量的实际值的唯一地方。接下来，我们需要告诉Netlify通过执行我们的定制脚本来生成我们的<code class="fe ma mb mc md b">.env</code>文件:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/073d18f8a9d49c1cb5da4a62c9e64264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*7cySjWzqhYNO61CetPH58w.png"/></div></figure><h2 id="7b1c" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">结论</h2><p id="b911" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">太好了！配置好一切之后，让我们转到<strong class="jx io"> Deploy </strong>选项卡，为我们的应用程序触发一个新的部署。</p><p id="6304" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">build命令应该生成一个<code class="fe ma mb mc md b">.env</code>文件，它将使用我们在Netlify中指定的值来定义我们的环境变量，允许我们通过在组件中导入<code class="fe ma mb mc md b">.react-dotenv</code>库来访问它们的值。</p><p id="8e60" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编码快乐！</p><p id="6fb1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mz">更多内容请看</em><a class="ae me" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>