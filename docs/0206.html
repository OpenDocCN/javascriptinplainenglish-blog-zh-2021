<html>
<head>
<title>Adding Authentication to a Nuxt App with the Nuxt Auth Module</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nuxt验证模块向Nuxt应用程序添加验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-authentication-to-a-nux-app-with-the-nuxt-auth-module-3ce290a829c2?source=collection_archive---------5-----------------------#2021-01-12">https://javascript.plainenglish.io/adding-authentication-to-a-nux-app-with-the-nuxt-auth-module-3ce290a829c2?source=collection_archive---------5-----------------------#2021-01-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/72aab0a1307af3c574dc1f8e09ff5e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hqWkNnSTnrZ_Nm2m"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lorrenx?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marta Bednarska</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2ab4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Nuxt Auth模块，我们可以轻松地将身份验证添加到我们的Nuxt应用程序中。</p><p id="da78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Express和Nuxt Auth模块向我们的Nuxt应用程序添加身份验证。</p><h1 id="ae52" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">入门指南</h1><p id="a968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须添加Axios和Nuxt认证模块。</p><p id="efda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Nuxt Auth使用Axios发送请求。</p><p id="358e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装它，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5b12" class="mn lc iq mj b gy mo mp l mq mr">yarn add @nuxtjs/auth @nuxtjs/axios</span></pre><p id="4f87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5bfc" class="mn lc iq mj b gy mo mp l mq mr">npm install @nuxtjs/auth @nuxtjs/axios</span></pre><p id="6382" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe ms mt mu mj b">nuxt.config.js</code>中，我们添加:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7b38" class="mn lc iq mj b gy mo mp l mq mr">const baseURL = "https://ReasonableRecursiveSupercollider--five-nine.repl.co";</span><span id="8991" class="mn lc iq mj b gy mv mp l mq mr">export default {<br/>  mode: 'universal',<br/>  target: 'server',<br/>  head: {<br/>    title: process.env.npm_package_name || '',<br/>    meta: [<br/>      { charset: 'utf-8' },<br/>      { name: 'viewport', content: 'width=device-width, initial-scale=1' },<br/>      { hid: 'description', name: 'description', content: process.env.npm_package_description || '' }<br/>    ],<br/>    link: [<br/>      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }<br/>    ]<br/>  },<br/>  css: [<br/>  ],<br/>  plugins: [<br/>  ],<br/>  components: true,<br/>  buildModules: [<br/>  ],<br/>  modules: [<br/>    '@nuxtjs/axios',<br/>    '@nuxtjs/auth'<br/>  ],<br/>  axios: {<br/>    baseURL<br/>  },<br/>  build: {<br/>  }<br/>}</span></pre><p id="92ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe ms mt mu mj b">baseURL</code>添加到<code class="fe ms mt mu mj b">axios</code>属性来设置请求的基本URL。</p><p id="8704" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们将<code class="fe ms mt mu mj b">'@nuxtjs/auth'</code>模块添加到<code class="fe ms mt mu mj b">modules</code>数组中来添加模块。</p><p id="96cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">store</code>文件夹中，我们必须添加<code class="fe ms mt mu mj b">index.js</code>来使用Nuxt auth模块。</p><h1 id="d439" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">后端</h1><p id="3acb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们使用Express作为应用程序的后端。</p><p id="f467" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建它，我们通过运行以下命令来安装Express和一些软件包:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d8ab" class="mn lc iq mj b gy mo mp l mq mr">npm i express body-parser cors</span></pre><p id="aca8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在项目文件夹中。</p><p id="e977" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在同一个文件夹中创建<code class="fe ms mt mu mj b">index.js</code>,并添加:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ec34" class="mn lc iq mj b gy mo mp l mq mr">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const cors = require('cors')<br/>const app = express();<br/>app.use(cors())<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: true }));</span><span id="52e8" class="mn lc iq mj b gy mv mp l mq mr">app.post('/api/auth/login', (req, res) =&gt; {<br/>  res.json({});<br/>});</span><span id="1027" class="mn lc iq mj b gy mv mp l mq mr">app.post('/api/auth/logout', (req, res) =&gt; {<br/>  res.json({});<br/>});</span><span id="2117" class="mn lc iq mj b gy mv mp l mq mr">app.get('/api/auth/user', (req, res) =&gt; {<br/>  res.json({});<br/>});</span><span id="6de7" class="mn lc iq mj b gy mv mp l mq mr">app.listen(3000, () =&gt; console.log('server started'));</span></pre><p id="fe6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要<code class="fe ms mt mu mj b">cors</code>中间件来接受跨域请求。</p><p id="485c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">路由是我们向其发送身份验证请求的端点。</p><p id="7730" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该添加逻辑来检查真实应用程序中的用户。</p><h1 id="09c0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">前端</h1><p id="4443" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在我们的Nuxt应用程序中，我们添加了一个<code class="fe ms mt mu mj b">login.vue</code>组件，并添加了:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a1a1" class="mn lc iq mj b gy mo mp l mq mr">&lt;template&gt;<br/>  &lt;div class="container"&gt;<br/>    &lt;form @submit.prevent="userLogin"&gt;<br/>      &lt;div&gt;<br/>        &lt;label&gt;Username&lt;/label&gt;<br/>        &lt;input type="text" v-model="login.username" /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label&gt;Password&lt;/label&gt;<br/>        &lt;input type="text" v-model="login.password" /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="989c" class="mn lc iq mj b gy mv mp l mq mr">&lt;script&gt;<br/>export default {<br/>  middleware: "auth",<br/>  data() {<br/>    return {<br/>      login: {},<br/>    };<br/>  },<br/>  auth: {<br/>    strategies: {<br/>      local: {<br/>        endpoints: {<br/>          login: {<br/>            url: `/api/auth/login`,<br/>            method: "post",<br/>            propertyName: "token",<br/>          },<br/>          logout: { url: `/api/auth/logout`, method: "post" },<br/>          user: {<br/>            url: `/api/auth/user`,<br/>            method: "get",<br/>            propertyName: "user",<br/>          },<br/>        },<br/>      },<br/>    },<br/>  },<br/>  methods: {<br/>    async userLogin() {<br/>      try {<br/>        let response = await this.$auth.loginWith("local", {<br/>          data: this.login,<br/>        });<br/>        console.log(response);<br/>      } catch (err) {<br/>        console.log(err);<br/>      }<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="949e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有一个输入用户名和密码的登录表单。</p><p id="4e61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在组件选项中，我们使用<code class="fe ms mt mu mj b">middleware: 'auth'</code>属性来启用<code class="fe ms mt mu mj b">auth</code>中间件。</p><p id="1029" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们通过添加<code class="fe ms mt mu mj b">auth.strategies.local</code>属性来设置auth选项，以添加端点，我们将向。</p><p id="5bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">login</code>由<code class="fe ms mt mu mj b">this.$auth.loginWith</code>方法用来发出请求。</p><p id="a057" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">auth.strategies.local</code>可选<code class="fe ms mt mu mj b">tokenRequired</code>和<code class="fe ms mt mu mj b">tokenType</code>属性。</p><p id="9abc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">tokenRequired: false</code>禁用所有令牌处理。</p><p id="f951" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">tokenType</code>是要在Axios请求中使用的授权头名称。</p><p id="28e7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">this.$auth.loginWith</code>使用<code class="fe ms mt mu mj b">data</code>属性，将策略作为第一个参数，将数据作为第二个参数。</p><p id="7d05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，当我们提交表单时，会调用<code class="fe ms mt mu mj b">userLogin</code>方法，并使用请求有效负载中的用户名和密码向<code class="fe ms mt mu mj b">https://ReasonableRecursiveSupercollider--five-nine.repl.co/api/auth/login</code>发出请求。</p><h1 id="f6ca" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="282e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Nuxt添加一个登录表单，并使用auth模块来发出请求。</p></div></div>    
</body>
</html>