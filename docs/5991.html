<html>
<head>
<title>How to Use Native ES Modules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用本地ES模块</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-native-es-modules-8bce37435753?source=collection_archive---------20-----------------------#2021-12-22">https://javascript.plainenglish.io/how-to-use-native-es-modules-8bce37435753?source=collection_archive---------20-----------------------#2021-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="eea0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文将展示ECMAScript (ES)模块的例子——您可以用它们实现什么，以及在哪里会遇到一些限制。2018年5月之后发布的所有浏览器都支持ES模块，所以你可以假设它们在大多数情况下都可以安全使用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/98dcb5908c00c368882a97ed86b1ccb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqqeOHsQhB53m2V4edqSAA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk"><a class="ae lb" href="https://caniuse.com/es6-module" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><h1 id="6d86" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">不带ES模块的编码</h1><p id="532a" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在我们有ES模块之前，所有的JS都必须全局导入。每个文件都可以访问先前导入的文件中设置的变量和函数。导入的顺序很重要，特别是因为在名称冲突的情况下，后来导入的内容可能会覆盖早先导入的内容。运行中的老派导入看起来如下:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="1a27" class="mk ld iq mg b gy ml mm l mn mo">// display-data.js:<br/>document.body.innerHTML = “lorem ipsum”;</span><span id="874b" class="mk ld iq mg b gy mp mm l mn mo">// log.js:<br/>console.log("Some test info");</span><span id="8629" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;title&gt;No modules&lt;/title&gt;<br/>    &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;</span><span id="81a6" class="mk ld iq mg b gy mp mm l mn mo">&lt;body&gt;<br/>    &lt;script src="./display-data.js"&gt;&lt;/script&gt;<br/>    &lt;script src="./log.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/6efe6dd93ced06e14ed23e67b3a26743.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoQ7W9Jdv7KnAa9gl6SyFw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Imports without modules</figcaption></figure><p id="6a23" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/no-modules/" rel="noopener ugc nofollow" target="_blank">行动中的榜样</a>。</p><h1 id="4235" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">问题</h1><p id="70a7" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">这种方法有两个主要问题:</p><ol class=""><li id="8942" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">它污染了全球范围。如果有几个文件定义了相同的值，那么它们会相互冲突并覆盖。祝你好运找到并修复它可能导致的错误。示例:</li></ol><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="03b3" class="mk ld iq mg b gy ml mm l mn mo">// data-1.js:<br/>var data = “lorem ipsum”;</span><span id="fa5c" class="mk ld iq mg b gy mp mm l mn mo">// data-2.js:<br/>var data = “sin dolor”;</span><span id="fd2c" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;title&gt;Name collision&lt;/title&gt;<br/>    &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>    &lt;script src="./data-1.js"&gt;&lt;/script&gt;<br/>    &lt;script src="./data-2.js"&gt;&lt;/script&gt;<br/>    &lt;script&gt;<br/>      document.body.innerHTML = data;<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="6919" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/name-collision/" rel="noopener ugc nofollow" target="_blank">本码直播</a>。最常见的解决方法是使用立即调用的函数表达式。这隔离了代码块，防止了全局范围的污染，但同时也使代码更加混乱。</p><p id="68ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.任何依赖都必须手动管理和解决。如果一个文件依赖于另一个文件，那么您必须确保以正确的顺序导入这些文件。例如:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="6f94" class="mk ld iq mg b gy ml mm l mn mo">// log-data.js:<br/>console.log(data);</span><span id="4044" class="mk ld iq mg b gy mp mm l mn mo">// data.js:<br/>const data = ‘some data’;</span><span id="3b66" class="mk ld iq mg b gy mp mm l mn mo">// display-data.js:<br/>document.html = data;</span><span id="1b65" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>   &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>   &lt;title&gt;File order&lt;/title&gt;<br/>   &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>   &lt;script src="./log-data.js"&gt;&lt;/script&gt;<br/>   &lt;script src="./data.js"&gt;&lt;/script&gt;<br/>   &lt;script src="./display-data.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="2c5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如您在这里看到的<a class="ae lb" href="https://how-to-js.github.io/es-modules/file-order/" rel="noopener ugc nofollow" target="_blank"/>，显示数据部分按预期工作，而记录数据失败。</p><h1 id="805c" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">ES模块在运行</h1><p id="31ef" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">如果我们对ES模块做同样的事情，会有什么不同？首先，您在代码级别定义依赖关系。所以，如果你想在一个文件中得到另一个文件的值，你只需要在同一个文件中指定它。这种方法有所不同，尤其是在阅读代码时:您只需打开一个文件，通过阅读它就可以了解它所使用的所有上下文。</p><p id="1b63" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么我们如何使用ES模块呢？</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="c816" class="mk ld iq mg b gy ml mm l mn mo">// data.js:<br/>export const data = "lorem ipsum";</span><span id="a497" class="mk ld iq mg b gy mp mm l mn mo">// display-data.js:<br/>import { data } from "./data.js";<br/><br/>document.body.innerHTML = data;</span><span id="faa2" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;title&gt;Simple modules&lt;/title&gt;<br/>    &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>    &lt;script type="module" src="./display-data.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="486f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这段代码的主要变化是:</p><ol class=""><li id="989c" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">在HTML文件中添加<code class="fe na nb nc mg b">type=”module”</code>到<code class="fe na nb nc mg b">&lt;script&gt;</code>导入。</li><li id="88b7" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk mw mx my mz bi translated">在JS文件中使用export和import关键字来定义和加载模块。</li></ol><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/acef015cf00ec01ff48e9e69264ad19b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTTJlHAVfuGK2fVOKcFTSQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Simple ES module import</figcaption></figure><p id="7557" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/simple-modules/" rel="noopener ugc nofollow" target="_blank">运行实例</a>。</p><h1 id="0fbc" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">多个文件导入同一文件</h1><p id="dcb5" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">我们可以通过两次导入相同的文件来使我们的例子更有趣。因为我们需要每个文件相互独立，所以导入将被添加两次——分别添加到每个文件中。浏览器正确地管理导入，并且只加载文件一次。</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="ef02" class="mk ld iq mg b gy ml mm l mn mo">// data.js:<br/>export const data = "lorem ipsum";</span><span id="33e8" class="mk ld iq mg b gy mp mm l mn mo">// display-data.js:<br/>import { data } from "./data.js";<br/><br/>document.body.innerHTML = data;</span><span id="0a61" class="mk ld iq mg b gy mp mm l mn mo">// log-data.js:<br/>import { data } from "./data.js";<br/><br/>console.log(data);</span><span id="a7d6" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;title&gt;Shared import&lt;/title&gt;<br/>    &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>    &lt;script type="module" src="./display-data.js"&gt;&lt;/script&gt;<br/>    &lt;script type="module" src="./log-data.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/b5eea0800c2b848829ee9606227efabb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jOvcH6UyJdbZaEkGbWaqgw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Import shared between 2 files</figcaption></figure><p id="5555" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/shared-import/" rel="noopener ugc nofollow" target="_blank">举个例子</a></p><h1 id="dabe" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">惰性负载</h1><p id="2276" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">惰性加载延迟了应用程序的加载部分，直到代码是必需的。这是一种比一次加载所有内容更复杂的优化技术，但是它可以更好地控制何时加载什么内容。在下面的例子中，我在半秒钟的延迟后加载并显示数据:</p><pre class="km kn ko kp gt mf mg mh mi aw mj bi"><span id="0173" class="mk ld iq mg b gy ml mm l mn mo">// display-data.js:<br/>setTimeout(<br/>  () =&gt;<br/>    import("./data.js").then(({ data }) =&gt; {<br/>      document.body.innerHTML = data;<br/>    }),<br/>  500<br/>);</span><span id="32e0" class="mk ld iq mg b gy mp mm l mn mo">// data.js:<br/>export const data = "lorem ipsum";</span><span id="7e91" class="mk ld iq mg b gy mp mm l mn mo">// index.html:<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;<br/>    &lt;title&gt;Lazy load&lt;/title&gt;<br/>    &lt;link rel="shortcut icon" href="#" /&gt;<br/>  &lt;/head&gt;<br/><br/>  &lt;body&gt;<br/>    &lt;script type="module" src="./display-data.js"&gt;&lt;/script&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/341dbdfa2e49124abb59a65015f37ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BeRVO_Qq71PaZEkJ_2IBA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Lazy import of data.js</figcaption></figure><p id="9eff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/lazy-load/" rel="noopener ugc nofollow" target="_blank">懒加载示例</a></p><h1 id="5480" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">es模块是否涵盖了我们在现代JS中需要的所有内容？</h1><p id="8a9f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">尽管原生ES模块极大地改进了以前包含内容的模型，但是它们缺少一些现代JavaScript开发的基本特性。现在，您不能执行以下操作:</p><ol class=""><li id="65ef" class="mr ms iq jp b jq jr ju jv jy mt kc mu kg mv kk mw mx my mz bi translated">导入JS以外的类型。其他一些文件正在准备中<a class="ae lb" href="https://tc39.es/proposal-json-modules/" rel="noopener ugc nofollow" target="_blank"> JSON </a>，但是要在浏览器中看到它们还需要很长时间。</li><li id="da7d" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk mw mx my mz bi translated">以类似Node.js的方式导入第三方库。您可以在构建过程中复制文件，并从<code class="fe na nb nc mg b">node_modules</code>中的某个位置导入它们，但这感觉比仅仅从<code class="fe na nb nc mg b">import “library”</code>中导入要复杂得多。</li><li id="65e5" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk mw mx my mz bi translated">没有蒸腾作用。许多现代JS是用其他语言编写的——例如，TypeScript。即使纯JS也需要transpilation来支持旧的浏览器或使用最新的语言特性。</li></ol><p id="9b45" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于这些原因，在大多数项目中，您会看到JS bundlers，一种为部署准备构建的编译器。如果你对捆绑器感兴趣，请在评论中告诉我，并查看链接。</p><h1 id="17f6" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">链接</h1><ul class=""><li id="7800" class="mr ms iq jp b jq ma ju mb jy nk kc nl kg nm kk nn mx my mz bi translated"><a class="ae lb" href="https://github.com/how-to-js/es-modules" rel="noopener ugc nofollow" target="_blank">范例库</a></li><li id="9a2c" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk nn mx my mz bi translated"><a class="ae lb" href="https://how-to-js.github.io/es-modules/" rel="noopener ugc nofollow" target="_blank">所有例子</a></li><li id="19f6" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk nn mx my mz bi translated"><a class="ae lb" href="https://bit.ly/esbuild-course" rel="noopener ugc nofollow" target="_blank">我的esbuild视频课程</a></li><li id="2373" class="mr ms iq jp b jq nd ju ne jy nf kc ng kg nh kk nn mx my mz bi translated"><a class="ae lb" href="https://bit.ly/WebpackCourse" rel="noopener ugc nofollow" target="_blank">我的Webpack视频课程</a></li></ul><h1 id="7bf7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">摘要</h1><p id="6a19" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在这篇文章中，我们浏览了es模块的关键用例。下一步是建立一些JS捆绑器来克服本地模块的限制。</p></div><div class="ab cl no np hu nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ij ik il im in"><p id="4026" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nv">最初发布于</em><a class="ae lb" href="https://how-to.dev/how-to-use-native-es-modules" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://how-to . dev</em></a><em class="nv">。</em></p><p id="cf98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nv">更多内容看</em> <a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="nv">说白了. io </em> </strong> </a> <strong class="jp ir"> <em class="nv">。</em> </strong> <em class="nv">报名参加我们的</em> <a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="nv">免费每周简讯点击这里</em> </strong> </a> <strong class="jp ir"> <em class="nv">。</em> </strong></p></div></div>    
</body>
</html>