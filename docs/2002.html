<html>
<head>
<title>Where Can We Make API Calls with Hooks in React?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中哪里可以用钩子进行API调用？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/where-can-we-make-api-calls-with-hooks-in-react-bd9022e1522e?source=collection_archive---------12-----------------------#2021-04-26">https://javascript.plainenglish.io/where-can-we-make-api-calls-with-hooks-in-react-bd9022e1522e?source=collection_archive---------12-----------------------#2021-04-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aef0a32dca3227ecd375d804c1eeafd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Yc53tN3vhcyOvhUK"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@trojantry?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andy Art</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3829" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">发出HTTP请求是我们在React代码中经常要做的事情。</p><p id="2f2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将看看在React组件中，我们应该在哪里使用React钩子进行API调用。</p><h1 id="ade4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">仅在装载时调用API</h1><p id="ee0f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了只在组件挂载时进行API调用，我们可以使用带有空数组的<code class="fe me mf mg mh b">useEffect</code>回调作为第二个参数。</p><p id="8ed7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f130" class="mq lc iq mh b gy mr ms l mt mu">import { useEffect, useState } from "react";</span><span id="d9ae" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const [user, setUser] = useState({});</span><span id="6212" class="mq lc iq mh b gy mv ms l mt mu">  const getUser = async () =&gt; {<br/>    const results = await fetch("https://randomuser.me/api/");<br/>    const {<br/>      results: [result]<br/>    } = await results.json();<br/>    setUser(result);<br/>  };</span><span id="5e47" class="mq lc iq mh b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    getUser();<br/>  }, []);</span><span id="e6fd" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div className="App"&gt;{JSON.stringify(user)}&lt;/div&gt;;<br/>}</span></pre><p id="d892" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带<code class="fe me mf mg mh b">useState</code>钩子的<code class="fe me mf mg mh b">user</code>状态，它被设置为一个空对象。</p><p id="12c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们定义了调用<code class="fe me mf mg mh b">fetch</code>发出GET请求的<code class="fe me mf mg mh b">getUser</code>函数。</p><p id="6ced" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">results.json()</code>方法来获得JSON响应。</p><p id="a822" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">setUser</code>函数将响应设置为<code class="fe me mf mg mh b">user</code>状态的值。</p><p id="1351" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe me mf mg mh b">useEffect</code>钩子中，我们调用<code class="fe me mf mg mh b">getUser</code>来发出请求。</p><p id="40c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">空数组让我们在<code class="fe me mf mg mh b">App</code>挂载时运行<code class="fe me mf mg mh b">useEffect</code>回调。</p><p id="3481" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们向用户展示这个值。</p><h1 id="afa5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">每当一些属性或状态改变时，API调用</h1><p id="aa2a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要在属性或状态发生变化时进行API调用，我们可以编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="eca1" class="mq lc iq mh b gy mr ms l mt mu">import { useEffect, useState } from "react";</span><span id="e974" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const [id, setId] = useState(1);<br/>  const [todo, setTodo] = useState({});</span><span id="ee21" class="mq lc iq mh b gy mv ms l mt mu">  const getTodo = async () =&gt; {<br/>    const results = await fetch(<br/>      `https://jsonplaceholder.typicode.com/todos/${id}`<br/>    );<br/>    const data = await results.json();<br/>    setTodo(data);<br/>  };</span><span id="2150" class="mq lc iq mh b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    getTodo();<br/>  }, [id]);</span><span id="9e89" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;button onClick={() =&gt; setId((id) =&gt; id + 1)}&gt;increment id&lt;/button&gt;<br/>      &lt;p&gt;{JSON.stringify(todo)}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="ace9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">id</code>和<code class="fe me mf mg mh b">todo</code>状态。</p><p id="b8c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们希望进行API调用来获取带有<code class="fe me mf mg mh b">id</code>值的数据。</p><p id="6aed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了发出请求，我们使用带有<code class="fe me mf mg mh b">id</code>的URL字符串调用<code class="fe me mf mg mh b">fetch</code>。</p><p id="0625" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">data</code>调用<code class="fe me mf mg mh b">setTodo</code>。</p><p id="0dc5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用回调调用<code class="fe me mf mg mh b">useEffect</code>来调用<code class="fe me mf mg mh b">getTodo</code>函数。</p><p id="97c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而我们在<code class="fe me mf mg mh b">[id]</code>数组里传入<code class="fe me mf mg mh b">useEffect</code>。</p><p id="1871" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那下面，我们有一个按钮可以调用<code class="fe me mf mg mh b">setId</code>来改变<code class="fe me mf mg mh b">id</code>的值。</p><p id="0eb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在下面显示<code class="fe me mf mg mh b">todo</code>值。</p><p id="ef71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们单击按钮时，我们显示用给定的<code class="fe me mf mg mh b">id</code>发出请求后的最新响应。</p><p id="4943" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要查看道具并在道具值更新时发出请求，我们可以编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="050e" class="mq lc iq mh b gy mr ms l mt mu">import { useEffect, useState } from "react";</span><span id="de7d" class="mq lc iq mh b gy mv ms l mt mu">const Todo = ({ id }) =&gt; {<br/>  const [todo, setTodo] = useState({});</span><span id="adaa" class="mq lc iq mh b gy mv ms l mt mu">  const getTodo = async () =&gt; {<br/>    const results = await fetch(<br/>      `https://jsonplaceholder.typicode.com/todos/${id}`<br/>    );<br/>    const data = await results.json();<br/>    setTodo(data);<br/>  };</span><span id="bbad" class="mq lc iq mh b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    getTodo();<br/>  }, [id]);</span><span id="9d4a" class="mq lc iq mh b gy mv ms l mt mu">return &lt;p&gt;{JSON.stringify(todo)}&lt;/p&gt;;<br/>};</span><span id="3700" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const [id, setId] = useState(1);</span><span id="2399" class="mq lc iq mh b gy mv ms l mt mu">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;button onClick={() =&gt; setId((id) =&gt; id + 1)}&gt;increment id&lt;/button&gt;<br/>      &lt;Todo id={id} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="d13e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带<code class="fe me mf mg mh b">id</code>道具的<code class="fe me mf mg mh b">Todo</code>组件。</p><p id="16a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其余的代码与前面的例子相同。</p><h1 id="7c34" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="9b8d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在用钩子创建的React组件中使用<code class="fe me mf mg mh b">useEffect</code>钩子进行API调用。</p><p id="4a11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容看</em><a class="ae kc" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>