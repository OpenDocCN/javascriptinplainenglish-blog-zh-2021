<html>
<head>
<title>How to Handle Unsuccessful Fetch API Calls in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中处理不成功的获取API调用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handling-unsuccessful-calls-of-fetch-api-7eef551b74c8?source=collection_archive---------2-----------------------#2021-07-20">https://javascript.plainenglish.io/handling-unsuccessful-calls-of-fetch-api-7eef551b74c8?source=collection_archive---------2-----------------------#2021-07-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1b8f7758bf6fef0f1eeed9f25e7b2084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F7XXPlFt1TdXDlmAr7HMnA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@dav420?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">David Pupaza</a> on <a class="ae jz" href="https://unsplash.com/s/photos/404-error?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="00cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，在<a class="ae jz" href="https://mohithgupta.medium.com/all-you-need-to-know-about-the-fetch-api-6929930572a8" rel="noopener">之前的帖子</a>中，我们看到了fetch(url，{options})所有可能的事情(错误处理除外)。如果你还没看过，在这里读一下<a class="ae jz" href="https://mohithgupta.medium.com/all-you-need-to-know-about-the-fetch-api-6929930572a8" rel="noopener">。</a></p><p id="3180" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天，我们将学习如何处理<code class="fe ky kz la lb b">fetch()</code>发出的错误或任何不成功的呼叫。我们将使用与前一篇文章相同的网址。没有任何进一步的麻烦，让我们开始吧！</p><p id="df39" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在之前的帖子中，我提到了一个观点:</p><blockquote class="lc"><p id="994e" class="ld le in bd lf lg lh li lj lk ll kx dk translated"><em class="lm">除非出现某种网络错误，否则获取总是成功或得到响应。</em></p></blockquote><p id="a304" class="pw-post-body-paragraph ka kb in kc b kd ln kf kg kh lo kj kk kl lp kn ko kp lq kr ks kt lr kv kw kx ig bi translated">如果语法错误或URL无效，它也会失败，这些都是显而易见的情况。记住这些作为第一点。现在，让我们看看<code class="fe ky kz la lb b">catch()</code>的语法:</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="125f" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/1" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/1</a>")<br/>.then( response =&gt; response.json() )<br/>.then( data =&gt; console.log(data) )<br/>.catch( error =&gt; console.log(error) )</span></pre><p id="fac7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它位于<code class="fe ky kz la lb b">.then()</code>之后，用于处理被拒绝的承诺。<br/>记住这是第2点→ <strong class="kc io">“它处理被拒绝的承诺”</strong></p><p id="df88" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们看看当我们访问一个不存在的用户的详细信息时会发生什么。据我们所知，我们应该得到一个'<strong class="kc io"> 404 </strong>'错误，说没有找到，对吗？</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="4c44" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/34" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")  <br/>.then(res=&gt;res.json())<br/>.then(data=&gt;console.log(data))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/ca141d72a553acbcdb3887ca08da4fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*C8FuuFMMQR_qs1p266lAJg.jpeg"/></div></figure><p id="ad3b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们既没有看到错误，也没有看到任何数据，但是承诺实现了。因此，您可能认为在末尾有一个<code class="fe ky kz la lb b">catch()</code>块是可行的，但是:</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="67e6" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/34" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")  <br/>.then(res=&gt;res.json())<br/>.then(data=&gt;console.log(data))<br/>.catch( error =&gt; console.log(error) )</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/ca141d72a553acbcdb3887ca08da4fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*C8FuuFMMQR_qs1p266lAJg.jpeg"/></div></figure><p id="2f9c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看到了吗？没有变化。如果没有抛出错误，catch如何处理错误？现在，想想我希望你记住的第一点。据此，<strong class="kc io"> 404错误</strong>对<code class="fe ky kz la lb b">fetch()</code>来说不是错误，所以成功返回承诺。从这个意义上来说，这个承诺是不被拒绝的。根据要记住的第二点，<code class="fe ky kz la lb b">catch()</code>块处理对承诺的拒绝，因此它不处理这个错误，因为这里返回了一个承诺。在上图中，您可以看到承诺状态为“已履行”。</p><p id="796d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了处理这样的错误，fetch为它返回的响应对象提供了一个“<strong class="kc io"> ok </strong>”属性。我们可以打印res对象来查看这些细节:</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="9e8c" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/3432" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")<br/>.then(res=&gt;console.log(res))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/10e07e77dd67614a03ac724a9cee7e9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCWOnlvlMpoFT5u3UCMwUA.png"/></div></div></figure><p id="bc03" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在返回响应对象之前，我们可以检查“ok”是否设置为<strong class="kc io"> true或false。</strong>它代表获取调用的状态代码。如果状态代码为<code class="fe ky kz la lb b"><strong class="kc io">2xx</strong></code>形式，则‘ok’将被设置为真，否则将被设置为假(对于<code class="fe ky kz la lb b"><strong class="kc io">4xx </strong></code>和<code class="fe ky kz la lb b"><strong class="kc io">5xx </strong></code>状态代码)。</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="4777" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/34" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")<br/>.then((res)=&gt;{ <br/>        if(res.ok) return res.json(); <br/>        else throw new Error("Status code error :" + res.status) <br/>})<br/>.then(data=&gt;console.log(data))<br/>.catch(err=&gt;console.log(err))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/d8080649e9e0d34baf04c02e162b3aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*e1LoV7BnvNIomVE7voe6Xg.png"/></div></figure><p id="492b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">承诺状态是“履行”，但我们现在处理了错误。<br/>现在我们可以看到承诺被拒绝的证据，因此由<code class="fe ky kz la lb b">catch()</code>块处理。要查看被拒绝的承诺状态，移除<code class="fe ky kz la lb b">catch() </code>块。还有数据打印块，因为如果响应块没有返回任何东西，就没有用了，对吗？(不删除数据块会产生相同的结果)</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="3cac" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/34" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")<br/>.then((res)=&gt;{ <br/>        if(res.ok) return res.json(); <br/>        else throw new Error("Status code error :" + res.status) <br/>})</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/eff587ccacc7821a87d788ac19538437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n70SwHP1NkyzLuuiRf_kxw.png"/></div></div></figure><p id="aa2b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如您所见，承诺状态被拒绝，因此catch块可以处理这个错误。您可以打印响应而不是返回它，但是您将得到相同的结果。</p><p id="7d01" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">catch()</code>块可以处理语法错误，因为如果语法错误:<br/> fetch不能成功→所以promise不返回→所以error转到catch <br/>这里，语法错误，所以catch获取错误并打印出来:</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="c45b" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/3432" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/34</a>")<br/>.then(res=&gt;resjson())<br/>.catch(error=&gt;console.log(error))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/fe8f7e8e8c1788c3b668caee41cf2bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*pf8csYwFDeoNXlMN4UQNsQ.png"/></div></figure><p id="569d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">类似地，网络错误:没有网络→获取无法成功→所以承诺没有返回→所以错误被捕获</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="9908" class="ma mb in lb b gy mc md l me mf">fetch("<a class="ae jz" href="https://reqres.in/api/users/4" rel="noopener ugc nofollow" target="_blank">https://reqres.in/api/users/4</a>")<br/>.then(res=&gt;res.json())<br/>.catch(err=&gt;console.log(err))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/45e389e08e26c42f6f84e7ba9bbc2a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*pyiEpGD35mPIsilyyooLWA.png"/></div></figure><p id="1d96" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但无效URL直接抛出错误“无效或意外令牌”，因为如果URL错误，fetch甚至无法启动进程，更不用说返回承诺:</p><pre class="ls lt lu lv gt lw lb lx ly aw lz bi"><span id="1da1" class="ma mb in lb b gy mc md l me mf">fetch("https://reqres.in/api/users/34\")  <br/>.then(res=&gt;res.json())<br/>.then(data=&gt;console.log(data))<br/>.catch(error=&gt;console.log(error))</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/0a0bb77ac3546e47a252b32485c281e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*L1WPkbswOtBJIq_8DOWJLA.png"/></div></figure><p id="4e21" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，你坚持到了最后。关于处理<code class="fe ky kz la lb b">fetch()</code>呼叫不成功，你就知道这么多了。</p><p id="6af6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">希望你喜欢这篇文章。如果你有，考虑在评论区提供反馈或建议。请确保不要错过我未来的任何帖子。期待前方更多有趣的文章。</p><p id="5803" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你太高兴，你可以请我喝杯咖啡😉</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/e61afb56d9e1b2e6885a55cda8883e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/0*iJ0gkoXYCP3CB4U5.png"/></div></figure><p id="f649" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以看看我其他的一些帖子:</p><p id="4ac8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://python.plainenglish.io/play-youtube-videos-in-vlc-with-just-1-click-2baca84c03f3" rel="noopener ugc nofollow" target="_blank">只需点击一下</a> <br/> <a class="ae jz" href="https://python.plainenglish.io/convert-your-py-to-exe-with-just-2-commands-4c6cefe9af4c" rel="noopener ugc nofollow" target="_blank">【转换你的】,即可在VLC上播放YouTube视频。py '到a '。我编写了一个脚本来下载Google Drive的“下载受限”文件</a></p><p id="9a1d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mn">如有疑问或其他问题，您可以在mohithguptak@gmail.com ping我或在</em><a class="ae jz" href="https://twitter.com/tobeawebdev" rel="noopener ugc nofollow" target="_blank"><em class="mn">Twitter</em></a><em class="mn">上找到我。</em></p><p id="5cb8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mn">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mn">plain English . io</em></strong></a></p></div></div>    
</body>
</html>