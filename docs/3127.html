<html>
<head>
<title>How to Create Token-Based Authentication in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中创建基于令牌的身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-token-based-authentication-in-react-native-c5739b9d5e45?source=collection_archive---------0-----------------------#2021-06-25">https://javascript.plainenglish.io/how-to-use-token-based-authentication-in-react-native-c5739b9d5e45?source=collection_archive---------0-----------------------#2021-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="136d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想知道如何在React Native中处理身份验证吗？本文解释了一些最佳实践以及如何实现基于令牌的身份验证。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/1677219d505af7bbdb04fc654606f0df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9Ay7i106MPAJ5jwI"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@mr_williams_photography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Micah Williams</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fdf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么什么是基于令牌的认证呢？在高层次上，这种策略只验证访问者凭证一次，作为回报，向访问者提供一个令牌。该令牌将允许他们在预定义的时间段内访问。当用户注销时，令牌失效。它相当于一张票，允许用户在你的系统中读写某些信息。</p><p id="b64d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始吧，首先我们要创建一个新的React原生项目。</p><h2 id="630a" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">创建新的React本机项目</h2><p id="98ec" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">要创建新的React本机项目，请运行</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="aa15" class="lc ld iq mb b gy mf mg l mh mi">npx react-native init ReactNativeAuth</span></pre><p id="36af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，让我们清除根目录中的App.js文件，并用下面的代码替换它。这将为我们实现身份验证提供一个全新的平台。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="f12f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过运行以下命令来运行这个应用程序</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="0e55" class="lc ld iq mb b gy mf mg l mh mi">npx react-native run-ios # or run-android</span></pre><p id="0b42" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它当前应该显示如下内容</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ml"><img src="../Images/55b756907add893c5a3b6269fd96d8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCs5LTZHXFVk5V2rnBqaSg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Hi!</figcaption></figure><h2 id="01a6" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">计划建造什么</h2><p id="ea1f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">现在，让我们从用户的角度来描述我们希望我们的身份验证如何工作。</p><ul class=""><li id="a7d6" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">用户首次下载应用程序</li><li id="2cba" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">用户将创建一个帐户</li><li id="e7fd" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">用户现在可以使用该应用程序了</li><li id="f9db" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">当应用程序被杀死，无论什么原因，我们将恢复会话，如果可能的话</li><li id="af72" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">当令牌过期时，它应该会自动刷新令牌</li></ul><h2 id="b9dd" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">编写身份验证容器</h2><p id="f1b2" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为此，我们需要几样东西。我们需要安全地将令牌保存到用户的手机上，一些文章会告诉你在React Native中使用类似AsyncStorage的东西。但是，这是不安全的，令牌可能会从内存中取出，因为它保存在原始文本中。这可以用来模拟用户。</p><p id="3372" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们将安装<a class="ae lb" href="https://github.com/emeraldsanto/react-native-encrypted-storage" rel="noopener ugc nofollow" target="_blank">https://github . com/emerald Santo/react-native-encrypted-storage</a>，这基本上使用Android的EncryptedSharedPreferences和iOS的Keychain来存储敏感数据。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="57d9" class="lc ld iq mb b gy mf mg l mh mi">npm install react-native-encrypted-storage</span></pre><p id="4490" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后对于iOS，运行</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="b663" class="lc ld iq mb b gy mf mg l mh mi">npx pod-install</span></pre><p id="7681" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我将使用一个模拟API来伪造一个注册端点供应用程序使用。它目前位于以下网址<a class="ae lb" href="https://run.mocky.io/v3/dd598227-c275-48e8-9840-c588293ead84" rel="noopener ugc nofollow" target="_blank">https://run . mocky . io/v3/DD 598227-c275-48e 8-9840-c 588293 EAD 84</a>。</p><p id="ed4b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，您可以使用HTTP客户端测试端点，或者将这个curl命令复制到您的终端。</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="2d72" class="lc ld iq mb b gy mf mg l mh mi">curl -d '{"username":"jonaskuiler"}' \</span><span id="da26" class="lc ld iq mb b gy na mg l mh mi">-H "Content-Type: application/json" \</span><span id="b4df" class="lc ld iq mb b gy na mg l mh mi">"https://run.mocky.io/v3/dd598227-c275-48e8-9840-c588293ead84"</span></pre><p id="07b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">基本上，它唯一应该做的就是返回这个响应</p><pre class="km kn ko kp gt ma mb mc md aw me bi"><span id="7ab3" class="lc ld iq mb b gy mf mg l mh mi">{"access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvbmFzIEt1aWxlciIsImlhdCI6MTUxNjIzOTAyMn0.jm6f8xMR0aroqQ_YtGPHQbvdp88FKBQZWOUR5m6R_MA"}</span></pre><p id="53c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了在React本机应用程序中使用这个端点，我们将编写一个小容器来处理应用程序中任何与身份验证相关的状态。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="e27f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请将此代码粘贴到项目根目录下的Auth.js名称下。此代码的作用是封装对注册端点的请求，使用React Context API将Auth上下文传递给应用程序的任何深层嵌套子级，以供以后使用。另外，它将一个对象传递给一个render prop，这样我们就可以确定用户是否通过了身份验证。这样，我们可以将用户路由到特定的视图。让我们修改App.js来实现这个路由。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2cce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们看看这是怎么回事。这定义了两个视图，注册，当用户未通过身份验证时显示，当用户通过身份验证时显示。当您单击register按钮时，它将调用Auth.js中定义的Register方法，并向我前面提到的模拟端点发出请求。当该请求成功时，它将变为已验证状态。</p><p id="093b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，当用户出于某种原因关闭应用程序时，我们需要保存从恢复会话的请求中获得的令牌。</p><p id="78aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们之前安装了<a class="ae lb" href="https://github.com/emeraldsanto/react-native-encrypted-storage" rel="noopener ugc nofollow" target="_blank">react-native-encrypted-storage</a>，现在让我们通过对Auth.js做一些修改来使用它。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="d14a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这在React Native中拼凑了一个基于令牌的身份验证。当应用程序第一次呈现时，它将通过向服务器发送令牌来获取当前用户。这将返回一些关于用户的信息并恢复会话。</p><p id="3b1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以通过刷新应用程序来测试这种行为，在iPhone模拟器中，使用CMD+D热键，然后按“重新加载”。</p></div><div class="ab cl nb nc hu nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ij ik il im in"><p id="c0f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就这些了，感谢阅读。我目前正在写一篇文章，介绍如何使用PIN和生物识别技术用密码锁定你的应用程序。</p><p id="3b26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ni">更多内容尽在</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ni">plain English . io</em></strong></a></p></div></div>    
</body>
</html>