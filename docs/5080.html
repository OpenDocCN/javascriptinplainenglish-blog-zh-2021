<html>
<head>
<title>I made a top-down game version of my blog with Phaser and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用Phaser和React制作了一个自上而下的游戏版本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/i-made-a-top-down-game-version-of-my-blog-with-phaser-and-react-faf5c28cf768?source=collection_archive---------2-----------------------#2021-10-15">https://javascript.plainenglish.io/i-made-a-top-down-game-version-of-my-blog-with-phaser-and-react-faf5c28cf768?source=collection_archive---------2-----------------------#2021-10-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="87df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对，没错，这个网站现在有游戏版了。厌倦了点击无聊的网页和阅读材料？深入到一个自上而下的类似RPG游戏的旅程中，找到博客帖子并在游戏中阅读它们怎么样？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/8ffabec20479ca6b02712156b26bcec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*reIt6AFpY9wzdubT.gif"/></div></figure><h1 id="b3e2" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">好吧，但是为什么？</h1><p id="0a6e" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">这个想法是在我将Konami代码添加到我的网站时产生的，它使Matrix源代码显示在网站的背景中(现在尝试一下)，虽然超级酷，但我认为让Konami代码打开游戏或其他东西会更酷，因为我已经有2年的Phaser经验，我决定做一个愚蠢的游戏作为MVP。</p><p id="2578" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大约在同一天，我发现了<a class="ae lt" href="https://github.com/Annoraaq/grid-engine" rel="noopener ugc nofollow" target="_blank"> grid-engine Phaser插件</a>，它使得创建一个自上而下的类似RPG的游戏变得如此容易，以至于我决定用它来制作一个游戏，还因为我的第一次“编程”经历可以追溯到2002年，当时我正在用RPG Maker创建一个一模一样的游戏。</p><p id="2a15" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从那时起，这个项目开始变得更加雄心勃勃，我想“如果我在游戏中显示博客帖子会怎么样？”，反正React via <code class="fe lu lv lw lx b">GraphQL</code>里所有的博客数据都有，应该不会太难。</p><h1 id="6f73" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">将React用作Phaser的用户界面</h1><p id="6566" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">Phaser通过在DOM中的一个<code class="fe lu lv lw lx b">canvas</code>元素中呈现像素来工作，这很好，但是web开发的一个很好的特性是DOM和CSS创建很好的UI元素的能力，而你不能单独用Phaser来做这些。</p><p id="dd17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用Phaser和React的最简单方法是使用如下所示的功能组件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="5a3b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这在大多数情况下都很好，但为了让Phaser能够与React来回通信，比如显示菜单项或对话框，我将在Phaser和React之间调度JavaScript事件。</p><p id="c8d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最好的方法是使用某种状态管理工具，比如<a class="ae lt" href="https://facebook.github.io/flux/" rel="noopener ugc nofollow" target="_blank"> Flux </a>，但是因为这只是一个非常小的项目，分派JavaScript事件暂时可以。看看下面的例子如何做到这一点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/3189e69784679f6acb5e330fbe443659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*ePFv6fa7qbfHgB7n.gif"/></div></figure><p id="e9bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想知道更多关于如何为你的Phaser游戏创建一个React对话框的细节，请查看我的博客文章。</p><h1 id="dc21" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">集成Phaser和Gatsby</h1><p id="4318" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">Gatsby是一个由React驱动的静态站点生成器，但是Phaser是一个客户端专用的包(当然，我的意思是，为什么后端需要Phaser？)，所以每当Gatsby构建我的游戏页面时，我都会收到SSR错误，因为Phaser试图只访问客户端API。</p><p id="8031" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了解决这个问题，我使用React钩子<code class="fe lu lv lw lx b">useEffect</code>来动态导入所有与Phaser相关的模块，因为<code class="fe lu lv lw lx b">useEffect</code>只在客户端执行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h1 id="d935" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">创建地图</h1><p id="9daa" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">为了创建地图，我将再次使用Tiled，这是一个FOSS，你可以在其中创建地图，并在几乎任何游戏引擎中使用它们。</p><p id="4d1c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在地图上使用的<code class="fe lu lv lw lx b">tileset</code>是由<a class="ae lt" href="https://itch.io/profile/armm1998" rel="noopener ugc nofollow" target="_blank">arm 1998</a>创建的<a class="ae lt" href="https://opengameart.org/content/zelda-like-tilesets-and-sprites" rel="noopener ugc nofollow" target="_blank">塞尔达风格的tileset </a>，包括室内和室外tileset。</p><p id="fae4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我将在瓷砖上创建<code class="fe lu lv lw lx b">tileset</code>,并在所有瓷砖上设置一个名为<code class="fe lu lv lw lx b">ge_collide</code>的属性为<code class="fe lu lv lw lx b">true</code>,我希望与英雄发生冲突</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/045fed87e5af683817ca6f4bbc740fd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bTYMeSc7B-jlsN1k.png"/></div></div></figure><p id="2943" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建多层地图很重要，这样一些部分可以在英雄下面，一些部分在英雄上面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mg"><img src="../Images/17695b6702defb96bcb6cfb0fddc8170.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OoKjNvc3A4aYgTSs.gif"/></div></div></figure><p id="e6e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">地图完成后，<a class="ae lt" href="https://pablo.gg/en/blog/games/automatically-update-the-embedded-tileset-for-all-your-tiled-game-with-a-nodejs-script/" rel="noopener ugc nofollow" target="_blank">我会将tileset嵌入到地图</a>中，然后我可以简单地将地图和<code class="fe lu lv lw lx b">tileset</code>文件导入到我的游戏中，并在Phaser中加载它们。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h1 id="fa43" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">使用网格引擎相位器插件</h1><p id="be2e" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">正如我在文章开头提到的，使用grid-engine插件创建一个自上而下的RPG Maker风格的游戏很容易，只需将你的游戏配置为使用arcade physics并添加grid-engine作为插件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="331f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我可以在任何Phaser游戏场景中通过<code class="fe lu lv lw lx b">this.gridEngine</code>访问插件。下一步是创建一个精灵并用网格引擎插件移动它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="e014" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这段代码基本上是从他们的官方文档页面复制粘贴而来的。</p><p id="0f8e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如我之前提到的，要使碰撞自动与在平铺地图上创建的地图一起工作，只需添加属性<code class="fe lu lv lw lx b">ge_collide</code>设置为<code class="fe lu lv lw lx b">true</code>，用于英雄将要碰撞的平铺地图。</p><p id="8110" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请注意，这将使英雄移动并与物体碰撞，但没有行走动画。为了创建新的精灵动画，我将使用<code class="fe lu lv lw lx b">this.anims.create()</code>函数，然后在每次网格引擎告诉我玩家移动时播放该动画，网格引擎将调度<code class="fe lu lv lw lx b">movementStarted</code>、<code class="fe lu lv lw lx b">movementStopped</code>和<code class="fe lu lv lw lx b">directionChanged</code>事件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="cf26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这篇文章中，我将更详细地介绍游戏机制是如何制作的<a class="ae lt" href="https://pablo.gg/en/blog/games/how-to-create-a-top-down-rpg-maker-like-game-with-phaser-js-and-react/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="ec62" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">从Gatsby获取帖子数据</h1><p id="7d2a" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">Gatsby通过<code class="fe lu lv lw lx b">GraphQL</code>提供你所有的静态数据，在我的博客上，我使用<a class="ae lt" href="https://www.gatsbyjs.com/plugins/gatsby-transformer-remark/" rel="noopener ugc nofollow" target="_blank">markdown插件</a>来发布我的帖子，所以我访问我的数据如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="34c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">添加了<code class="fe lu lv lw lx b">GraphQL</code>查询后，我所有的帖子数据都可以通过<code class="fe lu lv lw lx b">data.allMarkdownRemark.edges</code>道具获得。</p><p id="7fa2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，在游戏中，我可以发送一个JavaScript事件，要求React在一个列表中显示我的所有博客文章，然后当一篇博客文章被选中时，在一个材质UI模型中显示它。</p><h1 id="38f6" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">把所有的加在一起</h1><p id="6b1e" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">这是我的<code class="fe lu lv lw lx b">GamePage</code>最终代码的样子:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="796b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你想知道更多关于<code class="fe lu lv lw lx b">GameScene</code>内部发生的细节，查看<a class="ae lt" href="https://pablo.gg/en/blog/games/how-to-create-a-top-down-rpg-maker-like-game-with-phaser-js-and-react/" rel="noopener ugc nofollow" target="_blank">这篇博文</a>。</p><h1 id="98ec" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结论</h1><p id="8818" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">为我的博客创作这个游戏很有趣，除此之外，我在Phaser和React中学到了很多新东西。也许我甚至可以用这部分代码做一个真正的自顶向下的游戏:眼睛:。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi mb"><img src="../Images/4b54e0e14926224813a9fb17619c7d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JnKuh2tOQUNSC51R.png"/></div></div></figure><h1 id="c411" class="kq kr in bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">特别感谢</h1><p id="57a9" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">没有一些了不起的人和他们的工作的帮助，这个游戏是不可能的，所以这里是我特别感谢的名单。</p><ul class=""><li id="f211" class="mh mi in jm b jn jo jr js jv mj jz mk kd ml kh mm mn mo mp bi translated"><a class="ae lt" href="https://github.com/photonstorm" rel="noopener ugc nofollow" target="_blank"> photonstorm </a>，用于创建<a class="ae lt" href="https://github.com/photonstorm/phaser" rel="noopener ugc nofollow" target="_blank"> Phaser.io </a>。</li><li id="4cb3" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://github.com/Annoraaq" rel="noopener ugc nofollow" target="_blank"> Annoraaq </a>，用于创建<a class="ae lt" href="https://github.com/Annoraaq/grid-engine" rel="noopener ugc nofollow" target="_blank">网格引擎</a>插件。</li><li id="0201" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://itch.io/profile/armm1998" rel="noopener ugc nofollow" target="_blank"> ArMM1998 </a>，用于<a class="ae lt" href="https://opengameart.org/content/zelda-like-tilesets-and-sprites" rel="noopener ugc nofollow" target="_blank">角色精灵和图块集</a>。</li><li id="0980" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://elthen.itch.io/" rel="noopener ugc nofollow" target="_blank"> PixElthen </a>，为<a class="ae lt" href="https://opengameart.org/content/pixel-art-mini-slime-sprites" rel="noopener ugc nofollow" target="_blank">粘液精灵</a>。</li><li id="804d" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://itch.io/profile/pixelartm" rel="noopener ugc nofollow" target="_blank"> pixelartm </a>，给<a class="ae lt" href="https://opengameart.org/content/pirate-1" rel="noopener ugc nofollow" target="_blank">海盗帽精灵</a>。</li><li id="c586" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://opengameart.org/users/jkjkke" rel="noopener ugc nofollow" target="_blank">jkjkkke</a>，为<a class="ae lt" href="https://opengameart.org/content/background-6" rel="noopener ugc nofollow" target="_blank">游戏过屏背景</a>。</li><li id="269f" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://opengameart.org/users/knoblepersona" rel="noopener ugc nofollow" target="_blank"> KnoblePersona </a>，用于<a class="ae lt" href="https://opengameart.org/content/ocean-background" rel="noopener ugc nofollow" target="_blank">主菜单屏幕背景</a>。</li><li id="ef79" class="mh mi in jm b jn mq jr mr jv ms jz mt kd mu kh mm mn mo mp bi translated"><a class="ae lt" href="https://opengameart.org/users/min" rel="noopener ugc nofollow" target="_blank"> Min </a>，为<a class="ae lt" href="https://opengameart.org/content/open-book-0" rel="noopener ugc nofollow" target="_blank">开卷精灵</a>。</li></ul></div><div class="ab cl mv mw hr mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ig ih ii ij ik"><p id="9ede" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nc">最初发布于</em><a class="ae lt" href="https://pablo.gg/en/blog/coding/i-made-a-top-down-game-version-of-my-blog-with-phaser-and-react/" rel="noopener ugc nofollow" target="_blank"><em class="nc">https://pablo . gg</em></a><em class="nc">。</em></p><p id="add7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nc">更多内容请看</em><a class="ae lt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nc">plain English . io</em></strong></a></p></div></div>    
</body>
</html>