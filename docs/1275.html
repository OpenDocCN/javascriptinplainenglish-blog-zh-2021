<html>
<head>
<title>A TypeScript Runtime Data Validators Comparison</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript运行时数据验证器比较</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-92887e22ee65?source=collection_archive---------6-----------------------#2021-03-17">https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-92887e22ee65?source=collection_archive---------6-----------------------#2021-03-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="ff47" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第六部分:佐德</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/02044919a9e2d8e4d97fc3e75af39f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ShBtCVmnIDxAZ-Xh33y8g.png"/></div></div></figure><p id="9418" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是基于我的实践经验的运行时数据验证器比较系列报告的第6篇。在继续本系列的其余部分之前，您应该阅读第一篇文章中的介绍，以理解制作该报告所涉及的目标和测试方法。</p><ol class=""><li id="b685" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-50a6abf3c559">简介</a></li><li id="effe" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-eeedc6b0583a"> io-ts </a></li><li id="c4bd" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-c422e431926a"> joi </a></li><li id="dda3" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-15f0ea2e3265">对</a></li><li id="0f65" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-cdbb532f0b89"> ajv </a></li><li id="436f" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated">佐德</li><li id="442e" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-67cb9abb599b">超级结构</a></li></ol><h1 id="9383" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">介绍</h1><p id="8e9b" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Zod是测试过的验证器中的新人，吸收了许多前辈的思想。zod的创建者研究了几个流行的验证器(joi、yup和提到的io-ts ),并决定从头开始构建自己的验证器。这个验证器背后的思想可以在这里找到<a class="ae lt" href="https://colinhacks.com/essays/zod" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="889d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Zod的依赖性为零，在浏览器和Node.js中都可以工作，而且体积非常小。它采用了函数式方法，但是非常容易使用，并且不需要对函数式编程有很深的理解。在撰写本文时，它也在积极开发中。</p><h1 id="0428" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">设计目标的实现</h1><h2 id="8d81" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">1.一个定义，多种用途—已实现</h2><p id="085f" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Zod还使用一个流畅的API来定义数据，这使得使用它变得容易和愉快。下面显示了“Person”模式是如何定义的。请注意(1)我不需要像使用“Yep”时那样迂回地定义“sex”属性，以便更好地进行类型推断，(2)为“dob”属性进行内联自定义验证“refine ”,以检查该人是否至少18岁，以及(3)使用transform()函数将类型转换为Date而不是string。Zod还支持使用<a class="ae lt" href="https://github.com/colinhacks/zod#preprocess" rel="noopener ugc nofollow" target="_blank">预处理()</a>来执行类型强制。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/f028e8be6c03ce956ba959b8de51508b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sz-lXQDxAw5Ee2Lq5FcTLw.png"/></div></div></figure><p id="5a3c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">提供更好的类型推断(至少比yup更好)是zod的一个设计目标。它很好地实现了这个目标。下面是从舰队模式推断出的类型。它看起来和工作正常。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/96d354875a929095c7f3dfa19742f9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*l2LatFHmMq9cZpzIcryG0w.png"/></div></figure><p id="6f76" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">zod如何不要求在“sex”属性的枚举定义中使用const断言(<code class="fe nk nl nm nn b">as const</code>)，并且仍然设法将类型推断为文字类型的联合，从而避免文字类型扩大？我钻研了佐德的源代码，从中学习了一些技巧。如果你好奇，窍门就在这四行:看这里的<a class="ae lt" href="https://github.com/colinhacks/zod/blob/676d619b4c05ca98ccfffbfe7e69ec23c4e639d2/src/types/enum.ts#L55" rel="noopener ugc nofollow" target="_blank"/>，这里的<a class="ae lt" href="https://github.com/colinhacks/zod/blob/676d619b4c05ca98ccfffbfe7e69ec23c4e639d2/src/types/enum.ts#L20" rel="noopener ugc nofollow" target="_blank"/>，这里的<a class="ae lt" href="https://github.com/colinhacks/zod/blob/676d619b4c05ca98ccfffbfe7e69ec23c4e639d2/src/types/base.ts#L67" rel="noopener ugc nofollow" target="_blank"/>，这里的<a class="ae lt" href="https://github.com/colinhacks/zod/blob/676d619b4c05ca98ccfffbfe7e69ec23c4e639d2/src/types/base.ts#L64" rel="noopener ugc nofollow" target="_blank"/>。为佐德的创造者科林·麦克唐奈的杰作鼓掌！</p><h2 id="0edb" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">2.可组合和可扩展的模式—已实现</h2><p id="53be" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">如下所示,“Driver”模式是通过扩展“Person”模式定义的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/84b1cb7f4503949cf942bdc67eb53928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*eFeP4YpcLbgSHBDuexA3ew.png"/></div></figure><p id="3944" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">“车队”模式是通过组装“驾驶员”和“车辆”模式来定义的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi np"><img src="../Images/42768332f8db29ccc0feed476d211bb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*Kz2MrnGD35SFD92IjBx4ZA.png"/></div></div></figure><h2 id="60fb" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">3.丰富的功能集—已实现</h2><p id="36cc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Zod提供了丰富的现成特性集。</p><h2 id="42dd" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">4.完成和中止-早期验证-完成验证</h2><p id="fc5b" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated"><code class="fe nk nl nm nn b">.parse(data: unknown)</code>方法进行完整的验证。完整验证的结果提供了数据中发现的所有故障的详细信息。下面是无效车队对象的验证结果的一部分。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/9d886187170ba0da89f5e602e19112d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*ndX0WUyJyxIT_yQGeBSLmg.png"/></div></figure><p id="c5dd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">该文献没有提到快速、提前中止的验证。</p><h2 id="c0e7" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">5.可组合和可定制—存档</h2><p id="16ba" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">与joi和yup类似，使用zod的API来组合关键字并添加自定义验证功能非常容易。</p><p id="2548" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是PersonForm模式定义，带有一个自定义的“refine”来验证重复密码是否与密码相同。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/9f40f94af59672858a7e7cb5f4523721.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_yGdYC_MZb6y_sBZsZf1rQ.png"/></div></div></figure><h2 id="19bc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">6.类型强制和默认—已实现</h2><p id="a3da" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">类型强制可以通过<a class="ae lt" href="https://github.com/colinhacks/zod#preprocess" rel="noopener ugc nofollow" target="_blank">预处理()</a>实现。默认值可以通过<a class="ae lt" href="https://github.com/colinhacks/zod#default" rel="noopener ugc nofollow" target="_blank"> default() </a>实现。类型转换也可以用<a class="ae lt" href="https://github.com/colinhacks/zod#transform" rel="noopener ugc nofollow" target="_blank"> transform() </a>实现。</p><h2 id="09cc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">7.可遍历模式—已实现</h2><p id="4ecc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">模式的内部配置可以在模式的<code class="fe nk nl nm nn b">_def</code>属性下找到。很容易穿越。然而，属性名以下划线开头的事实表明，它是供内部使用的，可能会有变化。</p><h2 id="419a" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">8.标准—否</h2><h1 id="71c4" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">摘要</h1><p id="1d29" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">佐德是个新人，是2020年3月创建的。它吸收了前人的许多思想，很容易使用。它很小，没有依赖性，在浏览器和Node.js中都可以工作，它的类型推断工作得特别好。唯一缺少的特性是快速、提前中止的验证。</p></div></div>    
</body>
</html>