<html>
<head>
<title>Decentralized Uber: How I Built It With Status.im, Waku, and Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">去中心化的优步:我如何用Status.im、Waku和Vue.js构建它</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/decentralized-uber-heres-how-i-built-it-with-status-im-waku-and-vue-js-719b0b998387?source=collection_archive---------12-----------------------#2021-12-03">https://javascript.plainenglish.io/decentralized-uber-heres-how-i-built-it-with-status-im-waku-and-vue-js-719b0b998387?source=collection_archive---------12-----------------------#2021-12-03</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><figure class="gm go jm jn jo jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj jl"><img src="../Images/ac3487a7d24a21058d3828c05278c123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LZGxeLTEBYE2F6QW"/></div></div></figure><blockquote class="jw jx jy"><p id="c5f2" class="jz ka kb kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ih bi translated">区块链没有让出租车司机失业，而是让优步失业，让出租车司机直接与顾客打交道。维塔利克·布特林</p></blockquote><p id="15be" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">当我第一次读到Vitalik Buterin的上述引用时，我开始思考如何实现一个分散的优步式的汽车共享应用程序。区块链价格昂贵，并不是为了存储汽车位置等临时数据而发明的。答案是，答案不是区块链。我们必须更深入。</p><p id="c14c" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">p2p汽车共享应用的基本机制是乘客用她的坐标广播汽车请求。司机们收到这个请求，谁有免费的车，谁就回答这个请求。乘客收到答案并选择司机。如您所见，我们需要的是一个具有广播功能的消息协议。类似的东西被用于在区块链网络中广播完成的块。</p><p id="c828" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">以太坊有自己的消息协议，叫做<a class="ae lb" href="https://eth.wiki/concepts/whisper/whisper" rel="noopener ugc nofollow" target="_blank">耳语</a>。不幸的是，它并不真正为人所知，并且在以太坊客户端中也不被默认支持。幸运的是，有一个名为<a class="ae lb" href="https://status.im/" rel="noopener ugc nofollow" target="_blank"> Status.im </a>的项目有一个名为<a class="ae lb" href="https://github.com/status-im/js-waku" rel="noopener ugc nofollow" target="_blank"> Waku </a>的协议来取代Whisper。Waku基于<a class="ae lb" href="https://libp2p.io/" rel="noopener ugc nofollow" target="_blank"> libp2p </a>，通过<a class="ae lb" href="https://docs.libp2p.io/concepts/publish-subscribe/" rel="noopener ugc nofollow" target="_blank"> gossipsub </a>支持话题消息传递，所以完全满足我们的需求。(我有<a class="ae lb" href="https://hackernoon.com/writing-decentralized-applications-in-javascript-libp2p-basics" rel="noopener ugc nofollow" target="_blank">一篇关于libp2p的文章</a>。建议看一下，了解一下基础。)</p><p id="5e7d" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">现在我们有了一个基本的概念和一个发布/订阅协议。让我们为它设计一个极简的UI。我的极简UI看起来是这样的:</p><figure class="ld le lf lg gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj lc"><img src="../Images/3f2b437fae020aa9b00a46107e75f815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OjBwzrlmnThPFPBP.png"/></div></div></figure><p id="4474" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">一个简单的谷歌地图有3个按钮。第一个按钮是个人资料按钮。我试图找到最简单的配置文件管理解决方案。Gravatar 是一个简单的通用配置文件服务，您可以将配置文件图像和一些配置文件数据分配到您的电子邮件地址。</p><p id="4f2e" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">它被用于许多服务，如GitHub、WordPress等。它可以存储基本的个人资料，所以对我们有好处。在profile面板上，您只需给出您的电子邮件地址，应用程序就会从gravatar下载您的所有个人资料数据。设置电话号码或Skype帐户非常重要，因为您的潜在乘客可以通过它联系到您。</p><figure class="ld le lf lg gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj lc"><img src="../Images/2e339d92fb4482fa83e0f9c2df002b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HryK64zagr5XD41d.png"/></div></div></figure><p id="f10e" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">第二个按钮是汽车共享的切换按钮。如果你点击它，按钮的颜色会变成绿色，应用程序将订阅广播主题。如果有来电，应用程序会显示一个蓝色标记。如果你点击标记，你可以向可能的乘客出价。</p><figure class="ld le lf lg gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj lc"><img src="../Images/239de8a67a9baf185b3466e40a41a391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hMtVKPWN-gRQ2pJw.png"/></div></div></figure><p id="45b9" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">最后一个按钮是乘客叫车用的。如果乘客点击这个按钮，应用程序将向司机广播请求。如果司机出价，就会显示一个绿色标记。乘客可以选择其中一名司机，然后用给定的Skype帐户或电话号码给她打电话。</p><figure class="ld le lf lg gu jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj lc"><img src="../Images/10f9d52e8306ea6d64412413ba251a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9y4_BL3mni8bF53j.png"/></div></div></figure><p id="f7ef" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">仅此而已。正如我之前写的。这完全是这个概念的最小实现。其目的是帮助理解p2p发布/订阅系统如何在应用程序下工作。让我们看看代码。</p><p id="7274" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">初始化Waku真的很简单。</p><pre class="ld le lf lg gu lh li lj lk aw ll bi"><span id="d313" class="lm ln io li b gz lo lp l lq lr">this.waku = await Waku.create({ bootstrap: true }); await this.waku.waitForConnectedPeer();</span></pre><p id="c9b2" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">这两行代码将下载Waku引导节点的实际列表，并等待一些对等节点被连接。初始化之后，我们的应用程序将成为Gossipsub网格的一部分，并准备好发送和接收消息。</p><pre class="ld le lf lg gu lh li lj lk aw ll bi"><span id="7f3b" class="lm ln io li b gz lo lp l lq lr">let privateTopicName = "/waku-uber/1/" + parsedAvatarData.hash + "/proto";</span><span id="f119" class="lm ln io li b gz ls lp l lq lr">this.waku.relay.addObserver(<br/>  (wakuMessage) =&gt; {<br/>    this.processPrivateMessage(wakuMessage);<br/>  },<br/>  [privateTopicName]<br/>);</span></pre><p id="81ea" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">每个客户端都订阅一个特殊的私有主题，该主题是从电子邮件哈希中生成的，以使其具有唯一性。当司机向可能的乘客发出邀请时，该应用程序将使用该主题。订阅由<code class="fe lt lu lv li b">waku.relay.addObserver</code>完成。主题名可以是任何东西，但是<a class="ae lb" href="https://github.com/status-im/js-waku/blob/main/guides/choose-content-topic.md" rel="noopener ugc nofollow" target="_blank"> Waku有一个关于主题名格式的建议</a>。</p><pre class="ld le lf lg gu lh li lj lk aw ll bi"><span id="7e61" class="lm ln io li b gz lo lp l lq lr">const payload = proto.WakuUberMessage.encode({ <br/>  type: proto.Type.REQUEST, <br/>  lat: this.myPosition.lat, <br/>  lng: this.myPosition.lng, <br/>  avatarHash: parsedAvatarData.hash, <br/>}); </span><span id="9932" class="lm ln io li b gz ls lp l lq lr">const wakuMessage = await WakuMessage.fromBytes( <br/>  payload, <br/>  broadcastTopicName <br/>); </span><span id="5514" class="lm ln io li b gz ls lp l lq lr">await this.waku.relay.send(wakuMessage);</span></pre><p id="5a4f" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">可以通过waku.relay.send方法发送消息。该方法只有一个参数，即从有效负载和主题名构建的WakuMessage。Waku使用二进制有效载荷。可以将字符串作为消息发送，但是推荐使用二进制格式，因为它更紧凑。有一个叫做<a class="ae lb" href="https://developers.google.com/protocol-buffers" rel="noopener ugc nofollow" target="_blank">协议缓冲区</a>的工具，用于定义消息结构并对其进行编码/解码。我们简单的消息格式定义如下:</p><pre class="ld le lf lg gu lh li lj lk aw ll bi"><span id="22c8" class="lm ln io li b gz lo lp l lq lr">enum Type { <br/>  REQUEST = 1; <br/>  RESPONSE = 2; <br/>} </span><span id="2ba4" class="lm ln io li b gz ls lp l lq lr">message WakuUberMessage { <br/>  Type type = 1; <br/>  float lat = 2; <br/>  float lng = 3; <br/>  string avatarHash = 4; <br/>}</span></pre><p id="1503" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">它包含一个类型字段，可以是请求(客户叫车)或响应(司机出价)，也可以是lat。/长。地理坐标和发件人电子邮件地址的散列。应用程序可以通过电子邮件散列获得gravatar信息，私有主题也是从它生成的。</p><p id="1779" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">简而言之，这些是应用程序的重要部分。你可以在<a class="ae lb" href="https://github.com/TheBojda/waku-uber" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到完整的代码。</p><p id="97d1" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">我知道，这是一个汽车共享应用程序的最小实现，但经过一些改进，它可以发展成为一个真正的应用程序。让我们来看看其中的一些改进:</p><ul class=""><li id="0708" class="lw lx io kc b kd ke kh ki ky ly kz lz la ma kx mb mc md me bi translated">真实身份管理。基于区块链的身份识别系统可以确保司机和乘客之间的信任。可以用对等体的公钥/私钥对消息进行加密和签名，并且可以由第三方身份提供者来识别对等体，该第三方身份提供者可以证明简档数据的有效性、检查驾驶执照的有效性等。</li><li id="915b" class="lw lx io kc b kd mf kh mg ky mh kz mi la mj kx mb mc md me bi translated">基于位置的广播。在当前的实现中，即使乘客离司机很远，每个司机都会收到每个请求。这可以通过更多基于<a class="ae lb" href="https://en.wikipedia.org/wiki/Geohash" rel="noopener ugc nofollow" target="_blank"> geohash </a>的广播主题来管理。</li></ul><p id="5a30" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">正如您所看到的，当您构建一个分散的应用程序时，区块链并不总是答案。有时候深入挖掘p2p堆栈是值得的。像Waku这样的点对点pubsub服务可以用在很多方面。你可以建立分散的优步或分散的Airbnb，你可以建立分散的数据库或你自己的区块链。</p><p id="1796" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated">快乐编码…</p><p id="72fd" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated"><em class="kb">本文原载</em> <a class="ae lb" href="https://hackernoon.com/decentralized-uber-heres-how-i-built-it-with-statusim-waku-and-vuejs" rel="noopener ugc nofollow" target="_blank"> <em class="kb">此处</em> </a> <em class="kb">。</em></p><p id="7e92" class="pw-post-body-paragraph jz ka io kc b kd ke kf kg kh ki kj kk ky km kn ko kz kq kr ks la ku kv kw kx ih bi translated"><em class="kb">更多内容看</em> <a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc ip"> <em class="kb">说白了。</em> </strong> <em class="kb">报名参加我们的</em> </a><a class="ae lb" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc ip"> <em class="kb">免费每周简讯这里</em> </strong> </a> <strong class="kc ip"> <em class="kb">。</em> </strong></p></div></div>    
</body>
</html>