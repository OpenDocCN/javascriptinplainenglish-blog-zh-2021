<html>
<head>
<title>Create Random Particle Effects with Canvas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用画布创建随机粒子效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-random-particle-effects-with-canvas-bbb8a67d494?source=collection_archive---------8-----------------------#2021-09-17">https://javascript.plainenglish.io/create-random-particle-effects-with-canvas-bbb8a67d494?source=collection_archive---------8-----------------------#2021-09-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5190" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">有趣的演示。</h2></div><p id="c6f8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae lb" href="https://medium.com/p/97818823ae7e" rel="noopener">在之前的文章</a>中，我们做了一些静态图形。在这篇文章中，我们将学习如何制作动画。</p><p id="15de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是最终产品:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/edec233467f5c4798ec047e9ec235a56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*dQT8Ivo2bC-bFn8gnnZdIg.gif"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="4de5" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">动画原理</h1><p id="7fd4" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">在制作动画效果之前，我们需要了解制作动画的原理。你知道动画效果是如何产生的吗？</p><p id="3b0f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个搞笑的视频:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="ac5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个视频生动地展示了动画是如何制作的:如果将一个个逻辑上相关的静态画面按顺序展示给观众，那么在观众的视角中，画面会有移动的感觉。</p><p id="391f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以如果我们想制作随机粒子特效，我们只需要:</p><ol class=""><li id="72b1" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la mz na nb nc bi translated">在画布上随机绘制一些粒子</li><li id="72bf" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">擦除这些粒子，然后将每个粒子向上移动一个单位，然后重新绘制这些粒子</li><li id="963f" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la mz na nb nc bi translated">不断重复第二步</li></ol><p id="d0e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样就可以产生上图gif所示的效果。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="0c14" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">绘制随机粒子</h1><p id="d41a" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">好了，我们开始写代码吧。</p><p id="e541" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一步，我们应该在页面上绘制一些随机粒子。</p><p id="ee07" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为后面要画很多粒子，所以可以专门创建一个类来生成随机粒子。</p><p id="cd3b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码显示如下:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ni mt l"/></div></figure><p id="5200" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在RandomParticle构造函数中，参数<code class="fe nj nk nl nm b">x</code>是粒子的横坐标，参数<code class="fe nj nk nl nm b">y</code>是粒子的纵坐标，<code class="fe nj nk nl nm b">this.r</code>是粒子的半径，<code class="fe nj nk nl nm b">this.color</code>是粒子的颜色。</p><p id="515e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为我们在创建这个对象的时候，并不知道我们的画布有多大，所以我们的RandonParticle无法正确生成随机坐标，所以我们需要外部传递一个随机坐标。</p><p id="b0ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">粒子的半径和颜色可以在构造函数中直接随机生成。相关代码如下:</p><pre class="ld le lf lg gt nn nm no np aw nq bi"><span id="ab83" class="nr lw iq nm b gy ns nt l nu nv">this.r = Math.floor(Math.random() * maxRadius)</span><span id="b750" class="nr lw iq nm b gy nw nt l nu nv">this.color = this.generateRandomRGBAColor()</span></pre><p id="d6f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nj nk nl nm b">generateRandomRGBAColor</code>是一种生成随机颜色的方法，代码比较简单，你可以自己阅读。</p><p id="6893" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">之后还有一个draw方法，在画布上画自己。</p><p id="afd8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好，现在让我们在画布上生成100个随机粒子:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ni mt l"/></div></figure><p id="6aee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是结果:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nx"><img src="../Images/71ebc7a0f77f9c3fff3cb4e57019a14a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*teLvf5PlzFdUHmyQiZwA5Q.png"/></div></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="9d9c" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">制作动画</h1><p id="45ec" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">现在我们开始制作动画。让粒子运动，需要我们不断修改粒子的坐标，重新绘制。所以我们需要为RandomParticle类添加一个可以修改自己坐标的方法。</p><p id="ce30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们让粒子不断向上移动，移动到画布顶部后，回到底部继续向上移动。所以我们的方法可以写成这样:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ni mt l"/></div></figure><p id="8953" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简要解释这段代码:</p><ul class=""><li id="8e89" class="mu mv iq kh b ki kj kl km ko mw ks mx kw my la ny na nb nc bi translated">每次调用这个方法，这个质点的y坐标减1，这样这个质点就会上移</li><li id="fbc3" class="mu mv iq kh b ki nd kl ne ko nf ks ng kw nh la ny na nb nc bi translated">如果<code class="fe nj nk nl nm b"> this.y &lt;= (0-this.r)</code>的结果为真，则意味着粒子已经移动到画布的顶部，消失了。这时，我们希望粒子跳到画布的底部，然后继续向上移动。</li></ul><p id="3087" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将继续执行这些粒子的<code class="fe nj nk nl nm b">moveDown</code>方法。可以写这样的代码:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ni mt l"/></div></figure><p id="1aaa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个函数做三件事:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi nz"><img src="../Images/fa9ca78b56406c329fd6e721e2edcd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Jn82udgZfmD-Tfqhjhazw.png"/></div></div></figure><p id="a812" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nj nk nl nm b"><a class="ae lb" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank">requestAnimationFrame</a></code>功能是浏览器自带的API，专门用于处理动画。这个方法使用一个回调函数作为参数，这个回调函数将在浏览器重绘之前被调用。</p><p id="1843" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么我们的代码就完成了。你可以执行上面的代码来看看效果。</p><p id="1e40" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是完整的代码:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="ni mt l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="b556" class="nr lw iq bd lx oa ob dn mb oc od dp mf ko oe of mh ks og oh mj kw oi oj ml ok bi translated">简单的测试</h2><p id="015f" class="pw-post-body-paragraph kf kg iq kh b ki mn jr kk kl mo ju kn ko mp kq kr ks mq ku kv kw mr ky kz la ij bi translated">如果我们希望粒子运动得更快，应该修改哪个参数？</p><p id="327f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ol">更多内容尽在</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="ol">plain English . io</em></strong></a></p></div></div>    
</body>
</html>