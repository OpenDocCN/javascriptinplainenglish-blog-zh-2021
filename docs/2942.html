<html>
<head>
<title>The Easy Guide: Using State Management with NGXS in an Ionic App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简单指南:在Ionic应用程序中使用NGXS的状态管理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-easy-guide-using-state-management-with-ngxs-in-an-ionic-app-4d4e61c4e78?source=collection_archive---------6-----------------------#2021-06-15">https://javascript.plainenglish.io/the-easy-guide-using-state-management-with-ngxs-in-an-ionic-app-4d4e61c4e78?source=collection_archive---------6-----------------------#2021-06-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b84deda155376a9c290086da370c311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nl9WYwQs7hydGjI9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@shunyakoide?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Shunya Koide</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="b3f1" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">为什么要NGXS状态管理？</h2><p id="67e4" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">将变量或对象的一部分保存在某个地方，随时可以调用，这不是很容易吗？类似于在整个应用程序中保持不变的变量库，可以很容易地更新和调用。</p><p id="4e29" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">对对象的任何更改(此后称为“状态”)也可以很容易地被查看和记录，这样我们作为开发人员就可以知道是否发生了更改以及何时发生的。</p><p id="fb1a" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在我看来，这就是NGXS状态管理发挥作用的地方。在这种情况下，它帮助web应用程序或Ionic应用程序商店，并有效地管理其由对象和变量组成的状态。</p><p id="fb44" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这一特殊内容的创意应归功于比申·帕特尔。</p><h2 id="3144" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">先决条件</h2><ol class=""><li id="c883" class="lz ma iq lb b lc ld lg lh km mb kq mc ku md lt me mf mg mh bi translated">熟悉离子型和角型。如果你以前从未用Ionic做过开发，这是一个很好的框架，可以让你更容易地开发渐进式网络和移动应用。</li><li id="7d3d" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated">熟悉打字稿。许多工作将在TypeScript中完成，因此需要对TypeScript有一点熟悉。</li></ol><p id="869e" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">对于这个特殊的例子，Ionic I将使用的版本是Ionic版本5 (Angular ),带有Ionic CLI(命令行界面)版本6.13.1</p><p id="e06e" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">我们将从SpaceX API文档中提取信息，这些文档是免费的，可以在此处轻松访问:</p><div class="mn mo gp gr mp mq"><a href="https://docs.spacexdata.com/#6b74116b-c47f-4181-b7e8-4adecfa9e165" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">r/SpaceX API文档</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">注意:从2020年11月起，V3 API已被弃用！所有现有的链接将继续工作，但不会有新的数据…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">docs.spacexdata.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne jw mq"/></div></div></a></div><p id="2e54" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">别担心，我们不会用API来发射火箭。没什么特别的。我们将使用一个简单的API来提取关于SpaceX公司的信息。</p><p id="37f3" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这只是一个来自以下URL的简单GET请求:</p><p id="8887" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><a class="ae kc" href="https://api.spacexdata.com/v3/info" rel="noopener ugc nofollow" target="_blank">https://api.spacexdata.com/v3/info</a></p><p id="2273" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">上面的链接应该返回一个包含SpaceX公司信息的JSON对象。</p><h2 id="1ae7" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">0.开始一个离子项目</h2><p id="964d" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">我不能强调这一点不够，如果你不熟悉离子，请到这个网站开始:</p><div class="mn mo gp gr mp mq"><a href="https://www.ionicframework.com" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab fo"><div class="ms ab mt cl cj mu"><h2 class="bd ir gy z fp mv fr fs mw fu fw ip bi translated">跨平台移动应用开发:Ionic框架</h2><div class="mx l"><h3 class="bd b gy z fp mv fr fs mw fu fw dk translated">Ionic Framework的应用程序开发平台构建了令人惊叹的跨平台移动、web和桌面应用程序，只需一个…</h3></div><div class="my l"><p class="bd b dl z fp mv fr fs mw fu fw dk translated">www.ionicframework.com</p></div></div><div class="mz l"><div class="nf l nb nc nd mz ne jw mq"/></div></div></a></div><p id="c4a9" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">确保选择Angular作为Ionic中使用的主要框架。</p><h2 id="6aad" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.安装NGXS</h2><p id="2820" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">接下来，我们需要安装NGXS，这将是我们组织状态的地方。</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="531f" class="kd ke iq nl b gy np nq l nr ns">npm install @ngxs/store --save</span></pre><p id="92ef" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">安装以下NGXS库来帮助我们注销和存储状态也是一个好主意:</p><p id="1ee8" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt">登录器插件:</em></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="e766" class="kd ke iq nl b gy np nq l nr ns">npm install @ngxs/logger-plugin --save</span></pre><p id="1e70" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt">商店插件:</em></p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="8d62" class="kd ke iq nl b gy np nq l nr ns">npm install @ngxs/storage-plugin --save</span></pre><h2 id="8092" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.使用服务调用API并存储在状态中</h2><p id="b585" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">生成一个调用SpaceX API的服务。我将把这个服务称为网络服务。要在Ionic中生成此服务，请在命令行中运行以下命令:</p><pre class="ng nh ni nj gt nk nl nm nn aw no bi"><span id="3895" class="kd ke iq nl b gy np nq l nr ns">ionic g service ngxs/network</span></pre><p id="bfbf" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">这将生成一个名为<em class="nt"> ngxs </em>的文件夹，其中包含network.service.ts文件。</p><p id="caf6" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在我们的network.service.ts文件中，添加以下内容来调用SpaceX API。</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c33f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">第10到12行是我们调用SpaceX服务器的函数。</p><p id="88c1" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">请注意，为了简单起见，我将使用一个典型的Angular/common/http库。如果你打算建立一个移动应用程序，我推荐你使用Ionic Capacitor HTTP库。</p><h2 id="b21d" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.设置NGXS文件</h2><p id="9119" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">在上一步创建的<em class="nt"> ngxs </em>文件夹中创建以下文件:</p><p id="dc35" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt"> ngxs/action.ts </em></p><p id="2371" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt"> ngxs/state.ts </em></p><p id="a6fa" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><strong class="lb ir">注意</strong>:在某些情况下，你可能想创建一个interface.ts文件来声明interface.ts，然而，这是一个简单的指南，我想把事情简单化。我将在state.ts文件中声明接口，而不是使用不同的文件。</p><p id="024d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在action.ts中，在action.ts文件中声明一个操作，如下所示:</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="734a" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">稍后将在我们的商店调度功能中调用上述操作。现在不要担心它。</p><p id="6318" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">接下来，在state.ts文件中，我们需要做3件事:</p><ol class=""><li id="b08a" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt me mf mg mh bi translated">声明接口</li><li id="bceb" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated">声明模型</li><li id="b5ee" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated">声明在执行上述函数时将采取的操作</li></ol><p id="3bfe" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">我们的state.ts文件应该如下所示:</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="0c1f" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt nz mf mg mh bi translated">请注意，我们已经在第4行的action.ts中声明了我们的操作</li><li id="3805" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">我们还为我们使用SpaceXInfoState声明了Injectable()</li><li id="573a" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">第7行到第30行是我们声明接口的地方。该接口基于调用API时的预期结果</li><li id="f947" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">第32行是我们声明初始状态并给我们的状态命名的地方，在这个例子中，它是<em class="nt"> SpaceXInfoState </em></li><li id="e355" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">我们还在第40行声明了我们的网络服务</li><li id="caad" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">第42行到第52行是我们执行函数并通过使用<em class="nt"> patchState() </em>保存对我们状态的响应的地方</li></ul><h2 id="d937" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.在app.module.ts设置NGXS</h2><p id="7cd0" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">现在我们已经完成了网络服务、状态和动作文件中的所有艰苦工作，我们终于准备好在app.module.ts文件中声明NGXS，以便在我们的应用程序中使用NGXS。</p><p id="b80d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">我们的app.module.ts文件应该如下所示:</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="fc58" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt nz mf mg mh bi translated">第9、10和11行是我们将NGXS属性导入应用程序的地方，这些属性是我们之前安装的</li><li id="53d2" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">我们将导入的模块添加到第23到31行的模块导入列表中</li><li id="8cd1" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">在NgxsModule中，我已经将SpaceXInfoState(在第14行导入)添加到将在该应用程序中使用的状态列表中。如果在action.ts文件中声明了更多的状态，请在这里添加它们。</li><li id="470c" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">另外，请注意，我已经添加了HttpClientModule(第13行和第32行)。如果您使用HTTP电容器方法，则不需要添加它。</li></ul><h2 id="d7f9" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">5.使用store dispatch()获取数据</h2><p id="812c" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">现在我们需要执行我们已经创建的操作。在我的例子中，我将执行home.page.ts文件中的函数。我们的home.page.ts文件应该如下所示:</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="ba3b" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt nz mf mg mh bi translated">第2到4行是我们导入<code class="fe oa ob oc nl b">Select, Store</code>我们的动作(<code class="fe oa ob oc nl b">GET_SPACEX_DATA</code>)和我们的状态(<code class="fe oa ob oc nl b">SpaceXInfoState</code>)的地方</li><li id="7a61" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated"><code class="fe oa ob oc nl b"> ionViewWillEnter()</code>该功能将在每次加载主页时执行。在这个函数中，我们使用<code class="fe oa ob oc nl b">store.dispatch</code>来执行我们在<code class="fe oa ob oc nl b">state.ts</code>中声明的动作</li><li id="1836" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">为了拉取和声明数据，我还声明了<code class="fe oa ob oc nl b">getData()</code>函数，该函数将在<code class="fe oa ob oc nl b">store.dispatch</code>完成运行后执行。</li><li id="311d" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">在<code class="fe oa ob oc nl b">getData() </code>函数中，我们使用<code class="fe oa ob oc nl b">selectSnapshot</code>将数据分配给<code class="fe oa ob oc nl b">cto_propulsion</code>变量和<code class="fe oa ob oc nl b">founded</code>变量。我们现在可以在HTML中使用<code class="fe oa ob oc nl b">cto_propulsion</code>和<code class="fe oa ob oc nl b">founded</code>，就像在任何典型的angular项目中一样。</li></ul><p id="d19f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">给你，简单的柠檬榨汁机。上面显示的是使用NGXS存储和使用selectSnapshot从您的州获取数据的简单方法。只要会话仍然有效，状态就会保持不变。</p><p id="31c2" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">你可以在这里结束，一切都会很好，但对于额外的学分…</p><p id="b021" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">…还有一件事…</p><p id="39ab" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">好处:使用存储选择器来获取数据</p><p id="a0fc" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">您还可以使用存储选择器从您的状态中获取异步数据。我们需要将以下内容添加到我们的<em class="nt"> state.ts </em>文件中:</p><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="80e2" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt nz mf mg mh bi translated">在上面的state.ts文件中，我已经将第42行的<code class="fe oa ob oc nl b">ceo</code>选择器添加到了第45行。</li><li id="debb" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nz mf mg mh bi translated">我们现在可以像这样使用<code class="fe oa ob oc nl b">home.page.ts</code>中的<code class="fe oa ob oc nl b">ceo </code>选择器:</li></ul><figure class="ng nh ni nj gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><ul class=""><li id="8667" class="lz ma iq lb b lc lu lg lv km nw kq nx ku ny lt nz mf mg mh bi translated">在上面的home.page.ts示例中，我在第14行添加了<code class="fe oa ob oc nl b">ceo$</code>。这将创建一个异步变量，您可以在Angular HTML文件中使用它。在<code class="fe oa ob oc nl b">ceo</code>状态中的任何变化将直接反映到<code class="fe oa ob oc nl b">ceo$</code>变量中，无需任何额外的函数调用。</li></ul><p id="318c" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">现在你知道了。以上并不是一个详尽的方法，但这是一个简单的方法来展示如何使用NGXS状态管理来存储数据，这些数据可以在Ionic应用程序中的任何地方轻松访问。</p><p id="4cde" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">希望上面的文章能为您在应用程序中使用NGXS提供有用的入门指南。</p><p id="e511" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt">塞拉马特·孟加图拉卡</em></p><p id="8900" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="nt">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nt">plain English . io</em></a></p></div></div>    
</body>
</html>