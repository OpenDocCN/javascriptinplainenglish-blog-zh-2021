<html>
<head>
<title>Simple Collapsing Header Animation using React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React Native简单折叠标题动画</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/simple-collapsing-header-animation-using-react-native-21f4c26b2222?source=collection_archive---------0-----------------------#2021-01-14">https://javascript.plainenglish.io/simple-collapsing-header-animation-using-react-native-21f4c26b2222?source=collection_archive---------0-----------------------#2021-01-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6a9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">动画对于创造良好的用户体验是非常重要的，它们允许你在界面中传达真实可信的动作。</p><p id="b709" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个库的设计目的是让动画流畅、强大，并且易于构建和维护。<code class="fe ki kj kk kl b">Animated</code>关注输入和输出之间的声明性关系，它们之间的可配置转换，以及控制基于时间的动画执行的<code class="fe ki kj kk kl b">start</code> / <code class="fe ki kj kk kl b">stop</code>方法。</p><p id="ac92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天，我们把重点放在动画我们的头组件，以最终实现以下结果:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi km"><img src="../Images/7d51886f42cf27f43b3e506fbc381837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*w_hkJ9c82dAJj9Ag-DDznQ.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Final result</figcaption></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="609d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们深入研究一下。首先，我们必须创建我们的项目</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="ca83" class="lj lk in kl b gy ll lm l ln lo">$ react-native init animation</span></pre><p id="f823" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">初始化我们的项目后，我们需要使用React Native提供的<code class="fe ki kj kk kl b">Animated API</code>。</p><p id="acb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们创建我们的视图:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div></figure><p id="6cde" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">定义视图后，我们需要从react-native导入<code class="fe ki kj kk kl b">Animated</code>。<code class="fe ki kj kk kl b">Animated</code>模块为我们提供了动画视图的必要工具:</p><ul class=""><li id="07a6" class="lr ls in jm b jn jo jr js jv lt jz lu kd lv kh lw lx ly lz bi translated">动画。视角</li><li id="3907" class="lr ls in jm b jn ma jr mb jv mc jz md kd me kh lw lx ly lz bi translated">动画。滚动视图</li><li id="91cd" class="lr ls in jm b jn ma jr mb jv mc jz md kd me kh lw lx ly lz bi translated">动画。图像</li><li id="2100" class="lr ls in jm b jn ma jr mb jv mc jz md kd me kh lw lx ly lz bi translated">动画。文本</li><li id="ee84" class="lr ls in jm b jn ma jr mb jv mc jz md kd me kh lw lx ly lz bi">…</li></ul><p id="905c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们了解了动画库的基本组件后，我们可以直接开始制作动画了。</p><p id="8e9b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们必须将我们的视图、ScrollView等转换成一些动画组件。</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="d027" class="lj lk in kl b gy ll lm l ln lo">&lt;ScrollView&gt;...&lt;/ScrollView&gt; =&gt; &lt;Animated.ScrollView&gt;...&lt;/Animated.ScrollView&gt;</span></pre><p id="aa88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，我们需要把我们的滚动位置放在不受组件重新渲染影响的地方，这里我们最好的选择是“ref”。</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="15b3" class="lj lk in kl b gy ll lm l ln lo">import React, {useRef} from 'react'</span><span id="5685" class="lj lk in kl b gy mf lm l ln lo">const scrollPosition = useRef(new <strong class="kl io"><em class="mg">Animated</em></strong>.<em class="mg">Value</em>(0)).current;</span></pre><p id="6141" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在设置了“scrollPosition”之后，现在我们应该在滚动时以编程方式更改它。我们应该编写以下代码来访问本机滚动位置:</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="b96e" class="lj lk in kl b gy ll lm l ln lo">&lt;Animated.ScrollView<br/>  onScroll={<strong class="kl io"><em class="mg">Animated</em></strong>.event(<br/>    [{nativeEvent: {contentOffset: {y: scrollPosition}}}],<br/>    {useNativeDriver: false},<br/>  )}<br/>  contentInsetAdjustmentBehavior="automatic"<br/>  style={[styles.scrollView]}&gt;<br/>...<br/>&lt;/Animated.ScrollView&gt;</span></pre><p id="fa61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如我们看到的滚动，我们将滚动偏移量记录到终端中:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mh"><img src="../Images/29a32228a83ed0a32345b752e2543832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPlBA-wotu8ffpZS97sP8A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Scroll position output</figcaption></figure><p id="1960" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们已经完成了基础工作。移动到动画我们的标题的高度。首先，我们必须定义一个最小高度，这样我们的标题视图就不会超过0高度而折叠…</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="653d" class="lj lk in kl b gy ll lm l ln lo">const minHeaderHeight = 70<br/>const maxHeaderHeight = 200</span></pre><p id="4fda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们应该定义我们正在制作动画的标题的高度:</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="0831" class="lj lk in kl b gy ll lm l ln lo">const headerHeight = scrollPosition.interpolate({<br/>  inputRange: [0, 500],<br/>  outputRange: [maxHeaderHeight, minHeaderHeight],<br/>  extrapolate: 'clamp',<br/>});</span></pre><p id="8cf3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里的输入范围是我们提供的滚动位置，输出范围是我们期望的输出。请注意，输入范围和输出范围数组必须具有相同的长度。</p><p id="04eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们应该有这样的输出:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/c9f5478fc4894e4e7932abc396ba1e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*bStoDgJMDecaAdtEYhEL2g.gif"/></div></figure><p id="6efb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以做同样的事情来制作字体大小、图像高度、文本不透明度和图像位置的动画。</p><p id="a237" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意，我们可以使用react-native中的Dimensions API来获取动态大小。</p><pre class="kn ko kp kq gt lf kl lg lh aw li bi"><span id="ec34" class="lj lk in kl b gy ll lm l ln lo">const opacity = scrollPosition.interpolate({<br/>  inputRange: [0, 100, 200],<br/>  outputRange: [1, 0.5, 0],<br/>  extrapolate: 'clamp',<br/>});<br/>const size = scrollPosition.interpolate({<br/>  inputRange: [0, 100, 200, 300, 400],<br/>  outputRange: [20, 17, 15, 13, 11],<br/>  extrapolate: 'clamp',<br/>});<br/>const imageHeight = scrollPosition.interpolate({<br/>  inputRange: [0, 400],<br/>  outputRange: [100, 50],<br/>  extrapolateLeft: 'identity',<br/>  extrapolateRight: 'clamp',<br/>});<br/>const imagePosition = scrollPosition.interpolate({<br/>  inputRange: [0, 400],<br/>  outputRange: [(37 * <strong class="kl io"><em class="mg">Dimensions</em></strong>.get('window').width) / 100, 0],<br/>  extrapolateLeft: 'identity',<br/>  extrapolateRight: 'clamp',<br/>});</span></pre><p id="7a7b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最终的代码应该是这样的。这是我们可以使用react-native挖掘动画的最基本的例子。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="lp lq l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Final code portion</figcaption></figure><p id="9d33" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">编码快乐！</p></div></div>    
</body>
</html>