<html>
<head>
<title>Integrating MongoDB to Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将MongoDB集成到Next.js</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integrating-mongodb-to-nextjs-f7038f90051a?source=collection_archive---------5-----------------------#2021-08-27">https://javascript.plainenglish.io/integrating-mongodb-to-nextjs-f7038f90051a?source=collection_archive---------5-----------------------#2021-08-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1d93" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">了解如何使用getStaticProps轻松地将MongoDB这样的数据库集成到Next.js中！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b5648e1753b2e54c36cd9ee688119ec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXYT7cw3xVTqIvhuzpYymQ.png"/></div></div></figure><p id="40a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将逐步介绍将MongoDB集成到Next.js web应用程序的过程。如果你正在做一个fullstack项目，迟早你可能会遇到需要将你的web应用程序连接到数据库的情况。在这篇博文中，我将使用<strong class="kt ir"> MongoDB </strong>。这是一个非常简单的非SQL数据库，您可以很容易地免费使用它！</p><h1 id="0f50" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">如何入门？</h1><p id="60ee" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在我们深入实际代码之前，您首先需要设置一些关于MongoDB的东西。首先，在这里创建一个账户<a class="ae mk" href="https://www.mongodb.com/de-de/cloud/atlas" rel="noopener ugc nofollow" target="_blank">。我们将使用MongoDB云图。</a></p><p id="5bbf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在完成你的注册和建立一个组织后，你主要需要做些事情。进入<strong class="kt ir">数据库访问</strong>，添加一个新用户。确保该用户具有读写权限！使用<strong class="kt ir">密码</strong>作为验证方法，并记下该密码，因为您稍后会用到它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/8b0a0df80e66716e5a7a45f892ed1bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qbHONovSvt1DHGPP2-TnRQ.png"/></div></div></figure><p id="ab7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">设置好您的用户后，进入<strong class="kt ir">网络访问</strong>并添加您当前的IP地址，以便能够与您的数据库建立连接。或者，您可以允许来自每个IP地址的访问。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ml"><img src="../Images/4ffbfbe5193ab210fb2ae73f5e56343c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5D48nKMYUnON-vmHT0Rrww.png"/></div></div></figure><h1 id="5f17" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">如何设置我的代码？</h1><p id="2f02" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">因为这篇文章是关于数据获取的，所以<strong class="kt ir"> getStaticProps </strong>函数是建立连接和获取数据的最佳地方。如果你不知道getStaticProps和Next.js提供的其他选项，请访问这个网站。</p><p id="cb18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面您可以找到从MongoDB连接和获取数据的完整代码。我们会一步一步来。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="113f" class="mr lo iq mn b gy ms mt l mu mv">import { MongoClient } from "mongodb";<br/><br/>export async function getStaticProps() {<br/><br/>  const client = await MongoClient.connect(<br/>    "mongodb+srv://&lt;username&gt;:&lt;username&gt;@cluster0.pqdlimongodb.net/<br/>    &lt;dbname&gt;?retryWrites=true&amp;w=majority"<br/>  );<br/><br/>  const db = client.db();<br/><br/>  const yourCollection = db.collection("yourCollection");<br/><br/><br/>  const yourData = await yourCollection.find().toArray();<br/><br/>  client.close();<br/><br/>  return {<br/>    props: data<br/>  };<br/>}</span></pre><p id="d97c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">第一步，您需要通过<strong class="kt ir"> npm i mongodb </strong>安装所需的依赖项。完成后，使用以下命令导入MongoClient:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="3d20" class="mr lo iq mn b gy ms mt l mu mv">import { MongoClient } from "mongodb";</span></pre><p id="220d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，我将整个函数构造为异步的，这对于数据获取来说通常是个好主意。名为<strong class="kt ir"> client </strong>的第一个常量建立了到数据库的实际连接。在<strong class="kt ir">连接函数</strong>的括号内，您需要用本博客第一步设置中的凭证替换&lt;用户名&gt;和&lt;密码&gt;。此外，您必须用自己选择的数据库名称替换&lt; dbname &gt;！</p><p id="d838" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">建立连接后，您可以将数据库的一个实例存储在名为<strong class="kt ir"> db </strong>的变量中。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="a1da" class="mr lo iq mn b gy ms mt l mu mv">const yourCollection = db.collection("yourCollection");</span></pre><p id="a5e5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于MongoDB是一个所谓的非SQL数据库，我们在这里使用集合。上面的代码片段显示了如何在const <strong class="kt ir"> yourCollection </strong>中存储这样一个集合。在这个集合还不存在的情况下，会由MongoDB自动生成。那很好，不是吗？！？</p><p id="a1ed" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下一步，将集合中的实际数据存储在一个名为<strong class="kt ir"> yourData </strong>的常量中。在这里，我们存储集合中的所有条目。或者，您可以使用以下代码:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="9061" class="mr lo iq mn b gy ms mt l mu mv">const yourData = await yourCollection.find({}, {}).toArray();</span></pre><p id="e414" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在第一对花括号中，您可以添加过滤器，这些过滤器将应用于您的集合数据。第二对花括号告诉你的代码，过滤器应该应用于集合中的哪些数据字段。</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="5a8a" class="mr lo iq mn b gy ms mt l mu mv">const yourData = await yourCollection.findOne({id: 3,});</span></pre><p id="b637" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您只是在您的集合中寻找一个特定的数据点，您也可以使用上面的代码片段。在这个特定的例子中，我们寻找id为3的数据条目。</p><p id="2ff2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在最后一步中，您可能希望使用以下代码切断与数据库的连接:</p><pre class="kg kh ki kj gt mm mn mo mp aw mq bi"><span id="b87a" class="mr lo iq mn b gy ms mt l mu mv">client.close();</span></pre><h1 id="d179" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">结论</h1><p id="0082" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">所以这仍然是集成Next.js和MongoDB的一个简单用例。它可以变得有点复杂，例如，当它涉及到获取动态网站的数据。这将在另一篇博客文章中介绍！</p><p id="d88f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">哇，真有趣！我一定会继续写关于React和Next.js主题的博客！如果你喜欢这篇文章，请随时关注我。</p><p id="b8c7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我希望这篇博文对你有所帮助。无论如何，谢谢你读这篇文章，祝你有美好的一天！</p></div></div>    
</body>
</html>