<html>
<head>
<title>How to Load Sketchfab Models Directly in a Three.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Three.js应用中直接加载Sketchfab模型</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-load-sketchfab-models-directly-in-a-threejs-app-f4e76bacf5e6?source=collection_archive---------4-----------------------#2021-04-27">https://javascript.plainenglish.io/how-to-load-sketchfab-models-directly-in-a-threejs-app-f4e76bacf5e6?source=collection_archive---------4-----------------------#2021-04-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/494198441b447245d974690c8c00476c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oKK011iDTWzu83bF"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@cgower?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ebb5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Sketchfab的API为您提供了对web上最大的glTF 3D模型集合的编程访问。本文通过一个简单的代码示例向您展示如何:</p><ol class=""><li id="6b70" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">让您的用户使用Sketchfab API进行身份验证</li><li id="45ec" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">以包含glTF的zip文件的形式下载3D模型</li><li id="bfe0" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">将这个zip文件加载到Three.js中</li></ol><p id="1614" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">源代码:</strong></p><div class="lm ln gp gr lo lp"><a href="https://github.com/OmarShehata/threejs-sketchfab-example" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd io gy z fp lu fr fs lv fu fw im bi translated">OmarShehata/three js-sketch fab-example</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">这是一个简单的代码示例，说明如何将3D模型作为glTF从Sketchfab API加载到ThreeJS场景中。它表明…</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">github.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md jt lp"/></div></div></a></div><h2 id="a75a" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">它是如何工作的</h2><p id="a578" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">我最初实现这一点是为了让我的<a class="ae jz" href="https://omar-shehata.medium.com/how-to-render-outlines-in-webgl-8253c14724f9" rel="noopener"> WebGL大纲教程</a>的读者看到他们选择的测试用例的效果，因为我一直在寻找对我的特定极限情况不起作用的算法(但直到我实现/下载并运行它之后，我才会发现)。</p><p id="c8f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是让用户引入自己的数据(或数百万个示例模型)的一种非常简单的方法。</p><p id="6f13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在这个大纲实时演示中看到它是如何工作的:</p><ol class=""><li id="7f2e" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">打开试玩:【https://omarshehata.github.io/csb-l01dp/ T4】</li><li id="d168" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">点击<strong class="kc io">登录Sketchfab </strong></li><li id="aeb6" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">当返回到应用程序时，在<strong class="kc io"> Sketchfab URL字段</strong>中粘贴一个模型的链接，如下:<a class="ae jz" href="https://sketchfab.com/3d-models/skull-downloadable-1a9db900738d44298b0bc59f68123393" rel="noopener ugc nofollow" target="_blank">https://sketch fab . com/3d-models/skull-downloaded-1a 9db 900738d 44298 b 0 BC 59 f 68123393</a></li></ol><p id="f51a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该模型必须可由登录的Sketchfab帐户下载。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b563a8636c73455237bbe104a2cabe5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*xZcYU7BtVl-CDfklPWxS1Q.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk"><a class="ae jz" href="https://omarshehata.github.io/csb-l01dp/" rel="noopener ugc nofollow" target="_blank">The demo app</a> loads a 3D model directly from any Sketchfab URL into a ThreeJS scene</figcaption></figure><h2 id="f394" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">1-使用Sketchfab API进行身份验证</h2><p id="122e" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">第一步是用Sketchfab注册你的应用。这方面的说明如下:</p><div class="lm ln gp gr lo lp"><a href="https://sketchfab.com/developers/oauth#registering-your-app" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab fo"><div class="lr ab ls cl cj lt"><h2 class="bd io gy z fp lu fr fs lv fu fw im bi translated">OAuth登录-开发人员</h2><div class="lw l"><h3 class="bd b gy z fp lu fr fs lv fu fw dk translated">了解如何通过添加Sketchfab身份验证来提高应用程序的UX。</h3></div><div class="lx l"><p class="bd b dl z fp lu fr fs lv fu fw dk translated">sketchfab.com</p></div></div></div></a></div><p id="04d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在撰写本报告时，目前的程序是与他们联系。</p><p id="6c99" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你需要选择一个<strong class="kc io">重定向URI </strong>。这应该是您将部署应用程序的最终URI。</p><p id="c495" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将希望使用<strong class="kc io">隐式</strong>授权类型。我们不能在web应用程序中保守API密钥的秘密，所以我们转而依赖重定向URI(如果有人恶意使用你的客户端ID，Sketchfab会在登录后将他们重定向到你真正的应用程序，不管是谁发起了登录)。</p><p id="5c35" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注册应用程序后，您将拥有一个<strong class="kc io">客户端ID </strong>。</p><p id="ed3d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将使用它将用户发送到Sketchfab进行登录，如下所示:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="9fd4" class="me mf in ni b gy nm nn l no np">const CLIENT_ID = 'YOUR_CLIENT_ID_HERE';<br/>const AUTHENTICATION_URL = `https://sketchfab.com/oauth2/authorize/?state=123456789&amp;response_type=token&amp;client_id=${CLIENT_ID}`;<br/>window.open(AUTHENTICATION_URL, '_blank');</span></pre><p id="9572" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦登录完成，您需要从URL 获取访问令牌<strong class="kc io">。您可以在源代码中找到这样做的代码片段，并将其存储在本地存储中，如下所示:</strong></p><p id="8fe1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/OmarShehata/threejs-sketchfab-example/blob/b780b8c1eac37fc71d8d803fc465c874efd5954c/SketchfabIntegration.js#L77-L92" rel="noopener ugc nofollow" target="_blank">https://github . com/OmarShehata/three js-sketch fab-example/blob/b 780 b 8 C1 EAC 37 fc 71 d8d 803 fc 465 c 874 EFD 5954 c/sketchbaintegration . js # L77-L92</a></p><p id="cc59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将在后续的API调用中使用这个令牌。</p><h2 id="4a0d" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">2-下载3D模型</h2><p id="3d5d" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">一旦有了令牌，就可以用它来获取glTF模型的下载URI。</p><p id="efd4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是获取下载URI的代码片段给定任何Sketchfab URI如下:<a class="ae jz" href="https://sketchfab.com/3d-models/skull-downloadable-1a9db900738d44298b0bc59f68123393" rel="noopener ugc nofollow" target="_blank">https://sketch fab . com/3d-models/skull-download-1a 9db 900738d 44298 b 0 BC 59 f 68123393</a></p><p id="8c22" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/OmarShehata/threejs-sketchfab-example/blob/b780b8c1eac37fc71d8d803fc465c874efd5954c/SketchfabIntegration.js#L95-L115" rel="noopener ugc nofollow" target="_blank">https://github . com/OmarShehata/three js-sketch fab-example/blob/b 780 b 8 C1 EAC 37 fc 71 d8d 803 fc 465 c 874 EFD 5954 c/sketchbaintegration . js # L95-L115</a></p><p id="8948" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，如果登录的用户没有下载该模型的权限，此请求将会失败。对于需要购买的商店模型或不可下载的免费模型来说，情况就是如此。</p><p id="54cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以在Sketchfab搜索中筛选可下载的模型:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/caec69fc563602e6a5ca69ed936d6274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXOMlDYt9xcyBzvWVQq9fA.png"/></div></div></figure><p id="b479" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将显示您可以下载的免费模型或可以购买的模型。</p><p id="eee7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们有了一个包含glTF模型的zip文件的URL，我们可以将它传递给ThreeJS来加载它。</p><h2 id="b8f3" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">3 —将ZIP文件加载到ThreeJS中</h2><p id="d35a" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">这是我的棘手之处。通常ThreeJS需要一个指向glTF文件的直接URL。为了从一个zip文件中加载它，我们将(1)使用JSZip将内容解压缩到内存中。</p><p id="69d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们不能只将解压缩后的原始内容传递给ThreeJS，因为glTF文件可能通过文件路径(图像或几何资源)引用其他文件。所以我们需要(2)为每个资源创建一个<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank"> Blob </a>，并且(3)用Blob URI覆盖glTF文件请求的资源。</p><p id="b37a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，如果glTF文件试图加载“textures/default mat _ base color . JPEG”作为相对文件路径，我们会检测到这一点，并传递以下URI:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="a616" class="me mf in ni b gy nm nn l no np">//Unzip from JSZip<br/>const file = unzippedBaseColorJPEGFile;<br/>// Create a Blob from this file<br/>const blob = await file.async('blob');<br/>// Create a URL to this Blob<br/>const baseColorBlobUrl = URL.createObjectURL(blob);<br/>// Use ThreeJS's loading manager so instead of loading from relative filepaths we load from the blob URI's we created</span><span id="29c7" class="me mf in ni b gy nr nn l no np">const loadingManager = new THREE.LoadingManager();                            loadingManager.setURLModifier((url) =&gt; {</span><span id="3807" class="me mf in ni b gy nr nn l no np">  if (url == 'textures/defaultMat_baseColor.jpeg') {<br/>    return baseColorBlobUrl;<br/>  }</span><span id="0067" class="me mf in ni b gy nr nn l no np">});</span></pre><p id="4a53" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们使用ThreeJS的LoadingManager 来完成这项工作。</p><p id="3fc8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是代码片段，它可以获取任何压缩的glTF的URL，并将其加载到ThreeJS中:</p><p id="fd91" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/OmarShehata/threejs-sketchfab-example/blob/b780b8c1eac37fc71d8d803fc465c874efd5954c/SketchfabIntegration.js#L30-L70" rel="noopener ugc nofollow" target="_blank">https://github . com/OmarShehata/three js-sketch fab-example/blob/b 780 b 8 C1 EAC 37 fc 71 d8d 803 fc 465 c 874 EFD 5954 c/sketchbaintegration . js # L30-L70</a></p><h2 id="3a05" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">4-显示属性</h2><p id="fbad" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">在应用程序中使用Sketchfab中的3D模型要求您显示原作者的署名。在Sketchfab 上阅读更多相关信息。</p><p id="45f8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以从这个<a class="ae jz" href="https://docs.sketchfab.com/data-api/v3/index.html#!/models/get_v3_models_uid" rel="noopener ugc nofollow" target="_blank">数据API路径</a>中自动获取属性和许可信息。</p><p id="17c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是一个函数，它将在给定modelID的情况下构造属性文本:</p><p id="d4c9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/OmarShehata/threejs-sketchfab-example/blob/8d126d00faf47fb0b99f9f2f7c78a25332ccfb7b/SketchfabIntegration.js#L121-L142" rel="noopener ugc nofollow" target="_blank">https://github . com/OmarShehata/three js-sketch fab-example/blob/8d 126d 00 faf 47 FB 0 b 99 f 2 f 7 c 78 a 25332 CFB 7 b/sketchbaintegration . js # L121-L142</a></p><p id="dd43" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">示例应用程序将在左下角显示属性，链接到原始模型URL、作者的Sketchfab个人资料和许可证。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/2c43f1658126efdb47372786058b820b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wy2-coSbTSgxSipDT_0ZQQ.png"/></div></div></figure><h2 id="01af" class="me mf in bd mg mh mi dn mj mk ml dp mm kl mn mo mp kp mq mr ms kt mt mu mv mw bi translated">已知问题</h2><p id="3c4d" class="pw-post-body-paragraph ka kb in kc b kd mx kf kg kh my kj kk kl mz kn ko kp na kr ks kt nb kv kw kx ig bi translated">加载一些Sketchfab模型的一个问题是，它们的比例将比当前视口大得多。另一个问题是，有些模型可能不会以原点为中心，所以它们在加载时可能不可见。</p><p id="35c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在ThreeJS中加载模型时对它们进行标准化和缩放将有助于解决这个问题，类似于Don McCurdy的glTF查看器的工作方式。</p></div><div class="ab cl nt nu hr nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ig ih ii ij ik"><p id="9b0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读！如果你觉得这很有帮助，请关注我的Twitter @Omar4ur 来查看我的更多作品。不然你也可以在这里找到我<a class="ae jz" href="https://omarshehata.me/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0ec6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="oa">更多内容尽在plainenglish.io </em> </a></p></div></div>    
</body>
</html>