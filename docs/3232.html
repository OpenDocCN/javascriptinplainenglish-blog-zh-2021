<html>
<head>
<title>Let’s Build a Chrome Extension for Openpilot Supported Cars</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们为Openpilot支持的汽车构建一个Chrome扩展</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/chrome-extension-for-openpilot-supported-cars-unofficial-fa2fa2f179d?source=collection_archive---------19-----------------------#2021-07-01">https://javascript.plainenglish.io/chrome-extension-for-openpilot-supported-cars-unofficial-fa2fa2f179d?source=collection_archive---------19-----------------------#2021-07-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="22a8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">购买汽车，了解哪些汽车受Openpilot支持。</h2></div><p id="6e30" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我非常喜欢Comma.ai在自动驾驶领域所做的事情。在你的汽车上安装一个运行开源驾驶辅助软件Openpilot的设备，是像我这样的修补匠的梦想。</p><p id="cac5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在autotrader.ca上浏览汽车时，我想如果这些网站能显示Openpilot是否支持车辆就好了。那么为什么不为它构建一个chrome扩展呢？这将是一个有趣的周末项目。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/a86071449d4c484da700a834a5802e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*z3Jq465cV41L60F7njTBaw.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Chrome extension popup. Screenshot by the author.</figcaption></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi ln"><img src="../Images/d68b1374ee72d7dd4c3a24093a04c250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AhQXp9LBa6G_44v42lB-xg.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Screenshot of the chrome extension by the author.</figcaption></figure><h1 id="be77" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">技术堆栈</h1><p id="4ebe" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">这个Chrome扩展是用TypeScript编写的。它使用Webpack、React和Jest。</p><h1 id="0843" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">用户流量</h1><p id="f2c2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">安装chrome扩展后，用户应该能够:</p><ul class=""><li id="fb27" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated">浏览autotrader.ca等汽车市场网站，例如https://www.autotrader.ca/new/hatchback,suv/?srt=1<a class="ae my" href="https://www.autotrader.ca/new/hatchback,suv/?srt=1&amp;make=Honda,Hyundai,Toyota" rel="noopener ugc nofollow" target="_blank">&amp;品牌=本田、现代、丰田</a></li><li id="6a2a" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la mu mv mw mx bi translated">在浏览页面上，点击chrome扩展弹出菜单上的“显示兼容汽车”按钮。</li><li id="1f26" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la mu mv mw mx bi translated">展示带有弹出窗口的徽章，显示汽车的兼容性详细信息。</li></ul><h1 id="aee1" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">高级序列和结构</h1><p id="ba9b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">它将如何工作的高级序列图。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/bf9b234692cf343b580c91170f115a43.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*qLxF312e604vkrtlE26d3Q.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Sequence diagram by the author.</figcaption></figure><p id="d036" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我对<a class="ae my" href="https://github.com/ardydedase/openpilot-chrome-extension" rel="noopener ugc nofollow" target="_blank">源代码</a>使用了标准的chrome扩展结构。我用的是GitHub模板<a class="ae my" href="https://github.com/chibat/chrome-extension-typescript-starter" rel="noopener ugc nofollow" target="_blank">chrome-extension-typescript-starter</a>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/be78a3c1ecfd216973c4b640d2d7309f.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*wzsB4YfcOWt-HpMC7VjUDQ.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">High-level diagram by the author.</figcaption></figure><ul class=""><li id="f345" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated">我将详细介绍彩色盒子。</li><li id="07c4" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la mu mv mw mx bi translated">其他框是不言自明的，其中一些是任何chrome插件中的标准组件。这里的“组件”可以指源代码的文件、模块或类。</li></ul><h1 id="1be8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">兼容_汽车-数据源</h1><p id="617f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/compatible_cars</code></p><p id="f1cd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">支持的汽车数据来自<a class="ae my" href="https://github.com/commaai/openpilot/blob/master/README.md#supported-cars" rel="noopener ugc nofollow" target="_blank"> Openpilot的自述文件</a>。</p><p id="e706" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Comma.ai有一个<a class="ae my" href="https://api.commadotai.com/#comma-api-spec" rel="noopener ugc nofollow" target="_blank"> API </a>，返回支持的车辆兼容性数据。然而，它并不像Openpilot的自述文件那样是最新的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="gh gi nk"><img src="../Images/ecbac9e1dbd848b42efc639eefad32cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7x_8Wbqql-oAg_ZxjTTAA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Markdown table screenshot from the openpilot README.</figcaption></figure><p id="74b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我使用<a class="ae my" href="http://tableconvert.com" rel="noopener ugc nofollow" target="_blank">tableconvert.com</a>将Openpilot的README中的这个markdown表转换成JSON。然后，我在以下文件中使用tableconvert.com的JSON输出:</p><ul class=""><li id="89e3" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated"><code class="fe ng nh ni nj b">src/compatible_cars/community.ts</code></li><li id="f6b4" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la mu mv mw mx bi translated"><code class="fe ng nh ni nj b">src/compatible_cars/supported.ts</code></li></ul><p id="0c80" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/compatible_cars/supported.ts</code>的代码片段:</p><pre class="lc ld le lf gt nl nj nm nn aw no bi"><span id="b247" class="np lt iq nj b gy nq nr l ns nt">import { Compatibility } from '../interface';</span><span id="2cd2" class="np lt iq nj b gy nu nr l ns nt">const cars = [<br/>    {<br/>        "Make": "Acura",<br/>        "Model (US Market Reference)": "ILX 2016-19",<br/>        "Supported Package": "AcuraWatch Plus",<br/>        "ACC": "openpilot",<br/>        "No ACC accel below": "25mph&lt;sup&gt;1&lt;/sup&gt;",<br/>        "No ALC below": "25mph"<br/>    }, {<br/>        "Make": "Acura",<br/>        "Model (US Market Reference)": "RDX 2016-18",<br/>        "Supported Package": "AcuraWatch Plus",<br/>        "ACC": "openpilot",<br/>        "No ACC accel below": "25mph&lt;sup&gt;1&lt;/sup&gt;",<br/>        "No ALC below": "12mph"<br/>    },..........<br/>];</span><span id="c263" class="np lt iq nj b gy nu nr l ns nt">export const supportedCars = cars.map(car =&gt; {       <br/>    return { ...car, Compatibility: Compatibility.Supported }<br/>});</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/040999f9ead684c565410cbcaa224ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*pOQMRK3p2yDLFtepDR1K5Q.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Data import diagram by the author.</figcaption></figure><p id="fc8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个手动步骤并不光彩。然而，如果将来我决定使用comma的API响应，我可以很容易地将它分配给<code class="fe ng nh ni nj b">compatibleCars</code>常量。</p><h1 id="3de6" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">网站—支持的网站</h1><p id="946f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/websites/</code></p><p id="d8c3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">延伸部分支撑<code class="fe ng nh ni nj b">autotrader.ca</code>和<code class="fe ng nh ni nj b">curbie.ca</code>。<code class="fe ng nh ni nj b">websites</code>文件处理这些支持的网站。</p><ul class=""><li id="0f88" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la mu mv mw mx bi translated"><code class="fe ng nh ni nj b">src/websites/autotrader_ca.ts</code></li><li id="11b9" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la mu mv mw mx bi translated"><code class="fe ng nh ni nj b">src/websites/curbie_ca.ts</code></li></ul><p id="d22e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ng nh ni nj b">AutotraderCa</code>和<code class="fe ng nh ni nj b">CurbieCa</code>实现<code class="fe ng nh ni nj b">Website</code>接口。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nw nx l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Supported websites source code by the author.</figcaption></figure><h2 id="63e9" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">支持新网站</h2><p id="b13f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">如果你想支持一个新的网站，例如<code class="fe ng nh ni nj b">carmarketplace.com</code>。您将需要添加一个实现<code class="fe ng nh ni nj b">Website</code>接口的新类<code class="fe ng nh ni nj b">CarmarketPlaceCom</code>。具体可以参考现有的网站接口实现。</p><pre class="lc ld le lf gt nl nj nm nn aw no bi"><span id="b0c5" class="np lt iq nj b gy nq nr l ns nt">export interface Website {<br/>    getModelInfo(modelInfoElt: any): string;<br/>    getElementsToUpdate(): Array&lt;any&gt;;<br/>    updatePage(commaBtn: any): void;<br/>    getMakeModelElement(supportedModelElt: any): any;<br/>    getTargetNode(): Element | Document;<br/>    mutations(mutations: []): boolean;<br/>}</span></pre><h2 id="a995" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">弹出</h2><p id="01b4" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/popup.tsx</code></p><p id="2218" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个文件处理当你点击Chrome工具栏上的Openpilot图标时出现的弹出窗口。当用户单击主按钮时，它将事件发送到content_script。</p><h2 id="6eb9" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">内容_脚本</h2><p id="fa53" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/content_script.tsx</code></p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nw nx l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Content script source code by the author.</figcaption></figure><p id="2eda" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ng nh ni nj b">content_script</code>执行大部分的编排。它从解析网站上的汽车信息开始。一旦有了这些信息，它就会试图寻找兼容的汽车。最后，将徽章和popover元素注入汽车市场网站。</p><h2 id="b860" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">模型解析器</h2><p id="b94b" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/model_parser.ts</code></p><p id="97c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">ModalParser类包含解析汽车型号和年份的方法。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nw nx l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">ModelParser source code by the author.</figcaption></figure><h2 id="af2d" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">汽车_支持</h2><p id="3703" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated"><code class="fe ng nh ni nj b">src/car_support.ts</code></p><p id="4b64" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">包含用于识别受支持汽车的通用函数。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nw nx l"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Car support source code by the author.</figcaption></figure><h1 id="a13e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">地方发展</h1><h2 id="f398" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">npm运行观察</h2><p id="efba" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在处理存储库时，您可以在后台运行watch。</p><pre class="lc ld le lf gt nl nj nm nn aw no bi"><span id="8e8f" class="np lt iq nj b gy nq nr l ns nt">npm run watch</span></pre><h2 id="ca3a" class="np lt iq bd lu ny nz dn ly oa ob dp mc ko oc od me ks oe of mg kw og oh mi oi bi translated">测试本地chrome扩展的变化</h2><p id="7405" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">上面的命令会自动编译<code class="fe ng nh ni nj b">dist</code>文件夹中的扩展文件。您可以使用这个<code class="fe ng nh ni nj b">dist</code>文件夹在您的浏览器上测试扩展。</p><p id="6323" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要在浏览器上测试扩展:</p><ol class=""><li id="d3f4" class="mp mq iq kh b ki kj kl km ko mr ks ms kw mt la oj mv mw mx bi translated">打开<code class="fe ng nh ni nj b">chrome://extensions/</code></li><li id="be57" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la oj mv mw mx bi translated">打开“开发者模式”开关</li><li id="9028" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la oj mv mw mx bi translated">点击“加载解压”并选择<code class="fe ng nh ni nj b">dist/</code>文件夹</li><li id="8287" class="mp mq iq kh b ki mz kl na ko nb ks nc kw nd la oj mv mw mx bi translated">后续更新，当你的chrome扩展源码指向你的<code class="fe ng nh ni nj b">dist</code>文件夹时，你可以点击“更新”按钮。</li></ol><p id="0382" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行单元测试:</p><pre class="lc ld le lf gt nl nj nm nn aw no bi"><span id="4829" class="np lt iq nj b gy nq nr l ns nt">npm run test</span></pre><p id="001a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在GitHub中查看代码，并从Chrome网上商店安装扩展。</p><p id="763f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> GitHub来源:</strong></p><div class="ok ol gp gr om on"><a href="https://github.com/ardydedase/openpilot-chrome-extension" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">ardydedase/open pilot-chrome-扩展</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">通过在GitHub上创建一个帐户，为ardydedase/open pilot-chrome-extension开发做出贡献。</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb lh on"/></div></div></a></div><p id="c5c2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">从Chrome网络商店安装:</strong></p><div class="ok ol gp gr om on"><a href="https://chrome.google.com/webstore/detail/openpilot-supported-cars/kcpamfgakhobnodajoddnakkbknmclgp?hl=en-GB&amp;authuser=0" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">Openpilot支持的汽车(非官方)</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">指明汽车是否受Openpilot支持。</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">chrome.google.com</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb lh on"/></div></div></a></div><p id="442f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="pd">更多内容尽在</em><a class="ae my" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="pd">plain English . io</em></strong></a></p></div></div>    
</body>
</html>