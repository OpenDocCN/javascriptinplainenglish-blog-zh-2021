<html>
<head>
<title>How to Create a Method Using Mongoose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Mongoose创建一个方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-own-method-in-mongoose-model-5fefa7975b9d?source=collection_archive---------6-----------------------#2021-11-14">https://javascript.plainenglish.io/create-own-method-in-mongoose-model-5fefa7975b9d?source=collection_archive---------6-----------------------#2021-11-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d335" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Mongoose创建比较密码或获取已删除记录的方法指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5e0891373460bc6c035e191981e59401.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eyVJnsIpMMHgSDsf"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@clemhlrdt?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clément Hélardot</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0d85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您熟悉MVC设计模式，那么您可能从标题本身就知道这篇文章。</p><p id="8fe2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于那些不知道我所指的是<strong class="kv io">的人来说，所有与数据库相关的操作都将是模型文件本身的一部分，并有助于在控制逻辑和数据库逻辑之间进行分离。</strong></p><p id="9751" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">举个例子，</p><ul class=""><li id="b6bd" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">获取记录</li><li id="9184" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">仅提取未删除的记录</li><li id="5673" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">在将密码/受保护的密钥保存到数据库之前，对其进行哈希运算</li><li id="5b8f" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">在其他集合中创建可靠的条目(多用于非SQL)</li></ul><p id="cb76" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在您对这种方法的重要性有了一个基本的概念，让我们转到它的实现上来</p><h1 id="4c9d" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">履行</h1><p id="e876" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">对于本文，我假设您已经对Mongoose及其方法有了基本的了解。</p><p id="145a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以让我们开始吧。</p><h2 id="8650" class="na me in bd mf nb nc dn mj nd ne dp mn lc nf ng mp lg nh ni mr lk nj nk mt nl bi translated">模型文件</h2><p id="a751" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">我有一个博客模型文件，它只包含几个字段。这是它的模型文件</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/88a8b243457526be1e11652be581ccc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bu1QGNMxhG3nK7TaGCKhIg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Blog.js</figcaption></figure><p id="98a8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们有了这个简单的方法，我想创建一个只返回未删除字段的方法。为了让它工作，让我们回到模型文件，创建一个名为<code class="fe nn no np nq b">findNonDeleted</code>的新静态方法。此方法将返回集合中的所有条目</p><pre class="kd ke kf kg gt nr nq ns nt aw nu bi"><span id="77ae" class="na me in nq b gy nv nw l nx ny">// syntax<br/>Schema.static.methodName = function (...)</span><span id="ad99" class="na me in nq b gy nz nw l nx ny"><br/>{<br/>  isDeleted: false<br/>}</span></pre><h2 id="d4c4" class="na me in bd mf nb nc dn mj nd ne dp mn lc nf ng mp lg nh ni mr lk nj nk mt nl bi translated">添加新方法</h2><p id="b198" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">要创建一个方法，我们需要像这样使用模式中的静态属性</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/4d9997f77ffa738b86e034cb56e86b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GGvLsfDQfKFZ1blriTcQzQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">the static method named findNonDeleted</figcaption></figure><blockquote class="oa ob oc"><p id="dce9" class="kt ku od kv b kw kx jo ky kz la jr lb oe ld le lf of lh li lj og ll lm ln lo ig bi translated">不要使用箭头方法，因为箭头方法不会绑定您的关键字</p></blockquote><p id="3624" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要使用这种方法，我们可以遵循file命令</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oh"><img src="../Images/a8b5c97cdb1d03f2f93cb458a0db2e77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xPPCoZgGkBfmU2rwVATOpw.png"/></div></div></figure><p id="b8d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一个脚本，将首先删除所有的博客，然后再创建2个博客，其中一个被删除，看看输出是否相同。下面将分别返回1和2的输出</p><h2 id="6938" class="na me in bd mf nb nc dn mj nd ne dp mn lc nf ng mp lg nh ni mr lk nj nk mt nl bi translated">如果你不想要一个静态方法而是一个对象呢</h2><p id="4d4a" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">可能会有这样的变化，你不想用类方法，但对象方法和案例可以像</p><ul class=""><li id="55b0" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">比较密码</li><li id="1006" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">测试特定记录是否满足某些条件</li></ul><p id="1a6d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">或类似的</p><p id="8f13" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要创建对象方法，可以遵循以下语法</p><pre class="kd ke kf kg gt nr nq ns nt aw nu bi"><span id="69bd" class="na me in nq b gy nv nw l nx ny">Schema.methods.methodName= function(parameters) { ... }</span></pre><p id="c5cb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了测试这一点，您可以在Auth模型中添加<code class="fe nn no np nq b">comparePassword</code>方法，如下所示</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/3e5c0267c25e4cd7b93710df486a6f18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvJTRaWsWpXbWtSueATGHQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">comparePassword method to see if a password is matched without encrypting it</figcaption></figure><p id="5812" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">比较将解密密码的模型上的密码方法，并查看当前密码是否与现有密码相同</p><h2 id="f152" class="na me in bd mf nb nc dn mj nd ne dp mn lc nf ng mp lg nh ni mr lk nj nk mt nl bi translated">如何使用对象方法</h2><p id="cf39" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">要使用对象方法，您需要模型实例并将方法附加到它，如下所示</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/3efb4ed28f307625c3c81856d4993b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pk9fdANlKDQ-XIkzydWMMw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">use compare password</figcaption></figure><p id="9155" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用和创建这些方法确实很简单，但是在某些情况下，你可能想要使用任何方法的<code class="fe nn no np nq b">pre</code>和<code class="fe nn no np nq b">post</code>回调，比如<code class="fe nn no np nq b">save, find or findOne</code></p><p id="369b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">看看这些作品是如何跟随下一个标题的</p><h2 id="88a0" class="na me in bd mf nb nc dn mj nd ne dp mn lc nf ng mp lg nh ni mr lk nj nk mt nl bi translated">如何在模式上使用前置和后置</h2><p id="e044" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">下面的语法是</p><pre class="kd ke kf kg gt nr nq ns nt aw nu bi"><span id="dbc1" class="na me in nq b gy nv nw l nx ny">Schema.pre('save', function(next) { ... }</span></pre><p id="bafe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以像使用<code class="fe nn no np nq b">pre</code>一样使用<code class="fe nn no np nq b">post</code>，并且可以用任何现有的方法替换save</p><p id="0ad1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">以下是如何使用它的示例:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/5f08c273fb3c78878331a6cb018eba13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QlLfbrEQ4PNvf9tr_JHNA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">pre-event of auth schema to hash and save the password</figcaption></figure><p id="fc8e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用户的save方法的预事件，以生成密码的散列并将其存储在数据库中。</p><h1 id="cb6e" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">结论</h1><p id="5ec0" class="pw-post-body-paragraph kt ku in kv b kw mv jo ky kz mw jr lb lc mx le lf lg my li lj lk mz lm ln lo ig bi translated">有大量的用例，您可以用刚刚获得的知识来覆盖它们，并使您的项目成为镇上最好的项目之一。</p><blockquote class="oa ob oc"><p id="c9d1" class="kt ku od kv b kw kx jo ky kz la jr lb oe ld le lf of lh li lj og ll lm ln lo ig bi translated">不要使用箭头方法，因为箭头方法不会绑定您的关键字</p></blockquote><p id="89d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你喜欢我的内容，也可以考虑订阅我的substack账户<a class="ae ks" href="https://piyushdubey.substack.com/?r=omfzc&amp;utm_campaign=pub&amp;utm_medium=web&amp;utm_source=" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="489c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望你学到了新的东西。感谢您的阅读。</p><p id="dc08" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="od">更多内容看</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="od">说白了. io </em> </strong> </a> <strong class="kv io"> <em class="od">。</em> </strong> <em class="od">报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="od">免费每周简讯这里</em> </strong> </a> <strong class="kv io"> <em class="od">。</em>T25】</strong></p></div></div>    
</body>
</html>