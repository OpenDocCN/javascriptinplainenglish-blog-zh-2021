<html>
<head>
<title>RudderStack JavaScript SDK Enhancements: Beacon Support</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RudderStack JavaScript SDK增强:信标支持</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/rudderstack-javascript-sdk-enhancements-beacon-support-afadecbba609?source=collection_archive---------21-----------------------#2021-07-01">https://javascript.plainenglish.io/rudderstack-javascript-sdk-enhancements-beacon-support-afadecbba609?source=collection_archive---------21-----------------------#2021-07-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4b24e42286673909283cba2eaef41166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*djamxLkIrdFfI39lvsEDkg.png"/></div></div></figure><p id="f1b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">T4的核心是提供有保证的事件交付。这方面的主要挑战是跟踪服务器上的事件数据和网络故障、页面卸载等。这篇文章将讨论我们对JS SDK的最新增强——增加了信标支持，使它更加高效、快速和易于使用。</p><h1 id="4721" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">我们用来缓解跟踪事件数据挑战的不同机制。</h1><p id="76f5" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">直到最近，我们才支持使用带有持久队列的<code class="fe lx ly lz ma b">XMLHttpRequest</code>向服务器发送事件数据。每当SDK接收到一个事件时，它会将其卸载到队列中并立即返回。队列不断提取事件数据，并使用<code class="fe lx ly lz ma b">XMLHttpRequest</code>将其发送给服务器。</p><p id="513a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了与其他流行的事件跟踪标签保持同步，我们增强了SDK，以支持使用浏览器<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon" rel="noopener ugc nofollow" target="_blank"> Beacon API </a>发送事件数据。我们现在增加了对使用<code class="fe lx ly lz ma b">the navigator.sendBeacon</code>浏览器实用程序发送事件有效负载的支持，它通过HTTP异步发送少量数据到RudderStack服务器。</p><h1 id="b6c1" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用Beacon API的利与弊</h1><h1 id="5260" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">赞成的意见</h1><ul class=""><li id="2011" class="mb mc in jx b jy ls kc lt kg md kk me ko mf ks mg mh mi mj bi translated">与fetch和<code class="fe lx ly lz ma b">XMLHttpRequest</code>相比，它有很多优点，比如当浏览器不太忙时，它可以作为一个更高性能的信标队列来处理发送事件，等等。</li><li id="6574" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">我们的SDK将事件数据作为JSON发送，这允许在信标部分进行CORS优化。</li><li id="0cbc" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">与其他事件发送机制相比，插入代码更少，导致SDK的编译时间更少。我们想进一步删除我们的持久队列，以进一步减少SDK的大小，但由于下面提到的限制，我们仍在使用它；我们可以称之为包装队列。</li></ul><h1 id="c925" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">骗局</h1><ul class=""><li id="a053" class="mb mc in jx b jy ls kc lt kg md kk me ko mf ks mg mh mi mj bi translated">信标请求不可能重试失败的事件，因为它不支持获取响应代码。</li><li id="fa57" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">信标请求有大小限制。</li><li id="3d7a" class="mb mc in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">信标队列可能会变满(与上面的第2点相关)。我们希望我们的SDK支持为这个场景发送事件。当我们无法将事件数据推送到信标队列时，我们保留我们的持久队列进行重试，将这样的失败事件推送到信标队列。一旦一些事件被发送到服务器，信标可以接受更多的事件。对于通过我们的SDK每秒跟踪的事件数超过Beacon出列数的站点，这是必需的。</li></ul><p id="0533" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">与<strong class="jx io"> XHR仪器</strong>相比，将事件推入信标队列的速度更快。您可能会在JavaScript SDK中看到一些性能改进。</p><p id="6372" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">信标请求得到了优化，因为浏览器会等到CPU负载降低或网络空闲时再发出实际请求。这可以带来更好的网站性能。</p><p id="0e26" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们的<a class="ae kt" href="https://docs.rudderstack.com/rudderstack-sdk-integration-guides/rudderstack-javascript-sdk/javascript-sdk-enhancements#why-use-sendbeacon-to-send-your-event-payload" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于其他JavaScript SDK增强的内容。</p><h1 id="a9ab" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">免费注册并开始发送数据</h1><p id="e361" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">测试我们的事件流、ELT和反向ETL管道。使用我们的HTTP源在不到5分钟的时间内发送数据，或者在您的网站或应用程序中安装我们12个SDK中的一个。<a class="ae kt" href="https://app.rudderlabs.com/signup?type=freetrial" rel="noopener ugc nofollow" target="_blank">上手</a>。</p><p id="76b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本博客最初发布于:<br/><a class="ae kt" href="https://rudderstack.com/blog/rudderstack-javascript-sdk-enhancements-beacon-support" rel="noopener ugc nofollow" target="_blank">https://rudder stack . com/blog/rudder stack-JavaScript-SDK-enhancements-beacon-support</a></p><p id="bdf8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mp">更多内容请看</em><a class="ae kt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mp">plain English . io</em></strong></a></p></div></div>    
</body>
</html>