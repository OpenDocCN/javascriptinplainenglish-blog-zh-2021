<html>
<head>
<title>I Stuffed TensorFlow.js Into a React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我把TensorFlow.js塞进了一个React应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/i-stuffed-tensorflow-js-into-a-react-app-3fd8678019f5?source=collection_archive---------5-----------------------#2021-07-24">https://javascript.plainenglish.io/i-stuffed-tensorflow-js-into-a-react-app-3fd8678019f5?source=collection_archive---------5-----------------------#2021-07-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4198" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">以下是我对网络工作者的了解。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4ff5a9ff47304148521b8ea4fc4d6f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YzW0WRoEe0n0gnXXWU_16g.png"/></div></div></figure><p id="563f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">项目源代码在底部。<br/><a class="ae lk" href="https://autoyeai.com/" rel="noopener ugc nofollow" target="_blank">https://autoyeai.com/</a></p><p id="1347" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我在道明银行的创新实验室工作时，我经常发现自己需要理解大数据。时间序列预测、图形遍历、图像分类，应有尽有。这些工具中的大多数都可以作为Python软件开发工具包使用，或者你需要将你的AI模型从以Python为中心的技术栈转换为iOS或Android原生模型。出于概念验证或用户测试的目的，在AWS上制作和部署一个快速Flask API来托管模型通常更有效。</p><p id="8897" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">但是如果我不想要后端或数据库的开销呢？我想到了一个项目的想法，这个项目正好需要:张量流模型的全JS实现。</p><p id="1dd7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我不想在这个项目中使用计算服务器的主要原因是:</p><ol class=""><li id="f962" class="ll lm in kq b kr ks ku kv kx ln lb lo lf lp lj lq lr ls lt bi translated">数据是静态的。没有网络事件。唯一的输入是一个模型的种子，我可以使用一个干净的源文本数据源提前训练它。</li><li id="4765" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">这是我免费分享的一个玩具。如果项目不是一个实际的业务，我不想有GPU云计算服务器或长期运行的无服务器功能的开销成本。</li><li id="5b53" class="ll lm in kq b kr lu ku lv kx lw lb lx lf ly lj lq lr ls lt bi translated">在测试期间，运行在Python上的TensorFlow/Keras模型比TensorFlow.js版本的训练迭代次数少得多，但产生200个字符的结果的实际时间同样缓慢。基于上一点，对结果质量的影响是最小的…至少以我对NLP和构建ML模型的了解。</li></ol><p id="6ce0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有了这些，我训练了我的模型，并将其转换为tensor-flow.js (tfjs)格式，并在我的React web应用程序界面中进行了测试。</p><p id="a885" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我对AutoYeAi.com项目的解决方案是使用LSTM模型，这需要使用先前的结果渲染多个帧。它平衡了可预测性和随机性，为非结构化文本产生良好的结果。一个伟大的MVP让抒情一代工作。问题是每一帧都需要一段时间来渲染。在我的例子中，每个tfjs帧是一个字母，执行时间是累加的。</p><p id="b621" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">毫不奇怪，具有繁重计算的长时间运行的任务锁定了javascript事件循环。在速度较慢的设备上，这种情况更加明显，很容易导致网络浏览器崩溃。javascript在web浏览器中的单线程特性显示了它的局限性。Chrome会抛出错误5或6(本质上是恐慌错误)，检查器会崩溃，窗口会崩溃。一切都崩溃了。甚至不要让我开始担心移动web浏览器会因为沉重的tfjs负载而崩溃。</p><p id="fc06" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">显然，我需要更多的CPU线程，这样用户界面才不会锁定。</p><h2 id="f579" class="lz ma in bd mb mc md dn me mf mg dp mh kx mi mj mk lb ml mm mn lf mo mp mq mr bi translated">解决方案:网络工作者！</h2><p id="37d4" class="pw-post-body-paragraph ko kp in kq b kr ms jo kt ku mt jr kw kx mu kz la lb mv ld le lf mw lh li lj ig bi translated">Web Workers允许您拥有一个无头浏览器选项卡(本质上是一个看不见的选项卡)，它可以访问自己的CPU资源。</p><p id="39e2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您在根文件夹中添加一个新的javascript文件，在我的例子中是tfworker.js，然后向其中发送和发布事件。如果您曾经做过浏览器扩展，那么工作流类似于options.js、background.js和主内容页面之间的通信。它需要对基于动作调度器和事件监听器的系统进行重构，但是我得到了额外的线程！</p><p id="0b91" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里有一个陷阱。新的javascript文件需要成为新的web包入口点，因为web工作者不能导入其他javascript包。幸运的是，<a class="ae lk" href="https://www.npmjs.com/package/worker-plugin" rel="noopener ugc nofollow" target="_blank">谷歌有一个很棒的包</a>可以让这变得更容易。另一个包，<a class="ae lk" href="https://github.com/timarney/react-app-rewired" rel="noopener ugc nofollow" target="_blank"> react-app-rewired </a>，让我在不牺牲伟大的create-react-app默认设置的情况下修改webpack配置。</p><p id="a8b6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这解决了我的线程问题，但仍会偶尔导致网络浏览器崩溃。工作线程将被锁定，并且在主选项卡关闭后它的执行将持续，这使得开发变得乏味。除了更多的代码优化，主要的解决方法是禁用UI输入，以防止多个张量流执行队列的建立。另一个解决方案是将整首歌曲生成的默认字符数量减少到几个小节，以供低端设备使用。生成的大量张量流帧将导致廉价Android手机更加不稳定。</p><p id="eabe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">说来奇怪，我的iPad比我的MacBook Pro快。</p><p id="a8a1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下一次，当您准备用JS进行大规模计算时，请让Web工作者尝试一下！这可能比部署web服务器更好。</p><p id="45e9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">看AutoYe在行动:【https://autoyeai.com/ T4】</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/0db71f38cb1e8c36216ea8037a970e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMkOmJyGQkJnZ7UAFCSBTA.jpeg"/></div></div></figure><h1 id="e1b9" class="my ma in bd mb mz na nb me nc nd ne mh jt nf ju mk jw ng jx mn jz nh ka mq ni bi translated">资源</h1><h2 id="7425" class="lz ma in bd mb mc md dn me mf mg dp mh kx mi mj mk lb ml mm mn lf mo mp mq mr bi translated">源代码:</h2><div class="nj nk gp gr nl nm"><a href="https://github.com/FrankFlitton/autoyeai.com" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd io gy z fp nr fr fs ns fu fw im bi translated">GitHub-FrankFlitton/auto yeai . com:tensorflowJS Kanye West歌词生成器和数据摄取…</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">tensorflowJS Kanye West歌词生成器和数据摄取管道。-GitHub-frank flitton/auto yeai . com:A…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">github.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa km nm"/></div></div></a></div><p id="233b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">网络工作者插件:<a class="ae lk" href="https://www.npmjs.com/package/worker-plugin" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/worker-plugin</a><br/>React-app-rewired包:<a class="ae lk" href="https://github.com/timarney/react-app-rewired" rel="noopener ugc nofollow" target="_blank">https://github.com/timarney/react-app-rewired</a></p><p id="548b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="ob">更多内容请看</em><a class="ae lk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="ob">plain English . io</em></strong></a></p></div></div>    
</body>
</html>