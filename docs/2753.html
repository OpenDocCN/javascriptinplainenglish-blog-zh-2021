<html>
<head>
<title>Add Support for Reduced Motion in Angular Animations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">添加对角度动画中减少运动的支持</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-support-for-reduced-motion-in-angular-animations-6095c345a956?source=collection_archive---------13-----------------------#2021-06-05">https://javascript.plainenglish.io/add-support-for-reduced-motion-in-angular-animations-6095c345a956?source=collection_archive---------13-----------------------#2021-06-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e81d90fa166488117ec672ac11f640d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0oxZq3SE349Jlx2m.jpeg"/></div></div></figure><p id="fd89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将了解为什么需要减少运动支持。我们还将了解媒体查询及其各种用法。最后，我们将看到如何禁用角度动画。</p><p id="708d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你只是对主要代码感兴趣，去<a class="ae kt" href="https://indepth.dev/posts/1436/add-support-for-reduced-motion-in-angular-animations#a-service-to-disable-animations" rel="noopener ugc nofollow" target="_blank">禁用动画</a>。在那里，我们将创建一个服务，它将帮助我们识别用户对减少运动的偏好。或者直接看一下<a class="ae kt" href="https://github.com/shhdharmen/indepth-ng-reduced-motion" rel="noopener ugc nofollow" target="_blank">代码</a>。</p><h1 id="5f91" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">动画</h1><p id="6672" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">动画可以用在各种网页上。通常，它们用于向用户提供反馈，以表明某个操作已被接收并正在处理。它可以是用户滚动时出现的小动画，也可以是展示新产品的有弹性的动画。我们通常会在大多数网页上看到横幅和公告的自上而下的动画。</p><p id="d325" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但并不是每个人都喜欢动画，也有晕船或前庭运动障碍的人。禁用或减少动画是一项重要的辅助功能。幸运的是，CSS media query‘prefers-reduced-motion’帮助开发者服务于这类用户。</p><h2 id="b992" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">偏好-减少运动</h2><p id="9a26" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated"><code class="fe mj mk ml mm b">prefers-reduced-motion</code>媒体查询检测用户是否已经请求操作系统最小化它使用的动画或运动的数量。</p><p id="f584" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它可以取两个值:</p><p id="9ed6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">无偏好— </strong>表示系统不知道用户的偏好。该关键字值在<a class="ae kt" href="https://drafts.csswg.org/mediaqueries-5/#boolean-context" rel="noopener ugc nofollow" target="_blank">布尔上下文</a>中被评估为假。</p><p id="67ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">减少— </strong>表示用户已经通知系统，他们更喜欢最小化移动或动画量的界面，最好是移除所有不必要的移动。</p><blockquote class="mn mo mp"><p id="4c9c" class="jv jw mq jx b jy jz ka kb kc kd ke kf mr kh ki kj ms kl km kn mt kp kq kr ks ig bi translated"><em class="in">此媒体查询仍在</em> <a class="ae kt" href="https://drafts.csswg.org/mediaqueries-5/#descdef-media-prefers-reduced-motion" rel="noopener ugc nofollow" target="_blank"> <em class="in">媒体查询第五级</em> </a> <em class="in">的草稿中，但大多数</em> <a class="ae kt" href="https://caniuse.com/prefers-reduced-motion" rel="noopener ugc nofollow" target="_blank"> <em class="in">最新浏览器今天都支持</em> </a> <em class="in">了。</em></p></blockquote><h2 id="2aee" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">与CSS一起使用</h2><p id="07bf" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">对于CSS，您可以简单地使用它，如下所示:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="029b" class="lx kv in mm b gy nc nd l ne nf">/*<br/>  If the user has expressed their preference for<br/>  reduced motion, then don't use animations on loader.<br/>*/<br/><a class="ae kt" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@media</a> (prefers-reduced-motion: reduce) {<br/>  .loader {<br/>    animation: none;<br/>  }<br/>}</span><span id="219f" class="lx kv in mm b gy ng nd l ne nf">/*<br/>  If the browser understands the media query and the user<br/>  explicitly hasn't set a preference, then use animations on loaders.<br/>*/<br/><a class="ae kt" href="http://twitter.com/media" rel="noopener ugc nofollow" target="_blank">@media</a> (prefers-reduced-motion: no-preference) {<br/>  .loader {<br/>    /* `spin` keyframes are defined elsewhere */<br/>    animation: spin 0.5s linear infinite both;<br/>  }<br/>}</span></pre><p id="5c91" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一种方法是将所有动画放在一个单独的文件中，并通过带有“link”元素的“media”属性有条件地加载它:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="e643" class="lx kv in mm b gy nc nd l ne nf">&lt;link rel="stylesheet" href="animations.css" media="(prefers-reduced-motion: no-preference)"&gt;</span></pre><h2 id="83ee" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">JavaScript的用法</h2><p id="5dc4" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">当首选项改变时，浏览器将动态处理CSS规则。但是使用JavaScript，我们将不得不监听变化并以编程方式处理动画。</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="5de8" class="lx kv in mm b gy nc nd l ne nf">const mediaQuery = window.matchMedia('(prefers-reduced-motion: reduce)');<br/>mediaQuery.addEventListener('change', () =&gt; {<br/>  console.log(mediaQuery.media, mediaQuery.matches);<br/>  // Stop JavaScript-based animations.<br/>});</span></pre><p id="9b9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看上面的方法如何帮助我们制作有角度的动画。</p><h1 id="7ee9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">角度动画</h1><p id="0a84" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">Angular的动画系统是建立在CSS功能的基础上的，这意味着你可以动画化浏览器认为可以动画化的任何属性。如果你是第一次使用角度动画，我会推荐你阅读由<a class="ae kt" href="https://twitter.com/williamjuan27?lang=en" rel="noopener ugc nofollow" target="_blank">@ William Juan 27</a>:<a class="ae kt" href="https://indepth.dev/posts/1285/in-depth-guide-into-animations-in-angular" rel="noopener ugc nofollow" target="_blank">Angular-Angular Depth</a>的动画深度指南的文章。</p><p id="9f16" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将创建一个服务，它将有一个可观察的<code class="fe mj mk ml mm b">prefers-reduced-motion</code>媒体查询。然后，我们可以在组件中使用它来禁用动画。</p><p id="5b43" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用的是Angular CLI，您可以使用以下命令快速创建服务:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="9106" class="lx kv in mm b gy nc nd l ne nf">ng g s core/services/media-match</span></pre><p id="6a64" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们修改<em class="mq"> media-match.service.ts </em>的内容:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="74d9" class="lx kv in mm b gy nc nd l ne nf">// src/app/core/services/media-match.service.ts</span><span id="ca69" class="lx kv in mm b gy ng nd l ne nf">import { Injectable } from '<a class="ae kt" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>';<br/>import { BehaviorSubject, Observable } from 'rxjs';</span><span id="7901" class="lx kv in mm b gy ng nd l ne nf">// types<br/>export interface MediaQueriesMap {<br/>  _type: MediaQueryType;<br/>  _query: string;<br/>}</span><span id="5e2d" class="lx kv in mm b gy ng nd l ne nf">export type MediaQueryType = 'prefers-reduced-motion';</span><span id="c706" class="lx kv in mm b gy ng nd l ne nf">// media queries list<br/>export const MEDIA_QUERIES: MediaQueriesMap[] = [<br/>  {<br/>    _type: 'prefers-reduced-motion',<br/>    _query: '(prefers-reduced-motion: reduce)',<br/>  },<br/>];</span><span id="8469" class="lx kv in mm b gy ng nd l ne nf"><a class="ae kt" href="http://twitter.com/Injectable" rel="noopener ugc nofollow" target="_blank">@Injectable</a>({ providedIn: 'root' })<br/>export class MediaMatchService {<br/>  private _mediaQueryListeners!: {<br/>    [key in MediaQueryType]: BehaviorSubject&lt;boolean&gt;;<br/>  };<br/>  public mediaQueryListeners$!: {<br/>    [key in MediaQueryType]: Observable&lt;boolean&gt;;<br/>  };</span><span id="57b4" class="lx kv in mm b gy ng nd l ne nf">constructor() {<br/>    MEDIA_QUERIES.forEach((mq) =&gt; this.matchMedia(mq));<br/>  }</span><span id="6efd" class="lx kv in mm b gy ng nd l ne nf">private matchMedia(mq: MediaQueriesMap) {<br/>    this._mediaQueryListeners = {<br/>      ...this._mediaQueryListeners,<br/>      [mq._type]: new BehaviorSubject&lt;boolean&gt;(false),<br/>    };</span><span id="a42c" class="lx kv in mm b gy ng nd l ne nf">this.mediaQueryListeners$ = {<br/>      ...this.mediaQueryListeners$,<br/>      [mq._type]: this._mediaQueryListeners[mq._type].asObservable(),<br/>    };</span><span id="6533" class="lx kv in mm b gy ng nd l ne nf">const mediaQueryList = window.matchMedia(mq._query);</span><span id="21ae" class="lx kv in mm b gy ng nd l ne nf">this._mediaQueryListeners[mq._type].next(mediaQueryList.matches);</span><span id="3435" class="lx kv in mm b gy ng nd l ne nf">mediaQueryList.addEventListener('change', (ev: MediaQueryListEvent) =&gt; {<br/>      this._mediaQueryListeners[mq._type].next(ev.matches);<br/>    });<br/>  }<br/>}</span></pre><p id="e0e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是上面代码的情况:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="51d2" class="lx kv in mm b gy nc nd l ne nf">export const MEDIA_QUERIES: MediaQueriesMap[] = [<br/>  {<br/>    _type: 'prefers-reduced-motion',<br/>    _query: '(prefers-reduced-motion: reduce)',<br/>  },<br/>];</span></pre><p id="35f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们定义一个常数，它包含一组媒体查询类型及其实际查询。</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="1842" class="lx kv in mm b gy nc nd l ne nf">private _mediaQueryListeners!: {<br/>    [key in MediaQueryType]: BehaviorSubject&lt;boolean&gt;;<br/>  };</span></pre><p id="65c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">其次，我们将创建一个JSON对象，它将包含每种媒体查询类型的主题。它会根据<code class="fe mj mk ml mm b"><a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaQueryList/matches" rel="noopener ugc nofollow" target="_blank">MediaQueryList.matches</a></code>发出<code class="fe mj mk ml mm b">true</code>或<code class="fe mj mk ml mm b">false</code>。</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="27dc" class="lx kv in mm b gy nc nd l ne nf">public mediaQueryListeners$!: {<br/>    [key in MediaQueryType]: Observable&lt;boolean&gt;;<br/>  };</span></pre><p id="4088" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第三，我们正在创建observables的JSON，它将基于我们之前创建的主题。该服务的消费者将使用该属性。</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="f1e1" class="lx kv in mm b gy nc nd l ne nf">constructor() {<br/>    MEDIA_QUERIES.forEach((mq) =&gt; this.matchMedia(mq));<br/>  }</span></pre><p id="58ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第四，我们通过为每组<code class="fe mj mk ml mm b">MEDIA_QUERIES</code>常量调用一个方法<code class="fe mj mk ml mm b">matchMedia</code>来构建前面的两个JSON属性。</p><p id="04fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们看看方法<code class="fe mj mk ml mm b">matchMedia</code>:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="521f" class="lx kv in mm b gy nc nd l ne nf">private matchMedia(mq: MediaQueriesMap) {<br/>    this._mediaQueryListeners = {<br/>      ...this._mediaQueryListeners,<br/>      [mq._type]: new BehaviorSubject&lt;boolean&gt;(false),<br/>    };</span><span id="ac36" class="lx kv in mm b gy ng nd l ne nf">this.mediaQueryListeners$ = {<br/>      ...this.mediaQueryListeners$,<br/>      [mq._type]: this._mediaQueryListeners[mq._type].asObservable(),<br/>    };<br/>  }</span></pre><p id="738f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该方法采用一个参数<code class="fe mj mk ml mm b">mq: MediaQueriesMap</code>，它是一组媒体查询类型(` _type `)和实际查询(` _query `)。首先，它通过为新的<code class="fe mj mk ml mm b">_type</code>添加一个主题来更新现有的主题JSON。然后使用同一个主题，为同一个<code class="fe mj mk ml mm b">_type</code>更新可观察对象的JSON。</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="78dc" class="lx kv in mm b gy nc nd l ne nf">private matchMedia(mq: MediaQueriesMap) {<br/>    // ...</span><span id="b766" class="lx kv in mm b gy ng nd l ne nf">const mediaQueryList = window.matchMedia(mq._query);</span><span id="a5ea" class="lx kv in mm b gy ng nd l ne nf">this._mediaQueryListeners[mq._type].next(mediaQueryList.matches);</span><span id="5630" class="lx kv in mm b gy ng nd l ne nf">mediaQueryList.addEventListener('change', (ev: MediaQueryListEvent) =&gt; {<br/>      this._mediaQueryListeners[mq._type].next(ev.matches);<br/>    });<br/>  }</span></pre><p id="8a3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">更新完主题和观察对象后，就该得到查询结果了。上面的代码非常清晰简单。</p><p id="1b7f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意，我们甚至在监听<code class="fe mj mk ml mm b">change</code>事件之前就发出了<code class="fe mj mk ml mm b">mediaQueryList.matches</code>的结果。背后的原因是让初始值从服务中发出。如果我们不这样做，只是简单地倾听变化，可能会发生这样的情况，用户在访问应用程序时已经将<code class="fe mj mk ml mm b">reduced</code>设置为他们的运动偏好，但我们的应用程序仍将继续显示动画。</p><p id="8672" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">保存主题/观察对象的JSON的一个好处是你可以添加更多的媒体查询。例如，您想创建一个媒体查询来检查横向方向，您可以这样做:</p><p id="61b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">1.在<code class="fe mj mk ml mm b">MediaQueryType</code>中添加类型，因此它将变成:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="1e06" class="lx kv in mm b gy nc nd l ne nf">export type MediaQueryType = 'prefers-reduced-motion' | 'orientation-landscape';</span></pre><p id="5759" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.在<code class="fe mj mk ml mm b">MEDIA_QUERIES</code>中添加实际查询:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="2274" class="lx kv in mm b gy nc nd l ne nf">export const MEDIA_QUERIES: MediaQueriesMap[] = [<br/>  {<br/>    _type: 'prefers-reduced-motion',<br/>    _query: '(prefers-reduced-motion: reduce)',<br/>  },<br/>  {<br/>    _type: 'orientation-landscape',<br/>    _query: '(orientation:landscape)',<br/>  },<br/>];</span></pre><p id="d837" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.并在您的组件中使用它:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="fc1b" class="lx kv in mm b gy nc nd l ne nf">public orientationLandscape$ = this.mediaMatch.mediaQueryListeners$['orientation-landscape'];</span></pre><h2 id="41da" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">带动画的应用</h2><p id="7d60" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">为了在angular中启用动画，我们需要在根模块中导入<code class="fe mj mk ml mm b"><a class="ae kt" href="https://angular.io/api/platform-browser/animations/BrowserAnimationsModule" rel="noopener ugc nofollow" target="_blank">BrowserAnimationsModule</a></code>。</p><p id="fc27" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我已经创建了一个应用程序，它有一个基本的用户界面，并设置了动画和服务。你可以在<a class="ae kt" href="https://github.com/shhdharmen/indepth-ng-reduced-motion" rel="noopener ugc nofollow" target="_blank"> GitHub Repo </a>上查看代码。</p><p id="393f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们用动画来看看应用程序的输出:</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/da58b301df3819550a22f8de6285d584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*1CILvS99hA5vhy8F"/></div></figure><h2 id="e5aa" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">带有禁用动画的应用程序</h2><p id="37b9" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">要禁用动画，首先，我们将使用<em class="mq">src/app/app . component . ts:</em>中的服务<code class="fe mj mk ml mm b">MediaMatchService</code></p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="f261" class="lx kv in mm b gy nc nd l ne nf">// src/app/app.component.ts</span><span id="f421" class="lx kv in mm b gy ng nd l ne nf">// ...</span><span id="c8b9" class="lx kv in mm b gy ng nd l ne nf">export class AppComponent implements OnInit, OnDestroy {<br/>//...</span><span id="4473" class="lx kv in mm b gy ng nd l ne nf">disableAnimations$ = this.mediaMatch.mediaQueryListeners$['prefers-reduced-motion'];</span><span id="ba90" class="lx kv in mm b gy ng nd l ne nf">constructor(<br/>    private mediaMatch: MediaMatchService<br/>  ) {}</span><span id="da33" class="lx kv in mm b gy ng nd l ne nf">// ...<br/>}</span></pre><p id="052c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，可以在HTML元素上放置一个名为的特殊动画控件绑定，以禁用该元素以及任何嵌套元素上的动画。为真时，<code class="fe mj mk ml mm b">@.disabled</code>绑定阻止所有动画渲染。</p><p id="43de" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们把它放到<em class="mq">src/app/app . component . html</em>里吧:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="dd63" class="lx kv in mm b gy nc nd l ne nf">&lt;!-- src/app/app.component.html --&gt;</span><span id="20d4" class="lx kv in mm b gy ng nd l ne nf">&lt;div class="container" [@.disabled]="disableAnimations$ | async"&gt;<br/>  &lt;!-- rest remains same --&gt;<br/>&lt;/div&gt;</span></pre><p id="55cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们看看我们的应用程序在使用<code class="fe mj mk ml mm b">reduced</code>动作渲染时的样子:</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/69e12bd6d1b09d9cf908e3576213c19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/0*11CyoADBfrDj-j8T"/></div></figure><p id="d73a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如你所看到的，现在它不能用动画来渲染应用程序。</p><h2 id="2109" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">NoopAnimationsModule</h2><p id="87aa" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我们也可以使用<code class="fe mj mk ml mm b"><a class="ae kt" href="https://angular.io/api/platform-browser/animations/NoopAnimationsModule" rel="noopener ugc nofollow" target="_blank">NoopAnimationsModule</a></code>来禁用特定模块的角度动画。不要用<code class="fe mj mk ml mm b">BrowserAnimationsModule</code>直接导入就好了。</p><p id="3432" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是<code class="fe mj mk ml mm b">prefers-reduced-motion</code>提供了更多的灵活性，因为它允许非常容易地根据用户偏好加载动画。</p><h2 id="ff2b" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">从用户界面控制动画</h2><p id="9836" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果你不想使用<code class="fe mj mk ml mm b">prefers-reduced-motion</code>查询，你可以集成一些控件，像开关或复选框，这将允许用户禁用或启用动画运行时。</p><p id="13c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Netlify的<a class="ae kt" href="https://million-devs.netlify.com/" rel="noopener ugc nofollow" target="_blank"> Netlify达到一百万开发者！网站是这种方法的一个很好的例子，他们在左上角增加了一个开关来控制动画。</a></p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/5048a6d0d59bef166052d7187d81edde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zCDOrFLJZvjQCqWJ"/></div></div></figure><p id="4ec3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是，建议通过媒体查询禁用动画，因为它更容易访问，并使用户不必执行额外的操作。</p><h2 id="5503" class="lx kv in bd kw ly lz dn la ma mb dp le kg mc md li kk me mf lm ko mg mh lq mi bi translated">角度v12</h2><p id="1a56" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">Angular团队正致力于通过<code class="fe mj mk ml mm b">BrowserAnimationsModule.withConfig</code>增加一个特性来支持禁用动画。这在<a class="ae kt" href="https://github.com/angular/angular/blob/master/CHANGELOG.md#1200-next3-2021-03-03" rel="noopener ugc nofollow" target="_blank"> v12.0.0-next.3 </a>中已经可用:</p><pre class="mu mv mw mx gt my mm mz na aw nb bi"><span id="26a0" class="lx kv in mm b gy nc nd l ne nf">import { NgModule } from "<a class="ae kt" href="http://twitter.com/angular/core" rel="noopener ugc nofollow" target="_blank">@angular/core</a>";<br/>import { BrowserAnimationsModule } from "<a class="ae kt" href="http://twitter.com/angular/platform-browser" rel="noopener ugc nofollow" target="_blank">@angular/platform-browser</a>/animations";<br/>import { AppComponent } from "./app.component";</span><span id="b6f5" class="lx kv in mm b gy ng nd l ne nf">export function prefersReducedMotion(): boolean {<br/>  const mediaQueryList = window.matchMedia("(prefers-reduced-motion)");</span><span id="7c37" class="lx kv in mm b gy ng nd l ne nf">return mediaQueryList.matches;<br/>}</span><span id="d37d" class="lx kv in mm b gy ng nd l ne nf"><a class="ae kt" href="http://twitter.com/NgModule" rel="noopener ugc nofollow" target="_blank">@NgModule</a>({<br/>  imports: [<br/>    BrowserAnimationsModule.withConfig({<br/>      disableAnimations: prefersReducedMotion()<br/>    })<br/>  ],<br/>  declarations: [AppComponent],<br/>  bootstrap: [AppComponent]<br/>})<br/>export class AppModule {}</span></pre><h1 id="0efc" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="9aca" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我们看到了<code class="fe mj mk ml mm b">prefers-reduced-motion</code>媒体查询的用法，它的重要性，以及它如何帮助我们禁用angular中的动画。我们还看到了其他一些禁用它们的方法，但是推荐使用媒体查询。</p><p id="4530" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">而在v12中，你可以简单地使用<code class="fe mj mk ml mm b">BrowserAnimationsModule.withConfig</code>来禁用动画。</p><p id="ddf6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我为我们上面做的所有代码创建了一个GitHub repo。</p><p id="39ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">延伸阅读</strong></p><ul class=""><li id="86c1" class="nk nl in jx b jy jz kc kd kg nm kk nn ko no ks np nq nr ns bi translated"><a class="ae kt" href="https://web.dev/prefers-reduced-motion/" rel="noopener ugc nofollow" target="_blank">偏好减少运动:有时运动越少越好</a></li><li id="e69b" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><a class="ae kt" href="https://indepth.dev/posts/1285/in-depth-guide-into-animations-in-angular" rel="noopener ugc nofollow" target="_blank">角度动画深度指南</a></li><li id="115f" class="nk nl in jx b jy nt kc nu kg nv kk nw ko nx ks np nq nr ns bi translated"><a class="ae kt" href="https://dev.to/this-is-angular/disabling-angular-animations-at-runtime-9a6" rel="noopener ugc nofollow" target="_blank">运行时禁用角度动画—开发社区👩‍💻👨‍💻</a></li></ul></div><div class="ab cl ny nz hr oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ig ih ii ij ik"><p id="62e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mq">原载于</em><a class="ae kt" href="https://indepth.dev/posts/1436/add-support-for-reduced-motion-in-angular-animations" rel="noopener ugc nofollow" target="_blank"><em class="mq">https://indepth . dev</em></a><em class="mq">。</em></p><p id="aa44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mq">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mq">plain English . io</em></a></p></div></div>    
</body>
</html>