<html>
<head>
<title>Pre-Production Checklist for Next.js Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js应用程序的生产前清单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/pre-production-checklist-for-next-js-applications-893035e350f5?source=collection_archive---------3-----------------------#2021-12-13">https://javascript.plainenglish.io/pre-production-checklist-for-next-js-applications-893035e350f5?source=collection_archive---------3-----------------------#2021-12-13</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="e7d6" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">在投入生产之前，检查这些性能优化</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/1cf157871fe63880c8094978db356e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VieArWxssJeys1slZxQgQg.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://www.pexels.com/@photosbymishra?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Sourav Mishra</a> from <a class="ae kw" href="https://www.pexels.com/photo/grey-coupe-on-road-3136673/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="b9f7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is"> Next.js </strong>是已经执行的React的扩展。我们使用这个令人敬畏的框架来创建面向公众的应用程序。</p><p id="16f6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是我们经常不能充分利用Next.js应用程序的潜力。今天，我们将看到一些优化，您可以在投入生产之前对应用程序实施这些优化。</p><p id="bc38" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们开始吧。</p><h1 id="f9cf" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">基于路由的代码拆分</h1><p id="ce55" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">当您使用create-next-app设置应用程序时，您的应用程序会自动根据您的应用程序的路线进行默认代码拆分。</p><p id="45f7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">所以当我们使用<code class="fe mq mr ms mt b">create-next-app</code>创建一个新的Next.js项目时</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="16e3" class="my lu ir mt b gz mz na l nb nc">npx create-next-app my-app</span></pre><p id="b957" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">它创建了一个名为<code class="fe mq mr ms mt b">/pages</code>的文件夹，您可以在其中使用声明性路由构建页面。所以让我们在<code class="fe mq mr ms mt b">/pages</code>下创建两个文件</p><p id="8f46" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe mq mr ms mt b">/pages/home.jsx</code>-&gt;-<code class="fe mq mr ms mt b">http:localhost:3000/home</code></p><p id="d00f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe mq mr ms mt b">/pages/about.jsx</code>-&gt;-<code class="fe mq mr ms mt b">http:localhost:3000/about</code></p><p id="f08c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，当你加载你的应用程序时，只有当你转到<code class="fe mq mr ms mt b">http:localhost:3000/home</code>时，才会加载<code class="fe mq mr ms mt b">home.jsx</code>的代码。因此，当任何用户访问您的应用程序的主页时，只会发送相关的javascript。</p><p id="e20a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，这是Next.js为我们提供的默认的巨大性能优势。但是我们可以做得更好！</p><h1 id="2580" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">组件代码拆分</h1><p id="0a73" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">通过动态导入应用程序的组件，可以进一步最小化初始页面大小。</p><p id="43ae" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">假设在你的<code class="fe mq mr ms mt b">home.jsx</code>里面有另一个组件。通常你要做的是</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="5b9f" class="my lu ir mt b gz mz na l nb nc"><strong class="mt is">import</strong> AnotherComponent <strong class="mt is">from</strong> '../components/AnotherComponent.jsx';</span></pre><p id="529d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后在组件内部使用它</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="6f7f" class="my lu ir mt b gz mz na l nb nc">export function HomePage () {</span><span id="3685" class="my lu ir mt b gz nd na l nb nc"> return &lt;div&gt;</span><span id="feba" class="my lu ir mt b gz nd na l nb nc">   ... other components</span><span id="1058" class="my lu ir mt b gz nd na l nb nc">    &lt;AnotherComponent /&gt;</span><span id="cde3" class="my lu ir mt b gz nd na l nb nc">  &lt;/div&gt;</span><span id="fef0" class="my lu ir mt b gz nd na l nb nc">}</span></pre><p id="80a0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，当你的<code class="fe mq mr ms mt b">HomePage</code>被加载时，你的页面的所有组件立即被加载。它会使组件在完全加载之前没有响应。这对性能是不利的</p><p id="a45a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是随着<code class="fe mq mr ms mt b">dynamic</code>的引入，你现在可以动态地导入组件</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="063e" class="my lu ir mt b gz mz na l nb nc"><strong class="mt is">import</strong> dynamic <strong class="mt is">from</strong> 'next/dynamic';</span><span id="55f6" class="my lu ir mt b gz nd na l nb nc"><strong class="mt is">const</strong> AnotherComponent = dynamic(() <strong class="mt is">=&gt;<br/></strong>       <strong class="mt is">import</strong>('../components/AnotherComponent.jsx'));</span></pre><p id="41a3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，如果使用得当，这可以为您带来巨大的性能提升。</p><h1 id="0443" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">缩小图像尺寸</h1><p id="c48f" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">如果您的应用程序组件提供了大量静态图像，您应该减小图像的大小。</p><p id="8169" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">网上有很多免费的服务可以做到这一点。最好的是<code class="fe mq mr ms mt b">TinyPNG</code></p><div class="ne nf gq gs ng nh"><a href="https://tinypng.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fp"><div class="nj ab nk cl cj nl"><h2 class="bd is gz z fq nm fs ft nn fv fx iq bi translated">TinyPNG -智能压缩WebP、PNG和JPEG图像</h2><div class="no l"><h3 class="bd b gz z fq nm fs ft nn fv fx dk translated">问得好！让我给你一个并排的比较。下面是我表妹的两张照片。左图是…</h3></div><div class="np l"><p class="bd b dl z fq nm fs ft nn fv fx dk translated">tinypng.com</p></div></div><div class="nq l"><div class="nr l ns nt nu nq nv kq nh"/></div></div></a></div><h1 id="5d1a" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">图像的加载</h1><p id="8e27" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">使用image组件的priority属性来指定是否立即加载它。</p><p id="6c38" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">默认情况下，其值设置为false。但是如果你把它设置为true(不是对每个图像)，那么Next.js将尝试预加载图像。这将最终减少FCP的时间(第一次内容丰富的油漆)</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="e2ac" class="my lu ir mt b gz mz na l nb nc">import Image from 'next/image'<br/>.<br/>.<br/>.<br/>&lt;Image priority={true} src={"src-url"}/&gt;</span></pre><p id="f2a8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">仅对文件夹上方的内容执行此操作。</p><h1 id="e8c6" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">固定图像大小</h1><p id="c456" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">图像有两个必需的属性，名为<code class="fe mq mr ms mt b">width</code>和<code class="fe mq mr ms mt b">length</code>，您应该为这两个属性提供值。它们以像素为单位定义。您可以像下面这样做。</p><pre class="kh ki kj kk gu mu mt mv mw aw mx bi"><span id="f3d6" class="my lu ir mt b gz mz na l nb nc">&lt;Image width={450} height={300} src={"src-url"}/&gt;</span></pre><p id="4284" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">图像大小应该固定，以避免CLS(累积布局偏移)。</p><h1 id="29d3" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">优化CSS</h1><p id="f2d3" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">初始加载不需要所有的CSS。也许你使用过像(语义UI或AntD)这样的组件库，但只使用了少数几个组件。您的应用程序仍然会尝试加载这些库的整个CSS。</p><p id="d42c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">对于应用程序来说，这可能是非常昂贵且有害的。</p><p id="c708" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">有一个超级酷的工具可以移除未使用的CSS，使用Next.js非常容易</p><div class="ne nf gq gs ng nh"><a href="https://purgecss.com/guides/next.html" rel="noopener  ugc nofollow" target="_blank"><div class="ni ab fp"><div class="nj ab nk cl cj nl"><h2 class="bd is gz z fq nm fs ft nn fv fx iq bi translated">移除未使用的CSS - PurgeCSS</h2><div class="no l"><h3 class="bd b gz z fq nm fs ft nn fv fx dk translated">Next.js是一个React框架，用于可扩展的生产级应用程序。世界领先的公司使用Next.js来…</h3></div><div class="np l"><p class="bd b dl z fq nm fs ft nn fv fx dk translated">purgecss.com</p></div></div><div class="nq l"><div class="nw l ns nt nu nq nv kq nh"/></div></div></a></div><p id="0f2f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这种优化将减少FCP(第一次内容丰富的油漆)时间，这是一个核心网站的重要因素。</p><h1 id="804f" class="lt lu ir bd lv lw lx ly lz ma mb mc md jx me jy mf ka mg kb mh kd mi ke mj mk bi translated">优化脚本的加载</h1><p id="e8c0" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated">很多时候你不得不在你的应用程序中使用外部脚本。也许它是一个跟踪你的用户的插件，或者是一个像Olark这样的外部聊天服务。</p><p id="52d9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是这些脚本在应用程序的第一次加载中(大多数时候)没有任何用处。</p><p id="c1c4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">例如，只有当用户开始与网站交互时，才需要用户跟踪。为此，您无论如何都需要加载整个页面。</p><p id="758a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">尝试使用Next.js的<code class="fe mq mr ms mt b"><a class="ae kw" href="https://nextjs.org/docs/basic-features/script" rel="noopener ugc nofollow" target="_blank">&lt;Script /&gt;</a></code>标签，并使用lazyOnLoad来优化脚本的加载(而不是默认的<code class="fe mq mr ms mt b">script</code>)。</p><p id="f49d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">根据脚本的重要性指定<code class="fe mq mr ms mt b">strategy</code>属性。可能的值有</p><p id="49d0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe mq mr ms mt b">beforeInteractive</code> - &gt;如果页面交互前需要脚本<br/> <code class="fe mq mr ms mt b">afterInteractive</code> - &gt;页面交互后<br/> <code class="fe mq mr ms mt b">lazyOnLoad</code> - &gt;页面加载后加载脚本。</p></div><div class="ab cl nx ny hv nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ik il im in io"><p id="124c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">给你。为了获得一个超高性能的Next.js应用程序，您可以利用这些特性。</p><p id="120a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">通过</strong><a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is">LinkedIn</strong></a>联系我</p><h2 id="4f07" class="my lu ir bd lv oe of dn lz og oh dp md lg oi oj mf lk ok ol mh lo om on mj oo bi translated">资源:</h2><p id="fc58" class="pw-post-body-paragraph kx ky ir kz b la ml js lc ld mm jv lf lg mn li lj lk mo lm ln lo mp lq lr ls ik bi translated"><strong class="kz is">代码拆分:</strong><a class="ae kw" href="https://web.dev/code-splitting-with-dynamic-imports-in-nextjs/" rel="noopener ugc nofollow" target="_blank">https://web . dev/Code-splitting-with-dynamic-imports-in-nextjs/</a><br/>T5】Image:<a class="ae kw" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank">https://nextjs.org/docs/basic-features/image-optimization</a><strong class="kz is">purge CSS:</strong><a class="ae kw" href="https://purgecss.com/guides/next.html" rel="noopener ugc nofollow" target="_blank">https://purgecss.com/guides/next.html</a></p><p id="fc87" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><em class="op">更多内容请看</em> <a class="ae kw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="op">说白了。报名参加我们的</em> <a class="ae kw" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is"> <em class="op">免费周报在这里</em> </strong> </a> <em class="op">。</em></strong></a></p></div></div>    
</body>
</html>