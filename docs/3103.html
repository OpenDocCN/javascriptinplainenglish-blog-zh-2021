<html>
<head>
<title>Building a gRPC Client and Server with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js构建gRPC客户端和服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-grpc-client-and-server-with-node-js-1722fd46bf28?source=collection_archive---------1-----------------------#2021-06-24">https://javascript.plainenglish.io/building-a-grpc-client-and-server-with-node-js-1722fd46bf28?source=collection_archive---------1-----------------------#2021-06-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a0e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">几个月前，我在做一个项目，在这个项目中，我被要求使用gRPC来获取一些数据。对我来说，是第一次听说这个名词<strong class="jm io"> gRPC。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/d7db6fe90bda97f54fe9e9fe386e983c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*iAOBZm7ywdF6B1l-Oc6rEw.jpeg"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">When in doubt, google !</figcaption></figure><p id="5200" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我联系了一些人，但没有得到多少帮助。我在Googled上搜索了Node.js中的gRPC实现，但是没有找到详细实现的正确来源。</p><p id="a0a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">经过大量的研究，在网上几乎没有资源的情况下，我终于完成了我的工作。</p><p id="36a8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我将分享如何用Node.js设置gRPC服务器和客户机。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ku"><img src="../Images/95d498eff98ef5bc5f1531e8e936c01c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3vOOqMXHUxVtUYQMLuJ3Q.png"/></div></div></figure><h1 id="385d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">gRPC是什么？</h1><p id="06f4" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">gRPC是Google远程过程调用，它只是一个像REST一样获取或发送数据的协议。如果你想了解更多关于gRPC的信息，你可以在这里阅读。我不会谈论使用gRPC相对于REST的好处，反之亦然。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi md"><img src="../Images/dc8cb0489712ed5492a2039084d6d5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_DDr-q_JXfkdWdpKJBF7qA.png"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">Source: <a class="ae mc" href="https://grpc.io/" rel="noopener ugc nofollow" target="_blank">https://grpc.io/</a></figcaption></figure><h1 id="65f5" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">概念</h1><p id="9a5a" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">gRPC与服务合作。服务只是一个可以用参数和返回类型远程调用的方法。我们可以在<code class="fe me mf mg mh b">.proto</code>文件中定义我们的服务。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">salary.proto</figcaption></figure><p id="9d5f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<code class="fe me mf mg mh b">proto</code>文件中，我定义了两条消息<code class="fe me mf mg mh b">EmployeeRequest</code>和<code class="fe me mf mg mh b">EmployeeResponse</code>。在<code class="fe me mf mg mh b">EmployeeRequest</code>中，我们接受一个叫做<code class="fe me mf mg mh b">employeIdList</code>的字段，它可以是一个整数数组，而<code class="fe me mf mg mh b">EmployeeResponse</code>中有一个叫做<code class="fe me mf mg mh b">message</code>的字段。</p><p id="fbeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我定义了一个名为<code class="fe me mf mg mh b">Employee</code>的服务，它有一个<code class="fe me mf mg mh b">rpc</code>函数<code class="fe me mf mg mh b">paySalary</code>来检查工资是否已经发放。</p><p id="2a5c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们假设我的后端服务器已经设置好了，我只需要打一个电话并得到响应。</p><p id="838b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要在客户机上设置gRPC，我需要安装一些依赖项来运行它。</p><pre class="kj kk kl km gt mk mh ml mm aw mn bi"><span id="526f" class="mo la in mh b gy mp mq l mr ms">- <a class="ae mc" href="https://www.npmjs.com/package/@grpc/grpc-js" rel="noopener ugc nofollow" target="_blank">@grpc/grpc-js</a><br/>- <a class="ae mc" href="https://www.npmjs.com/package/@grpc/proto-loader?activeTab=readme" rel="noopener ugc nofollow" target="_blank">@grpc/proto-loader</a></span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">client.js</figcaption></figure><p id="92a2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如上所述，gRPC使用在<code class="fe me mf mg mh b">.proto</code>文件中定义的服务。在上面的代码片段中，我们用<code class="fe me mf mg mh b">loadSync</code>方法加载了<code class="fe me mf mg mh b">.proto</code>文件，并将<code class="fe me mf mg mh b">loadSync</code>的输出传递给gRPC的<code class="fe me mf mg mh b">loadPackageDefinition</code>。</p><h1 id="3094" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">对gRPC服务器的请求</h1><p id="0f49" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">让我们看看如何连接到远程服务器并获取数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="05c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码片段中，我定义了一个名为<code class="fe me mf mg mh b">main</code>的函数，它负责在没有身份验证的情况下连接到服务器。<br/>我将雇员id的虚拟列表<code class="fe me mf mg mh b">employeIdList:[]</code>传递给我们的RPC函数<code class="fe me mf mg mh b">paySalary</code>，在成功连接和客户端请求之后，我们在回调中得到响应😃。</p><p id="d9b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">即将发生🤩。从远程gRPC服务器获取数据只需进行最少的设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mt"><img src="../Images/cc31157129572b6377dda942b4baa0fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KiBMtNL2NBptU72UD5vhw.png"/></div></div></figure><p id="9945" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们看看如何用Node.js创建gRPC服务器。</p><h1 id="758e" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">服务器设置</h1><p id="f863" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">在深入了解创建服务器所需的每个组件的细节之前，让我们先检查一下实现。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div></figure><p id="6333" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我已经安装了依赖项。但是创建、启动和保持服务器运行需要一些重要的方法。</p><p id="5d24" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是列表:<br/> <strong class="jm io"> — </strong> <code class="fe me mf mg mh b"><strong class="jm io">server()</strong></code>它将创建服务器。<br/> <strong class="jm io"> — </strong> <code class="fe me mf mg mh b"><strong class="jm io">bindAsync()</strong></code>将指定地址和端口来监听客户端传入的请求，在回调中，我正在启动RPC服务器。<br/> <strong class="jm io"> — </strong> <code class="fe me mf mg mh b"><strong class="jm io">addService()</strong></code>它将添加带有相应实现的服务。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">pay_salary.js</figcaption></figure><p id="be96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码片段中，我定义了传递给服务的方法实现。它接收来自客户端请求的数据<code class="fe me mf mg mh b">employeeIdList</code>，对其进行处理，并将响应发送回客户端。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mu"><img src="../Images/7c29180c59c12c01c073bfa01b349df8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTzk0ajaEZfRO03-pmxWDw.png"/></div></div></figure><p id="ea16" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的服务器能够监听客户端的请求并发回响应。是啊！我们完了！😃😃😃😃让我们庆祝一下！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mv"><img src="../Images/e8a927e5655f1bca75ac3ec0db8c3f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*udUo3H0C1pLK2-Hlgf94rQ.jpeg"/></div></div></figure><p id="0011" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我已经分享了用Node.js创建和启动一个服务器，以及创建一个gRPC客户机向gRPC服务器发送请求所需的最小设置。<br/>本文将让您开始探索更多关于gRPC及其实现的内容。</p><p id="1583" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望你喜欢阅读这篇文章。</p><p id="0e3d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="mw">如果你喜欢这个，一定要关注我的</em> </strong> <a class="ae mc" href="https://twitter.com/aatifbandey" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="mw">推特</em> </strong> </a> <strong class="jm io"> <em class="mw">！</em> </strong></p><h1 id="df24" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">参考</h1><p id="991b" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated"><a class="ae mc" href="https://grpc.io/docs/languages/node/basics/" rel="noopener ugc nofollow" target="_blank">https://grpc.io/docs/languages/node/basics/</a></p><p id="7b6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mw">更多内容请看</em><a class="ae mc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>