<html>
<head>
<title>Creating a Custom Element in Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Angular中创建自定义元素</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-custom-element-in-angular-aa2a794fd041?source=collection_archive---------2-----------------------#2021-08-11">https://javascript.plainenglish.io/creating-a-custom-element-in-angular-aa2a794fd041?source=collection_archive---------2-----------------------#2021-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="04e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">角形元素是承载整个框架的缩小版本的角形组件。它们允许您以一种与框架无关的方式创建定制元素(web组件之一)。它们可以在简单的web项目中使用，但是具有Angular的强大功能。</p><p id="7f6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在阅读了角度元素的官方<a class="ae kl" href="https://angular.io/guide/elements" rel="noopener ugc nofollow" target="_blank">文档</a>后，我意识到它缺少结构化的实现部分。这就是我陈述开始行动的步骤的原因！</p><h1 id="beaf" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">1.安装Angular CLI 6并创建新项目</h1><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="1222" class="lt kn iq lp b gy lu lv l lw lx">npm i -g @angular/cli</span><span id="0373" class="lt kn iq lp b gy ly lv l lw lx">ng new angular-custom-elements</span></pre><p id="af58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于Angular在Angular 6中引入了自定义元素的概念，我们必须安装v6或更高版本。您还可以添加<code class="fe lz ma mb lp b">--style</code>标志来设置默认的样式扩展。</p><h1 id="5753" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">2.添加元素包</h1><p id="feca" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">并非所有浏览器都完全实现了自定义元素。因此我们需要<a class="ae kl" href="https://www.webcomponents.org/polyfills" rel="noopener ugc nofollow" target="_blank">多孔填充物</a>来让它们工作。使用新的CLI命令<code class="fe lz ma mb lp b">ng add</code>，您可以添加角度库和所需的聚合填充:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="8119" class="lt kn iq lp b gy lu lv l lw lx">ng add @angular/elements</span></pre><h1 id="8ada" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">3.创建一个组件</h1><p id="c6fb" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在这篇文章的最后，让我们创建一个作为自定义元素的组件:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="1abb" class="lt kn iq lp b gy lu lv l lw lx">ng g component button --inline-style --inline-template -v Native</span></pre><p id="4fef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用<code class="fe lz ma mb lp b">ViewEncapsulation.Native</code>来防止组件的样式溢出并影响其他元素。这将在浏览器的shadow DOM(v 0；对于v1，我们使用<code class="fe lz ma mb lp b">ViewEncapsulation.ShadowDOM</code>，将所有的样式、模板和组件类代码捆绑在一个文件中。</p><h1 id="84e4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">4.向组件添加属性</h1><p id="e357" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在做了一些更改后，我们的按钮组件看起来像:</p><figure class="lk ll lm ln gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/1bed994868d6056ec11a5c2ccf5161e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fOQZ7mqA3FyYwNxN"/></div></div></figure><p id="c6c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据官方文件:</p><blockquote class="mp mq mr"><p id="b83d" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated"><em class="iq">创建API解析组件，寻找输入属性，并为定制元素定义相应的属性。</em></p><p id="6d28" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated"><em class="iq">它转换属性名，使它们与不区分大小写的定制元素兼容。产生的属性名称使用短划线分隔的小写字母。例如，对于一个带有</em> <code class="fe lz ma mb lp b"><em class="iq">@Input('myInputProp') inputProp</em></code> <em class="iq">的组件，对应的自定义元素定义了一个属性“</em> <code class="fe lz ma mb lp b"><em class="iq">my-input-prop”</em></code> <em class="iq">”。</em></p></blockquote><p id="5240" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外:</p><blockquote class="mp mq mr"><p id="7b66" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated"><em class="iq">组件输出被调度为HTML </em> <a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent" rel="noopener ugc nofollow" target="_blank"> <em class="iq">自定义事件</em> </a> <em class="iq">，自定义事件的名称与输出名称匹配。</em></p><p id="2ada" class="jn jo ms jp b jq jr js jt ju jv jw jx mt jz ka kb mu kd ke kf mv kh ki kj kk ij bi translated"><em class="iq">比如一个</em> <code class="fe lz ma mb lp b"><em class="iq">@Output() valueChanged = new EventEmitter()</em></code> <em class="iq">的组件，对应的自定义元素会调度名为“valueChanged”的事件。发出的数据将存储在事件的</em> <code class="fe lz ma mb lp b"><em class="iq">detail</em></code> <em class="iq">属性中。如果您提供了别名，则使用该值。例如，</em><code class="fe lz ma mb lp b"><em class="iq">@Output('myClick') clicks = new EventEmitter&lt;string&amp;</em></code><em class="iq">gt；();导致名为“myClick”的调度事件。</em></p></blockquote><h1 id="ffec" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">5.更新NgModule</h1><figure class="lk ll lm ln gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/0ec78c14d3c2090ea47234ed45056c35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cXdBLrsK9xETOUB7"/></div></div></figure><p id="f06b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是<code class="fe lz ma mb lp b">app.module.ts</code>中需要遵循的主要步骤:</p><ol class=""><li id="a8e8" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nb nc nd ne bi translated">移除设置为<code class="fe lz ma mb lp b">AppComponent</code>的默认<code class="fe lz ma mb lp b">bootstrap</code>阵列</li><li id="561b" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">由于我们的<code class="fe lz ma mb lp b">ButtonComponent</code>不是任何其他组件的一部分，也不是Angular应用程序的根，我们需要告诉Angular专门编译它。为此，我们将它放在<code class="fe lz ma mb lp b">entryComponents</code>列表中。否则有角度的树摇动将从产品包中丢弃该组件。</li><li id="4515" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">添加<code class="fe lz ma mb lp b">ngDoBootstrap()</code>告诉Angular使用这个模块进行引导。</li><li id="7181" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nb nc nd ne bi translated">Angular提供了<code class="fe lz ma mb lp b"><a class="ae kl" href="https://angular.io/api/elements/createCustomElement" rel="noopener ugc nofollow" target="_blank">createCustomElement</a>()</code>功能，用于将角度组件及其依赖项转换为自定义元素。<code class="fe lz ma mb lp b">createCustomElement()</code>函数期望获得两个参数:</li></ol><ul class=""><li id="d74f" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nk nc nd ne bi translated">首先，应该用于创建元素的角度分量。</li><li id="aaf6" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated">第二，一个配置对象。该对象需要包含设置为当前注射器实例的注射器属性。</li></ul><p id="b9ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.下一步是在浏览器中注册新创建的定制元素。这是通过调用<code class="fe lz ma mb lp b">customElements.define()</code>来完成的。请注意，这不是有角的。<strong class="jp ir"><em class="ms">custom elements</em></strong>只读属性属于<em class="ms">窗口</em>接口。它返回对<strong class="jp ir"><em class="ms">CustomElementRegistry</em></strong>对象的引用。该对象可用于注册新的自定义元素。它还可以获取以前在浏览器中注册的自定义元素的信息。</p><p id="79d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe lz ma mb lp b">customElements.define()</code>方法需要两个参数:</p><ul class=""><li id="40fb" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nk nc nd ne bi translated">第一个参数的类型为string，包含元素的名称。传递字符串'<em class="ms"> app-button' </em>意味着&gt;上的自定义元素<em class="ms"> &lt; app-butt </em>将被注册并可以在HTML代码中使用。</li><li id="6ca8" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated">第二个参数是之前创建的自定义元素。</li></ul><p id="3362" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6.现在将<code class="fe lz ma mb lp b">tsconfig.json</code>中的<code class="fe lz ma mb lp b">target</code>值从<code class="fe lz ma mb lp b">es5</code>替换为<code class="fe lz ma mb lp b">es2015</code>，因为在原生支持定制元素的浏览器中，规范要求开发者使用ES2015类来定义定制元素。</p><h1 id="a0f3" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">6.构建并运行</h1><p id="eb29" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">为了构建我们将使用一个标准的<code class="fe lz ma mb lp b">ng build</code>命令。但是由于它输出四个文件(<code class="fe lz ma mb lp b">runtime.js</code>、<code class="fe lz ma mb lp b"> scripts.js</code>、<code class="fe lz ma mb lp b">polyfills.js</code>和<code class="fe lz ma mb lp b">main.js</code>)，并且我们希望将我们的组件作为单个js文件分发，所以我们需要关闭散列文件名。让我们修改<code class="fe lz ma mb lp b">package.json</code>中的<code class="fe lz ma mb lp b">scripts</code>并添加<code class="fe lz ma mb lp b">package</code>条目:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="a235" class="lt kn iq lp b gy lu lv l lw lx">"scripts": {<br/>    …,<br/>    <br/>"build": "ng build --prod --output-hashing=none",</span><span id="1708" class="lt kn iq lp b gy ly lv l lw lx">// For Windows:<br/>"package": "jscat ./dist/angular-custom-elements/runtime.js ./dist/angular-custom-elements/polyfills.js ./dist/angular-custom-elements/scripts.js ./dist/angular-custom-elements/main.js &gt; custom-button-element.js",</span><span id="a85d" class="lt kn iq lp b gy ly lv l lw lx">// For Mac or Linux:<br/>"package": "cat ./dist/angular-custom-elements/runtime.js ./dist/angular-custom-elements/polyfills.js ./dist/angular-custom-elements/scripts.js ./dist/angular-custom-elements/main.js &gt; custom-button-element.js",</span><span id="f651" class="lt kn iq lp b gy ly lv l lw lx">…,</span><span id="f8e5" class="lt kn iq lp b gy ly lv l lw lx">}</span></pre><p id="0d2d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于Windows操作系统没有<code class="fe lz ma mb lp b">cat</code>命令运行<code class="fe lz ma mb lp b">npm i jscat</code>。</p><p id="d79d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">全部保存并最终运行:</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="4ca3" class="lt kn iq lp b gy lu lv l lw lx">npm run build &amp;&amp; npm run package</span></pre><p id="1c1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">该命令生成的<code class="fe lz ma mb lp b">custom-button-element.js</code>可以包含在HTML页面的<code class="fe lz ma mb lp b">&lt;script&gt;</code>中，以查看我们的定制元素的工作情况。</p><p id="d145" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个例子:</p><figure class="lk ll lm ln gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/23f9c4813df50e0516638cb93230e8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hPAZgyNNwbQDycS7"/></div></div></figure><h1 id="5d99" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">摘要</h1><p id="5def" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">总之，我们已经:</p><ul class=""><li id="057c" class="mw mx iq jp b jq jr ju jv jy my kc mz kg na kk nk nc nd ne bi translated">为实现添加了重要的库</li><li id="296d" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated">在浏览器的CustomElementRegistry中注册了组件</li><li id="5a04" class="mw mx iq jp b jq nf ju ng jy nh kc ni kg nj kk nk nc nd ne bi translated">将构建工件合并到一个文件中</li></ul><p id="ef52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的源代码可以在<a class="ae kl" href="https://github.com/patrick1729/angular-elements" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="e076" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ms">更多内容请看</em><a class="ae kl" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">plain English . io</em></strong></a><em class="ms">。报名参加我们的</em> <a class="ae kl" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ms">免费周报</em> </strong> </a> <em class="ms">。关注我们关于</em><a class="ae kl" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">Twitter</em></strong></a><a class="ae kl" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">LinkedIn</em></strong></a><em class="ms"/><a class="ae kl" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">YouTube</em></strong></a><em class="ms"/><a class="ae kl" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">不和</em> </strong> </a> <strong class="jp ir"> <em class="ms">。</em>T49】</strong></p><p id="117f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="ms">对缩放您的软件启动感兴趣</em> </strong> <em class="ms">？检查</em> <a class="ae kl" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ms">电路</em> </strong> </a> <em class="ms">。</em></p></div></div>    
</body>
</html>