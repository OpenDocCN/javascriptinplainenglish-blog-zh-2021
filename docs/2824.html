<html>
<head>
<title>Advanced TypeScript: A Generic Function to Update and Manipulate Object Arrays</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">高级类型脚本:更新和操作对象数组的通用函数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/advanced-typescript-a-generic-function-to-update-and-manipulate-object-arrays-caacd601cedf?source=collection_archive---------2-----------------------#2021-06-09">https://javascript.plainenglish.io/advanced-typescript-a-generic-function-to-update-and-manipulate-object-arrays-caacd601cedf?source=collection_archive---------2-----------------------#2021-06-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c315" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated"><strong class="ak">终极力量的另一个奇特的通用功能！</strong></h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/7dde3bbb12a3c19b901986c0493bbdf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-OZKQ8ktWrcemb3gNUorA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">updateArray.ts in all its glory.</figcaption></figure><p id="8d09" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lo">这篇文章是</em> <a class="ae lp" href="https://chrisfrew.in/blog/advanced-typescript-a-generic-function-to-update-and-manipulate-object-arrays/" rel="noopener ugc nofollow" target="_blank"> <em class="lo">镜像在我的博客</em> </a> <em class="lo">上，在那里你可以找到</em> <strong class="ku io"> <em class="lo">方式</em> </strong> <em class="lo">更好的代码片段——它们也是可以复制和粘贴的！</em></p><h1 id="ab3a" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">总是推动更干净的代码</h1><p id="2915" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">在构建我最新的SaaS产品<a class="ae lp" href="https://reduxplate.com/" rel="noopener ugc nofollow" target="_blank">redexplate</a>时，我意识到一个常见的模式不断出现在我的数组操作函数中。我总是在特定的键上更新特定的值，基于对某个<em class="lo">其他</em>键的特定测试。</p><p id="2e25" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lo"> *Plug:说到</em><a class="ae lp" href="https://reduxplate.com/" rel="noopener ugc nofollow" target="_blank"><em class="lo">Redux plate</em></a><em class="lo">，它会自动为您生成Redux代码，</em> <a class="ae lp" href="https://chrisfrew.in/book" rel="noopener ugc nofollow" target="_blank"> <em class="lo">我正在写一本书，记录我在构建ReduxPlate </em> </a>、<em class="lo">的过程中所走的每一步，从样板启动程序到最终的成品。如果你能来看看，我会很高兴的！是的，你没看错！我真的从头到尾构建了ReduxPlate，就在你的眼前——而且代码都是公开的！</em></p><p id="7c7d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">例如，对于<a class="ae lp" href="https://reduxplate.com/" rel="noopener ugc nofollow" target="_blank"> ReduxPlate主页</a>上的编辑器小部件，我使用IEditorSettings类型的有状态数组来确定哪个编辑器当前是活动的，以及编辑器中的实际代码值是什么:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="2676" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">export</em> <em class="lo">default</em> <em class="lo">interface</em> IEditorSetting {</strong></span><span id="4fee" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    fileLabel: string</strong></span><span id="2965" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    code: string</strong></span><span id="2b7c" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    isActive: boolean</strong></span><span id="50e2" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="ac93" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这种行为要求我编写两个事件处理程序:</p><p id="bcbf" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe my mz na mo b"><strong class="ku io">onChangeCode</strong></code>当代码改变时:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="d052" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeCode = (code: string) =&gt; {</strong></span><span id="450b" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    setEditorSettingsState(editorSettingsState.map(editorSetting =&gt; {</strong></span><span id="5565" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    if</em> (editorSetting.isActive) {</strong></span><span id="9f14" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">         editorSetting.code = code</strong></span><span id="9d62" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }</strong></span><span id="00c9" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> editorSetting</strong></span><span id="2456" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="6d59" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="c969" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">和<code class="fe my mz na mo b"><strong class="ku io">onChangeTab</strong></code>用于当编辑器标签改变时:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="519d" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeTab = (fileLabel: string) =&gt; {</strong></span><span id="1f4a" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">setEditorSettingsState(editorSettingsState.map(editorSetting =&gt; {</strong></span><span id="773f" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    editorSetting.isActive = editorSetting.fileLabel === fileLabel</strong></span><span id="ded2" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> editorSetting</strong></span><span id="0b25" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="6f77" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="2a0e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">仔细研究这两个函数。对于这两者，我映射了一个状态变量<code class="fe my mz na mo b"><strong class="ku io">editorSettingsState</strong></code>，并根据一些测试条件在数组中设置了一个属性。在<code class="fe my mz na mo b"><strong class="ku io">onChangeCode</strong></code>中，测试条件是<code class="fe my mz na mo b"><strong class="ku io">isActive</strong></code>属性值是否为真。在<code class="fe my mz na mo b"><strong class="ku io">onChangeTab</strong></code>中，测试条件是<code class="fe my mz na mo b"><strong class="ku io">fileLabel</strong></code>属性值是否与传入的<code class="fe my mz na mo b"><strong class="ku io">fileLabel</strong></code>相匹配。与<code class="fe my mz na mo b"><strong class="ku io">onChangeCode</strong></code>相反，<code class="fe my mz na mo b"><strong class="ku io">onChangeTab</strong></code>将为数组中的<em class="lo">所有</em>项设置<code class="fe my mz na mo b"><strong class="ku io">isActive</strong></code>值。</p><p id="ffeb" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">通过一点努力，我们应该能够实现一个通用函数，我们可以用它来替换这些函数，更重要的是:在我们需要相同类型功能的应用程序中重用。</p><h1 id="f970" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">重写这两个函数，以便更好地了解它们的结构</h1><p id="65f1" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">为了更好地理解我们将要编写的函数，让我们用一个<code class="fe my mz na mo b"><strong class="ku io">else</strong></code>语句扩展这两个函数，同时保持它们的功能完全相同。</p><p id="6a9c" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">对于<code class="fe my mz na mo b"><strong class="ku io">onChangeCode</strong></code>:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="d890" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeCode = (code: string) =&gt; {</strong></span><span id="1d80" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    setEditorSettingsState(editorSettingsState.map(editorSetting =&gt; {</strong></span><span id="a566" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    if</em> (editorSetting.isActive) {</strong></span><span id="6a74" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        editorSetting.code = code</strong></span><span id="7ba5" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    } <em class="lo">else</em> {</strong></span><span id="ee02" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        // do nothing :)</strong></span><span id="ab87" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }</strong></span><span id="0748" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> editorSetting</strong></span><span id="dfb4" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="35d1" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="4181" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">对于<code class="fe my mz na mo b"><strong class="ku io">onChangeTab</strong></code>:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="3d1a" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeTab = (fileLabel: string) =&gt; {</strong></span><span id="35e3" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">setEditorSettingsState(editorSettingsState.map(editorSetting =&gt; {</strong></span><span id="566d" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    if</em> (editorSetting.fileLabel === fileLabel) {</strong></span><span id="d0a3" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        editorSetting.isActive = true</strong></span><span id="dcba" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    } <em class="lo">else</em> {</strong></span><span id="f9a0" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        editorSetting.isActive = false</strong></span><span id="562c" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }</strong></span><span id="4ac1" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> editorSetting</strong></span><span id="7454" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="dfe5" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="a1cd" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在这种形式中，很明显我们的泛型函数应该有某种测试标准，这将存在于<code class="fe my mz na mo b"><strong class="ku io">if</strong></code>语句中。然后，如果测试标准通过，我们需要在数组中更新属性的键和值。此外，<code class="fe my mz na mo b"><strong class="ku io">else</strong></code>块中发生的事情应该是可选的——也就是说，如果测试失败，应该有一个可选的方法来设置默认值。这实际上意味着这将成为一个<code class="fe my mz na mo b"><strong class="ku io">else if</strong></code>块。</p><p id="2325" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们新的泛型函数的主体将采用与这两个扩展函数相同的形式:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="f8dc" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">return</em> array.map(item =&gt; {</strong></span><span id="5129" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    if</em> (item[testKey] === testValue) {</strong></span><span id="b0a4" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        item[updateKey] = updateValue</strong></span><span id="3644" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    } <em class="lo">else</em> <em class="lo">if</em> (testFailValue !== <em class="lo">undefined</em>) {</strong></span><span id="8082" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        item[updateKey] = testFailValue</strong></span><span id="adec" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }</strong></span><span id="cd0a" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> item</strong></span><span id="3f49" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">})</strong></span></pre><p id="e252" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们需要提供一个<code class="fe my mz na mo b"><strong class="ku io">testKey</strong></code>和值作为测试标准，如果测试通过，还需要提供一个<code class="fe my mz na mo b"><strong class="ku io">updateKey</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code>。最后，一个可选参数将是<code class="fe my mz na mo b"><strong class="ku io">testFailValue</strong></code>。如果<code class="fe my mz na mo b"><strong class="ku io">testFailValue</strong></code>不是<code class="fe my mz na mo b"><strong class="ku io">undefined</strong></code>，那么我们将执行<code class="fe my mz na mo b"><strong class="ku io">else if</strong></code>块。</p><h1 id="b765" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">键入函数</h1><p id="5ea1" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">编写这个函数最具挑战性的部分是确保为<code class="fe my mz na mo b"><strong class="ku io">testValue</strong></code>传递的值与预期的<code class="fe my mz na mo b"><strong class="ku io">T[testKey]</strong></code>类型相匹配。对于<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code> / <code class="fe my mz na mo b"><strong class="ku io">testFailValue</strong></code>带<code class="fe my mz na mo b"><strong class="ku io">T[updateKey]</strong></code>应该也是如此。使用TypeScript，<em class="lo">有可能做到这一点，尽管我们需要在调用签名中显式地提供一点信息来执行它。我们讨论的<code class="fe my mz na mo b"><strong class="ku io">array</strong></code>是<code class="fe my mz na mo b"><strong class="ku io">Array&lt;T&gt;</strong></code>类型，这一点很清楚。但是<code class="fe my mz na mo b"><strong class="ku io">testKey</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">updateKey</strong></code>的类型呢？我们需要引入两个更通用的类型来让它们工作，<code class="fe my mz na mo b"><strong class="ku io">U</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">V</strong></code>。为了确保<code class="fe my mz na mo b"><strong class="ku io">testKey</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">updateKey</strong></code>都是对象<code class="fe my mz na mo b"><strong class="ku io">T</strong></code>的实际键，我们将使用TypeScripts的<code class="fe my mz na mo b"><strong class="ku io">extends</strong></code>关键字，即将<code class="fe my mz na mo b"><strong class="ku io">U</strong></code>定义为<code class="fe my mz na mo b"><strong class="ku io">U extends keyof T</strong></code>，将<code class="fe my mz na mo b"><strong class="ku io">V</strong></code>定义为<code class="fe my mz na mo b"><strong class="ku io">V extends keyof T</strong></code>。</em></p><p id="5c07" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">定义了类型<code class="fe my mz na mo b"><strong class="ku io">U</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">V</strong></code>后，<code class="fe my mz na mo b"><strong class="ku io">testKey</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">updateKey</strong></code>可以用<code class="fe my mz na mo b"><strong class="ku io">keyof T</strong></code>来定义，以及它们对应的值:<code class="fe my mz na mo b"><strong class="ku io">testValue</strong></code>为<code class="fe my mz na mo b"><strong class="ku io">T[U]</strong></code>,<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code>为<code class="fe my mz na mo b"><strong class="ku io">T[V]</strong></code>。<code class="fe my mz na mo b"><strong class="ku io">testFailValue</strong></code>跟<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code>同类型<code class="fe my mz na mo b"><strong class="ku io">T[V]</strong></code>。最后，由于这是一个数组函数<code class="fe my mz na mo b"><strong class="ku io">map</strong></code>，我们将返回一个类型为<code class="fe my mz na mo b"><strong class="ku io">T</strong></code>的新数组。因为这个签名相当复杂，所以我将它们都添加到一个<code class="fe my mz na mo b"><strong class="ku io">param</strong></code>对象中，这样当我们调用这个<code class="fe my mz na mo b"><strong class="ku io">updateArray</strong></code>函数时，它将易于阅读和理解。这样的结构也使得以后扩展和添加额外的参数更加容易。</p><p id="b982" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">所以，我们有我们的函数签名:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="eac0" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">export</em> <em class="lo">const</em> updateArray = &lt;T, U <em class="lo">extends</em> <em class="lo">keyof</em> T, V <em class="lo">extends</em> <em class="lo">keyof</em> T&gt;(params: {</strong></span><span id="3037" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    array: Array&lt;T&gt;</strong></span><span id="bda8" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testKey: <em class="lo">keyof</em> T</strong></span><span id="e61d" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testValue: T[U]</strong></span><span id="7d8c" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateKey: <em class="lo">keyof</em> T</strong></span><span id="ebdc" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateValue: T[V]</strong></span><span id="3a16" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testFailValue?: T[V]</strong></span><span id="6f5b" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}): Array&lt;T&gt;</strong></span></pre><h1 id="79a5" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">决赛成绩</h1><p id="99e4" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">从上面钩住<code class="fe my mz na mo b"><strong class="ku io">map</strong></code>逻辑，完整的<code class="fe my mz na mo b"><strong class="ku io">updateArray</strong></code>功能为:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="a8dc" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io">// Updates an object array at the specified update key with the update value,</strong></span><span id="b86f" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">// if the specified test key matches the test value.</strong></span><span id="efe5" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">// Optionally pass 'testFailValue' to set a default value if the test fails.</strong></span><span id="000a" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">export</em> <em class="lo">const</em> updateArray = &lt;T, U <em class="lo">extends</em> <em class="lo">keyof</em> T, V <em class="lo">extends</em> <em class="lo">keyof</em> T&gt;(params: {</strong></span><span id="4ed9" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    array: Array&lt;T&gt;</strong></span><span id="bbe6" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testKey: <em class="lo">keyof</em> T</strong></span><span id="fb30" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testValue: T[U]</strong></span><span id="b275" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateKey: <em class="lo">keyof</em> T</strong></span><span id="440d" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateValue: T[V]</strong></span><span id="f3f2" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testFailValue?: T[V]</strong></span><span id="3fc8" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}): Array&lt;T&gt; =&gt; {</strong></span><span id="b48b" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">const</em> {</strong></span><span id="2956" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    array,</strong></span><span id="b23c" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testKey,</strong></span><span id="4c74" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testValue,</strong></span><span id="2ae0" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateKey,</strong></span><span id="4a8b" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    updateValue,</strong></span><span id="6726" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    testFailValue,</strong></span><span id="df2c" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">} = params</strong></span><span id="a221" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">return</em> array.map(item =&gt; {</strong></span><span id="64c7" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    if</em> (item[testKey] === testValue) {</strong></span><span id="7577" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        item[updateKey] = updateValue</strong></span><span id="1f7e" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    } <em class="lo">else</em> <em class="lo">if</em> (testFailValue !== <em class="lo">undefined</em>) {</strong></span><span id="3ff5" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        item[updateKey] = testFailValue</strong></span><span id="7da2" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }</strong></span><span id="a692" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io"><em class="lo">    return</em> item</strong></span><span id="5cf3" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    })</strong></span><span id="dc83" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="e9b2" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">对该功能的一个可能的改进是区分成功和失败时的<code class="fe my mz na mo b"><strong class="ku io">updateKey</strong></code>。如果测试失败，也许在某些罕见的情况下，您会想要设置其他键的值。</p><h1 id="0fbe" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">用它！</h1><p id="8682" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">让我们回到最初的函数，重构它们以使用我们喜欢的通用函数<code class="fe my mz na mo b"><strong class="ku io">updateArray</strong></code>。</p><p id="e4e4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">参考上面的<code class="fe my mz na mo b"><strong class="ku io">IEditorSetting</strong></code>可能会有帮助(回想一下<code class="fe my mz na mo b"><strong class="ku io">editorSettingsState</strong></code>是<code class="fe my mz na mo b"><strong class="ku io">IEditorSetting</strong></code>的数组)。这是重构后的<code class="fe my mz na mo b"><strong class="ku io">onChangeCode</strong></code>:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="c070" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeCode = (code: string) =&gt; {</strong></span><span id="e463" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    setEditorSettingsState(updateArray({</strong></span><span id="c155" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        array: editorSettingsState,</strong></span><span id="3298" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        testKey: "isActive",</strong></span><span id="82db" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        testValue: true,</strong></span><span id="3629" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        updateKey: "code",</strong></span><span id="e975" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        updateValue: code,</strong></span><span id="39ad" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="e9f5" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="e951" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">和<code class="fe my mz na mo b"><strong class="ku io">onChangeTab</strong></code>:</p><pre class="kd ke kf kg gt mn mo mp mq aw mr bi"><span id="4ac8" class="ms lr in mo b gy mt mu l mv mw"><strong class="mo io"><em class="lo">const</em> onChangeTab = (fileLabel: string) =&gt; {</strong></span><span id="cea9" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    setEditorSettingsState(updateArray({</strong></span><span id="5a0e" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        array: editorSettingsState,</strong></span><span id="c27d" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        testKey: "fileLabel",</strong></span><span id="57ec" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        testValue: fileLabel,</strong></span><span id="0560" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        updateKey: "isActive",</strong></span><span id="f128" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        updateValue: true,</strong></span><span id="4ebd" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">        testFailValue: false,</strong></span><span id="f90f" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">    }))</strong></span><span id="c1dd" class="ms lr in mo b gy mx mu l mv mw"><strong class="mo io">}</strong></span></pre><p id="04d1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">感谢我们的<code class="fe my mz na mo b"><strong class="ku io">U extends keyof T</strong></code>和<code class="fe my mz na mo b"><strong class="ku io">U extends keyof T</strong></code>，我们的函数是类型安全的:例如，TypeScript不允许将类似<code class="fe my mz na mo b"><strong class="ku io">"hello world"</strong></code>的字符串传递给<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code>，因为<code class="fe my mz na mo b"><strong class="ku io">isActive</strong></code>键上的<code class="fe my mz na mo b"><strong class="ku io">IEditorSetting</strong></code>的预期类型是<code class="fe my mz na mo b"><strong class="ku io">boolean</strong></code>。</p><p id="16c7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">恭喜，我们完成了！</p><h1 id="2919" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">冗长与可重用性和可读性</h1><p id="a80a" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">的确，调用<code class="fe my mz na mo b"><strong class="ku io">updateArray</strong></code>相当冗长。然而，当你考虑到我们不再需要考虑在我们的应用程序中设计所有那些讨厌的<code class="fe my mz na mo b"><strong class="ku io">map</strong></code>操作时，这是一个很小的代价！</p><p id="cf47" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这是不是一种过度优化？我不这么认为——用React或Redux，或者两者都用，看看你自己的项目。我保证你有相同的数组映射和操作时间，无论是在你的状态变化还是渲染函数！</p><h1 id="4562" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">谢谢！</h1><p id="fc07" class="pw-post-body-paragraph ks kt in ku b kv mi jo kx ky mj jr la lb mk ld le lf ml lh li lj mm ll lm ln ig bi translated">有了这个强大的通用函数，您再也不需要考虑属性级别的<code class="fe my mz na mo b"><strong class="ku io">map</strong></code>数组操作了！此外，强类型签名还可以防止您传递与相应键的预期类型不一致的<code class="fe my mz na mo b"><strong class="ku io">testValue</strong></code>或<code class="fe my mz na mo b"><strong class="ku io">updateValue</strong></code>！</p><p id="13d7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">干杯！🍺</p><ul class=""><li id="5382" class="nb nc in ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">克莉丝</li></ul><p id="eb53" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lo">更多内容请看</em><a class="ae lp" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="lo">plain English . io</em></a></p></div></div>    
</body>
</html>