# CDN 不会总是让你的网站更快

> 原文：<https://javascript.plainenglish.io/cdn-performance-1a7bdf83ebc2?source=collection_archive---------4----------------------->

## 它甚至会恶化页面的加载时间。

![](img/1834e0e8559f2ec8b7a3363af2946061.png)

Photo by [NASA](https://unsplash.com/@nasa?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

cdn 被认为是使网站更有性能的标准工具。通过 CDN 链接简单地包含 JavaScript & CSS 库而不是自己托管它们是很流行的。这有它的优点——但有时它们的性能被高估了。

整个话题没那么简单。这就是为什么这是你应该批判性看待的东西——也是 CDN 毫无疑问可以帮助的地方。
玩得开心！

**您可以通过两种方式使用内容交付网络。**

*   通过 CDN 提供网站的嵌入文件。
    图片、CSS、JavaScript 等等。
*   通过 CDN 完成网站交付。除了上述内容，这还包括 HTML 文件。

第一种情况，整个网站不是通过 CDN 交付的。对于这项技术，我们可以使用像 cdnjs.com 这样的免费提供者。这是典型的非静态网站，即网站上的内容是由服务器动态生成的。如果前端是通过数据库查询、服务器端呈现或模板引擎在服务器上生成的，就是这种情况。

这样的网站通常会慢一点，因为每个请求背后都有更多的计算工作。错误在于认为 CDN 会显著提高性能——但事实并非如此。只有当 HTML 在浏览器中可用时，CDN 才能介入。对于许多网站来说，糟糕的性能是由于后端渲染缓慢造成的。你应该使用启发式、缓存和负载平衡，而不是 CDN。

## CDN 链接会给你带来性能上的劣势。

原因是技术性的。假设你的网站正在使用域名 *example.js* 。

因为你在开发过程中完全疯了，所以你的网站使用 jQuery。通过 CDN 加载库，例如*cdnjs.com*。

当浏览器调用您的网站时，它首先解析您的域。域名是给人类的，不是给计算机的。在后台，一切都与 IP 地址一起工作。所以首先，浏览器确定你的域名后面隐藏的是哪个 IP。这是通过 DNS(域名系统)实现的。

之后，浏览器检测到 CDN 需要 jQuery 现在它解析了*cdnjs.com*的域名。如果您将库存储在 web 服务器上，这就没有必要了。

好消息是 DNS 解析通常很快。然而，如果你想显著地优化，你也许应该进行比较，特别是结合下一点。

## CDN 对你的用户有帮助吗？

我是德国人。当我为德国用户发布一个网站时，一些 cdn 甚至都不在考虑范围之内。原因很简单:各个服务器位于完全不同的区域。

即使最近的 CDN 服务器位于伦敦，对我来说也没有意义。用户到 CDN 的距离比用户到 web 服务器的距离更远。

当然，现在顶级 cdn 在全球都有。但不是全部。因此，如果你在德国托管一个网站，但使用美国的 CDN，这将会破坏你的网站性能。

距离的问题也可以反过来。可能你的目标受众离 CDN 很远，但你不是。因此，请确保您广泛测试您的网站，即使来自不同的国家。例如，[tools.pingdom.com](https://tools.pingdom.com/)就是这样一个工具。

一个普遍的偏见是，通过 CDN 提供静态文件在本质上更好。

这不一定是真的，尤其是从性能的角度来看。即使是 CDN 也只是一个 web 服务器，就像你的一样。无论你使用 Express.js、Nginx 还是其他任何网络服务器，它们都可以提供高性能的静态内容。

## 你无法控制 CDN。

一次又一次，我发现自己越来越习惯使用 CDN。当然，使用它有一定的风险——你的网站不再只需要一台服务器，这可能会失败。但是 CDN 服务器发生故障的概率相当低。

你在另一个方面无能为力——关于托管的内容。这正是 HTML 中存在完整性属性的原因。它是一种校验和，可用于测试 CDN 上的代码是否被修改过——例如，被想要获取用户数据的黑客修改过。因此，强烈建议使用完整性属性。这是浏览器能够确定 CDN 上的资源是否已经被改变的唯一方式。

如上所述，一个 CDN 往往让我很舒服。我只是从 CDN 中取出链接，对文件没有任何影响。相反，我可能会使用一个轻量级版本的库或框架。许多人认为 CDN 是最终的性能提升——这是一个问题。它试图用第三方代码来塞满整个网站，而不是思考&也许是优化代码。

# 当然，CDN 也有优势。

## 不是你的流量。

无服务器主导着科技行业。越来越多的开发人员转向无服务器平台，而不是建立专用或虚拟服务器。Vercel、Firebase、Netlify 都是大公司，它们不是为服务器支付固定成本，而是根据使用量付费。

例如，你为你的网络应用程序的输入和输出带宽付费。CSS 和 JavaScript 库可能相当大——仅 react-dom 就有 120kb(未压缩)。如果你通过 CDN 加载这样的文件，你就不用为流量付费——只要你不用为 CDN 付费。

## 自动更新

像 Google Analytics 这样的库可以存储在你的网络服务器上。尽管如此，Google 建议从官方 CDN 加载 JavaScript 文件。不是因为性能原因，而是因为代码在那里被一次又一次地更新。如果文件在您的 web 服务器上，您必须手动执行此操作。

## 贮藏

回到我们在你的网站上使用 jQuery 的例子。这个图书馆经常被使用。很可能，您用户的浏览器已经从同一个 CDN 加载了 jQuery。优点是另一个网站已经在浏览器中缓存了这个库——对于您的网站，jQuery 现在可以简单地从浏览器的缓存中加载。

## [加入我的时事通讯，了解最新消息](http://eepurl.com/hacY0v)