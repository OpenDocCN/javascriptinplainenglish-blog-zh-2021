<html>
<head>
<title>Unit Test Vue Apps with Vue Test Utils</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue测试工具对Vue应用进行单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unit-test-vue-apps-with-vue-test-utils-fc7b87bbce7d?source=collection_archive---------18-----------------------#2021-01-17">https://javascript.plainenglish.io/unit-test-vue-apps-with-vue-test-utils-fc7b87bbce7d?source=collection_archive---------18-----------------------#2021-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f8b758603adb2ba47b2b097748f6f5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FngICyd1jbM8Su76"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@siora18?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Siora Photography</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="60ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了Vue Test Utils库，我们可以轻松地为Vue应用编写和运行单元测试。</p><p id="0eb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Vue Test Utils库编写单元测试。</p><h1 id="a404" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="7c0c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在运行Vue CLI来搭建应用程序时添加它。</p><p id="0b86" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从列表中选择单元测试，然后选择Jest来添加带有产品代码的测试框架。</p><h1 id="e7c9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用</h1><p id="fbbf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">一旦我们添加了测试文件，我们就可以编写单元测试了。</p><p id="b223" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的单元测试中，我们可以像使用组件一样与组件进行交互。</p><p id="0d98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们安装组件，并通过触发元素上的事件来与元素进行交互。</p><p id="bc54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以模拟任何需要设置的数据和外部资源，以便进行测试。</p><p id="320e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们可以独立地运行我们的测试，而不依赖于任何会使测试不可靠的外部事物。</p><p id="da8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要编写我们的第一个测试，我们可以通过编写以下内容将测试添加到tests/unit文件夹中:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3823" class="mn lc iq mj b gy mo mp l mq mr">import { shallowMount } from '@vue/test-utils'</span><span id="d8c6" class="mn lc iq mj b gy ms mp l mq mr">const MessageComponent = {<br/>  template: '&lt;p&gt;{{ msg }}&lt;/p&gt;',<br/>  props: ['msg']<br/>}</span><span id="47a8" class="mn lc iq mj b gy ms mp l mq mr">describe('MessageComponent', () =&gt; {<br/>  it('renders props.msg when passed', () =&gt; {<br/>    const msg = 'new message'<br/>    const wrapper = shallowMount(MessageComponent, {<br/>      propsData: { msg }<br/>    })<br/>    expect(wrapper.text()).toMatch(msg)<br/>  })<br/>})</span></pre><p id="dae8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有将<code class="fe mt mu mv mj b">msg</code>道具的值呈现到屏幕上的<code class="fe mt mu mv mj b">MessageComponent</code>。</p><p id="4cda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的测试中，在我们传递给<code class="fe mt mu mv mj b">it</code>的回调中，我们调用<code class="fe mt mu mv mj b">shallowMount</code>来挂载没有其子组件的组件。</p><p id="5560" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">propsData</code>让我们传递测试所需的道具数据。</p><p id="6a61" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe mt mu mv mj b">wrapper.text()</code>方法返回呈现的文本。</p><p id="c3ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe mt mu mv mj b">toMatch</code>来检查结果。</p><p id="b32c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了运行测试，我们运行<code class="fe mt mu mv mj b">npm run test:unit</code>来运行单元测试，然后我们应该会看到一些绿色的文本来表明测试通过了。</p><h1 id="b137" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">模拟用户交互</h1><p id="48d5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以很容易地模拟用户交互。</p><p id="4553" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="395f" class="mn lc iq mj b gy mo mp l mq mr">import { shallowMount } from '@vue/test-utils'</span><span id="4ef7" class="mn lc iq mj b gy ms mp l mq mr">const Counter = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;button @click="count++"&gt;Add up&lt;/button&gt;<br/>      &lt;p&gt;clicks: {{ count }}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return { count: 0 }<br/>  }<br/>}</span><span id="5578" class="mn lc iq mj b gy ms mp l mq mr">describe('Counter', () =&gt; {<br/>  it('renders new number when Add up button is clicked', async () =&gt; {<br/>    const wrapper = shallowMount(Counter)<br/>    const button = wrapper.find('button')<br/>    const text = wrapper.find('p')<br/>    await button.trigger('click')<br/>    expect(text.text()).toBe('clicks: 1')<br/>  })<br/>})</span></pre><p id="c67e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有了想要测试的<code class="fe mt mu mv mj b">Counter</code>组件。</p><p id="2663" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它有一个按钮，当我们点击它时,<code class="fe mt mu mv mj b">count</code>增加1。</p><p id="9336" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在测试中，我们调用<code class="fe mt mu mv mj b">shallowMount</code>来挂载组件。</p><p id="cbd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">wrapper.find</code>来获取按钮和<code class="fe mt mu mv mj b">p</code>元素。</p><p id="8d64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了模拟按钮上的点击，我们调用<code class="fe mt mu mv mj b">trigger</code>来触发点击事件。</p><p id="a6f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">trigger</code> is async is返回一个承诺，所以我们的测试回调必须是一个<code class="fe mt mu mv mj b">async </code>函数，我们必须<code class="fe mt mu mv mj b">await</code>这个<code class="fe mt mu mv mj b">trigger</code>方法。</p><p id="41dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe mt mu mv mj b">text</code>方法检查p元素中显示的文本，看看文本是否已经更新。</p><h1 id="c1e2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1627" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">通过使用Jest和模拟用户动作，我们可以很容易地编写单元测试来测试Vue应用。</p><p id="a781" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>