<html>
<head>
<title>Mocking APIs with JSON-Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JSON-Server模拟API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/mocking-apis-with-json-server-4864bcf310ac?source=collection_archive---------8-----------------------#2021-04-13">https://javascript.plainenglish.io/mocking-apis-with-json-server-4864bcf310ac?source=collection_archive---------8-----------------------#2021-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9f4c9f5f9549b90f2de06970bc803a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Unx2uF6Mt_ExCyRY.png"/></div></div></figure><h1 id="2580" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">API嘲讽是什么？</h1><p id="415b" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">模拟API通过为API请求提供真实的响应来模仿真实的API。这些API可以位于您的本地计算机上，也可以位于公共互联网上。它基本上模仿了真实API的行为。</p><h1 id="6dc9" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated"><strong class="ak">为什么API嘲讽？</strong></h1><ol class=""><li id="2f04" class="lr ls in kv b kw kx la lb le lt li lu lm lv lq lw lx ly lz bi translated">真正的API还不可用，但API合同是最终的。一旦API模拟就绪，前端开发人员就可以开始与后端开发人员并行工作。</li><li id="ba88" class="lr ls in kv b kw ma la mb le mc li md lm me lq lw lx ly lz bi translated">改变模拟API的响应比改变真实API中的确切逻辑更容易。</li><li id="58ef" class="lr ls in kv b kw ma la mb le mc li md lm me lq lw lx ly lz bi translated">API自动化团队可以编写带有基本断言的自动化测试用例，这些断言可以在真正的API可用时运行。</li><li id="81c0" class="lr ls in kv b kw ma la mb le mc li md lm me lq lw lx ly lz bi translated">如果真正的API很慢，模拟API可以用于开发目的。</li><li id="60c1" class="lr ls in kv b kw ma la mb le mc li md lm me lq lw lx ly lz bi translated">当您离线工作时，模拟API会很方便，并且模拟API托管在您的本地计算机上。</li></ol><h1 id="041a" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">如何使用JSON-Server模拟API</h1><p id="ae1b" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">JSON Server <strong class="kv io"> </strong>是一个节点模块，我们可以用它来模拟REST API服务。这是用最少的配置添加模拟REST API的最简单、最快的方法之一。</p><h2 id="025a" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">安装JSON服务器</strong></h2><p id="6564" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">运行以下命令来安装JSON服务器。</p><blockquote class="mr ms mt"><p id="fd6f" class="kt ku mu kv b kw mv ky kz la mw lc ld mx my lg lh mz na lk ll nb nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b">npm install -g json-server</code></p></blockquote><p id="9989" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">通过添加选项<code class="fe nd ne nf ng b">-g</code>,我们可以确保软件包被全局安装在您的系统上。</p><h2 id="03f4" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">创建db.json文件</h2><p id="4323" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">接下来，我们创建一个名为<code class="fe nd ne nf ng b">db.json</code>的JSON文件。这个文件代表了我们的模拟API的数据库。对于JSON结构CRUD中包含的对象，端点是自动创建的。看看下面的<code class="fe nd ne nf ng b">db.json</code>文件:</p><pre class="nh ni nj nk gt nl ng nm nn aw no bi"><span id="f7e3" class="mf jw in ng b gy np nq l nr ns">{<br/>  "cars": [<br/>    {<br/>      "brand": "Tata",<br/>      "name": "Hexa",<br/>      "variant": "Diesel",<br/>      "type": "3",<br/>      "id": 1,<br/>      "commentId":2<br/>    },<br/>    {<br/>      "brand": "Tata",<br/>      "name": "Nano",<br/>      "variant": "Diesel",<br/>      "type": "1",<br/>      "id": 2,<br/>      "commentId": 1<br/>    }<br/>  ],<br/>  "comments": [<br/>    {<br/>      "id": 1,<br/>      "userComments": "Good Car"<br/>    },<br/>    {<br/>      "id": 2,<br/>      "userComments": "Bad Car"<br/>    }<br/>  ]<br/>}</span></pre><p id="ff7e" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">JSON结构有3个对象，即。汽车和物品。</p><h2 id="7585" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">运行服务器</h2><p id="de9e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们通过执行以下命令来启动JSON服务器:</p><blockquote class="mr ms mt"><p id="37c8" class="kt ku mu kv b kw mv ky kz la mw lc ld mx my lg lh mz na lk ll nb nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b">json-server --watch db.json</code></p></blockquote><p id="ed87" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">这里，我们用参数<code class="fe nd ne nf ng b">--watch</code>启动JSON服务器，这意味着服务器监视<code class="fe nd ne nf ng b">db.json</code>中的变化，并相应地更新公开的API。默认情况下，服务器将在端口3000上启动。导航到http://localhost:3000/查看我们拥有的资源。</p><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/e41132aa80e8dc757b12af7f077c7642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H1L41_M9BLQopnEDPlsOmA.png"/></div></div></figure><h2 id="b267" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">HTTP端点</h2><p id="62f6" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">当服务器开始监视<code class="fe nd ne nf ng b">db.json</code>文件时，将默认创建以下端点。</p><pre class="nh ni nj nk gt nl ng nm nn aw no bi"><span id="1b69" class="mf jw in ng b gy np nq l nr ns">GET /cars<br/>GET /comments<br/>GET /cars/{id}<br/>GET /comments/{id}<br/>POST /cars<br/>POST /comments<br/>PUT /cars/{id}<br/>PUT /comments/{id}<br/>DELETE /cars/{id}<br/>DELETE /comments/{id}<br/>PATCH /cars/{id}<br/>PATCH /comments/{id}</span></pre><p id="461c" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">任何请求(获取/上传/发布/删除/修补等。)将被写入<code class="fe nd ne nf ng b">db.json</code>文件，并且<code class="fe nd ne nf ng b">db.json</code>将被相应地更新。我们将使用POSTMAN测试其中一些端点。</p><h2 id="a19d" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">发布请求</strong></h2><p id="59a8" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">要创建一辆新车，使用<code class="fe nd ne nf ng b">Content-Type</code>作为<code class="fe nd ne nf ng b">application/json</code>执行POST请求。在发布之后，请求<code class="fe nd ne nf ng b">db.json</code>将被更新为cars对象下的另一个资源。id将自动递增。</p><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/66957a7d246a04b85222875719254b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rby6v4HQvIl0uzoek91E8A.png"/></div></div></figure><h2 id="6fe0" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">上传请求</h2><p id="c6a1" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们尝试更新新创建的资源。我们将变型为柴油。</p><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/10ff26dbd3484f5a2aa13db60520640c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_QOqmtI58AU1UK4ldc4uEQ.png"/></div></div></figure><h2 id="706f" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">补丁请求</h2><p id="acfe" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们使用补丁请求来更新创建的资源。我们将向汽车资源添加一条注释。</p><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/97a97af08b4e39a52d9e2592259bbd66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kwJC08tIXJyd9LpG0rBq4A.png"/></div></div></figure><h2 id="b4df" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated">删除请求</h2><p id="386b" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">删除请求将删除资源并将其从<code class="fe nd ne nf ng b">db.json</code>文件中移除</p><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/09e79333bf51bd13e7368f96756a047e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98fqcNkzlZ_GYfZGtzrFKQ.png"/></div></div></figure><h2 id="d0de" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">得到请求</strong></h2><figure class="nh ni nj nk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ca"><img src="../Images/9f865ca443786e3886546da5ba099549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QTv54XWmB_NyUIk7v2Kcw.png"/></div></div></figure><p id="f47c" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">根据需要，可以对GET请求执行许多操作来重新排列项目。这些是:</p><h2 id="746e" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">过滤:</strong></h2><p id="88da" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?name=Hexa</em></code> <em class="mu"> : </em>给出了所有名字为Hexa的汽车。</p><p id="84ee" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?type=1&amp;commentId=1</em></code> <em class="mu"> : W </em>我将返回type = 1，commentId = 1的所有汽车。</p><h2 id="fce9" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">分页:</strong></h2><p id="72e6" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">使用<code class="fe nd ne nf ng b">_page</code>返回params中的分页数据，使用<code class="fe nd ne nf ng b">_limit</code>限制返回的数据。默认情况下，返回10个项目。</p><p id="337f" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?_page=1</em></code>:返回前10项。</p><p id="4710" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?_page=1&amp;_limit=6</em></code>:返回前6项。</p><h2 id="4f27" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">排序:</strong></h2><p id="20ef" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?_sort=id&amp;_order=desc</em></code>:这将根据id对desc的汽车进行排序。<code class="fe nd ne nf ng b">asc</code>(升序)顺序是默认的。</p><h2 id="556c" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">切片:</strong></h2><p id="f3a1" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?_start=3&amp;_end=6</em></code>:返回id为&gt; 3且id≤6的项目</p><p id="f6f2" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?_start=3&amp;_limit=6</em></code>:返回从id = 4开始的六个项目。</p><h2 id="c342" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">操作员:</strong></h2><p id="8651" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">添加<code class="fe nd ne nf ng b">_gte</code>或<code class="fe nd ne nf ng b">_lte</code>以获取范围</p><p id="56aa" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?id_gte=5</em></code>:返回id ≥ 5的项目。</p><p id="d449" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?id_lte=10</em></code>:返回id ≤10的项目。</p><p id="9528" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?id_gte=5&amp;id_lte=10</em></code>:返回id ≥5且id≤10的项目。</p><p id="1660" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">添加<code class="fe nd ne nf ng b">_ne</code>排除一个值</p><p id="e8d4" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?id_ne=3</em></code>:排除id = 3的资源。</p><p id="7593" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">将<code class="fe nd ne nf ng b">_like</code>添加到过滤器(支持RegExp)</p><p id="ac27" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/?name_like=swift</em></code> <em class="mu"> : </em>过滤名称中包含swift的所有资源。</p><h2 id="eee7" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">关系:</strong></h2><p id="e699" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">要包含子资源，请添加<code class="fe nd ne nf ng b">_embed</code></p><p id="1585" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/comments?_embed=cars</em></code></p><p id="b877" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">要包含父资源，请添加<code class="fe nd ne nf ng b">_expand</code></p><p id="3af3" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/cars/2/?_expand=comment</em></code></p><p id="5b4e" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">获取或创建嵌套资源</p><p id="9e63" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/comments/2/cars</em></code> <em class="mu"> : </em>给出commentId = 2的汽车。</p><h2 id="dead" class="mf jw in bd jx mg mh dn kb mi mj dp kf le mk ml kj li mm mn kn lm mo mp kr mq bi translated"><strong class="ak">数据库:</strong></h2><p id="f58e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><code class="fe nd ne nf ng b"><em class="mu">http://localhost:3000/db</em></code> <em class="mu"> : </em>获取整个<code class="fe nd ne nf ng b">db.json</code>文件。</p><h1 id="e3ab" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">JSON服务器—缺点</h1><p id="b6ad" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">如果您只需要用基本的验证来模拟简单的CRUD端点，那么您可以使用JSON服务器。</p><p id="4a46" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">JSON服务器的一个主要缺点是灵活性较差。例如，非crud端点，不能配置不同的查询参数。</p><p id="2ef5" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated">而且，<code class="fe nd ne nf ng b">db.json</code>在您每次对它执行操作时都会被修改。如果有人不小心删除了所有数据，他们可能不得不重新设置测试数据。</p><p id="18af" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><em class="mu">完整项目和更多库可以在我的</em><a class="ae ny" href="https://github.com/attrideepak" rel="noopener ugc nofollow" target="_blank"><em class="mu">github</em></a><em class="mu">上找到。</em></p><p id="9dc5" class="pw-post-body-paragraph kt ku in kv b kw mv ky kz la mw lc ld le my lg lh li na lk ll lm nc lo lp lq ig bi translated"><em class="mu">更多内容请看</em><a class="ae ny" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mu">plain English . io</em></strong></a></p></div></div>    
</body>
</html>