<html>
<head>
<title>Create a WhatsApp Clone with Next.js: Fetch Data from Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Next.js创建WhatsApp克隆:从Firebase获取数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-whatsapp-clone-with-next-js-part-21-fetch-data-from-firebase-7efd31f5f245?source=collection_archive---------4-----------------------#2021-11-13">https://javascript.plainenglish.io/create-whatsapp-clone-with-next-js-part-21-fetch-data-from-firebase-7efd31f5f245?source=collection_archive---------4-----------------------#2021-11-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fc03" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第21部分:使用firestore、query、collection和getDocs</h2></div><p id="5978" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我们将获取用户的数据，这样我们可以点击它，然后开始聊天。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="0737" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae li" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww/join" rel="noopener ugc nofollow" target="_blank">源代码</a></p><p id="17b2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，在Sidebar.js下，我们需要导入以下内容。</p><pre class="lb lc ld le gt lj lk ll lm aw ln bi"><span id="9c81" class="lo lp iq lk b gy lq lr l ls lt">import { useState, useEffect } from 'react';</span><span id="a957" class="lo lp iq lk b gy lu lr l ls lt">import { collection, getDocs, query, where } from "@firebase/firestore";<br/>import { db } from '../firebase';<br/>import { useAuth } from '../Auth';</span></pre><p id="c081" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要通过使用useAuth()创建状态朋友并获取currentUser。</p><p id="7abf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">usersRef指向名为“users”的集合。选择与用户电子邮件地址不同的用户。</p><p id="662d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将id为的doc.data()设置为朋友数据</p><pre class="lb lc ld le gt lj lk ll lm aw ln bi"><span id="fc9f" class="lo lp iq lk b gy lq lr l ls lt">const Sidebar = () =&gt; {</span><span id="cee4" class="lo lp iq lk b gy lu lr l ls lt">const [friends, setFriends] = useState([])<br/>const { currentUser } = useAuth();</span><span id="8c76" class="lo lp iq lk b gy lu lr l ls lt">useEffect(() =&gt; {</span><span id="6c17" class="lo lp iq lk b gy lu lr l ls lt">async function fetchFriends() {</span><span id="e312" class="lo lp iq lk b gy lu lr l ls lt">const usersRef = collection(db, "users");</span><span id="94ef" class="lo lp iq lk b gy lu lr l ls lt">const q = query(usersRef, where("email", "!=", currentUser?.email));</span><span id="7a9e" class="lo lp iq lk b gy lu lr l ls lt">const querySnapshot = await getDocs(q);</span><span id="5604" class="lo lp iq lk b gy lu lr l ls lt">setFriends(querySnapshot.docs.map(doc =&gt; ({ ...doc.data(), id: doc.id })))</span><span id="7d6b" class="lo lp iq lk b gy lu lr l ls lt">}</span><span id="bd69" class="lo lp iq lk b gy lu lr l ls lt">fetchFriends()</span><span id="c934" class="lo lp iq lk b gy lu lr l ls lt">}, [])</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/d5e791247895573a9269215a410380d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0zm2AygzOSdn4WVO8jEjw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">users collection</figcaption></figure><h1 id="3df2" class="mg lp iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">交朋友</h1><p id="e834" class="pw-post-body-paragraph kf kg iq kh b ki mx jr kk kl my ju kn ko mz kq kr ks na ku kv kw nb ky kz la ij bi translated">为了渲染朋友，我们需要创建一个<friend>组件。我们可以从<chat>组件中复制，只需删除最新的消息和时间戳部分。准备将photoURL和displayName传递给组件。</chat></friend></p><pre class="lb lc ld le gt lj lk ll lm aw ln bi"><span id="8152" class="lo lp iq lk b gy lq lr l ls lt">import { Avatar } from '@mui/material';</span><span id="7fb8" class="lo lp iq lk b gy lu lr l ls lt">import styled from 'styled-components';</span><span id="2a5e" class="lo lp iq lk b gy lu lr l ls lt">const Friend = ({ photoURL, displayName }) =&gt; {</span><span id="ba19" class="lo lp iq lk b gy lu lr l ls lt">return (</span><span id="e548" class="lo lp iq lk b gy lu lr l ls lt">&lt;Container &gt;</span><span id="e327" class="lo lp iq lk b gy lu lr l ls lt">&lt;FrdAvatar src={photoURL} /&gt;</span><span id="9748" class="lo lp iq lk b gy lu lr l ls lt">&lt;ChatContainer&gt;</span><span id="6c5a" class="lo lp iq lk b gy lu lr l ls lt">&lt;div style={{ gridArea: 'name' }}&gt;{displayName}&lt;/div&gt;</span><span id="c090" class="lo lp iq lk b gy lu lr l ls lt">&lt;/ChatContainer&gt;</span><span id="91aa" class="lo lp iq lk b gy lu lr l ls lt">&lt;/Container&gt;</span><span id="0a13" class="lo lp iq lk b gy lu lr l ls lt">)</span><span id="6ad5" class="lo lp iq lk b gy lu lr l ls lt">}</span><span id="3ebb" class="lo lp iq lk b gy lu lr l ls lt">export default Friend</span><span id="a5e3" class="lo lp iq lk b gy lu lr l ls lt">const Container = styled.div`</span><span id="03f7" class="lo lp iq lk b gy lu lr l ls lt">display:flex;</span><span id="d05d" class="lo lp iq lk b gy lu lr l ls lt">align-items:center;</span><span id="0135" class="lo lp iq lk b gy lu lr l ls lt">cursor:pointer;</span><span id="5168" class="lo lp iq lk b gy lu lr l ls lt">min-height:67px;</span><span id="c6ab" class="lo lp iq lk b gy lu lr l ls lt">padding-left: 15px;</span><span id="8a66" class="lo lp iq lk b gy lu lr l ls lt">word-break:break-word;</span><span id="97a1" class="lo lp iq lk b gy lu lr l ls lt">:hover {</span><span id="12db" class="lo lp iq lk b gy lu lr l ls lt">background-color:#F5F5F5;</span><span id="b21a" class="lo lp iq lk b gy lu lr l ls lt">}</span><span id="7a9a" class="lo lp iq lk b gy lu lr l ls lt">`</span><span id="4e00" class="lo lp iq lk b gy lu lr l ls lt">const FrdAvatar = styled(Avatar)`</span><span id="ef87" class="lo lp iq lk b gy lu lr l ls lt">margin:5px;</span><span id="4e82" class="lo lp iq lk b gy lu lr l ls lt">margin-right:15px;</span><span id="3c87" class="lo lp iq lk b gy lu lr l ls lt">`</span><span id="87f0" class="lo lp iq lk b gy lu lr l ls lt">const ChatContainer = styled.div`</span><span id="6f03" class="lo lp iq lk b gy lu lr l ls lt">display:grid;</span><span id="46df" class="lo lp iq lk b gy lu lr l ls lt">padding:10px;</span><span id="795f" class="lo lp iq lk b gy lu lr l ls lt">width:100%;</span><span id="1836" class="lo lp iq lk b gy lu lr l ls lt">grid-template-columns: repeat(3,1fr);</span><span id="d631" class="lo lp iq lk b gy lu lr l ls lt">border-bottom: 1px solid #ededed;</span><span id="e597" class="lo lp iq lk b gy lu lr l ls lt">gap:10px;</span><span id="81ca" class="lo lp iq lk b gy lu lr l ls lt">grid-template-areas:</span><span id="b732" class="lo lp iq lk b gy lu lr l ls lt">"name name time"</span><span id="4aa6" class="lo lp iq lk b gy lu lr l ls lt">"latest_message latest_message."</span><span id="bb5b" class="lo lp iq lk b gy lu lr l ls lt">;</span><span id="5b00" class="lo lp iq lk b gy lu lr l ls lt">`</span></pre><p id="4803" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">回到侧边栏，导入<friend>组件。</friend></p><pre class="lb lc ld le gt lj lk ll lm aw ln bi"><span id="71a3" class="lo lp iq lk b gy lq lr l ls lt">import Friend from './Friend';</span></pre><p id="8dae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用地图功能渲染朋友。</p><pre class="lb lc ld le gt lj lk ll lm aw ln bi"><span id="6898" class="lo lp iq lk b gy lq lr l ls lt">{friends.map(friend =&gt; (</span><span id="97c6" class="lo lp iq lk b gy lu lr l ls lt">&lt;Friend key={friend.id} photoURL={friend.photoURL} displayName={friend.displayName} id={friend.id} /&gt;</span><span id="5ea6" class="lo lp iq lk b gy lu lr l ls lt">))}</span></pre><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nc"><img src="../Images/9f67195bc755f105d72678b9a1e77f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GsRztLfQMcmgDqSF7QFqhw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Friends will be rendered at the sidebar</figcaption></figure><h1 id="5db1" class="mg lp iq bd mh mi mj mk ml mm mn mo mp jw mq jx mr jz ms ka mt kc mu kd mv mw bi translated">关注我们:<a class="ae li" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae li" href="https://ckmobile.medium.com/" rel="noopener"> Medium </a>，<a class="ae li" href="https://www.udemy.com/user/cyruschan2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a>，<a class="ae li" href="https://www.linkedin.com/company/ckmobi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae li" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae li" href="https://www.instagram.com/ckmobile8050" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae li" href="https://app.gumroad.com/ckmobile" rel="noopener ugc nofollow" target="_blank"> Gumroad </a></h1><p id="6329" class="pw-post-body-paragraph kf kg iq kh b ki mx jr kk kl my ju kn ko mz kq kr ks na ku kv kw nb ky kz la ij bi translated"><em class="nd">更多内容看</em> <a class="ae li" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nd">说白了就是</em> </a> <em class="nd">。报名参加我们的</em> <a class="ae li" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nd">免费周报在这里</em> </a> <em class="nd">。</em></p></div></div>    
</body>
</html>