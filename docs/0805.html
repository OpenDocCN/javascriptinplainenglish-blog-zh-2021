<html>
<head>
<title>Dependency Injection will surprise you in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的依赖注入会让你大吃一惊</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/dependency-injection-will-surprise-you-in-javascript-d7c36ee68566?source=collection_archive---------12-----------------------#2021-02-19">https://javascript.plainenglish.io/dependency-injection-will-surprise-you-in-javascript-d7c36ee68566?source=collection_archive---------12-----------------------#2021-02-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a9ce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">JavaScript让事情变得不同，通常，要意识到这些不同</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2eec6f6cf92cbfe0d22a1ddf8f059812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmmalHEw8_MH9sURIHY33Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae kv" href="https://unsplash.com/@itssammoqadam" rel="noopener ugc nofollow" target="_blank">Sam Moqadam</a> via <a class="ae kv" href="https://unsplash.com/photos/l9VjM-Pp7-M" rel="noopener ugc nofollow" target="_blank">Unsplash(CC0)</a></figcaption></figure><p id="6054" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你打算用C#或Java这样的面向对象编程语言来开发你的软件。总有一天，你必须考虑对元件进行去耦。打开谷歌搜索引擎，最终，你会发现一个术语叫做依赖注入，简称DI。[1] [2]</p><h1 id="b2e4" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么要使用依赖注入？</h1><p id="1799" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一个典型的例子是在现有的编码项目中必须改变的记录器或数据库组件。很明显，您希望尽可能少地做这件事，并且不愿意调整旧组件的实现来适应新组件。</p><p id="c8f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，当组件完成相同的任务时，你可以很容易地改变它们，而不需要太多的努力来适应现有的代码库。但真正的问题是:</p><p id="cf66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我/我们需要修改多少代码？</p><p id="cf03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我打赌你过去听说过双容器。那是我们正在寻找的术语。他们负责基础的配置。管理依赖关系并将信息分发给每个请求者。</p><p id="65c9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简单总结一下这个概念:这种技术用于使类独立于它们的依赖关系。在C#中，你用新的操作符<em class="mp">创建一个对象。如果类A依赖于类B，它通过调用构造函数并结合类B的<em class="mp"> new </em>操作符来创建这个类。想象类B的状态被类A改变，而类C进入游戏。<br/>C类也需要B类的一个实例，如果已经创建了B的实例，C如何获得B的实例？A会创建C并传入已经创建的实例吗？C是否创建了另一个实例？C需要B的实例的改变后的状态吗？</em></p><p id="3546" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你意识到我们在这里遇到了麻烦。</p><p id="3093" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，DI使您能够替换依赖项，而不必改变使用它们的类。它还能够降低仅仅因为一个类的依赖关系发生变化而导致该类发生变化的风险。[3]</p><p id="9567" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但真正的问题是:<strong class="ky ir">JavaScript有依赖注入的能力吗？</strong></p><h1 id="70f8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">JavaScript和依赖注入</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/b1d3033393fddf1a2491fcddd7cd75e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haMEQHfMceoIpoEs30wzuA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae kv" href="https://unsplash.com/@grakozy" rel="noopener ugc nofollow" target="_blank">Greg Rakozy</a> via <a class="ae kv" href="https://unsplash.com/photos/vw3Ahg4x1tY" rel="noopener ugc nofollow" target="_blank">Unsplash (CC0)</a></figcaption></figure><p id="bf36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更改组件意味着定义一个接口来指定两个组件之间的交互契约。拥有接口意味着创建从接口推断的对象。当像这样而不是用具体的类编码时，您就达到了可交换性的点，因为两个组件都必须满足接口的契约，并且最终是可交换的。这意味着DI通过依赖契约(接口)而不是具体的类，将具体的类从依赖中分离出来。[3]</p><p id="db24" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要做到这一点，你所使用的语言必须支持强类型系统，并允许你使用接口。成功的关键是在不知道具体类型的情况下请求契约(接口),以获得我们正在寻找的可互换性。</p><p id="de29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">C#做到了，但是JavaScript呢？</p><p id="aeda" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个需求在JavaScript中都是半生不熟的。由于ECMAScript 2015是两个可用的关键字:<em class="mp">类</em>和<em class="mp">扩展</em>。但是与真正的面向对象相比，它们都不是一回事。隐藏JavaScript基于原型的继承更像是语法上的糖。</p><p id="a81d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使你要把这算作面向对象，JS也没有接口。这导致了无法在JavaScript中进行面向对象的依赖注入的结论。</p><h1 id="f5e9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">有解决办法吗？</h1><p id="0df6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如果我们不能在JavaScript中使用真正的依赖注入，我们应该首先考虑DI的背景和它所解决的问题。它解决了面向对象语言中由于使用静态类型系统而存在的问题。JavaScript使用动态类型系统。[4]</p><p id="d513" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">依赖注入通常为类的可交换性建立基础，并通过接口来描述。这意味着每个传递给方法的对象都必须履行接口的契约，否则，程序就会崩溃。接口确保了契约和对象的完整性。<br/>在JavaScript中把一个对象传入一个函数，调用那个对象的一个不存在，但应该到的函数，不会给我们带来崩溃。如果这个函数存在，它就被调用；如果不存在，这个调用就无效。</p><p id="31a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更进一步，JavaScript不关心被传入对象的其他功能。只要满足所需的功能。我们称之为<em class="mp">鸭子打字</em>。[5]</p><blockquote class="mr ms mt"><p id="2f2f" class="kw kx mp ky b kz la jr lb lc ld ju le mu lg lh li mv lk ll lm mw lo lp lq lr ij bi translated">当我看到一只像鸭子一样走路、像鸭子一样游泳、像鸭子一样嘎嘎叫的鸟时，我就把那只鸟叫做鸭子。— <a class="ae kv" href="https://de.wikipedia.org/wiki/James_Whitcomb_Riley" rel="noopener ugc nofollow" target="_blank">詹姆斯·惠特科姆·雷利斯</a></p></blockquote><p id="ef4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为这不是JavaScript中的一种方式，所以引用被大量转换为:</p><blockquote class="mr ms mt"><p id="7af7" class="kw kx mp ky b kz la jr lb lc ld ju le mu lg lh li mv lk ll lm mw lo lp lq lr ij bi translated">当我看到一只叫起来像鸭子的鸟看起来像狗，走路像猫的时候，我把那个叫做JavaScript。—俗语</p></blockquote><p id="8da2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，您只需将一个匹配的对象传递给一个需要的组件，例如，一个日志记录器，只要它与任务匹配，它是否正式匹配预期的契约并不重要。因为JavaScript中的对象除了对象之外没有类型，因为缺少静态类型系统，所以它们不能匹配。</p><p id="6e71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JavaScript的这一特性使测试变得容易得多，因为您可以专门为手头的用例构造存根和模拟，而不需要依赖正式的系统，也不需要相应复杂的工具来这样做。</p><h1 id="232c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">有没有实现依赖注入的方法？</h1><p id="c1b3" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当然，这留下了如何配置整个事情的问题——如何用JavaScript实现用C#和阿迪容器解决的任务。一种简单的方法是将它需要的依赖项的函数作为参数传递，或者将组件注册在一个中心位置，然后可以从那里检索它们。这大致相当于服务定位器的开始，这在面向对象编程中经常被认为是一种不受欢迎的编码方式。最后，更简单、更实用的解决方案代表了经常被过度开发的DI容器。亲吻原则再次适用于此。</p><div class="mx my gp gr mz na"><a href="https://medium.com/next-level-source-code/do-you-follow-these-10-principles-for-good-programmers-1445727af447" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">你遵循了优秀程序员的这10条原则吗？</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">从接吻和干燥到足球和YAGNI和聪明屁股代码的10个原则！</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no kp na"/></div></div></a></div><h2 id="b220" class="np lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">结构</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/94b8652e5a3d6b48d033bdf5ea10e467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*voB9nD7WSRkqITzew9JKgA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae kv" href="https://www.pexels.com/@pat-whelen-2913248" rel="noopener ugc nofollow" target="_blank">Pat Whelen</a> via <a class="ae kv" href="https://www.pexels.com/photo/wood-light-city-sky-5579612/" rel="noopener ugc nofollow" target="_blank">Pexels (CC0)</a></figcaption></figure><p id="62d5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在JavaScript中，您有几个选项。<a class="ae kv" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>框架试图在这里模拟一个类似的构造，但是这需要惊人的(或者令人害怕的)高度复杂性和努力。它全部内置在Angular的<a class="ae kv" href="https://angular.io/api/core/NgModule" rel="noopener ugc nofollow" target="_blank">模块系统</a>中。当你启动你的应用程序时，你的根模块连接你在整个应用程序中需要的依赖关系，并允许你将一些依赖关系解析推迟到<a class="ae kv" href="https://angular.io/guide/feature-modules" rel="noopener ugc nofollow" target="_blank">功能模块</a>。在测试它们的时候，你可以用一个<a class="ae kv" href="https://angular.io/api/core/testing/TestBed" rel="noopener ugc nofollow" target="_blank">测试床</a>做同样的事情(这只是一个小规模的模块)，只提供运行测试所需的依赖关系。[6]</p><p id="7f6b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果Angular不是你的菜或者你根本用不上它，还有一个框架叫做<a class="ae kv" href="https://inversify.io/" rel="noopener ugc nofollow" target="_blank"> InversifyJS </a>。它提供了一种不同的方式来配置您的依赖项，但控制级别相同。[7]</p><p id="1e36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为DI使用一个框架是一件好事，因为您可以减少需要编写的样板文件的数量。框架还支持您以更少的努力维护您的代码。</p><h1 id="0dde" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="be4f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">依赖注入解决了静态类型、面向对象语言中的一个问题，如果它们不是静态类型系统，这个问题就不会存在。这个概念不是一个不惜任何代价实现的价值。通常情况下，最好先熟悉JavaScript语言，然后在适合自己的时候使用它——而不是采用C#或其他语言中已知的模式，或多或少地一对一，期望两个世界以相同的方式工作。</p><h2 id="8ba6" class="np lt iq bd lu nq nr dn ly ns nt dp mc lf nu nv me lj nw nx mg ln ny nz mi oa bi translated">进一步阅读</h2><div class="mx my gp gr mz na"><a href="https://medium.com/next-level-source-code/naming-variables-and-methods-write-better-code-part-2-5707e54250f1" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">命名变量和方法—编写更好的代码第2部分</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">如何编写表达自己的代码，以便更好地使用命名进行编码</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">medium.com</p></div></div><div class="nj l"><div class="oc l nl nm nn nj no kp na"/></div></div></a></div><div class="mx my gp gr mz na"><a href="https://arnoldcode.medium.com/increase-annual-salary-with-these-3-simple-tactics-145f8bc03c60" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">用这三个简单的策略增加年薪</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">成为他们梦寐以求的汽车！</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">arnoldcode.medium.com</p></div></div><div class="nj l"><div class="od l nl nm nn nj no kp na"/></div></div></a></div><div class="mx my gp gr mz na"><a href="https://medium.com/agileinsider/comparison-of-scrum-vs-scrumban-vs-kanban-1d1d2b9a9fd5" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">Scrum、Scrumban和看板的比较</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">挑选合适产品的快速指南！</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">medium.com</p></div></div><div class="nj l"><div class="oe l nl nm nn nj no kp na"/></div></div></a></div><h1 id="4b92" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><p id="8424" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">[1]<a class="ae kv" href="https://stackoverflow.com/questions/130794/what-is-dependency-injection" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/130794/what-is Dependency-injection</a><br/>【2】<a class="ae kv" href="https://stackoverflow.com/questions/14301389/why-does-one-use-dependency-injection/14301816" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/14301389/why-does-one-use-Dependency-injection/14301816</a><br/>【3】<a class="ae kv" href="https://stackify.com/dependency-injection/#:~:text=Dependency%20injection%20is%20a%20programming,class%20independent%20of%20its%20dependencies.&amp;text=That%20enables%20you%20to%20replace,one%20of%20its%20dependencies%20changed" rel="noopener ugc nofollow" target="_blank">https://stack ify . com/Dependency-injection/#:~:text = Dependency % 20 injection % 20 is&amp;text = That % 20 enables % 20 you % 20 to % 20 replace，one % 20 of % 20 its % 20 dependencies % 20 changed</a>。<br/>【4】<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Data _ structures</a><br/>【5】<a class="ae kv" href="https://www.htmlgoodies.com/beyond/javascript/duck-typing-in-javascript.html#:~:text=In%20Duck%20Typing%2C%20an%20object's,Typing%20for%20our%20own%20objectives" rel="noopener ugc nofollow" target="_blank">https://www . html goodies . com/beyond/JavaScript/duck-Typing-In-JavaScript . html #:~:text = In % 20 duck % 20 Typing % 2C % 20 an % 20 objects，键入% 20 for % 20 our % 20<br/>【6】</a><a class="ae kv" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank">https://angular.io/</a><br/>【7】<a class="ae kv" href="https://inversify.io/" rel="noopener ugc nofollow" target="_blank">https://inversify.io/</a></p></div></div>    
</body>
</html>