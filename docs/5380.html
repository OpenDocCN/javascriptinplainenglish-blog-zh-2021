<html>
<head>
<title>JavaScript — Validate Online Status</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript —验证在线状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-validate-online-status-7e195b6a89a8?source=collection_archive---------6-----------------------#2021-11-06">https://javascript.plainenglish.io/javascript-validate-online-status-7e195b6a89a8?source=collection_archive---------6-----------------------#2021-11-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="3176" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">现代web应用程序需要适应网络连接的变化。大量的应用程序在移动设备上使用。当用户在移动时，有可能会出现短暂的连接中断。不要丢失数据和用户体验！</h2><div class=""/><div class=""><h2 id="c5c0" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">了解<em class="kl"> window.navigator.onLine </em>和在线事件&amp;离线</h2></div><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/37537ddaf326965915ed7ed3b817b8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fEmXG5Q74cniuaw6tAUoQ.png"/></div></div></figure><p id="73bf" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">假设您的应用程序中有一个大约有8到10个字段的大型表单。用户在移动设备上访问该表单。当她填写表单并提交时，网络连接出现了短暂的中断。提交操作导致“未找到页面”消息。您可能认为这不是应用程序的错，但最终结果会让用户非常沮丧。实际上，数据丢失了。如果是电子商务应用程序，你会失去一个购买机会。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lu"><img src="../Images/6b0fbfccf8c079d47204c4c888456313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9C-RwbhtIQKFD5F4Ne3iQ.png"/></div></div><figcaption class="lv lw gj gh gi lx ly bd b be z dk">Did it happen to you? Type in a large form to see an error!</figcaption></figure><p id="250e" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">应用程序需要适应网络连接的变化。传统的网络技术认为网络连接是理所当然的。这主要是因为台式电脑通过可靠的网线连接。今天，大量的web应用程序运行在移动设备上。用户在使用您的应用程序时可能正在移动。现代web应用程序需要考虑网络速度的变化或连接的丢失，并确保数据不会丢失。</p><p id="1455" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">在这个<a class="ae lz" href="https://jsfiddle.net/kvkirthy/xukr0tv7/" rel="noopener ugc nofollow" target="_blank"> JS提琴</a>处检查代码样本。运行下面的示例应用程序。使用位于表单末尾的提交按钮。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="092a" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">在桌面上，使用谷歌浏览器，你可以通过“节流”选项切换在线/离线状态。见下图。打开开发工具(在<em class="mc">更多工具</em>菜单下的<em class="mc">开发工具</em>，导航到网络选项卡并切换节流选项。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi md"><img src="../Images/cda06aa3897ff89f376bf0814d345263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-lEb2Zda2KK5Px8iN1VylQ.png"/></div></div></figure><h1 id="5d83" class="me mf in bd mg mh mi mj mk ml mm mn mo kc mp kd mq kf mr kg ms ki mt kj mu mv bi translated">使用window.navigator.onLine</h1><p id="2d9d" class="pw-post-body-paragraph ky kz in la b lb mw jx ld le mx ka lg lh my lj lk ll mz ln lo lp na lr ls lt ig bi translated">浏览器本身支持验证应用程序是否在线。当应用程序在线时,<em class="mc"> window.navigator </em>上的属性<em class="mc"> onLine </em>返回<em class="mc"> true </em>(反之亦然)。考虑下面的代码片段。</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="d37d" class="ng mf in nc b gy nh ni l nj nk">// when the application is online<br/><strong class="nc ix"><em class="mc">  if (window.navigator.onLine) {</em><br/></strong>    // Submit the data from and show a message<br/>    /*<br/>     code to submit the form and complete the purchase process<br/>    */</span><span id="99fb" class="ng mf in nc b gy nl ni l nj nk">// The following statement shows a success message.<br/>    setTextValue(document.getElementById("statusTitle"), "Submit Successful! ");<br/>    setTextValue(document.getElementById("statusDescription"), "Thanks for filling up the form.")</span><span id="e6b9" class="ng mf in nc b gy nl ni l nj nk">// Set green color on a block for visual indication of success.<br/>    statusBlock.style.background = 'green';<br/><strong class="nc ix"><em class="mc">  } else {</em></strong></span><span id="a45e" class="ng mf in nc b gy nl ni l nj nk">// The following statement shows loss of connectivity, hopefully help users feel better about not filling the form again.<br/>    setTextValue(document.getElementById("statusTitle"), "You are offline.");<br/>    setTextValue(document.getElementById("statusDescription"), "Don't worry, you don't have to fill the form again. Come back to this page once you get the connectivity back!");</span><span id="8e4c" class="ng mf in nc b gy nl ni l nj nk">// Set red color on a block for visual indication of a problem.<br/>    statusBlock.style.background = 'red';<br/>  }</span></pre><p id="dc6b" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">请注意，您检查在线状态并允许或阻止表单提交操作。您可以将数据保存在cookie、会话存储或本地存储中。当用户返回到该页面时，查找未提交的草稿数据并预填表单。这些场景可以因应用而异。这只是一个演示在线状态检查的示例。在代码示例中，状态消息如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nm"><img src="../Images/b28984486853bd5c16ea7d936efd759b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IVF--GcQt-qpT0n26M0fog.png"/></div></div></figure><h1 id="1ef5" class="me mf in bd mg mh mi mj mk ml mm mn mo kc mp kd mq kf mr kg ms ki mt kj mu mv bi translated">线上和线下活动</h1><p id="c5d1" class="pw-post-body-paragraph ky kz in la b lb mw jx ld le mx ka lg lh my lj lk ll mz ln lo lp na lr ls lt ig bi translated">想象一下，动态检测在线/离线状态；提供视觉反馈。</p><p id="30b1" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">例如，禁用提交按钮并更改其颜色。</p><pre class="kn ko kp kq gt nb nc nd ne aw nf bi"><span id="a7e9" class="ng mf in nc b gy nh ni l nj nk">// triggered when the application loses connectivity<br/>window.addEventListener("<strong class="nc ix">offline</strong>", function(p) {<br/> // House keeping - clear old status messages<br/> clearMessages();<br/> <br/> // disable the button<br/> document.getElementById("submit").disabled = true;<br/> <br/> // turn the color gray indicating a disabled button<br/> document.getElementById("submit").style.backgroundColor = 'gray';<br/>});</span><span id="d149" class="ng mf in nc b gy nl ni l nj nk">// triggered when the application gains connectivity<br/>window.addEventListener("<strong class="nc ix">online</strong>", function(p) {<br/> // House keeping - clear old status messages<br/>  clearMessages();<br/>  <br/>    // enable the button<br/>  document.getElementById("submit").disabled = false;<br/>  <br/>  // turn the color blue indicating an enabled button<br/>  document.getElementById("submit").style.backgroundColor = "rgb(0, 46, 119)";<br/>});</span></pre><p id="7705" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated">当应用程序失去连接时，在表单的末尾看到一个禁用的按钮，</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c03c388061870a73cb294bda2005e2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*NuDk1w1Up6vFVuKS5zF2HA.png"/></div></figure><h2 id="ee11" class="ng mf in bd mg no np dn mk nq nr dp mo lh ns nt mq ll nu nv ms lp nw nx mu it bi translated">参考</h2><ul class=""><li id="cd8d" class="ny nz in la b lb mw le mx lh oa ll ob lp oc lt od oe of og bi translated">Navigator.onLine的MDN Web Docs文档—<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/onLine" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/Docs/Web/API/Navigator/onLine</a></li><li id="898d" class="ny nz in la b lb oh le oi lh oj ll ok lp ol lt od oe of og bi translated">“在线”和“离线”事件。要了解更多信息，请使用以下MDN Web文档—<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator/Online_and_offline_events" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/Docs/Web/API/Navigator/Online _ and _ offline _ events</a></li></ul><p id="5943" class="pw-post-body-paragraph ky kz in la b lb lc jx ld le lf ka lg lh li lj lk ll lm ln lo lp lq lr ls lt ig bi translated"><em class="mc">更多内容尽在</em><a class="ae lz" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="la ix"><em class="mc">plain English . io</em></strong></a></p></div></div>    
</body>
</html>