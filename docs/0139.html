<html>
<head>
<title>Can We Store JavaScript Objects in LocalStorage?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们可以在LocalStorage中存储JavaScript对象吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/can-we-store-javascript-objects-in-localstorage-b887181a7886?source=collection_archive---------9-----------------------#2021-01-08">https://javascript.plainenglish.io/can-we-store-javascript-objects-in-localstorage-b887181a7886?source=collection_archive---------9-----------------------#2021-01-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="66b6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">下面是如何在用户的web浏览器中的<code class="fe kf kg kh ki b">localStorage</code>中存储一个JavaScript对象。本地存储也被称为HTML5 <code class="fe kf kg kh ki b">localStorage</code>、<code class="fe kf kg kh ki b">window.localStorage</code>，或者浏览器的缓存。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a6edf920caff80637ef299f6c1b7b7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*30wGqPVT9_hdASOl"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Photo by <a class="ae kz" href="https://unsplash.com/@palesa08?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">palesa</a> on <a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="3e32" class="la lb iq bd lc ld le lf lg lh li lj lk jw ll jx lm jz ln ka lo kc lp kd lq lr bi translated">JavaScript中的<code class="fe kf kg kh ki b">localStorage</code>是什么？</h1><p id="f3df" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">当我们在JavaScript中调用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">window.localStorage</a></code>时，我们能够存储持久保存在客户端浏览器上的数据，并且可以从运行在该浏览器中的客户端代码访问这些数据。</p><p id="ad91" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这意味着当用户离开网站，稍后再回来时，您的JavaScript代码可以从<code class="fe kf kg kh ki b">window.localStorage</code>读取。</p><blockquote class="mt mu mv"><p id="ae62" class="ls lt mw lu b lv mo jr lx ly mp ju ma mx mq md me my mr mh mi mz ms ml mm mn ij bi translated">"只读<code class="fe kf kg kh ki b"><strong class="lu ir">localStorage</strong></code>属性允许您访问<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Document" rel="noopener ugc nofollow" target="_blank">Document</a></code>的<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Glossary/origin" rel="noopener ugc nofollow" target="_blank">原点</a>的<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage" rel="noopener ugc nofollow" target="_blank">Storage</a></code>对象；存储的数据跨浏览器会话保存。”— <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> MDN文档</a></p></blockquote><p id="828d" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">用户喜欢能够从他们离开的地方继续，尤其是不需要任何类型的帐户或登录。</p><p id="0da5" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">除非用户清除缓存，否则即使浏览器关闭，<code class="fe kf kg kh ki b"> localStorage</code>中的数据也会在浏览器会话之间持续存在。</p><blockquote class="mt mu mv"><p id="5c87" class="ls lt mw lu b lv mo jr lx ly mp ju ma mx mq md me my mr mh mi mz ms ml mm mn ij bi translated"><code class="fe kf kg kh ki b">localStorage</code>与<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" rel="noopener ugc nofollow" target="_blank">sessionStorage</a></code>类似，只是存储在<code class="fe kf kg kh ki b">localStorage</code>中的数据没有到期时间，而存储在<code class="fe kf kg kh ki b">sessionStorage</code>中的数据会在页面会话结束时(即页面关闭时)被清除— <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> MDN文档</a></p></blockquote><p id="6a76" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">在私密窗口中，当最后一个私密选项卡关闭时，会清除<code class="fe kf kg kh ki b">localStorage</code>数据，从而结束私密浏览会话。</p><blockquote class="mt mu mv"><p id="4188" class="ls lt mw lu b lv mo jr lx ly mp ju ma mx mq md me my mr mh mi mz ms ml mm mn ij bi translated">“<code class="fe kf kg kh ki b">localStorage</code>中的键和值<em class="iq">始终为UTF-16 <code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/DOMString" rel="noopener ugc nofollow" target="_blank">DOMString</a></code>格式的</em> <strong class="lu ir"> </strong>，每个字符使用两个字节。与对象一样，整数键会自动转换为字符串。— <a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank"> MDN文档</a></p></blockquote><p id="f73a" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果你熟悉使用<a class="ae kz" href="https://medium.com/swlh/what-is-json-used-for-in-javascript-programming-9d71284359a9" rel="noopener">JSON</a>(<a class="ae kz" href="https://medium.com/swlh/what-is-json-used-for-in-javascript-programming-9d71284359a9" rel="noopener">JavaScript Object Notation</a>)及其助手方法<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-use-stringify-and-parse-in-javascript-6b637b571a32" rel="noopener">JSON.stringify()</a></code>和<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-use-stringify-and-parse-in-javascript-6b637b571a32" rel="noopener">JSON.parse()</a></code>，那么你就知道如何在<code class="fe kf kg kh ki b">localStorage</code>中存储一个对象:作为一个JSON字符串。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="6f42" class="la lb iq bd lc ld nh lf lg lh ni lj lk jw nj jx lm jz nk ka lo kc nl kd lq lr bi translated">如何在<code class="fe kf kg kh ki b">localStorage</code>中存储JavaScript对象</h1><p id="1028" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">要在<code class="fe kf kg kh ki b">localStorage</code>中存储JavaScript对象，您需要<a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-use-stringify-and-parse-in-javascript-6b637b571a32" rel="noopener"> stringify并将对象解析</a>为JSON格式。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/e96ddf10667d1b46121b82cf5639cb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JKrjHhF6ZWGffSFvnhZk7w.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk"><a class="ae kz" href="https://gist.github.com/DoctorDerek/6fe4fc06374953be46b496ea37fabded" rel="noopener ugc nofollow" target="_blank">View raw code</a> as a GitHub Gist</figcaption></figure><p id="45f5" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">一旦我用stringify将<code class="fe kf kg kh ki b">pizza</code>对象转换成JSON字符串，我就用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem" rel="noopener ugc nofollow" target="_blank">window.localStorage.setItem()</a></code>将它添加到<code class="fe kf kg kh ki b">localStorage</code>中。在示例中，我使用了字符串键<code class="fe kf kg kh ki b">"pizza"</code>来存储对象。</p><p id="1735" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">为了稍后从<code class="fe kf kg kh ki b">localStorage</code>中调用它，我使用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem" rel="noopener ugc nofollow" target="_blank">window.localStorage.getItem()</a></code>检索为<code class="fe kf kg kh ki b">"pizza"</code>存储的JSON字符串，然后解析它。</p><p id="b653" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">要从<code class="fe kf kg kh ki b">localStorage</code>中移除一个JavaScript对象，可以使用同一个字符串键(<code class="fe kf kg kh ki b">"pizza"</code>)来调用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/removeItem" rel="noopener ugc nofollow" target="_blank">window.localStorage.removeItem()</a></code>。</p><p id="979a" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">你也可以用<code class="fe kf kg kh ki b"><a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/API/Storage/clear" rel="noopener ugc nofollow" target="_blank">window.localStorage.clear()</a></code>完全清除<code class="fe kf kg kh ki b">localStorage</code>，这将移除所有项目。</p><p id="e208" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">如果您自己尝试这段代码，请确保您是在一个有域的站点上(而不是在浏览器窗口的一个新选项卡中)这样做的。</p><p id="2bf5" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">你也可以使用Chrome DevTools 或Firefox的Storage Inspector 工具通过<a class="ae kz" href="https://developers.google.com/web/tools/chrome-devtools/storage/localstorage" rel="noopener ugc nofollow" target="_blank">直接在浏览器内部检查<code class="fe kf kg kh ki b">localStorage</code>。</a></p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="6e39" class="la lb iq bd lc ld nh lf lg lh ni lj lk jw nj jx lm jz nk ka lo kc nl kd lq lr bi translated">JavaScript中哪些对象是JSON安全的？</h1><p id="5eb3" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">认识到有些类型的数据不能作为JSON字符串存储在<code class="fe kf kg kh ki b">localStorage</code>中是很重要的。</p><p id="3e09" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">大多数<a class="ae kz" href="https://medium.com/p/671909def6ca" rel="noopener">原语类型</a>都是<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Description" rel="noopener ugc nofollow" target="_blank"> JSON安全的</a>:</p><ul class=""><li id="4c2b" class="nn no iq lu b lv mo ly mp mb np mf nq mj nr mn ns nt nu nv bi translated"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-a-boolean-in-javascript-98fdc8aec2a7" rel="noopener">布尔型</a></li><li id="cd8b" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-a-number-in-javascript-8d9024708153" rel="noopener">数字</a></li><li id="004e" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-a-string-in-javascript-a16b196915ff" rel="noopener">琴弦</a></li></ul><p id="81d8" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">但是以下是无效的JSON值:</p><ul class=""><li id="45d4" class="nn no iq lu b lv mo ly mp mb np mf nq mj nr mn ns nt nu nv bi translated"><code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/coding-at-dawn/how-to-check-for-undefined-in-javascript-bcedd62c8ad" rel="noopener">undefined</a></code></li><li id="22fb" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-a-function-in-javascript-986248827790" rel="noopener">功能</a></li><li id="bea1" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><a class="ae kz" href="https://medium.com/p/30c3f294ea65" rel="noopener">符号</a></li><li id="83e1" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/p/efd87ecfea66" rel="noopener">Date</a></code>物体</li><li id="4e20" class="nn no iq lu b lv nw ly nx mb ny mf nz mj oa mn ns nt nu nv bi translated"><code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/swlh/what-is-infinity-in-javascript-%EF%B8%8F-1faf82f100bc" rel="noopener">Infinity</a></code>和<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/coding-in-simple-english/how-to-check-for-nan-in-javascript-4294e555b447" rel="noopener">NaN</a></code>变成了<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-null-in-javascript-dffab64d8ed5" rel="noopener">null</a></code></li></ul><p id="62fc" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">最后，包括<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/coding-at-dawn/how-to-use-set-to-filter-unique-items-in-javascript-es6-196c55ce924b" rel="noopener">Set</a></code>和<code class="fe kf kg kh ki b"><a class="ae kz" href="https://medium.com/p/5147eedb26ce" rel="noopener">Map</a></code>的对象类型将只有它们的<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Enumerability_and_ownership_of_properties" rel="noopener ugc nofollow" target="_blank">可枚举属性</a>被序列化为JSON格式。</p><p id="5056" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">可枚举属性是那些以典型方式直接分配给对象的属性，所以您的<code class="fe kf kg kh ki b">Set</code>和<code class="fe kf kg kh ki b">Map</code>在JSON格式中将是空的(<code class="fe kf kg kh ki b">{}</code>)，除非您首先将它们转换成典型对象或数组。</p><p id="a98f" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><a class="ae kz" href="https://medium.com/javascript-in-plain-english/how-to-check-for-an-array-in-javascript-6ad20f7a0e21" rel="noopener">数组</a>工作正常，在JSON中，它们将使用<code class="fe kf kg kh ki b">[]</code>方括号来表示，而不是对象的<code class="fe kf kg kh ki b">{}</code>花括号。</p><p id="f29b" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">只要遵循其他规则，JSON对象(包括数组)可以毫无问题地嵌套在彼此内部。</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><h1 id="7ea1" class="la lb iq bd lc ld nh lf lg lh ni lj lk jw nj jx lm jz nk ka lo kc nl kd lq lr bi translated">Cookies和<code class="fe kf kg kh ki b">localstorage</code>一样吗？</h1><p id="615f" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">虽然<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies" rel="noopener ugc nofollow" target="_blank"> cookies </a>和<code class="fe kf kg kh ki b">localstorage</code>服务于相似的目的，即在用户会话之间持久化数据，但还是有一些关键的区别。</p><blockquote class="mt mu mv"><p id="2741" class="ls lt mw lu b lv mo jr lx ly mp ju ma mx mq md me my mr mh mi mz ms ml mm mn ij bi translated">“Cookies和本地存储服务于不同的目的。Cookies主要用于读取服务器端，而本地存储只能由客户端读取。”— <a class="ob oc ep" href="https://medium.com/u/75c6291d11e7?source=post_page-----b887181a7886--------------------------------" rel="noopener" target="_blank">阿努姆·西迪基</a> <a class="ae kz" href="https://medium.com/datadriveninvestor/cookies-vs-local-storage-2f3732c7d977" rel="noopener">在他的媒体博客</a>上</p></blockquote><p id="f9db" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">两者之间的另一个主要区别是大小:<code class="fe kf kg kh ki b">localStorage</code>提供每个域高达5MB(也称为“<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin" rel="noopener ugc nofollow" target="_blank">源</a>”)，如果用户清除浏览历史，它将作为浏览器缓存的一部分存储。</p><p id="4178" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">相比之下，cookies通常为4KB——没有足够的空间来存储很多数据，除了像用户认证令牌这样的东西。</p><p id="f653" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">这意味着虽然我们可以在<code class="fe kf kg kh ki b">localStorage</code>中存储JavaScript对象，但我们不太可能在cookies中存储JavaScript对象。</p><p id="74f6" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">不过，这是一个很大的技术差异，所以你可能会听到开发人员将<code class="fe kf kg kh ki b">localStorage</code>称为cookies，意思是“我们可以用JavaScript访问的特定于该用户的持久数据”</p><p id="22c2" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">总之，我们可以使用<a class="ae kz" href="https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5" rel="noopener ugc nofollow" target="_blank"> HTML5 </a>将JavaScript对象存储在<code class="fe kf kg kh ki b">localStorage</code>中，只要我们的对象是JSON安全的。</p><p id="5779" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated"><strong class="lu ir">快乐编码！</strong>🍕🍕🍕🍕🍕</p></div><div class="ab cl na nb hu nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ij ik il im in"><p id="e4ce" class="pw-post-body-paragraph ls lt iq lu b lv mo jr lx ly mp ju ma mb mq md me mf mr mh mi mj ms ml mm mn ij bi translated">德里克·奥斯汀博士是《职业规划:如何在6个月内成为成功的6位数程序员》一书的作者，该书现已在亚马逊上出售。</p></div></div>    
</body>
</html>