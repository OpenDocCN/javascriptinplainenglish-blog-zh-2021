<html>
<head>
<title>useReduxSaga — Use Redux-Saga with React Hooks in Hook Style</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">useReduxSaga —使用Redux-Saga和钩子样式的React钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/usereduxsaga-use-redux-saga-with-react-hook-in-hook-style-c7a6c804b7da?source=collection_archive---------8-----------------------#2021-07-12">https://javascript.plainenglish.io/usereduxsaga-use-redux-saga-with-react-hook-in-hook-style-c7a6c804b7da?source=collection_archive---------8-----------------------#2021-07-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4676" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">近年来，React Native已经成为我最喜欢的移动开发框架。之前和React-Redux和Redux-Saga合作过一个项目。它影响了对传奇风格逻辑的处理。</p><p id="3e6b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这几个月里，我用React hooks开始了另一个项目。Hooks API很棒，它使得开发速度更快，并且简化了本地状态管理。</p><p id="516a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有了React Redux的hook API(use selector、useDispatch、useStore)，将Redux集成到功能组件中不仅成为可能，而且变得简单。然而，减速器部分取决于开发人员，我们需要应用我们自己的风格。这就是为什么我写了这个库来使集成尽可能简单。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e78eca1f33e2209a92ea0a304c91b1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*INhySz8_4I6lNtTvsDRV9g.png"/></div></figure><div class="kq kr gp gr ks kt"><a href="https://github.com/springwong/use-redux-saga" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab fo"><div class="kv ab kw cl cj kx"><h2 class="bd io gy z fp ky fr fs kz fu fw im bi translated">springwong/use-redux-saga</h2><div class="la l"><h3 class="bd b gy z fp ky fr fs kz fu fw dk translated">react hook + react redux + saga的扩展库use-redux-saga是一个集成redux及其侧…</h3></div><div class="lb l"><p class="bd b dl z fp ky fr fs kz fu fw dk translated">github.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh ko kt"/></div></div></a></div></div><div class="ab cl li lj hr lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ig ih ii ij ik"><h1 id="2494" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated"><strong class="ak">设置</strong></h1><p id="3842" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">useReduxSaga必须与您的商店和sagaMiddleware集成</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="f9d5" class="mx lq in mt b gy my mz l na nb">// Your reducers object before combinedReducers<br/>const reducers = { todosReducer }</span><span id="5979" class="mx lq in mt b gy nc mz l na nb">// ...<br/>// Store.js / ts<br/>// init with createReducerManager<br/>createReducerManager(reducers)</span><span id="9fc2" class="mx lq in mt b gy nc mz l na nb">const sagaMiddleware = createSagaMiddleware({<br/>  sagaMonitor<br/>});</span><span id="620c" class="mx lq in mt b gy nc mz l na nb">// code to run sagaMiddleware after store creation<br/>sagaMiddleware.run(mySaga);<br/>// setRunSaga with sagaMiddleware.run<br/>setRunSaga(sagaMiddleware.run);</span></pre><h1 id="b631" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak">钩子</strong></h1><h1 id="a447" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak"> useReduxReducer </strong></h1><p id="26ed" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">useReduxReducer是一个钩子，用于在功能组件中创建一个Reducer。在这种情况下，会创建一个FC useEffect生命周期绑定缩减器。而还原者会在FC被摧毁的时候被清除。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="5563" class="mx lq in mt b gy my mz l na nb">const cleanUpWhenDestroy = true;<br/>const SomeScreen: FC = () =&gt; {<br/>    const [state] = useReduxReducer((state = {<br/>        value: 0<br/>    }, action : any) =&gt; {<br/>        switch (action.type) {<br/>            case 'add':<br/>                return { <br/>                    ...state,<br/>                    value: state.value + 1<br/>                };<br/>        }<br/>        return state;<br/>    }, "UniqueKey", cleanUpWhenDestroy);<br/>    return &lt;Text&gt;{state.value}&lt;/Text&gt;<br/>}</span><span id="92b9" class="mx lq in mt b gy nc mz l na nb">// or, reducer from file</span><span id="7fa1" class="mx lq in mt b gy nc mz l na nb">const [state] = useReduxReducer(reducer, "UniqueKey", cleanUpWhenDestroy);</span></pre><h1 id="5be8" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak"> useReduxReducerLocal </strong></h1><p id="6f72" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">一个更简单的useReduxReducer版本，不需要密钥或清理。<br/>提供reducerKey作为回报。如果您需要获得store的值，您可以从state[reducerKey]中获得。xxx</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1a4d" class="mx lq in mt b gy my mz l na nb">const SomeScreen: FC = () =&gt; {<br/>    const [state, reducerKey] = useReduxReducerLocal((state = {<br/>        value: 0<br/>    }, action : any) =&gt; {<br/>        switch (action.type) {<br/>            case 'add':<br/>                return { <br/>                    ...state,<br/>                    value: state.value + 1<br/>                };<br/>        }<br/>        return state;<br/>    });<br/>    return &lt;Text&gt;{state.value}&lt;/Text&gt;<br/>}</span></pre><h1 id="ac07" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak">使用佐贺</strong></h1><p id="53f7" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">本地saga实现，建议在跨屏幕/组件的情况下与useContext Provider一起使用。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="e9f8" class="mx lq in mt b gy my mz l na nb">const SomeScreen: FC = () =&gt; {<br/>    const dispatch = useDispatch()</span><span id="a0ef" class="mx lq in mt b gy nc mz l na nb">    useSaga(function*(params: any) {<br/>        yield takeLatest("TEST_1", params.add)<br/>    }, {<br/>        add: function* () {<br/>            yield delay(1000)<br/>            yield put({<br/>                type: 'provider_add'<br/>            })<br/>        },<br/>    })<br/>    return &lt;Button onPress={() =&gt; { dispatch("TEST_1" }}&gt;{"Click me"}&lt;/Button&gt;<br/>}</span><span id="3ba4" class="mx lq in mt b gy nc mz l na nb">// or, saga from saga file.<br/>    useSaga(someSaga, {})</span></pre><h1 id="2201" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak">使用简单</strong></h1><p id="49e6" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">一个更简单的钩子变体。只需要一个发生器函数。提供了一个调度方法来调度创建的传奇。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7c7f" class="mx lq in mt b gy my mz l na nb">const [dispatchPayload] = useSagaSimple(function* (payload: any) {<br/>        yield delay(1000)<br/>        yield put({<br/>            type: 'provider_add'<br/>        })<br/>    });</span><span id="d981" class="mx lq in mt b gy nc mz l na nb">// ...<br/>    return &lt;View onPress={() =&gt; {<br/>        dispatchPayload({<br/>            value: 0<br/>        })<br/>    }} /&gt;</span></pre><h1 id="ea67" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak"> useRedux </strong></h1><p id="e5b8" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">一个高级redux钩子提供了一组调用reducers的方法。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c95f" class="mx lq in mt b gy my mz l na nb">const [state, dispatches] = useRedux({<br/>        value: 0<br/>    }, {<br/>        add: (state, payload) =&gt; {<br/>            return {<br/>                ...state,<br/>                value: state.value + 1<br/>            }<br/>        },<br/>        minus: (state, payload) =&gt; {<br/>            return {<br/>                ...state,<br/>                value: state.value - 1<br/>            }<br/>        },<br/>    });</span><span id="7c0d" class="mx lq in mt b gy nc mz l na nb">// ..., code hints available in TypeScript for dispatches<br/>    return &lt;View onPress={() =&gt; {<br/>        dispatches.add({<br/>            // maybe some value<br/>        })<br/>    }} &gt;&lt;Text&gt;{state.value}&lt;/Text&gt; &lt;/View&gt;</span></pre><h1 id="8be5" class="lp lq in bd lr ls nd lu lv lw ne ly lz ma nf mc md me ng mg mh mi nh mk ml mm bi translated"><strong class="ak">限制(7月14日编辑)</strong></h1><p id="f94c" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">如果与useState混淆，内联函数会有一些限制，应该注意这一点。</p><p id="ee9e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">考虑下面功能组件中的实现。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="59b5" class="mx lq in mt b gy my mz l na nb">const Component: FC = () =&gt; {<br/>    const [index, setIndex] = useState(0);<br/>    const [testCall] = useSagaSimple(function* (action) {<br/>        // it always return initState = 0<br/>        console.log(`index directly from : ${index}`)<br/>        // value change by click<br/>        console.log(`index pass from dispatch: ${action.useStateVariables.index}`)<br/>    }, {index});<br/>    return &lt;TouchableOpacity onPress={<br/>            () =&gt; {<br/>                // add a for index from useState<br/>                setIndex(index + 1);<br/>                testCall({});<br/>            }<br/>        } style={style.button}&gt;<br/>            &lt;Text&gt;{"Press to trigger saga"}&lt;/Text&gt;<br/>    &lt;/TouchableOpacity&gt;<br/>}</span></pre><p id="05c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">索引没有因点击而改变，因为使用状态用不同的引用更新值。并且生成器函数将在第一次创建时创建这些值的快照。</p><p id="a8a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了获得更新后的值，useSagaSimple允许对象通过dispatch。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="626a" class="mx lq in mt b gy my mz l na nb">{index} as last parameter<br/>get() with action.useStateVariables.index</span></pre><p id="0cc7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然而，与普通redux-saga中的“yield select”不同，该值是在分派有效载荷时决定的。因此，如果该值在调用过程中被更改，该值将不会是最新的值。考虑常规实践中的saga文件，“yield select”是获取减速器值最新状态的更“saga”的方式。</p><p id="a66e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一个显示替代方案的示例:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c0cb" class="mx lq in mt b gy my mz l na nb">const Component: FC = () =&gt; {<br/>    const index = useRef(0);<br/>    const [state, dispatches, reducerKey] = useRedux({value: 0}, {<br/>        add: (state, payload) =&gt; { return { ...state, value: state.value + 1}},<br/>    })<br/>    const [testCall] = useSagaSimple(function* (action) {<br/>        // it has most updated value when index.current change.<br/>        console.log(`index directly from : ${index.current}`)<br/>        // or, for any reducer<br/>        const selectorValue = (yield select(state =&gt; {<br/>            return state[reducerKey]['value']<br/>        })) as number;<br/>        // it has most updated value also from redux state<br/>        console.log(`index directly from : ${selectorValue}`)<br/>    })</span><span id="674a" class="mx lq in mt b gy nc mz l na nb">    return &lt;TouchableOpacity onPress={<br/>            () =&gt; {<br/>                // add 1 for both ref and redux reducer<br/>                dispatches.add({})<br/>                index.current = index.current + 1;<br/>                testCall({});<br/>            }<br/>        } style={style.button}&gt;<br/>            &lt;Text&gt;{"Press to trigger saga"}&lt;/Text&gt;<br/>    &lt;/TouchableOpacity&gt;<br/>}</span></pre><p id="ec77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">useRef会产生一致的值，因为它的Ref中有一个一致的ref对象。而ref本身在FC生命周期内是不变的。</p><p id="d4bf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">yield select是检索reducer值的正确而正常的方法，无论在saga文件或内联函数中使用什么都是安全的。</p><p id="b93d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Github readme将对每种情况和预期行为进行总结。</p></div><div class="ab cl li lj hr lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ig ih ii ij ik"><p id="3e2b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">那是useReduxSaga库中hooks API的核心部分。更多主题请参考Github链接。希望你喜欢React Hook的redux-saga！</p><div class="kq kr gp gr ks kt"><a href="https://github.com/springwong/use-redux-saga" rel="noopener  ugc nofollow" target="_blank"><div class="ku ab fo"><div class="kv ab kw cl cj kx"><h2 class="bd io gy z fp ky fr fs kz fu fw im bi translated">springwong/use-redux-saga</h2><div class="la l"><h3 class="bd b gy z fp ky fr fs kz fu fw dk translated">react hook + react redux + saga的扩展库use-redux-saga是一个集成redux及其侧…</h3></div><div class="lb l"><p class="bd b dl z fp ky fr fs kz fu fw dk translated">github.com</p></div></div><div class="lc l"><div class="ld l le lf lg lc lh ko kt"/></div></div></a></div><p id="69e0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ni">更多内容看</em><a class="ae nj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ni">plain English . io</em></strong></a></p></div></div>    
</body>
</html>