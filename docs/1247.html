<html>
<head>
<title>Your PWA is going to break in August 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你的PWA要在2021年8月破了</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/your-pwa-is-going-to-break-in-august-2021-34982f329f40?source=collection_archive---------0-----------------------#2021-03-16">https://javascript.plainenglish.io/your-pwa-is-going-to-break-in-august-2021-34982f329f40?source=collection_archive---------0-----------------------#2021-03-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/c76cae46b22cbb130328af1a72671de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*nHZ8y3Af5mcuTLy6w15xIA.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">My (totally random) prediction: 52% of all PWAs will break with Chrome 93</figcaption></figure><blockquote class="jv jw jx"><p id="6ff3" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">更新:4月14日，谷歌宣布他们将暂停推出这一功能的计划。查看我的后续文章 <a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/google-pauses-plan-to-break-your-pwa-d249bca27852?source=friends_link&amp;sk=3790f72381ad47fc41089429a6e13807"> <strong class="kb io">这里</strong> </a> <strong class="kb io">。</strong></p></blockquote><p id="42a0" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">如果您有PWA，并且最近查看了您的控制台或应用程序清单，您可能会注意到以下消息:</p><blockquote class="jv jw jx"><p id="fd7b" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">页面无法脱机工作。从Chrome 93开始，可安装性标准正在改变，该网站将无法安装。<a class="ae kx" href="https://developer.chrome.com/blog/improved-pwa-offline-detection" rel="noopener ugc nofollow" target="_blank">https://developer . chrome . com/blog/improved-pwa-offline-detection</a>了解更多信息</p></blockquote><p id="a574" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">或者，如果您使用Edge:</p><blockquote class="jv jw jx"><p id="94b5" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">无法安装网站:页面无法脱机工作。在Edge 93于2021年8月稳定发布后，该页面将不被视为可安装。</p></blockquote><p id="e74d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">你看，在Chrome 93之前，你所要做的就是让Chrome可以安装你的应用程序,<em class="ka">假装</em>在你的服务工作器中监听fetch事件。你甚至不需要做任何事。你所要做的就是注册一个监听器。就这样。很简单。</p><p id="9966" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我猜谷歌对黑客攻击有异议。说实话，可能有太多的网站——其中许多可能根本就不应该安装——使用了这样丑陋的黑客手段:</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Nope, this won’t work anymore!</figcaption></figure><p id="f663" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">随着Chrome即将发布，你必须真正利用缓存，否则你的PWA将不再可安装。</p><h2 id="080e" class="lh li in bd lj lk ll dn lm ln lo dp lp ky lq lr ls kz lt lu lv la lw lx ly lz bi translated">为什么会这样？</h2><p id="06d6" class="pw-post-body-paragraph jy jz in kb b kc ma ke kf kg mb ki kj ky mc km kn kz md kq kr la me ku kv kw ig bi translated">谷歌的信条是PWA永远不应该显示Chrome的默认离线屏幕。相反，所有的pwa应该可以脱机使用，或者显示某种类型的<a class="ae kx" href="https://web.dev/offline-fallback-page/" rel="noopener ugc nofollow" target="_blank">脱机页面作为后备</a>。感谢上面的黑客，你实际上没有被迫让你的PWA离线工作。现在你会(或者你必须找到一个更丑陋的黑客不需要)。</p><figure class="lb lc ld le gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/60e0a938c86fe9d986b353886d84155e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LRt_eLlmF_aYu8KKk0N3eQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">A PWA shouldn’t show the Dino page… for some reason</figcaption></figure><p id="5e16" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">现在，为什么一个除了说“你离线了”之外几乎没有任何用处的自定义页面比默认的恐龙页面更好的退路还有点不清楚。人们确实知道那一页是什么意思。它为如何恢复在线提供了清晰的方向。而且它是由谷歌自己建立的(所以它不像是把流量重定向到某个不相关的第三方网站)。</p><p id="01c1" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">但显然，谷歌不喜欢自己的解决方案。所以你必须自己建立一个(很可能没有谷歌的好)。也就是除非你能做的比<a class="ae kx" href="https://en.wikipedia.org/wiki/Dinosaur_Game" rel="noopener ugc nofollow" target="_blank">恐龙游戏</a>明显好)。</p><figure class="lb lc ld le gt jo gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/4c68ec8b540e2c7fdb213527a5abc1b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*BVUkNqTmy2UdMmSjRE1H5g.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Fix your PWA!</figcaption></figure><p id="c95c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">旁注:我正在构建<a class="ae kx" href="https://progressier.com" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> Progressier </strong> </a>，特别是为了让你不必应对谷歌/苹果/微软/三星/火狐的最新奇思妙想(我们会为你处理这些——而且是免费的)，但如果你绝对坚持要把这些强加给自己，下面是你必须做的事情，让你的应用程序变得兼容。</p><h2 id="f14d" class="lh li in bd lj lk ll dn lm ln lo dp lp ky lq lr ls kz lt lu lv la lw lx ly lz bi translated">我能做什么来解决这个问题？</h2><p id="7d79" class="pw-post-body-paragraph jy jz in kb b kc ma ke kf kg mb ki kj ky mc km kn kz md kq kr la me ku kv kw ig bi translated">首先，您必须填充您的“fetch”处理程序，以便它实际上做一些有用的事情，例如缓存资源。有两种主要的方法可以做到这一点。</p><ul class=""><li id="73d3" class="ml mm in kb b kc kd kg kh ky mn kz mo la mp kw mq mr ms mt bi translated">使用<a class="ae kx" href="https://web.dev/offline-cookbook/" rel="noopener ugc nofollow" target="_blank"> <em class="ka">网络回落到缓存</em> </a>策略，您的服务人员将首先尝试从您的服务器检索资源。然后，当它不能这样做时——例如，因为您离线——从缓存中检索它(如果它存在)。</li></ul><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div></figure><ul class=""><li id="58ce" class="ml mm in kb b kc kd kg kh ky mn kz mo la mp kw mq mr ms mt bi translated">使用<a class="ae kx" href="https://web.dev/stale-while-revalidate/" rel="noopener ugc nofollow" target="_blank"><em class="ka">Stale-While-re validate</em></a>策略，您的服务人员首先查看缓存，同时向服务器发出请求。如果资源存在于缓存中，它会立即将它发送回客户端——导致看似瞬时的负载。当(并且如果)服务器成功响应请求时，它将在缓存中保存更新的响应。这种方法的主要缺点是您将提供的资源总是比落后<em class="ka">一个版本。</em></li></ul><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="5db2" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">还有几个其他有用的策略。使用<em class="ka">缓存优先</em>，您根本不需要重新验证资源。资源一旦在缓存中就永远不会被更新——但是这个策略也可以减轻你的AWS账单。使用<em class="ka">纯网络</em>，您根本不使用缓存，因此资源总是新鲜的。还有一种<em class="ka">仅缓存</em>策略，这几乎没有用。</p><p id="4635" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">其次，您可能还必须在“install”事件处理程序中预先缓存资源。有趣的事实:这个事件在安装服务人员时触发。而不是当用户安装了你的应用。出于某种原因，我看到许多开发人员混淆了这两个概念。</p><figure class="lb lc ld le gt jo"><div class="bz fp l di"><div class="lf lg l"/></div></figure><h2 id="5e93" class="lh li in bd lj lk ll dn lm ln lo dp lp ky lq lr ls kz lt lu lv la lw lx ly lz bi translated">资源缓存的问题</h2><p id="83b2" class="pw-post-body-paragraph jy jz in kb b kc ma ke kf kg mb ki kj ky mc km kn kz md kq kr la me ku kv kw ig bi translated">因此，服务人员离线处理的方式仍然存在一个主要问题。当你更新你的应用程序和创建新的资源时，如果你想让所有东西都离线工作，你必须记得预先缓存它们。这可能会带来很多麻烦——尽管像<a class="ae kx" href="https://developers.google.com/web/tools/workbox" rel="noopener ugc nofollow" target="_blank"> Workbox </a>这样的库确实让事情变得简单了一些。无论如何，这凸显了PWAs最糟糕的一面。制作PWA不是一蹴而就的。有很多东西你必须定期更新，否则它们会坏掉。</p><p id="ac54" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">在<a class="ae kx" href="https://progressier.com" rel="noopener ugc nofollow" target="_blank"> Progressier </a>，我们的解决方案(截至2021年3月)目前部分兼容Chrome 93。大多数有Progressier的pwa已经离线工作了——尽管这有点依赖于你的应用程序的确切结构。到Chrome 93发布时，我们将完全兼容，这样，运行Progressier的每个应用程序都可以离线使用，不管它们是如何构建的。</p><p id="067e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们将如何解决上述问题:我们的机器人将定期访问您的应用程序，并检查网络请求。当我们看到新资源时，我们会自动将它们添加到要缓存的资源列表中。使用Workbox，您必须手动构建缓存策略。使用Progressier，策略会自动为您建立。</p><p id="d225" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">你有什么问题吗？或者需要帮助使您的PWA Chrome 93兼容？评论或发电子邮件给我在kevin@progressier.com</p></div></div>    
</body>
</html>