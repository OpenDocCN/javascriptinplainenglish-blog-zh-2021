<html>
<head>
<title>Getting Started with the JavaScript Fetch API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript获取API入门</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-fetch-api-7fb542b25f4d?source=collection_archive---------7-----------------------#2021-03-25">https://javascript.plainenglish.io/the-fetch-api-7fb542b25f4d?source=collection_archive---------7-----------------------#2021-03-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/772d1373f80f199301212fa0c2cb7ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgXNZSzHQ50xTXmLp1T0Fg.jpeg"/></div></div></figure><p id="11b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">与API(应用程序编程接口)通信是web开发的一个关键部分，是构建全栈应用程序所必需的。这篇博客将讨论如何使用JavaScript中内置的Fetch API与外部API进行通信。如果您是JavaScript新手，本教程将一步一步地介绍所有内容，并帮助您理解代码及其背后的概念。</p><h1 id="83e3" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">如何构造获取请求</h1><p id="6e0c" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我们可以用<strong class="jx io"> fetch </strong>函数开始一个获取请求，并向它传递一个URL参数。除非另有说明，否则默认情况下，这将向该地址发送所谓的“GET”请求，并以承诺作为响应。承诺代表异步事件的最终实现或失败。</p><p id="8231" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦我们从fetch请求中收到一个承诺，我们就可以使用另一个叫做<strong class="jx io">的JavaScript方法。然后()</strong>来回报这个承诺。这个方法采用两个回调函数作为参数，一个处理承诺的成功，一个处理失败。这是什么意思？因为fetch请求试图到达一个API并返回一个异步承诺，所以在这个过程中可能会出错。服务器可能出错，您可能失去互联网连接，传递给fetch的URL可能拼写错误。既然承诺有可能落空，那<strong class="jx io">。然后()</strong>被装备来处理故障，甚至中继一个错误消息来指示哪里出错了。</p><p id="dd91" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以，我们叫<strong class="jx io">。然后()</strong>在获取之后做一些叫做数据解析的事情。我们使用另一种内置方法<strong class="jx io">。json() </strong>将获取的响应数据转换成JavaScript对象符号(json)数据，这样更容易阅读和处理。我们然后称之为<strong class="jx io">。然后()</strong>再次对解析后数据进行实际操作，比如控制台日志记录。</p><p id="d611" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是我们的样本获取请求的样子:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">The arguments ’response’ and ‘data’ can be named whatever you want, but following this naming conventions makes your code easier to read and understand</figcaption></figure><p id="bea3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就这么简单！</p><p id="9824" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果看起来有点混乱，不要担心。在下一节中，我们将详细介绍创建和测试第一个获取请求的每个步骤。</p><h1 id="16e5" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">设置您自己的提取请求</h1><p id="5f0e" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">要编写自己的获取请求，您唯一需要的是安装在您机器上的最新版本的<a class="ae mg" href="https://nodejs.dev/learn/how-to-install-nodejs" rel="noopener ugc nofollow" target="_blank">节点</a>。我们可以从创建一个锅炉板<em class="mh">index.html</em>文件和一个<em class="mh"> index.js </em>文件开始。在HTML文件中，添加一个“h1”标记和一个“button”标记。在“button”标签下面，创建一个“div”标签，使用“image-container”类。我们将在这里添加我们的猫图片，但是现在你的浏览器应该是这样的:</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/43f025286ce0bb082242e241638c1861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KTpzKmo-J6WW4Rq7RCBMTQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">run ‘open index.html’ to view your html in the browser</figcaption></figure><p id="fcd5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将向一个免费的API写一个获取请求，以获取猫的图片并在我们的浏览器中显示它们。我想不出比免费的可爱猫咪图片更好的使用fetch API的方法了。你可以在<a class="ae mg" href="https://docs.thecatapi.com/" rel="noopener ugc nofollow" target="_blank">https://docs.thecatapi.com/</a>查看API文档，但是对于这个请求，你只需要跟着代码走就可以了。</p><p id="63e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将复制博客前面的获取请求，但是将示例url替换为cat api url。它应该是这样的:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="6dfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">保存您的工作，返回浏览器并刷新页面。如果您查看开发人员控制台(右键单击，选择Inspect，转到console选项卡)，您会将我们的API给我们的响应解析为JSON数据！</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/c20d28eb045c99fc1861e65e45500ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iz3eSkZzyKbd_rRAs7P1Yw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Please note, I have clicked the small gray arrow on the far left to expand this array and view the object at index[0]</figcaption></figure><h2 id="52f9" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">使用数据</h2><p id="7b70" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">恭喜你已经写了你的第一个获取请求！但是，就在几句话前承诺的可爱的猫图片在哪里呢？使用fetch访问API的全部目的是接收或发送数据，并实际使用它做一些事情。有很多方法可以实现这一点，但是让我们使用一些普通的JavaScript来创建一些HTML元素并将它们添加到DOM中。我们的代码现在应该是这样的:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">The “src’” attribute on the ‘img’ tag can be set in JavaScript with the above dot notation</figcaption></figure><p id="8956" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意，我们不只是将图像标签的来源分配给从获取请求中获取的“数据”对象。使用API最重要的部分之一是我们如何使用它们返回给我们的数据。因为这个API调用返回了一个名为“data”的数组，其中有一个对象，所以我们在第6行使用括号表示索引0来引用它。一旦到了索引0，或者数组中的第一个位置(在本例中是唯一的位置)，我们就使用点符号来引用“url”键值。从而为我们提供了之前看到的控制台记录的字符串“https://CD N2 . the catapi . com/images/96n . jpg”。这个字符串是我们的图像标签的url，它生成了一只可爱的猫的图像。</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/87765803c432b252602dfeb2752607ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IupvQtOn3tI7EeJdRbA9DQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">A cat on his way to the rodeo</figcaption></figure><p id="7c5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您仍然不确定我们如何从fetch请求返回的“data”对象中获得url，请查看控制台上返回的对象。您需要对分解对象和数组有一个相当好的理解，才能找到您想要的值。当您不确定会发生什么时，打印获取请求的响应是一种可视化数据的好方法。从那里，您可以使用开发人员控制台打开任何下拉菜单，并更深入地挖掘您的数据。</p><h2 id="2955" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">关于异步函数的更多信息</h2><p id="1ceb" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">获取请求的目的是使用API异步发送或检索数据。异步的意思和它听起来的一样，就是这个请求像我们文件中的其他代码一样超时执行。换句话说，我们的应用程序不会在运行JavaScript的其余部分之前等待获取请求完成，当然，除非我们要求它这样做。</p><p id="4f1b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您想查看如何工作的示例，请在最后一个。<strong class="jx io">然后()</strong>方法完成，在浏览器开发者控制台看它登录到哪里。您会发现，尽管fetch请求是在控制台日志之前写的，并且JavaScript是从上到下执行的，但是控制台日志会先打印出来！这是因为fetch请求需要一些时间来完成，虽然它可能很快，但它仍然是异步的，并且必须等待响应，因为其他代码是从文件中直接读取的。</p><h1 id="3bbc" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">不同类型的获取请求</h1><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/c06743435bf1c994abb931d2c70c61d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*oLlvd1jna9OgfMCJ7SXTGw.gif"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">A failed fetch request, but a great attempt</figcaption></figure><p id="3e4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当使用fetch请求访问数据时，我们实际上是使用HTTP(超文本传输协议)方法与我们的API进行通信。从技术上讲，大约有39种HTTP方法，但是最重要的是GET、POST、DELETE、PATCH和PUT。我将对每一个都举一个例子并做一个简要的解释。</p><h2 id="73c6" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">得到</h2><p id="123e" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">HTTP请求GET方法可能是最容易理解的。我们获取单幅猫图片的例子演示了一个GET请求。您不应该使用GET请求来发送数据，它们只应该用于检索数据。</p><p id="ca85" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">示例:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">A GET request</figcaption></figure><h2 id="7925" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">邮政</h2><p id="2c88" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">POST方法用于向特定端点提交信息或数据。例如，在社交媒体网站上创建新的个人资料。在POST请求中，需要使用fetch方法的第二个参数。这将是一个init对象，可以有几个属性，但这里需要的是“方法”、“主体”和“标题”属性。“method”属性定义了我们使用的HTTP方法，这里是POST。请求的“主体”表示我们发送的要更新到API的数据，在本例中是新的概要信息。“headers”属性充当将名称映射到值的方式，例如这里将说内容是在json数据中解码的。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">JSON.stringify() converts a JavaScript object into a JSON string that the API endpoint can work with</figcaption></figure><p id="42fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意，POST请求不一定要返回任何要使用的特定数据，但是如果API端点指定了返回数据，它就可以返回。它将返回一个promise对象，告诉您您的请求是否成功。将它解析为JSON后，您可以在控制台记录它，根据响应执行一些基于逻辑的操作，或者按照您想要的方式使用它。</p><h2 id="eebb" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">删除</h2><p id="f9fe" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">删除请求的结构类似于POST请求，因为它需要一个“方法”和一个“头”属性。假设我们想删除一张旧的Instagram图片，并请求获取。这张图片可能有一个Id属性，允许我们引用它。我们可以在我们的fetch请求中插入URL，并将我们instagram帖子的Id传递给它以删除它！</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Using back-ticks around the URL, and the dollar sign and curly braces around our pictures Id, we can delete the Instagram picture with the Id of 24</figcaption></figure><h2 id="3503" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">修补</h2><p id="f646" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">补丁方法类似于“编辑”方法，因为它部分地修改我们的数据。我们可能会使用补丁请求来编辑我们的谷歌帐户，以更新我们的电话号码。就像删除请求一样，补丁请求传递带有“方法”、“主体”和“头”的对象的第二个参数。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="a3a7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">再次注意，我们在URL中插入了我们谷歌账户的Id。这就要求我们专门寻找我们的个人资料。这里的“正文”将作为JSON对象接收，用字符串表示我们的新电话号码。尽管我们的个人资料可能有很多不同的东西我们可以改变，比如照片、密码等等，因为这是一个补丁请求，它会用一些新数据“修补”我们现有的数据，所以我们不需要发送一个全新的“个人资料”对象。</p><h2 id="8a3a" class="mk ku in bd kv ml mm dn kz mn mo dp ld kg mp mq lh kk mr ms ll ko mt mu lp mv bi translated">放</h2><p id="f4d7" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">最后但同样重要的是PUT方法。这类似于开机自检方法，除了PUT能够覆盖。何时使用PUT与POST主要取决于所谓的幂等性。这个概念有点棘手，但可以将其视为无论执行多少次都能够产生相同结果的能力。也就是说，PUT方法创建了一个全新的东西的实例，而PUT方法用一个全新的对象替换现有的对象，并覆盖最初在端点的任何东西。</p><p id="4d04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">PUT用于当您知道您试图访问的确切URL时，而POST则不知道。例如，如果您在网站上订购寿司，您会希望使用PUT请求，因为如果它因为某种原因多次触发，它发送的实例将保持为单个实例。一个帖子请求会持续发出多个请求，你会被太多寿司卡住(尽管我不认为有可能吃太多寿司)。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h1 id="cb43" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">资格证书</h1><p id="94e8" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">我想简单讨论一下凭据，因为它们对HTTP请求至关重要，尤其是当您开始使用安全数据构建应用程序时。凭据是传递给提取请求的init对象的另一个属性，指示端点是否应该发送cookie。默认情况下，它被设置为“同原点”，这意味着如果URL与调用它的脚本位于同一原点，则可以发送用户凭据。您可以选择“忽略”任何cookie，也可以将“包含”传递给“凭据”，以便始终在用户和端点之间发送cookie。</p><p id="81db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">某些API可能需要在获取数据或使用其他HTTP方法的获取请求中包含凭据。要包含凭据，只需将其添加到init对象中，如下所示:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">You do not have to include the method here, but I chose to as to better illustrate what type of method this is</figcaption></figure><h1 id="48d7" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">熟能生巧</h1><p id="143d" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果您是第一次接触获取请求，或者只是第一次接触JavaScript，这看起来会有很多令人困惑的信息。我强烈建议您尽可能多地写下这些请求。为了不同的目的，在init对象中尝试不同的属性。尝试使用fetch构建一个小型CRUD(创建读取更新删除)应用程序。请随意在下面留下问题和评论，一如既往，快乐编码！</p><p id="878b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mh">资源:</em></p><div class="my mz gp gr na nb"><a href="https://github.com/AidanMcB/fetchBlog" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd io gy z fp ng fr fs nh fu fw im bi translated">Aidan MBC/fetch blog</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">通过在GitHub上创建帐户，为Aidan mbb/fetch blog的开发做出贡献。</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np jt nb"/></div></div></a></div><div class="my mz gp gr na nb"><a href="https://thecatapi.com/docs.html?ref=apilist.fun" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd io gy z fp ng fr fs nh fu fw im bi translated">卡特彼勒API -卡特彼勒即服务。</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">一个关于猫的公共服务应用编程接口，在制作新的应用、网站或服务时可以免费使用。</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">thecatapi.com</p></div></div><div class="nk l"><div class="nq l nm nn no nk np jt nb"/></div></div></a></div><div class="my mz gp gr na nb"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd io gy z fp ng fr fs nh fu fw im bi translated">获取应用编程接口</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">获取API提供了获取资源的接口(包括通过网络)。对…似乎很熟悉</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">developer.mozilla.org</p></div></div><div class="nk l"><div class="nr l nm nn no nk np jt nb"/></div></div></a></div><p id="fabc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mh">更多内容看</em><a class="ae mg" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mh">plain English . io</em></strong></a></p></div></div>    
</body>
</html>