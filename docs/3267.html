<html>
<head>
<title>How to Use Web Workers in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中使用Web Workers</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/web-worker-in-react-9b2efafe309c?source=collection_archive---------0-----------------------#2021-07-04">https://javascript.plainenglish.io/web-worker-in-react-9b2efafe309c?source=collection_archive---------0-----------------------#2021-07-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b7d6" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">什么是web workers，为什么使用它们，如何在React中实现它们？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8219a1e378c694d5c67df1b29f766dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ctl468OuFYouknh9Urlxw.jpeg"/></div></div></figure><p id="0c06" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">JavaScript是单线程的。这是什么意思，什么是线程？</p><p id="4b71" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">线程是一个执行上下文，它是CPU执行指令流所需的所有信息。所以通常情况下，JavaScript应用程序包含在一个线程中。</p><h1 id="17d7" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">缺点？</h1><p id="52f6" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">想象一下，在您的web应用程序中，您需要处理一个很长的任务。DOM，也就是通用语言中的网页，将会冻结，因为解释器需要在转到下一个任务之前完成这个任务。它不能同时处理两个任务，所以当它完成长任务时，只有那时它才能更新DOM并起死回生。为了避免这种情况，解决方案是使用web worker。</p><h1 id="c035" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">什么是网络工作者？</h1><p id="b3db" class="pw-post-body-paragraph ko kp in kq b kr mc jo kt ku md jr kw kx me kz la lb mf ld le lf mg lh li lj ig bi translated">web worker是在后台独立执行的JavaScript脚本。网络工作者通常能够利用多个CPU。</p><p id="e8cb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这种情况下，我们将看到如何在React中使用web worker。</p><p id="1961" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">设置:</p><ul class=""><li id="2e9a" class="mh mi in kq b kr ks ku kv kx mj lb mk lf ml lj mm mn mo mp bi translated">安装Node.js，让我们可以访问npm和npx:<a class="ae mq" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/download/</a></li><li id="8f77" class="mh mi in kq b kr mr ku ms kx mt lb mu lf mv lj mm mn mo mp bi translated">通过在终端中运行生成一个React项目:</li></ul><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="408a" class="nb ll in mx b gy nc nd l ne nf"><strong class="mx io">npx create-react-app replace-me-with-the-name-of-the-app — template typescript</strong></span></pre><p id="7c71" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果该命令不起作用，请验证节点和npm的版本。您的计算机上需要有节点&gt; = 10.16和npm &gt;= 5.6。</p><p id="cabb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们玩得开心。</p><p id="1f5c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了能够与worker通信，我们将使用onMessage和postMessage()。</p><p id="0910" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们要编写将由web worker执行的Fibonacci函数。</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="fc60" class="nb ll in mx b gy nc nd l ne nf">//fibo.worker.js<br/>// eslint-disable-next-line import/no-anonymous-default-export<br/>export default () =&gt; {<br/>  // eslint-disable-next-line no-restricted-globals<br/>  self.onmessage = (message) =&gt; {<br/>    const nbr = message.data;<br/>    var n1 = 0;<br/>    var n2 = 1;<br/>    var somme = 0;<br/><br/><br/>    for (let i = 2; i &lt;= nbr; i++) {<br/>      somme = n1 + n2;<br/><br/><br/>      n1 = n2;<br/><br/><br/>      n2 = somme;<br/>    }<br/><br/><br/>    const result = nbr ? n2 : n1;<br/><br/><br/>    postMessage(result);<br/>  };<br/>};</span></pre><p id="2348" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了让linter开心，我们需要添加一些线。</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="9177" class="nb ll in mx b gy nc nd l ne nf">// eslint-disable-next-line import/no-anonymous-default-export<br/><br/>// eslint-disable-next-line no-restricted-globals</span></pre><p id="9c2f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们要编写我们的Workerbuilder，因为在构建WebPack之后，所有东西都将被捆绑成f18 f83d 0–6ed 0–484 e-86 f1–6d 1938793085。例如，在这种情况下。我们将失去与文件的链接。</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="9197" class="nb ll in mx b gy nc nd l ne nf">//woker-builder.js<br/>export default class WorkerBuilder extends Worker {<br/>  constructor(worker) {<br/>    const code = worker.toString();<br/>    const blob = new Blob([`(${code})()`]);<br/>    return new Worker(URL.createObjectURL(blob));<br/>  }<br/>}</span></pre><p id="66e4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们有我们的工人和工人建设者。让我们使用它们。</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="35eb" class="nb ll in mx b gy nc nd l ne nf">import WorkerBuilder from './worker/woker-builder';<br/>import Worker from './worker/fibo.worker';<br/></span><span id="f333" class="nb ll in mx b gy ng nd l ne nf">instance = new WorkerBuilder(Worker);</span></pre><p id="87cf" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们将添加一个按钮，以便能够为工作者触发消息，并且我们将添加一个侦听器来显示来自工作者的回复。</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="0815" class="nb ll in mx b gy nc nd l ne nf">componentDidMount() {<br/>    instance.onmessage = (message) =&gt; {<br/>      if (message) {<br/>        console.log("Message from worker", message.data);<br/>      }<br/>    };<br/>  }</span><span id="ad8d" class="nb ll in mx b gy ng nd l ne nf">&lt;button onClick   ​={() =&gt; instance.postMessage(5)}&gt;<br/>  Send Message<br/>&lt;/button&gt;</span></pre><p id="8fe4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io"> App.tsx </strong>应该是这样的:</p><pre class="kd ke kf kg gt mw mx my mz aw na bi"><span id="e857" class="nb ll in mx b gy nc nd l ne nf">import React, { Component } from "react";<br/>import logo from "./logo.svg";<br/>import "./App.css";<br/>import WorkerBuilder from "./worker/woker-builder";<br/>import FiboWorker from "./worker/fibo.worker";<br/></span><span id="0ef7" class="nb ll in mx b gy ng nd l ne nf">const instance = new WorkerBuilder(FiboWorker);</span><span id="7f75" class="nb ll in mx b gy ng nd l ne nf">class App extends Component {<br/>  componentDidMount() {<br/>    instance.onmessage = (message) =&gt; {<br/>      if (message) {<br/>        console.log("Message from worker", message.data);<br/>      }<br/>    };<br/>  }<br/></span><span id="3436" class="nb ll in mx b gy ng nd l ne nf">  render() {<br/>    return (<br/>      &lt;div className="App"&gt;<br/>        &lt;header className="App-header"&gt;<br/>          &lt;img src={logo} className="App-logo" alt="logo" /&gt;<br/>          &lt;p&gt;<br/>            Web worker in React<br/>          &lt;/p&gt;<br/>          &lt;button<br/>            onClick={() =&gt; {<br/>              instance.postMessage(5);<br/>            }}<br/>          &gt;Send Message&lt;/button&gt;<br/>        &lt;/header&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/></span><span id="8b83" class="nb ll in mx b gy ng nd l ne nf">export default App;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f16c2f5710d713a534465d7fdea960ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*wP2pukR_jDomMc1HF8gxGA.png"/></div></figure><p id="0e01" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们点击发送消息时，控制台应该是这样的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/47a076418151a6b751b076042d0f6d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEExEKHvUzJjkrCwx0zogA.png"/></div></div></figure><p id="b354" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果我们深入到控制台，在sources选项卡中，我们可以看到右上角有两个线程—主线程和名为f18f 83d 0–6ed 0–484 e-86 f1–6d 1938793085的fibo工作线程。</p></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/acb65e05bf64eaee302591b39f16f2e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IwjiCLgvxXltClcB8cOmlg.png"/></div></div></figure><p id="7b00" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我希望你能从这篇文章中学到一些东西，谢谢你的阅读。</p></div></div>    
</body>
</html>