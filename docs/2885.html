<html>
<head>
<title>Create API Endpoints for REST API in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中为REST API创建API端点</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-api-endpoints-for-rest-api-in-nodejs-ec688c18aaa?source=collection_archive---------3-----------------------#2021-06-12">https://javascript.plainenglish.io/making-api-endpoints-for-rest-api-in-nodejs-ec688c18aaa?source=collection_archive---------3-----------------------#2021-06-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4b50" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第二部分。制作API端点来发布或检索数据</h2></div><p id="53f5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，您将了解如何使用Rest-API让端点对存储在MongoDB Atlas数据库上的数据进行CRUD(创建、读取、更新、删除)操作。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/08970f344b5e8d10b79dc784b9f389b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdMEyQnCxI8ccTqXvpkXow.jpeg"/></div></div></figure></div><div class="ab cl lk ll hr lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ig ih ii ij ik"><div class="kz la lb lc gt lr"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-make-rest-api-with-node-js-express-and-mongodb-dfce5e70e830"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">如何用Node.js，Express，MongoDB制作REST API</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">在这篇文章中，您将了解什么是REST API，并学习如何在Node.js中为API建立连接</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mb l mc md me ma mf li lr"/></div></div></a></div><p id="e5d5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的文章中，我们看到了如何设置Node.js项目并将我们的MongoDB数据库连接到Node.js。</p><h2 id="787c" class="mg mh in bd mi mj mk dn ml mm mn dp mo kl mp mq mr kp ms mt mu kt mv mw mx my bi translated">1.首先，我们必须在我们的API中制作我们想要的数据类型的模式，我们将为商店中的产品制作模式</h2><p id="d585" class="pw-post-body-paragraph kc kd in ke b kf mz jo kh ki na jr kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">在主目录下做一个名为<strong class="ke io"> models </strong>的文件夹，做一个名为<strong class="ke io"> Products.js </strong>的文件，代码如下。</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="9504" class="mg mh in nf b gy nj nk l nl nm">const mongoose = require('mongoose') // required to make the schema</span><span id="a3a3" class="mg mh in nf b gy nn nk l nl nm">const ProductSchema = mongoose.Schema({<br/>  name: {<br/>    type: String,<br/>    required: true<br/>  },<br/>  price: {<br/>   type: Number,<br/>   required: true,<br/>  },<br/>})<br/>// we are exporting our schema for table Products.<br/>module.exports = mongoose.model('Products', ProductSchema)</span></pre><h2 id="e2a3" class="mg mh in bd mi mj mk dn ml mm mn dp mo kl mp mq mr kp ms mt mu kt mv mw mx my bi translated">2.我们必须定义检索数据和发布数据的路线</h2><p id="5221" class="pw-post-body-paragraph kc kd in ke b kf mz jo kh ki na jr kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">在主目录下做一个名为<strong class="ke io">路线</strong>的文件夹，然后做一个名为<strong class="ke io"> product.js. </strong>的文件</p><p id="2e2a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">转到主目录中的<strong class="ke io"> app.js </strong>，在mongodb连接代码前写入如下产品路线的入口代码:</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="504c" class="mg mh in nf b gy nj nk l nl nm">// making the /products route for our product</span><span id="c685" class="mg mh in nf b gy nn nk l nl nm">const ProductRoute = require('./Routes/Product');<br/>app.use('/products', ProductRoute)</span></pre><p id="edf6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">转到<strong class="ke io"> routes </strong>文件夹中的<strong class="ke io"> product.js </strong>文件，开始制作获取和发布路线，如下所述:</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="788d" class="mg mh in nf b gy nj nk l nl nm"><strong class="nf io">// we are making express router to handle different kinds of request like get/post/patch/delete</strong></span><span id="c140" class="mg mh in nf b gy nn nk l nl nm">const express = require('express')<br/>const router = express.Router()</span><span id="9f5a" class="mg mh in nf b gy nn nk l nl nm"><strong class="nf io">// We will me making this file in next step which will handle all our logic </strong></span><span id="abf6" class="mg mh in nf b gy nn nk l nl nm">const ProductController = require('../controllers/product')</span><span id="fda4" class="mg mh in nf b gy nn nk l nl nm"><strong class="nf io">// All these routes are there for our products like this: <br/></strong><a class="ae no" href="http://localhost:5000/products/get" rel="noopener ugc nofollow" target="_blank"><strong class="nf io">// (http://localhost:5000/products/get)</strong></a><strong class="nf io"> for getting all product<br/>// (</strong><a class="ae no" href="http://localhost:5000/products/post" rel="noopener ugc nofollow" target="_blank"><strong class="nf io">http://localhost:5000/products/post</strong></a><strong class="nf io">) for posting a product</strong></span><span id="a169" class="mg mh in nf b gy nn nk l nl nm">router.get('/get', ProductController.get_all_product);</span><span id="14e3" class="mg mh in nf b gy nn nk l nl nm">router.post('/post',ProductController.create_product)</span><span id="1259" class="mg mh in nf b gy nn nk l nl nm">router.get('/:productId', ProductController.get_single_product)</span><span id="d088" class="mg mh in nf b gy nn nk l nl nm">router.patch('/:productId',ProductController.patch_product_details)</span><span id="6cf0" class="mg mh in nf b gy nn nk l nl nm">router.delete('/:productId',ProductController.delete_product)</span><span id="c93e" class="mg mh in nf b gy nn nk l nl nm">module.exports = router</span></pre><h2 id="e440" class="mg mh in bd mi mj mk dn ml mm mn dp mo kl mp mq mr kp ms mt mu kt mv mw mx my bi translated">3.使控制器处理路由背后的所有逻辑</h2><p id="5a90" class="pw-post-body-paragraph kc kd in ke b kf mz jo kh ki na jr kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">转到项目的主目录，创建名为<strong class="ke io">控制器</strong>的文件夹，并在其中创建名为<strong class="ke io"> product.js </strong>的文件</p><p id="ba45" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在这个文件中，路由背后的所有逻辑如下所示</p><p id="30cd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">For /get请求:</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="de4e" class="mg mh in nf b gy nj nk l nl nm">// schema of the product table<br/>const Product = require('../models/Product')</span><span id="3151" class="mg mh in nf b gy nn nk l nl nm">// Logic for the get request to get all the products<br/>exports.get_all_product = async (req, res) =&gt; {<br/>  try {<br/>    // finding all the product in the table<br/>    const products = await Product.find()<br/>    // To check in the console <br/>    console.log(products)</span><span id="83aa" class="mg mh in nf b gy nn nk l nl nm">    res.send(products)<br/>   }catch (err) {<br/>      res.send({ message: err })<br/>   }<br/>}</span><span id="c311" class="mg mh in nf b gy nn nk l nl nm">// Logic for the get request to get the single product</span><span id="6047" class="mg mh in nf b gy nn nk l nl nm">exports.get_single_product = (req, res) =&gt; {<br/>    const id = req.params.productId; //get the productid from params<br/>    Product.findById(id)<br/>      .then(result =&gt; {<br/>          res.send(result) // if product is found then returned<br/>      })<br/>      .catch(err =&gt; {<br/>         res.send({message: err}) //gives error if product not found<br/>      })<br/>}</span></pre><p id="a2a8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">申请/发布请求</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="f9d7" class="mg mh in nf b gy nj nk l nl nm">exports.create_product = async (req, res) =&gt; {<br/>   console.log(req.file)<br/>   <br/>   // retrieving data from json body of post request</span><span id="55c6" class="mg mh in nf b gy nn nk l nl nm">   const product = new Product({<br/>      name: req.body.name,<br/>      price: req.body.price,<br/>     });<br/>   product.save()<br/>    .then(result =&gt; {<br/>       res.status(200).send({<br/>        _id: result._id,<br/>        name: result.name,<br/>        price: result.price,<br/>        request: {<br/>           type: 'GET',<br/>           url: 'http://localhost:5000/products/' + result._id<br/>          }<br/>        })<br/>      })<br/>   .catch(err =&gt; {<br/>      res.send({ message: err })<br/>    })<br/>}</span></pre><p id="df81" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">for /patch请求</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="053b" class="mg mh in nf b gy nj nk l nl nm">exports.patch_product_details = (req, res) =&gt; {<br/>   const id = req.params.productId; // get product ID from params<br/>   const update = {}<br/>   // checks for the value to be updated in item<br/>   for (const ops of req.body) {<br/>       update[ops.propName] = ops.value;<br/>   }<br/>   Product.update({ _id: id }, { $set: update })<br/>   .exec()<br/>   .then(result =&gt; {<br/>       res.send(result)<br/>    })<br/>   .catch(err =&gt; {<br/>      res.send(err)<br/>    })<br/>}</span></pre><p id="4088" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于/删除请求</p><pre class="kz la lb lc gt ne nf ng nh aw ni bi"><span id="bb2f" class="mg mh in nf b gy nj nk l nl nm">exports.delete_product = (req, res) =&gt; {<br/>   const id = req.params.productId; //checks for productId to delete<br/>   Product.remove({ _id: id }) // removes product from table<br/>     .exec()<br/>     .then(result =&gt; {<br/>         res.send(result)  //sends the result back<br/>      })<br/>     .catch(err =&gt; {<br/>        res.send(err)    // sends error if product is not updated<br/>      })<br/>}</span></pre><p id="6041" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经完成了API工作所需的所有路线和逻辑，您可以通过尝试任何API测试工具(如Postman)来检查您的API。</p><h2 id="5d4a" class="mg mh in bd mi mj mk dn ml mm mn dp mo kl mp mq mr kp ms mt mu kt mv mw mx my bi translated">错过了第一部分？看看下面吧</h2><div class="np nq gp gr nr lr"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-make-rest-api-with-node-js-express-and-mongodb-dfce5e70e830"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">如何用Node.js，Express，MongoDB制作REST API</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">在这篇文章中，您将了解什么是REST API，并学习如何在Node.js中为API建立连接</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mb l mc md me ma mf li lr"/></div></div></a></div><p id="80ee" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">被一个错误卡住了？没问题！留下评论，我一定会努力解决。</p><p id="282f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ns">更多内容请看</em><a class="ae no" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ns">plain English . io</em></strong></a></p></div></div>    
</body>
</html>