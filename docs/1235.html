<html>
<head>
<title>Fix index.d.ts import paths with one bash command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一个bash命令修复index.d.ts导入路径</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/fix-index-d-ts-import-paths-with-one-bash-command-8ff61aee8464?source=collection_archive---------14-----------------------#2021-03-15">https://javascript.plainenglish.io/fix-index-d-ts-import-paths-with-one-bash-command-8ff61aee8464?source=collection_archive---------14-----------------------#2021-03-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/03012ba32f83069b4635796083f69282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IOXM-1S30E-c7FVl"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@hellocolor?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pawel Nolbert</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="f9d4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，所以你决定做一些漂亮而闪亮的东西，现在你正在开发JavaScript库，它实际上是用心爱的TypeScript编写的，不是吗？很好。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div class="ab gu cl lc"><img src="../Images/85e416779a3437e2285936a60c46048f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JOGSyA3Nv3w7XXaV2RwPFg.jpeg"/></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Source: <a class="ae ja" href="https://bonomi.io/blog/the-bonomi-tech-stack/" rel="noopener ugc nofollow" target="_blank">https://bonomi.io/blog/the-bonomi-tech-stack/</a></figcaption></figure><h1 id="4d55" class="ld le jd bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">路径的问题</h1><p id="7732" class="pw-post-body-paragraph ka kb jd kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">让我们跳过所有的开发步骤，在一切都已经很好的时候登陆。您精心编写的代码正在运行，并且经过了很好的测试。你所有的组件和助手都有类型。构建是绿色运行的，因此<code class="fe mg mh mi mj b">index.d.ts</code>也正在生成。而且…您出于自己的原因使用绝对导入路径。</p><p id="6dba" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的团队中，在Rolique，我们更喜欢在任何可能的时候使用绝对路径，似乎总是这样。</p><p id="ff1f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一个有问题的话题，所以，请将下面的文字视为我的个人观点。</p><p id="ca37" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">带有绝对路径的导入看起来更干净，我们可以毫不犹豫地在项目内部移动文件，不需要更新它的导入。</p><p id="4bf1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所有这些都是非常方便和甜蜜的，直到你的库被添加到某个项目中，这就是问题出现的地方。</p><p id="8d2b" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">TypeScript可以解析库repo内部的绝对路径，因为您确切地告诉了如何解析。它会在<code class="fe mg mh mi mj b">tsconfig.json</code>中寻找<code class="fe mg mh mi mj b">baseUrl</code>，并以此作为那条路径的基础。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mm"><img src="../Images/183b091a09f1408580eee173a34e1381.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vO0cGp3a7W8rHBK5xOthpQ.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">tsconfig.json with baseUrl example</figcaption></figure><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mn"><img src="../Images/b32a2141216c368e392009487fc461a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFR8lCaWoKVKaNeJCVIOTg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Code editor can’t resolve absolute import paths without baseUrl</figcaption></figure><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mo"><img src="../Images/4ee4728f83700e4864f96922b2f80433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3G3EBmkPnd5xqRjadZu_TQ.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Code editor resolves absolute import paths with baseUrl</figcaption></figure><p id="63b4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嗯，但是你的<code class="fe mg mh mi mj b">build</code>或者<code class="fe mg mh mi mj b">dist</code>文件夹里没有<code class="fe mg mh mi mj b">tsconfig.json</code>这个东西吧？对，没有。但是进口仍然是绝对的。</p><p id="1549" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦您的库将被添加到任何TypeScript项目中，没有一个绝对导入将在库内部被解析，这仅仅是因为它不知道在哪里寻找您导入的文件。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mp"><img src="../Images/78f9c37bfe18a2b00b4ebcdb762219c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZ1tP0cvPV3ZumI6xvzgZQ.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">index.d.ts generated with absolute paths</figcaption></figure><p id="b29a" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好吧，好吧。我们可以有库的根的相对路径，所以它可以解析所有的路径，不管它是在你的repo中还是在另一个使用你的库的项目的上下文中。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mq"><img src="../Images/c600ba54fb8ff8ef9835eeca7c9e2ee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmvwS8efpacKpKOivKEUPg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Relative paths in the library root</figcaption></figure><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mr"><img src="../Images/fc21695a5ac729ea08ac00fcafa3e2c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TbxO074PEsy8RBjJ3sbVyQ.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Relative paths in the library generated index.d.ts file</figcaption></figure><h1 id="c928" class="ld le jd bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">好吧，明白了！</h1><p id="51ad" class="pw-post-body-paragraph ka kb jd kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated">问题在根源层面得到了修复，但并不完全。如果一些嵌套文件使用绝对导入，情况是一样的，它不会被解析。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mo"><img src="../Images/e0852aab3b0b903147926a0f10fe9d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*f2fqiSGolofNGSlox7bXZw.gif"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Nested absolute import not being resolved</figcaption></figure><blockquote class="ms"><p id="fc87" class="mt mu jd bd mv mw mx my mz na nb kx dk translated">我们要在这里放弃吗？不要！而且很多次都没有！</p></blockquote><h1 id="9099" class="ld le jd bd lf lg lh li lj lk ll lm ln lo nc lq lr ls nd lu lv lw ne ly lz ma bi translated">CLI TSC-别名救援！</h1><p id="6fb4" class="pw-post-body-paragraph ka kb jd kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated"><code class="fe mg mh mi mj b"><a class="ae ja" href="https://www.npmjs.com/package/tsc-alias" rel="noopener ugc nofollow" target="_blank">tsc-alias</a></code>是一个将所有绝对进口替换为相对进口的工具。给你的。自动地。</p><p id="8a2f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，我们走吧！安装软件包:</p><pre class="ky kz la lb gt nf mj ng nh aw ni bi"><span id="3133" class="nj le jd mj b gy nk nl l nm nn">yarn add tsc-alias -D</span><span id="f00e" class="nj le jd mj b gy no nl l nm nn">or</span><span id="933b" class="nj le jd mj b gy no nl l nm nn">npm install tsc-alias --save-dev</span></pre><p id="0bc5" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们需要向<code class="fe mg mh mi mj b">package.json</code>脚本添加神奇的命令:</p><figure class="ky kz la lb gt ip"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Added build:aliases script</figcaption></figure><p id="6db0" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，现在让我们创建那个<code class="fe mg mh mi mj b">tsconfig.aliases.json</code>文件，我们将专门为这个工具使用它，不要弄乱主配置。为了安全起见，我们实际上将扩展主配置。</p><figure class="ky kz la lb gt ip"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="02a6" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，运行脚本，您就完成了，祝贺您！</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nr"><img src="../Images/af3cd7ebd7d6cadaefd412aea97e63b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*m4MbWwXKr-kOgksEvNoS4w.gif"/></div></div></figure><h1 id="610b" class="ld le jd bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">摘要</h1><p id="01c2" class="pw-post-body-paragraph ka kb jd kc b kd mb kf kg kh mc kj kk kl md kn ko kp me kr ks kt mf kv kw kx ig bi translated"><code class="fe mg mh mi mj b">tsc-alias</code>是这项工作的好工具。尤其是当您不想或无法添加任何构建器配置(Webpack、Rollup等)时。对我来说就是这样，因为图书馆是用<code class="fe mg mh mi mj b"><a class="ae ja" href="https://github.com/transitive-bullshit/create-react-library" rel="noopener ugc nofollow" target="_blank">create-react-library</a></code>样板文件管理的。</p><p id="475d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用这种方法，您只需要做一点点工作就可以完成工作。那么为什么不考虑呢？</p><p id="f303" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读本主题！</p></div></div>    
</body>
</html>