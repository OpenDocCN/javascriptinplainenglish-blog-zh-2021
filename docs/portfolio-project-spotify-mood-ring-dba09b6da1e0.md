# 组合项目| Spotify 心情戒指

> 原文：<https://javascript.plainenglish.io/portfolio-project-spotify-mood-ring-dba09b6da1e0?source=collection_archive---------12----------------------->

一款移动优先的 React web 应用，它根据用户最近在 Spotify 上播放的音乐来判断用户的情绪。

![](img/25147fc67a7c92bffde505f8764c8754.png)

今年二月，我制作了[心情戒指](https://moodring.vercel.app)。它使用**Spotify API**检查用户最近在 Spotify 上播放的歌曲，并试图猜测用户的情绪。

在与一些朋友分享并发布到网上后，我很高兴地说，它已经吸引了来自 15 个以上国家的 3000 多名用户。

![](img/c6370ede39fcd9a25c35a2b2e5a3675e.png)![](img/c8599788bc42f676e1b65803e3240cf9.png)

# 这个概念💡

***我们听的音乐说明了我们的感受？***

我知道我想用 Spotify API 做一个项目。它非常强大，为整个 Spotify 库中的每首歌曲提供了丰富的分析，这非常酷。

在阅读他们的文档时，我想到了向用户展示一些关于他们最近音乐品味的数据。为了让它更有趣，我认为向用户展示一个关于他们自己的假设会很有趣，很有个性，有点像星座。

作为这个想法的延伸，我决定使用情绪探测器。

# 技术👨🏼‍💻

这个项目的完整代码可以在我的 GitHub 上的[这里](https://github.com/dunleavyjack/Spotify-Mood-Ring)找到。我使用了以下内容:

*   **反应**
*   **反应路由器**
*   **Redux**
*   **Axios** (针对 Spotify API 的请求)
*   **OAuth2 授权**
*   **自举 5**
*   **图玛**(用于设计 UI)

# 用户界面注意事项🎨

我不会称自己为设计师，但我确实对设计有强烈的偏好。我喜欢简单、不复杂的东西，有大胆的、有点孩子气的线条和颜色。

有些人建议用一种颜色搭配起来更自然，但我不同意。我喜欢那种略带另类的迷人感觉。

# 情绪检测算法👨‍🔬

Spotify API 为他们的歌曲提供了一些非常有趣的分析。除了更令人期待的 **tempo** 、 **bpm** 和 **song key** 之外，Spotify 还包括 **danceability** 、**acoustic、energy** 和 **valence** (一种感知幸福的衡量标准)。

如你所见，Spotify 已经做了很多繁重的工作。在我这边，我为每个分析设置平均值，并编写函数来查找，然后将它们的百分比差异与这些平均值进行比较。

比如说，如果一首歌的**可舞性**低于平均水平，那么我会用它与平均水平的百分比差值将这首歌标记为“不太适合跳舞”。通过这种方式，我可以对它们进行排序。

这给了我一个有序的列表，其中分析从用户最近的收听体验中脱颖而出。这就是事情变得有趣的地方。例如，如果用户最近的歌曲最引人注目的是**【更多的快乐】**和**【更多的可跳舞性】**，那么我觉得可以有把握地假设用户可能感觉**精力充沛**或**富有表现力**。

下面是一个简单的例子，来自我的程序检测到的第一个情绪:

```
if ( moodNames.includes("more-happiness") && moodNames.includes("lower-danceability")) { return "peaceful";
```

在这里，一个用户一直在听那些更快乐(感觉良好)但可跳舞性(感觉平静)更低(感觉平静)的歌曲，所以我的假设是他们可能感觉平静或满足。这是算法的基础。在那之后，决定其他不同的情绪组合是相当有趣的。选择合适的词有点像诗歌。

# C **挑战和解决方案🚧**

## **OAuth2 初学流程**

这是我第一次使用第三方认证和登录流程，所以需要一段时间来理解和习惯流程。

实践了这么多之后，我后来觉得有足够的信心写下[这篇教程](https://levelup.gitconnected.com/add-strava-oauth2-login-to-your-react-app-in-15-minutes-6c92e845919e)(发表在**Level-Up code**here on Medium)来为连接到 **Strava** 的应用程序实现类似的 OAuth2 过程，Strava 是一个流行的跑步社交媒体平台。

## **饼干，饼干，饼干**

我最初学习了如何使用`local.storage`在从 Spotify 的 Auth 页面返回到应用程序的过程中存储认证令牌来执行 OAuth2。这很好，直到我知道它给广告拦截器用户带来了问题。

我了解到这种方法在浏览器上创建了一个 cookie，这导致了红旗。但是幸运的是有一个简单的解决方案，我实现了一个 Redux store 来保存令牌。

## **错误处理响应对象**

我为我所有的 Axios 请求编写了`try`和`catch`语句，但是我忽略了一个问题:没有个人资料照片的用户。我从未见过没有 Spotify 帐户的，我甚至不知道这是可能的！

我花了很多时间想知道为什么这个应用程序总是对少数用户崩溃，不管他们用的是什么设备。幸运的是，Reddit 上的一个非常有用的人提出了这个问题，我可以制作一个默认的个人资料图像来解决这个问题。现在，我对从 API 返回的对象更加谨慎。

# 新手的一个大错误🤦

*   当时，我不知道你可以用更漂亮的配置 [ESLint，所以当我认为我已经完成时，我通过**将每个文件**复制/粘贴到](/4-step-guide-to-setting-up-eslint-prettier-d87904a7746e)[更漂亮的. io 操场](https://prettier.io/playground/)中，然后将干净的代码复制/粘贴回项目中，从而清理了代码。它确实有效，但是我现在有了一个更好的方法。

# 结论✨

通过制作这个项目，我学到了很多东西。把一些东西放到这个世界上也很有趣，我很期待接下来的事情。

用 [Vercel](https://vercel.com) 托管也是一个很棒的想法，我已经把它用在了我所有的其他个人项目中，并且还写了一个教程[，这个教程是用简单的英语在 **Javascript 上选择并发布的。**](/hosting-your-web-app-with-vercel-8ef3f1fbb5ff)

心情是奇怪的，不可言喻的，但我希望心情和一些人联系在一起:)