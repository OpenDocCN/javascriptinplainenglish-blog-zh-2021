<html>
<head>
<title>What is the Best Type for Currency in Programming?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编程中货币的最佳类型是什么？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/what-is-the-best-type-for-currency-in-programming-83709ad38e5e?source=collection_archive---------5-----------------------#2021-11-16">https://javascript.plainenglish.io/what-is-the-best-type-for-currency-in-programming-83709ad38e5e?source=collection_archive---------5-----------------------#2021-11-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1efe" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是浮动的吗？整数？小数？还是字符串？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c0397870b013dcb0d00f0b1e1fb0f195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jEaSW5c0bG8XDfsu"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@alexandermils?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Mils</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8442" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没有<strong class="ky ir">最好的类型</strong>，但是有最差的。你知道大多数编程语言中的<code class="fe ls lt lu lv b">0.1 + 0.2 != 0.3</code>吗？但是，我不会在本文中对此进行深入探讨。查看下面的文章了解更多信息。</p><div class="lw lx gp gr ly lz"><a href="https://betterprogramming.pub/why-is-0-1-0-2-not-equal-to-0-3-in-most-programming-languages-99432310d476" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">为什么大多数编程语言中0.1 + 0.2不等于0.3？</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">它等于0.3000000000000004</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">better编程. pub</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn kp lz"/></div></div></a></div><h1 id="8a70" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">浮动/双精度</h1><p id="74aa" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">实际上，<code class="fe ls lt lu lv b">float</code>和<code class="fe ls lt lu lv b">double</code>是最糟糕的货币类型，因为它们不精确。与货币相关的计算必须精确，同时<code class="fe ls lt lu lv b">float</code>和<code class="fe ls lt lu lv b">double</code>会导致致命的问题。比如<code class="fe ls lt lu lv b">0.1 + 0.2 != 0.3</code>的问题。</p><p id="a055" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，<code class="fe ls lt lu lv b">float</code>被用在图形库中或者可以忍受舍入问题的地方。</p><p id="5641" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与许多其他编程语言不同，JavaScript没有定义不同类型的数字，如整数、短整型、长整型、浮点型等。</p><p id="652b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">遵循国际IEEE 754标准，JavaScript数字总是存储为双精度浮点数。</p><h1 id="4c30" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">整数</h1><p id="94db" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">除了JavaScript之外，<code class="fe ls lt lu lv b">int</code>在所有编程语言中都可用。<code class="fe ls lt lu lv b">int</code>比<code class="fe ls lt lu lv b">float</code>更适合货币。原因是你不必处理四舍五入的问题。</p><h2 id="3285" class="nl mp iq bd mq nm nn dn mu no np dp my lf nq nr na lj ns nt nc ln nu nv ne nw bi translated">怎么会？</h2><p id="748e" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">前端向后端发送货币相关数据时，金额必须是<strong class="ky ir">美分</strong>格式，例如<code class="fe ls lt lu lv b">RM1.10 * 100 = 110sen</code>。当后端响应前端时，它应该乘以100。</p><h2 id="78ee" class="nl mp iq bd mq nm nn dn mu no np dp my lf nq nr na lj ns nt nc ln nu nv ne nw bi translated">缺点</h2><p id="2ef1" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">密苏里州的税率为4.225%。如果你使用<code class="fe ls lt lu lv b">int</code>，那么它需要更多的计算。比如<code class="fe ls lt lu lv b">$1.10 * 4.225% = $0.046475</code>。如果是分格式<code class="fe ls lt lu lv b">110¢ * 4.225% = 4.6475 cent</code>。这种情况下，你打算怎么处理？计算将变得更加复杂。</p><p id="3061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其次，<code class="fe ls lt lu lv b">int</code>在大多数编程语言中有一个最小的可表示值范围。常见的min-max <code class="fe ls lt lu lv b">int</code>是21.5亿。钱可能超过一万亿</p><h1 id="7af6" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">小数</h1><p id="61df" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated"><code class="fe ls lt lu lv b">decimal</code>是一种合适的货币类型，因为它具有较高的精确度，并且易于避免舍入误差。然而，大多数语言没有<code class="fe ls lt lu lv b">decimal</code>的类型</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="7359" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">合适的数据类型在很大程度上取决于语言及其功能。</p><p id="d9aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是我所知道的JavaScript解决方案:</p><ol class=""><li id="608b" class="oe of iq ky b kz la lc ld lf og lj oh ln oi lr oj ok ol om bi translated">JavaScript可以使用库<a class="ae kv" href="https://github.com/MikeMcl/bignumber.js/" rel="noopener ugc nofollow" target="_blank"> bignumber.js </a>、<a class="ae kv" href="https://github.com/openexchangerates/accounting.js/" rel="noopener ugc nofollow" target="_blank"> accounting.js </a>等。</li><li id="a52b" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated">用<code class="fe ls lt lu lv b">(0.1 * 10 + 0.2 * 10) / 10 === 0.3</code>解决浮点问题</li></ol><h1 id="9384" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">需要注意的事项</h1><p id="2d73" class="pw-post-body-paragraph kw kx iq ky b kz ng jr lb lc nh ju le lf ni lh li lj nj ll lm ln nk lp lq lr ij bi translated">想象一下，如果你有一个大规模的团队，用不同的语言开发服务。你打算怎么解决？每种语言都有其局限性。<code class="fe ls lt lu lv b">decimal</code>不错，但是JavaScript里没有。你将需要一个额外的依赖或者手工制作一个<code class="fe ls lt lu lv b">decimal</code>的类。</p><p id="da81" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于我的公司，我们使用<code class="fe ls lt lu lv b">int</code>来解决它。我不鼓励你使用<code class="fe ls lt lu lv b">int</code>作为货币，因为它适合我们的用例。在马来西亚，我们没有超过两位数的税率。我们使用的大多数语言都足以支持最少九万亿次(JavaScript的MAX_SAFE_INTEGER)甚至九万亿次。</p><p id="444d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使MySQL的数据类型在用<code class="fe ls lt lu lv b">DECIMAL(15,2)</code>，如果语言不支持decimal类型，还是会转换成float。</p><p id="ab82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们在Go中使用<code class="fe ls lt lu lv b">customtype</code>表示货币，下面的代码表示我的HoD <a class="os ot ep" href="https://medium.com/u/561fe5470f73?source=post_page-----83709ad38e5e--------------------------------" rel="noopener" target="_blank"> SianLoong </a></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ou ov l"/></div></figure></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/9a8ff26ab18dc6eb432b2742a6080459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akxDZ3db6kbdkyF5VuGlDw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Screenshot from <a class="ae kv" href="https://developers.google.com/protocol-buffers/docs/proto3#scalar" rel="noopener ugc nofollow" target="_blank">Language Guide (proto3)</a></figcaption></figure><p id="c2b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的截图是protobuf的类型会生成对应的类型。正如你所看到的，<code class="fe ls lt lu lv b">int</code>有可能变成<code class="fe ls lt lu lv b">string</code> PHP，因为它的最大值<code class="fe ls lt lu lv b">int</code>是21.5亿。为了保持数据的准确性，超过21.5亿的数字将放在<code class="fe ls lt lu lv b">string</code>而不是<code class="fe ls lt lu lv b">int</code></p><p id="8425" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后但同样重要的是，本文并不偏向我提到的任何一种类型。这取决于您的用例。如果你有什么想法，请发表评论，尽管批评，这样我们可以互相学习。</p></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="89d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能想看看我的部门主管写的这篇精彩的文章</p><div class="lw lx gp gr ly lz"><a href="https://sianloong90.medium.com/how-to-optimise-your-sql-database-to-handle-million-records-part-1-748d68f2dee1" rel="noopener follow" target="_blank"><div class="ma ab fo"><div class="mb ab mc cl cj md"><h2 class="bd ir gy z fp me fr fs mf fu fw ip bi translated">如何优化您的SQL数据库来处理百万条记录—第1部分</h2><div class="mg l"><h3 class="bd b gy z fp me fr fs mf fu fw dk translated">数据处理可能会很混乱，尤其是当我们处理大量数据的时候。多年来，我们意识到…</h3></div><div class="mh l"><p class="bd b dl z fp me fr fs mf fu fw dk translated">sianloong90.medium.com</p></div></div><div class="mi l"><div class="ox l mk ml mm mi mn kp lz"/></div></div></a></div><h1 id="3835" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">参考</h1><ol class=""><li id="1a11" class="oe of iq ky b kz ng lc nh lf oy lj oz ln pa lr oj ok ol om bi translated"><a class="ae kv" href="https://developers.google.com/protocol-buffers/docs/proto3" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/protocol-buffers/docs/proto3</a></li><li id="bb15" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><a class="ae kv" href="http://net-informations.com/q/faq/float.html" rel="noopener ugc nofollow" target="_blank">http://net-informations.com/q/faq/float.html</a></li><li id="296e" class="oe of iq ky b kz on lc oo lf op lj oq ln or lr oj ok ol om bi translated"><a class="ae kv" href="https://stackoverflow.com/questions/5356123/why-dont-applications-typically-use-int-to-internally-represent-currency-values" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/5356123/why-dont-applications-typically-use-int-to-internal-represent-currency-values</a></li></ol><p id="ad50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="pb">更多内容尽在</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="pb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>