<html>
<head>
<title>How to Create a JavaScript Slider with a Beautiful Timer using Greensock</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Greensock创建一个带有漂亮计时器的JavaScript滑块</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-javascript-slider-with-a-beautiful-timer-using-greensock-d811836ed7e0?source=collection_archive---------10-----------------------#2021-04-13">https://javascript.plainenglish.io/how-to-create-a-javascript-slider-with-a-beautiful-timer-using-greensock-d811836ed7e0?source=collection_archive---------10-----------------------#2021-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="87a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们像在芝加哥科学与工业博物馆的网站上那样来构建滑块控件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/67278a95e7a63fea5fd06de2b26b0da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MI5AR2HlLRR7TZgNn72NlQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@veri_ivanova?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Veri Ivanova</a> on <a class="ae ky" href="https://unsplash.com/s/photos/timer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8c90" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我刚才在这篇文章的小标题里提到的<a class="ae ky" href="https://www.msichicago.org/" rel="noopener ugc nofollow" target="_blank">网站</a>挺不错的。如果你登陆主页，你会看到背景图片在几秒钟后发生变化并向上滑动。在左侧，有一个典型的JavaScript点导航。它配有一个带有时间指示器的播放/暂停按钮。我将向你们展示如何在GSAP·格林斯托克图书馆的帮助下重建甚至改进它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi kz"><img src="../Images/3f4c6de14bc34cbe51d23e7cf3bcb0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*-dlTrxDRHXYrh6rRDKrnWg.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Slider from Museum of Science + Industry Chicago.</figcaption></figure><p id="0d68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们仔细看看。如果我在任何时候单击暂停，然后再次播放，它会跳到下一步。我假设计时器将继续旋转，直到它达到一个完整的循环，然后我们将进入下一张幻灯片。也许创建者会告诉我这是一个特性而不是一个bug，但是我现在想忽略这个假设。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi la"><img src="../Images/04672221a753897614a3b2454fb2d2c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:136/1*ndtWq8LUQ8dkNEbBWyNbvQ.gif"/></div></figure><p id="ed01" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在浏览器中快速检查源代码后，看起来转盘是由一个过时的jQuery插件驱动的，这个插件叫做<a class="ae ky" href="https://github.com/malsup/cycle2" rel="noopener ugc nofollow" target="_blank">循环</a>。别担心，我们会从头开始建造整个系统。<a class="ae ky" href="https://stackblitz.com/edit/js-gsap-timer-slider?file=index.js" rel="noopener ugc nofollow" target="_blank">结果</a>会是这样的:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/e5d5e0efa530cad38dcae47341dee422.png" data-original-src="https://miro.medium.com/v2/resize:fit:174/1*OnDRns6wnP_jSzv6XPsE7g.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Our GSAP animated timer — pause works as expected.</figcaption></figure><h2 id="3b18" class="lc ld in bd le lf lg dn lh li lj dp lk jv ll lm ln jz lo lp lq kd lr ls lt lu bi translated">超文本标记语言</h2><p id="3b5d" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">我们首先需要HTML结构。你会如何建造它？你会使用哪些元素？我决定对上面显示圆点的计时器使用下面的HTML:</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="abe8" class="lc ld in mb b gy mf mg l mh mi">&lt;div class="carousel-nav"&gt;<br/>  &lt;div class="timer"&gt;<br/>    &lt;svg width="60" height="60" viewBox="0 0 60 60"&gt;<br/><strong class="mb io">      &lt;circle cx="30" cy="30" r="29" fill="none" stroke="#ffffff" stroke-width="1" stroke-dasharray="182.212" stroke-dashoffset="0"&gt;  <br/>      &lt;/circle&gt;</strong><br/>    &lt;/svg&gt;<br/>    &lt;svg width="60" height="60"&gt;<br/>      <strong class="mb io">&lt;circle id="circle" cx="30" cy="30" r="28" fill="none" stroke="#ffffff" stroke-width="4" data-time="5" style="stroke-dashoffset: 0"&gt;<br/>      &lt;/circle&gt;</strong><br/>    &lt;/svg&gt;<br/>    &lt;span class="play" id="timer-btn"&gt;&lt;/span&gt;<br/>  &lt;/div&gt;</span><span id="1d77" class="lc ld in mb b gy mj mg l mh mi">  &lt;ul class="dots"&gt;<br/>    &lt;li class=""&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;<br/>    &lt;li class=""&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;<br/>    &lt;li class=""&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;<br/>    &lt;li class="active"&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;<br/>    &lt;li class=""&gt;&lt;span&gt;&lt;/span&gt;&lt;/li&gt;<br/>  &lt;/ul&gt;<br/>&lt;/div&gt;</span></pre><p id="ad52" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">定时器有两个SVG圈。一个是用于薄的外侧冲程，另一个将为我们提供时间指示。注意<em class="mk">冲程-冲击偏移</em>和<em class="mk">冲程-冲击阵列</em>属性。我们将通过改变<em class="mk">笔画-dashoffset </em>值<em class="mk">、</em>来制作较粗笔画的动画，但我们将在稍后进行。</p><p id="424b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">图像滑块本身可以由几个div元素组成，我们为每个元素设置背景图像。对于CSS样式，请直接参考<a class="ae ky" href="https://stackblitz.com/edit/js-gsap-timer-slider?file=index.js" rel="noopener ugc nofollow" target="_blank">演示</a>。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="ab32" class="lc ld in mb b gy mf mg l mh mi">&lt;div class="bg-imgs"&gt;<br/>  &lt;div style='background-image: url("http://placehold.jp/14/597999/003366/800x600.jpg"); display: none;' class="bgimg"&gt;</span><span id="1ef4" class="lc ld in mb b gy mj mg l mh mi">  &lt;div style='background-image: url("<a class="ae ky" href="http://placehold.jp/14/8f0869/003366/800x600.jpg" rel="noopener ugc nofollow" target="_blank">http://placehold.jp/14/597999/003366/800x600.jpg</a>"); display: none;' class="bgimg"&gt;</span><span id="2daa" class="lc ld in mb b gy mj mg l mh mi">  &lt;div style='background-image: url("<a class="ae ky" href="http://placehold.jp/14/0a8f30/003366/800x600.jpg" rel="noopener ugc nofollow" target="_blank">http://placehold.jp/14/597999/003366/800x600.jpg</a>"); display: none;' class="bgimg"&gt;</span><span id="87c6" class="lc ld in mb b gy mj mg l mh mi">  &lt;div style='background-image: url("<a class="ae ky" href="http://placehold.jp/14/0a8f30/003366/800x600.jpg" rel="noopener ugc nofollow" target="_blank">http://placehold.jp/14/597999/003366/800x600.jpg</a>"); display: none;' class="bgimg"&gt;<br/>&lt;/div&gt;</span></pre><h2 id="efab" class="lc ld in bd le lf lg dn lh li lj dp lk jv ll lm ln jz lo lp lq kd lr ls lt lu bi translated">圆点导航</h2><p id="03c8" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在我们开始计时之前，让我们先准备基本的点导航。(代码片段还包含jQuery，因为这实际上是我几年前从事的工作)。</p><p id="af04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们可以从定义一些变量开始:</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="1432" class="lc ld in mb b gy mf mg l mh mi">var allImgs = $(“.bg-imgs &gt; div”);<br/>var allDots = $(“.dots li”);<br/>var currentStep = 0;</span></pre><p id="6cce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们添加一些功能，通过点击圆点来改变背景:</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="f2a7" class="lc ld in mb b gy mf mg l mh mi">function changeBackground() {<br/>  allImgs.fadeOut(800);<br/>  allImgs.eq(currentStep).fadeIn(800);<br/>  allDots.removeClass("active");<br/>  allDots.eq(currentStep).addClass("active");<br/>}</span><span id="f613" class="lc ld in mb b gy mj mg l mh mi">allDots.on("click", function() {<br/>  var btnIndex = $(this).index();<br/>  currentStep = btnIndex;<br/>  changeBackground();<br/>});</span><span id="3ccb" class="lc ld in mb b gy mj mg l mh mi">$(".dots li").eq(0).addClass("active");</span></pre><p id="fc35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通过单击这个点，我们得到它的索引(0–3，因为我们有4个图像)，将它设置为currentStep并根据该值更改背景(隐藏所有图像并显示当前图像)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/078f2ece98b9e1092198b18d96be238b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/1*bNcLRM0C2RZPbz-Ceb8k1w.gif"/></div></figure><h2 id="53a3" class="lc ld in bd le lf lg dn lh li lj dp lk jv ll lm ln jz lo lp lq kd lr ls lt lu bi translated">GSAP动画计时器</h2><blockquote class="mm mn mo"><p id="865d" class="jk jl mk jm b jn jo jp jq jr js jt ju mp jw jx jy mq ka kb kc mr ke kf kg kh ig bi translated">《GSAP》是一部面向现代网络的专业级JavaScript动画。</p></blockquote><p id="8e61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是网络动画的标准，并且这个库很快，包含了很多特性。你甚至可以用一些插件来创造其他非常酷的东西。我们只需要最基本的东西。</p><p id="2496" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们添加更多的变量来控制计时器。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="5852" class="lc ld in mb b gy mf mg l mh mi">var circle = document.getElementById(“circle”);<br/>var button = document.getElementById(“timer-btn”);</span><span id="80d1" class="lc ld in mb b gy mj mg l mh mi"><strong class="mb io">var tl = gsap.timeline();  // GSAP v3<br/></strong>var intervalTimer;<br/>var timeLeft;<br/>var wholeTime = 8;<br/>var isPaused = false;<br/>var isStarted = false;<br/><strong class="mb io">var radius = 28;</strong><br/><strong class="mb io">var initialOffset = Math.PI * 2 * radius;  // Circumference</strong></span></pre><blockquote class="mm mn mo"><p id="6d0c" class="jk jl mk jm b jn jo jp jq jr js jt ju mp jw jx jy mq ka kb kc mr ke kf kg kh ig bi translated"><strong class="jm io">注意:</strong>GSAP API已经更改，所以您可能会遇到使用TimelineLite或TimelineMax构造函数的v2实例。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/f9a0e7f1cf1749ead21dd3e983529bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBiu8wkto0ksEtdn7OWv4w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://en.wikipedia.org/wiki/Circumference#/media/File:Circle-withsegments.svg" rel="noopener ugc nofollow" target="_blank">Circumference = <em class="mt">π</em> × diameter = 2<em class="mt">π</em> × radius.</a></figcaption></figure><p id="7221" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们定义代表圆周的<em class="mk">半径</em>和<em class="mk">初始偏移量</em>变量。</p><p id="99b7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如前所述，SVG circle元素有<em class="mk"> stroke-dasharray </em>属性，我们将对其进行动画处理。对于半径28，我们将得到值175.92，我们希望将其更改为0。</p><p id="941a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您查看<em class="mk"> #circle </em>元素，您还会看到一个<em class="mk">数据时间</em>属性，我们添加该属性是为了确定动画应该持续多少秒。</p><p id="0691" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们初始化两个函数<em class="mk"> animateTimer() </em>和<em class="mk"> pauseTimer()。</em></p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="e4d9" class="lc ld in mb b gy mf mg l mh mi">if (circle) {<br/>  wholeTime = parseInt(circle.dataset.time, 10);<br/>  animateTimer();<br/>  pauseTimer();<br/>}</span><span id="ec17" class="lc ld in mb b gy mj mg l mh mi">button.addEventListener(“click”, pauseTimer);</span></pre><p id="4648" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<strong class="jm io"><em class="mk">animate timer()</em></strong>函数中，我们使用GSAP <a class="ae ky" href="https://greensock.com/docs/v3/GSAP/Timeline/to()" rel="noopener ugc nofollow" target="_blank">时间轴<em class="mk">。to() </em> </a>动画显示SVG圆的strokeDashoffset。我们定义目标(我们的#circle)，传递时间(duration)，将strokeDashoffset设置为圆的周长作为初始值，以及一些其他属性，如repeat: -1以无限播放它。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="80ca" class="lc ld in mb b gy mf mg l mh mi">function animateTimer() {<br/>  tl.to("#circle", {<br/>    duration: wholeTime<br/>    startAt: {<br/>      strokeDashoffset: initialOffset<br/>    },<br/>    strokeDashoffset: 0,<br/>    repeat: -1,<br/>    ease: "linear",<br/>    onComplete: tl.invalidate<br/>  });<br/>}</span></pre><p id="15b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下面的<strong class="jm io"> <em class="mk"> pauseTimer() </em> </strong>函数中(我本来可以取个更好的名字)，我们基本上是检查定时器的状态。开始了还是暂停了？基于此，我们切换按钮类(播放/暂停)并控制时间轴实例。</p><blockquote class="mm mn mo"><p id="6f53" class="jk jl mk jm b jn jo jp jq jr js jt ju mp jw jx jy mq ka kb kc mr ke kf kg kh ig bi translated"><a class="ae ky" href="https://greensock.com/docs/v3/GSAP/Timeline/paused()" rel="noopener ugc nofollow" target="_blank"> tl.paused(boolean) </a> —获取或设置动画的暂停状态，该状态指示动画当前是否暂停。</p></blockquote><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="4114" class="lc ld in mb b gy mf mg l mh mi">function pauseTimer() {<br/>  if (isStarted === false) {<br/>    timer(wholeTime);<br/>    isStarted = true;<br/>    button.classList.remove("play");<br/>    button.classList.add("pause");<br/>    tl.paused(false);<br/>  } else if (isPaused) {<br/>    button.classList.remove("play");<br/>    button.classList.add("pause");<br/>    timer(timeLeft);<br/>    isPaused = isPaused ? false : true;<br/>    tl.paused(isPaused);<br/>  } else {<br/>    button.classList.remove("pause");<br/>    button.classList.add("play");<br/>    clearInterval(intervalTimer);<br/>    isPaused = isPaused ? false : true;<br/>    tl.paused(isPaused);<br/>  }<br/>}</span></pre><p id="ee86" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码中，我还调用了<em class="mk"> timer() </em>函数，设置间隔。<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval" rel="noopener ugc nofollow" target="_blank"><em class="mk">setInterval</em></a><em class="mk">()</em>方法内的函数每10毫秒执行一次。我们计算剩下的时间，在一个完整的迭代完成后，我们重新开始时间线并更新当前步骤。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="206d" class="lc ld in mb b gy mf mg l mh mi">function timer(seconds) {<br/>  var remainTime = Date.now() + seconds * 1000;</span><span id="5534" class="lc ld in mb b gy mj mg l mh mi">  intervalTimer = setInterval(function() {<br/>    timeLeft = ((remainTime — Date.now()) / 1000).toFixed(2);<br/>    <br/>    if (timeLeft &lt;= 0) {<br/>      tl.restart();<br/>      clearInterval(intervalTimer);<br/>      isStarted = false;<br/>      currentStep = currentStep + 1 &lt; allImgs.length ? currentStep + 1 : 0;<br/>      pauseTimer();<br/>      changeBackground();<br/>      return;<br/>    }<br/>  }, 10);<br/>}</span></pre><p id="bee8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mk">查看</em> <a class="ae ky" href="https://stackblitz.com/edit/js-gsap-timer-slider?file=index.js" rel="noopener ugc nofollow" target="_blank"> <em class="mk">演示</em> </a> <em class="mk">。</em></p><h2 id="27be" class="lc ld in bd le lf lg dn lh li lj dp lk jv ll lm ln jz lo lp lq kd lr ls lt lu bi translated">摘要</h2><p id="fdb5" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">我们从头开始创建了带有计时器和点导航的JavaScript滑块。我们几乎复制了芝加哥科学与工业博物馆网站上的那个。格林斯托克GSAP动画库帮助我们无缝动画圆中风，所以它看起来完美无瑕。</p><p id="f616" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">请随意使用演示，尝试不同的动画。你也可以重构和改进代码，因为我只升级了GSAP代码片段来反映库的最新版本。我想看看你的作品！</p><p id="4747" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mk">更多内容尽在</em><a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mk">plain English . io</em></a></p></div></div>    
</body>
</html>