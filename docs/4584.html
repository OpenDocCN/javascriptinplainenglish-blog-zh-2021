<html>
<head>
<title>Setup a Redux Application using createAsyncThunk and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用createAsyncThunk和React设置Redux应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/setup-an-redux-application-using-createasyncthunk-and-react-79d88331288a?source=collection_archive---------7-----------------------#2021-09-13">https://javascript.plainenglish.io/setup-an-redux-application-using-createasyncthunk-and-react-79d88331288a?source=collection_archive---------7-----------------------#2021-09-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/89498c57de041c42c3d0b6dfd9bbb4ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TkL3Mccm8eEc1Gpi"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="745d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天我们将讨论如何使用Redux thunk创建一个React应用程序。除了……有点曲折。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/4e8d0b0098d41737be08385118e26e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*grw-OGAo0-k4yECA"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@polarmermaid?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anne Nygård</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="25ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事实上，我已经在这里写了一篇关于如何在React应用程序上设置redux-thunk的文章:<a class="ae jz" rel="noopener ugc nofollow" target="_blank" href="/how-to-set-up-redux-thunk-on-a-react-project-79b0c29c96db">如何在React项目中设置Redux-Thunk |作者Michael Tong | JavaScript in Plain English</a></p><p id="1fe4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你已经阅读了本教程或任何其他react redux教程，你会意识到配置redux store相当麻烦，而且有很多样板文件。安装完成后，您必须编写大量复杂的代码，以便应用程序能够与商店正确交互(mhm操作创建者)。</p><p id="b4b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可能见过类似这样的代码:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="53ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者这个:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="6a32" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">呸。这看起来很难消化和阅读。</p><p id="d4d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我告诉您，我们可以使用另一个工具来完成所有这些redux魔法，而不需要配置商店的所有样板文件，会怎么样？</p><p id="0ef5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用redux toolkit，您只需担心几件事情:</p><ul class=""><li id="0865" class="lf lg in kc b kd ke kh ki kl lh kp li kt lj kx lk ll lm ln bi translated">configureStore设置</li><li id="5297" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lk ll lm ln bi translated">创建切片(将缩减器、动作、状态组合成一个函数)</li><li id="352b" class="lf lg in kc b kd lo kh lp kl lq kp lr kt ls kx lk ll lm ln bi translated">createAsyncThunk(它接受一个redux字符串，指定要调度的动作并返回一个承诺)</li></ul><p id="cf7f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样！现在让我们从头开始设置它。</p><p id="0ec3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">步骤1:通过下面的方法创建一个react项目:<code class="fe lt lu lv lw b">npx create-react-app reduxtoolkitapp</code></p><p id="4f01" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第二步:之后，为redux安装以下两个包:<code class="fe lt lu lv lw b">npm install — save-dev react-redux @reduxjs/toolkit</code></p><p id="a078" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在src文件夹下，创建一个名为store的文件夹。在该文件夹中，创建一个名为reducerConfig.js的文件，其内容如下:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="0ef9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">像往常一样，我们将使用的所有减速器组合成组合减速器。在我们的例子中，我们的reducer将是一个片的形式，状态和动作作为函数组合在一起。</p><p id="490a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">步骤3:在src文件夹下，创建一个名为redux的文件夹。在同一文件夹中，创建一个包含以下内容的ToDoSlice.js文件:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="8d9b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">步骤4:在同一个redux文件夹中，创建一个名为thunk.js的文件:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="c7b3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在ToDoSlice.js里面，我们有一个名字，用来标识reducer的名字。我们还有一个状态和一个reducer函数列表，即addToList和deleteFromList。</p><p id="2c5e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意有一种叫做extraReducers的东西。你大概能猜到它在做什么，但是等一下redux的旧实现中的extraReducers是什么？</p><p id="3fed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">答案是……没有。事实上，这些extraReducers所做的是允许我们在调度调用的不同阶段执行一些回调。</p><p id="49ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，当addItem操作在这里被调度时，它调用addItem.pending。当我们为addItem.pending声明builder.addCase时，我们也声明了在发生这种情况时要调用的回调，这就是startSubmitting方法。</p><p id="b007" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">只有在调度名为“Todo/addItem”的createAsyncThunk时，才会调用这个startSubmitting方法，如thunk.js中的addItem函数所示。</p><p id="70ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦thunk被调度，addItem.fulfilled的回调就会被调用。NotSubmitting被触发并将isModifying标志变回false。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/d61cf57fe178fbba49f3824900ee7a4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6WFYAMe3fb0sOMNf"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@dav420?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">David Pupaza</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1557" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果在调度操作时抛出错误，该怎么办？在这种情况下，将调用设置为addItem.rejected的回调，在我们的情况下，它还会将isModifying标志设置为false，表明该流程不再运行。</p><p id="0759" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了使所有这些工作，我们仍然必须用提供者和商店包装我们的应用程序。</p><p id="2a71" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第五步:转到src/index.js，替换为以下内容:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="a002" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我们简单地导入我们在reducerConfig文件中创建的存储，并将应用程序包装在它周围。</p><p id="2527" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们刚刚完成设置redux工具包。我们来修改一下app.js，看看怎么用。</p><p id="fd50" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第六步。转到src/app.js并替换为以下内容:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="3d4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在返回状态中，我们有一个地方添加商品名称，还有一个地方呈现商店中的商品列表。当用户添加一个项目时，它将分派该动作，并将新项目放入redux存储中。</p><p id="54a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，对于正在呈现的每个项目，都有一个按钮允许用户删除相应的项目。</p><p id="57e1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们单击add item时，addItem.pending的回调被调用，以将加载状态更改为true。当调度操作完成时，调用addItem.fulfilled的回调，将加载状态改回false。</p><p id="d2f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当然，如果addItem dispatch调用失败，则会调用addItem.rejected的回调。</p><p id="1425" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样！您刚刚创建了一个具有redux-toolkit功能的应用程序。</p><p id="4e27" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ly">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ly">plain English . io</em></strong></a></p></div></div>    
</body>
</html>