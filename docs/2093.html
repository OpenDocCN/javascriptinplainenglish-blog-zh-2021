<html>
<head>
<title>Should You Use Dependency Injection in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中应该使用依赖注入吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/should-you-use-dependency-injection-in-javascript-3751bdf3f198?source=collection_archive---------6-----------------------#2021-05-03">https://javascript.plainenglish.io/should-you-use-dependency-injection-in-javascript-3751bdf3f198?source=collection_archive---------6-----------------------#2021-05-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5ea5649f308812cfc9df3b5d61a89942.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3kzcnYuOm130MZWXTajglQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo Courtesy of Dr Magaziner</figcaption></figure><p id="ffb0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">最初发布于</em><a class="ae lb" href="https://fek.io/blog/should-you-use-dependency-injection-in-java-script" rel="noopener ugc nofollow" target="_blank"><em class="la">https://fek . io</em></a><em class="la">。</em></p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Please subscribe to the Polyglot Engineer Channel</figcaption></figure><p id="5bd3" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我看过一些关于JavaScript和其他语言的帖子，劝阻使用依赖注入。在我工作的一家公司，我甚至有一个老板告诉他的开发人员，我们永远不应该使用依赖注入。</p><p id="f75e" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">依赖注入(DI)，有时也称为“控制反转”，是指一个对象接收它所依赖的其他对象或函数来实现其部分功能。这可以通过使用构造函数或属性设置通过对象实例化传递对象来实现。这在Java或C#等静态类型语言中很常见。在静态类型的面向对象世界中，有许多专门为管理依赖关系而构建的流行框架。</p><p id="0008" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">DI允许在运行时加载特定的功能。能够在运行时更改对象功能的一个优点是提供了更大的灵活性，并使我们的应用程序更加松散耦合。一个非常常见的用例是在测试过程中使用模仿。在<a class="ae lb" href="https://nodejs.org" rel="noopener ugc nofollow" target="_blank"> Node.js </a>中有一些很棒的库，比如<a class="ae lb" href="https://sinonjs.org/" rel="noopener ugc nofollow" target="_blank"> Sinon </a>使得模仿变得非常容易，但是我们可以通过使用DI来完成同样的任务。</p><h1 id="085d" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">测试场景</h1><p id="8116" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">在测试中，用mock或fake替换与数据库或网络请求通信的代码是很常见的。这是因为在许多CI/CD工作流中，构建或测试服务器可能无法访问实际服务所需的数据库服务器或网络。对于DI来说，这是一个用模拟或伪造的服务替换实际服务的绝佳用例。</p><p id="d0f5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">使用DI有许多不同的原因，但测试是最常见的原因之一。</p><h1 id="ef75" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">可怜的芒迪</h1><p id="c371" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">我有一个多年来一直使用的技术，用于在我的应用程序中配置DI，不管它们是静态类型的还是像JavaScript一样的鸭类型的，我喜欢称之为“可怜人的依赖注入”。使用这种技术，如果在对象实例化时没有传入所需的对象，我通常会创建默认的依赖对象。</p><p id="1cd7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">假设我们有一个cart对象，它需要计算某个位置的税率。在许多电子商务系统中，这种数据必须根据用户的位置来计算，每个位置的销售税都不同。我们可以创建一个工厂函数，该函数创建一个购物车，该购物车带有一个用于计算税款的可注入函数。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="1d54" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">看看下面的例子，我们正在创建一个对象，它具有向购物车中添加商品以及计算总计和小计的函数。我们有一个函数，可以传递给我们的设置构造函数对象<code class="fe mm mn mo mp b">taxrepository</code>。我们将使用这个函数来计算我们的税款。</p><p id="2283" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们创建一个测试函数来计算我们的税收。我们会让这成为一个没有任何副作用的纯函数。</p><pre class="lc ld le lf gt mq mp mr ms aw mt bi"><span id="fb1e" class="mu lj iq mp b gy mv mw l mx my">function calculateMyTax(subtotal) {<br/>    return subtotal * 0.11;<br/>}</span></pre><p id="a64d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">当我们用工厂函数实例化这个对象时，我们可以把它传递给我们的settings对象；</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="beb0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们现在可以得到小计，并计算税收。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><h1 id="b7ec" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">违约行为</h1><p id="7e0e" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">我定义的所有对象，每当构造函数中不包含可注入行为时，我都会尝试创建默认值。这样，如果有人在没有传入所需对象的情况下使用我的对象，它将得到一个错误或一个默认函数，如果它在构造函数中丢失的话。如果settings对象中没有传递<code class="fe mm mn mo mp b">taxrepository</code>,我们可以修改工厂函数来使用默认值。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="d9a4" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果调用我们函数的开发人员忘记将<code class="fe mm mn mo mp b">taxrepository</code>传递给构造函数，我们也可能希望我们的工厂函数失败。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><h1 id="36d9" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">依赖注入框架</h1><p id="7e83" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">DI框架在Java和。NET开发，但是也有可以用于JavaScript的DI框架。其中一个框架叫做<a class="ae lb" href="https://github.com/gedbac/di4js" rel="noopener ugc nofollow" target="_blank"> di4js </a>，可以在浏览器中使用Node.js或者普通的旧JavaScript。下面是di4js自述中的一个例子；</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">This example is from the di4js Github repo</figcaption></figure><h1 id="44f0" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/46bbbbc7810b15743d5167361f3088a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/0*Q6RLGOpOjHZC4PID.jpg"/></div></figure><p id="7ca0" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">依赖注入是一个非常强大的工具，用于配置应用程序在创建对象时使用某些依赖。无论您使用的是“穷人的”依赖注入还是成熟的DI框架，它都是在应用程序中配置不同行为的非常有用的工具。</p><p id="d8aa" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="la">更多内容看plainenglish.io </em> </a></p></div></div>    
</body>
</html>