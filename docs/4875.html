<html>
<head>
<title>How to Avoid Side Effects with Pure Functions in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何避免纯函数在JavaScript中的副作用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-avoid-side-effects-using-pure-functions-in-javascript-366acaafb60c?source=collection_archive---------0-----------------------#2021-10-01">https://javascript.plainenglish.io/how-to-avoid-side-effects-using-pure-functions-in-javascript-366acaafb60c?source=collection_archive---------0-----------------------#2021-10-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/94aa3b738513cfb2d4e2fc725552eb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCVAEox-IQt1JkiiiNq2hA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://www.pexels.com/@dan-hadley-360599" rel="noopener ugc nofollow" target="_blank">Dan Hadley</a> from<a class="ae jz" href="https://www.pexels.com/photo/wood-light-sun-park-5971210/" rel="noopener ugc nofollow" target="_blank"> Pexels</a></figcaption></figure><p id="092f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">想象我们写一个程序，保存关于用户购买历史的信息，比如用户通过移除一个项目来修改数据，如果部分信息丢失，我们就改变了数据。大家好，我把这篇文章放在一起是为了帮助我们编写更好的程序，避免主要由副作用引起的突变。</em></p><h1 id="b520" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">这篇文章是给谁的？</h1><p id="420e" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">本文是为任何至少对编程，特别是JavaScript有基本了解的人准备的。如果不是你，你一定要查看那里的免费资源。话虽如此，让我们玩得开心点。</p><h1 id="6322" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">入门指南</h1><p id="95dc" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">我们将从理解副作用开始，然后继续了解为什么纯函数是避免它们的常见解决方案。</p><h1 id="7f08" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">JavaScript的副作用是什么？</h1><p id="bb3e" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">当我们修改某些东西时，在JavaScript中，我们会引起副作用，这仅仅意味着修改或改变我们的代码，导致它具有不可预测的行为和<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Glossary/Mutable" rel="noopener ugc nofollow" target="_blank">可变性</a>。让我们通过查看这个简单的代码片段来更好地理解这一点。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="cf97" class="ml la in mh b gy mm mn l mo mp">//side effect</span><span id="6d5c" class="ml la in mh b gy mq mn l mo mp">const fruits = ['pineapple','orange','pawpaw','kiwi']</span><span id="32f7" class="ml la in mh b gy mq mn l mo mp">function removeData(dataArr){</span><span id="19d6" class="ml la in mh b gy mq mn l mo mp">return dataArr.pop()</span><span id="4f54" class="ml la in mh b gy mq mn l mo mp">}</span><span id="e252" class="ml la in mh b gy mq mn l mo mp">removeData(fruits)</span></pre><p id="f580" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这段代码中，我们所做的就是从任何提供的数组中移除最后一个元素，然而，结果将会改变原始数组，如果我们必须编写一个更好的程序，这是不好的，想象我们有非常有用的数据，我们需要在将来重用，这将使我们不可能这样做，显然我们可以在这里看到副作用，这是我们的代码被修改后，我们从数组中移除一个元素。</p><p id="2c10" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，考虑这个例子，想象一个用户购买了一些物品，如果购买的物品有一些问题，有一个购买物品的历史将会很方便，即使用户通过丢弃一个物品对他们的购物车进行了一些修改，也不应该丢弃整个购物车。</p><p id="f52a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看最后一个例子:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9abc" class="ml la in mh b gy mm mn l mo mp">function sayHello(){</span><span id="d1be" class="ml la in mh b gy mq mn l mo mp">console.log('Hello')</span><span id="3dbc" class="ml la in mh b gy mq mn l mo mp">}</span><span id="1e8d" class="ml la in mh b gy mq mn l mo mp">sayHello()</span></pre><p id="d9dc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这段代码也会引起副作用，原因是console.log()属于window对象，我们总是想编写可预测的程序。即输入应该总是等于函数产生的输出。</p></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h1 id="bffb" class="kz la in bd lb lc my le lf lg mz li lj lk na lm ln lo nb lq lr ls nc lu lv lw bi translated">良好功能的质量</h1><p id="5917" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">在下一个主题中，我将讨论纯函数以及它们是如何补救编写好的程序的，但是理解好的函数的特性也是非常重要的，所以我把几个要点放在一起，以帮助您更好地理解。</p><ul class=""><li id="6ffb" class="nd ne in kc b kd ke kh ki kl nf kp ng kt nh kx ni nj nk nl bi translated"><strong class="kc io"> 1 </strong> <strong class="kc io">任务</strong>:一个好的功能应该一次完成一项任务，它应该专注于一件事并且做得最好。</li><li id="fa9a" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">可预测性</strong>:一个好的函数应该是可预测的，这样我们总是期望相同的输入和输出。</li><li id="f562" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">可组合性</strong>:在程序中进行组合，我们关心的是处理组件之间关系的系统设计原则</li><li id="6e66" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">不变性</strong>:这意味着不改变数据或状态，而是复制并返回新数据。</li><li id="88cb" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">返回语句</strong>:一个好的函数必须有一个返回语句。</li><li id="d3fd" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">纯</strong>:在不产生副作用的情况下功能还是不错的。</li><li id="f6e3" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">无共享状态</strong>:要写一个好的函数，我们要避免状态共享。</li></ul></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h1 id="81f3" class="kz la in bd lb lc my le lf lg mz li lj lk na lm ln lo nb lq lr ls nc lu lv lw bi translated">我们如何避免程序中的副作用？</h1><p id="440e" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">在我们的程序中，避免副作用的最好方法之一是使用纯函数，记得当我们谈论一个好函数的质量时，我们说过一个函数必须是纯的，以满足质量函数的要求。但是什么是纯函数呢？</p><h1 id="1efa" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">纯函数，是什么？</h1><p id="f47e" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">纯函数是这样的函数，无论给它什么输入，它都返回相同的输出，而不会引起任何副作用。因为我们的目标是避免副作用，理解纯函数有助于我们做到这一点。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f7f2" class="ml la in mh b gy mm mn l mo mp">// remedy for side effects</span><span id="3996" class="ml la in mh b gy mq mn l mo mp">const arr = [1,2,3]</span><span id="8a89" class="ml la in mh b gy mq mn l mo mp">function removeItem(item){</span><span id="ec22" class="ml la in mh b gy mq mn l mo mp">const newArr = [].concat(item);</span><span id="9510" class="ml la in mh b gy mq mn l mo mp">newArr.pop()</span><span id="2b82" class="ml la in mh b gy mq mn l mo mp">return newArr</span><span id="58a0" class="ml la in mh b gy mq mn l mo mp">}</span><span id="cd62" class="ml la in mh b gy mq mn l mo mp">// console.log(removeItem(arr));</span><span id="d396" class="ml la in mh b gy mq mn l mo mp">// console.log(arr);</span></pre><p id="0ebc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的代码中，我们所做的只是从数组中移除一个项目，<code class="fe nr ns nt mh b">concat()</code>方法确保我们不会通过复制来改变所提供的数组。</p><p id="4e80" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还避免了全局变量，而是使用局部变量，这将防止“外部世界”的访问，即变量不能在代码块之外被调用。在JavaScript中我们称之为作用域，但是我不打算在这里谈论它，因为它超出了本文的范围。</p></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h1 id="6190" class="kz la in bd lb lc my le lf lg mz li lj lk na lm ln lo nb lq lr ls nc lu lv lw bi translated">为什么纯函数是JavaScript中副作用的最佳解决方案？</h1><p id="0233" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">为了更好地理解这一点，我们来看看使用纯函数的一些意义。</p><h1 id="49c6" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">意义</h1><ul class=""><li id="e5a9" class="nd ne in kc b kd lx kh ly kl nu kp nv kt nw kx ni nj nk nl bi translated"><strong class="kc io">可预测性</strong>:当我们编写纯函数时，我们总是知道会发生什么，因为它对外部变量没有影响。</li><li id="9ed9" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">测试</strong>:使功能易于测试。</li><li id="9370" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">组合</strong>:组合是使用较小的代码片段创建较大代码的行为<code class="fe nr ns nt mh b">compose()</code>方法就是一个例子。纯函数使这成为可能。</li><li id="9eef" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><strong class="kc io">不变性</strong>:意味着无法改变数据或状态，通过编写纯函数，我们制作副本而不是改变原始数据，例如</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="368e" class="ml la in mh b gy mm mn l mo mp">const obj = {name: 'iggy'}</span><span id="ac39" class="ml la in mh b gy mq mn l mo mp">function clone(obj){</span><span id="1367" class="ml la in mh b gy mq mn l mo mp">return {...obj} // immutability (making copies)</span><span id="1dae" class="ml la in mh b gy mq mn l mo mp">}</span><span id="0e9b" class="ml la in mh b gy mq mn l mo mp">function updateName(obj){</span><span id="0db4" class="ml la in mh b gy mq mn l mo mp">const obj2 = clone(obj);</span><span id="1094" class="ml la in mh b gy mq mn l mo mp">obj2.name = 'sewa'</span><span id="e4c7" class="ml la in mh b gy mq mn l mo mp">return obj2</span><span id="b3c7" class="ml la in mh b gy mq mn l mo mp">}</span><span id="06df" class="ml la in mh b gy mq mn l mo mp">const updateObj = updateName(obj)</span></pre><p id="2f47" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，更改名称-值不会改变对象，因为通过使用spread操作符，我们复制了对象中包含的所有内容。</p><p id="dd73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，纯函数帮助我们最小化程序中的错误。</p><p id="6cdc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经知道为什么纯函数是编写没有副作用的程序的最佳解决方案，因为它们有许多好处，</p><p id="f176" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">重要的是要知道纯函数是<a class="ae jz" href="https://www.freecodecamp.org/news/functional-programming-principles-in-javascript-1b8fc6c3563f/" rel="noopener ugc nofollow" target="_blank">函数式编程</a>的概念，我只需要在这里提一下，因为谈论纯函数而不谈论函数式编程是不可能的，函数式编程就是关注点的分离，它是一种确保我们的代码做它擅长的事情并确保数据不会变异的方法，这使它成为大多数开发人员的选择。</p><p id="eb4a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这背后的总体思想是最小化副作用，这在修复程序中的错误时是有益的，因为我们确切地知道去哪里。</p></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h1 id="7afe" class="kz la in bd lb lc my le lf lg mz li lj lk na lm ln lo nb lq lr ls nc lu lv lw bi translated">结论</h1><p id="2dfb" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">副作用不一定是不好的，但这里的目标是以一种将事物相互隔离的方式组织代码。如果你想了解更多—副作用和纯功能。我推荐你去看看这个<a class="ae jz" href="https://www.freecodecamp.org/news/what-is-a-pure-function-in-javascript-acb887375dfe/" rel="noopener ugc nofollow" target="_blank">资源</a>。</p><p id="2ea7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就这样了，伙计们，我希望你们在阅读这篇文章时都很开心，希望这能帮助你们在纯函数的帮助下写出更好的程序，如果你们不是100%清楚，请不要犹豫问我任何问题，我也欢迎反馈，所以请随时让我知道你们认为我应该改进的地方。</p><p id="344c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">编码快乐，感谢您的阅读！</p><p id="cade" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容尽在</em><a class="ae jz" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">plain English . io</em></strong></a></p></div></div>    
</body>
</html>