<html>
<head>
<title>How to use CryptoJS and Cookies to Work with Secrets in Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用CryptoJS和Cookies在Postman中处理秘密</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/postman-secrets-cookies-cryptojs-4051db70e8c2?source=collection_archive---------7-----------------------#2021-02-05">https://javascript.plainenglish.io/postman-secrets-cookies-cryptojs-4051db70e8c2?source=collection_archive---------7-----------------------#2021-02-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/80a4838f4da0635061e5051b49dc70c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wYsJo5XRfQCISszX"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@foodess?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Food Photographer | Jennifer Pallian</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f395" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我之前的文章中，我们探索了<a class="ae jz" href="https://medium.com/javascript-in-plain-english/how-to-use-cookies-to-store-secrets-in-postman-afa9a666590d" rel="noopener">如何在Postman中使用cookies来存储你的秘密</a>。根据您的安全需求，您可能需要使用加密技术。这就是CryptoJS可以帮忙的地方。</p><h1 id="e797" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">生成加密秘密的脚本</h1><p id="2224" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们可以使用本地Node.js脚本和CryptoJS库来加密这个秘密。下面的例子显示了我们将如何加密一个API密钥。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7895" class="mk kz in mg b gy ml mm l mn mo">const CryptoJS = require('crypto-js');<br/>const { API_KEY: apiKey, SECRET_KEY: secretKey } = process.env;<br/>const encryptedText = CryptoJS.AES.encrypt(apiKey, secretKey).toString();<br/>console.log('encryptedText:', encryptedText);</span></pre><p id="bdfb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将API密钥和秘密密钥(用于加密API密钥)设置为环境变量。这样我们就不会将数据硬编码到我们的脚本中。</p><h1 id="7d25" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">在Postman中使用加密的秘密和密钥</h1><p id="2fa1" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们将密钥存储为cookie以避免共享值，并将加密的API密钥存储为环境变量。</p><p id="78a7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将一个cookie域列入白名单。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/41bbbf3431a98e58ca12db9b628cd23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UCBdhEdRp-pWE0c3"/></div></div></figure><p id="aabb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建一个cookie来存储密钥。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/eb2b573ad5d3f97ffde24652009f70c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4K6z41L_dZMJDHql"/></div></div></figure><p id="fd10" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建一个具有加密API密钥的环境变量。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/9fcfd839a04f3cadc0020836965f4c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cvjzw9XfaqhTBcI2"/></div></div></figure><p id="9990" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建一个预请求脚本来从cookie中获取密钥，从环境变量中解密加密的API密钥，并用明文API密钥设置一个临时变量(Postman Sessions)。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="7da9" class="mk kz in mg b gy ml mm l mn mo">// https://postman-quick-reference-guide.readthedocs.io/en/latest/libraries.html<br/>const cookieJar = pm.cookies.jar();<br/>const sessionVarName = "xApiKey";<br/>const cookieName = "secretKey";<br/>const domain = "postman.galaxy.demo";<br/>cookieJar.get(domain, cookieName, (error, secretKey) =&gt; {<br/>  if (error) {<br/>    console.error(error);<br/>    pm.variables.set(sessionVarName, "error");<br/>  }<br/>  if (secretKey) {<br/>    // decryption<br/>    console.log('secretKey', secretKey);<br/>    const xApiKeyEnc = pm.environment.get('x-api-key-enc');<br/>    console.log('xApiKeyEnc', xApiKeyEnc);<br/>    const xApiKey = CryptoJS.AES.decrypt(xApiKeyEnc, secretKey).toString(CryptoJS.enc.Utf8);<br/>    console.log('xApiKey', xApiKey);<br/>    pm.variables.set(sessionVarName, xApiKey);<br/>  } else {<br/>    console.error("Cookie is missing")<br/>    pm.variables.set(sessionVarName, "missing");<br/>  }<br/>});</span></pre><p id="2281" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们编写一个测试，在请求完成后显式删除<code class="fe ms mt mu mg b">xApiKey</code>变量。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="332f" class="mk kz in mg b gy ml mm l mn mo">pm.variables.unset("xApiKey");</span></pre><p id="c239" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以使用<code class="fe ms mt mu mg b">xApiKey</code>变量来使用明文API密钥。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/c32261ca45b965d9dfafb704e2e27fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UzN84Bh47FDkNDdY"/></div></div></figure><h1 id="6c16" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="77f7" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通过使用cookies，我们可以在避免共享密钥的同时使用密钥。通过使用CryptoJS，我们可以将加密的数据存储在环境变量中，对其进行解密，并且只在请求执行期间使用明文(即解密的)数据。</p><p id="5cba" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">阅读第1部分:“如何使用Cookies在Postman中存储秘密。”</p><div class="mw mx gp gr my mz"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-cookies-to-store-secrets-in-postman-afa9a666590d"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd io gy z fp ne fr fs nf fu fw im bi translated">如何在Postman中使用Cookies存储秘密</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">在Postman环境中存储您的秘密(例如，API密钥和密码)可能无法满足您的安全需求…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jt mz"/></div></div></a></div><h1 id="faa0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">在你走之前</h1><p id="8c2b" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">加入我的邮件列表来接收关于我写作的更新。参观miguelacallesmba.com/subscribe<a class="ae jz" href="http://miguelacallesmba.com/subscribe" rel="noopener ugc nofollow" target="_blank"/>并报名。</p><p id="c628" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注册一个<a class="ae jz" href="https://miguelacallesmba.medium.com/membership" rel="noopener">中级会员</a>，阅读更多类似的帖子。</p><p id="b547" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">保持安全，米格尔</p><p id="54e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="no">原载于</em><a class="ae jz" href="https://miguelacallesmba.com/postman-secrets-cookies-cryptojs" rel="noopener ugc nofollow" target="_blank"><em class="no">MiguelACallesMBA.com</em></a></p></div></div>    
</body>
</html>