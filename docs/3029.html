<html>
<head>
<title>I Built a Newsletter Form for Gatsby with ConvertKit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用ConvertKit为Gatsby创建了一个时事通讯表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-newsletter-form-for-gatsbyjs-with-convertkit-aa31d3a991c6?source=collection_archive---------15-----------------------#2021-06-19">https://javascript.plainenglish.io/building-a-newsletter-form-for-gatsbyjs-with-convertkit-aa31d3a991c6?source=collection_archive---------15-----------------------#2021-06-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9bf5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">我正在建立一个电子邮件列表，并开始时事通讯。我选择ConvertKit是因为它是由独立黑客为…</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/41c424b1a808615e11f6716392346b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fGNGSoIC-rNQIESz.jpg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">“Photo by <a class="ae ks" href="https://unsplash.com/@florianklauer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Florian Klauer</a> on <a class="ae ks" href="https://unsplash.com/s/photos/newsletter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>”</figcaption></figure><p id="54b4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">自2020年以来，时事通讯风靡一时！每个人都认为已经灭绝的媒介又回来了，而且比以前更强大！</p><p id="088a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个事实在一定程度上促使我决定从零开始建立一个网站。</p><p id="e187" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">它将成为我订阅时事通讯的“漏斗顶端”。</p><p id="4655" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">技术细节。</p><h2 id="5ba7" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">与电子邮件营销工具集成</h2><p id="0f21" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我选择ConvertKit是因为我可以免费开始并及时构建它。它是由一个<a class="ae ks" href="https://www.indiehackers.com/interview/convertkit-2fcb58f1fa" rel="noopener ugc nofollow" target="_blank">独立黑客</a>用小创造者的想法建造的。</p><p id="bddf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我想开始建立我的电子邮件列表。然而，由于我还没有太多的内容，所以采取过于激进的立场并向我的用户推广时事通讯注册是没有意义的。</p><p id="3094" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我决定在我网站的页脚添加一个时事通讯表单。</p><p id="4071" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">GatsbyJS没有一种直接的方法来集成电子邮件营销工具(或显式ConvertKit)。</p><p id="f3f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我有两个选择:</p><ul class=""><li id="a369" class="mn mo in kv b kw kx kz la lc mp lg mq lk mr lo ms mt mu mv bi translated">自己写一个简单的HTML表单，直接发布到ConvertKit</li><li id="e0b2" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">编写一个<a class="ae ks" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>组件来显示ConvertKit的基于JavaScript的表单</li></ul><p id="409a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我选择了后者，因为它有更好的UX和一些额外的内置功能，我将在下面讨论。</p><p id="b400" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于Gatsby预先呈现了所有页面，所以您不能直接包含脚本标记——它会在构建时被解释，并且对最终用户无效。</p><p id="64ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">解决方案是使用DOM创建一个脚本元素并显示它。</p><p id="3435" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是组件的代码:</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="b925" class="lp lq in nc b gy ng nh l ni nj">import * as React from "react";<br/>import { Component } from "react";<br/><br/>class Newsletter extends Component {<br/>  componentDidMount() {<br/>    const script = document.createElement("script");<br/>    script.src = "CONVERTKIT-FORM-URL";<br/>    script.async = true;<br/>    script.setAttribute("data-uid", "CK-UID");<br/>    this.instance.appendChild(script);<br/>  }<br/><br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;h3&gt;Subscribe to my newsletter&lt;/h3&gt;<br/>        &lt;div ref={(el) =&gt; (this.instance = el)}&gt;&lt;/div&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}<br/><br/>export default Newsletter;</span></pre><h2 id="1a73" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">转换工具</h2><p id="c344" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">一旦我完成了编码部分，我必须定制ConvertKit。</p><p id="6e21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我不想使用我的个人Gmail作为简讯的发件人，但我也不想设立一个单独的帐户或支付电子邮件托管费用。</p><h2 id="4146" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">电子邮件转发</h2><p id="a0e9" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我在https://forwardemail.net创建了一个简单的邮件转发规则，将所有邮件转发到我的Gmail账户。</p><p id="3393" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该过程的第一步是验证您是否拥有该域名。创建帐户后，我更新了我的域名的DNS记录。</p><p id="1df5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我通过<a class="ae ks" href="https://cloudflare.com" rel="noopener ugc nofollow" target="_blank">https://cloudflare.com</a>管理我所有的域名，并且我使用<a class="ae ks" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank">https://www.terraform.io/</a>自动化任何管理操作。</p><p id="61f0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我不会深入探讨Terraform的底层(他们的文档非常好)，但下面是我使用的配置:</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="7ed0" class="lp lq in nc b gy ng nh l ni nj">variable "zone_id_com_mihaibojin" {<br/>  default = "GET-THIS-FROM-CLOUDFLARE"<br/>}<br/><br/>resource "cloudflare_record" "com_mihaibojin_mx1" {<br/>  zone_id  = var.zone_id_com_mihaibojin<br/>  name     = "@"<br/>  value    = "mx1.forwardemail.net"<br/>  priority = 10<br/>  type     = "MX"<br/>}<br/><br/>resource "cloudflare_record" "com_mihaibojin_mx2" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name     = "@"<br/>  value    = "mx2.forwardemail.net"<br/>  priority = 20<br/>  type     = "MX"<br/>}<br/><br/>resource "cloudflare_record" "com_mihaibojin_forwardemail_spf" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name    = "@"<br/>  value   = "v=spf1 a mx include:spf.forwardemail.net -all"<br/>  type    = "TXT"<br/>}<br/><br/>resource "cloudflare_record" "com_mihaibojin_forwardemail_ver" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name    = "@"<br/>  value   = "forward-email-site-verification=GET-THIS-FROM-FORWARDEMAIL"<br/>  type    = "TXT"<br/>}</span></pre><p id="409d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">更新您的域名的DNS，然后是一个简单的命令了！</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="2e9d" class="lp lq in nc b gy ng nh l ni nj">terraform plan &amp;&amp; terraform apply</span></pre><h2 id="9779" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">正在配置转换器</h2><p id="2417" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">在我配置了邮件转发并确认我可以接收邮件后，是时候设置ConvertKit了。在<a class="ae ks" href="https://app.convertkit.com/account/edit#email_settings" rel="noopener ugc nofollow" target="_blank">添加了我的邮箱</a>后，我等待确认邮件并点击了提供的链接。</p><h2 id="5f6c" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">SPF和DKIM</h2><p id="1ec2" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我还建立了“发件人策略框架”(SPF)和“域密钥识别邮件”(DKIM)。<a class="ae ks" href="https://help.convertkit.com/en/articles/2502558-using-a-verified-domain-for-email-sending" rel="noopener ugc nofollow" target="_blank">在这里阅读更多</a>关于为什么验证你发送的电子邮件是必要的(剧透:主要是为了让你的电子邮件不会变成垃圾邮件)。</p><p id="83b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我再次使用Terraform来自动化这个步骤:</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="d010" class="lp lq in nc b gy ng nh l ni nj">resource "cloudflare_record" "om_mihaibojin_convertkit_cname1" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name    = "ckespa.mihaibojin.com"<br/>  value   = "spf.dm-2m2gkx6y.sg7.convertkit.com"<br/>  type    = "CNAME"<br/>}<br/><br/>resource "cloudflare_record" "com_mihaibojin_convertkit_cname2" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name    = "cka._domainkey.mihaibojin.com"<br/>  value   = "dkim.dm-2m2gkx6y.sg7.convertkit.com"<br/>  type    = "CNAME"<br/>}</span></pre><h2 id="4792" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">DMARC</h2><p id="95ee" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我做了额外的工作，还配置了<a class="ae ks" href="https://help.convertkit.com/en/articles/4534360-dmarc-what-is-it-and-should-you-use-it" rel="noopener ugc nofollow" target="_blank"> DMARC </a>。总的来说，当你没有发送大量的电子邮件时，你不应该感到烦恼，但我想正确地开始，并为未来的成功做好准备！</p><p id="8c6b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">DMARC的策略设置之一是<code class="fe nk nl nm nc b">p=none</code>，这意味着数据将被收集但不会被处理——这是您在这个场景中想要的。</p><p id="48d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了监控收集到的数据，我在<a class="ae ks" href="https://dmarcian.com/" rel="noopener ugc nofollow" target="_blank">https://dmarcian.com/</a>上创建了一个账户。他们提供分析您的数据并报告任何威胁的服务。</p><p id="ff86" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是DMARC的DNS记录配置在Terraform中的样子:</p><pre class="kd ke kf kg gt nb nc nd ne aw nf bi"><span id="2635" class="lp lq in nc b gy ng nh l ni nj">resource "cloudflare_record" "com_mihaibojin_dmarc" {<br/>  zone_id = var.zone_id_com_mihaibojin<br/>  name    = "_dmarc.mihaibojin.com"<br/>  value   = "v=DMARC1; p=none; rua=mailto:GET-THIS-FROM-DMARCIAN;"<br/>  type    = "TXT"<br/>}</span></pre><p id="dceb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以通过以下资源了解更多信息:</p><ul class=""><li id="618f" class="mn mo in kv b kw kx kz la lc mp lg mq lk mr lo ms mt mu mv bi translated"><a class="ae ks" href="https://www.newslettercrew.com/blog/what-is-dmarc" rel="noopener ugc nofollow" target="_blank">https://www.newslettercrew.com/blog/what-is-dmarc</a></li><li id="f51e" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated"><a class="ae ks" href="https://dmarcian.com/start-dmarc/" rel="noopener ugc nofollow" target="_blank">https://dmarcian.com/start-dmarc/</a></li></ul><h2 id="0c49" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">GDPR和时事通讯注册</h2><p id="6115" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我在我的<a class="ae ks" href="https://mihaibojin.com/personal-site/privacy-friendly-analytics-in-gatsbyjs?utm_source=Medium&amp;utm_medium=organic&amp;utm_campaign=rss" rel="noopener ugc nofollow" target="_blank">隐私友好分析</a>文章中写了欧盟的隐私和GDPR。</p><p id="48f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ConvertKit有一个选项，允许用户明确选择加入GDPR指导方针下的功能。然而，结果是用户在注册后会被重定向到一个单独的页面。</p><p id="12ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">默认情况下，ConvertKit会将用户发送到<a class="ae ks" href="https://app.convertkit.com/confirm-subscription" rel="noopener ugc nofollow" target="_blank">https://app.convertkit.com/confirm-subscription</a>。因为这会让用户离开我的网站，所以我在<a class="ae ks" href="https://mihaibojin.com/confirm-subscription?utm_source=Medium&amp;utm_medium=organic&amp;utm_campaign=rss" rel="noopener ugc nofollow" target="_blank">https://mihaibojin.com/confirm-subscription</a>复制了同样的信息，这样用户就可以导航回主页或其他文章了！</p><p id="0ce5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通过转到<code class="fe nk nl nm nc b">Settings -&gt; Incentive</code>并添加URL，可以为在ConvertKit中创建的每个表单配置URL。</p><h2 id="8ef4" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">结论</h2><p id="1fff" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我希望这篇文章对你有用。如果你有任何想法或评论，请在这个帖子上分享你的想法<a class="ae ks" href="https://twitter.com/mihaibojin/status/1406043106915594241" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0772" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">目前就这些。将来，我可能会放弃ConvertKit JavaScript代码，实现一个HTML表单，因为我不是特别喜欢跟踪我的站点上运行的JS。</p><p id="1896" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在那之前，注意安全！</p></div><div class="ab cl nn no hr np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="ig ih ii ij ik"><p id="1a85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你喜欢这篇文章，并想阅读更多类似的文章，请订阅我的时事通讯。我每隔几周就发一封！</p><p id="b287" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nu">本文最初发布在我的网站上，</em><a class="ae ks" href="https://MihaiBojin.com/personal-site/newsletter-convertkit?utm_source=external&amp;utm_medium=organic&amp;utm_campaign=rss" rel="noopener ugc nofollow" target="_blank"><em class="nu">MihaiBojin.com</em></a><em class="nu">。</em></p><p id="6dfb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">延伸阅读</strong></p><div class="nv nw gp gr nx ny"><a href="https://circuit.ooo/blog/the-key-ingredient-behind-high-newsletter-open-rates" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd io gy z fp od fr fs oe fu fw im bi translated">高简讯打开率背后的关键因素</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">在这篇文章中，我们将讨论我们9个月前的时事通讯《简明英语上周》是如何一直…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">电路. ooo</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om km ny"/></div></div></a></div><p id="b26a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nu">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nu">说白了。报名参加我们的</em> </a><a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nu">免费每周简讯</em> </a> <em class="nu">。关注我们</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <em class="nu">推特</em> </a>，<a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><em class="nu">LinkedIn</em></a><em class="nu">，</em><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><em class="nu">YouTube</em></a><em class="nu">，以及</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nu">不和谐</em> </a> <em class="nu">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <em class="nu">电路</em> </a> <em class="nu">。</em></p></div></div>    
</body>
</html>