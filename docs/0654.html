<html>
<head>
<title>JavaScript Promises Are Easier Than You Think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript承诺比你想象的要容易</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-promises-easier-than-you-can-imagine-cfb18b1f35bc?source=collection_archive---------7-----------------------#2021-02-10">https://javascript.plainenglish.io/javascript-promises-easier-than-you-can-imagine-cfb18b1f35bc?source=collection_archive---------7-----------------------#2021-02-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7c82c6e8e51df9d57c8208d232d0e7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sX4H2tDZGQ5G-KQi-zcqeQ.jpeg"/></div></div></figure><p id="04b2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我在编程中遇到一个新的抽象概念时，我总是试图把它和一些简单易懂的东西联系起来，比如食物😋我喜欢食物！我见过的几乎每个人都这样。这就是为什么今天我们要把JavaScript中的承诺和异步代码执行看作美味的食物。我在RBK 大学和我的学生一起尝试过，效果非常好。这就是为什么我要将异步代码执行与从餐馆订餐联系起来。现在，让我们继续订购一些承诺。</p><h1 id="bf91" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak">承诺和食物</strong></h1><p id="0d27" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">午餐时间到了，你饿了。你不会做饭，甚至没有时间做饭。这就是为什么你决定去街角的麦当劳餐厅吃午餐。你一直喜欢他们做的芝士汉堡，所以你的决定一点也不难。</p><p id="9b21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你去收银台向他要一个芝士汉堡。你付了餐费，作为回报，他给了你一张票。现在，这张票就是JavaScript承诺。不是食物，不是价值，而是未来的价值。收银员(或服务员)给你一个承诺，他会把你的饭送回来。什么时候？它可能需要几秒或几分钟，就像它可能需要一个小时一样。这完全取决于做饭的速度有多快，以及有多少人已经在排队了。在最糟糕的情况下，服务员会走过来告诉你他们没有奶酪了😫也许你可以点别的。</p><p id="d2e9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">承诺也是如此，你执行一些异步代码(比如从客户端向服务器发送请求)，然后等待你的响应。同时，作为回报，您将获得对未来数据的承诺。</p><p id="3631" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当汉堡(或数据)最终准备好时，你可以<strong class="jx io">然后</strong>开始吃它，享受它的味道。否则，你可以点别的或者去另一家还有奶酪的餐馆。</p><p id="7d4c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">承诺也是如此。如果您得到了您的响应，您就可以操作该数据或将其输出给用户。另一方面，如果你不这样做，你会做其他事情，比如通知用户没有数据了。</p><h1 id="8b2a" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">使用承诺向API发送请求</h1><p id="93e4" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">现在，让我们看一个代码示例。对于这个博客，我将向<a class="ae ly" href="https://docs.github.com/en/rest" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> Github API </strong> </a>发送一个GET请求。然而，API并不发回食物。然而，Github API可以给我们发回另一个比食物更好的东西！是的，你猜对了… <a class="ae ly" href="https://docs.github.com/en/rest/reference/emojis" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">表情符号</strong> </a>🎉 🎉我们开始吧！</p><p id="4f66" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一件事当然是创建一个JavaScript文件。我准备把它命名为“index.js”。然后，我们需要一个来自Github的API令牌来发送请求。你可以在<a class="ae ly" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">https://github.com/settings/tokens</a>上生成你自己的。</p><p id="2bad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将把我自己的密钥放在一个单独的文件中，然后将其导入index.js，我将使用npm来安装Axios。</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="07ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我导入了<a class="ae ly" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>来使用它向API发送http请求。这是一个出色的基于promise的HTTP客户端库。在这篇博客中，我不打算深入研究如何使用<a class="ae ly" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">本机承诺</a>或外部库如<a class="ae ly" href="https://www.npmjs.com/package/bluebird" rel="noopener ugc nofollow" target="_blank">蓝鸟</a>来创建并使函数返回承诺。相反，我将关注如何发送请求，并以基于承诺的模式处理返回值。</p><p id="4329" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有了这些，现在让我们点一些食物(一些表情符号)😅</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="7559" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我创建了一个名为<strong class="jx io"> getEmojis </strong>的函数，并在第21行调用它。如果我们深入函数定义，我们会发现在第5行，我们使用get方法用Axios发出get请求。该方法有两个参数:路径<em class="mf">“https://API . github . com/e mojis”和一个包含<em class="mf"> headers </em>属性的对象，其中我们将导入的API_TOKEN作为值提供给<em class="mf">授权。</em></em></p><p id="c45f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个调用现在没有立即返回值(因为我们没有立即得到我们的芝士汉堡)。相反，它返回对未来值的承诺。毕竟，从远程服务器获得响应需要时间，就像厨师需要时间准备汉堡一样。</p><p id="0a78" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Promise类型的返回值有两个不同的重要方法:<strong class="jx io">。然后是()</strong>和<strong class="jx io"> catch() </strong>。第一个将在请求成功时被调用(返回承诺值)，而第二个将在请求失败时被调用(没有返回承诺值)。现在，请求可能因为许多原因而失败，包括但不限于失去网络访问或者我们将它发送到了一个不存在的路径(比如“https://api.github.com/food ”,因为Github API到目前为止不提供食物)。</p><p id="e5a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，API说，当我们在那个<strong class="jx io">端点</strong>上发送一个<strong class="jx io"> GET </strong>请求时，它将向我们发回GitHub处理的表情符号的完整列表。这就是为什么我假设我的回调函数，将会被执行，将会有一个参数，就是表情符号的数组。对于本例，我将只把它们记录到控制台。在另一个上下文中，当您的汉堡准备好并端上桌时，您将执行带有参数<em class="mf">(汉堡)的函数<em class="mf"> eatBurger </em>。</em></p><p id="ee92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果请求失败，我将<em class="mf">捕捉</em>返回给我的错误消息并抛出，以便能够调试我的代码。</p><h1 id="2640" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><em class="mg">结论</em></h1><p id="f0fc" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg lv ki kj kk lw km kn ko lx kq kr ks ig bi translated">承诺是JavaScript的一大亮点。他们允许我们有一个非常可读的代码，并把我们从回调地狱中拯救出来，在回调地狱中，你在一个回调中执行另一个回调。事实上，在回调中，我们的代码变得越来越水平，而在承诺中，它变得垂直有序，这使得它对于开发人员和普通人来说是可读的。</p><p id="c51d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们得到的承诺值有两个主要方法。成功时执行的then()，以及。失败时执行的catch()。</p></div></div>    
</body>
</html>