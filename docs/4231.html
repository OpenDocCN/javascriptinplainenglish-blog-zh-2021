<html>
<head>
<title>Interaction with an Apollo GraphQL Server from the Frontend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从前端与Apollo GraphQL服务器交互</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/interaction-with-an-apollo-graphql-server-from-the-frontend-633538f0c2f5?source=collection_archive---------11-----------------------#2021-08-22">https://javascript.plainenglish.io/interaction-with-an-apollo-graphql-server-from-the-frontend-633538f0c2f5?source=collection_archive---------11-----------------------#2021-08-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5c0c7f2900e4597677203b1d4c1f018f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcM9nMzZeM_MBlpvLJsV5Q.jpeg"/></div></div></figure><h2 id="1d8d" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h2><p id="3d37" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">Apollo GraphQL允许我们构建一个服务器，客户可以用他们想要的任何方式进行查询。在本文中，我们将研究与后端数据交互的不同方式。我们将经历设置、查询、变异和轮询或显式获取。</p><h2 id="6941" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">描述</h2><p id="d1a1" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">我们需要指定服务器的URL并实例化一个客户端。因此，我们首先进行如下设置:</p><ul class=""><li id="f768" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们需要apollo-boost和react-apollo库来用GraphQL建立一个react应用程序。</li><li id="0077" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">阿波罗飞船为我们提供了一个阿波罗客户端。</li><li id="54fe" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们需要实例化一个URL。</li><li id="ed6b" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">react-apollo为我们提供了更高级别的供应商。</li><li id="c9f9" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们需要用它包装我们的应用程序。</li><li id="d499" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">首先进行基本安装:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9204" class="jv jw in mh b gy ml mm l mn mo">yarn add react-apollo apollo-boost graphql</span></pre><ul class=""><li id="3fe5" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">当我们安装好所有东西后，我们就可以开始设置了。</li><li id="5d04" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">转到index.js并键入以下内容:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3f7c" class="jv jw in mh b gy ml mm l mn mo">import React, { Component } from "react";<br/>import ApolloClient from "apollo-boost";<br/>import { ApolloProvider } from "react-apollo";<br/>import Local from “./components/Local”;<br/>const localGraphQL = "http://localhost:4000/graphql";<br/>const client = new ApolloClient({<br/>  uri: localGraphQL<br/>});<br/>class App extends Component {<br/>  render() {<br/>    return (<br/>      &lt;ApolloProvider client={client}&gt;<br/>        &lt;div&gt;<br/>          &lt;h2&gt;My first Apollo app &lt;/h2&gt;<br/>        &lt;/div&gt;<br/>     &lt;/ApolloProvider&gt;<br/>    );<br/>  }<br/>}<br/>export default App;</span></pre><ul class=""><li id="adf1" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">如上所示，我们首先实例化一个ApolloClient。</li><li id="c470" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">然后在这个过程中提供一个url，我们的GraphQL服务器的位置。</li><li id="a13a" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">此外，我们用我们的ApolloProvider包装整个应用程序。</li><li id="4a8c" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们还用ApolloClient实例设置了它的客户端属性。</li><li id="987b" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">现在我们已经准备好与我们的GraphQL服务器进行交互了</li></ul><h2 id="fc33" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">询问</h2><ul class=""><li id="9145" class="lm ln in kt b ku kv ky kz ke mp ki mq km mr ll lt lu lv lw bi translated">为了能够查询Apollo服务器，我们需要做三件事:</li><li id="c940" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">编写我们的gql查询</li><li id="0a82" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">利用react-apollo库提供的查询组件</li><li id="14da" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">呈现响应</li></ul><figure class="mc md me mf gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/713a215d420d37e0d7e8058953764441.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/0*SfRpBuOzWDLoxZ67.jpg"/></div></figure><ul class=""><li id="d0f1" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们需要导入graphql-tag，然后编写graphql查询来编写我们的gql查询，如下所示:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2e43" class="jv jw in mh b gy ml mm l mn mo">const getRates = gql`<br/>{<br/>  rates(currency: “USD”) {<br/>    currency<br/>    rate<br/>  }<br/>}`;</span></pre><ul class=""><li id="2acc" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">之后，我们需要从react-apollo导入查询组件。</li><li id="5d41" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">As input属性给出了我们刚刚定义的查询，结果如下:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b122" class="jv jw in mh b gy ml mm l mn mo">const Data = () =&gt; (<br/>  &lt;Query query={getRates} &gt;<br/>  // render the query results<br/>  &lt;/Query&gt;<br/>);</span></pre><ul class=""><li id="0706" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们正在调用一个函数，该函数在查询组件的第一个子组件中有一个对象作为参数。</li><li id="e3dd" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">该对象具有以下属性:</li><li id="f695" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">加载，只要查询还没有被解决这是真的</li><li id="cbee" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">错误，如果我们从查询中返回一个错误</li><li id="31b3" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">数据，查询得到的数据结果</li><li id="e8aa" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">此时，我们了解了这些属性以及如何使用它们，让我们一起来放置:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="15d9" class="jv jw in mh b gy ml mm l mn mo">import React from "react";<br/>import { Query } from "react-apollo";<br/>import gql from "graphql-tag";<br/>const getRates = gql`<br/>{<br/>  products(type: "DVD") {<br/>    name<br/>    price<br/>  }<br/>}`;<br/>const Data = () =&gt; (<br/>  &lt;Query query={getRates} &gt;<br/>  {({ loading, error, data }) =&gt; {<br/>  if (loading) return &lt;p&gt;Loading…&lt;/p&gt;;<br/>  if (error) return &lt;p&gt;Error :(&lt;/p&gt;;<br/>  return data.products.map(({ name, price }) =&gt; (<br/>    &lt;div key={name}&gt;<br/>      &lt;p&gt;{`${name}: ${price}`}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>   ));<br/>  }}<br/>&lt;/Query&gt;<br/>);<br/>export default Data;</span></pre><ul class=""><li id="da6a" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们现在已经非常熟悉如何从GraphQL服务器读取数据并呈现给我们的用户。</li></ul><h2 id="5856" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">投票</h2><ul class=""><li id="99f5" class="lm ln in kt b ku kv ky kz ke mp ki mq km mr ll lt lu lv lw bi translated">有时，我们还希望定期获取数据，而不必公开导航到某个页面或按下一个确切的按钮来发出GET请求。</li><li id="caac" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">例如，我们在聊天应用中使用它来获得实时感。</li><li id="2e5e" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们显然是在谈论轮询，即定期获取数据。</li><li id="81fd" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们学习使用的查询因子具有内置的轮询。</li><li id="df6b" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们需要做的就是将pollInterval属性设置为两次提取之间所需的毫秒数。</li><li id="a113" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">让我们来看看这可能是什么样子:</li></ul><figure class="mc md me mf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/f0bc77ad291f96af7800cc35cdb47c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bkA1PlO6qoy-vNjL.jpg"/></div></div></figure><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8b84" class="jv jw in mh b gy ml mm l mn mo">import React from "react";<br/>import { Query } from "react-apollo";<br/>import gql from "graphql-tag";<br/>const GET_DATA = gql`<br/>{<br/>  products {<br/>    name<br/>    id<br/>  }<br/>}<br/>`;<br/>const DataPull = () =&gt; (<br/>  &lt;Query query={GET_DATA} pollInterval={500}&gt;<br/>  {(loading, error, data, startPolling, stopPolling) =&gt; {<br/>  if (loading) return null;<br/>  if (error) return `Error!: ${error}`;<br/>    return (<br/>     &lt;React.Fragment&gt;<br/>      {data.products.map(p =&gt; &lt;div&gt;{p.name}&lt;/div&gt;)}<br/>      &lt;button onClick={()=&gt; startPolling()}&gt;Start polling&lt;/button&gt;<br/>      &lt;button onClick={() =&gt; stopPolling()}&gt;Stop polling&lt;/button&gt;<br/>    &lt;/React.Fragment&gt;;<br/>    )<br/>}}<br/>&lt;/Query&gt;<br/>);<br/>export default DataPull;</span></pre><ul class=""><li id="83b3" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">如上所述，我们现在提出了以下新概念:</li><li id="2678" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">pollInterval，这大致是以毫秒为单位的轮询间隔，我们可以看到我们将其设置为500，例如半秒</li><li id="13d6" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">startPolling，这是一个函数，如果我们之前停止了轮询，我们可以重新开始轮询</li><li id="b0fd" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">停止轮询是一个允许我们随时停止轮询的功能。</li></ul><h2 id="5120" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">重取</h2><ul class=""><li id="539c" class="lm ln in kt b ku kv ky kz ke mp ki mq km mr ll lt lu lv lw bi translated">有时，我们最终会遇到这样的情况，我们希望公开获取数据，以确认我们看到的是最新的数据。</li><li id="9c95" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">这样做的目的是对用户操作做出反应，而不是轮询。</li><li id="8857" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">让我们看看如何使用这一重取功能:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="b243" class="jv jw in mh b gy ml mm l mn mo">import React from "react";<br/>import { Query } from "react-apollo";<br/>import gql from "graphql-tag";<br/>const GET_DATA = gql`<br/>{<br/>  products {<br/>    name<br/>    id<br/>  }<br/>}<br/>`;<br/>const Refetch = () =&gt; (<br/>  &lt;Query query={GET_DATA}&gt;<br/>  {(loading, error, data, refetch) =&gt; {<br/>  if (loading) return null;<br/>  if (error) return `Error!: ${error}`;<br/>  return (<br/>    &lt;React.Fragment&gt;<br/>      &lt;div&gt;<br/>        {data.prop}<br/>        &lt;button onClick={() =&gt; refetch()}&gt;Fetch&lt;/button&gt;<br/>      &lt;/div&gt;<br/>   &lt;/React.Fragment&gt;<br/>  )<br/>}}<br/>&lt;/Query&gt;<br/>);<br/>export default Refetch;</span></pre><ul class=""><li id="ff9d" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">如上所示，我们向查询子函数添加了另一个参数refetch，如下所示:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0c72" class="jv jw in mh b gy ml mm l mn mo">{(loading, error, data, refetch) =&gt; {<br/>}}</span></pre><ul class=""><li id="b519" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">这个refetch参数是一个函数。</li><li id="d698" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们可以调用它。</li><li id="6c4f" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">因此，在我们的标记中将它连接到一个按钮，如下所示:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a12b" class="jv jw in mh b gy ml mm l mn mo">&lt;button onClick={() =&gt; refetch()}&gt;Fetch&lt;/button&gt;</span></pre><h2 id="a06b" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">变化</h2><ul class=""><li id="1bd0" class="lm ln in kt b ku kv ky kz ke mp ki mq km mr ll lt lu lv lw bi translated">一旦我们对GraphQL服务器进行了变异，我们需要执行以下操作:</li><li id="63e0" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">调用正确的突变</li><li id="73f0" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">使用react-apollo中的变异组件</li><li id="4cb9" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">以上内容并不完整，事实并非如此。</li><li id="ff05" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">让我们从第一件事开始，我们的突变查询:</li><li id="c019" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们将使用graphql-tag库中的gql助手来创建我们的变异查询。</li><li id="abc9" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">然后我们使用关键字突变，接着给突变一个名字。</li><li id="0c5c" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">识别它的输入参数$person。</li><li id="9ce0" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">目前我们有以下查询:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="bd47" class="jv jw in mh b gy ml mm l mn mo">const ADD_PERSON = gql`<br/>mutation AddPerson($person: Person!) {<br/>}<br/>`;</span></pre><p id="62a5" class="pw-post-body-paragraph kr ks in kt b ku lo kw kx ky lp la lb ke mu ld le ki mv lg lh km mw lj lk ll ig bi translated">现在我们准备调用我们在GraphQL服务器中定义的实际突变addPerson。您的突变查询现在应该如下所示:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f373" class="jv jw in mh b gy ml mm l mn mo">const ADD_PERSON = gql`<br/>mutation AddPerson($person: Person!) {<br/>   addPerson(person: $person) {<br/>     id<br/>   }<br/>}<br/>`;</span></pre><ul class=""><li id="c79d" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">接下来的工作是通过使用React组件变异来放置变异查询。</li><li id="ad7d" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">该组件需要两件东西:</li><li id="2b0e" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">填充突变属性，</li><li id="3054" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">定义突变组件的子组件</li><li id="e599" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">让我们从使用突变组件的第一点开始。</li><li id="bec5" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">设置其突变属性，如下所示:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0b80" class="jv jw in mh b gy ml mm l mn mo">import React from "react";<br/>import { Mutation } from "react-apollo";<br/>import gql from "graphql-tag";<br/>const ADD_PERSON = gql`<br/>  mutation AddPerson($person: Person!) {<br/>    addPerson(person: $person) {<br/>      id<br/>    }<br/>  }<br/>`;<br/>&lt;Mutation mutation={ADD_PERSON}&gt;<br/>&lt;/Mutation&gt;</span></pre><ul class=""><li id="ce96" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们已经使用了我们的突变组件。</li><li id="0c3f" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">用我们的突变查询ADD_PERSON设置突变属性。</li><li id="f3cb" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">下一步是定义突变组件的子组件。</li><li id="a938" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">正如我们已经说过的，孩子是这样一个函数:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3d11" class="jv jw in mh b gy ml mm l mn mo">(addPerson, { data, loading, error }) =&gt; (<br/>// JSX<br/>)</span></pre><ul class=""><li id="3697" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">如上所述的函数预计将返回JSX。</li><li id="417e" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们可能会定义一段JSX，让我们使用以下内容:</li><li id="5642" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">addPerson()，这个函数将执行变异查询。</li><li id="cd47" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">加载时，这个布尔值会告诉我们突变是否正在进行，使用这个值来决定是否使用微调器</li><li id="4f1a" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">数据，这是变异查询完成后返回的数据</li><li id="508e" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">现在，让我们定义我们的JSX。</li><li id="4b2e" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">当我们想要收集数据时，定义一个表单是很常见的</li><li id="46d1" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">因此，让我们这样做:</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="c63c" class="jv jw in mh b gy ml mm l mn mo">&lt;form onSubmit={e =&gt; {<br/>e.preventDefault();<br/>addPerson({ variables: { person: { name: input.value } } });<br/>input.value = “”;<br/>}} &gt;<br/>&lt;input ref={node =&gt; { input = node; }} /&gt;<br/>&lt;button type=”submit”&gt;Add Person&lt;/button&gt;<br/>{loading &amp;&amp;<br/>&lt;div&gt;adding person…&lt;/div&gt;<br/>}<br/>{ data &amp;&amp;<br/>&lt;div&gt;response data&lt;/div&gt;<br/>}<br/>{ error &amp;&amp;<br/>&lt;div&gt;Error adding person…&lt;/div&gt;<br/>}<br/>&lt;/form&gt;</span></pre><ul class=""><li id="8f4b" class="lm ln in kt b ku lo ky lp ke lq ki lr km ls ll lt lu lv lw bi translated">我们有我们的形式和一个输入框和一个按钮，我们可以按下。</li><li id="b608" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们将addPerson()方法挂接到表单的onSubmit()上。</li><li id="6fe1" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们还解决了如何获取数据进行变异查询。</li><li id="ebfe" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">我们给addPerson()方法一个具有属性变量的对象，在这些属性变量中，将一个对象分配给属性Person。</li><li id="f8af" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">person属性与变异查询中存在的输入参数相同。</li><li id="b4f7" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">其他字段数据、加载和错误用作条件JSX，如果它们为真，我们选择显示它们。</li><li id="3343" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">这就是用一些参数调用突变的全部内容</li><li id="a8d5" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">显示响应，无论是实际数据还是错误。</li><li id="9317" class="lm ln in kt b ku lx ky ly ke lz ki ma km mb ll lt lu lv lw bi translated">以下是完整的代码。</li></ul><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="e4be" class="jv jw in mh b gy ml mm l mn mo">import React from “react”;</span><span id="86bd" class="jv jw in mh b gy mx mm l mn mo">import { Mutation } from “react-apollo”;</span><span id="266f" class="jv jw in mh b gy mx mm l mn mo">import gql from “graphql-tag”;</span><span id="15d6" class="jv jw in mh b gy mx mm l mn mo">const ADD_PERSON = gql`</span><span id="f182" class="jv jw in mh b gy mx mm l mn mo">mutation AddPerson($person: Person!) {</span><span id="1d61" class="jv jw in mh b gy mx mm l mn mo">addPerson(person: $person) {</span><span id="9ba3" class="jv jw in mh b gy mx mm l mn mo">id</span><span id="dd17" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="235b" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="d2be" class="jv jw in mh b gy mx mm l mn mo">`;</span><span id="e14d" class="jv jw in mh b gy mx mm l mn mo">const DataInput = () =&gt; {</span><span id="f766" class="jv jw in mh b gy mx mm l mn mo">let input;</span><span id="e9fd" class="jv jw in mh b gy mx mm l mn mo">return (</span><span id="5311" class="jv jw in mh b gy mx mm l mn mo">&lt;Mutation mutation={ADD_PERSON}&gt;</span><span id="1589" class="jv jw in mh b gy mx mm l mn mo">{(addPerson, { data, loading, error }) =&gt; (</span><span id="8cad" class="jv jw in mh b gy mx mm l mn mo">&lt;div&gt;</span><span id="fd6f" class="jv jw in mh b gy mx mm l mn mo">&lt;form onSubmit={e =&gt; {</span><span id="3c96" class="jv jw in mh b gy mx mm l mn mo">e.preventDefault();</span><span id="8db6" class="jv jw in mh b gy mx mm l mn mo">addPerson({ variables: { person: { name: input.value } } });</span><span id="f1d6" class="jv jw in mh b gy mx mm l mn mo">input.value = “”;</span><span id="2573" class="jv jw in mh b gy mx mm l mn mo">}} &gt;</span><span id="6c10" class="jv jw in mh b gy mx mm l mn mo">&lt;input ref={node =&gt; { input = node; }} /&gt;</span><span id="113f" class="jv jw in mh b gy mx mm l mn mo">&lt;button type=”submit”&gt;Add Person&lt;/button&gt;</span><span id="5acc" class="jv jw in mh b gy mx mm l mn mo">{loading &amp;&amp;</span><span id="c340" class="jv jw in mh b gy mx mm l mn mo">&lt;div&gt;adding person…&lt;/div&gt;</span><span id="7bd7" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="611b" class="jv jw in mh b gy mx mm l mn mo">{ data &amp;&amp;</span><span id="11da" class="jv jw in mh b gy mx mm l mn mo">&lt;div&gt;response data&lt;/div&gt;</span><span id="2b02" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="77bd" class="jv jw in mh b gy mx mm l mn mo">{ error &amp;&amp;</span><span id="dbef" class="jv jw in mh b gy mx mm l mn mo">&lt;div&gt;Error adding person…&lt;/div&gt;</span><span id="2852" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="55c0" class="jv jw in mh b gy mx mm l mn mo">&lt;/form&gt;</span><span id="84ae" class="jv jw in mh b gy mx mm l mn mo">&lt;/div&gt;</span><span id="f9ed" class="jv jw in mh b gy mx mm l mn mo">)}</span><span id="41af" class="jv jw in mh b gy mx mm l mn mo">&lt;/Mutation&gt;)</span><span id="8e2e" class="jv jw in mh b gy mx mm l mn mo">}</span><span id="8d07" class="jv jw in mh b gy mx mm l mn mo">export default DataInput;</span></pre><p id="6ccd" class="pw-post-body-paragraph kr ks in kt b ku lo kw kx ky lp la lb ke mu ld le ki mv lg lh km mw lj lk ll ig bi translated">欲了解更多详情，请访问:</p><p id="a98a" class="pw-post-body-paragraph kr ks in kt b ku lo kw kx ky lp la lb ke mu ld le ki mv lg lh km mw lj lk ll ig bi translated"><a class="ae my" href="https://www.technologiesinindustry4.com/interaction-with-an-apollo-graphql-server-from-the-frontend/" rel="noopener ugc nofollow" target="_blank">https://www . technologiesinindustry 4 . com/interaction-with-an-Apollo-graph QL-server-from-the-front end/</a></p><p id="b484" class="pw-post-body-paragraph kr ks in kt b ku lo kw kx ky lp la lb ke mu ld le ki mv lg lh km mw lj lk ll ig bi translated"><em class="mz">更多内容尽在</em><a class="ae my" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt io"><em class="mz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>