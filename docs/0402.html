<html>
<head>
<title>SSR with Web Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Web组件的SSR</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/ssr-with-web-components-84ef006b18ef?source=collection_archive---------4-----------------------#2021-01-24">https://javascript.plainenglish.io/ssr-with-web-components-84ef006b18ef?source=collection_archive---------4-----------------------#2021-01-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d664" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在木偶师中渲染阴影DOM和模板</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8b1f0328b54b8c8627e7c72711db3ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBtCrQopfZfM8mUhYkRZGw.jpeg"/></div></div></figure><p id="95f3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用Google木偶师在服务器端呈现web组件是一个真正的挑战。影子DOM的序列化还处于试验阶段。<a class="ae lk" href="https://web.dev/declarative-shadow-dom" rel="noopener ugc nofollow" target="_blank">声明式阴影DOM </a>允许对阴影DOM进行序列化，只需几个简单的步骤就可以实现。如果不遵循这些步骤，在Puppeteer中渲染后，您将得到空的自定义元素。</p><h2 id="c191" class="ll lm in bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">启用影子根目录</h2><p id="c0b9" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">对于要用实验特性序列化的Shadow DOM，首先需要设置模板的<code class="fe mj mk ml mm b">shadowroot</code>属性。</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="9f78" class="ll lm in mm b gy mr ms l mt mu">&lt;template shadowroot="open"&gt;</span></pre><h2 id="032a" class="ll lm in bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">启用实验性Web平台功能</h2><p id="172a" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">为了在Puppeteer中序列化Shadow DOM，我们将为元素使用一个提议的新函数:<code class="fe mj mk ml mm b">getInnerHTML</code>。这个函数接受一个公开了<code class="fe mj mk ml mm b">includeShadowRoots</code>属性的对象。</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="29ef" class="ll lm in mm b gy mr ms l mt mu">const html = await page.$eval('html', (element) =&gt; {<br/>    return element.getInnerHTML({includeShadowRoots: true});<br/>});</span></pre><p id="90f3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">没有启用的实验特征，该功能是未定义的。要在浏览器中启用此功能，请转到:<code class="fe mj mk ml mm b">chrome://flags/#enable-experimental-web-platform-features</code>。要在Puppeteer中启用此功能，您必须更改您的启动配置:</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="d5a9" class="ll lm in mm b gy mr ms l mt mu">const args = puppeteer.defaultArgs();<br/>// IMPORTANT: you can't render shadow DOM without this flag<br/>// getInnerHTML will be undefined without it<br/>args.push('<strong class="mm io">--enable-experimental-web-platform-features</strong>');<br/>const browser = await puppeteer.launch({<br/>    args<br/>});</span></pre><h2 id="eb24" class="ll lm in bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">定义等待方法</h2><p id="d785" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">对于要包括在输出中的组件执行结果，您需要等待渲染完成。为此，我们查询DOM来检测影子根的存在。</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="f34d" class="ll lm in mm b gy mr ms l mt mu">await page.<strong class="mm io">waitForFunction</strong>(selector =&gt; !!document.querySelector(selector)?.shadowRoot, {<br/>    polling: 'mutation',<br/>}, selector);</span></pre><p id="9f70" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">更多关于<code class="fe mj mk ml mm b">waitForFunction</code>的信息，点击<a class="ae lk" href="https://github.com/puppeteer/puppeteer/blob/main/docs/api.md#pagewaitforfunctionpagefunction-options-args" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="ec64" class="ll lm in bd ln lo lp dn lq lr ls dp lt kx lu lv lw lb lx ly lz lf ma mb mc md bi translated">完整示例</h2><p id="438f" class="pw-post-body-paragraph ko kp in kq b kr me jo kt ku mf jr kw kx mg kz la lb mh ld le lf mi lh li lj ig bi translated">下面是一个完整的功能示例。如果您试图让您的web组件呈现，复制示例并测试它。编码快乐！</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div></div>    
</body>
</html>