<html>
<head>
<title>CRUD Operations Using MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MongoDB的CRUD操作</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/crud-operations-using-mongodb-8ff4179b6d24?source=collection_archive---------12-----------------------#2021-09-01">https://javascript.plainenglish.io/crud-operations-using-mongodb-8ff4179b6d24?source=collection_archive---------12-----------------------#2021-09-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/d063f253ecf98f948bc5ded82b19c7bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IDDj6becP4H6nRjP.jpg"/></div></div></figure><p id="aa0c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们已经讨论了什么是MongoDB，并在我们的系统上安装了它。我们正在实现CRUD(创建、读取、更新、删除)操作。如果你想简单介绍一下MongoDB及其安装，建议你看一下<a class="ae kt" href="https://sahil-more.medium.com/what-is-mongodb-55194609df72" rel="noopener">这篇</a>文章。😉</p><p id="9684" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那我们继续吧。🙌</p><p id="0245" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，您还必须在系统上安装Node的更新版本。你可以很容易地从<a class="ae kt" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">这里</a>得到。</p><p id="40ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">确保在命令提示符下键入<code class="fe ku kv kw kx b">mongo</code>命令后得到这个输出。如果没有，你必须先<a class="ae kt" href="https://sahil-more.medium.com/what-is-mongodb-55194609df72" rel="noopener">安装</a>。保持这个命令提示符运行，它会在您的系统上创建一个MongoDB实例。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ky"><img src="../Images/f9220a0ce021b74e22f7fb6336ea0c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NBYE4r-T7uRR_7utQPUQcA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk"><strong class="bd lh">Keep this tab running</strong></figcaption></figure><p id="55ee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建一个文件夹<code class="fe ku kv kw kx b">mongo_crud</code>，我们将在其中执行所有操作。</p><p id="a601" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行命令<code class="fe ku kv kw kx b">npm init -y</code>启动<code class="fe ku kv kw kx b">mongo_crud</code>文件夹中的项目。</p><p id="2d06" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后执行<code class="fe ku kv kw kx b">npm install --save mongodb</code>来保存MongoDB驱动。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/ed31141e27e06e40c18f187448f3f506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*2ncbGjguoE5sWjUlBV6KTw.png"/></div></figure><p id="2740" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">与SQL不同，在SQL中，我们需要在使用数据库之前创建数据库，MongoDB在运行时创建数据库，不需要预定义的数据库。</p><h1 id="4e28" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">连接到数据库</h1><p id="ca1e" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">创建一个<code class="fe ku kv kw kx b">connect-mongo.js</code>文件。</p><p id="990f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编写以下代码来创建连接。</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="9455" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');                       <br/>const MongoClient = mongodb.MongoClient;                                               </span><span id="6c1e" class="mq lk in kx b gy mv ms l mt mu">// Connection URL                       <br/>const url = 'mongodb://localhost:27017';</span><span id="0145" class="mq lk in kx b gy mv ms l mt mu">// Database Name                       <br/>const dbName = 'mydb';                                               </span><span id="2d05" class="mq lk in kx b gy mv ms l mt mu">// Use connect method to connect to the server                       MongoClient.connect(url, function (err, client) {                             <br/>    if (err) {                               <br/>          throw err;                           <br/>    }                                                     <br/>    console.log('Database connection successful');                                                   </span><span id="5c8f" class="mq lk in kx b gy mv ms l mt mu">// This objects holds the reference to the db                           <br/>    const db = client.db(dbName);                                                         <br/>    client.close();                       <br/>});</span></pre><p id="a557" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<code class="fe ku kv kw kx b">node connect-mongo.js</code>运行代码</p><p id="791e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您已经成功连接到数据库，您应该会看到输出:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/8b848484a46dfd79bf7be9d3b61bb54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pI2QIWLsTdhG0TCZJF4WbQ.png"/></div></div></figure><p id="975a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">否则，您会收到一条错误消息。检查服务器是否启动并运行，以及在这种情况下用户名和密码是否正确。</p><p id="d362" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您在示例中看到的，<code class="fe ku kv kw kx b">MongoClient.connect</code>方法有两个参数，数据库的URL和回调函数。</p><p id="89c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回调函数有两个参数:<code class="fe ku kv kw kx b">err</code>和<code class="fe ku kv kw kx b">client</code>。</p><p id="a643" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果存在任何网络问题或任何其他与连接到数据库有关的问题，第一个参数将包含一个错误。如果没有问题，错误将是<code class="fe ku kv kw kx b">null</code>。</p><p id="f640" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第二个参数是客户机对象，我们用它来与数据库交互。</p><p id="93d8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe ku kv kw kx b">client</code>的<code class="fe ku kv kw kx b">db</code>属性保存对数据库的引用。为了对数据库执行任何操作，我们使用这个引用。</p><h1 id="0653" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">创建文档</h1><p id="ff0d" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">因为我们在SQL中有表，所以MongoDB允许使用集合。这些集合基本上以表的形式工作，但是以非结构化JSON对象的形式。</p><p id="c98c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要创建文档，我们有两种方法:</p><ol class=""><li id="d7ad" class="mx my in jx b jy jz kc kd kg mz kk na ko nb ks nc nd ne nf bi translated">顾名思义，这个命令允许我们在数据库中一次插入一条记录。按照下面给出的代码片段，创建<br/> <code class="fe ku kv kw kx b">insert-one.js</code>文件来实现代码。</li></ol><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="b52b" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="effd" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="20f8" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="3d36" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="0399" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="a516" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="2017" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="ba61" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="a785" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="7efc" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="6aaf" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="59b2" class="mq lk in kx b gy mv ms l mt mu">// Insert one document</span><span id="dd2e" class="mq lk in kx b gy mv ms l mt mu">collection.insertOne({</span><span id="927a" class="mq lk in kx b gy mv ms l mt mu">firstName: 'Sahil',</span><span id="11cc" class="mq lk in kx b gy mv ms l mt mu">lastName: 'More',</span><span id="67f4" class="mq lk in kx b gy mv ms l mt mu">age: 21,</span><span id="7453" class="mq lk in kx b gy mv ms l mt mu">hobbies: [</span><span id="0bef" class="mq lk in kx b gy mv ms l mt mu">'Playing Football',</span><span id="7724" class="mq lk in kx b gy mv ms l mt mu">'Watching Movies'</span><span id="6f2b" class="mq lk in kx b gy mv ms l mt mu">]</span><span id="d618" class="mq lk in kx b gy mv ms l mt mu">}, (err, result) =&gt; {</span><span id="3be7" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="1b49" class="mq lk in kx b gy mv ms l mt mu">console.log(err);</span><span id="0549" class="mq lk in kx b gy mv ms l mt mu">return;</span><span id="96c7" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="5e01" class="mq lk in kx b gy mv ms l mt mu">console.log(result);</span><span id="cc17" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="3348" class="mq lk in kx b gy mv ms l mt mu">});</span><span id="0395" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="426f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回调的结果参数包含有关查询的信息。它有一个名为<code class="fe ku kv kw kx b">result</code>的字段，看起来像:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/8ddb08bd2687f1857cb63624584aae58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*RPJvu4WSllT1oILMbaQGBw.png"/></div></figure><p id="44b4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在插入文档之前，您不必显式地创建名为<code class="fe ku kv kw kx b">mydb</code>的数据库，或者名为<code class="fe ku kv kw kx b">users</code>的集合。将自动创建数据库和集合。</p><p id="5a95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.<strong class="jx io"> insertMany() </strong></p><p id="f174" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">有时我们需要同时添加多条记录。这个函数允许我们这样做。它类似于<code class="fe ku kv kw kx b">insertOne()</code>功能。只需按照代码片段创建<code class="fe ku kv kw kx b">insert-many.js</code>文件并实现代码。</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="0c7d" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="44fa" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="eef8" class="mq lk in kx b gy mv ms l mt mu">// Connection URL</span><span id="49c6" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="bab3" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="cc88" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="e9c1" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="f4ec" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="c94f" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="c85d" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="d6e9" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="a2ce" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="6020" class="mq lk in kx b gy mv ms l mt mu">// Insert multiple documents</span><span id="b008" class="mq lk in kx b gy mv ms l mt mu">collection.insertMany([</span><span id="0e0c" class="mq lk in kx b gy mv ms l mt mu">{</span><span id="7867" class="mq lk in kx b gy mv ms l mt mu">firstName: 'John',</span><span id="20d7" class="mq lk in kx b gy mv ms l mt mu">lastName: 'Player',</span><span id="63ba" class="mq lk in kx b gy mv ms l mt mu">age: 21,</span><span id="e4db" class="mq lk in kx b gy mv ms l mt mu">hobbies: [</span><span id="e2ae" class="mq lk in kx b gy mv ms l mt mu">'Watching Movies'</span><span id="694f" class="mq lk in kx b gy mv ms l mt mu">]</span><span id="5c10" class="mq lk in kx b gy mv ms l mt mu">}, {</span><span id="e02c" class="mq lk in kx b gy mv ms l mt mu">firstName: 'John',</span><span id="4912" class="mq lk in kx b gy mv ms l mt mu">lastName: 'Doe',</span><span id="931c" class="mq lk in kx b gy mv ms l mt mu">age: 20,</span><span id="2d66" class="mq lk in kx b gy mv ms l mt mu">hobbies: []</span><span id="9147" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="a031" class="mq lk in kx b gy mv ms l mt mu">], (err, result) =&gt; {</span><span id="e549" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="02d3" class="mq lk in kx b gy mv ms l mt mu">console.log(err);</span><span id="f27e" class="mq lk in kx b gy mv ms l mt mu">return;</span><span id="449c" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="7c3b" class="mq lk in kx b gy mv ms l mt mu">console.log(result);</span><span id="8458" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="ac7e" class="mq lk in kx b gy mv ms l mt mu">});</span><span id="28c8" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="eba9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要提供一个JSON对象数组来插入多条记录。输出如下所示:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f4e01d972ea63dd91b000a0c541e3a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*xM2DnMaYvuua2-o14P145w.png"/></div></figure><p id="5b8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">MongoDB为我们添加到数据库中的每条记录分配一个惟一的<code class="fe ku kv kw kx b">_id</code>。如果您想自己给自己一个惟一的id，可以通过在JSON对象中定义字段<code class="fe ku kv kw kx b">_id</code>来实现。</p><h1 id="547a" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">阅读文档</h1><p id="82d7" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">我们将通过编写下面<code class="fe ku kv kw kx b">read-all.js</code>中给出的代码来获取集合中的所有文档:</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="8303" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="3c50" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="15f9" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="8823" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="5527" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="b806" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="4bba" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="d0a2" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="ba51" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="a116" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="c492" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="3a32" class="mq lk in kx b gy mv ms l mt mu">collection.find({}).toArray((err, docs) =&gt; {</span><span id="db57" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="4ef3" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="705d" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="1f3a" class="mq lk in kx b gy mv ms l mt mu">console.log(docs)</span><span id="f4ff" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="c663" class="mq lk in kx b gy mv ms l mt mu">});</span><span id="15ef" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="d3b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您在示例中看到的，我们传递了一个空对象(<code class="fe ku kv kw kx b">{}</code>)作为查询。</p><p id="cc37" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">根据文档，<code class="fe ku kv kw kx b">toArray()</code>方法返回一个数组，该数组包含游标中的所有文档。该方法完全迭代游标，将所有文档加载到RAM中并耗尽游标。</p><p id="f90d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输出:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/e1f4b21631d2f7cd52f3d445443c0b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A4iRPCilLvb1qcsB0G-L8A.png"/></div></div></figure><p id="9a19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要根据某些属性过滤出结果，您只需提供一个存在于我们数据库中的JSON格式的键值对。在<code class="fe ku kv kw kx b">read-one.js</code>中也可以这样做:</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="5fe0" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="df1c" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="17e6" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="a53f" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="d1a5" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="8567" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="a23b" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="9bbc" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="b363" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="c19e" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="2dac" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="a03f" class="mq lk in kx b gy mv ms l mt mu">collection.find({firstName: 'Sahil'}).toArray((err, docs) =&gt; {</span><span id="296f" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="d3fc" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="ca48" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="bb3d" class="mq lk in kx b gy mv ms l mt mu">console.log(docs)</span><span id="4f01" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="de88" class="mq lk in kx b gy mv ms l mt mu">});</span><span id="4014" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="55aa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输出:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/091b70111f5ca39c1c2265c5add63fde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*IPt43D3BwL6K3c40fI2WWw.png"/></div></figure><p id="068b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">显然，所有带有<code class="fe ku kv kw kx b">firstName</code> <code class="fe ku kv kw kx b">Sahil</code>的记录都被返回。</p><h1 id="7a20" class="lj lk in bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">更新文档</h1><p id="0e49" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">为了更新文档，我们可以使用<code class="fe ku kv kw kx b">updateOne()</code>和<code class="fe ku kv kw kx b">updateMany()</code>功能。用如下代码创建一个<code class="fe ku kv kw kx b">update-one.js</code>文件:</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="7852" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="26e1" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="7b86" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="cd7b" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="e003" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="215c" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="6eb6" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="5b44" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="26ef" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="d9b0" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="2fe4" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="fcc7" class="mq lk in kx b gy mv ms l mt mu">// Update one document</span><span id="8a1c" class="mq lk in kx b gy mv ms l mt mu">collection.updateOne(</span><span id="4192" class="mq lk in kx b gy mv ms l mt mu">// The query filter</span><span id="eb8d" class="mq lk in kx b gy mv ms l mt mu">{</span><span id="eb85" class="mq lk in kx b gy mv ms l mt mu">firstName: 'Sahil'</span><span id="cba8" class="mq lk in kx b gy mv ms l mt mu">},</span><span id="3a21" class="mq lk in kx b gy mv ms l mt mu">// The update values</span><span id="f309" class="mq lk in kx b gy mv ms l mt mu">{</span><span id="a421" class="mq lk in kx b gy mv ms l mt mu">$set: {</span><span id="5cf8" class="mq lk in kx b gy mv ms l mt mu">lastName: 'Doe',</span><span id="1c4f" class="mq lk in kx b gy mv ms l mt mu">edited: true</span><span id="ae00" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="a534" class="mq lk in kx b gy mv ms l mt mu">},</span><span id="6d51" class="mq lk in kx b gy mv ms l mt mu">(err, result) =&gt; {</span><span id="a814" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="1fe6" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="424c" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="b116" class="mq lk in kx b gy mv ms l mt mu">console.log(result);</span><span id="1e28" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="9eb8" class="mq lk in kx b gy mv ms l mt mu">});</span><span id="dc35" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="9d58" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输出:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/76bcbf0adebf84f32e57464912bf8806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*6_fK9M2_w3NDn_-Cubw7bQ.png"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/7abb6c2a15fa6b5ea48c28f654c675dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*GEzxZZayP_c0ZpOIfWe1bg.png"/></div></figure><p id="9be0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您在示例中看到的，<code class="fe ku kv kw kx b">updateOne()</code>方法接受三个参数。第一个是查询过滤器。第二个是更新值。第三个是回调函数，它接受错误和结果作为参数。</p><p id="5ee9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，这里的结果通知我们状态(<code class="fe ku kv kw kx b">true</code>)、选择更新的文档数(<code class="fe ku kv kw kx b">matchedCount</code>)和更新的文档数(<code class="fe ku kv kw kx b">modifiedCount</code>)。</p><p id="e0af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果用字段已有的值更新字段，则<code class="fe ku kv kw kx b">matchedCount</code>可以大于<code class="fe ku kv kw kx b">modifiedCount</code>。</p><p id="c620" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用这个查询，我们选择了一个文档，其中字段<code class="fe ku kv kw kx b">firstName</code>是<code class="fe ku kv kw kx b">Sahil</code>，我们已经将该文档的<code class="fe ku kv kw kx b">lastName</code>更改为<code class="fe ku kv kw kx b">Doe</code>。另外，我们还添加了一个名为<code class="fe ku kv kw kx b">edited</code>的字段，并将其设置为<code class="fe ku kv kw kx b">true</code>。请注意，在整个过程中，我们不需要指定或遵循任何模式。Mongo只接受你发送的任何数据。</p><p id="95db" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用的是<code class="fe ku kv kw kx b">updateOne()</code>方法，查询将选择第一个具有匹配字段的文档。如果有多个文档具有相同值的字段，使用<code class="fe ku kv kw kx b">updateMany()</code>方法将会更新所有文档，这在某些情况下可能不是我们想要做的。</p><p id="33c1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe ku kv kw kx b">updateMany()</code>具有相同的实现，只是在上面给出的代码中用<code class="fe ku kv kw kx b">updateOne()</code>替换它。但是在使用这种方法时要小心，它将更新所选集合中符合条件的所有记录。</p><h2 id="033c" class="mq lk in bd ll nm nn dn lp no np dp lt kg nq nr lx kk ns nt mb ko nu nv mf nw bi translated">删除文档</h2><p id="6742" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">我们可以使用<code class="fe ku kv kw kx b">deleteOne()</code>和<code class="fe ku kv kw kx b">deleteMany()</code>方法从集合中删除记录。可以按如下方式完成:</p><pre class="kz la lb lc gt mm kx mn mo aw mp bi"><span id="c64b" class="mq lk in kx b gy mr ms l mt mu">const mongodb = require('mongodb');</span><span id="7586" class="mq lk in kx b gy mv ms l mt mu">const MongoClient = mongodb.MongoClient;</span><span id="4472" class="mq lk in kx b gy mv ms l mt mu">const url = 'mongodb://localhost:27017';</span><span id="fcca" class="mq lk in kx b gy mv ms l mt mu">const dbName = 'mydb';</span><span id="9bd5" class="mq lk in kx b gy mv ms l mt mu">MongoClient.connect(url, function (err, client) {</span><span id="dda4" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="84a8" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="2b69" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="8fb5" class="mq lk in kx b gy mv ms l mt mu">console.log('Database connection successful');</span><span id="4d1b" class="mq lk in kx b gy mv ms l mt mu">const db = client.db(dbName);</span><span id="6268" class="mq lk in kx b gy mv ms l mt mu">const collection = db.collection('mydb');</span><span id="33e6" class="mq lk in kx b gy mv ms l mt mu">// Delete one document</span><span id="ab98" class="mq lk in kx b gy mv ms l mt mu">collection.deleteOne(</span><span id="a188" class="mq lk in kx b gy mv ms l mt mu">// The query filter</span><span id="7dd9" class="mq lk in kx b gy mv ms l mt mu">{</span><span id="da50" class="mq lk in kx b gy mv ms l mt mu">firstName: 'Sahil'</span><span id="9d44" class="mq lk in kx b gy mv ms l mt mu">},</span><span id="0e2d" class="mq lk in kx b gy mv ms l mt mu">(err, result) =&gt; {</span><span id="6d01" class="mq lk in kx b gy mv ms l mt mu">if (err) {</span><span id="439f" class="mq lk in kx b gy mv ms l mt mu">throw err;</span><span id="aac7" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="e5ad" class="mq lk in kx b gy mv ms l mt mu">console.log(result);</span><span id="2049" class="mq lk in kx b gy mv ms l mt mu">client.close();</span><span id="c63d" class="mq lk in kx b gy mv ms l mt mu">}</span><span id="e801" class="mq lk in kx b gy mv ms l mt mu">);</span><span id="622b" class="mq lk in kx b gy mv ms l mt mu">});</span></pre><p id="e2a0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">输出:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/2e9308e2e1ae0474951a031c22b8ae27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*xVvEUOpxrVvkS6OxHpTKzw.png"/></div></figure><p id="d274" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，与前面的示例类似，第一个接受的参数是过滤器查询，第二个参数是回调函数。回调函数返回错误或结果。</p><p id="f675" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行这段代码将删除一个匹配查询的文档——在本例中，这个文档的<code class="fe ku kv kw kx b">firstName</code>字段是<code class="fe ku kv kw kx b">Sahil</code>。同样，这只会删除与查询匹配的第一个文档。</p><p id="8873" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您也可以使用<code class="fe ku kv kw kx b">deleteMany()</code>方法删除所有符合<code class="fe ku kv kw kx b">firstName</code>“Sahil”的文件。你只需要在上面给出的代码中用<code class="fe ku kv kw kx b">deleteMany</code>替换<code class="fe ku kv kw kx b">deleteOne</code>。同样，使用此方法时要小心，因为它将删除多个符合条件的条目。</p><blockquote class="nz"><p id="6337" class="oa ob in bd oc od oe of og oh oi ks dk translated">所有文件都可以在我的GitHub上找到<a class="ae kt" href="https://github.com/sahilmore-git/Mongo-CRUD" rel="noopener ugc nofollow" target="_blank">这里</a>🚀</p></blockquote></div><div class="ab cl oj ok hr ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ig ih ii ij ik"><h1 id="2c8c" class="lj lk in bd ll lm oq lo lp lq or ls lt lu os lw lx ly ot ma mb mc ou me mf mg bi translated">谢谢:)</h1><p id="0a08" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">希望你们喜欢这篇文章。🙌<br/>请鼓掌让我知道。👏<br/>在这里发表你对<a class="ae kt" href="mailto:sahilmore19999@gmail.com" rel="noopener ugc nofollow" target="_blank">新文章的建议。📬你也可以在这里给我买一杯咖啡。☕️</a></p><p id="04bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ny">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ny">plain English . io</em></strong></a></p></div></div>    
</body>
</html>