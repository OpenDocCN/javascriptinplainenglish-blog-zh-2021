<html>
<head>
<title>Node.js: Unzip Async Await</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js: Unzip异步等待</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-unzip-async-await-901040d30393?source=collection_archive---------5-----------------------#2021-03-14">https://javascript.plainenglish.io/node-js-unzip-async-await-901040d30393?source=collection_archive---------5-----------------------#2021-03-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="33ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在异步Node.js上下文中解压缩一个. zip文件。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b51e1be77707d1331575abf92df48a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aRAiHOPwSAGnffuFtAGghA.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@flo_stk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Florian Steciuk</a> on <a class="ae kv" href="/s/photos/highway?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="dc1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我正在开发<a class="ae kv" href="https://deckdeckgo.com" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>的新功能，为此我必须在<a class="ae kv" href="https://firebase.google.com/docs/functions" rel="noopener ugc nofollow" target="_blank"> Firebase函数</a>中解压缩数据。</p><p id="ef62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编写这样一个<a class="ae kv" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>函数花费了比预期更多的时间，这就是为什么我分享这个解决方案，希望有一天它也能帮助你😇。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="50e5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">解压缩程序</h1><p id="b006" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Node.js提供了一个压缩模块<a class="ae kv" href="https://nodejs.org/api/zlib.html" rel="noopener ugc nofollow" target="_blank"> Zlib </a>，但是它不支持ZIP文件。幸运的是，我们可以使用库<a class="ae kv" href="https://github.com/ZJONSSON/node-unzipper" rel="noopener ugc nofollow" target="_blank">解压缩器</a>来处理这些。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="f809" class="nb ma iq mx b gy nc nd l ne nf">npm i unzipper --save</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="0596" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">用异步Await解压缩</h1><p id="6b66" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我的新特性通过流读写上传到<a class="ae kv" href="https://firebase.google.com/docs/storage" rel="noopener ugc nofollow" target="_blank"> Firebase存储器</a>的数据。我也用promises (async / await)方法开发我的代码。因此，两者必须共存。</p><p id="80aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了缩小以下示例的范围，我用文件系统流(<code class="fe ng nh ni mx b">fs</code>)处理的本地文件替换了云存储。</p><p id="4966" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">函数<code class="fe ng nh ni mx b">unzip</code>在通过<code class="fe ng nh ni mx b">unzipper</code>传输的<code class="fe ng nh ni mx b">zip</code>数据上实例化一个流。每个条目都被迭代并通过管道传输到可写输出。摘要:打开zip文件，并提取其中包含的每个文件。</p><p id="c515" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ng nh ni mx b">unzip</code>在一个复古兼容的top await函数中被调用，基本上就是它的🥳.</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="6e83" class="nb ma iq mx b gy nc nd l ne nf">const {Parse} = require('unzipper');<br/>const {createWriteStream, createReadStream} = require('fs');<br/><br/>const unzip = () =&gt; {<br/>  const stream = <br/>    createReadStream('/Users/david/data.zip').pipe(Parse());<br/><br/>  return new Promise((resolve, reject) =&gt; {<br/>    stream.on('entry', (entry) =&gt; {<br/>      const writeStream = <br/>        createWriteStream(`/Users/david/${entry.path}`);<br/>      return entry.pipe(writeStream);<br/>    });<br/>    stream.on('finish', () =&gt; resolve());<br/>    stream.on('error', (error) =&gt; reject(error));<br/>  });<br/>};<br/><br/>(async () =&gt; {<br/>  try {<br/>    await unzip();<br/>  } catch (err) {<br/>    console.error(err);<br/>  }<br/>})();</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="e805" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">用异步Await读取字符串</h1><p id="1f3a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我也必须用流来读取文件。因此，樱桃在顶部，这里是我如何在我的代码集成这些。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="d4ba" class="nb ma iq mx b gy nc nd l ne nf">const {createReadStream} = require('fs');<br/><br/>const read = () =&gt; {<br/>  const stream = <br/>    createReadStream('/Users/david/meta.json');<br/><br/>  return new Promise((resolve, reject) =&gt; {<br/>    let data = '';<br/><br/>    stream.on('data', (chunk) =&gt; (data += chunk));<br/>    stream.on('end', () =&gt; resolve(data));<br/>    stream.on('error', (error) =&gt; reject(error));<br/>  });<br/>};<br/><br/>(async () =&gt; {<br/>  try {<br/>    const meta = await read();<br/><br/>    console.log({meta});<br/>  } catch (err) {<br/>    console.error(err);<br/>  }<br/>})();</span></pre><p id="569b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它遵循与前面相同的方法，将文件内容读入内存<code class="fe ng nh ni mx b">string</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8305" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">摘要</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/49f06bcb32d187d378e9131e1d5d5e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*6wJfY8vH1FbC1s4Uzxy0QQ.gif"/></div></figure><blockquote class="nk nl nm"><p id="9f69" class="kw kx nn ky b kz la jr lb lc ld ju le no lg lh li np lk ll lm nq lo lp lq lr ij bi translated">编码就像一盒巧克力。你永远不知道你会得到什么。有时候要快，需要时间。有时候这需要很长时间，但是它很快就过去了——对阿甘来说</p></blockquote><p id="eb74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">到无限和更远的地方！</p><p id="2707" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大卫</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="386a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在推特上或者我的网站上联系到我。</p><p id="1cae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">尝试<a class="ae kv" href="https://deckdeckgo.com/" rel="noopener ugc nofollow" target="_blank"> DeckDeckGo </a>制作您的下一张幻灯片🤟。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><a href="https://deckdeckgo.com"><div class="gh gi nr"><img src="../Images/60715bd16846fb2485281256d8cf3a98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cBEcAFbsMaSsNOPC.png"/></div></a></figure></div></div>    
</body>
</html>