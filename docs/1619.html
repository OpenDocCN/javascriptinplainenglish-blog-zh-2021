<html>
<head>
<title>Issues with Angular on Long-term Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">长期项目中的角度问题</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/issues-with-angular-on-long-term-projects-3679bc335eb8?source=collection_archive---------4-----------------------#2021-04-07">https://javascript.plainenglish.io/issues-with-angular-on-long-term-projects-3679bc335eb8?source=collection_archive---------4-----------------------#2021-04-07</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="f94b" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">如何解决它们:支持从v2到v11的角度项目</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/e82eaffc04c66729ecdf9ce89f1e72e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pYs4h1pZOA82oCS9K7F9XQ.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Long-term Angular project</figcaption></figure><p id="fff8" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">从AngularJS的第一个版本开始，我就是一个角度开发者。在此期间，我有机会工作并交付不同规模的项目。我总是对我的主要框架选择感到满意。今天，它仍然是我最喜欢的框架。目前，我有三个积极的、长期的、繁重的项目。所以我来分享一下这类项目上最常见的陷阱，以及如何应对。</p></div><div class="ab cl ls lt hv lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ik il im in io"><h1 id="ee8c" class="lz ma ir bd mb mc md me mf mg mh mi mj jx mk jy ml ka mm kb mn kd mo ke mp mq bi translated">版本更新</h1><p id="a018" class="pw-post-body-paragraph kw kx ir ky b kz mr js lb lc ms jv le lf mt lh li lj mu ll lm ln mv lp lq lr ik bi translated">假设你在Angular 2的乞求下创建了一个MVP app。您按照指南配置了项目，一切都很好。后来，Angular发布了越来越多的新版本，这很棒，因为它还活着，还在成长。因此，你需要遵循<a class="ae mw" href="https://update.angular.io" rel="noopener ugc nofollow" target="_blank">指令</a>关于如何从一个版本迁移到最新版本。</p><p id="5cea" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">大约在Angular 7的某个时候，Angular团队发布了原理图。<strong class="ky is">超级酷的特性，这是我在其他web框架上没见过的</strong>。现在我们可以添加新的库，自动更新框架和依赖关系。嗯，几乎是自动的。</p><p id="7146" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">为什么差不多？因为成千上万个项目的代码基础是不同的，很难毫无问题地转换它们中的每一个，这很好。我们需要感谢自动化至少是我们日常工作的一半。</p><p id="65e7" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但有时，在成功迁移后，它可能会错误地工作。这是最坏的情况。</p><p id="c7c9" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">例如，我很不幸地为服务器端渲染添加了@angular/universal而没有问题。在我的情况下，它可以开始渲染，永远不会停止这个过程。或者服务器可以根据请求抛出超时错误。问题的根源是以前的配置，原理图中没有涉及。你永远不知道配置出了什么问题。它不会出现在变更日志中。</p><p id="39f6" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">解决方案<br/> </strong>可以单独新建一个项目，安装@ angular/universal with schematics，比较所有配置文件。有一次，我设法找到了不同之处，并解决了一个问题。但是上一次，我必须将src文件夹移动到新项目中，设置angular.json，并且只有在SSR开始工作之后。</p><p id="4dd9" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">所以请注意，更新过程可能需要时间和精力。</p><h1 id="f155" class="lz ma ir bd mb mc mx me mf mg my mi mj jx mz jy ml ka na kb mn kd nb ke mp mq bi translated">相关库中的重大更改</h1><p id="326e" class="pw-post-body-paragraph kw kx ir ky b kz mr js lb lc ms jv le lf mt lh li lj mu ll lm ln mv lp lq lr ik bi translated">如果你想在Angular框架中拥有最新的特性或者bug修复，你总是需要更新相关的库。它唤醒努力和时间。我们为什么要这么做？因为这些库使用彼此的组件作为依赖项。并且ng update或schematics不会工作，直到一切都是最新的。</p><p id="5e97" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">如果您计划使用最新的Angular版本，这里是您需要更新的顶级库的列表。</p><ul class=""><li id="6c73" class="nc nd ir ky b kz la lc ld lf ne lj nf ln ng lr nh ni nj nk bi translated">角状材料</li><li id="e19d" class="nc nd ir ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">角火</li><li id="3c70" class="nc nd ir ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">RxJS</li><li id="4c41" class="nc nd ir ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">@angular/cdk</li><li id="914b" class="nc nd ir ky b kz nl lc nm lf nn lj no ln np lr nh ni nj nk bi translated">@nguniversal/express-engine</li></ul><p id="eee7" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">有了角度示意图，它变得更好，但它不是万能的。我仍然需要每年重构代码3-5次。</p><p id="773e" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">这很好，因为这个框架是活的。</strong>但是你需要明白保持你的应用程序新鲜需要开发和测试的努力。</p><p id="10c4" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">解决方案<br/> </strong>冻结你的代码，如果它是稳定的，你不需要最新的功能。万一你需要它们，你必须接受这个事实，并计划有时重构。</p><h1 id="2c62" class="lz ma ir bd mb mc mx me mf mg my mi mj jx mz jy ml ka na kb mn kd nb ke mp mq bi translated">RxJS</h1><p id="de6c" class="pw-post-body-paragraph kw kx ir ky b kz mr js lb lc ms jv le lf mt lh li lj mu ll lm ln mv lp lq lr ik bi translated">打开<a class="ae mw" href="https://angular.io/guide/service-worker-communications" rel="noopener ugc nofollow" target="_blank">官方文档，假设是关于服务工作者</a>，复制第一个代码示例，并将其粘贴到您的项目中。我们会看到什么？</p><p id="cda0" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">正确，我们将看到RxJS的新弃用。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nq"><img src="../Images/01e18ed6b5f2e8844604e85d164e8322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EdbFbWg1IeqFAJ9CEdweLQ.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Subscribe callback deprecation</figcaption></figure><p id="9a05" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">RxJS是Agular中作为核心部分使用的扩展库。一切都用RxJS。当它有制动变化时，你需要重构…很多。</p><p id="4d18" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">我们使用了多年的订阅和两次回调:</p><pre class="kh ki kj kk gu nr ns nt nu aw nv bi"><span id="b66f" class="nw ma ir ns b gz nx ny l nz oa">observable.subscribe((success)=&gt; { … }, (err)=&gt; { … });</span></pre><p id="d6a2" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">现在，我们必须用回调函数将它更改为对象:</p><pre class="kh ki kj kk gu nr ns nt nu aw nv bi"><span id="298b" class="nw ma ir ns b gz nx ny l nz oa">observable.subscribe({<br/>   complete: () =&gt; { … }, // completeHandler<br/>   error: () =&gt; { … }, // errorHandler<br/>   next: () =&gt; { … }, // nextHandler<br/>   someOtherProperty: 42<br/>});</span></pre><p id="9321" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这不是第一次重大的重构，我很确定也不是最后一次。只需查看<a class="ae mw" href="https://rxjs-dev.firebaseapp.com/guide/v6/migration" rel="noopener ugc nofollow" target="_blank">之前的迁移指南</a>。它是巨大的。</p><p id="6274" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">RxJS是一个很棒的库，减少了应用程序端的许多逻辑，但他们的突破性变化不断引入大量工作。</p><p id="e15d" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">解<br/>解</strong>无解。如果你对RxJS或他们的突破性改变不满意，可能的解决方法是使用React或Vue。</p><p id="2d00" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是不要把它当成痛苦。他们关心他们的消费者，当他们引入到v6的迁移时，变化如此之多以至于他们提供了一个迁移库。使用<code class="fe ob oc od ns b">rxjs-compact</code>，您可以一步一步地迁移。为此感谢他们，但我们仍然记得那些变化=)。</p><h1 id="5e0e" class="lz ma ir bd mb mc mx me mf mg my mi mj jx mz jy ml ka na kb mn kd nb ke mp mq bi translated">隐藏的更新和改进</h1><p id="27b2" class="pw-post-body-paragraph kw kx ir ky b kz mr js lb lc ms jv le lf mt lh li lj mu ll lm ln mv lp lq lr ik bi translated">最后一个问题并不重要，因为它不会对您的项目产生重大影响。但是当我试图修复上面列出的问题时，我经常在创建新项目后看到一些新的改进。</p><p id="5c75" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">例如服务人员的附加参数:</p><pre class="kh ki kj kk gu nr ns nt nu aw nv bi"><span id="9d63" class="nw ma ir ns b gz nx ny l nz oa">ServiceWorkerModule.register(‘ngsw-worker.js’, {<br/>   enabled: environment.production,<br/>   registrationStrategy: ‘registerWhenStable:30000’<br/>})</span></pre><p id="1662" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">还是改良过的<code class="fe ob oc od ns b">tsconfig</code>。</p><p id="33a2" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">或区域标志(您可以禁用某些区域检测以提高性能)。你知道这件事吗？</p><pre class="kh ki kj kk gu nr ns nt nu aw nv bi"><span id="14af" class="nw ma ir ns b gz nx ny l nz oa">// disable patching requestAnimationFrame<br/>(window as any).__Zone_disable_requestAnimationFrame = true;</span><span id="8e31" class="nw ma ir ns b gz oe ny l nz oa">// disable patching specified eventNames<br/>(window as any).__zone_symbol__UNPATCHED_EVENTS = ['scroll', 'mousemove'];</span><span id="2f65" class="nw ma ir ns b gz oe ny l nz oa">/*<br/> * in IE/Edge developer tools, the addEventListener will also be wrapped by zone.js<br/> * with the following flag, it will bypass zone.js patch for IE/Edge<br/> */<br/>(window as any).__Zone_enable_cross_context_check = true;</span><span id="31ae" class="nw ma ir ns b gz oe ny l nz oa">// disable patch onProperty such as onclick<br/>(window as any).__Zone_disable_on_property = true;</span></pre><p id="fdeb" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">解决方案<br/> </strong>如果你保持警惕，经常查看是否有更新，那会很有帮助。有时这样的提示在有角度的新闻中并没有被强调。</p><h1 id="f23a" class="lz ma ir bd mb mc mx me mf mg my mi mj jx mz jy ml ka na kb mn kd nb ke mp mq bi translated">结论</h1><p id="bf24" class="pw-post-body-paragraph kw kx ir ky b kz mr js lb lc ms jv le lf mt lh li lj mu ll lm ln mv lp lq lr ik bi translated">Angular是一个很好的框架，但是你应该花一些时间来保持你的项目不断更新，这似乎比React project更频繁。如果Angular团队能减少重构量就好了。我希望它在他们的路线图上🤞。</p><p id="aec6" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">感谢阅读！你可以在Medium上关注我，获取更多科技文章，也可以在Twitter上找到我。</strong></p></div></div>    
</body>
</html>