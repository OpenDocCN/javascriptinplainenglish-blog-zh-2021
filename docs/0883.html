<html>
<head>
<title>Deploy a Node.js server using Google Cloud Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google云计算引擎部署Node.js服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deploy-a-node-js-server-using-google-cloud-compute-engine-87268919de20?source=collection_archive---------1-----------------------#2021-02-24">https://javascript.plainenglish.io/deploy-a-node-js-server-using-google-cloud-compute-engine-87268919de20?source=collection_archive---------1-----------------------#2021-02-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c1fd" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">开始使用一个最小的node . js“ping”应用程序</h2></div><p id="21c4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章展示了如何从零开始将一个最小的Express.js应用程序部署到生产环境中。它可以是任何节点项目的起点。</p><p id="de6d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最小安装。最小代码。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/957adf38615f5b1795ac38ed102bfbe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-pMBYSNa9qcaatYWKF0QA.png"/></div></div></figure><h1 id="8e45" class="lk ll in bd lm ln lo lp lq lr ls lt lu jt lv ju lw jw lx jx ly jz lz ka ma mb bi translated">骨架代码</h1><p id="05ab" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">我讨厌类似“如何在仅仅5分钟内构建<a-super-long-and-difficult-task>”的教程当我实际上必须克隆一个存储库并运行<code class="fe mh mi mj mk b">npm start</code>时。</a-super-long-and-difficult-task></p><p id="7a77" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好吧，有效(有时无效)。</p><p id="1bb9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是我什么都没学到。</p><p id="6a90" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我提供了<strong class="ke io">最小</strong> Node.js框架，从简单的东西开始。</p><p id="52ea" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该服务器仅在调用<a class="ae ml" href="http://localhost:3000/api/v1/ping" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/API/v1/ping</a>时返回“pong”。</p><p id="8b80" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">仅此而已。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mm"><img src="../Images/8cb1cc687f85abae5239bc0b3ebf0c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5jp-A36myS5730mhmh0dmQ.png"/></div></div></figure><p id="206c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里检查并克隆<a class="ae ml" href="https://github.com/BerangerNt/nodejs-express-skeleton" rel="noopener ugc nofollow" target="_blank">的框架代码。</a></p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="8752" class="mr ll in mk b gy ms mt l mu mv">sudo apt install git # if you don't have git installed</span><span id="6afd" class="mr ll in mk b gy mw mt l mu mv">git clone <a class="ae ml" href="https://github.com/BerangerNt/nodejs-express-skeleton.git" rel="noopener ugc nofollow" target="_blank">https://github.com/BerangerNt/nodejs-express-skeleton.gi</a>t</span></pre><p id="d7c1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我假设您已经安装了Node.js和npm。如果没有，请遵循以下说明:<a class="ae ml" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/get-npm</a></p><p id="c05e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">克隆后，在终端中运行:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="4645" class="mr ll in mk b gy ms mt l mu mv">cd nodejs-express-skeleton</span><span id="bd7e" class="mr ll in mk b gy mw mt l mu mv">npm install</span></pre><p id="b3d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并且:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="88b6" class="mr ll in mk b gy ms mt l mu mv">npm run start</span></pre><p id="0417" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您应该得到以下结果:“在本地主机上运行的节点应用程序:8080”:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mx"><img src="../Images/3b2841d665d0aeefc07f0dd27c5faf0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwp9-65Wu-MldKBz2liwkQ.png"/></div></div></figure><p id="6b69" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">粘贴<a class="ae ml" href="http://localhost:3000/api/v1/ping" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/API/v1/ping</a>在浏览器中，应该会显示“pong”。</p><p id="ba23" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，这里没有逻辑，只有结构。</p><p id="ace2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在有一个本地运行的服务器。是时候上线了。</p><p id="3b0d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，我们需要创建一个虚拟机。</p><h2 id="d180" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">创建虚拟机</h2><p id="4825" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">点击此链接:<a class="ae ml" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/compute/instances</a></p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nj"><img src="../Images/a75b617fa2e066c10b67a92e20c596b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HVSwBHMAjilp5Yae-hLSBg.png"/></div></div></figure><p id="8ee0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击“创建实例”并复制以下配置以使用Ubuntu映像(您可能需要创建一个新项目) :</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nk"><img src="../Images/4b36eb4631fb2e1d375722297febc46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2hQ4PzRFhMeGBJ40amCZSg.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nk"><img src="../Images/2a278079e8a49a845bbddb9e508f327a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRPIHgtHch75JHTpLQvllg.png"/></div></div></figure><p id="a529" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建过程大约需要10分钟。</p><h2 id="2765" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">安装节点</h2><p id="219b" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">要从浏览器直接连接到您的服务器，请单击虚拟机右侧的SSH按钮:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nl"><img src="../Images/ef27d28f0188283d1583b6e3d601c088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UV80RqZyU2ibptIeC8aSSg.png"/></div></div></figure><p id="c6f0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应该会弹出一个终端:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nm"><img src="../Images/926fd4507812eb4ef057a0f58b69a422.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4FdFoSQBfcYXP6GPozzxA.png"/></div></div></figure><p id="26fd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">目前，服务器只包含Debian 10的映像，我们需要安装npm和node，运行以下命令:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="09bd" class="mr ll in mk b gy ms mt l mu mv">sudo apt-get -y update</span><span id="e741" class="mr ll in mk b gy mw mt l mu mv">sudo apt-get install -y nodejs npm</span><span id="5f7a" class="mr ll in mk b gy mw mt l mu mv">sudo apt install git</span></pre><p id="5428" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查安装:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nn"><img src="../Images/d167ca664b12205b1b48a420dbfd260c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5-MK-G-O2l6QKcGocHUxw.png"/></div></div></figure><h2 id="e286" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">克隆并安装节点框架代码</h2><p id="f9b5" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">现在运行:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="d9cb" class="mr ll in mk b gy ms mt l mu mv">git clone <a class="ae ml" href="https://github.com/BerangerNt/nodejs-express-skeleton.git" rel="noopener ugc nofollow" target="_blank">https://github.com/BerangerNt/nodejs-express-skeleton.git</a><br/></span><span id="cbbd" class="mr ll in mk b gy mw mt l mu mv">cd nodejs-express-skeleton/</span><span id="2a9a" class="mr ll in mk b gy mw mt l mu mv"><br/>npm install<br/></span><span id="f8d5" class="mr ll in mk b gy mw mt l mu mv">npm run start</span></pre><p id="ff8d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您看到下面的屏幕，那么您就走对了路:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nn"><img src="../Images/7ed79e9fcc717b9c6590f25920609990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uABjx0PoN_xPSyiztUOhMA.png"/></div></div></figure><h2 id="80a8" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">配置Nginx</h2><p id="4a2e" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">Nginx将作为我们的反向代理。这允许从端口80访问我们的节点应用程序，运行:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="e5c0" class="mr ll in mk b gy ms mt l mu mv">sudo apt-get install -y nginx</span></pre><p id="d10e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Nginx已经安装，我们现在必须为我们的节点应用程序配置它:</p><p id="3a6f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">导航到Nginx的“站点-可用”文件夹。</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="19a7" class="mr ll in mk b gy ms mt l mu mv">cd /etc/nginx/sites-available</span></pre><p id="f8bf" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并更改默认文件，粘贴下面这段代码(获取您的_服务器_ IP _地址<a class="ae ml" href="https://console.cloud.google.com/compute/instances" rel="noopener ugc nofollow" target="_blank">此处</a>):</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="64a8" class="mr ll in mk b gy ms mt l mu mv">sudo vim default</span></pre><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="no np l"/></div></figure><p id="a578" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并重新启动nginx:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="5603" class="mr ll in mk b gy ms mt l mu mv">sudo service nginx restart</span></pre><h2 id="8b32" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">安装PM2</h2><p id="acfd" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">PM2是一个著名的进程管理器，将帮助我们启动，监控和重启我们的服务器，以防崩溃。我们在这个示例应用程序上没有太多的日志，但是如果你打算创建多条路线，我强烈推荐PM2。</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="6f5d" class="mr ll in mk b gy ms mt l mu mv">cd ~/nodejs-express-skeleton</span><span id="409e" class="mr ll in mk b gy mw mt l mu mv">sudo su root</span><span id="be9a" class="mr ll in mk b gy mw mt l mu mv">sudo npm install -g pm2</span></pre><p id="d4f0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">安装完成后，您就可以启动服务器了:</p><pre class="kz la lb lc gt mn mk mo mp aw mq bi"><span id="4669" class="mr ll in mk b gy ms mt l mu mv">pm2 start server.js</span></pre><p id="b315" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应该显示一个令人满意的表</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nq"><img src="../Images/8c596168cd6c88e843b110beb319e005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KiMZpZp-nBW51WmsPJ6tYA.png"/></div></div></figure><p id="52a4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以玩pm2状态，pm2日志来查看你的服务器工作，显示日志等。</p><h2 id="7f7e" class="mr ll in bd lm my mz dn lq na nb dp lu kl nc nd lw kp ne nf ly kt ng nh ma ni bi translated">享受一杯茶</h2><p id="5641" class="pw-post-body-paragraph kc kd in ke b kf mc jo kh ki md jr kk kl me kn ko kp mf kr ks kt mg kv kw kx ig bi translated">服务器已经完全设置好了，现在您可以在浏览器中查看您得到的答案:<a class="ae ml" href="http://35.246.127.111/api/v1/ping" rel="noopener ugc nofollow" target="_blank">http://SERVER _ NAME/API/v1/ping</a></p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nr"><img src="../Images/1ea5e75aa6c307810a23ba93edaa687d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7Tke34FlW9XTbLG_iMfJQ.png"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk">BOOM</figcaption></figure><p id="1744" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您从Github push自动化部署并启动更多测试(也称为持续部署持续集成(或CI/CD))，您甚至可以走得更快。</p><p id="ed94" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">查看本系列的下一篇文章，在该服务器上实现自动化部署:</p><div class="nw nx gp gr ny nz"><a href="https://beranger.medium.com/automate-deployment-with-google-compute-engine-and-cloud-build-cccd5c3eb93c" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd io gy z fp oe fr fs of fu fw im bi translated">使用Google计算引擎和云构建实现自动化部署</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">和一杯茶</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">beranger.medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on li nz"/></div></div></a></div></div></div>    
</body>
</html>