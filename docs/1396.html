<html>
<head>
<title>How to upload files in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中上传文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-upload-files-in-react-native-using-rnfetchblob-d6920f2a660c?source=collection_archive---------5-----------------------#2021-03-24">https://javascript.plainenglish.io/how-to-upload-files-in-react-native-using-rnfetchblob-d6920f2a660c?source=collection_archive---------5-----------------------#2021-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a277" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何在React Native中处理多部分请求的完整指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ebcecf1904acf17a821ca65bb14f97f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zbGPMg95KYX4_JCF"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fotis Fotopoulos</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e713" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">RNFetchBlob 是一个库，它的目的是让React本地开发人员在处理二进制数据传输时更加轻松。</p><p id="b1e6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了安装它，运行</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="362c" class="lx ly iq lt b gy lz ma l mb mc">npm install --save rn-fetch-blob</span></pre><p id="05e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">或者</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="175e" class="lx ly iq lt b gy lz ma l mb mc">yarn add rn-fetch-blob</span></pre><p id="46fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在你的终端里。</p><p id="15fd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后转到您的<code class="fe md me mf lt b">ios</code>目录并运行<code class="fe md me mf lt b">pod install</code>。</p><p id="2e6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将研究上传文件。别担心，会有一个<a class="ae kv" href="https://bianca-dragomir.medium.com/downloading-files-in-react-native-with-rnfetchblob-f78b18b46a36" rel="noopener">不同的</a>将文件下载到设备上。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="a722" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe md me mf lt b">record</code>对象包含了将要上传的文件的基本信息:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="a580" class="lx ly iq lt b gy lz ma l mb mc">export interface MedicalRecord {<br/>  description: string;<br/>  file: File;<br/>}</span><span id="d09a" class="lx ly iq lt b gy mi ma l mb mc">export interface PatientFile {<br/>  name: string;<br/>  url: string; // the path to the local file<br/>  size: number;<br/>}</span></pre><p id="867c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很简单，对吧？</p><p id="6eef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们来分解这个片段:</p><p id="fbc2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的后端可能需要某种形式的授权。您将通过headers参数来提供它。在上面的代码片段中，<code class="fe md me mf lt b">defaultHeaders</code>构建了一个地图，该地图将包含例如<code class="fe md me mf lt b">Authorization</code>字段(Bearer …)。通知您的后端这个请求是多部分的也是非常重要的。这就是第8行的目的:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="36c9" class="lx ly iq lt b gy lz ma l mb mc">headers[‘Content-Type’] = ‘multipart/form-data’;</span></pre><p id="5d3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.根据平台的不同，需要以不同的方式构建路径。Android将能够理解文件选择库返回的路径，但iOS增加了一点趣味:</p><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="2a40" class="lx ly iq lt b gy lz ma l mb mc">decodeURIComponent(record.file.url.replace('file://', ''))</span></pre><p id="e0a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.您的<code class="fe md me mf lt b">multipartParams</code>列表将包含2个对象:</p><ul class=""><li id="beff" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr mo mp mq mr bi translated">第一个将提供文件本身:</li></ul><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="4f4d" class="lx ly iq lt b gy lz ma l mb mc">{<br/>  name: "file",<br/>  filename: record.file.name,<br/>  data: RNFetchBlob.wrap(realPath),<br/>},</span></pre><p id="fdf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将使用RNFetchBlob包装数据路径。该字段的默认名称是“文件”。在这里，你必须考虑到你的后端将期待什么。例如，正如您在要点中看到的，我们的后端需要“files.file”命名。我花了一段时间来找出为什么它不工作，我不想你在这上面浪费时间。</p><ul class=""><li id="1ca0" class="mj mk iq ky b kz la lc ld lf ml lj mm ln mn lr mo mp mq mr bi translated">第二个对象将包含您希望随文件一起发送的附加数据。</li></ul><pre class="kg kh ki kj gt ls lt lu lv aw lw bi"><span id="6873" class="lx ly iq lt b gy lz ma l mb mc">{<br/>  name: "data",<br/>  data: JSON.stringify({<br/>    date: date,<br/>    description: description,<br/>  }),<br/>},</span></pre><p id="b994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再次提醒，小心你的<code class="fe md me mf lt b">name</code>领域。将其命名为<code class="fe md me mf lt b">data</code>向库发出信号，这确实是将要上传的额外数据。不然它就不知道怎么解读了。</p><p id="5fab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.这个<code class="fe md me mf lt b">fetch</code>电话很容易掌握。第一个参数将是请求的类型(在代码片段中，如果我们向函数提供一个现有的recordId，我们将执行一个<code class="fe md me mf lt b">put</code>请求；如果没有提供Id，我们将执行一个基本的<code class="fe md me mf lt b">post</code>请求。第二个参数应该是API URL，第三个包含标题，第四个包含<code class="fe md me mf lt b">multipartParams</code>列表。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><h2 id="6063" class="lx ly iq bd mz na nb dn nc nd ne dp nf lf ng nh ni lj nj nk nl ln nm nn no np bi translated">结论</h2><p id="c0f2" class="pw-post-body-paragraph kw kx iq ky b kz nq jr lb lc nr ju le lf ns lh li lj nt ll lm ln nu lp lq lr ij bi translated">让我们感谢这个图书馆的创建者。他们卸下了我们肩上的重担，创建了一个强大的库，为我们节省了很多时间。</p><p id="f424" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请继续关注我向您承诺的内容:如何在React Native上挑选文件，以及如何使用RNFetchBlob下载文件。</p><p id="e381" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nv">更多内容看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="nv">plain English . io</em></strong></a></p></div></div>    
</body>
</html>