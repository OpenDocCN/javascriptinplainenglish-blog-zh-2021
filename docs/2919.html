<html>
<head>
<title>Best Practices to Work with GraphQL Pagination</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GraphQL分页的最佳实践</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/best-practices-to-work-with-graphql-pagination-8f0d1f9937c2?source=collection_archive---------10-----------------------#2021-06-14">https://javascript.plainenglish.io/best-practices-to-work-with-graphql-pagination-8f0d1f9937c2?source=collection_archive---------10-----------------------#2021-06-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a277" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">再也不用为使用GraphQL分页而烦恼了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c17af9dc623d97dd360296bdd1fcef74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ckGVIOmuWWX5oq-Mari6jw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@roman34nov?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Roman Trifonov</a> on <a class="ae kv" href="https://unsplash.com/s/photos/pages?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0421" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用GraphQL时，最有趣的部分之一是分页。在GraphQL中使用分页与在REST APIs中使用分页有很大不同。在本文中，我将解释为什么我们不应该在GraphQL中使用传统的分页。我们还将讨论在GraphQL中使用分页的正确方法。</p><h1 id="ddfc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">为什么我们应该使用分页</h1><p id="6e63" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">嗯，这是一个很基本的问题。我们需要分页来防止前端数据溢出，从而限制网页滞后。</p><p id="11bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">分页使我们能够显示特定数量的数据，从而允许web应用程序的平滑流动。如果您正在构建一个包含大量数据的web应用程序，并且需要显示这些数据的列表，那么您很可能需要分页。</p><h1 id="0bdc" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">传统分页存在的问题及解决方法</h1><p id="8ddb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当在REST API上使用分页时，我们用页码和数量来表示我们想要发送多少。作为回应，我们发送带有总页码、当前页码和所有其他必要内容的数据。</p><p id="5a90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，我们希望显示一个图书列表，其中包括书名、出版物、作者id、作者名字和作者姓氏。为了显示带有分页的查询，您可能会考虑以以下形式执行查询:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/04d4215854a6f09ba10d775803fe328b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C190cdqfvHnM5rm1nPCKhg.png"/></div></div></figure><p id="e448" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是！很糟糕。</p><p id="cbd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们先讨论为什么这不是一个好的方法，然后再讨论<strong class="ky ir">一个更好的方法</strong>。</p><h2 id="0840" class="mq lt iq bd lu mr ms dn ly mt mu dp mc lf mv mw me lj mx my mg ln mz na mi nb bi translated">1.页码</h2><p id="4a5b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">GraphQL中的传统分页有几个问题。第一个也是最重要的问题是:使用页码。为了说明这个问题，让我们看看下面的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d7ba3e9f85cc2ecb8946c8e185e04fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*3L0t8ODT0M8ctOFkOOXH1A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">List of Items</figcaption></figure><p id="57a3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们有一个对象列表。每种颜色代表不同的页码。红色表示第一页，蓝色表示第二页，绿色表示第三页。</p><p id="b509" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设，由于某种原因，在获取第一页后，第2和第3项被移除。然后，在请求第二页时，您会得到8到12个项目，而不是6到10个。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/ca180106bd5364a875b2d48ec70c98c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L2gy6UiieW_6d4Fv4CV12Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Query after removing item 2 and 3</figcaption></figure><p id="d99e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个大问题。因为现在第6和第7项在客户身上不见了。对于某些应用而言，这可能会成为一个严重的问题。例如，如果您正在创建一个银行应用程序并显示所有交易的列表，某些交易可能会丢失。它会让用户心脏病发作。</p><p id="dde7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，这里的解决方案是使用光标而不是页码。我们将在某些特定数据之前或之后获取数据，而不是根据页码获取数据。</p><p id="240a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们把光标放在一些数据上，并告诉服务器在该光标之后获取数据。我们将光标定义为基于<code class="fe ne nf ng nh b">base64</code>的编码字符串。</p><p id="4ed7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在修改了上面的查询之后，我们得到了下面的查询:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/0b5e0b914912c743369bde98ecc7a1f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTWfr1pMFhlobAZ5uTth6g.png"/></div></div></figure><h2 id="1a4a" class="mq lt iq bd lu mr ms dn ly mt mu dp mc lf mv mw me lj mx my mg ln mz na mi nb bi translated">2.元数据呢</h2><p id="e23e" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">根据应用程序的不同，您可能希望显示是否有上一页或下一页。您可能还想在页面的列表中包含我们可能需要的其他属性。</p><p id="52b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个问题，我们可以将我们的响应改为基于节点边的设计。之后，我们的查询将如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/be6d70564d9bae4b207568c35ffa05e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Anm0RHPT-R4S8MkvxAUVUA.png"/></div></div></figure><p id="234a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们将显示一个边的列表，每个边由一个节点和一个光标组成。光标将代表该节点。这里，我们也有<code class="fe ne nf ng nh b">pageInfo</code>来显示是否有上一页和下一页。我们也有<code class="fe ne nf ng nh b">startCursor</code>和<code class="fe ne nf ng nh b">endCursor</code>来更好地方便页面切换。</p><p id="3c27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">总的来说，这种方法被证明是在GraphQL中使用分页的最佳实践。</p><h1 id="e01d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="3ef4" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们现在完全理解了GraphQL分页是如何工作的，以及最佳实践是什么。我希望我们现在能够在所有Node.js项目中使用这些知识。</p><p id="9f3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">祝您愉快！</p><p id="6018" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nk">更多内容尽在</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nk">plain English . io</em></a></p></div></div>    
</body>
</html>