<html>
<head>
<title>Bringing Python Lists to JavaScript With Proxy API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用代理API将Python列表引入JavaScript</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/bringing-python-lists-to-javascript-with-proxy-api-1db8c3e559b4?source=collection_archive---------20-----------------------#2021-05-18">https://javascript.plainenglish.io/bringing-python-lists-to-javascript-with-proxy-api-1db8c3e559b4?source=collection_archive---------20-----------------------#2021-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="207c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用JavaScript代理API创建一个带切片和负索引的类Python列表对象？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/999fee3499eda67252f114694ce5fc00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1A9IWpNxJkH_lelGSAfyA@2x.png"/></div></div></figure><p id="2154" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">JavaScript代理API经常被描绘成“一个高级概念”，这阻碍了许多初学者(甚至是中间用户)钻研这个主题。</p><p id="d719" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">实际上，理解它的基本原理并不困难。一旦你得到它，你将拥有一个新的强大武器。您可以将它用于数据验证、操作符重载、自动修复输入、日志记录等等。像<a class="ae ln" href="https://v3.vuejs.org/guide/reactivity.html#how-vue-knows-what-code-is-running" rel="noopener ugc nofollow" target="_blank"> Vue.js </a>和<a class="ae ln" href="https://mobx.js.org/configuration.html" rel="noopener ugc nofollow" target="_blank"> MobX </a>这样的流行库利用代理API来创建<em class="lo">反应对象</em>。</p><p id="262d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我想用一个简单有趣的例子向您介绍代理及其基本机制。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="c374" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">什么是JavaScript代理</h1><p id="240c" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">代理API是在2015年ES6中引入的。一个<code class="fe mt mu mv mw b">Proxy</code>使你能够为另一个对象创建一个包装器，它可以截取和重新定义那个对象的基本操作。</p><p id="87f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">需要理解的3个关键术语是:</p><ul class=""><li id="3411" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated"><strong class="kt ir">陷阱</strong>:我们可以覆盖的方法；</li><li id="8721" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><strong class="kt ir"> Handler </strong>:包装我们所有陷阱的对象；</li><li id="8975" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><strong class="kt ir">目标</strong>:我们要代理的对象。</li></ul><p id="bd64" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mt mu mv mw b">Proxy</code>对象构造函数有两个参数:目标和处理程序。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="5a81" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">我们将做什么</h1><p id="e8a4" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我们将使用代理API在JavaScript中创建一个类似Python的列表。具体来说，我们将关注Python列表的两大特性:<em class="lo">负索引</em>和<em class="lo">切片</em>。</p><p id="bc8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您不熟悉Python，在下一节中，我将向您快速介绍这两个特性。</p><p id="f6c6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当心:你将会看到几行Python代码。不要慌；)</p><h2 id="a5de" class="nl lx iq bd ly nm nn dn mc no np dp mg la nq nr mi le ns nt mk li nu nv mm nw bi translated">负索引</h2><p id="ff22" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">Python允许从列表末尾读取负索引。这意味着-1表示最后一项，-2表示倒数第二项，依此类推。</p><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="494c" class="nl lx iq mw b gy ob oc l od oe"># create a list of numbers<br/>numbers = [1, 2, 3, 4, 5]</span><span id="b05f" class="nl lx iq mw b gy of oc l od oe"># last item<br/>numbers[-1] # -&gt; 5</span><span id="6ff0" class="nl lx iq mw b gy of oc l od oe"># second last item<br/>numbers[-2] # -&gt; 4</span></pre><h2 id="fd31" class="nl lx iq bd ly nm nn dn mc no np dp mg la nq nr mi le ns nt mk li nu nv mm nw bi translated">限幅</h2><p id="963f" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">如果我们想访问列表的特定部分呢？Python切片符号很方便。</p><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="6600" class="nl lx iq mw b gy ob oc l od oe"># create a list of numbers<br/>numbers = [1, 2, 3, 4, 5]</span><span id="20c4" class="nl lx iq mw b gy of oc l od oe"># elements 3rd to 5th<br/>numbers[2:5] # -&gt; [3, 4, 5</span><span id="0b5e" class="nl lx iq mw b gy of oc l od oe"># first 3 elements<br/>numbers[:2] # -&gt; [1, 2, 3]</span><span id="a4a3" class="nl lx iq mw b gy of oc l od oe"># elements 4th to the end<br/>numbers[3:] # -&gt; [4, 5]</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="5dea" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">编码时间到了</h1><p id="2611" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">好了，回到JavaScript。</p><p id="0c73" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们开始创建一个包装器函数，用一个定制的处理程序返回一个新的<code class="fe mt mu mv mw b">Proxy</code>对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="3cf5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的目标是超越<code class="fe mt mu mv mw b">get()</code>和<code class="fe mt mu mv mw b">set()</code>陷阱，以使负索引和切片工作。</p><h2 id="a33f" class="nl lx iq bd ly nm nn dn mc no np dp mg la nq nr mi le ns nt mk li nu nv mm nw bi translated">负索引</h2><p id="dc37" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我们如何从负指数开始得到正确的正指数？</p><p id="d9bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">想法很简单，我们把负的索引加到数组的长度上。例如，给定一个包含5个元素的列表，如果请求的索引是-1，我们必须返回列表的第4个元素，即<code class="fe mt mu mv mw b">-1 + 5 = 4</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="f6d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每次使用负索引来访问数组时，我们都调用<code class="fe mt mu mv mw b">parseNegativeIndex</code>来获取被请求元素的实际索引。</p><p id="c9e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以写:</p><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="f3fd" class="nl lx iq mw b gy ob oc l od oe">const numbers = PythonList([1, 2, 3, 4, 5]);</span><span id="6905" class="nl lx iq mw b gy of oc l od oe">numbers[-1] // -&gt; 5<br/>numbers[-2] // -&gt; 4</span></pre><p id="20f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不错！</p><p id="b63f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">那<code class="fe mt mu mv mw b">set()</code>呢？除了赋值之外，它还具有与<code class="fe mt mu mv mw b">get()</code>方法相同的逻辑。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="2cc3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们可以用负指数赋值:</p><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="4047" class="nl lx iq mw b gy ob oc l od oe">const numbers = PythonList([1, 2, 3, 4, 5]);</span><span id="c286" class="nl lx iq mw b gy of oc l od oe">numbers[-1] = 10 <br/>numbers // -&gt; [1, 2, 3, 4, 10] </span></pre><h2 id="a415" class="nl lx iq bd ly nm nn dn mc no np dp mg la nq nr mi le ns nt mk li nu nv mm nw bi translated">限幅</h2><p id="ea5a" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">JavaScript <code class="fe mt mu mv mw b">Array</code>对象已经有了一个<code class="fe mt mu mv mw b">slice()</code>方法，我们可以用它来获取数组的一部分。我们所要做的就是解析所请求的索引，以获得开始和结束索引。</p><p id="1c80" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">至于负索引，我们将编写一个助手函数<code class="fe mt mu mv mw b">getIndices()</code>在<code class="fe mt mu mv mw b">get()</code>和<code class="fe mt mu mv mw b">set()</code>方法中使用。</p><p id="5621" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们知道Python切片符号是基于列操作符的，所以我们可以在<code class="fe mt mu mv mw b">:</code>字符上拆分字符串来获得两个索引。</p><p id="8ed8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后，对于每个索引，我们必须进行以下检查:</p><ul class=""><li id="6c5b" class="mx my iq kt b ku kv kx ky la mz le na li nb lm nc nd ne nf bi translated">是空字符串吗？在这种情况下，它表示左步进的<code class="fe mt mu mv mw b">0</code>或右步进的<code class="fe mt mu mv mw b">list.length</code></li><li id="3a05" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated">是负指数吗？在这种情况下，我们必须使用<code class="fe mt mu mv mw b">parseNegativeIndex</code>函数来转换索引</li></ul><p id="c5a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们有了这两个指数，我们就可以称之为<code class="fe mt mu mv mw b">slice(start, end)</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="7e4e" class="nl lx iq mw b gy ob oc l od oe">const numbers = PythonList([1, 2, 3, 4, 5]);</span><span id="0417" class="nl lx iq mw b gy of oc l od oe">numbers["2:5"] // -&gt; [3, 4, 5] <br/>numbers["3:"] // -&gt; [4, 5]<br/>numbers[":2"] // -&gt; [1, 2]</span></pre><p id="a92c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意</strong>JavaScript不让我们写<code class="fe mt mu mv mw b">numbers[2:5]</code>。我们必须将索引写成字符串，以避免语法错误。</p><p id="2f96" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe mt mu mv mw b">set()</code>函数中，我们再次使用<code class="fe mt mu mv mw b">getIndices</code>函数来获取左右索引。为了进行分配，我们将利用<code class="fe mt mu mv mw b">Array.splice()</code>方法。</p><p id="b3ef" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mt mu mv mw b">splice()</code>方法允许我们通过移除或替换现有元素和/或添加新元素来改变数组的内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="022b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们终于可以用负索引和切片来获取和设置值了！</p><pre class="kg kh ki kj gt nx mw ny nz aw oa bi"><span id="f272" class="nl lx iq mw b gy ob oc l od oe">const numbers = PythonList([1, 2, 3, 4, 5]);</span><span id="defd" class="nl lx iq mw b gy of oc l od oe">numbers[-1] // -&gt; 5<br/>numbers["2:5"] // -&gt; [3, 4, 5] </span><span id="145e" class="nl lx iq mw b gy of oc l od oe">numbers[-1] = 15 <br/>numbers[":4"] = [11,12,13,14]</span><span id="276f" class="nl lx iq mw b gy of oc l od oe">numbers // -&gt; [11, 12, 13, 14, 15]</span></pre></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h1 id="547f" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">结论</h1><p id="de23" class="pw-post-body-paragraph kr ks iq kt b ku mo jr kw kx mp ju kz la mq lc ld le mr lg lh li ms lk ll lm ij bi translated">我希望这个基本示例能帮助您理解代理API的关键概念，以及如何使用它们来增强您的JavaScript对象。</p><h1 id="dfe3" class="lw lx iq bd ly lz oi mb mc md oj mf mg jw ok jx mi jz ol ka mk kc om kd mm mn bi translated">资源</h1><ul class=""><li id="c6cf" class="mx my iq kt b ku mo kx mp la on le oo li op lm nc nd ne nf bi translated">Github要诀</li><li id="ccb9" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy?retiredLocale=it" rel="noopener ugc nofollow" target="_blank">MDN上的代理对象引用</a></li><li id="04f4" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array?retiredLocale=it" rel="noopener ugc nofollow" target="_blank">MDN上的数组对象引用</a></li><li id="8090" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Meta_programming" rel="noopener ugc nofollow" target="_blank">MDN上的元编程</a></li><li id="e827" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://v3.vuejs.org/guide/reactivity.html#how-vue-tracks-these-changes" rel="noopener ugc nofollow" target="_blank">使用代理的Vue反应对象</a></li><li id="4ab3" class="mx my iq kt b ku ng kx nh la ni le nj li nk lm nc nd ne nf bi translated"><a class="ae ln" href="https://mobx.js.org/configuration.html" rel="noopener ugc nofollow" target="_blank"> MobX代理支持</a></li></ul><p id="d1c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lo">更多内容请看</em><a class="ae ln" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="lo">plain English . io</em></a></p></div></div>    
</body>
</html>