<html>
<head>
<title>The Many Ways of Fetching API Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">获取API数据的多种方式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/from-fetch-api-to-useeffect-and-axios-the-many-ways-of-fetching-api-data-367757ea5ac6?source=collection_archive---------9-----------------------#2021-05-16">https://javascript.plainenglish.io/from-fetch-api-to-useeffect-and-axios-the-many-ways-of-fetching-api-data-367757ea5ac6?source=collection_archive---------9-----------------------#2021-05-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="57c5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">从获取API，到使用Effect和Axios</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/58234d4bd92f03d6192015c1ab5b04eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AfOJ4G8XI2cAAXahkAZETg.jpeg"/></div></div></figure><p id="2223" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最近，随着我在不同项目中的工作，我一直在尝试扩展我的数据获取能力。实际上有很多方法可以获取API数据。在这篇博客中，我将介绍最简单的方法，比如使用Fetch API，然后介绍使用<code class="fe lk ll lm ln b">useEffect()</code>的方法，然后是Axios方法。这些是最常用的方法。实际上，除了这三种方法，还有很多其他方法，但是如果您是JavaScript或React新手，这是一个很好的开始。</p><h1 id="8ab9" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">首先，什么是API？</h1><p id="c5cb" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated"><strong class="kq io"> API </strong>代表<strong class="kq io">应用编程接口</strong>。你可以把它想象成一个用来请求和获取信息的链接，或者像一个叫外卖的菜单。API给了我们获取数据的能力，并允许应用程序相互通信。</p><p id="0447" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一个例子是，如果我想建立一个NBA统计应用程序。我会使用像<a class="ae ml" href="https://www.balldontlie.io/#introduction" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> balldontlie </strong> </a>这样的免费API，它允许我访问NBA相关的数据，如球员信息，比赛统计数据，如每场比赛的得分，每场比赛的盖帽等。API让我们避免了大量收集数据的工作！</p><p id="4de1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们继续获取这个API数据吧！</p><h1 id="ec32" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">Fetch()—Fetch API方法</h1><p id="e2f8" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">几个月前，我主要使用JavaScript获取数据，并使用fetch() API进行反应。这是最简单、最容易获得数据的方式，因为它内置于大多数现代浏览器中(除了我写这篇博客时的Internet Explorer)。fetch() API</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/70653109ad2796f25824a2f969d9e75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36rChq4O9SK-7HY_fSb9sA.png"/></div></div></figure><p id="3ea5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">上面是一个在<strong class="kq io">componentdimount()</strong>方法中的基本获取请求的例子。它调用<strong class="kq io"> fetch() </strong>方法，该方法接受一个参数，即资源。这是您要获取的数据的路径。这可以是您的API数据，如链接或请求对象。然后它返回一个承诺，其中包含一个响应对象。因为我们得到的响应只是一个HTTP响应，所以我们将<strong class="kq io"> json() </strong>方法附加到响应中，这样我们就可以得到实际的json格式的数据作为我们的响应。</p><p id="5991" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">另外，fetch API的一个主要缺点是处理错误。在我上面的例子中，我没有考虑让我的代码处理错误。这可能是不好的，因为即使url向我发送404错误(意味着没有找到页面)，我们仍然会发送该错误作为响应，而不会破坏我们的代码。我将在下面的两个方法中向您展示如何处理获取错误。</p><h1 id="d9c3" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">useEffect( ) —获取useEffect挂钩方式</h1><p id="9358" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">因为钩子在我们使用React时变得越来越常见，所以钩子获取数据的方式是使用<code class="fe lk ll lm ln b">useEffect</code>方法。Effect Hook增加了与第一个例子中的<code class="fe lk ll lm ln b">componentDidMount</code>相同的功能，或者执行其他副作用，但是是在一个函数组件中。</p><p id="933d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如上例所示，我们使用了一个类组件。<code class="fe lk ll lm ln b">useEffect()</code> <strong class="kq io"> </strong>让我们可以在类中、在函数组件中使用<code class="fe lk ll lm ln b">componentDidMount</code>、<code class="fe lk ll lm ln b">componentDidUpdate</code>、<code class="fe lk ll lm ln b">componentDidUnmount</code>，但是它们都被打包到一个API中——use effect！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/25fce74757377e8d7ace60b0614f47d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmsGRLYoJnjZv7uFlhQEpQ.png"/></div></div></figure><p id="a006" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<code class="fe lk ll lm ln b">useEffect()</code>中，就像我们上面的第一个例子一样，我们的fetch接受一个参数，也就是资源。这一次，我使用来自balldontlie的NBA stats API作为我的API数据。在第一次<code class="fe lk ll lm ln b">.then()</code>回调时，我们得到我们的响应。<strong class="kq io">如果</strong>我们的响应没问题，我们继续并返回那个响应。然而，如果我们的响应不好，比如说我们的响应中有一个错误，我们会将响应作为一个错误抛出，我们的<code class="fe lk ll lm ln b">.catch</code> <strong class="kq io"> </strong>回调会处理这个错误。</p><p id="d0e0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后在。最后是回调，我们用它作为一个函数，显示我们的数据或错误，我们的响应是好是坏。</p><p id="d9c8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是我们的输出:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/d161b4bd7a701cafa7d9226c1ccfd8fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*fuEbipf8CtSJACN4ZmFDWQ.png"/></div></figure><h1 id="3306" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">Axios</h1><p id="bb67" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">Axios是一个用于提出数据请求的开源库。为了使用axios，你必须首先安装它，因为它不像React中的fetch或useEffect那样内置。你可以用yarn或npm这样的包管理器来安装它。下面我有<code class="fe lk ll lm ln b">npm install axios</code>，或者<code class="fe lk ll lm ln b">yarn add axios</code>如果你用纱的话。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/5fc83fdb9642a90ff3795e6b909fdab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*xMgE0WaO57rqGMic_9FVFg.png"/></div></figure><p id="9e87" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Axios支持所有现代浏览器，甚至是Internet Explorer。</p><p id="a03a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">也可以在vanilla JavaScript、React、Vue.js和Angular中使用。</p><p id="62c0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Axios也有更好的错误处理和自动转换功能。它让我们减少了很多代码！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2d5e5f36a9167e7597edd2230f908ad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*QX1FPWGCRPq8BLOszW4Hhg.png"/></div></figure><p id="e3d6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是我们在上面的useEffect方法中的代码。我们能够减少响应，因为Axios处理第一次回调，我们检查响应是否正常，如果不正常，就给我们一个错误。</p><h1 id="974d" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated"><strong class="ak">结论</strong></h1><p id="388b" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">获取数据的方式还有很多。如果您只接触过获取数据，希望您能够扩展您的知识。</p><p id="4dee" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你的获取方式是什么？请在评论中告诉我们。</p><p id="6860" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mr">更多内容看</em> <a class="ae ml" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> <em class="mr">说白了</em></strong></a></p></div></div>    
</body>
</html>