<html>
<head>
<title>Migrating a Create React App (CRA) Application to Vite</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Create React App (CRA)应用程序迁移到Vite</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/migrating-a-create-react-app-cra-application-to-vite-788b13243b5a?source=collection_archive---------0-----------------------#2021-06-29">https://javascript.plainenglish.io/migrating-a-create-react-app-cra-application-to-vite-788b13243b5a?source=collection_archive---------0-----------------------#2021-06-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b221400c07b5b76f47834c1bbbc0efcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UKqtWaQiR-cu1COo"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="414b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我有一个现有的应用程序是使用create react app (CRA)搭建的，并使用craco进行了扩展。CRA不支持我需要的工具，所以我不得不寻找一个替代品。我找到了维特。</p><p id="3747" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Vite over CRA有一些令人难以置信的改进，包括PostCSS 8.0支持，所以我决定迁移我的生产应用程序。</p><p id="8fe0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将解释Vite的一些好处，并描述升级应用程序所需的步骤。</p><h1 id="64e2" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">为什么要创建反应应用程序？</h1><p id="e70c" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite拥有CRA的所有功能，但实现更好，而且它还有CRA不支持的附加功能。</p><p id="548e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是Vite对我的应用程序的三个主要好处。</p><h1 id="0cd1" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">速度</h1><p id="e332" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite比CRA快10-20倍，因为它使用esbuild而不是webpack。很难描述它的速度有多快，但是所有的改变在你的浏览器中都是瞬间发生的。</p><p id="b90b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">需要注意的一点是，Vite不检查你的代码。它只将文件类型脚本转换成JavaScript。因此，在开发管道的后期构建时，您可能会发现一些静态错误。不过，您的IDE应该会对此有所帮助。</p><h1 id="b5c7" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">本机ECMAScript模块支持</h1><p id="ac62" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite原生支持ES模块。它允许你为浏览器开发类似TypeScript的裸导入，并在构建时将它们转换成正确的版本化导入。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="e6e1" class="mk kz in mg b gy ml mm l mn mo">// you write your code with bare import <br/>import myModule from "./folder/myModule" </span><span id="ea95" class="mk kz in mg b gy mp mm l mn mo">// vite converts to usable import <br/>import myModule from "./folder/myModule.js?v=abc123</span></pre><h1 id="951a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">CSS插件支持</h1><p id="3354" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite比create react app更早支持PostCSS 8.0等现代工具。在写这篇文章的时候，CRA还不支持PostCSS 8.0。Vite正在更积极地开发中。如果你想使用没有笨拙的webpack垫片的tailwind CSS，你应该使用Vite。</p><p id="7091" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在这里看到<a class="ae jz" href="https://vitejs.dev/guide/features.html" rel="noopener ugc nofollow" target="_blank">完整的特性列表</a></p><h1 id="f9fe" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2021年浏览器支持Vite构建</h1><p id="4575" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite的默认目标需要原生ES6模块。能够使用原生es6模块减少了您的包大小，因为它更容易删除未使用的代码。</p><p id="7dca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">自2019年以来，大多数桌面浏览器都支持原生ES6模块。移动设备也是如此，尽管支持更加分散。你可以在caniuse.com这里查看支持<a class="ae jz" href="https://caniuse.com/es6-module" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="89bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你需要针对旧的浏览器，你可以使用来自<a class="ae jz" href="https://github.com/vitejs/vite/tree/main/packages/plugin-legacy" rel="noopener ugc nofollow" target="_blank"> @vitejs/plugin-legacy </a>的官方插件。这将加载所需的聚合填充以支持旧目标。</p><h1 id="fc3c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">计划升级到Vite</h1><p id="adbf" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">如果你已经使用了TypeScript，Vite几乎可以替代CRA。您将需要对您的代码进行一些更改，但您应该能够找到并替换其中的大部分。</p><p id="49d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些是我们将遵循的迁移步骤。</p><ol class=""><li id="5f72" class="mq mr in kc b kd ke kh ki kl ms kp mt kt mu kx mv mw mx my bi translated">更新您的package.json</li><li id="8139" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">添加Vite配置</li><li id="24d8" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">更新您的tsconfig.json文件</li><li id="2fc9" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">安装所有软件包</li><li id="5b88" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">移动您的index.html文件</li><li id="db03" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">更新index.html内容</li><li id="2a95" class="mq mr in kc b kd mz kh na kl nb kp nc kt nd kx mv mw mx my bi translated">更新所有的环境变量</li></ol><p id="6d26" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们走吧！</p><h1 id="e6b6" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">1.更新您的package.json</h1><p id="9ccf" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">将package.json脚本更改为使用Vite。不要担心还没有，我们以后会安装的。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="5d58" class="mk kz in mg b gy ml mm l mn mo">"scripts": {<br/>    "start": "vite",<br/>    "build": "tsc &amp;&amp; vite build",<br/>    "serve": "vite preview",<br/>  },</span></pre><p id="ce56" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保从依赖项部分删除<code class="fe ne nf ng mg b">react-scripts</code>。</p><p id="17d8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为Vite添加一些新的devDependencies。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="d00d" class="mk kz in mg b gy ml mm l mn mo">"@vitejs/plugin-react-refresh": "^1.3.1",<br/>    "vite": "^2.3.2"</span></pre><p id="935f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你需要的话，现在就可以将PostCSS 8+添加到你的依赖项中！</p><h1 id="6a82" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">2.添加Vite配置</h1><p id="71ea" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">将<code class="fe ne nf ng mg b">vite.config.ts</code>添加到项目的根目录。我只是用这个基本配置开始。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="09b0" class="mk kz in mg b gy ml mm l mn mo">import { defineConfig } from 'vite'<br/>import reactRefresh from '@vitejs/plugin-react-refresh'<br/><br/>// https://vitejs.dev/config/<br/>export default defineConfig({<br/>  // This changes the out put dir from dist to build<br/>  // comment this out if that isn't relevant for your project<br/>  build: {<br/>    outDir: 'build',<br/>  },<br/>  <!-- -->plugins: [reactRefresh()],<br/>})</span></pre><h1 id="9644" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">3.更新您的tsconfig.json</h1><p id="4023" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">您必须设置tsconfig.json以使用esnext作为目标、lib和模块类型。这可能会在TypeScripts的未来版本中发生变化，因为在给定的年份，es标准中会添加更多的esnext功能，所以如果这篇文章是旧的，请查看Vite站点以获取更新的配置。</p><p id="6ee2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将Vite类型添加到types部分。这告诉TypeScript它为我们提供的特殊的Vite浏览器功能。</p><p id="818d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，不要忘记将isolatedModules设置为true，如果您还没有设置的话。Vite还不支持一些现代的类型脚本功能。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="f26b" class="mk kz in mg b gy ml mm l mn mo">{<br/>  "compilerOptions": {<br/>    "target": "ESNext",<br/>    "lib": ["dom", "dom.iterable", "esnext"],<br/>    "types": ["vite/client"],<br/>    "allowJs": false,<br/>    "skipLibCheck": false,<br/>    "esModuleInterop": false,<br/>    "allowSyntheticDefaultImports": true,<br/>    "strict": true,<br/>    "forceConsistentCasingInFileNames": true,<br/>    "noFallthroughCasesInSwitch": true,<br/>    "module": "esnext",<br/>    "moduleResolution": "node",<br/>    "resolveJsonModule": true,<br/>    "isolatedModules": true,<br/>    "noEmit": true,<br/>    "jsx": "react-jsx"<br/>  },<br/>  "include": ["src"]<br/>}</span></pre><h1 id="c632" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">4.安装以更新所有内容</h1><p id="c8ea" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">运行<code class="fe ne nf ng mg b">yarn</code>或<code class="fe ne nf ng mg b">npm i</code>来安装我们已经添加到项目中的所有新的依赖项。</p><h1 id="decf" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">5.移动您的index.html文件</h1><p id="fb72" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">将index.html从<code class="fe ne nf ng mg b">/public</code>移到项目的根。</p><p id="241a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Vite不再需要将index.html放在公共文件夹中。</p><h1 id="92ae" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">6.更新index.html的背景</h1><p id="c9d4" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">Vite以不同的方式处理index.html中的URL来创建react应用程序。</p><p id="610d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从文件中删除任何<code class="fe ne nf ng mg b">%PUBLIC_URL%</code>引用。把那个字符串换成<code class="fe ne nf ng mg b">""</code>就行了。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="890e" class="mk kz in mg b gy ml mm l mn mo">&lt;!-- This is the create react app url. change this to not have the variable... --&gt;<br/>&lt;link rel="icon" href="%PUBLIC_URL%/favicon.ico" /&gt;<br/><br/>&lt;!-- ... to be like this. This is the correct url for Vite --&gt;<br/>&lt;link rel="icon" href="/favicon.ico" /&gt;</span></pre><p id="b14b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加带有项目入口点的脚本标记。</p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="d86b" class="mk kz in mg b gy ml mm l mn mo">&lt;body&gt;<br/>  &lt;noscript&gt;You need to enable JavaScript to run this app.&lt;/noscript&gt;<br/>  &lt;div id="root"&gt;&lt;/div&gt;<br/>  &lt;!-- Like below. This is the script tag for bootstrapping your Vite application --&gt;<br/>  &lt;script type="module" src="/src/index.tsx"&gt;&lt;/script&gt;<br/>&lt;/body&gt;</span></pre><h1 id="ac67" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">7.更新所有的环境变量，如果你使用它们的话</h1><p id="bd16" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">重命名您的环境变量，使它们以<code class="fe ne nf ng mg b">VITE_</code>开头，例如搜索并将<code class="fe ne nf ng mg b">REACT_APP_</code>替换为<code class="fe ne nf ng mg b">VITE_</code></p><pre class="mb mc md me gt mf mg mh mi aw mj bi"><span id="a80c" class="mk kz in mg b gy ml mm l mn mo"># this create react app variable<br/>REACT_APP_MY_VAR</span><span id="cd90" class="mk kz in mg b gy mp mm l mn mo"># should be this in Vite<br/>VITE_MY_VAR</span></pre><p id="caf4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Vite使用ECMAScript模块import.meta属性将环境变量传递给模块。</p><p id="8148" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要访问这些环境变量，您必须将所有的<code class="fe ne nf ng mg b">process.env.</code>更改为<code class="fe ne nf ng mg b">import.meta.env.</code>。</p><p id="8208" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你应该能够搜索和替换这个。</p><h1 id="833b" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">搞定了。</h1><p id="8753" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">就是这样。现在尝试使用<code class="fe ne nf ng mg b">yarn start</code>或<code class="fe ne nf ng mg b">npm run start</code>运行您的应用程序</p><p id="598f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果有什么对你不起作用，请告诉我！可以在Twitter 上联系我<a class="ae jz" href="https://twitter.com/darraghor" rel="noopener ugc nofollow" target="_blank">！</a></p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/69ab590ba23fbf49a4d61f6d66a27513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LaoJxyw-QlblxjuA.png"/></div></div></figure></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><p id="ad9f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="np">原载于</em><a class="ae jz" href="https://www.darraghoriordan.com/2021/05/16/migrating-from-create-react-app-to-vite/" rel="noopener ugc nofollow" target="_blank"><em class="np"/></a><em class="np">。</em></p><p id="c955" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="np">多内容于</em> <a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="np">浅显易懂</em> </strong> </a></p></div></div>    
</body>
</html>