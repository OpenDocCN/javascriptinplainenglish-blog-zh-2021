<html>
<head>
<title>Add AWS Cognito Auth to Your Angular App Without Amplify</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将AWS Cognito Auth添加到您的Angular应用程序，无需放大</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-aws-cognito-auth-to-your-angular-app-without-amplify-64dfe656c65a?source=collection_archive---------0-----------------------#2021-07-26">https://javascript.plainenglish.io/add-aws-cognito-auth-to-your-angular-app-without-amplify-64dfe656c65a?source=collection_archive---------0-----------------------#2021-07-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="828c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">AWS Cognito与amazon-cognito-identity-js集成</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ac6db352981b951a36d682611c2c1812.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-Npi6YQQ05fhxXAFcn1OQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://www.pexels.com/@cottonbro?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">cottonbro</a> from <a class="ae kv" href="https://www.pexels.com/photo/city-fashion-man-couple-7777521/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="be7c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">AWS Cognito是一种身份管理服务，可以帮助开发人员在更短的时间内在他们的应用程序中实现身份验证。有了Cognito，开发人员不必花费太多的时间和精力从零开始构建认证流程，也不必担心可伸缩性、安全性等问题。</p><p id="8ec3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">将Cognito集成到单页应用程序中的常见方法是使用<a class="ae kv" href="https://github.com/aws-amplify/amplify-js" rel="noopener ugc nofollow" target="_blank"> Amplify library </a>。然而，如果我们只想在应用程序中使用整个Amplify库来实现Cognito认证特性，那么使用它可能会有些多余。</p><p id="728c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将把Cognito auth添加到一个Angular应用程序中，并使用最少的依赖项。尽管本文特别关注Angular框架，但是您将能够对本文中的代码进行一些调整，并在任何单页面应用程序中使用它。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4b41" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建新的角度项目</h1><p id="cebf" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">要创建新的Angular项目，我们首先需要安装Angular CLI。<a class="ae kv" href="http://npm install -g @angular/cli" rel="noopener ugc nofollow" target="_blank">如果还没有的话先安装</a>。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="2276" class="nb ma iq mx b gy nc nd l ne nf">npm install -g @angular/cli</span></pre><p id="b953" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在您的首选目录中，执行命令<code class="fe ng nh ni mx b">ng new &lt;app_name&gt;</code>。选择添加角度路由并选择您最熟悉的样式表格式。Angular CLI会处理剩下的事情。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/f221fd0326f4fc7c3536a059a667a2ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JLLfK-rSvvemcPSu-Yin1w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Add routing and stylesheet format</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d1b8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">安装依赖项</h1><p id="0692" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如前所述，安装整个Amplify库仅仅是为了设置Cognito认证可能是多余的。因此，为了避免这种情况，我们将只对Cognito使用JS库，名为<a class="ae kv" href="https://www.npmjs.com/package/amazon-cognito-identity-js" rel="noopener ugc nofollow" target="_blank">Amazon-cogn ITO-identity-JS</a>。</p><p id="cd59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Angular项目中，运行以下命令来安装库。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="3e15" class="nb ma iq mx b gy nc nd l ne nf">npm i amazon-cognito-identity-js</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3e8e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创建用户界面</h1><p id="21d1" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在让我们为登录和注册页面创建用户界面。在终端中，从Angular项目文件夹中逐个执行以下命令。这将在新创建的<code class="fe ng nh ni mx b">auth</code>目录中创建两个名为<code class="fe ng nh ni mx b">sign-in</code>和<code class="fe ng nh ni mx b">sign-up</code>的角度组件。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="105d" class="nb ma iq mx b gy nc nd l ne nf">ng generate component auth/sign-in<br/>ng generate component auth/sign-up</span></pre><h2 id="490e" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">创建注册页面</h2><p id="ccf2" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<code class="fe ng nh ni mx b">auth/sign-up/sign-up.component.html</code>，为我们的注册表单添加以下代码。我们将在本教程的后面添加用户寄存器逻辑。</p><blockquote class="nv nw nx"><p id="269b" class="kw kx ny ky b kz la jr lb lc ld ju le nz lg lh li oa lk ll lm ob lo lp lq lr ij bi translated">因为主要重点是展示Cognito特性，所以我决定使用最少的HTML样板。您可以随心所欲地在视图中添加样式。</p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="0327" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">创建登录页面</h2><p id="bc46" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<code class="fe ng nh ni mx b">auth/sign-in/sign-in.component.html</code>，添加以下代码。我们将在本教程的下一步中添加用户登录逻辑。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="c66a" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">创建仪表板页面</h2><p id="0d6c" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了演示如何保护受保护的页面，让我们创建另一个名为dashboard的页面。在终端中执行以下命令。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="9e49" class="nb ma iq mx b gy nc nd l ne nf">ng generate component dashboard</span></pre><p id="9bbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后打开<code class="fe ng nh ni mx b">dashboard/dashboard.component.html</code>并添加以下代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="89c6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们已经创建了所有需要的用户界面。让我们来看看如何构建Cognito认证的逻辑。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3777" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">建筑认证</h1><h2 id="82fd" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">设置环境变量</h2><p id="25fa" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了实现Cognito认证，我们需要您的Cognito用户池的ID和您的用户池客户端的ID。因为将这些应用范围内的配置变量存储为环境变量是一个最佳实践，所以打开<code class="fe ng nh ni mx b">environments/environment.ts</code>并修改环境对象，如下所示。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="477b" class="nb ma iq mx b gy nc nd l ne nf">export const environment = {<br/>    production: false,<br/>    cognitoUserPoolId: &lt;your_cognito_user_pool_id&gt;,<br/>    cognitoAppClientId: &lt;your_cognito_app_client_id&gt;<br/>};</span></pre><p id="2876" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们可以通过导入和引用<code class="fe ng nh ni mx b">environment</code>对象，在应用程序代码中访问这些环境变量。</p><h2 id="7c3d" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">实现注册的逻辑</h2><p id="0504" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<code class="fe ng nh ni mx b">auth/sign-up/sign-up.component.ts</code>，添加以下代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="b9f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能想知道在<code class="fe ng nh ni mx b">formData</code>对象中前缀为<code class="fe ng nh ni mx b">custom:</code>的对象键是什么意思。Amazon Cognito支持大量现成的用户属性，如<code class="fe ng nh ni mx b">name</code>、<code class="fe ng nh ni mx b">email_address</code>、<code class="fe ng nh ni mx b">family_name</code>、<code class="fe ng nh ni mx b">birthdate</code>等，但我们仍然希望为特定的应用程序需求提供一些自定义属性。这里，<code class="fe ng nh ni mx b">university</code>就是这样一个自定义用户属性。因此，在为<code class="fe ng nh ni mx b">university</code>字段插入值时，我们应该给它加上前缀<code class="fe ng nh ni mx b">custom:</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/e18c9c0d3a294e7a1d5f3928fd818855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2q0OnkDWVu8l7H4mIZ7SzA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">attributes that the user pool supports + two custom attributes</figcaption></figure><h2 id="ce76" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">4.3实现登录逻辑</h2><p id="d86e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<code class="fe ng nh ni mx b">auth/sign-in/sign-in.component.ts</code>并添加以下代码。在这里，我使用电子邮件地址作为用户名，但是您可以自由地使用任何值，只要它对于特定用户是唯一的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><h2 id="e4b0" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">4.4实现签出逻辑</h2><p id="b552" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">打开<code class="fe ng nh ni mx b">dashboard/dashboard.component.ts</code>并添加以下内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">dashboard.component.ts</figcaption></figure><h2 id="55c2" class="nb ma iq bd mb nk nl dn mf nm nn dp mj lf no np ml lj nq nr mn ln ns nt mp nu bi translated">4.5实施路线保护</h2><p id="a160" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Angular中的Route guards可用于在我们的应用程序中的路由上实现自定义逻辑。我们使用<code class="fe ng nh ni mx b">canActivate</code> route guard在允许用户查看受保护的页面之前检查用户是否已经被认证。在本教程中，我们将保护仪表板页面。</p><p id="2b14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要生成路由保护，请运行以下命令。出现提示时，选择<code class="fe ng nh ni mx b">canActivate</code>。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="41fd" class="nb ma iq mx b gy nc nd l ne nf">ng g guard auth/auth-guard --skipTests=true</span></pre><p id="cc14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将在<code class="fe ng nh ni mx b">auth</code>目录中创建一个<code class="fe ng nh ni mx b">auth.guard.ts</code>文件。用以下代码修改它的代码。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="b203" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们的route guard中的<code class="fe ng nh ni mx b">canActivate</code>方法将在呈现页面之前检查当前用户是否已经过身份验证，并返回一个布尔响应。如果为真，则允许用户查看受保护的页面，否则不会。</p><p id="f0b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了完成我们的设置，我们需要一个AuthService，它包含实际检查用户是否拥有有效会话的功能。运行以下CLI命令来生成服务文件。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="e5b3" class="nb ma iq mx b gy nc nd l ne nf">ng g service auth/auth</span></pre><p id="f81c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">打开创建的<code class="fe ng nh ni mx b">auth/auth.service.ts</code>文件并添加以下代码。我们在上面的<code class="fe ng nh ni mx b">canActivate</code> route guard中使用了<code class="fe ng nh ni mx b">isLogged</code>函数，来确定当前用户是否拥有有效的会话，</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="9c03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样，打开<code class="fe ng nh ni mx b">app-routing.module.ts</code>并将<code class="fe ng nh ni mx b">AuthService</code>添加到<code class="fe ng nh ni mx b">providers</code>数组中。</p><pre class="kg kh ki kj gt mw mx my mz aw na bi"><span id="f5d0" class="nb ma iq mx b gy nc nd l ne nf">import { AuthService } from './auth/auth.service';<br/>.<br/>.<br/>.<br/>@NgModule({<br/>  imports: [RouterModule.forRoot(routes)],<br/>  exports: [RouterModule],<br/>  providers: [AuthService]<br/>})</span></pre><h1 id="b337" class="lz ma iq bd mb mc of me mf mg og mi mj jw oh jx ml jz oi ka mn kc oj kd mp mq bi translated">检查它是否工作…</h1><p id="0cc0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们已经在Angular应用程序中完成了Cognito身份验证的开发，现在是时候测试我们的实现了。尝试使用有效的电子邮件地址注册，然后登录。如果一切正常，您应该能够在没有经过身份验证的情况下访问仪表板。</p><blockquote class="nv nw nx"><p id="4816" class="kw kx ny ky b kz la jr lb lc ld ju le nz lg lh li oa lk ll lm ob lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong>请记住，在尝试登录之前，必须确认注册用户。我没有在本教程中实现它，因为它会使这篇文章变得更长，所以我把它留给你去尝试，但是添加它非常简单。您可以使用<code class="fe ng nh ni mx b">amazon-cognito-identity-js</code>提供的<code class="fe ng nh ni mx b">confirmRegistration</code>功能以编程方式确认用户(最可行和可靠的方式)，或者通过Cognito用户池仪表板手动确认用户(只是为了快速测试/演示)。</p></blockquote></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="4486" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，我们学习了如何将AWS Cognito身份验证添加到Angular应用程序中。如果你遇到任何困难，请在回复中告诉我。另外，您可以参考Github上本教程的示例应用程序。</p><div class="ok ol gp gr om on"><a href="https://github.com/pavinduLakshan/angular-aws-cognito-auth-demo" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">GitHub-pavinduLakshan/Angular-AWS-cogni to-auth-demo:带有AWS Cognito的示例角度应用程序…</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">此项目是使用Angular CLI版本12.1.2生成的。为开发服务器运行ng serve。导航到…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">github.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb kp on"/></div></div></a></div><p id="6071" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢你阅读❤️</p><p id="f779" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ny">更多内容看</em><strong class="ky ir"><em class="ny"/></strong><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ny">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>