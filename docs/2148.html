<html>
<head>
<title>10 Useful Custom React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">10个有用的自定义反应挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/10-useful-custom-react-hooks-f24f4307524b?source=collection_archive---------1-----------------------#2021-05-06">https://javascript.plainenglish.io/10-useful-custom-react-hooks-f24f4307524b?source=collection_archive---------1-----------------------#2021-05-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/19d1f5a9ae67fd4b84b1ff7e264d6039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*63sdnwLxqdcNA2Yy"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@freys?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Freysteinn G. Jonsson</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3eee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你了解他们，喜欢他们，没错，我说的是反应钩。它们是最有用和可重用的代码片段。我想你可以说我上瘾了。</p><p id="fee9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但并不是所有的钩子都是一样的。基本的经常使用，通常能完成工作。但有时需要额外的工具，这里是我遇到的10个有用的自定义React挂钩。</p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="a9aa" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1.使用窗口大小</h1><p id="7728" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我不能夸大响应式UI的重要性，我也不会去尝试。如果你正在读这篇文章，你可能已经知道了响应式设计的痛苦。</p><p id="a3e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">幸运的是，我们有这个挂钩，让我们的生活更轻松。我从一个叫react-use的回购中找到了这个版本。我喜欢这个库，这里包含的大部分钩子都来源于它。</p><div class="ml mm gp gr mn mo"><a href="https://github.com/streamich/react-use" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">stream ich/react-使用</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">反应钩-👍。通过在GitHub上创建帐户，为streamich/react-use开发做出贡献。</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc jw mo"/></div></div></a></div><p id="28b1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">代码如下:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="aca1" class="nm lj iq ni b gy nn no l np nq">import { useEffect } from 'react';</span><span id="ae04" class="nm lj iq ni b gy nr no l np nq">import useRafState from './useRafState';</span><span id="2f0d" class="nm lj iq ni b gy nr no l np nq">import { isBrowser, off, on } from './misc/util';</span><span id="d51b" class="nm lj iq ni b gy nr no l np nq">const useWindowSize = (initialWidth = Infinity, initialHeight = Infinity) =&gt; {</span><span id="1960" class="nm lj iq ni b gy nr no l np nq">const [state, setState] = useRafState&lt;{ width: number; height: number }&gt;({</span><span id="e33d" class="nm lj iq ni b gy nr no l np nq">width: isBrowser ? window.innerWidth : initialWidth,</span><span id="967f" class="nm lj iq ni b gy nr no l np nq">height: isBrowser ? window.innerHeight : initialHeight,</span><span id="c97a" class="nm lj iq ni b gy nr no l np nq">});</span><span id="adc7" class="nm lj iq ni b gy nr no l np nq">useEffect((): (() =&gt; void) | void =&gt; {</span><span id="8fc4" class="nm lj iq ni b gy nr no l np nq">if (isBrowser) {</span><span id="8b53" class="nm lj iq ni b gy nr no l np nq">const handler = () =&gt; {</span><span id="7b3c" class="nm lj iq ni b gy nr no l np nq">setState({</span><span id="cd09" class="nm lj iq ni b gy nr no l np nq">width: window.innerWidth,</span><span id="84f3" class="nm lj iq ni b gy nr no l np nq">height: window.innerHeight,</span><span id="bbb6" class="nm lj iq ni b gy nr no l np nq">});</span><span id="3c59" class="nm lj iq ni b gy nr no l np nq">};</span><span id="5ed0" class="nm lj iq ni b gy nr no l np nq">on(window, 'resize', handler);</span><span id="eeee" class="nm lj iq ni b gy nr no l np nq">return () =&gt; {</span><span id="0b61" class="nm lj iq ni b gy nr no l np nq">off(window, 'resize', handler);</span><span id="dbac" class="nm lj iq ni b gy nr no l np nq">};</span><span id="4e6b" class="nm lj iq ni b gy nr no l np nq">}</span><span id="cfdc" class="nm lj iq ni b gy nr no l np nq">}, []);</span><span id="b2b6" class="nm lj iq ni b gy nr no l np nq">return state;</span><span id="e5c3" class="nm lj iq ni b gy nr no l np nq">};</span><span id="c477" class="nm lj iq ni b gy nr no l np nq">export default useWindowSize;</span></pre><p id="e93c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ns">其中一些挂钩使用react use repo的misc/utilities文件夹中包含的工具。但是如果你不想安装完整的库的话，这其中的逻辑相当简单。</em></p></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="cfb1" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2.使用点击方式</h1><p id="e838" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">你是否曾经需要在事情失去焦点后放弃它？当然，你有！但是追踪点击状态可能会很烦人。这个钩子可以保护你。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d14d" class="nm lj iq ni b gy nn no l np nq">import { RefObject, useEffect } from 'react'</span><span id="aa70" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> EVENTS = ['mousedown', 'touchstart']</span><span id="9522" class="nm lj iq ni b gy nr no l np nq">export <em class="ns">type</em> OnClickAwayFunc = (event: Event) <em class="ns">=&gt;</em> void</span><span id="d324" class="nm lj iq ni b gy nr no l np nq">export <em class="ns">const</em> useClickAway = (refs: Array&lt;RefObject&lt;HTMLElement | null&gt;&gt;, onClickAway?: OnClickAwayFunc): void <em class="ns">=&gt;</em> {</span><span id="9e6a" class="nm lj iq ni b gy nr no l np nq">useEffect(() <em class="ns">=&gt;</em> {</span><span id="fbb4" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> handler = (event): void <em class="ns">=&gt;</em> {</span><span id="eda6" class="nm lj iq ni b gy nr no l np nq">if (onClickAway) {</span><span id="4ac6" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> isClickAway = <em class="ns">refs</em>.every((ref) <em class="ns">=&gt;</em> {</span><span id="c846" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> { current: el } = ref</span><span id="c734" class="nm lj iq ni b gy nr no l np nq">return el &amp;&amp; !<em class="ns">el</em>.contains(<em class="ns">event</em>.target)</span><span id="b355" class="nm lj iq ni b gy nr no l np nq">})</span><span id="8e3a" class="nm lj iq ni b gy nr no l np nq">isClickAway &amp;&amp; onClickAway(event)</span><span id="e8ba" class="nm lj iq ni b gy nr no l np nq">}</span><span id="1385" class="nm lj iq ni b gy nr no l np nq">}</span><span id="9f66" class="nm lj iq ni b gy nr no l np nq">if (onClickAway) {</span><span id="295e" class="nm lj iq ni b gy nr no l np nq">for (<em class="ns">const</em> eventName of EVENTS) {</span><span id="9289" class="nm lj iq ni b gy nr no l np nq"><em class="ns">document</em>.addEventListener(eventName, handler)</span><span id="5afb" class="nm lj iq ni b gy nr no l np nq">}</span><span id="fbb9" class="nm lj iq ni b gy nr no l np nq">}</span><span id="f87f" class="nm lj iq ni b gy nr no l np nq">return (): void <em class="ns">=&gt;</em> {</span><span id="5339" class="nm lj iq ni b gy nr no l np nq">if (onClickAway) {</span><span id="518b" class="nm lj iq ni b gy nr no l np nq">for (<em class="ns">const</em> eventName of EVENTS) {</span><span id="5c47" class="nm lj iq ni b gy nr no l np nq"><em class="ns">document</em>.removeEventListener(eventName, handler)</span><span id="c468" class="nm lj iq ni b gy nr no l np nq">}</span><span id="e183" class="nm lj iq ni b gy nr no l np nq">}</span><span id="7e2a" class="nm lj iq ni b gy nr no l np nq">}</span><span id="4e8a" class="nm lj iq ni b gy nr no l np nq">}, [onClickAway, refs])</span><span id="7343" class="nm lj iq ni b gy nr no l np nq">}</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="8609" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3.使用反跳</h1><p id="ec46" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">用户可能会变得不耐烦，或者只是工作速度超过了UI输入需要处理的速度。在这种情况下我们该怎么办？</p><p id="f040" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们一直等到输入停止，然后只运行对我们函数的最后一次调用，简而言之就是去抖。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="7001" class="nm lj iq ni b gy nn no l np nq">import { DependencyList, useEffect } from 'react';</span><span id="2bfc" class="nm lj iq ni b gy nr no l np nq">import useTimeoutFn from './useTimeoutFn';</span><span id="d3cd" class="nm lj iq ni b gy nr no l np nq">export type UseDebounceReturn = [() =&gt; boolean | null, () =&gt; void];</span><span id="6a8c" class="nm lj iq ni b gy nr no l np nq">export default function useDebounce(</span><span id="4816" class="nm lj iq ni b gy nr no l np nq">fn: Function,</span><span id="9c32" class="nm lj iq ni b gy nr no l np nq">ms: number = 0,</span><span id="3c95" class="nm lj iq ni b gy nr no l np nq">deps: DependencyList = []</span><span id="572e" class="nm lj iq ni b gy nr no l np nq">): UseDebounceReturn {</span><span id="f9f8" class="nm lj iq ni b gy nr no l np nq">const [isReady, cancel, reset] = useTimeoutFn(fn, ms);</span><span id="13f0" class="nm lj iq ni b gy nr no l np nq">useEffect(reset, deps);</span><span id="7bc2" class="nm lj iq ni b gy nr no l np nq">return [isReady, cancel];</span><span id="fb9b" class="nm lj iq ni b gy nr no l np nq">}</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="7560" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">4.使用方向</h1><p id="4bab" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">跟踪屏幕方向的逻辑可能会令人迷惑，但是我们仍然需要知道它是什么，这样我们就可以相应地更新我们的UI。抛开所有的双关语，下面是一些代码:</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="ca77" class="nm lj iq ni b gy nn no l np nq">import { useEffect, useState } from 'react';</span><span id="ffc3" class="nm lj iq ni b gy nr no l np nq">import { off, on } from './misc/util';</span><span id="6258" class="nm lj iq ni b gy nr no l np nq">export interface OrientationState {</span><span id="4a9d" class="nm lj iq ni b gy nr no l np nq">angle: number;</span><span id="c785" class="nm lj iq ni b gy nr no l np nq">type: string;</span><span id="59ae" class="nm lj iq ni b gy nr no l np nq">}</span><span id="1881" class="nm lj iq ni b gy nr no l np nq">const defaultState: OrientationState = {</span><span id="4364" class="nm lj iq ni b gy nr no l np nq">angle: 0,</span><span id="fd13" class="nm lj iq ni b gy nr no l np nq">type: 'landscape-primary',</span><span id="57f3" class="nm lj iq ni b gy nr no l np nq">};</span><span id="d798" class="nm lj iq ni b gy nr no l np nq">const useOrientation = (initialState: OrientationState = defaultState) =&gt; {</span><span id="a1a3" class="nm lj iq ni b gy nr no l np nq">const [state, setState] = useState(initialState);</span><span id="cef3" class="nm lj iq ni b gy nr no l np nq">useEffect(() =&gt; {</span><span id="da8b" class="nm lj iq ni b gy nr no l np nq">const screen = window.screen;</span><span id="3933" class="nm lj iq ni b gy nr no l np nq">let mounted = true;</span><span id="c374" class="nm lj iq ni b gy nr no l np nq">const onChange = () =&gt; {</span><span id="12d8" class="nm lj iq ni b gy nr no l np nq">if (mounted) {</span><span id="666c" class="nm lj iq ni b gy nr no l np nq">const { orientation } = screen as any;</span><span id="f69b" class="nm lj iq ni b gy nr no l np nq">if (orientation) {</span><span id="47af" class="nm lj iq ni b gy nr no l np nq">const { angle, type } = orientation;</span><span id="c65f" class="nm lj iq ni b gy nr no l np nq">setState({ angle, type });</span><span id="a12e" class="nm lj iq ni b gy nr no l np nq">} else if (window.orientation !== undefined) {</span><span id="79df" class="nm lj iq ni b gy nr no l np nq">setState({</span><span id="b085" class="nm lj iq ni b gy nr no l np nq">angle: typeof window.orientation === 'number' ? window.orientation : 0,</span><span id="472c" class="nm lj iq ni b gy nr no l np nq">type: '',</span><span id="9099" class="nm lj iq ni b gy nr no l np nq">});</span><span id="f4f7" class="nm lj iq ni b gy nr no l np nq">} else {</span><span id="f580" class="nm lj iq ni b gy nr no l np nq">setState(initialState);</span><span id="14f7" class="nm lj iq ni b gy nr no l np nq">}</span><span id="e8b4" class="nm lj iq ni b gy nr no l np nq">}</span><span id="d695" class="nm lj iq ni b gy nr no l np nq">};</span><span id="143f" class="nm lj iq ni b gy nr no l np nq">on(window, 'orientationchange', onChange);</span><span id="2cb6" class="nm lj iq ni b gy nr no l np nq">onChange();</span><span id="9b21" class="nm lj iq ni b gy nr no l np nq">return () =&gt; {</span><span id="6104" class="nm lj iq ni b gy nr no l np nq">mounted = false;</span><span id="1384" class="nm lj iq ni b gy nr no l np nq">off(window, 'orientationchange', onChange);</span><span id="9f74" class="nm lj iq ni b gy nr no l np nq">};</span><span id="8aea" class="nm lj iq ni b gy nr no l np nq">}, []);</span><span id="bfcc" class="nm lj iq ni b gy nr no l np nq">return state;</span><span id="588f" class="nm lj iq ni b gy nr no l np nq">};</span><span id="f7e6" class="nm lj iq ni b gy nr no l np nq">export default useOrientation;</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="2a73" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">5.使用更新</h1><p id="9aad" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">通常我们想让react决定何时或者是否重新渲染组件。但有时我们可能想在这种情况下手动触发重新渲染。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="d2a7" class="nm lj iq ni b gy nn no l np nq">import { useReducer } from 'react';</span><span id="952c" class="nm lj iq ni b gy nr no l np nq">const updateReducer = (num: number): number =&gt; (num + 1) % 1_000_000;</span><span id="e157" class="nm lj iq ni b gy nr no l np nq">export default function useUpdate(): () =&gt; void {</span><span id="86c5" class="nm lj iq ni b gy nr no l np nq">const [, update] = useReducer(updateReducer, 0);</span><span id="e264" class="nm lj iq ni b gy nr no l np nq">return update;</span><span id="f01e" class="nm lj iq ni b gy nr no l np nq">}</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="3f8e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">6.使用大小观察者</h1><p id="f2e3" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我已经介绍了窗口大小的检测，但是有时候您需要知道一个元素的具体大小。</p><p id="26f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当对元素大小的引用发生变化时，这个钩子将允许您发出回调，并允许您访问该大小。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="132b" class="nm lj iq ni b gy nn no l np nq">import { useEffect } from 'react'</span><span id="22c9" class="nm lj iq ni b gy nr no l np nq">export <em class="ns">type</em> SizeObserverCallbackFunc = (contentSize: { height: number; width: number }) <em class="ns">=&gt;</em> void | Promise&lt;void&gt;</span><span id="ec74" class="nm lj iq ni b gy nr no l np nq">export <em class="ns">function</em> useSizeObserver(callback: SizeObserverCallbackFunc, element?: HTMLElement | null): void {</span><span id="90fa" class="nm lj iq ni b gy nr no l np nq">useEffect(() <em class="ns">=&gt;</em> {</span><span id="e76e" class="nm lj iq ni b gy nr no l np nq">if (!element) {</span><span id="0be4" class="nm lj iq ni b gy nr no l np nq">return</span><span id="ff46" class="nm lj iq ni b gy nr no l np nq">}</span><span id="cdc8" class="nm lj iq ni b gy nr no l np nq"><em class="ns">// Always execute the callback function when it has changed</em></span><span id="90df" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> rect = <em class="ns">element</em>.getBoundingClientRect()</span><span id="2006" class="nm lj iq ni b gy nr no l np nq">callback({</span><span id="0f83" class="nm lj iq ni b gy nr no l np nq">height: <em class="ns">rect</em>.height,</span><span id="e6a9" class="nm lj iq ni b gy nr no l np nq">width: <em class="ns">rect</em>.width</span><span id="b674" class="nm lj iq ni b gy nr no l np nq">})</span><span id="e6ec" class="nm lj iq ni b gy nr no l np nq"><em class="ns">/* As of the Safari 13.1 release in March 2020, ResizeObserver is now</em></span><span id="0639" class="nm lj iq ni b gy nr no l np nq"><em class="ns">supported by all major browser (Chrome, Firefox, Safari and Edge). We</em></span><span id="dad2" class="nm lj iq ni b gy nr no l np nq"><em class="ns">will observe the parent element of the canvas and run the callback</em></span><span id="8a04" class="nm lj iq ni b gy nr no l np nq"><em class="ns">function whenever the parent element is resized. As a fallback in-case</em></span><span id="49b4" class="nm lj iq ni b gy nr no l np nq"><em class="ns">ResizeObserver is not supported, we will fallback to listening for a</em></span><span id="123a" class="nm lj iq ni b gy nr no l np nq"><em class="ns">resize event on the window. */</em></span><span id="343c" class="nm lj iq ni b gy nr no l np nq">if (<em class="ns">window</em>.ResizeObserver) {</span><span id="82d9" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> observer = new <em class="ns">window</em>.ResizeObserver((entries) <em class="ns">=&gt;</em> {</span><span id="5c44" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> entry = entries[0]</span><span id="162d" class="nm lj iq ni b gy nr no l np nq">if (entry) {</span><span id="af8a" class="nm lj iq ni b gy nr no l np nq">callback({</span><span id="25e8" class="nm lj iq ni b gy nr no l np nq">height: <em class="ns">entry</em>.<em class="ns">contentRect</em>.height,</span><span id="b8e9" class="nm lj iq ni b gy nr no l np nq">width: <em class="ns">entry</em>.<em class="ns">contentRect</em>.width</span><span id="7b18" class="nm lj iq ni b gy nr no l np nq">})</span><span id="df23" class="nm lj iq ni b gy nr no l np nq">}</span><span id="8500" class="nm lj iq ni b gy nr no l np nq">})</span><span id="0985" class="nm lj iq ni b gy nr no l np nq"><em class="ns">observer</em>.observe(element)</span><span id="485a" class="nm lj iq ni b gy nr no l np nq">return (): void <em class="ns">=&gt;</em> {</span><span id="ba56" class="nm lj iq ni b gy nr no l np nq"><em class="ns">observer</em>.disconnect()</span><span id="be14" class="nm lj iq ni b gy nr no l np nq">}</span><span id="55ee" class="nm lj iq ni b gy nr no l np nq">} else {</span><span id="cabd" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> resizeHandler = (): void <em class="ns">=&gt;</em> {</span><span id="3517" class="nm lj iq ni b gy nr no l np nq"><em class="ns">const</em> clientRect = <em class="ns">element</em>.getBoundingClientRect()</span><span id="a804" class="nm lj iq ni b gy nr no l np nq">callback({</span><span id="e738" class="nm lj iq ni b gy nr no l np nq">height: <em class="ns">clientRect</em>.height,</span><span id="0e42" class="nm lj iq ni b gy nr no l np nq">width: <em class="ns">clientRect</em>.width</span><span id="94c8" class="nm lj iq ni b gy nr no l np nq">})</span><span id="bc9f" class="nm lj iq ni b gy nr no l np nq">}</span><span id="13c8" class="nm lj iq ni b gy nr no l np nq"><em class="ns">window</em>.addEventListener('resize', resizeHandler)</span><span id="5c12" class="nm lj iq ni b gy nr no l np nq">return (): void <em class="ns">=&gt;</em> {</span><span id="09e5" class="nm lj iq ni b gy nr no l np nq"><em class="ns">window</em>.removeEventListener('resize', resizeHandler)</span><span id="b664" class="nm lj iq ni b gy nr no l np nq">}</span><span id="e284" class="nm lj iq ni b gy nr no l np nq">}</span><span id="a355" class="nm lj iq ni b gy nr no l np nq">}, [callback, element])</span><span id="74db" class="nm lj iq ni b gy nr no l np nq">}</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="1ec8" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">7.使用Cookie</h1><p id="984b" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">Nom，nom，nom如果没有下一个钩子，你就不会想要管理cookies。现在，使用cookies进行站点跟踪和认证已经成为一种常见的做法，但是在react中这样做可能会很麻烦。不要做饼干怪兽；用这个钩子代替。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="aa5d" class="nm lj iq ni b gy nn no l np nq">import { useCallback, useState } from 'react';</span><span id="ecd4" class="nm lj iq ni b gy nr no l np nq">import Cookies from 'js-cookie';</span><span id="c298" class="nm lj iq ni b gy nr no l np nq">const useCookie = (</span><span id="610b" class="nm lj iq ni b gy nr no l np nq">cookieName: string</span><span id="68d9" class="nm lj iq ni b gy nr no l np nq">): [string | null, (newValue: string, options?: Cookies.CookieAttributes) =&gt; void, () =&gt; void] =&gt; {</span><span id="3b1b" class="nm lj iq ni b gy nr no l np nq">const [value, setValue] = useState&lt;string | null&gt;(() =&gt; Cookies.get(cookieName) || null);</span><span id="4ce5" class="nm lj iq ni b gy nr no l np nq">const updateCookie = useCallback(</span><span id="c833" class="nm lj iq ni b gy nr no l np nq">(newValue: string, options?: Cookies.CookieAttributes) =&gt; {</span><span id="f2da" class="nm lj iq ni b gy nr no l np nq">Cookies.set(cookieName, newValue, options);</span><span id="87cf" class="nm lj iq ni b gy nr no l np nq">setValue(newValue);</span><span id="6829" class="nm lj iq ni b gy nr no l np nq">},</span><span id="8067" class="nm lj iq ni b gy nr no l np nq">[cookieName]</span><span id="8cd4" class="nm lj iq ni b gy nr no l np nq">);</span><span id="cf62" class="nm lj iq ni b gy nr no l np nq">const deleteCookie = useCallback(() =&gt; {</span><span id="577e" class="nm lj iq ni b gy nr no l np nq">Cookies.remove(cookieName);</span><span id="2f62" class="nm lj iq ni b gy nr no l np nq">setValue(null);</span><span id="8d98" class="nm lj iq ni b gy nr no l np nq">}, [cookieName]);</span><span id="6711" class="nm lj iq ni b gy nr no l np nq">return [value, updateCookie, deleteCookie];</span><span id="cfdd" class="nm lj iq ni b gy nr no l np nq">};</span><span id="4164" class="nm lj iq ni b gy nr no l np nq">export default useCookie;</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="76e2" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">8.使用页面离开</h1><p id="30c2" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">我不想成为那样的人，但是弹出窗口在网页设计中有一席之地。这是这个钩子的主要用例。我相信如果你有创意的话，还有其他的应用。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="2e9c" class="nm lj iq ni b gy nn no l np nq">import { useEffect } from 'react';</span><span id="2c29" class="nm lj iq ni b gy nr no l np nq">import { off, on } from './misc/util';</span><span id="a85d" class="nm lj iq ni b gy nr no l np nq">const usePageLeave = (onPageLeave, args = []) =&gt; {</span><span id="bfe9" class="nm lj iq ni b gy nr no l np nq">useEffect(() =&gt; {</span><span id="e385" class="nm lj iq ni b gy nr no l np nq">if (!onPageLeave) {</span><span id="d152" class="nm lj iq ni b gy nr no l np nq">return;</span><span id="aeaa" class="nm lj iq ni b gy nr no l np nq">}</span><span id="31fc" class="nm lj iq ni b gy nr no l np nq">const handler = (event) =&gt; {</span><span id="d6b0" class="nm lj iq ni b gy nr no l np nq">event = event ? event : (window.event as any);</span><span id="89a6" class="nm lj iq ni b gy nr no l np nq">const from = event.relatedTarget || event.toElement;</span><span id="84e8" class="nm lj iq ni b gy nr no l np nq">if (!from || (from as any).nodeName === 'HTML') {</span><span id="6a47" class="nm lj iq ni b gy nr no l np nq">onPageLeave();</span><span id="a294" class="nm lj iq ni b gy nr no l np nq">}</span><span id="252d" class="nm lj iq ni b gy nr no l np nq">};</span><span id="b4dd" class="nm lj iq ni b gy nr no l np nq">on(document, 'mouseout', handler);</span><span id="473a" class="nm lj iq ni b gy nr no l np nq">return () =&gt; {</span><span id="b738" class="nm lj iq ni b gy nr no l np nq">off(document, 'mouseout', handler);</span><span id="9946" class="nm lj iq ni b gy nr no l np nq">};</span><span id="5f5a" class="nm lj iq ni b gy nr no l np nq">}, args);</span><span id="eb88" class="nm lj iq ni b gy nr no l np nq">};</span><span id="c7d4" class="nm lj iq ni b gy nr no l np nq">export default usePageLeave;</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="4a80" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">9.使用CSS</h1><p id="8df5" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">如果你遵循CSS和响应样式惯例，你很可能不需要这一个，但无论如何它值得一提。</p><p id="958a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个钩子将允许你动态地使用CSS，并且只会重新呈现变化的CSS，肯定非常时髦。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="76ac" class="nm lj iq ni b gy nn no l np nq">import { create, NanoRenderer } from 'nano-css';</span><span id="b3e4" class="nm lj iq ni b gy nr no l np nq">import { addon as addonCSSOM, CSSOMAddon } from 'nano-css/addon/cssom';</span><span id="9b45" class="nm lj iq ni b gy nr no l np nq">import { addon as addonVCSSOM, VCSSOMAddon } from 'nano-css/addon/vcssom';</span><span id="d171" class="nm lj iq ni b gy nr no l np nq">import { cssToTree } from 'nano-css/addon/vcssom/cssToTree';</span><span id="68a9" class="nm lj iq ni b gy nr no l np nq">import { useMemo } from 'react';</span><span id="e9fc" class="nm lj iq ni b gy nr no l np nq">import useIsomorphicLayoutEffect from './useIsomorphicLayoutEffect';</span><span id="7734" class="nm lj iq ni b gy nr no l np nq">type Nano = NanoRenderer &amp; CSSOMAddon &amp; VCSSOMAddon;</span><span id="0715" class="nm lj iq ni b gy nr no l np nq">const nano = create() as Nano;</span><span id="58ac" class="nm lj iq ni b gy nr no l np nq">addonCSSOM(nano);</span><span id="7530" class="nm lj iq ni b gy nr no l np nq">addonVCSSOM(nano);</span><span id="e58a" class="nm lj iq ni b gy nr no l np nq">let counter = 0;</span><span id="1f3a" class="nm lj iq ni b gy nr no l np nq">const useCss = (css: object): string =&gt; {</span><span id="c5c1" class="nm lj iq ni b gy nr no l np nq">const className = useMemo(() =&gt; 'react-use-css-' + (counter++).toString(36), []);</span><span id="18f3" class="nm lj iq ni b gy nr no l np nq">const sheet = useMemo(() =&gt; new nano.VSheet(), []);</span><span id="3619" class="nm lj iq ni b gy nr no l np nq">useIsomorphicLayoutEffect(() =&gt; {</span><span id="3935" class="nm lj iq ni b gy nr no l np nq">const tree = {};</span><span id="5ab1" class="nm lj iq ni b gy nr no l np nq">cssToTree(tree, css, '.' + className, '');</span><span id="707d" class="nm lj iq ni b gy nr no l np nq">sheet.diff(tree);</span><span id="4ad3" class="nm lj iq ni b gy nr no l np nq">return () =&gt; {</span><span id="5464" class="nm lj iq ni b gy nr no l np nq">sheet.diff({});</span><span id="3978" class="nm lj iq ni b gy nr no l np nq">};</span><span id="5e4c" class="nm lj iq ni b gy nr no l np nq">});</span><span id="8114" class="nm lj iq ni b gy nr no l np nq">return className;</span><span id="b290" class="nm lj iq ni b gy nr no l np nq">};</span><span id="a7d6" class="nm lj iq ni b gy nr no l np nq">export default useCss;</span></pre><p id="0da3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个使用了Streamich的另一个库，你可以在这里查看:</p><div class="ml mm gp gr mn mo"><a href="https://github.com/streamich/nano-css" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">stream ich/纳米css</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">微型第五代CSS-in-JS库，您可以在生产中实际使用。纳米css的座右铭很简单:创造…</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="nt l mz na nb mx nc jw mo"/></div></div></a></div></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="57f5" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">10.使用承诺</h1><p id="8e09" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">乍一看，这可能看起来很奇怪，但是有很多次我不得不将异步代码放入use-effect中。</p><p id="fe71" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这些情况下，管理状态和确定事件的顺序会变得很棘手。</p><p id="2485" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个钩子很好，因为任何承诺都可以包装在它提供的帮助函数中。您的承诺将准备就绪，并在执行前等待组件安装。</p><pre class="nd ne nf ng gt nh ni nj nk aw nl bi"><span id="3d4f" class="nm lj iq ni b gy nn no l np nq">import { useCallback } from 'react';</span><span id="dc2d" class="nm lj iq ni b gy nr no l np nq">import useMountedState from './useMountedState';</span><span id="4e68" class="nm lj iq ni b gy nr no l np nq">export type UsePromise = () =&gt; &lt;T&gt;(promise: Promise&lt;T&gt;) =&gt; Promise&lt;T&gt;;</span><span id="9592" class="nm lj iq ni b gy nr no l np nq">const usePromise: UsePromise = () =&gt; {</span><span id="227b" class="nm lj iq ni b gy nr no l np nq">const isMounted = useMountedState();</span><span id="5d9f" class="nm lj iq ni b gy nr no l np nq">return useCallback(</span><span id="d773" class="nm lj iq ni b gy nr no l np nq">(promise: Promise&lt;any&gt;) =&gt;</span><span id="1e2d" class="nm lj iq ni b gy nr no l np nq">new Promise&lt;any&gt;((resolve, reject) =&gt; {</span><span id="fa25" class="nm lj iq ni b gy nr no l np nq">const onValue = (value) =&gt; {</span><span id="7da6" class="nm lj iq ni b gy nr no l np nq">isMounted() &amp;&amp; resolve(value);</span><span id="9980" class="nm lj iq ni b gy nr no l np nq">};</span><span id="6721" class="nm lj iq ni b gy nr no l np nq">const onError = (error) =&gt; {</span><span id="dd2d" class="nm lj iq ni b gy nr no l np nq">isMounted() &amp;&amp; reject(error);</span><span id="0fbc" class="nm lj iq ni b gy nr no l np nq">};</span><span id="113a" class="nm lj iq ni b gy nr no l np nq">promise.then(onValue, onError);</span><span id="c6a7" class="nm lj iq ni b gy nr no l np nq">}),</span><span id="0587" class="nm lj iq ni b gy nr no l np nq">[]</span><span id="ae4b" class="nm lj iq ni b gy nr no l np nq">);</span><span id="0559" class="nm lj iq ni b gy nr no l np nq">};</span><span id="16ea" class="nm lj iq ni b gy nr no l np nq">export default usePromise;</span></pre></div><div class="ab cl lb lc hu ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ij ik il im in"><h1 id="40f0" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">结论</h1><p id="721a" class="pw-post-body-paragraph kd ke iq kf b kg mg ki kj kk mh km kn ko mi kq kr ks mj ku kv kw mk ky kz la ij bi translated">这就是我遇到的10个有用的定制反应挂钩。其中许多足够通用，至少可以使用一次，还有一些比较特殊。不管怎样，这个列表展示了自定义React钩子的能力和潜力。感谢您的阅读！</p><p id="94b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以在Twitter上关注我更多:<a class="ae kc" href="https://twitter.com/Not_TheAuthor" rel="noopener ugc nofollow" target="_blank"> @Not_TheAuthor </a></p><p id="f3e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ns">更多内容尽在</em><a class="ae kc" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="ns">plain English . io</em></strong></a></p></div></div>    
</body>
</html>