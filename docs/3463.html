<html>
<head>
<title>Global State Using Only React Hooks with the Context API (TypeScript Edition)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">仅使用带有上下文API的React挂钩的全局状态(TypeScript版)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/global-state-using-only-react-hooks-with-the-context-api-typescript-edition-ada822fc282c?source=collection_archive---------3-----------------------#2021-07-13">https://javascript.plainenglish.io/global-state-using-only-react-hooks-with-the-context-api-typescript-edition-ada822fc282c?source=collection_archive---------3-----------------------#2021-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jn jo jp jq gh gi paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="gh gi ca"><img src="../Images/315a174edd267fadd21fc77748febbaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QnAH6aY7H2IGCS30CX-rxg.png"/></div></div></figure><blockquote class="jx"><p id="f99b" class="jy jz iq bd ka kb kc kd ke kf kg kh dk translated">距离我最近的<a class="ae ki" href="https://codeburst.io/global-state-with-react-hooks-and-context-api-87019cc4f2cf" rel="noopener" target="_blank">全局状态只使用React钩子和上下文API(无Redux) </a>的故事已经有一段时间了。现在是时候推出TypeScript版本，以及持久会话/本地存储机制了。</p></blockquote><p id="f889" class="pw-post-body-paragraph kj kk iq kl b km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf kh ij bi translated">如果你读过我以前的故事，你应该已经知道，当谈到前端框架和工具时，我更喜欢少即是多的方法。做一件事有很多选择，很多方法，太多了，我们淹没在解决方案和臃肿问题的海洋中已经不是什么秘密了。但是我不会侮辱你最喜欢的npm库。我更感兴趣的是谈论你能用它做多少事情。让我们开始吧！</p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="0f37" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">1.🟦准备类型</h1><p id="2dbf" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">因为我们这次引入了TypeScript。我们必须为reducer函数、状态和上下文提供者声明类型。调度类型定义是从React导入的。</p><figure class="mu mv mw mx gt jq"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="5ccb" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">1.减速器⚛️. ts</h1><p id="4429" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">我们创建一个reducer函数，这个函数与React自己的钩子:<code class="fe lg lh li lj b">useReducer()</code>协同工作。<strong class="kl ir"> </strong>我们为状态和动作提供类型。</p><figure class="mu mv mw mx gt jq"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bea0" class="pw-post-body-paragraph kj kk iq kl b km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf kh ij bi translated">假设我们已经熟悉Redux，在上面的代码片段中有一个reducer函数，它将状态和动作作为参数，用于访问和管理应用程序的全局状态。</p><h1 id="4fbd" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">✨的奖金部分</h1><h1 id="230f" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">数据持久性</h1><p id="26e0" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">store模块组件这次有一个机制来将数据持久存储在浏览器的<code class="fe lg lh li lj b"><a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage" rel="noopener ugc nofollow" target="_blank">window.localStorage</a></code>和<code class="fe lg lh li lj b"><a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage" rel="noopener ugc nofollow" target="_blank">window.sessionStorage</a></code>对象中。这可以在示例应用程序中得到更好的演示🔗<a class="ae ki" href="https://amir0ff.github.io/movie-lab/#/login" rel="noopener ugc nofollow" target="_blank"> <em class="nk">登录</em> </a>页面。在浏览器中打开开发工具，然后在登录表单下的本地/会话存储选项之间切换。导航到应用程序选项卡，观察状态变化。</p><h1 id="3a57" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">2.🗄️全球商店</h1><p id="a44c" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">为了创建一个全球性的国家，我们需要一个中央商店。存储是保存上下文(状态)的高阶组件(HOC)。我们提供了上下文的类型，即我们在第一步中创建的状态。此外，GlobalStore组件及其嵌套的<code class="fe lg lh li lj b">children</code>是React自己的类型定义中带有<code class="fe lg lh li lj b">ReactNode</code>和<code class="fe lg lh li lj b">ReactElement</code>的类型。</p><figure class="mu mv mw mx gt jq"><div class="bz fp l di"><div class="my mz l"/></div></figure><ul class=""><li id="fb74" class="nl nm iq kl b km nf kq ng ku nn ky no lc np kh nq nr ns nt bi translated">💡在第10行，我们提供了一个状态初始化函数和一个reducer函数来将React的<code class="fe lg lh li lj b">useReducer()</code> <strong class="kl ir"> </strong>作为参数。<code class="fe lg lh li lj b">globalState</code>值指向状态对象，<code class="fe lg lh li lj b">dispatch</code>方法是reducer函数，它通过调度操作管理状态。</li><li id="f76b" class="nl nm iq kl b km nu kq nv ku nw ky nx lc ny kh nq nr ns nt bi translated">💡在第47行，我们向上下文提供了状态和分派方法。</li><li id="d549" class="nl nm iq kl b km nu kq nv ku nw ky nx lc ny kh nq nr ns nt bi translated">💡在第50行，使用React的<code class="fe lg lh li lj b">createContext()</code>钩子创建上下文。我们提供类型<code class="fe lg lh li lj b">ContextType</code>。</li></ul><figure class="mu mv mw mx gt jq"><div class="bz fp l di"><div class="my mz l"/></div></figure><h1 id="c358" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">🔌访问状态</h1><p id="f3b6" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">从嵌套在<code class="fe lg lh li lj b">&lt;GlobalStore&gt;</code>下的组件访问全局状态和分派方法，我们使用<code class="fe lg lh li lj b">useContext()</code>钩子。</p><p id="4296" class="pw-post-body-paragraph kj kk iq kl b km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf kh ij bi translated">例如在我们的<strong class="kl ir">电影</strong>组件中🔗<a class="ae ki" href="https://amir0ff.github.io/movie-lab" rel="noopener ugc nofollow" target="_blank">示例</a> app:</p><figure class="mu mv mw mx gt jq"><div class="bz fp l di"><div class="my mz l"/></div><figcaption class="nz oa gj gh gi ob oc bd b be z dk">Code: <a class="ae ki" href="https://github.com/amir0ff/movie-lab/tree/main/src/components/Movies/components/Movie" rel="noopener ugc nofollow" target="_blank">https://github.com/amir0ff/movie-lab/tree/main/src/components/Movies/components/Movie</a></figcaption></figure><ul class=""><li id="dc42" class="nl nm iq kl b km nf kq ng ku nn ky no lc np kh nq nr ns nt bi translated">💡在第9行，我们从<code class="fe lg lh li lj b">store/index.ts</code>文件导入上下文，并将其作为第13行的参数提供给React的<code class="fe lg lh li lj b">useContext(<strong class="kl ir">)</strong></code>钩子。这样我们就可以访问组件中的状态对象和分派方法！</li><li id="7fb7" class="nl nm iq kl b km nu kq nv ku nw ky nx lc ny kh nq nr ns nt bi translated">💡在第28/35行，我们分派喜欢/不喜欢某部电影的动作，并相应地更新状态。</li></ul></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><h1 id="0dd2" class="lr ls iq bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">结论</h1><p id="c534" class="pw-post-body-paragraph kj kk iq kl b km mp ko kp kq mq ks kt ku mr kw kx ky ms la lb lc mt le lf kh ij bi translated">我们通过使用React的内部上下文API和钩子特性消除了以下第三方依赖:<code class="fe lg lh li lj b"><a class="ae ki" href="https://www.npmjs.com/package/redux" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir">redux</strong></a></code>、<code class="fe lg lh li lj b"><a class="ae ki" href="https://www.npmjs.com/package/react-redux" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir">react-redux</strong></a></code>和<code class="fe lg lh li lj b"><a class="ae ki" href="https://www.npmjs.com/package/redux-thunk" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir">redux-thunk</strong></a></code>，同时仍然享受Redux提供的相同功能。</p><h1 id="f3d1" class="lr ls iq bd lt lu na lw lx ly nb ma mb mc nc me mf mg nd mi mj mk ne mm mn mo bi translated">奖金</h1><ul class=""><li id="7732" class="nl nm iq kl b km mp kq mq ku od ky oe lc of kh nq nr ns nt bi translated">使用的打字稿</li><li id="195e" class="nl nm iq kl b km nu kq nv ku nw ky nx lc ny kh nq nr ns nt bi translated">保存到本地/会话存储的状态持久化机制</li><li id="2acc" class="nl nm iq kl b km nu kq nv ku nw ky nx lc ny kh nq nr ns nt bi translated">已部署的<a class="ae ki" href="https://amir0ff.github.io/movie-lab" rel="noopener ugc nofollow" target="_blank">示例应用</a></li></ul><p id="fce7" class="pw-post-body-paragraph kj kk iq kl b km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf kh ij bi translated">我希望你喜欢阅读，<br/>请<strong class="kl ir"> </strong> <a class="ae ki" href="https://medium.com/@amir0ff" rel="noopener"> <strong class="kl ir">关注</strong> </a>和<strong class="kl ir">分享</strong>更多科技内容🤖💖</p><figure class="mu mv mw mx gt jq gh gi paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="gh gi og"><img src="../Images/4876c1387b10213e26ba6418d19c9447.png" data-original-src="https://miro.medium.com/v2/resize:fit:292/1*ZSBco9mgoreP377dkXVJNQ.gif"/></div></div></figure><p id="222f" class="pw-post-body-paragraph kj kk iq kl b km nf ko kp kq ng ks kt ku nh kw kx ky ni la lb lc nj le lf kh ij bi translated"><em class="nk">更多内容请看</em><a class="ae ki" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kl ir"><em class="nk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>