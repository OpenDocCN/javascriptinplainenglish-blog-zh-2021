<html>
<head>
<title>Node.js API Authentication with JSON Web Tokens</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JSON Web令牌的Node.js API身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-api-authentication-with-json-web-tokens-bb511f603723?source=collection_archive---------4-----------------------#2021-06-10">https://javascript.plainenglish.io/node-js-api-authentication-with-json-web-tokens-bb511f603723?source=collection_archive---------4-----------------------#2021-06-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/679f0bbc4065347a1c169f2e0370081c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*33Cvv9xyil9mXAejOxSAkQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Node-API-Auth</figcaption></figure><p id="014c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本文中，我们将介绍如何访问JSON web令牌(JWT ),以及如何通过JSON web令牌保护我们的路由。</p><p id="315d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你有没有想过认证的过程？抽象和复杂的层面下隐藏着什么？没什么异常。这是一种加密数据并生成独一无二的令牌的方法，用户可以使用该令牌来标识自己。您的身份已通过此令牌验证。它将验证您的身份，并允许您使用各种服务。如果你不认识这些单词，不要担心，我会在下面解释一切。</p><h1 id="e48d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置</h1><p id="16d6" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">在我们开始之前，我们应该在我们的机器上安装一些东西。</p><ul class=""><li id="0419" class="ma mb in kb b kc kd kg kh kk mc ko md ks me kw mf mg mh mi bi translated">Visual Studio代码-&gt; <a class="ae mj" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a></li><li id="2a9b" class="ma mb in kb b kc mk kg ml kk mm ko mn ks mo kw mf mg mh mi bi translated">Node.js -&gt; <a class="ae mj" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li></ul><p id="ffc2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">先决条件&amp;依赖条件</strong></p><p id="0f32" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">用项目名(NodeAuthAPI)创建一个新文件夹，并在Visual Studio代码(VS代码)中打开同一个文件夹</p><p id="6c61" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">运行以下命令来初始化我们的package.json文件。</p><blockquote class="mp mq mr"><p id="4b5c" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated">npm初始化—是</p></blockquote><p id="fc79" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">安装我们所有剩余的依赖项</p><blockquote class="mp mq mr"><p id="1c20" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated">npm安装快速jsonwebtoken</p><p id="31dc" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated">npm install -g nodemon</p></blockquote><h1 id="023b" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">为什么会有这些依赖？</h1><p id="3c44" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated"><a class="ae mj" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank"> express </a> —运行在服务器上(端口号)</p><p id="dc2f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae mj" href="https://www.npmjs.com/package/jsonwebtoken" rel="noopener ugc nofollow" target="_blank"> jsonwebtoken </a> —这将用于签署和验证JSON web令牌。</p><p id="4607" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae mj" href="https://www.npmjs.com/package/nodemon" rel="noopener ugc nofollow" target="_blank"> nodemon </a> —每当我们对文件进行更改时，将使用它自动重启我们的服务器。</p><p id="a625" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在项目中创建一个名为index.js的文件。</p><p id="be26" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">项目结构</strong></p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/d49fa1c1a1e683ce7d198f4b1d0bf226.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*Hs56OzHG2yks2QCrGSR-dw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">project-structure</figcaption></figure><p id="cda2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们导入index.js文件中的包</p><blockquote class="mp mq mr"><p id="32b0" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated"><strong class="kb io">const</strong>express = require(" express ")；</p><p id="5320" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated"><strong class="kb io">const</strong>jwt = require(" jsonwebtoken ")；</p></blockquote><p id="76b9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在用express初始化app变量</p><blockquote class="mp mq mr"><p id="0739" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated"><strong class="kb io">const</strong>app = express()；</p></blockquote><p id="88c4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">设置我们的服务器要处理的端口号</p><blockquote class="mp mq mr"><p id="9813" class="jz ka ms kb b kc kd ke kf kg kh ki kj mt kl km kn mu kp kq kr mv kt ku kv kw ig bi translated">app.listen(5000，()=&gt;console.log('监听端口5000 '))；</p></blockquote><p id="08d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们运行并测试我们的应用程序是否在上面提到的相同端口号下运行。</p><p id="9923" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在terminal-node mon中运行命令来检查输出</p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ca9a5d0eeb6de0425a68b07ab439c528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q9NnlbgJTMYaKYyw3NxodA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Console output</figcaption></figure><p id="d8aa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">创建一个简单的get方法来检查Postman中的输出。</p><p id="4192" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">索引. js </strong></p><figure class="mx my mz na gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="417b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">邮递员</strong></p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/55874dce927b81db7febfe3dc19de32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QaqnXshLa9XkKdMd9z_EKg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Final Output — API</figcaption></figure><p id="12fa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，我们的get方法被确认为按预期工作，现在配置jwt设置以检查实际的认证机制。用模拟用户名和电子邮件创建一个post API登录方法，我也用同样的方法设置了令牌过期秒数。</p><figure class="mx my mz na gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="1602" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">邮递员</strong></p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nf"><img src="../Images/630d3e45ac6f33297e6870dc0559d2fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6eOZuK2tlvGMTyIXXdc1QQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Post endpoint</figcaption></figure><p id="b5c5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">令牌是用基本凭证生成的，现在我们需要用这个令牌验证另一个API来访问凭证。</p><p id="825e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">创建一个函数并验证将作为头传递的令牌</p><p id="bcb7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">授权样本:持票人<your token=""/></p><figure class="mx my mz na gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="70f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们创建一个API来验证这个令牌</p><figure class="mx my mz na gt jo"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="4b34" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">测试邮递员</strong></p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/d2f3a7308e9742b340d65b24cbaac79b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzR2SRkHKm1I0gvZopKBWA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Validate token</figcaption></figure><p id="7786" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果你试图在不传递令牌的情况下访问validate API，它会给出403 Forbidden，因为未经授权的访问。</p><p id="9aa7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，让我们首先通过访问登录API来获取令牌，然后在Validate API中传递与头相同的令牌来获取访问和结果。</p><figure class="mx my mz na gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nh"><img src="../Images/e94007f8e09d8c1651290177aa4470d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hB5znXSr0hHT4g7l6FsLig.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Final output</figcaption></figure><p id="99d7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注</strong></p><p id="bde3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">30秒后令牌将过期，因为我们在代码中定义了过期时间，我们需要通过访问登录API再次获取令牌</p><div class="ni nj gp gr nk nl"><a href="https://github.com/JayKrishnareddy/NodeAuthAPI" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">JayKrishnareddy/nodeautapi</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">为Node.js中的API设置基于JWT令牌的身份验证- JayKrishnareddy/NodeAuthAPI</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jt nl"/></div></div></a></div><p id="092a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">感谢您阅读本文，希望您在理解Node.js API与JWT的认证时有一个清晰的印象。</p><p id="3294" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="ms">支持我</em></p><figure class="mx my mz na gt jo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/jaykrishnareddy"><div class="gh gi oa"><img src="../Images/7a5c035cd21f7fa41bd8ae7cbadf7d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*1LFaaJOnWU9L0G6_c_wRWQ.png"/></div></a></figure><p id="4bc8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">继续学习！</p><p id="349e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="ms">更多内容请看</em><a class="ae mj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="ms">plain English . io</em></a></p></div></div>    
</body>
</html>