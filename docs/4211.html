<html>
<head>
<title>How to Perform Schema Validation in Postman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Postman中执行模式验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-do-schema-validation-in-postman-d7209f4159d0?source=collection_archive---------1-----------------------#2021-08-21">https://javascript.plainenglish.io/how-to-do-schema-validation-in-postman-d7209f4159d0?source=collection_archive---------1-----------------------#2021-08-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a1ec" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">REST API指南</h2><div class=""/><div class=""><h2 id="85c7" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">JSON模式验证的定义以及如何在Postman中断言。</h2></div><h1 id="57fb" class="ko kp iq bd kq kr ks kt ku kv kw kx ky kf kz kg la ki lb kj lc kl ld km le lf bi translated">什么是JSON模式？</h1><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/3568e9c1bb9d442466580d1f284de815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iYz0Qe_ZVk-QOCZDoPQ4w.jpeg"/></div></div></figure><p id="e817" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">JSON (JavaScript Object Notation)是一种简单、轻量级的基于文本的数据格式。JSON模式是一种基于JSON的格式规范，用于定义JSON数据的结构。它是根据2011年到期的IETF草案编写的。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/0dc4baedb9cdd44584c976f64dc37e90.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*K-kcerSM4mWplAalJfg4vQ.gif"/></div></figure><p id="0a4b" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">简而言之，JSON模式的主要用途是描述JSON文档的结构和验证约束。与允许创建自定义方言的XML相比，JSON没有那么通用和灵活，然而，它也不想这样。JSON旨在以简洁的方式描述分层数据结构，由于冗长的语法，XML通常被认为不如JSON合适。</p><p id="d5a2" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我们在JSON模式中使用了不同的关键字。让我们来看看几个常用且重要的关键词，它们是关于什么的:</p><ul class=""><li id="6ba1" class="mp mq iq lu b lv lw ly lz mb mr mf ms mj mt mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my"> $schema </em> </strong>:声明该模式是根据草案v4规范编写的。</li><li id="8b83" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my"> $id </em> </strong>:定义基本URI以解析模式中的其他URI引用。</li><li id="d9f1" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">标题</em> </strong>:描述模式的意图/标题。</li><li id="5597" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">描述</em> </strong>:给出模式的简短描述。</li><li id="585f" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">类型</em> </strong>:定义数据的类型。它定义了JSON数据的第一个约束。</li><li id="dc0f" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">属性</em> </strong>:定义JSON文档中的各种键及其值类型。</li><li id="5d95" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">最小值</em> </strong>:定义数值数据类型的最小可接受值。</li><li id="d70d" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">最大值</em> </strong>:定义数值数据类型可接受的最大值。</li><li id="4c42" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">项</em> </strong>:枚举数组中可以出现的项的定义。</li><li id="0788" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated"><strong class="lu ja"> <em class="my">必需</em> </strong>:列出必需和强制的按键。</li></ul><p id="9128" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">JSON模式的一些优点是:</p><ul class=""><li id="d67e" class="mp mq iq lu b lv lw ly lz mb mr mf ms mj mt mn mu mv mw mx bi translated">它描述了现有的数据格式。</li><li id="c4f8" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated">它是清晰的，人和机器可读的。</li><li id="8190" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated">完成结构验证并在自动化测试中有用。</li><li id="858d" class="mp mq iq lu b lv mz ly na mb nb mf nc mj nd mn mu mv mw mx bi translated">有助于验证客户提交的数据。</li></ul><p id="71d0" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">关于JSON模式的更多细节，请访问<a class="ae ne" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank">json-schema.org。</a></p><p id="3476" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">我们知道JSON是目前REST API调用中广泛使用的格式。基于此，我们需要检查响应模式是有效还是无效。当然，这是《邮差》中的论断之一。</p><p id="8660" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">让我们详细看看如何在Postman中处理模式验证。我们将使用内置的JavaScript库(<a class="ae ne" href="https://ajv.js.org/" rel="noopener ugc nofollow" target="_blank"> AJV </a>)来验证JSON模式。</p><p id="753b" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">步骤1:根据我们从文档/开发人员那里得到的样本响应，我们需要生成模式。对于简单的响应，您可以通过理解响应来手动创建，对于较大的JSON响应，我们可以选择使用在线JSON模式生成器工具，如下所示。</p><p id="abad" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">https://www.jsonschema.net/<a class="ae ne" href="https://www.jsonschema.net/" rel="noopener ugc nofollow" target="_blank"/></p><p id="ea94" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated"><a class="ae ne" href="https://www.liquid-technologies.com/online-json-to-schema-converter" rel="noopener ugc nofollow" target="_blank">https://www . liquid-technologies . com/online-JSON-to-schema-converter</a></p><p id="004b" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">第二步:我们将继续进行<a class="ae ne" href="https://www.jsonschema.net/" rel="noopener ugc nofollow" target="_blank">https://www.jsonschema.net/</a>。</p><p id="2e88" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">一旦您登录并打开链接，它将如下所示。</p><p id="ed94" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">这里显示了示例JSON和模式。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nf"><img src="../Images/cb18343e2f78ef40c4224a6a1b524f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qB7hgQTAYkwQexcpPHQlA.png"/></div></div></figure><p id="e73e" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">步骤3:您可以将从developer/API文档中收到的API响应示例粘贴到左侧面板中。通过点击“提交”,您将在右侧面板看到JSON模式。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nf"><img src="../Images/c06799efefaa4275792507f1279ec6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LJ6pTZqwGL7mzJ9vpSHlw.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/e0b84c3d3a6236260ac4643f218e9480.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-2wj3Z6TZSYOuwZFuH0ew.png"/></div></div></figure><p id="679c" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">第4步:用端点<a class="ae ne" href="https://api.dictionaryapi.dev/api/v2/entries/en/hello" rel="noopener ugc nofollow" target="_blank">https://api.dictionaryapi.dev/api/v2/entries/en/hello</a>创建一个集合和一个请求。我们将使用这个公共API，因为嵌套数组的响应很复杂。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nh"><img src="../Images/d70351f5f86e35c69b51fd3c1f05aa85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E6ooh3Nlt2pwc2AMiqS8Rg.png"/></div></div></figure><p id="c7cc" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">步骤5:导航到“Tests”部分，创建一个变量“schema ”,并用JSON schema generator工具中生成的值进行赋值。</p><pre class="lh li lj lk gt ni nj nk nl aw nm bi"><span id="f127" class="nn kp iq nj b gy no np l nq nr">var schema = <br/>{<br/>  "type": "array",<br/>  "items": [<br/>    {<br/>      "type": "object",<br/>      "properties": {<br/>        "word": {<br/>          "type": "string"<br/>        },<br/>        "phonetic": {<br/>          "type": "string"<br/>        },<br/>        "phonetics": {<br/>          "type": "array",<br/>          "items": [<br/>            {<br/>              "type": "object",<br/>              "properties": {<br/>                "text": {<br/>                  "type": "string"<br/>                },<br/>                "audio": {<br/>                  "type": "string"<br/>                }<br/>              },<br/>              "required": [<br/>                "text",<br/>                "audio"<br/>              ]<br/>            },<br/>            {<br/>              "type": "object",<br/>              "properties": {<br/>                "text": {<br/>                  "type": "string"<br/>                }<br/>              },<br/>              "required": [<br/>                "text"<br/>              ]<br/>            }<br/>          ]<br/>        },<br/>        "origin": {<br/>          "type": "string"<br/>        },<br/>        "meanings": {<br/>          "type": "array",<br/>          "items": [<br/>            {<br/>              "type": "object",<br/>              "properties": {<br/>                "partOfSpeech": {<br/>                  "type": "string"<br/>                },<br/>                "definitions": {<br/>                  "type": "array",<br/>                  "items": [<br/>                    {<br/>                      "type": "object",<br/>                      "properties": {<br/>                        "definition": {<br/>                          "type": "string"<br/>                        },<br/>                        "example": {<br/>                          "type": "string"<br/>                        },<br/>                        "synonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        },<br/>                        "antonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        }<br/>                      },<br/>                      "required": [<br/>                        "definition",<br/>                        "example",<br/>                        "synonyms",<br/>                        "antonyms"<br/>                      ]<br/>                    }<br/>                  ]<br/>                }<br/>              },<br/>              "required": [<br/>                "partOfSpeech",<br/>                "definitions"<br/>              ]<br/>            },<br/>            {<br/>              "type": "object",<br/>              "properties": {<br/>                "partOfSpeech": {<br/>                  "type": "string"<br/>                },<br/>                "definitions": {<br/>                  "type": "array",<br/>                  "items": [<br/>                    {<br/>                      "type": "object",<br/>                      "properties": {<br/>                        "definition": {<br/>                          "type": "string"<br/>                        },<br/>                        "example": {<br/>                          "type": "string"<br/>                        },<br/>                        "synonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        },<br/>                        "antonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        }<br/>                      },<br/>                      "required": [<br/>                        "definition",<br/>                        "example",<br/>                        "synonyms",<br/>                        "antonyms"<br/>                      ]<br/>                    }<br/>                  ]<br/>                }<br/>              },<br/>              "required": [<br/>                "partOfSpeech",<br/>                "definitions"<br/>              ]<br/>            },<br/>            {<br/>              "type": "object",<br/>              "properties": {<br/>                "partOfSpeech": {<br/>                  "type": "string"<br/>                },<br/>                "definitions": {<br/>                  "type": "array",<br/>                  "items": [<br/>                    {<br/>                      "type": "object",<br/>                      "properties": {<br/>                        "definition": {<br/>                          "type": "string"<br/>                        },<br/>                        "example": {<br/>                          "type": "string"<br/>                        },<br/>                        "synonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        },<br/>                        "antonyms": {<br/>                          "type": "array",<br/>                          "items": {}<br/>                        }<br/>                      },<br/>                      "required": [<br/>                        "definition",<br/>                        "example",<br/>                        "synonyms",<br/>                        "antonyms"<br/>                      ]<br/>                    }<br/>                  ]<br/>                }<br/>              },<br/>              "required": [<br/>                "partOfSpeech",<br/>                "definitions"<br/>              ]<br/>            }<br/>          ]<br/>        }<br/>      },<br/>      "required": [<br/>        "word",<br/>        "phonetic",<br/>        "phonetics",<br/>        "origin",<br/>        "meanings"<br/>      ]<br/>    }<br/>  ]<br/>};</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ns"><img src="../Images/f237d9bbc8f1625fe8b177c151524d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PYoK37ijKL3oAdmgy7ABg.png"/></div></div></figure><p id="397a" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">步骤6:现在，为JSON模式检查添加断言。</p><pre class="lh li lj lk gt ni nj nk nl aw nm bi"><span id="89e8" class="nn kp iq nj b gy no np l nq nr">const response = pm.response.json();<br/>    pm.test('Schema is valid', () =&gt; {<br/>        pm.expect(response).to.have.jsonSchema(schema);<br/>    });</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nt"><img src="../Images/cdd2365e0b1b2e229e887fd351badfee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJ6UJH6vAJaST1chJoMZKw.png"/></div></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nu"><img src="../Images/2d59c9cd97fc0737c2b3786823affe08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIrNaNkqaA9GrkhiSjtk8g.png"/></div></div></figure><p id="c8d3" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">步骤7:就这么简单，现在，一旦您单击send，您就可以验证响应模式是否与我们在变量“schema”下定义的示例模式相匹配</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nv"><img src="../Images/de1f8e08a6e41699f07da71c0565c35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PerEDIM9ludlB3erkDzr1w.png"/></div></div></figure><p id="f678" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">现在让我们确保测试用例失败，让我们改变我们的模式。“音标”实际上是作为<em class="my">字符串的</em>类型。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nw"><img src="../Images/92b3b8c9c666efab32c1f0da808d5b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EoMHsjkG385wTkPwWUCfvA.png"/></div></div></figure><p id="2e0b" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">现在我们将它编辑为<em class="my">整数。</em></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nx"><img src="../Images/91e9de432d917ef9732f19b0400d00d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmWvhAg8UiqOibVFLX-JQA.png"/></div></div></figure><p id="5209" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">点击“保存”和“发送”。现在测试失败了！！</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ny"><img src="../Images/f3d6922e1f4127b57a24a3effbf97e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pyKTEHLso6nYJOLw-UtQw.png"/></div></div></figure><p id="b5f3" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">同样，如果样本模式和响应模式不匹配，测试也会失败。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi nz"><img src="../Images/ca5fed96c1c54ff273130652ecfb2f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdxcjXZ7LL9icRmlW-gM4w.png"/></div></div></figure><p id="0022" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">在Postman现成的代码片段中，您可以注意到“对JSON数据使用微型验证器”。这几乎被否决，不建议使用。</p><p id="e9a7" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated">因此，我们讨论了使用Postman处理API的模式验证。对于您的API测试，针对API响应的JSON模式验证是最重要的，并且必须对此进行检查。有许多在线工具可以验证JSON模式，但是最好将这个断言作为测试套件的一部分。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b757f892869f774e0fee374ee951cfd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/1*H_Vi64SwnHoY1-MvmTKE3g.gif"/></div></figure><p id="3afb" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="34d7" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated"><em class="my">原载于</em><a class="ae ne" href="https://synapse-qa.com/2021/08/18/apis-unleashed-05-schema-validation/" rel="noopener ugc nofollow" target="_blank"><em class="my">https://synapse-QA . com/2021/08/18/APIs-unleashed-05-schema-validation/</em></a></p><p id="8145" class="pw-post-body-paragraph ls lt iq lu b lv lw ka lx ly lz kd ma mb mc md me mf mg mh mi mj mk ml mm mn ij bi translated"><em class="my">更多内容请看</em><a class="ae ne" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lu ja"><em class="my">plain English . io</em></strong></a></p></div></div>    
</body>
</html>