<html>
<head>
<title>Testing Vue 3 Apps — Slots and Async Behavior</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试Vue 3应用—插槽和异步行为</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-vue-3-apps-slots-and-async-behavior-c9009525cb2d?source=collection_archive---------11-----------------------#2021-01-31">https://javascript.plainenglish.io/testing-vue-3-apps-slots-and-async-behavior-c9009525cb2d?source=collection_archive---------11-----------------------#2021-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/d258d3700aa08904bc62218b59d2430f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kbIIEFzX2X5k72Dk"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@cdc?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">CDC</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6792" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着应用程序变得越来越复杂，自动测试它们变得非常重要。我们可以通过单元测试做到这一点，然后我们就不必手动测试所有的东西了。</p><p id="ca81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将通过编写一个简单的应用程序并测试它来看看如何测试Vue 3应用程序。</p><h1 id="5cb2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用渲染功能测试插槽</h1><p id="a4dd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用渲染函数和单文件组件来测试插槽。</p><p id="31ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="de94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Header.vue</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="eb8e" class="mq lc iq mh b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;Header&lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="f9a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">example.spec.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ddbe" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '<a class="ae kc" href="http://twitter.com/vue/test-utils" rel="noopener ugc nofollow" target="_blank">@vue/test-utils</a>'<br/>import { h } from 'vue'<br/>import Header from './Header.vue'</span><span id="06fd" class="mq lc iq mh b gy mv ms l mt mu">const Layout = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;header&gt;<br/>        &lt;slot name="header" /&gt;<br/>      &lt;/header&gt;<br/>      &lt;main&gt;<br/>        &lt;slot name="main" /&gt;<br/>      &lt;/main&gt;<br/>      &lt;footer&gt;<br/>        &lt;slot name="footer" /&gt;<br/>      &lt;/footer&gt;<br/>    &lt;/div&gt;<br/>  `<br/>}</span><span id="e4ea" class="mq lc iq mh b gy mv ms l mt mu">test('layout full page layout', () =&gt; {<br/>  const wrapper = mount(Layout, {<br/>    slots: {<br/>      header: Header,<br/>      main: h('div', 'Main Content'),<br/>      footer: '&lt;div&gt;Footer&lt;/div&gt;'<br/>    }<br/>  })</span><span id="bb87" class="mq lc iq mh b gy mv ms l mt mu">  expect(wrapper.html()).toContain('&lt;div&gt;Header&lt;/div&gt;')<br/>  expect(wrapper.html()).toContain('&lt;div&gt;Main Content&lt;/div&gt;')<br/>  expect(wrapper.html()).toContain('&lt;div&gt;Footer&lt;/div&gt;')<br/>})</span></pre><p id="f3a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带几个插槽的<code class="fe me mf mg mh b">Layout</code>组件。</p><p id="15c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还添加了一个测试，通过使用单个文件组件作为头的填充槽来测试它。</p><p id="4dcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">main</code>槽填充了一个渲染函数。</p><p id="ea44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">h</code>是一个渲染组件的函数。第一个参数是标记名，第二个参数是div的内容。</p><p id="bb1f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">footer</code>有一个HTML字符串作为它的值。</p><p id="d73f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">expect</code>调用检查它的内容。</p><h1 id="dbee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">作用域插槽</h1><p id="cf13" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Vue测试工具测试作用域插槽。</p><p id="f0a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="64f6" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '@vue/test-utils'</span><span id="1dd4" class="mq lc iq mh b gy mv ms l mt mu">const ComponentWithSlots = {<br/>  template: `<br/>    &lt;div class="scoped"&gt;<br/>      &lt;slot name="scoped" v-bind="{ msg }" /&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      msg: 'world'<br/>    }<br/>  }<br/>}</span><span id="34b1" class="mq lc iq mh b gy mv ms l mt mu">test('scoped slots', () =&gt; {<br/>  const wrapper = mount(ComponentWithSlots, {<br/>    slots: {<br/>      scoped: `&lt;template #scoped="params"&gt;<br/>        Hello {{ params.msg }}<br/>        &lt;/template&gt;<br/>      `<br/>    }<br/>  })<br/>  expect(wrapper.html()).toContain('Hello world')<br/>})</span></pre><p id="135a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们的<code class="fe me mf mg mh b">ComponentWithSlots</code>组件有一个名为<code class="fe me mf mg mh b">scoped</code>的插槽。</p><p id="52eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它向父对象公开了<code class="fe me mf mg mh b">msg</code>属性。</p><p id="9c55" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在测试中，我们将其呈现在<code class="fe me mf mg mh b">template</code>标签中。</p><p id="4909" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在测试的最后一行检查呈现的内容。</p><h1 id="0a9d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">异步行为</h1><p id="cffb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在测试中测试异步行为。</p><p id="4c47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9819" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '@vue/test-utils'</span><span id="544a" class="mq lc iq mh b gy mv ms l mt mu">const Counter = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;p&gt;Count: {{ count }}&lt;/p&gt;<br/>      &lt;button @click="handleClick"&gt;Increment&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>  methods: {<br/>    handleClick() {<br/>      this.count += 1<br/>    }<br/>  }<br/>}</span><span id="4d60" class="mq lc iq mh b gy mv ms l mt mu">test('increments by 1', async () =&gt; {<br/>  const wrapper = mount(Counter)<br/>  await wrapper.find('button').trigger('click')<br/>  expect(wrapper.find('p').text()).toMatch('Count: 1')<br/>})</span></pre><p id="153c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们安装<code class="fe me mf mg mh b">Counter</code>组件。</p><p id="7954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到<code class="fe me mf mg mh b">button</code>并在其上触发<code class="fe me mf mg mh b">click</code>事件。</p><p id="8df4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们检查<code class="fe me mf mg mh b">p</code>元素的文本，看看它是否是我们所期望的。</p><p id="2e9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">等价地，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6e9b" class="mq lc iq mh b gy mr ms l mt mu">import { mount } from '@vue/test-utils'<br/>import { nextTick } from 'vue'</span><span id="1046" class="mq lc iq mh b gy mv ms l mt mu">const Counter = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;p&gt;Count: {{ count }}&lt;/p&gt;<br/>      &lt;button @click="handleClick"&gt;Increment&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>  methods: {<br/>    handleClick() {<br/>      this.count += 1<br/>    }<br/>  }<br/>}</span><span id="09a1" class="mq lc iq mh b gy mv ms l mt mu">test('increments by 1', async () =&gt; {<br/>  const wrapper = mount(Counter)<br/>  wrapper.find('button').trigger('click')<br/>  await nextTick()<br/>  expect(wrapper.find('p').text()).toMatch('Count: 1')<br/>})</span></pre><p id="44da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们以同样的方式触发按钮上的click事件。</p><p id="043e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是我们调用<code class="fe me mf mg mh b">nextTick</code>来等待最新的<code class="fe me mf mg mh b">count</code>被渲染。</p><p id="4455" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用同样的方法做检查。</p><h1 id="f48b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="acf8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在Vue 3组件中测试命名和限定范围的插槽。</p><p id="1273" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以测试异步行为，如组件中触发的点击。</p><p id="18d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p><p id="b8e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>