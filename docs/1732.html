<html>
<head>
<title>How to Migrate an existing React Web App to Desktop App with Electron</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Electron将现有的React Web应用迁移到桌面应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/migrate-existing-web-react-app-to-desktop-app-with-electron-a7007128120e?source=collection_archive---------1-----------------------#2021-04-13">https://javascript.plainenglish.io/migrate-existing-web-react-app-to-desktop-app-with-electron-a7007128120e?source=collection_archive---------1-----------------------#2021-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/56c2679fd4b47a3ee8df394106bd54f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GffaeILyTI2xkjWpMLFcCA.png"/></div></div></figure><p id="9758" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">本文由</em> <a class="ae ku" href="https://rostyslavmoroziuk.medium.com/?source=post_page-----aedc1543c3a1--------------------------------" rel="noopener"> <em class="kt">罗斯蒂斯拉夫</em> </a>撰写</p><h2 id="0d5d" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">什么是电子？</h2><p id="90fc" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">Electron是一个用web技术构建桌面应用程序的框架。我们可以构建跨平台的应用程序，并通过使用JavaScript在所有平台(macOS、Ubuntu、Linux或Windows)上运行它们。像微软、脸书、Twitch这样的大组织都在采用electronic，所以我们可以肯定这个框架可以覆盖我们在桌面应用程序开发中的所有需求。感谢电子，你可以专注于你的应用，而不是你需要使用的技术。</p><h2 id="0e1c" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">为什么我们要将Electron集成到现有的React应用程序中？</h2><p id="c9f2" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">我们希望获得一个桌面应用程序，而不需要对web应用程序的现有代码库进行任何更改。我们仍然可以使用HTML5通知API从渲染器进程发送通知。此外，我们可以继续使用我们现有的快捷方式监听器，基本上，仍然认为我们的应用程序是一个web应用程序。</p><p id="d00e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将通过一个小教程来学习如何将Electron集成到React应用程序中。</p><h2 id="f6ec" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">我们来编码吧！</h2><p id="da87" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">让我们用<code class="fe lt lu lv lw b">react-router-dom</code>和Typescript创建一个基本且非常常见的React应用程序。</p><p id="6024" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以跳过创建基本应用的步骤，从<a class="ae ku" href="https://github.com/RostikMoroziuk/react-electron" rel="noopener ugc nofollow" target="_blank">这里</a>获取。</p><p id="83d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行以下命令创建一个React应用程序:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="ffa2" class="kv kw in lw b gy mf mg l mh mi">npx create-react-app &lt;app_name&gt; --template typescript</span></pre><p id="5077" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意，我们需要在我们的<strong class="jx io"> package.json </strong>文件的<strong class="jx io"> devDependencies </strong>部分安装开发依赖项。否则，我们的依赖项将包含在产品构建中，这将增加包的大小。此外，强烈建议使用<code class="fe lt lu lv lw b">yarn </code>而不是<code class="fe lt lu lv lw b">npm</code>，以避免构建和运行电子应用程序时的一些意外问题。</p><p id="1d0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们给应用程序添加一个路由器:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="f236" class="kv kw in lw b gy mf mg l mh mi">yarn add react-router-dom</span><span id="0bcd" class="kv kw in lw b gy mj mg l mh mi">yarn add --dev @types/react-router-dom</span></pre><p id="8447" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以从<strong class="jx io"> src </strong>文件夹中移除已创建的文件，并添加新文件。一旦我们的包被安装，我们就可以实现路由。我们准备增加两个页面:<strong class="jx io">首页</strong>和<strong class="jx io">关于</strong>。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="efee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们已经创建了一个基本的React应用程序。所以我们的项目结构应该是这样的:</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/66d68dd50dc5bd0a2ea4e1653520a8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcNBKqfJbepJRN0rCniUiw.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">React Basic App</figcaption></figure></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><h2 id="d920" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">集成电子和运行桌面应用程序</h2><p id="892d" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">我们需要安装依赖关系来运行电子应用程序。让我们转到终端中包含项目的文件夹，并运行下一个命令:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="4543" class="kv kw in lw b gy mf mg l mh mi">yarn add --dev electron concurrently wait-on</span></pre><p id="05cd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用包<code class="fe lt lu lv lw b">concurrently</code>和<code class="fe lt lu lv lw b">wait-on</code>在本地以开发模式运行应用程序。</p><p id="a020" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦我们完成了依赖项的安装，我们就可以开始编码了。在项目的根级别创建一个文件夹<strong class="jx io"> electron </strong>，并在那里添加一个文件<strong class="jx io"> main.ts </strong>。在这个文件中，我们在一个完整的工作区上创建一个窗口:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="aafa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请访问此<a class="ae ku" href="https://www.electronjs.org/docs/api/browser-window#new-browserwindowoptions" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多<code class="fe lt lu lv lw b">BroswerWindow</code>属性。</p><p id="212e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们需要编辑<strong class="jx io"> package.json </strong>来运行带有电子的app。所以打开<strong class="jx io"> package.json </strong>文件，添加脚本<code class="fe lt lu lv lw b">electron:start</code>:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="24c3" class="kv kw in lw b gy mf mg l mh mi">"scripts": {</span><span id="4aad" class="kv kw in lw b gy mj mg l mh mi">  "start": "react-scripts start",</span><span id="ed74" class="kv kw in lw b gy mj mg l mh mi">  "build": "react-scripts build",</span><span id="7e34" class="kv kw in lw b gy mj mg l mh mi">  "test": "react-scripts test", </span><span id="769f" class="kv kw in lw b gy mj mg l mh mi">  "eject": "react-scripts eject",<strong class="lw io"> </strong></span><span id="9e7e" class="kv kw in lw b gy mj mg l mh mi"><strong class="lw io">  "electron:start": "concurrently \"yarn start\" \"wait-on http://localhost:3001 &amp;&amp; electron .\""</strong></span><span id="f3d7" class="kv kw in lw b gy mj mg l mh mi">}</span></pre><p id="222a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，我们需要添加<strong class="jx io">“main”</strong>字段来指定电子应用程序的入口点，以及主进程文件的路径(在我们的例子中是<strong class="jx io"> electron/main.ts) </strong>。：</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="aca4" class="kv kw in lw b gy mf mg l mh mi">"name": "react-electron",</span><span id="fd14" class="kv kw in lw b gy mj mg l mh mi">"version": "0.1.0",</span><span id="bed5" class="kv kw in lw b gy mj mg l mh mi">"private": true,</span><span id="edb6" class="kv kw in lw b gy mj mg l mh mi"><strong class="lw io">"main": "electron/main.ts",</strong></span></pre><p id="6e13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你。现在，我们已经准备好在浏览器和电子版上运行现有的应用程序。让我们试一试。打开您的终端并运行:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="c933" class="kv kw in lw b gy mf mg l mh mi">yarn electron:start</span></pre><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/dd7179d61f7284ee606143132d4d75ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*LdUDbN7GlEX0fR4eEdJPUw.gif"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Working Electron + React app</figcaption></figure><p id="14fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如你所看到的，脚本<code class="fe lt lu lv lw b">yarn electron:start</code>在浏览器中运行应用程序，一旦应用程序在<code class="fe lt lu lv lw b">localhost:3000</code>上打开，它也用电子包裹，并作为一个单独的桌面应用程序打开。您可以在浏览器和单独的窗口中看到同一个应用程序。</p><h2 id="fc71" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">调试呢？</h2><p id="0a85" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">您可以像调试web应用程序一样轻松地调试电子应用程序。Electron在幕后使用Chromium，所以你可以假设一个Electron应用程序和任何其他web应用程序一样，并使用你在浏览器中使用的调试工具。您可以打开DevTools并访问web编程中每天都会用到的元素、控制台、网络和其他选项卡。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/ac1aa2a3a1fe1f233347cc96d41c01b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJHVBGQPqWJ0Af65DPKBwA.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">DevTools in Electron</figcaption></figure><p id="03ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以尝试编辑<strong class="jx io"> src </strong>文件夹中的任何组件，并查看React Fast Refresh在浏览器和electronic中是否正常工作。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/0f839f2cc94a472860d4f6d714b76ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ExFtY1dqfNNF02Ey4WPjxQ.gif"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">React Fast Refresh with Electron</figcaption></figure><p id="ecc1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好了，现在我们知道这个应用程序在浏览器和电子版中有相同的行为。因此，我们仍然可以与电子应用程序进行交互，就像在浏览器中打开任何其他web应用程序一样。我们可以使用相同的快捷方式、开放链接等。</p><p id="6382" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以尝试在新选项卡中打开主页或“关于”页面:按住Command键(Windows上为Ctrl)并单击链接—链接将在新窗口中打开。</p><p id="20ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这不是你想要的行为，(кома)那么你可以很容易地阻止它。你只需要在<strong class="jx io">电子/主文件</strong>中添加以下代码:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="1378" class="kv kw in lw b gy mf mg l mh mi">mainWindow.webContents.on('new-window', (event, url) =&gt; { </span><span id="0b43" class="kv kw in lw b gy mj mg l mh mi">  event.preventDefault(); </span><span id="7e43" class="kv kw in lw b gy mj mg l mh mi">  mainWindow.loadURL(url);</span><span id="295f" class="kv kw in lw b gy mj mg l mh mi">});</span></pre><p id="ebc4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开<a class="ae ku" href="https://www.electronjs.org/docs/api/web-contents#instance-events" rel="noopener ugc nofollow" target="_blank">链接</a>可以找到更多控制<code class="fe lt lu lv lw b">BrowserWindow</code>的事件。</p><h2 id="75c9" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">为发行而构建</h2><p id="974b" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">有三种工具可用于构建和打包应用程序以进行分发:</p><ul class=""><li id="0aff" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated"><a class="ae ku" href="https://github.com/electron-userland/electron-builder" rel="noopener ugc nofollow" target="_blank">电子建造者</a></li><li id="7456" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated"><a class="ae ku" href="https://github.com/electron/electron-packager" rel="noopener ugc nofollow" target="_blank">电子打包机</a></li><li id="fe54" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated"><a class="ae ku" href="https://github.com/electron-userland/electron-forge" rel="noopener ugc nofollow" target="_blank">电子锻造</a></li></ul><blockquote class="nn no np"><p id="789f" class="jv jw kt jx b jy jz ka kb kc kd ke kf nq kh ki kj nr kl km kn ns kp kq kr ks ig bi translated">电子建设者和电子锻造使用电子封装机罩下。</p></blockquote><p id="fa60" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我看来，Electron Builder看起来更可取，因为它有良好的文档和高度的可配置性。它支持为Linux，macOS，Windows构建。你可以很容易地签署你的申请。作为奖励，它支持自动更新。您可以使用Electron Builder在一台机器上为不同的操作系统创建发行版。它还有Docker映像，可以从任何操作系统创建Windows和Linux版本。</p><p id="b4a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好的，让我们用电子构建器试着创建发行版。首先，安装我们的构建工具:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="749a" class="kv kw in lw b gy mf mg l mh mi">yarn add --dev electron-builder</span></pre><p id="7b15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要为发行版构建指定选项。将下一段代码添加到您的<strong class="jx io"> package.json </strong>文件中:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="e1c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还必须指定电子主页路径。Electron使用这个路径来知道我们的CSS和JavaScript文件在哪里。需要用自己的<code class="fe lt lu lv lw b">appId</code>和<code class="fe lt lu lv lw b">productName</code>。这里，我们只添加了构建应用程序所必需的必填字段。如果您不使用macOS，您可能需要指定<code class="fe lt lu lv lw b">win</code>或<code class="fe lt lu lv lw b">linux</code>字段，而不是<code class="fe lt lu lv lw b">mac</code>。</p><p id="ca1a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在这里找到更多可能的选项<a class="ae ku" href="https://www.electron.build/configuration/configuration" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2b4d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">构建应用程序有一个小问题。我们指定了一个主页为<code class="fe lt lu lv lw b">./</code>，这对于一个电子app来说是正确的。但是对于web产品构建，我们需要使用<code class="fe lt lu lv lw b">/</code>。因此，让我们调整我们的脚本，为电子应用程序和一个简单的web应用程序使用不同的主页:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="5b7e" class="kv kw in lw b gy mf mg l mh mi">"scripts": {<br/>... <br/> <br/>  "build": "PUBLIC_URL=/ react-scripts build",</span><span id="acdf" class="kv kw in lw b gy mj mg l mh mi">  "build-electron": "react-scripts build"<br/>...</span><span id="1126" class="kv kw in lw b gy mj mg l mh mi">}</span></pre><p id="a097" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，我们需要添加一个脚本来构建一个分发应用程序。在您的<strong class="jx io"> package.json </strong>文件中打开一个脚本部分，并添加以下命令:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="9b4c" class="kv kw in lw b gy mf mg l mh mi">"electron:build": "yarn build-electron &amp;&amp; electron-builder build --publish never"</span></pre><p id="ac6c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的<strong class="jx io"> package.json </strong>文件应该是这样的:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="1619" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是的，我们快到了。我们必须为我们的应用程序指定开始URL。<br/>首先，我们需要添加一个新的依赖项来确定应用程序是运行在开发模式还是生产模式:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="4e42" class="kv kw in lw b gy mf mg l mh mi">yarn add electron-is</span></pre><p id="43c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在在您的代码编辑器中打开<strong class="jx io"> main.ts </strong>文件并替换<code class="fe lt lu lv lw b">startURL</code>。很可能，你不想在产品版本中支持DevTools，所以我们将移除它们。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="a35a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们已经完成了发行版构建的配置。但是我们还得为我们的<code class="fe lt lu lv lw b">react-router</code>再走一步。问题是在我们的web应用程序中使用了<code class="fe lt lu lv lw b">BrowserRouter</code>。它不能在基于文件的环境下工作，而electronic可以。这就是为什么你会看到一个白屏，而不是一个应用程序。</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/17fa1a0696bf66166863361df4929e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHyNwWcssG8k7JyL0lQoiQ.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Electron app with BrowserRouter</figcaption></figure><p id="c883" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，这里的解决方案是什么呢？我们需要用<code class="fe lt lu lv lw b">BrowserRouter</code>做网络应用，用<code class="fe lt lu lv lw b">HashRouter</code>做电子应用。</p><p id="216d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们添加一个新的<strong class="jx io"> utils </strong>文件，该文件具有检查应用程序是否在电子环境中运行的功能:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="9621" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还需要更新我们的<strong class="jx io"> index.tsx </strong>文件，以便根据环境使用正确的路由器历史记录:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="5283" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好了，现在我们可以运行<code class="fe lt lu lv lw b">electron:build</code>脚本了:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="193e" class="kv kw in lw b gy mf mg l mh mi">yarn electron:build</span></pre><p id="0628" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个脚本将生成一个<strong class="jx io"> dist </strong>文件夹，其中包含我们应用程序的可执行文件。它还会为macOS创建一个DMG文件:</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/0d401406a27e9a636bdd5c3407ed598d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DHIG_cIObQsGOnEq4O28jA.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Electron distribution folder</figcaption></figure><p id="3b13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我前面提到的，您可以从您的Mac机器上为Windows和Linux构建发行版文件。如果你不使用任何平台相关的模块，这是可能的(换句话说，如果你只是用电子包装你现有的web应用程序，这总是可能的)。为了构建不同平台的应用程序，我们需要向我们的<strong class="jx io"> package.json </strong>文件添加一个新脚本:</p><pre class="lx ly lz ma gt mb lw mc md aw me bi"><span id="dd94" class="kv kw in lw b gy mf mg l mh mi">"electron:build:all": "yarn build-electron &amp;&amp; electron-builder build --publish never -mwl"</span></pre><p id="9c92" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该脚本将为macOS、Windows、Linux生成可执行文件:</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/b689ee935a26d4b4a098c290c6597f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VlTKg9PF81d96h_fvPCi8w.png"/></div></div></figure><p id="cf5b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如你所看到的，electronic-builder为不同的操作系统创建了安装文件。让我们尝试在Windows上运行安装文件:</p><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e24d2ddb66bad9eb695ae7cf87e847ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*CTW7Tng5P1H2ml3wPLjxeA.png"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Windows installer</figcaption></figure><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/44642d9a4259311b6bbcfe5cbd383b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeaqJd_IqxwCtbTqi81mtw.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">React Electron App on Windows OS</figcaption></figure><p id="419f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该应用程序构建在macOS上，在Windows机器上成功安装和启动。还能更简单吗？我不这么认为。电子建设者做了所有的工作，而不是一个只有几个简单的配置开发人员。</p><h2 id="d68b" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">代码签名</h2><p id="4a02" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">可以不签署申请，但不建议这样做。Mac将阻止此应用程序，并需要很多额外的安装步骤。Windows还需要一个额外的确认步骤。此外，不通过App Store和Windows Store签名，就不可能分发应用程序。</p><p id="909a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要签署macOS应用程序，您需要遵循以下步骤:</p><ol class=""><li id="3332" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks nu nf ng nh bi translated">加入苹果开发者<a class="ae ku" href="https://developer.apple.com/programs/enroll/" rel="noopener ugc nofollow" target="_blank">计划</a>。</li><li id="c481" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks nu nf ng nh bi translated">生成两个证书:开发者ID应用程序和开发者ID安装程序。</li><li id="18f9" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks nu nf ng nh bi translated">启动钥匙串并前往“我的证书”。找到这些证书并全部高亮显示:Cmd+单击，右键单击，导出为p12。</li><li id="c702" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks nu nf ng nh bi translated">包括这个p12文件来构建。</li><li id="54bf" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks nu nf ng nh bi translated">添加环境变量<a class="ae ku" href="https://www.electron.build/code-signing" rel="noopener ugc nofollow" target="_blank">来构建机器。</a></li></ol><h2 id="c3ab" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">结论</h2><p id="570e" class="pw-post-body-paragraph jv jw in jx b jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ls kq kr ks ig bi translated">所以，现在你做到了。恭喜你！我们已经成功地将电子集成到我们的React应用程序中。</p><p id="65be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在这里找到本教程的代码:</p><div class="nv nw gp gr nx ny"><a href="https://github.com/RostikMoroziuk/react-electron/tree/electron" rel="noopener  ugc nofollow" target="_blank"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd io gy z fp od fr fs oe fu fw im bi translated">RostikMoroziuk/反应电子</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">github.com</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om jt ny"/></div></div></a></div><h2 id="698b" class="kv kw in bd kx ky kz dn la lb lc dp ld kg le lf lg kk lh li lj ko lk ll lm ln bi translated">进一步阅读</h2><div class="nv nw gp gr nx ny"><a rel="noopener  ugc nofollow" target="_blank" href="/5-tips-to-scale-up-your-react-apps-8fb68319062e"><div class="nz ab fo"><div class="oa ab ob cl cj oc"><h2 class="bd io gy z fp od fr fs oe fu fw im bi translated">扩展React应用的5个技巧</h2><div class="of l"><h3 class="bd b gy z fp od fr fs oe fu fw dk translated">1.将Bit用于可组合设计2。设计令牌3。网络请求的定制钩子4。客户端与服务器状态5。一个…</h3></div><div class="og l"><p class="bd b dl z fp od fr fs oe fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oh l"><div class="on l oj ok ol oh om jt ny"/></div></div></a></div></div><div class="ab cl mr ms hr mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ig ih ii ij ik"><p id="9e03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">更多内容请看</em><a class="ae ku" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kt">plain English . io</em></strong></a><em class="kt">。报名参加我们的</em> <a class="ae ku" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kt">免费周报</em> </strong> </a> <em class="kt">。关注我们关于</em><a class="ae ku" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kt">Twitter</em></strong></a><a class="ae ku" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kt">LinkedIn</em></strong></a><em class="kt"/><a class="ae ku" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kt">YouTube</em></strong></a><em class="kt"/><a class="ae ku" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kt">不和</em> </strong> </a> <em class="kt">。对增长黑客感兴趣？检查</em> <a class="ae ku" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kt">电路</em> </strong> </a> <em class="kt">。</em></p></div></div>    
</body>
</html>