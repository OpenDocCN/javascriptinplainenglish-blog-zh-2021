<html>
<head>
<title>Data Fetching with React Query &amp; Axios</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React查询和Axios获取数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/data-fetching-with-react-query-axios-257a95c86e77?source=collection_archive---------1-----------------------#2021-07-31">https://javascript.plainenglish.io/data-fetching-with-react-query-axios-257a95c86e77?source=collection_archive---------1-----------------------#2021-07-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a4ce" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在react-query中为毛茸茸的HTTP请求实现钩子</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/01e7072fcee61d1b0ab421846a615d71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jVo04AyJ_pyVt0Go"/></div></div></figure><p id="57e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有许多库提供了向前端发出HTTP请求的方法，但有一个库多年来一直是事实上的领导者，那就是<a class="ae ln" href="https://axios-http.com/docs/intro" rel="noopener ugc nofollow" target="_blank"> Axios </a>。这是一个整洁的库，允许更结构化和更快速的开发，但最近出现了一个名为<a class="ae ln" href="https://react-query.tanstack.com/" rel="noopener ugc nofollow" target="_blank"> react-query </a>的库。它是为React设计的，使用了钩子和提供者，这是React应用程序中一种更本地的方法，它很棒<strong class="kt ir"/>。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="8532" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">1.为什么不只用Axios？</h1><p id="e4b5" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">Axios是一个可靠的库，不要误会我的意思，但是react-query提供了一个缓存机制，它的API对react用户非常友好。这并不意味着你不能同时使用两者，如果你想代替使用基于浏览器的获取API。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/8bf85147e5bbd823389dc7729cf44423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*nygrYwJO-2SP1vE_"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="2b94" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated"><strong class="ak"> 2。Axios基础服务</strong></h1><p id="5ead" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">我们将使用伟大的<a class="ae ln" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank">狗CEO API </a>来显示一个随机的毛茸茸的朋友和一个列表🐶。我们希望在组件使用Axios的自定义请求函数装载和析构响应数据(消息)时发出请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/24635ab4822401747a918fa8443f9c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fzvGzrq2VD2ZwxRFO4xsdQ.png"/></div></div></figure><p id="0951" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后我们可以定义一个DogService类，它将使用静态方法通过Axios API发出请求。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mu"><img src="../Images/6bd0ff0e65cf78d2b7e4008e8ca02da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6N_6DJAA9maUPUhfCWshRg.png"/></div></div></figure><p id="8bd8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用应用程序组件中的请求，并展示我们新发现的毛茸茸的朋友，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mv"><img src="../Images/2afccefa37be62b3ee44cd13bbd77da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZnOnEcrAqhMqSN2cPFmdg.png"/></div></div></figure><p id="4622" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们想显示一个加载指示器，直到“getAllDogs()”请求完成，该怎么办？</p><p id="8e38" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们需要添加一个isLoading状态变量，并在请求开始和完成时手动更新它。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/ea4e4f76590532a3ed719097b502c7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xD1P1SmWuhZzyvFjnZl0Kw.png"/></div></div></figure><p id="c51e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，如果我们需要显示一个错误消息，我们必须定义另一个错误状态变量，并且必须为应用程序中的多个请求处理这些状态，这可能会变得相当混乱。</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="f8f9" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">3.React查询实现</h1><p id="8778" class="pw-post-body-paragraph kr ks iq kt b ku mn jr kw kx mo ju kz la mp lc ld le mq lg lh li mr lk ll lm ij bi translated">这很好，但我们可以通过使用react-query缓存“getAllDogs()”请求来改进它，这也将消除useEffect在mount上发出请求的需要，并包括error、isLoading值和许多其他有用的有状态变量。</p><p id="be2d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">更新应用程序根目录下的index.js文件，添加react-query使用的“QueryClientProvider ”,以使钩子在一些默认设置下全局可用。此外，我们将添加ReactQueryDevtools来轻松调试缓存状态。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/bccc8f37287bcee444e9d59da1154914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cC9po8aj1JNfoZjVlV2uXA.png"/></div></div></figure><p id="4849" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，让我们用useQuery钩子修改应用程序组件:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/0d9169cb8b0ddb46c613c0d7be4713f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNVUub29IqQRoa9_hN3G8w.png"/></div></div></figure><p id="00cd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这种方法更干净，我们毛茸茸的朋友比以往任何时候都更优化。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/41f5e853463f87e4e9c8fbb0be06f4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/0*U2Z2NznYsMLJAKE8"/></div></figure><p id="002c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">此外，我们可以添加选项来定制和提高我们的性能。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/2801c12c8558e74128ca0337638a67b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FrGn-hilvxnN-IacAvDDg.png"/></div></div></figure><p id="68fb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在react-query <a class="ae ln" href="https://react-query.tanstack.com/overview" rel="noopener ugc nofollow" target="_blank">的官方文档中找到更多细节，或者如果你想查看这个例子，可以查看这个</a><a class="ae ln" href="https://codesandbox.io/s/axios-react-query-pj9nl?file=/src/index.js:495-546" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>。</p><blockquote class="na nb nc"><p id="6cc4" class="kr ks nd kt b ku kv jr kw kx ky ju kz ne lb lc ld nf lf lg lh ng lj lk ll lm ij bi translated">我希望你喜欢这个简短的指南，如果你把💜这就去。</p></blockquote><p id="2467" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nd">更多内容尽在</em><a class="ae ln" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nd">plain English . io</em></strong></a></p></div></div>    
</body>
</html>