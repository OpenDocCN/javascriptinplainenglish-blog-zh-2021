<html>
<head>
<title>How to Perform State Management using the Composition API in Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Vue.js中的组合API进行状态管理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/state-management-using-vue-composition-api-e38ce24bc8af?source=collection_archive---------7-----------------------#2021-04-13">https://javascript.plainenglish.io/state-management-using-vue-composition-api-e38ce24bc8af?source=collection_archive---------7-----------------------#2021-04-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1f0402f5e40ddf677923f67f2fc6ab6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*REg6Imq19hN30EmI"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@florianolv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Florian Olivo</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="54d4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我最近测试了Vue 3的新合成API特性。一开始我很沉默，但一旦我习惯了，它就超出了我的预期。</p><p id="5a33" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如Vue 3宣布的那样，Composition API是为了解决多个问题:</p><ul class=""><li id="f042" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">组件代码被分割成许多区域，使得阅读和维护变得困难。</li><li id="cc8c" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">组件逻辑很难拆分成多个文件。</li><li id="da26" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">TypeScript支持不好。</li></ul><p id="6516" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了修复这些问题，Vue 3还带来了一个新的东西，称为反应API，这就是我们今天要谈论的内容。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="3ebf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">实际上，大多数Vue.js项目使用Vuex来管理状态，请放心，Vuex仍然是最新的。但几个月来，有几种替代方案可供选择:</p><ul class=""><li id="9b24" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">使用组合API和反应API创建我们自己的状态。</li><li id="1b43" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><a class="ae jz" href="https://pinia.esm.dev/" rel="noopener ugc nofollow" target="_blank">皮尼亚</a>，这个我们这里就不说了。但我想提一下，因为它很有前途。</li></ul><p id="01e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为什么我们应该使用这些解决方案而不是Vuex？其实Vuex还是很不错的，因为它的插件和dev-tools支持。但我也认为Vuex是多余的，因为代码看起来重复，大部分是因为突变。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="1eef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们深入研究代码。我们以此为例，一个计数器分为两个部分:显示值的计数器和增加值的增量(看起来合乎逻辑)。</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/be313ba689e53c852fb410aed95a620f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YJSQIGbhhA4qq_5uY6qHTg.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The final result. The code is available on my GitHub, link at the end.</figcaption></figure><p id="f5e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们将定义我们的状态。我通常把它定义到一个叫做<code class="fe ly lz ma mb b">composables</code>或者<code class="fe ly lz ma mb b">stores</code>的目录里。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="8f03" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在注释中解释了一切，但是这里要记住的重要事情是声明状态远离函数，然后返回状态的引用。</p><p id="1ee2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如在Vue.js文档中解释的，如果我们不指定<code class="fe ly lz ma mb b">toRefs</code>，它将通过值传递，正如你在下面看到的，第一个杯子没有更新。</p><figure class="lu lv lw lx gt jo gh gi paragraph-image"><div class="gh gi me"><img src="../Images/66f65025ca9f5a32daa84a5cc7bfdf51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*GXoMWqljArmbjB0ReNioag.gif"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Pass by reference VS pass by value.</figcaption></figure><p id="d12d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦我们的可组合状态被定义，我们就可以在Vue.js组件中毫无问题地使用它。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="f9e0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ly lz ma mb b">Counter.vue</code>将显示计数器值。</p><p id="67c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在这里尽可能地简化了代码。GitHub上有更好看的渲染(使用TailwindCSS)。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="a542" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ly lz ma mb b">Increment.vue</code>将增加或减少数值。</p><p id="2525" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如你所见，我们可以使用可组合的方法(如<code class="fe ly lz ma mb b">increment</code>)或者直接改变状态。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="a563" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">吸气剂等其他功能呢？当然有可能。我们可以在状态(<code class="fe ly lz ma mb b">useCounter.ts</code>)中定义它们，并使用新的<code class="fe ly lz ma mb b">computed</code>函数。</p><figure class="lu lv lw lx gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="7de6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们结束这篇文章。因此，我们在这里可以看到，使用Composition API创建一个状态非常简单，并且不需要任何依赖。</p><p id="d73e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还应该使用Vuex吗？看情况。我实际上正在使用Firebase和Vue 3开发一个类似CRM的应用程序，我还在使用Vuex进行身份验证，因为它工作得很好，并且与Firebase很好地实现了。</p><p id="dca5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">但是，相比之下，我现在将组合API状态用于不太复杂的情况，比如多个组件需要相同的数据。</p><p id="1724" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">建立一个新的Vuex存储，getters，突变，动作对于小块的数据来说是很累人的，这就是为什么我使用这两种方法。</p><p id="a2c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在我的GitHub上找到我用来写这篇文章的代码，就在这里:</p><div class="mf mg gp gr mh mi"><a href="https://github.com/vlourme/composition-api-state" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd io gy z fp mn fr fs mo fu fw im bi translated">vlourme/composition-api-state</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">这个存储库是为一篇中型文章制作的，它解释了如何创建一个真正简单的状态，甚至不需要…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div></div></a></div><p id="8a14" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您也可以在这里找到预览:</p><div class="mf mg gp gr mh mi"><a href="https://vue3-composition-state.netlify.app/" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd io gy z fp mn fr fs mo fu fw im bi translated">Vite应用</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">编辑描述</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">vu E3-composition-state . net lify . app</p></div></div></div></a></div><p id="7325" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有什么建议就留言评论吧。</p><p id="72b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mr">更多内容尽在</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mr">plain English . io</em></a></p></div></div>    
</body>
</html>