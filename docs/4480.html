<html>
<head>
<title>Why Does CORS Hate Me?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么CORS讨厌我？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-does-cors-hate-me-9b53a0bdaf31?source=collection_archive---------20-----------------------#2021-09-06">https://javascript.plainenglish.io/why-does-cors-hate-me-9b53a0bdaf31?source=collection_archive---------20-----------------------#2021-09-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/07f5eb51a4782cb489cca9f9f8d9bedd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b_I4LDS0bICAcnC1bdOM2g.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@franciscoegonzalez?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Francisco Gonzalez</a> on <a class="ae kc" href="https://unsplash.com/s/photos/depression?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8464" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您以前尝试过发出API请求，您可能会遇到这样的错误:</p><p id="3d25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb"> xxx已被CORS策略阻止:请求的资源上不存在Access-Control-Allow-Origin标头。</em></p><p id="aa33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就这样，你被CORS政策划分为朋友区。</p><p id="9702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但我甚至不知道CORS是什么。我要怎么让它重新喜欢上我？</p><p id="41d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">作为一个多次遇到这个问题的人，我无法告诉你这有多令人沮丧。幸运的是，我们可以通过一些简单的步骤来解决这种爱恨交加的关系。</p><p id="cccd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们看看如何才能重新点燃我们与CORS的友谊。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="1bf5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">什么是CORS？</h1><p id="1202" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">就像在现实生活中一样，在我们的友谊进入下一阶段之前，我们必须先了解CORS。跨源资源共享，或CORS，防止其他人试图访问来自不同来源的资产或数据，而不是出于安全目的运行我们的应用程序的来源。</p><p id="3b4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">想象一下，你刚买了一栋房子。房子里有一堆不同的物品，或者珍贵的财产，这些都是你努力工作换来的。你决定和你所有的朋友和家人举行一个小型的乔迁派对。与此同时，一群路人注意到你正在举办派对，并决定他们想加入庆祝活动。</p><p id="21f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不知道你怎么想，但是除非我知道这些陌生人是谁，否则我不希望他们未经我允许就擅自进来。CORS政策也是如此。</p><p id="7b0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">CORS在那里保护我们免受路人的攻击，这些人可能会在那里窃取我们的资产或数据。就像俱乐部的保镖，除非你在名单上，否则你进不去。</p><p id="dc8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很高兴知道有人在这里照顾我们。</p><p id="56de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们看看CORS的行动。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="2d46" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">CORS在行动</h1><p id="bb63" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">要看到这一点，我们必须首先设置一个外部服务器来发出请求。</p><p id="5c02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们可以创建一个新项目——您可以随意命名它——并将其命名为<code class="fe mm mn mo mp b">external-server</code>。一旦完成，我们将打开一个新的终端并运行命令<code class="fe mm mn mo mp b">npm init -y</code>，这将为我们提供一个<code class="fe mm mn mo mp b">package.json</code>文件。现在我们可以通过运行命令<code class="fe mm mn mo mp b">npm install express</code>来安装express包。</p><p id="995b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，让我们添加一个新文件并将其命名为<code class="fe mm mn mo mp b">server.js</code>，并用以下内容替换该文件:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1287" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们为应用程序创建了一个要访问的端点，名为<code class="fe mm mn mo mp b">/hello-world</code>。重要的是，外部服务器使用不同的端口，而不是我们的应用程序使用的端口，这样才能正常工作。我们现在可以通过在终端中运行<code class="fe mm mn mo mp b">npm start</code>来启动我们的外部服务器。</p><p id="4b7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，让我们设置我们的web应用程序。</p><p id="8bca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们创建一个新的项目——无论你怎么称呼它——我将称它为<code class="fe mm mn mo mp b">my-app</code>。从我们的终端，我们可以运行命令<code class="fe mm mn mo mp b">npx create-react-app client</code>，它将创建我们的客户端应用程序所需的所有文件。</p><p id="b501" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成后，我们可以导航到我们的<code class="fe mm mn mo mp b">App.js</code>文件，并用以下内容替换它:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9c90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行<code class="fe mm mn mo mp b">npm start</code>之后，我们现在可以尝试从外部服务器调用API。</p><p id="46ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们做了所有正确的事情，我们的API请求应该会像预期的那样失败。如果我们看一下控制台，我们可以看到我们确实被CORS政策阻挡了。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/93ce4114277d20bd97edcb20282de26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*ycnRJPnZw3BSXeXy_mBxvQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Blocked by CORS policy</figcaption></figure><p id="12bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">看起来我们还有一段路要走，直到CORS接受我们回到它的生活中。那么，我们如何着手解决这个问题呢？</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="c518" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">让我们成为朋友吧</h1><p id="22bf" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">由于我们试图向不同于我们自己的源发出请求，我们无法从外部服务器检索数据。解决这个问题的一种方法是通过添加一行代码来允许跨来源访问我们的外部服务器。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="79ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们允许跨源访问我们的外部端点，并再次运行我们的示例，我们可以看到这次我们的请求是成功的。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d100871e3dac33e34ad913150782e50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*8rhulAEbTKnjR1-YX109aw.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Not blocked by CORS policy</figcaption></figure><p id="c8ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在现实世界中，我们向其发出请求的服务器允许像这样的跨源访问是不常见的。另外，无论如何，直接从我们的客户那里发出API请求是不好的做法。因此，我们应该忽略这个选项，并从我们的外部服务器中删除跨源访问。</p><p id="8ea9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么正确的做法是什么呢？</p><p id="4662" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，实现这一点的最佳方式是通过我们的应用服务器而不是客户端发出API请求。在我们当前的应用程序中还没有设置，所以我们现在就开始吧。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="67db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe mm mn mo mp b">my-app</code>文件夹中，我们应该创建一个名为<code class="fe mm mn mo mp b">server</code>的新文件夹。在这里，我们想要创建一个名为<code class="fe mm mn mo mp b">server.js</code>的文件。打开一个新的终端选项卡并运行命令<code class="fe mm mn mo mp b">npm init -y</code>，像以前一样安装express，并将我们的文件更改为以下内容:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="02b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们的项目中应该有两个文件夹，<code class="fe mm mn mo mp b">client</code>和<code class="fe mm mn mo mp b">server</code>。让我们通过运行命令<code class="fe mm mn mo mp b">npm i axios</code>将Axios包安装到客户机和服务器文件夹中。这将允许我们向我们的应用服务器发出请求，然后我们将使用它向外部服务器发出API请求。</p><p id="4b04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的<code class="fe mm mn mo mp b">client</code>文件夹中，我们需要导航到我们的<code class="fe mm mn mo mp b">package.json</code>文件并添加下面一行:<code class="fe mm mn mo mp b">"proxy": "http://localhost:3001"</code>。这是非常重要的，否则它不会工作。</p><p id="e8fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们继续对我们的<code class="fe mm mn mo mp b">App.js</code>文件做一些修改，如下所示:</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="ec14" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们保存所有文件，并再次重新运行它们，看看会发生什么。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div class="gh gi my"><img src="../Images/1685f489e1d11721f9a42be088662709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*RalIw70GTIY7g-qg8NsaTg.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Not blocked by CORS policy</figcaption></figure><p id="087a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">厉害！成功了！</p><p id="d51f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过从我们的应用程序服务器发出请求，我们已经成功地从不同来源的外部服务器检索到数据。这需要一点说服力，但我认为可以肯定地说，我们已经重新赢得了友谊。</p><h1 id="7da3" class="lj lk iq bd ll lm mz lo lp lq na ls lt lu nb lw lx ly nc ma mb mc nd me mf mg bi translated">结论</h1><p id="529c" class="pw-post-body-paragraph kd ke iq kf b kg mh ki kj kk mi km kn ko mj kq kr ks mk ku kv kw ml ky kz la ij bi translated">正如你所看到的，与CORS打交道可能有点令人头疼。凭借一点点知识和诀窍，我们可以通过简单的几步来消除这些问题。</p><p id="e3c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于新开发人员来说，这不是一个容易理解的概念，但是我希望通过更好地解释这一点，您可以更好地理解它是如何工作的。</p><p id="95a7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢阅读，下期再见。</p><p id="5dbb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="lb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>