<html>
<head>
<title>Getting Started with Making HTTP Requests with React Query</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始使用React Query发出HTTP请求</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-making-http-requests-with-react-query-6c018f57bdd5?source=collection_archive---------15-----------------------#2021-05-11">https://javascript.plainenglish.io/getting-started-with-making-http-requests-with-react-query-6c018f57bdd5?source=collection_archive---------15-----------------------#2021-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bbb0d679b79259a8ea7d51e8c9c1df7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1lwgTzmeJJuH7Aaj"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@hermez777?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hermes Rivera</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5097" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React查询库让我们可以在React应用程序中轻松地发出HTTP请求。</p><p id="cda7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用React Query发出HTTP请求。</p><h1 id="24df" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="ef5c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过运行以下命令来安装该库:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0767" class="mn lc iq mj b gy mo mp l mq mr">npm i react-query</span></pre><p id="0e2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4753" class="mn lc iq mj b gy mo mp l mq mr">yarn add react-query</span></pre><p id="e886" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还安装了Axios HTTP客户端库，让请求变得更容易。</p><p id="6476" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0025" class="mn lc iq mj b gy mo mp l mq mr">npm i axios</span></pre><h1 id="b0f8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">入门指南</h1><p id="3758" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">然后，我们可以通过编写以下代码使用API进行查询:</p><p id="db77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9303" class="mn lc iq mj b gy mo mp l mq mr">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { QueryClient, QueryClientProvider } from "react-query";<br/>import App from "./App";</span><span id="881f" class="mn lc iq mj b gy mv mp l mq mr">const queryClient = new QueryClient();</span><span id="bfbf" class="mn lc iq mj b gy mv mp l mq mr">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;QueryClientProvider client={queryClient}&gt;<br/>    &lt;StrictMode&gt;<br/>      &lt;App /&gt;<br/>    &lt;/StrictMode&gt;<br/>  &lt;/QueryClientProvider&gt;,<br/>  rootElement<br/>);</span></pre><p id="8c1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">App.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9ea4" class="mn lc iq mj b gy mo mp l mq mr">import axios from "axios";<br/>import React from "react";<br/>import { useQuery } from "react-query";</span><span id="85b3" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  const { isLoading, error, data } = useQuery("yesNo", () =&gt;<br/>    axios("https://yesno.wtf/api")<br/>  );</span><span id="6414" class="mn lc iq mj b gy mv mp l mq mr">  if (isLoading) return "Loading...";</span><span id="b85b" class="mn lc iq mj b gy mv mp l mq mr">  if (error) return "An error has occurred: " + error.message;</span><span id="a882" class="mn lc iq mj b gy mv mp l mq mr">  return &lt;div&gt;{JSON.stringify(data)}&lt;/div&gt;;<br/>}</span></pre><p id="c804" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将我们的<code class="fe ms mt mu mj b">App</code>组件包装在<code class="fe ms mt mu mj b">QueryClientProvider</code>组件周围，让我们使用它的钩子来发出请求。</p><p id="9d78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe ms mt mu mj b">App</code>中，我们使用<code class="fe ms mt mu mj b">useQuery</code>钩子发出一个GET请求。</p><p id="4892" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是查询的字符串标识符。</p><p id="29b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数的作用是让我们发出请求。</p><p id="52f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">isLoading</code>状态表示当请求为真时正在加载。</p><p id="5f73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">error</code>状态为真时表示发生了错误。</p><p id="9f4a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">data</code>已响应数据。</p><h1 id="defb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提出发布请求</h1><p id="e31e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要发出POST请求，我们可以使用<code class="fe ms mt mu mj b">useMutation</code>钩子。</p><p id="31f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0425" class="mn lc iq mj b gy mo mp l mq mr">import axios from "axios";<br/>import React from "react";<br/>import { useMutation, useQueryClient } from "react-query";</span><span id="0dc3" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  const queryClient = useQueryClient();<br/>  const mutation = useMutation(<br/>    (data) =&gt; axios.post("https://jsonplaceholder.typicode.com/posts", data),<br/>    {<br/>      onSuccess: () =&gt; {<br/>        queryClient.invalidateQueries("todos");<br/>      }<br/>    }<br/>  );</span><span id="8d4e" class="mn lc iq mj b gy mv mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      &lt;button<br/>        onClick={() =&gt; {<br/>          mutation.mutate({<br/>            title: "foo",<br/>            body: "bar",<br/>            userId: 1<br/>          });<br/>        }}<br/>      &gt;<br/>        Add Todo<br/>      &lt;/button&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="b014" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们保持<code class="fe ms mt mu mj b">index.js</code>和前面的例子一样。</p><p id="8125" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe ms mt mu mj b">useQueryClient</code>钩子来获取查询客户机。</p><p id="595f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">useMutation</code>让我们通过传入一个回调来发出请求，这个回调通过用我们想要的URL和请求体调用<code class="fe ms mt mu mj b">axios.post</code>来返回一个承诺。</p><p id="3818" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数有一个对象，该对象有一个在请求成功时运行的<code class="fe ms mt mu mj b">onSuccess</code>回调。</p><p id="10a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用请求清除资源的标识符调用<code class="fe ms mt mu mj b">queryClient.invalidaQueries</code>。</p><h1 id="d841" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="d429" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用React查询库轻松地发出HTTP请求。</p><p id="d97b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>