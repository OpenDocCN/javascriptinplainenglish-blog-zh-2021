<html>
<head>
<title>Documenting Controlled Components with Storybook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用故事书记录受控组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-guide-to-documenting-controlled-components-with-storybook-10b889c03f87?source=collection_archive---------2-----------------------#2021-01-05">https://javascript.plainenglish.io/a-guide-to-documenting-controlled-components-with-storybook-10b889c03f87?source=collection_archive---------2-----------------------#2021-01-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="58fe" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">管理外部故事书状态指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/81cb77b4b844e997d699e41d4c8a34a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PlsGAv08yXyli794"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="04e4" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的旅程</h1><p id="1fd2" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><a class="ae ks" href="https://medium.com/javascript-in-plain-english/storybook-is-your-new-ui-component-explorer-22e9e69b9d0f" rel="noopener"> Storybook是一个奇妙的组件浏览器和游乐场</a>。我用它来开发、演示和记录我代码库中的所有组件。用户可以了解组件的工作原理和控制方式。但是，尽管为按钮、网格和表格等无状态组件设置故事很简单，但需要外部状态的组件(如表单输入)需要更多的配置。</p><h1 id="3eea" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">故事书</h1><p id="f0c8" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">先说一点背景。让我们看看这个输入组件</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="9f31" class="mm ku in mi b gy mn mo l mp mq">const Input = props =&gt; {<br/>  const { className, onChange, type, value } = props;<br/>  return (<br/>    &lt;input<br/>      className={className}<br/>      onChange={e =&gt; onChange(e.target.value)}<br/>      type={type}<br/>      value={value}<br/>    /&gt;<br/>  );<br/>};</span></pre><p id="46f0" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">为该组件编写的故事如下所示:</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="73bf" class="mm ku in mi b gy mn mo l mp mq">import Input from './Input';</span><span id="34bf" class="mm ku in mi b gy mw mo l mp mq">export default {<br/>  title: 'Input',<br/>  component: Input,<br/>};</span><span id="3b36" class="mm ku in mi b gy mw mo l mp mq">const Template = args =&gt; &lt;Input {...args} /&gt;</span><span id="ab38" class="mm ku in mi b gy mw mo l mp mq">export const Default = Template.bind({});</span><span id="0008" class="mm ku in mi b gy mw mo l mp mq">export const Number = Template.bind({});<br/>Number.args = {<br/>  type: 'number',<br/>};</span><span id="ed33" class="mm ku in mi b gy mw mo l mp mq">export const Password = Template.bind({});<br/>Password.args = {<br/>  type: 'password',<br/>};</span><span id="8635" class="mm ku in mi b gy mw mo l mp mq">export const Value = Template.bind({});<br/>Value.args = {<br/>  value: 'value',<br/>};</span></pre><p id="b563" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">模板是一个抽象层，可以减少冗余代码的数量。每个命名的导出创建这个模板的副本，并通过<code class="fe mx my mz mi b">args</code>定义故事的道具。Storybook将采用这些并以导出名称作为标题展示故事。</p><h1 id="10ae" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">状态</h1><p id="9da4" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">由于这个<code class="fe mx my mz mi b">Input</code>组件要求您提供<code class="fe mx my mz mi b">onChange</code>和<code class="fe mx my mz mi b">value</code>，我们需要使用Storybook以某种方式管理这个状态。但是在哪里？如果你仔细看看，模板本身就是一个React功能组件，因此，我们可以使用<code class="fe mx my mz mi b">useState</code>钩子来管理输入状态！</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="bdcf" class="mm ku in mi b gy mn mo l mp mq">const Template = args =&gt; {<br/>  const [value, setValue] = useState(args.value ?? '');<br/>  return (<br/>    &lt;&gt;<br/>      &lt;Input<br/>        {...args}<br/>        onChange={(...params) =&gt; {<br/>          args.onChange(...params);<br/>          setValue(...params);<br/>        }}<br/>        value={value}<br/>      /&gt;<br/>      &lt;pre style={{ marginTop: 10 }}&gt;<br/>        {JSON.stringify({ value }, null, 2)}<br/>      &lt;/pre&gt;<br/>    &lt;/&gt;<br/>  );<br/>};</span></pre><ul class=""><li id="069c" class="na nb in ln b lo mr lr ms lu nc ly nd mc ne mg nf ng nh ni bi translated">初始状态设置为<code class="fe mx my mz mi b">args.value</code>。这是为了让我们可以有一个定义价值的故事来演示这个道具是如何工作的。</li><li id="0969" class="na nb in ln b lo nj lr nk lu nl ly nm mc nn mg nf ng nh ni bi translated">为<code class="fe mx my mz mi b">Input</code>定义的<code class="fe mx my mz mi b">onChange</code>函数不仅触发状态钩子更新器，还触发<code class="fe mx my mz mi b">args.onChange</code>。默认故事书设置自动为所有匹配<code class="fe mx my mz mi b">^on[A-Z].*</code>正则表达式的道具注入一个<a class="ae ks" href="https://www.npmjs.com/package/@storybook/addon-actions" rel="noopener ugc nofollow" target="_blank">故事书动作记录器</a>。注入的函数将在actions选项卡中记录每个函数调用及其参数，以便用户可以了解它是何时以及如何被触发的。</li><li id="7681" class="na nb in ln b lo nj lr nk lu nl ly nm mc nn mg nf ng nh ni bi translated"><code class="fe mx my mz mi b">pre</code>标签显示状态值。虽然不是完全必要的，但是这个状态值对于组件如何工作是必不可少的，所以呈现它有助于用户更好地理解组件。</li></ul><p id="834a" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">有了这个模板更改，我们的<code class="fe mx my mz mi b">Input</code>组件现在可以像预期的那样交互了。</p><h1 id="82cb" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">控制</h1><p id="7f39" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">如果您正在使用<a class="ae ks" href="https://www.npmjs.com/package/@storybook/addon-controls" rel="noopener ugc nofollow" target="_blank">故事书的控件插件</a>(自动包含在<a class="ae ks" href="https://www.npmjs.com/package/@storybook/addon-essentials" rel="noopener ugc nofollow" target="_blank">故事书必备品</a>中)，控制值道具的控件也应该被禁用。由于该值是通过<code class="fe mx my mz mi b">setState</code>控制的，所以如果在控制选项卡中改变了正确的值，将不会发生任何事情。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="6e37" class="mm ku in mi b gy mn mo l mp mq">export default {<br/>  title: 'Input',<br/>  component: Input,<br/>  argTypes: {<br/>    // controlled value prop<br/>    value: {<br/>      control: {<br/>        disable: true,<br/>      },<br/>    },<br/>  },<br/>};</span></pre><p id="bff6" class="pw-post-body-paragraph ll lm in ln b lo mr jo lq lr ms jr lt lu mt lw lx ly mu ma mb mc mv me mf mg ig bi translated">注意，我们不需要禁用<code class="fe mx my mz mi b">onChange</code>，因为故事书控件是为功能道具自动禁用的。</p></div><div class="ab cl no np hr nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ig ih ii ij ik"><h1 id="d8e4" class="kt ku in bd kv kw nv ky kz la nw lc ld jt nx ju lf jw ny jx lh jz nz ka lj lk bi translated">最后的想法</h1><p id="a9be" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">故事书让我和我的团队受益良多。它使开发人员能够在一个地方展示和记录他们组件库的所有特性。使用这个简单的技巧来管理故事模板中的状态，甚至可以在故事书中记录受控制的组件，使用户能够在一个简单但强大的交互式操场上快速学习特性和功能。</p></div><div class="ab cl no np hr nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ig ih ii ij ik"><h1 id="2b76" class="kt ku in bd kv kw nv ky kz la nw lc ld jt nx ju lf jw ny jx lh jz nz ka lj lk bi translated">资源</h1><ul class=""><li id="f0fb" class="na nb in ln b lo lp lr ls lu oa ly ob mc oc mg nf ng nh ni bi translated"><a class="ae ks" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank">官方故事书文档</a></li><li id="e717" class="na nb in ln b lo nj lr nk lu nl ly nm mc nn mg nf ng nh ni bi translated"><a class="ae ks" href="https://medium.com/javascript-in-plain-english/storybook-is-your-new-ui-component-explorer-22e9e69b9d0f" rel="noopener">设置故事书指南</a></li><li id="d55d" class="na nb in ln b lo nj lr nk lu nl ly nm mc nn mg nf ng nh ni bi translated"><a class="ae ks" href="https://github.com/mjchang/medium/tree/master/storybook-state" rel="noopener ugc nofollow" target="_blank">本条Github回购</a></li></ul></div></div>    
</body>
</html>