<html>
<head>
<title>Consuming APIs with Axios</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Axios消费API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/consuming-api-made-easy-effective-with-axios-393bf0441a75?source=collection_archive---------10-----------------------#2021-04-06">https://javascript.plainenglish.io/consuming-api-made-easy-effective-with-axios-393bf0441a75?source=collection_archive---------10-----------------------#2021-04-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0c135ea9ce7ccd8d34f111fc343735fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X9B6I_6dvAbXzBBd"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@thomast_404?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thomas Tastet</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5dc5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">随着项目的增长，在使用API的过程中做所有手工重复的事情变得非常麻烦，比如给请求添加一个令牌，从响应中显示通知，从响应中处理错误等等……<br/>此外，如果你想在流程中做一些改变，更新每个API对整个团队来说都是一场噩梦。让我们从一个例子开始:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="6af7" class="lh li in ld b gy lj lk l ll lm">// api-call.js</span><span id="44c2" class="lh li in ld b gy ln lk l ll lm">try {<br/>  const res = await axios.post('http://myserver.com/post', {<br/>    headers: {<br/>      authorization: 'my secret token'<br/>    }<br/>  });<br/>  const { success, data, message } = res.data;<br/>  successNotification(message);<br/>  <br/>  doSomethingWithData(data);</span><span id="924b" class="lh li in ld b gy ln lk l ll lm">} catch (error) {<br/>  errorNotification(error.response.data.message);<br/>  doSomethingWithError(error);<br/>}</span></pre><p id="16a4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于您使用的每一个API，我们都需要以这种方式编写大量重复的代码。现在，让我们看看更好的解决方案:</p><p id="7e7c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，首先我们需要收集我们想要处理的问题，举几个例子:<br/> 1:在请求头中自动嵌入令牌<br/> 2:处理来自响应的错误<br/> 3:来自响应的通知<br/> 4:使这一切易于管理</p><p id="84aa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">axios中有一个特性，<code class="fe lo lp lq ld b">interceptors</code>，我们可以使用它在API调用的基础上增加一层，处理所有提到的东西，我们只需要关注更重要的东西。这充当了所有使用的API的接口。<br/>举例:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="20c4" class="lh li in ld b gy lj lk l ll lm">// api-interface.js</span><span id="b601" class="lh li in ld b gy ln lk l ll lm">const instance = axios.create({<br/>headers: {<br/>  Accept: 'application/json',<br/>  'Content-Type': 'application/json',<br/>  'Access-Control-Allow-Origin': '*',<br/>  },<br/>});</span><span id="a585" class="lh li in ld b gy ln lk l ll lm">instance.interceptors.request.use((<em class="lr">config</em>) =&gt; {<br/>  // invoked before every API call</span><span id="1c03" class="lh li in ld b gy ln lk l ll lm">  config.headers.Authorization = '<!-- -->my secret token<!-- -->';<br/>  return config;</span><span id="cf64" class="lh li in ld b gy ln lk l ll lm">}, (<em class="lr">error</em>) =&gt; {<br/>  // invoked if error occurs in API call  </span><span id="088e" class="lh li in ld b gy ln lk l ll lm">  return Promise.reject(error);<br/>});</span><span id="a120" class="lh li in ld b gy ln lk l ll lm">instance.interceptors.response.use((<em class="lr">response</em>) =&gt; {<br/>  // invoked after successful API response<br/>  <br/>  successNotification(response.data.message);<br/>  return response.data;<br/>}, (<em class="lr">error</em>) =&gt; {<br/>  // invoked after error in API response</span><span id="31f2" class="lh li in ld b gy ln lk l ll lm">  errorNotification(error.response.data.message);<br/>  doSomethingWithError(error); <br/>  return Promise.reject(error.response.data);<br/>});</span><span id="31cc" class="lh li in ld b gy ln lk l ll lm">export default instance;</span></pre><p id="9672" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的代码片段中，我们用<strong class="kc io"> axios拦截器</strong>制作了一个<code class="fe lo lp lq ld b">api-interface</code>，可以很容易地使用它来消费API，它将通过定义的重复流程。这是API现在的样子:</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="13be" class="lh li in ld b gy lj lk l ll lm">// api-call.js<br/>import api from 'api-interface';</span><span id="372a" class="lh li in ld b gy ln lk l ll lm">try {<br/>  const res = await api.post('http://myserver.com/post');<br/>  const { data } = res.data;<br/>  <br/>  doSomethingWithData(data);<br/>} catch (error) {<br/>  doSomethingWithError(error);<br/>}</span></pre><p id="6f0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看，现在使用一个API是多么简单，使用这个接口就可以处理所有的任务，并把API的最终结果返回给我们。</p><p id="81b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是我的完整文件的链接。你也可以检查回购，它的设计保持生产力，规模铭记。</p><div class="ls lt gp gr lu lv"><a href="https://github.com/dhruv479/react-redux/blob/master/src/services/api.interface.js" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab fo"><div class="lx ab ly cl cj lz"><h2 class="bd io gy z fp ma fr fs mb fu fw im bi translated">dhruv479/react-redux</h2><div class="mc l"><h3 class="bd b gy z fp ma fr fs mb fu fw dk translated">在GitHub上创建一个帐户，为dhruv479/react-redux开发做贡献。</h3></div><div class="md l"><p class="bd b dl z fp ma fr fs mb fu fw dk translated">github.com</p></div></div></div></a></div><p id="a6ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lr">我希望你喜欢这篇文章，并发现它很有价值。可以关注我上</em> <a class="ae jz" href="https://dhruv479.medium.com" rel="noopener"> <em class="lr">中</em> </a> <em class="lr">和</em> <a class="ae jz" href="https://twitter.com/dhruv479" rel="noopener ugc nofollow" target="_blank"> <em class="lr">推特</em> </a> <em class="lr">。感谢支持！</em></p><p id="1d4a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lr">更多内容请看</em><a class="ae jz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lr">plain English . io</em></strong></a></p></div></div>    
</body>
</html>