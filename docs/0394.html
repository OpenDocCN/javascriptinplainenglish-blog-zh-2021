<html>
<head>
<title>Getting Started With React Server Side Rendering Using Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js开始反应服务器端渲染</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-react-server-side-rendering-using-next-js-ba9ed691fa85?source=collection_archive---------10-----------------------#2021-01-23">https://javascript.plainenglish.io/getting-started-with-react-server-side-rendering-using-next-js-ba9ed691fa85?source=collection_archive---------10-----------------------#2021-01-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="12dc" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个全面的框架，用于增强您的React应用程序</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/01078058fbf008e47612344946d864cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ua0mkVh3JEL2-I8MJD2IRw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Next.JS — From <a class="ae kv" href="https://commons.wikimedia.org/wiki/File:Nextjs-logo.svg" rel="noopener ugc nofollow" target="_blank">Wikimedia Commons</a></figcaption></figure><p id="4af4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Next.js是一个开源的web框架，它支持服务器端呈现(SSR)以进行反应。SSR是在服务器上而不是客户端上呈现<strong class="ky ir">初始</strong>网页的过程。</p><p id="3cb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在处理完JavaScript捆绑包之前，客户端呈现的反应页面只有最少量的HTML。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Typical <strong class="ak">index.html</strong> for a React app</figcaption></figure><p id="0b92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">加载页面时，您最初会看到一个空白屏幕。下载并处理JavaScript捆绑包，以生成呈现页面所需的HTML。</p><p id="8141" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JS捆绑包是任何React应用程序不可或缺的一部分。以下任何一个因素都会增加加载它所需的时间，导致您的用户盯着空白页看的时间更长:</p><ul class=""><li id="767b" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated">缓慢的互联网连接</li><li id="5130" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">大束尺寸</li><li id="95e6" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated">慢速处理器</li></ul><p id="9fbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SSR旨在通过在将页面发送给客户端之前，在服务器上执行<strong class="ky ir">初始</strong>页面渲染来解决这些问题。这样，客户端收到的第一页包含所有预先呈现的HTML，可以立即在屏幕上绘制。导致更快的加载时间和改进的搜索引擎优化排名。</p><h1 id="5c50" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">获取设置</h1><p id="5845" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">首先，您需要<a class="ae kv" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">安装Node.js 10.13 </a>或更高版本。</p><p id="5ed5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后打开您选择的终端，运行以下命令创建一个应用程序。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="7ef8" class="nk mj iq ng b gy nl nm l nn no">npx create-next-app</span></pre><p id="3c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将提示您为应用程序选择一个名称。然后，安装程序将自动在一个单独的目录中创建所有内容。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi np"><img src="../Images/67e1142ac1e9408acbe0886b25be4acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Du3nYtDc6SoSU3jHJtdZhQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Create Next App — From <a class="ae kv" href="https://carbon.now.sh/" rel="noopener ugc nofollow" target="_blank">Carbon</a></figcaption></figure><p id="cad8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此时，您可以将cd放入目录并运行开发服务器。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="18fd" class="nk mj iq ng b gy nl nm l nn no">cd next-demo<br/>npm run dev</span></pre><p id="7b8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你去<code class="fe nq nr ns ng b">localhost:3000</code>应该会有登陆页面迎接你。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/fd74b5b89fe2a18d4281689020d8fd15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iREPnYkNcqc0gULIK_ItZA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Next App Default Page — Image by Author</figcaption></figure><p id="34fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您现在可以开始构建组件了，就像使用任何React应用程序一样。让我们来看看Next.js提供的一些特性，以及我们如何实现它们。</p><p id="bf59" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nu"> Next.js有完整的文档，在</em> <a class="ae kv" href="https://nextjs.org/learn/basics/create-nextjs-app" rel="noopener ugc nofollow" target="_blank"> <em class="nu">这里</em> </a> <em class="nu">可以找到。</em></p><h1 id="9e78" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">按指定路线发送</h1><p id="0c07" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">Next.js提供的一个很好的特性是其内置的路由系统。除了创建支持它们的相关页面和目录结构之外，不需要配置。</p><h2 id="2f54" class="nk mj iq bd mk nv nw dn mo nx ny dp ms lf nz oa mu lj ob oc mw ln od oe my of bi translated">静态路由</h2><p id="62f7" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">内置路由器会自动将目录中的<code class="fe nq nr ns ng b">index.js</code>页路由到其基本路由。这就是为什么在我们的初始设置中<code class="fe nq nr ns ng b">index.js</code>映射到<code class="fe nq nr ns ng b">localhost:3000/</code>。</p><p id="8449" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下示例说明了默认路由器对索引页的工作方式。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="c2d4" class="nk mj iq ng b gy nl nm l nn no">pages/index.js                 --&gt;  /<br/>pages/product/index.js         --&gt;  /product<br/>pages/product/books/index.js   --&gt;  /product/books</span></pre><h2 id="2a2b" class="nk mj iq bd mk nv nw dn mo nx ny dp ms lf nz oa mu lj ob oc mw ln od oe my of bi translated">嵌套路由</h2><p id="a036" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">扩展我们现有的目录结构，让我们继续添加产品页面。在pages目录下，创建一个名为<code class="fe nq nr ns ng b">product.js</code>的新文件。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="c06a" class="nk mj iq ng b gy nl nm l nn no">pages/<br/>  _app.js<br/>  index.js      --&gt; /<br/>  <strong class="ng ir">product.js    </strong>--&gt; /product<strong class="ng ir"><br/></strong>public/<br/>styles/</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Simple<strong class="ak"> /pages/product.js</strong> page</figcaption></figure><p id="58e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您前往<code class="fe nq nr ns ng b">http://localhost:3000/product</code>，这将带您进入产品页面。就这么简单！</p><h2 id="a7dc" class="nk mj iq bd mk nv nw dn mo nx ny dp ms lf nz oa mu lj ob oc mw ln od oe my of bi translated">动态路线</h2><p id="1c46" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">让我们更进一步，创建动态路线。我们可以通过使用一个<a class="ae kv" href="https://en.wikipedia.org/wiki/Clean_URL#Slug" rel="noopener ugc nofollow" target="_blank">标签</a>来标识我们的产品页面。</p><blockquote class="og oh oi"><p id="d391" class="kw kx nu ky b kz la jr lb lc ld ju le oj lg lh li ok lk ll lm ol lo lp lq lr ij bi translated">一个slug只是一个URL的一部分，它用人类可读的文字来标识一个页面。</p></blockquote><p id="3865" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你只需要将你的页面名称放在方括号<code class="fe nq nr ns ng b">/pages/product/[slug].js</code>中。然后，可以从Next.js路由器对象中提取该参数。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="901d" class="nk mj iq ng b gy nl nm l nn no">pages/<br/>  _app.js<br/>  index.js<br/>  product/<br/>    <strong class="ng ir">[slug].js</strong>   --&gt; /product/{your-slug-here}<strong class="ng ir"><br/></strong>public/<br/>styles/</span></pre><p id="ab48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你不必把这个叫做<strong class="ky ir"> slug，</strong>但是任何名字都适合你的应用。我们修改后的产品页面如下所示。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="ak">/pages/product/[slug].js</strong> dynamic route page</figcaption></figure><h1 id="dbb6" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">服务器端获取</h1><p id="0bac" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">如果您的页面在加载之前需要一些数据，您可以通过让服务器发出请求并向页面组件提供属性来优化这个过程。</p><p id="75aa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这可以通过两种方式之一实现，具体取决于您想要注入页面的内容是静态的还是动态的。这些功能是在服务器端执行的，所以客户端永远看不到它们。</p><h2 id="5c46" class="nk mj iq bd mk nv nw dn mo nx ny dp ms lf nz oa mu lj ob oc mw ln od oe my of bi translated">静态属性</h2><p id="742c" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated"><code class="fe nq nr ns ng b">getStaticProps</code>函数将在<strong class="ky ir">构建</strong>时获取并缓存数据。然后，每当请求页面时，这些数据就准备好了。</p><p id="fef3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们想创建一个列出我们所有产品的页面。我们可以在路径<code class="fe nq nr ns ng b">/pages/products.js</code>创建一个新页面，并让它加载静态数据。例如，我刚刚硬编码了一个虚构的JSON响应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="ak">/pages/products.js</strong> page</figcaption></figure><p id="5f8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果数据在用户请求之前的<strong class="ky ir">构建时间</strong>可用，这是一个好方法。Next.js使用HTML和JSON来缓存这些页面，使它们适合与CDN一起使用，这对于页面加载时间和SEO来说是非常好的。</p><h2 id="2498" class="nk mj iq bd mk nv nw dn mo nx ny dp ms lf nz oa mu lj ob oc mw ln od oe my of bi translated">动态性能</h2><p id="9d8d" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated"><code class="fe nq nr ns ng b">getServerSideProps</code>函数实现了类似的结果，关键的区别在于这个代码块在每个页面渲染之前被执行<strong class="ky ir">。</strong></p><p id="eea8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用与上面相同的例子，我们可以简单地将函数名改为<code class="fe nq nr ns ng b">getServerSideProps</code>。该功能的一个更实际的用例是获取关于产品的特定数据。</p><p id="54fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设我们希望在用户加载页面时加载更多关于特定产品的数据。使用<code class="fe nq nr ns ng b">getServerSideProps</code>是一种合适的方法，因为我们可能希望在将来更新这些信息。改变正在销售的产品的价格可能就是这样一种情况。如前所述，<code class="fe nq nr ns ng b">getStaticProps</code>只在<strong class="ky ir">构建</strong>时运行，所以我们不想在这里使用它。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="ak">/pages/products/[slug].js</strong> page</figcaption></figure><h1 id="485f" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">API路线</h1><p id="cbf9" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">你想给你的React应用添加一些API路由，还是运行一些你不想让客户端访问的代码？Next.js内置了对使用Node.js的API端点的支持。</p><p id="41b4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您会注意到默认配置在<code class="fe nq nr ns ng b">/pages/api/hello.js</code>提供了一个示例，它返回默认的200 OK响应。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Sample <strong class="ak">hello.js</strong> API File</figcaption></figure><p id="1c28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想要一些后端功能，那么您不再需要一个单独的应用程序！<code class="fe nq nr ns ng b">/root/api</code>下的所有页面都遵循与页面相同的命名约定。这段代码将在NodeJs服务器上运行。</p><p id="f1d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要创建一个产品API，您将创建下面的文件<code class="fe nq nr ns ng b">/pages/api/products.js</code>，并为任何请求导出一个处理程序。在本例中，我们将接受创建产品的POST请求，以及返回现有产品的简单GET请求。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><strong class="ak">products.js</strong> API file</figcaption></figure></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><h1 id="c536" class="mi mj iq bd mk ml ot mn mo mp ou mr ms jw ov jx mu jz ow ka mw kc ox kd my mz bi translated">更多支持的功能</h1><p id="e769" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">Next.js有许多高级特性，这些特性<a class="ae kv" href="https://nextjs.org/docs/getting-started" rel="noopener ugc nofollow" target="_blank">在</a>有很好的记录:</p><ul class=""><li id="61ac" class="lu lv iq ky b kz la lc ld lf lw lj lx ln ly lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs/basic-features/data-fetching" rel="noopener ugc nofollow" target="_blank">静态页面生成和缓存</a></li><li id="6a59" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs/advanced-features/i18n-routing" rel="noopener ugc nofollow" target="_blank"> I18n国际化支持</a></li><li id="19a5" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs/basic-features/image-optimization" rel="noopener ugc nofollow" target="_blank">动态图像优化</a></li><li id="72c5" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs/basic-features/typescript" rel="noopener ugc nofollow" target="_blank">支持打字稿</a></li><li id="3d33" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs/basic-features/built-in-css-support" rel="noopener ugc nofollow" target="_blank">内置CSS &amp; SCSS支持</a></li><li id="9c56" class="lu lv iq ky b kz md lc me lf mf lj mg ln mh lr lz ma mb mc bi translated"><a class="ae kv" href="https://nextjs.org/docs" rel="noopener ugc nofollow" target="_blank">代码拆分和捆绑</a></li></ul></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><h1 id="3bca" class="mi mj iq bd mk ml ot mn mo mp ou mr ms jw ov jx mu jz ow ka mw kc ox kd my mz bi translated">包扎</h1><p id="2e67" class="pw-post-body-paragraph kw kx iq ky b kz na jr lb lc nb ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">这只是Next.js附带的我最喜欢的功能的一小部分。你可以在他们的网站上找到功能和文档的完整列表。</p><p id="3411" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以，现在您应该非常精通使用Next.js来驱动您的下一个React应用程序了！我发现这是一个比使用create React应用程序更好的开发体验，并且它具有丰富的功能。学习曲线最初可能有点陡，但是一旦你掌握了窍门，它的好处绝对是值得的！</p></div><div class="ab cl om on hu oo" role="separator"><span class="op bw bk oq or os"/><span class="op bw bk oq or os"/><span class="op bw bk oq or"/></div><div class="ij ik il im in"><p id="82b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，并且愿意支持我成为一名作家，考虑注册<a class="ae kv" href="https://adam-galtrey.medium.com/membership" rel="noopener">成为一名媒体成员</a>。每月只需5美元，你就可以无限制地阅读Medium上的所有文章。如果你<a class="ae kv" href="https://adam-galtrey.medium.com/membership" rel="noopener">用我的链接</a>注册，我也会赚一小笔佣金。</p></div></div>    
</body>
</html>