<html>
<head>
<title>Use Node.js to Scrape and Send Twilio Notifications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js抓取并发送Twilio通知</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-node-js-to-scrape-and-send-twilio-notifications-e9c0193adde4?source=collection_archive---------13-----------------------#2021-04-05">https://javascript.plainenglish.io/use-node-js-to-scrape-and-send-twilio-notifications-e9c0193adde4?source=collection_archive---------13-----------------------#2021-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ead6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">创建您自己定制的web scraper和通知服务指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/13561d4ba96ab23415e477b1e89bc4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7H2Hn65Bf0GPJGSQ"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@claybanks?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clay Banks</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="6c10" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">目的</h1><p id="e56b" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">你是否讨厌刷新一个网页一百次才能看到某个产品是否有货？</p><p id="e35e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你有一个程序能在你的产品上市时通知你，那不是很好吗？</p><p id="d66a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">更重要的是，如果<strong class="lq ir">你</strong>自己编程定制程序<strong class="lq ir">自己</strong> <em class="mp">岂不是很棒？</em></p><p id="29c9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">嗯，这是给你的指南。您将学习如何:</p><ul class=""><li id="c57e" class="mq mr iq lq b lr mk lu ml lx ms mb mt mf mu mj mv mw mx my bi translated">使用<strong class="lq ir"> Node.js </strong>编写一个web应用程序来抓取你想要的网站。</li><li id="38c7" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">使用<strong class="lq ir"> Cheerio在HTML中扫描您想要的商品。</strong></li><li id="c4c8" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated">最后，配置您自己的<strong class="lq ir"> Twilio </strong>账户，以便在您的产品上市时接收通知。</li></ul><p id="6e43" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们开始吧！</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="4c58" class="kw kx iq bd ky kz nl lb lc ld nm lf lg jw nn jx li jz no ka lk kc np kd lm ln bi translated">设置</h1><p id="ff27" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">首先，你需要安装Node.js，可以在他们的网站上<a class="ae kv" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">下载</a>。</p><p id="0d2c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来，您需要运行web scraper所需的三个主要包。它们是:</p><ul class=""><li id="2f73" class="mq mr iq lq b lr mk lu ml lx ms mb mt mf mu mj mv mw mx my bi translated"><a class="ae kv" href="https://www.npmjs.com/package/request-promise" rel="noopener ugc nofollow" target="_blank">请求-承诺</a></li><li id="0ba3" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><a class="ae kv" href="https://www.npmjs.com/package/cheerio" rel="noopener ugc nofollow" target="_blank">再见</a></li><li id="7d8e" class="mq mr iq lq b lr mz lu na lx nb mb nc mf nd mj mv mw mx my bi translated"><a class="ae kv" href="https://www.npmjs.com/package/twilio" rel="noopener ugc nofollow" target="_blank"> Twilio </a></li></ul><p id="a47d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">假设已经安装了Node.js，运行这个命令一次性安装所有必需的包。</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="adb2" class="nv kx iq nr b gy nw nx l ny nz">npm install request-promise cheerio twilio</span></pre><h1 id="4d8b" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">决定你想刮哪个网站</h1><p id="5947" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于本教程，我决定刮马萨诸塞州疫苗网站。他们的网址是:<a class="ae kv" href="https://vaxfinder.mass.gov/?zip_or_city=&amp;vaccines_available=on" rel="noopener ugc nofollow" target="_blank">https://vaxfinder.mass.gov/邮政编码_or_city= &amp;疫苗_可用=在</a></p><p id="577d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我决定选择每10秒钟抓取一次网站，看看什么时候有疫苗网站可用，而不是刷新可用疫苗的网页。</p><h1 id="f933" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">把所有的放在一起</h1><p id="987a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在你已经安装了包，并且决定了要抓取哪个网站，让我们开始编程吧。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="4082" class="kw kx iq bd ky kz nl lb lc ld nm lf lg jw nn jx li jz no ka lk kc np kd lm ln bi translated">创建您的JS文件</h1><p id="eb09" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">打开您的文本编辑器，创建一个名为<strong class="lq ir"> <em class="mp"> scaper.js </em> </strong>的新文件(或任何其他名称)。</p><h1 id="5eb8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">包括适当的包</h1><p id="f50a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">接下来，导入3个必需的包。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="6798" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">定义你想点击的网址</h1><p id="d2c3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">像这样设置你的URL来调用适当的网站。</p><blockquote class="oc od oe"><p id="1106" class="lo lp mp lq b lr mk jr lt lu ml ju lw of mm lz ma og mn md me oh mo mh mi mj ij bi translated"><strong class="lq ir"> <em class="iq">注意:</em> </strong> <em class="iq">以防你得到可怕的</em><strong class="lq ir"><em class="iq">" maxlistenerseceded warning:可能检测到EventEmitter内存泄漏。向[请求]添加了11个管道侦听器。使用emitter.setMaxListeners()增加limit" </em> </strong> <em class="iq">，需要设置你的选项包含jar并设置为</em><strong class="lq ir"><em class="iq">true</em></strong><em class="iq">。这里详细解释了</em><a class="ae kv" href="https://github.com/request/request/issues/1809" rel="noopener ugc nofollow" target="_blank"><em class="iq"/></a><em class="iq">。</em></p></blockquote><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="f840" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">配置您的Twilio帐户</h1><p id="23d3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">对于这一部分，如果您还没有Twilio帐户，您需要注册一个。这很容易做到，你可以注册一个免费层，免费使用15美元。对于这个练习来说已经足够了。</p><p id="318d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在您的Twilio设置中，找到您的<strong class="lq ir"> accountSid </strong>和<strong class="lq ir"> authToken，</strong>并记录下来。</p><p id="6e24" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你也可以看看Twilio <a class="ae kv" href="https://www.twilio.com/docs/libraries/node" rel="noopener ugc nofollow" target="_blank">提供的</a>解释整个过程的很棒的教程。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="5d63" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">创建您的循环()</h1><p id="97b3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">接下来，您需要创建一个异步函数，它将在主循环被调用时被触发。因为您将每10秒钟调用一次网站，所以将超时设置为10，000毫秒。</p><p id="43c8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本例中，我决定记录控制台中发生的事情，并显示时间戳，只是为了调试目的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="07d8" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来，您将实现<strong class="lq ir"> checkStatus() </strong>。</p><h1 id="e9b7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">实现checkStatus()</h1><p id="70e1" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">这是代码的核心。checkStatus()所做的是调用所需的URL。在URL被调用并且包含HTML的响应被返回之后，您将使用<strong class="lq ir"> Cheerio </strong>扫描返回的HTML。参考他们的<a class="ae kv" href="https://www.npmjs.com/package/cheerio" rel="noopener ugc nofollow" target="_blank">网站</a>获取文档。</p><p id="e8e5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你应该在HTML中寻找什么？嗯，那要看你刮的是什么了。</p><p id="e18a" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在我的例子中，我正在寻找一个“达特茅斯:前电路城”的实例。如果有这样的匹配，我将调用<strong class="lq ir"> twilio() </strong>函数，它将通过文本通知我。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><p id="5887" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">接下来您将实现<strong class="lq ir"> twilio() </strong>。</p><h1 id="04b5" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">实现twilio()</h1><p id="c5cd" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">您需要配置<strong class="lq ir"> twilio() </strong>函数，以便它接受一个<strong class="lq ir"> <em class="mp">主体</em> </strong>，<strong class="lq ir"> <em class="mp">从</em> </strong>，以及<strong class="lq ir"> <em class="mp">到</em> </strong>参数。这很简单，但是如果您需要进一步的说明，请根据需要参考他们的文档。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oa ob l"/></div></figure><h1 id="7208" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated"><strong class="ak">运行您的应用</strong></h1><p id="8b8d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">要运行该应用程序，只需键入:</p><pre class="kg kh ki kj gt nq nr ns nt aw nu bi"><span id="0c0e" class="nv kx iq nr b gy nw nx l ny nz">node <strong class="nr ir">testing.js</strong></span></pre><p id="aa9d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果一切配置正确，您将看到应用程序运行，并每10秒钟在控制台中记录一次结果。恭喜你！</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><h1 id="b387" class="kw kx iq bd ky kz nl lb lc ld nm lf lg jw nn jx li jz no ka lk kc np kd lm ln bi translated">结论</h1><p id="bf44" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">现在你知道了。你现在有了一个web scraper的工作示例，它不仅每10秒钟抓取一次你想要的网站，还会给你发送一个定制的通知。</p><p id="55a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">干杯！</p><p id="e4db" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="mp">更多内容看</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lq ir"><em class="mp">plain English . io</em></strong></a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/d1b217b6b1beafe1d91446a6ca2c1e37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yfn1VFuq7YXEvUQhDUC2mA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Final completed code to run the scraper and notification service</figcaption></figure></div></div>    
</body>
</html>