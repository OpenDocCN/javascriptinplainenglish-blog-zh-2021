<html>
<head>
<title>Server-Side Development with Fastify — Initial Config and Routes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Fastify的服务器端开发—初始配置和路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/server-side-development-with-fastify-initial-config-and-routes-f77262fbda94?source=collection_archive---------15-----------------------#2021-02-25">https://javascript.plainenglish.io/server-side-development-with-fastify-initial-config-and-routes-f77262fbda94?source=collection_archive---------15-----------------------#2021-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e37396f81ac2df1eac1c34cbed676a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lhqoVMsNf6-OMQ7P"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@shiroscope?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Shiro hatori</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8806" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fastify是一个用于开发后端网络应用程序的小型Node框架。</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Fastify创建后端应用程序。</p><h1 id="4a04" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">初始配置</h1><p id="077e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过初始化Fastify来设置应用程序的初始配置。</p><p id="4d66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8134" class="mn lc iq mj b gy mo mp l mq mr">const { readFileSync } = require('fs')<br/>const Fastify = require('fastify')</span><span id="2346" class="mn lc iq mj b gy ms mp l mq mr">const fastify = Fastify({<br/>  https: {<br/>    allowHTTP1: true,<br/>    key: readFileSync('./fastify.key'),<br/>    cert: readFileSync('./fastify.cert')<br/>  },<br/>  logger: { level: 'trace'},<br/>  ignoreTrailingSlash: true,<br/>  maxParamLength: 200,<br/>  caseSensitive: true,<br/>  trustProxy: '127.0.0.1,192.168.1.1/24',<br/>})</span><span id="77c2" class="mn lc iq mj b gy ms mp l mq mr">console.log(fastify.initialConfig)</span><span id="fd35" class="mn lc iq mj b gy ms mp l mq mr">fastify.get('/', async (request, reply) =&gt; {  <br/>  return 'hello world'<br/>})</span><span id="8bf9" class="mn lc iq mj b gy ms mp l mq mr">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="787a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置初始配置。</p><p id="a921" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">https</code>有HTTPS选择。</p><p id="9a90" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">allowHTTP1</code>让我们监听HTTP1请求。</p><p id="ed5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">key</code>和<code class="fe mt mu mv mj b">cert</code>是SSL密钥和证书文件。</p><p id="1409" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">logger</code>设定采伐等级。</p><p id="2630" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">ignoreTrailingSlash</code>让Fastify在匹配路由时忽略尾随斜线。</p><p id="c8cb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">caseSensitive</code>设置是否启用区分大小写的路由匹配。</p><p id="2595" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">trustProxy</code>让我们设置信任哪个代理。</p><p id="7774" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到了具有<code class="fe mt mu mv mj b">fastify.initialConfig</code>属性的配置。</p><p id="2ec2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们还可以通过以下方式动态设置选项:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2523" class="mn lc iq mj b gy mo mp l mq mr">const { readFileSync } = require('fs')<br/>const Fastify = require('fastify')</span><span id="32f4" class="mn lc iq mj b gy ms mp l mq mr">const fastify = Fastify({<br/>  https: {<br/>    allowHTTP1: true,<br/>    key: readFileSync('./fastify.key'),<br/>    cert: readFileSync('./fastify.cert')<br/>  },<br/>  logger: { level: 'trace'},<br/>  ignoreTrailingSlash: true,<br/>  maxParamLength: 200,<br/>  caseSensitive: true,<br/>  trustProxy: '127.0.0.1,192.168.1.1/24',<br/>})</span><span id="5108" class="mn lc iq mj b gy ms mp l mq mr">console.log(fastify.initialConfig)</span><span id="51fc" class="mn lc iq mj b gy ms mp l mq mr">fastify.register(async (instance, opts) =&gt; {<br/>  instance.get('/', async (request, reply) =&gt; {<br/>    return instance.initialConfig<br/>  })</span><span id="0bd7" class="mn lc iq mj b gy ms mp l mq mr">  instance.get('/error', async (request, reply) =&gt; {<br/>    instance.initialConfig.https.allowHTTP1 = false<br/>    return instance.initialConfig<br/>  })<br/>})</span><span id="5c3b" class="mn lc iq mj b gy ms mp l mq mr">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="3ec5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们编写<code class="fe mt mu mv mj b">instance.initialConfig.https.allowHTTP1 = false</code>来设置<code class="fe mt mu mv mj b">/error</code>路由处理程序中的<code class="fe mt mu mv mj b">allowHTTP1</code>选项。</p><p id="2ddf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以公开的属性包括:</p><ul class=""><li id="567d" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">connectionTimeout</code></li><li id="d55d" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">keepAliveTimeout</code></li><li id="46d7" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">bodyLimit</code></li><li id="85c6" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">caseSensitive</code></li><li id="f0dd" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">http2</code></li><li id="ca0b" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">https </code>(明确通过则返回<code class="fe mt mu mv mj b">false</code> / <code class="fe mt mu mv mj b">true</code>或<code class="fe mt mu mv mj b">{ allowHTTP1: true/false }</code></li><li id="d57c" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">ignoreTrailingSlash</code></li><li id="0319" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">maxParamLength</code></li><li id="9ad0" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">onProtoPoisoning</code></li><li id="8dc5" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">pluginTimeout</code></li><li id="ca36" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe mt mu mv mj b">requestIdHeader</code></li></ul><h1 id="f43d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">路线</h1><p id="f4fb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe mt mu mv mj b">fastify.route</code>方法来申报路线。</p><p id="ff05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e766" class="mn lc iq mj b gy mo mp l mq mr">const fastify = require('fastify')()</span><span id="0ac5" class="mn lc iq mj b gy ms mp l mq mr">fastify.route({<br/>  method: 'GET',<br/>  url: '/',<br/>  schema: {<br/>    querystring: {<br/>      name: { type: 'string' },<br/>      excitement: { type: 'integer' }<br/>    },<br/>    response: {<br/>      200: {<br/>        type: 'object',<br/>        properties: {<br/>          hello: { type: 'string' }<br/>        }<br/>      }<br/>    }<br/>  },<br/>  handler: function (request, reply) {<br/>    reply.send({ hello: 'world' })<br/>  }<br/>})</span><span id="8292" class="mn lc iq mj b gy ms mp l mq mr">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="1cd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加<code class="fe mt mu mv mj b">/</code>路线。</p><p id="1595" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">querystring</code>属性指定它接受的查询字符串。</p><p id="6985" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">response</code>属性指定它返回的响应。</p><p id="2a8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">handler</code>具有路由处理功能。</p><p id="7c1e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">reply.send</code>向用户发送响应。</p><h1 id="0ae1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="e994" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过<code class="fe mt mu mv mj b">fastify.route</code>设置Fastify应用的初始配置，并为Fastify应用添加路由。</p><p id="2c51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nk">阅读更多在</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="nk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>