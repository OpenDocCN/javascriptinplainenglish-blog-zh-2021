<html>
<head>
<title>How to Improve Webpack Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何提高网络包的性能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-improve-webpack-performance-7637db26fa5f?source=collection_archive---------2-----------------------#2021-01-19">https://javascript.plainenglish.io/how-to-improve-webpack-performance-7637db26fa5f?source=collection_archive---------2-----------------------#2021-01-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a0e8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过缓存加快慢速网络包构建</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d234f6017151c13c7581a5c2fdd7a368.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RnQ5cbZAJ20EglAs"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@infralist?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Infralist.com</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="8eea" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的旅程</h1><p id="72aa" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">对我来说，Webpack在历史上一直是一种置之不理的配置。如果有什么东西坏了，我才会去看。但我脑子里一直有一个任务，就是提高它的性能。随着Webpack 5的发布，我终于开始研究我的构建系统。</p><h1 id="7108" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的身材</h1><p id="dd9c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我的Webpack配置非常典型——除了Lint插件和用于开发构建的Webpack Dev Server之外，它还使用了相当标准的加载器和插件进行反应。生产构建需要大约40秒来完成，开发构建需要大约150秒。我可以采取哪些措施来改善这种情况？</p><h1 id="ec88" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">贮藏</h1><p id="0316" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">Webpack和相关工具支持缓存。构建过程各个阶段的输出将被保存，以便在后续构建中重用，从而减少或消除处理时间。使用Webpack、Babel和Lint缓存的组合，我能够将构建时间减少20倍！</p><h1 id="3625" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">Webpack缓存</h1><p id="bf37" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">Webpack 5引入了持久文件系统缓存。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="3116" class="mm ku in mi b gy mn mo l mp mq">// webpack.config.js</span><span id="012d" class="mm ku in mi b gy mr mo l mp mq">module.exports = {<br/>  cache: {<br/>    type: 'filesystem',<br/>  },<br/>};</span></pre><p id="989b" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">现在，Webpack可以使用以前版本中的信息，并跳过不必要的步骤！默认情况下，构建缓存在<code class="fe mx my mz mi b">node_modules/.cache/webpack</code>中，但这可以使用<code class="fe mx my mz mi b">cacheDirectory</code>、<code class="fe mx my mz mi b">cacheLocation</code>或<code class="fe mx my mz mi b">name</code>缓存选项进行自定义。</p><p id="80af" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">在这个简单的添加之后，Webpack的生产构建只需要8秒钟，性能提高了5倍！</p><p id="bd28" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">注意:在本文撰写之时，文件系统缓存并不能完全与Webpack开发版本一起工作——即使代码没有更改，它也会导致定期重建。如果这种重建没有发生，Webpack开发构建也将显示类似的性能提升。</p><h1 id="51d3" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">巴别塔缓存</h1><p id="552f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在网络包中，<code class="fe mx my mz mi b">babel-loader</code>也支持缓存。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="23ee" class="mm ku in mi b gy mn mo l mp mq">// webpack.config.js</span><span id="8722" class="mm ku in mi b gy mr mo l mp mq">module.exports = {<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.m?js$/,<br/>        <!-- -->exclude: /node_modules/<!-- -->,<br/>        loader: 'babel-loader',<br/>        options: {<br/>          cacheCompression: false,<br/>          cacheDirectory: true,<br/>        },<br/>      },<br/>    ],<br/>  },<br/>}</span></pre><p id="57ac" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">缓存之后，Webpack productions构建的构建步骤从~18秒下降到~9秒，Webpack开发构建也从~42秒下降到~30秒。这对于生产构建来说是2倍的性能增益，对于开发构建来说是1.4倍的性能增益！</p><p id="8e0f" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">默认情况下，<code class="fe mx my mz mi b">babel-loader</code>将缓存数据保存在<code class="fe mx my mz mi b">node_modules/.cache/babel-loader</code>中。这可以通过为<code class="fe mx my mz mi b">cacheDirectory</code>字段指定字符串目录路径而不是布尔值来定制。</p><p id="46ed" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">此外，<code class="fe mx my mz mi b">babel-loader</code>默认情况下将gzip缓存数据。使用<code class="fe mx my mz mi b">cacheCompression</code>选项可以关闭该功能，这样可以节省一点解压缩缓存数据的时间。</p><h1 id="ccba" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">Lint缓存</h1><p id="ca5c" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">如果你使用ESLint和Stylelint插件，它们也有缓存。这些插件占用了大量的处理Webpack开发构建时间。在没有缓存的情况下，ESLint花费了大约70秒，主要是因为<code class="fe mx my mz mi b">prettier/prettier</code>和<code class="fe mx my mz mi b">import/no-cycle</code>规则占据了执行时间的75%。Stylelint花费了大约8秒钟。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="a894" class="mm ku in mi b gy mn mo l mp mq">// webpack.config.js</span><span id="8783" class="mm ku in mi b gy mr mo l mp mq">module.exports = {<br/>  plugins: [<br/>    new ESLintPlugin({ cache: true }),<br/>    new StylelintPlugin({ files: '**/*.css', cache: true }),<br/>  ],<br/>};</span></pre><p id="3191" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">启用缓存后，两个插件都在大约3秒后完成。对于ESLint来说，这要快23倍！</p><p id="6086" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">默认情况下，ESLint和Stylelint缓存分别存储在基目录的<code class="fe mx my mz mi b">.eslintcache</code>和<code class="fe mx my mz mi b">.stylelintcache</code>中。这可以使用<code class="fe mx my mz mi b">cacheLocation</code>选项进行定制。</p><p id="ec31" class="pw-post-body-paragraph ll lm in ln b lo ms jo lq lr mt jr lt lu mu lw lx ly mv ma mb mc mw me mf mg ig bi translated">注意:在命令行中使用ESLint和StyleLint时，也可以利用缓存。</p><pre class="kd ke kf kg gt mh mi mj mk aw ml bi"><span id="8f15" class="mm ku in mi b gy mn mo l mp mq">// package.json</span><span id="52cd" class="mm ku in mi b gy mr mo l mp mq">{<br/>  "scripts": {<br/>    "lint:css": "stylelint '**/*.css' --cache,<br/>    "lint:js": "eslint . --cache,<br/>  },<br/>}</span></pre><h1 id="80a0" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">警告</h1><p id="98d8" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">值得注意的是，这里表示的数字来自相同的构建运行。如果输入完全相同，缓存可以发挥作用，显著提高构建性能。但这并不代表现实生活中的情况，在现实生活中，代码是不断变化的，我们开发功能和修复错误。然而，缓存仍然有帮助，因为大多数时候。大多数更改是增量式的，因此只有一小部分缓存是无效的。没有的部分仍然可以显著提高构建速度。</p><h1 id="2b53" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">摘要</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/d82916ebc4c47358c51595122b4cedb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N9i_jgN18QA8qcaKYCLFDA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Webpack Production Build Caching Performance Results</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nb"><img src="../Images/3b6303854bc7cf7d1a9609ada8e6078d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_CrbMix2694_aAfUIsUOg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Webpack Development Build Cache Performance Results</figcaption></figure></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="2ca0" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">最后的想法</h1><p id="9dcf" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">这三个缓存步骤大大缩短了我的Webpack构建时间。仅仅是对配置的小调整就让开发人员的体验发生了巨大的变化。我和我的团队能够更快、更有效地开发。现在，我可以继续忽略Webpack。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h1 id="3167" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">资源</h1><ul class=""><li id="0168" class="no np in ln b lo lp lr ls lu nq ly nr mc ns mg nt nu nv nw bi translated"><a class="ae ks" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank">官方Webpack文档</a></li><li id="9711" class="no np in ln b lo nx lr ny lu nz ly oa mc ob mg nt nu nv nw bi translated"><a class="ae ks" href="https://webpack.js.org/loaders/babel-loader/" rel="noopener ugc nofollow" target="_blank">巴别塔官方文档</a></li><li id="20aa" class="no np in ln b lo nx lr ny lu nz ly oa mc ob mg nt nu nv nw bi translated"><a class="ae ks" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank">官方ESLint文档</a></li><li id="0c7b" class="no np in ln b lo nx lr ny lu nz ly oa mc ob mg nt nu nv nw bi translated"><a class="ae ks" href="https://stylelint.io/" rel="noopener ugc nofollow" target="_blank">官方Stylelint文档</a></li></ul></div></div>    
</body>
</html>