<html>
<head>
<title>1 Killer Node.js Tool for SQL Data Migration Projects</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">1个用于SQL数据迁移项目的黑仔Node.js工具</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/1-killer-nodejs-tool-for-sql-data-migration-projects-9d900b9563bf?source=collection_archive---------7-----------------------#2021-05-18">https://javascript.plainenglish.io/1-killer-nodejs-tool-for-sql-data-migration-projects-9d900b9563bf?source=collection_archive---------7-----------------------#2021-05-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fd6c3c7982e11a0f69af9cbb7dd0d524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F1xKE1BBQp5mj6u9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@oskaryil?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Oskar Yildiz</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你知道几乎每个公司都必须做的枯燥的数据迁移项目。</p><p id="dbcc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我们都有过需要进行数据迁移项目的经历，但碰巧的是，你是做这种单调乏味工作的最佳人选。这就是你——数据架构师、后端工程师甚至前端工程师。</p><p id="e489" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">手头的任务？从源数据库到目标数据库的数据映射和对象创建，起初听起来可能是一项简单的任务，但在大型数据库中，这可能是一项艰巨的任务。可能有100种或更多不同类型的对象，如表、存储过程、函数、视图等。</p><h1 id="f690" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">场景</strong></h1><p id="a811" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们的工具适用于特定情况，在这种情况下，您必须首先设计一个构建文件，其中包含要批准和测试的SQL/PLSQL脚本和/或借助定义所有DB对象的Excel文件。然后，构建文件用于在服务器上构建对象。如果没有Excel文件，你仍然可以使用这个工具进行一些调整，我会涵盖。</p><p id="7aec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">设置:</p><p id="5854" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设您在目标数据库中首先创建了一个名为Customers的表:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/1a24938d51c95c39bd2a4c6e319501c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*VaKs1L9Sspy0bgz46Oamwg.png"/></div></figure><p id="16f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么脚本看起来应该是这样的:</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a243" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">代码分解</strong></p><p id="c862" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用几个步骤来分析一下这里发生了什么:</p><ol class=""><li id="beb5" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated">我们首先定义一个名为mainEngine的main方法——我们所有的函数和事件都应该在这里发生。然后我们可以调用mainEngine作为整个脚本运行时运行的第一个方法。</li><li id="b315" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">在第3行，我们在NodeJS的readFile()的帮助下遍历我们的跨页中的所有工作表/工作簿——这在后面的脚本顶部被定义为导入。</li><li id="595a" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">接下来，在第8行，我们检查要创建到表中的第一个表——对于我们来说，它是Customer表，因此我们检查一个名为“Customer”的表，如果有，就将其所有内容转换为JSON对象的数组，例如，对于第一列的[{"col name": "id"}，" col name": "firstname"}]，这是列名，然后它将对表中的其余列也进行同样的操作，例如，数据类型和注释。</li><li id="745b" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">然后在第13行，对于每个JSON对象，我们取出第一列，它现在可以作为名为sheetObjects的对象中的一个索引进行访问，由于第一列是“Col Name ”,我们从这里取出所有的字段名，并将它们放入名为rowNames的数组中。这是为了以后更容易处理。</li><li id="a982" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">然后，我们遍历sheetObjects中的其余对象(列名和字段名),并按照我们想要的方式构建我们的脚本。</li><li id="c043" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">然后，我们在第31行向脚本添加注释</li><li id="97a7" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">然后，我们在脚本的第37行添加组合键</li><li id="bddd" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">然后我们添加约束，最后添加表空间名称</li><li id="8008" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">接下来，我们在第57行向脚本的其余部分添加注释</li><li id="c9c9" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">最后，在NodeJS方法writeFile()的帮助下，我们将构建的脚本以SQL格式保存到一个文件中，并保存到所需的目录中</li></ol><p id="661f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们将添加代码的其余部分，这只是一些导入和变量。我想现在添加它们，这样你就可以看到主函数是多么简单，没有任何其他混乱。</p><p id="0bb2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">更复杂的列名和数据类型的帮助方法</strong></p><p id="ab26" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么，除了一些额外的东西，还有什么比提供一个好工具更好的呢？</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/2b2d17e16d7947f3077824599353e301.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/1*qJfJ3qEq78lXFSOm_4_yCA.gif"/></div></figure><p id="cea6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果您想要添加索引或序列，您可以使用这两个额外的辅助方法轻松完成。</p><figure class="mf mg mh mi gt jr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="a39b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> NPM模块</strong></p><p id="3892" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我没有把它作为一个模块，我想这是因为有些人会认为它本身并不是一个真正的工具。所以，为了方便起见，我将这个脚本打包到了一个NPM模块中，可以在这里找到:<a class="ae kc" href="https://www.npmjs.com/package/datamigrationscript" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> Node.js数据迁移脚本</strong> </a> <strong class="kf ir">。</strong></p><p id="20b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦您克隆了它，您可以轻松地安装它，以便在任何类型的SQL/PLSQL或数据迁移项目中使用，如果您调整它的话。</p><p id="ca99" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">NPM 上也有说明。</p><p id="c346" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">视频演示</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/88b41c14a82b4fdb2bd5d8b8b5f46bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Y5Ar1vwLRzMVEySZs5VA6g.gif"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">NodeJS Data Migration Tool: Demo end to end of whole script running and it’s files</figcaption></figure><p id="f4d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">结论</strong></p><p id="91db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们有一个用于数据迁移项目的有用工具，您可以从您最喜欢的代码编辑器(如VS Code)中使用它，与手动编写相比，它可以在很短的时间内创建SQL/PLSQL脚本。</p><p id="d958" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我还演示了额外的helper方法，向我们展示了如何通过替换不需要的列名和数据类型中的字符/字符串来清理列和数据类型。</p><p id="1008" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">希望你喜欢这篇文章。我试着保持简短和甜蜜！:-)</p><p id="3e50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nb">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nb">plain English . io</em></a></p></div></div>    
</body>
</html>