<html>
<head>
<title>How to use Cypress for E2E with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用柏树为E2E作出反应</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-cypress-for-e2e-with-react-7a3ea4df5ee0?source=collection_archive---------22-----------------------#2021-03-15">https://javascript.plainenglish.io/how-to-use-cypress-for-e2e-with-react-7a3ea4df5ee0?source=collection_archive---------22-----------------------#2021-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/37c2b38371b2f3c0b7f65142947cfbbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YhvQRy0VyuWfd3Oc.jpg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://pixabay.com/photos/lamp-light-lighting-light-bulb-3489395/" rel="noopener ugc nofollow" target="_blank"><em class="kd">https://pixabay.com/photos/lamp-light-lighting-light-bulb-3489395</em></a></figcaption></figure><p id="2238" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">对于任何前端应用程序，端到端(e2e)测试确实可以改进应用程序的维护和软件开发生命周期(SDLC)。E2E允许您快速验证更改，还可以记录应用程序中的功能。</p><p id="e603" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">今天，E2E框架有几种选择。<a class="ae kc" href="https://www.cypress.io/" rel="noopener ugc nofollow" target="_blank"> Cypress </a>是在您的应用程序中构建E2E测试的更新、更令人兴奋的选项之一。</p><p id="53e5" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">柏树是E2E的绝佳选择，因为它:</p><ol class=""><li id="0c8d" class="lc ld iq kg b kh ki kl km kp le kt lf kx lg lb lh li lj lk bi translated">在与你的前端项目相同的事件循环中运行(而不是像基于E2E <a class="ae kc" href="https://www.selenium.dev/documentation/en/webdriver/" rel="noopener ugc nofollow" target="_blank">硒</a>的项目那样从外部“敲门”)</li><li id="b5a0" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb lh li lj lk bi translated">适用于任何前端项目(将Cypress作为依赖项安装，测试运行程序将自动检测相应的配置文件)</li><li id="661f" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb lh li lj lk bi translated">所有的E2E都是用JavaScript编写的(不需要有<code class="fe lq lr ls lt b">.feature</code>或其他相关文件)</li><li id="63b8" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb lh li lj lk bi translated">Cypress提供了一个热重载测试运行器，允许您以与本地开发非常相似的方式开发您的测试</li></ol><p id="273d" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Cypress的唯一限制是，虽然它可以与Chrome、Firefox、Electron和Edge浏览器兼容，但它计划在未来支持更多的浏览器。然而，值得注意的是，这4种浏览器占据了浏览器世界的大部分市场份额，并解决了许多用例。每个项目都有不同的需求，但是这四种浏览器为前端项目提供了很多E2E测试的潜在覆盖面。</p><p id="5b99" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Cypress有很多特性，并且有一个很好的社区支持它。我强烈推荐<a class="ae kc" href="https://docs.cypress.io/guides/overview/why-cypress.html#In-a-nutshell" rel="noopener ugc nofollow" target="_blank">查看他们的文档</a></p><p id="302a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在这篇文章中，我将介绍Cypress，以及如何在React中使用它。如果你想继续，我已经创建了一个GitHub repo，其中包含了我在<a class="ae kc" href="https://www.github.com/andrewevans0102/cypress-react" rel="noopener ugc nofollow" target="_blank">https://www.github.com/andrewevans0102/cypress-react</a>讨论的所有例子。我使用的例子也是我在帖子<a class="ae kc" href="https://www.newline.co/@AndrewEvans/how-to-get-started-with-cypress--0bed3a8b" rel="noopener ugc nofollow" target="_blank">如何开始使用Cypress </a>中使用的先前项目的重建。</p><p id="d61f" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我还创建了一个YouTube视频，在这个视频中我演示了同一个示例项目。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/f0a2ced33258c8ca885cda66b86f936a.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/0*AkwOsB1t1oe7gh1t.jpg"/></div></figure><h1 id="2a20" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">示例应用程序</h1><p id="a55f" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">在我们开始使用Cypress之前，我只想解释一下示例应用程序是如何工作的。你可以在<a class="ae kc" href="https://www.github.com/andrewevans0102/cypress-react" rel="noopener ugc nofollow" target="_blank">https://www.github.com/andrewevans0102/cypress-react</a>找到示例应用程序。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/19ec68da135bc2fe9e38c8aec569b450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iaWNKvKgw3qzvZIA.png"/></div></div></figure><p id="72d2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">该应用程序有三个主要部分，其中包含以下示例:</p><p id="a1a7" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在我们的Cypress设置中，我们将对这三个页面进行构建E2E测试。</p><h1 id="75de" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">安装Cypress</h1><p id="313b" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">安装Cypress有多种方法。如果你<a class="ae kc" href="https://docs.cypress.io/guides/getting-started/installing-cypress.html#System-requirements" rel="noopener ugc nofollow" target="_blank">查看文档</a>，你会发现你可以用<code class="fe lq lr ls lt b">npm</code>、<code class="fe lq lr ls lt b">yarn</code>安装它，甚至可以手动安装二进制文件。</p><p id="3470" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在我的项目中，我使用了npm，所以我把它安装成一个<code class="fe lq lr ls lt b">dev dependency</code>,带有:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="8077" class="nh ma iq lt b gy ni nj l nk nl">npm install cypress --save-dev</span></pre><p id="d525" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦你做了<code class="fe lq lr ls lt b">npm install</code>，你应该看到一个<code class="fe lq lr ls lt b">cypress</code>文件夹和一个<code class="fe lq lr ls lt b">cypress.json</code>文件被创建在你的项目文件夹中:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/36d7fac4c7ae4b831115645bfb23fe4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*uSkeuDT5dDyKHOEW.png"/></div></figure><blockquote class="nn no np"><p id="59b4" class="ke kf nq kg b kh ki kj kk kl km kn ko nr kq kr ks ns ku kv kw nt ky kz la lb ij bi translated"><em class="iq">请注意“示例”文件夹，这是我创建的，为了简单起见，我只是将生成的示例文件从</em> <code class="fe lq lr ls lt b"><em class="iq">integrations</em></code> <em class="iq">复制到他们自己的文件夹中。</em></p></blockquote><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/f6c65919fba8ef12525c2b4e894ec1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/0*_Tm5cZxKVH-c6h6D.png"/></div></figure><p id="1cf3" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">构建的目录和文件包含不同的配置，我们将用Cypress构建E2E。它们都对应于:</p><ul class=""><li id="ced7" class="lc ld iq kg b kh ki kl km kp le kt lf kx lg lb nv li lj lk bi translated">是你为你的测试建立模拟或者存根响应的地方</li><li id="a2e2" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated">默认情况下，<code class="fe lq lr ls lt b">integration</code>是您放置实际测试<code class="fe lq lr ls lt b">.spec.js</code>文件的地方。</li><li id="d44a" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">plugins</code>允许你扩展柏树行为</li><li id="fc22" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">screenshots</code>和<code class="fe lq lr ls lt b">videos</code>是测试运行人员存储测试运行的可视副本的地方(在接下来的章节中会有更多的介绍)</li><li id="5a45" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">support</code>允许您定义可在测试中引用的“命令”或沸腾板行为，避免重复启动任务，如登录或类似流程</li></ul><p id="16ee" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦你安装了Cypress，你可以通过调用“open”来看到你与Cypress的第一次交互:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="c332" class="nh ma iq lt b gy ni nj l nk nl">./node_modules/.bin/cypress open</span></pre><h1 id="41a3" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">首次测试</h1><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/00af14751dd55310a416e51cad71d2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j8mitOpJDPEq2Qfr.png"/></div></div></figure><p id="9bc2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">当你第一次安装Cypress时，你会注意到在<code class="fe lq lr ls lt b">integrations</code>文件夹中有一组例子。这些非常有用，因为您可以看到与测试运行人员的第一次交互。这些例子来自Cypress“kitchen sink”站点，所以运行它们不需要任何配置。如果您想继续使用它们，您可以使用上一节末尾的<code class="fe lq lr ls lt b">cypress open</code>命令来查看运行中的测试运行程序。</p><p id="7170" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我通常会将“示例”复制到它自己的目录中。假设您已经完成了，下一步就是配置一些脚本来自动使用Cypress。</p><p id="c0c9" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我建议创建以下npm脚本:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="5dbf" class="nh ma iq lt b gy ni nj l nk nl">{<br/>"scripts": {<br/>    "cypress-open": "./node_modules/.bin/cypress open",<br/>    "cypress-local": "concurrently \"npm run start\" \"npm run cypress-open\"",<br/>    "cypress-run": "./node_modules/.bin/cypress run",<br/>    "cypress-ci": "start-server-and-test \"npm run start\" http://localhost:3000 \"npm run cypress-run\""<br/>}<br/>}</span></pre><p id="111c" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">让我们来谈谈他们是做什么的:</p><ul class=""><li id="55f6" class="lc ld iq kg b kh ki kl km kp le kt lf kx lg lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">cypress-open</code>自行打开测试运行程序</li><li id="efba" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">cypress-local</code>在本地运行测试运行程序和应用程序(交互式)</li><li id="6509" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">cypress-run</code>在CI (headless)中运行测试运行程序</li><li id="2f0a" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb nv li lj lk bi translated"><code class="fe lq lr ls lt b">cypress-ci</code>在CI (headless)中运行应用程序和测试运行程序</li></ul><blockquote class="nn no np"><p id="8191" class="ke kf nq kg b kh ki kj kk kl km kn ko nr kq kr ks ns ku kv kw nt ky kz la lb ij bi translated"><em class="iq">请注意，CI指的是“持续集成”,仅指构建管道。</em></p></blockquote><p id="8931" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">您还需要继续安装<a class="ae kc" href="https://www.npmjs.com/package/concurrently" rel="noopener ugc nofollow" target="_blank">并同时安装</a>和<a class="ae kc" href="https://www.npmjs.com/package/start-server-and-test" rel="noopener ugc nofollow" target="_blank">启动服务器并测试</a>,包括:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="a60e" class="nh ma iq lt b gy ni nj l nk nl">npm install concurrently <br/>npm install start-server-and-test</span></pre><p id="07ce" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">正如我在介绍中提到的，Cypress与您的应用程序运行在同一个事件循环中。这意味着当您运行Cypress测试时，您需要使用一些机制来运行您的应用程序和测试运行程序。使用<code class="fe lq lr ls lt b">concurrently</code>和<code class="fe lq lr ls lt b">start-server-and-test</code>允许这种行为。在本地运行时,<code class="fe lq lr ls lt b">concurrently</code>让您的应用程序与测试运行程序一起运行。当在CI中运行时，当测试完成时，使用<code class="fe lq lr ls lt b">start-server-and-test</code>将关闭您的应用程序和测试运行程序。</p><p id="9ad6" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">让我们编写我们的第一个测试，来看看它的“本地”运行情况。</p><p id="56f7" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">转到<code class="fe lq lr ls lt b">integrations</code>文件夹，用以下内容创建一个文件<code class="fe lq lr ls lt b">first_test.spec.js</code>:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="752c" class="nh ma iq lt b gy ni nj l nk nl">describe("First Test", () =&gt; {<br/>  it("should visit home page", () =&gt; {<br/>    cy.visit("http://localhost:3000/home-page");<br/>  });<br/>});</span></pre><p id="3fd1" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果你注意到，这是遵循标准的<a class="ae kc" href="https://mochajs.org/" rel="noopener ugc nofollow" target="_blank">摩卡</a>和<a class="ae kc" href="https://jasmine.github.io/" rel="noopener ugc nofollow" target="_blank">茉莉</a>语法。这很好，因为如果你熟悉其他测试框架，除了构建你的测试和习惯于<code class="fe lq lr ls lt b">cy</code> test runner对象之外，你没有什么可以学习的。</p><p id="b7a0" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在第一个测试中，我们只是访问示例应用程序的主页。一旦创建了<code class="fe lq lr ls lt b">first_test.spec.js</code>文件，继续运行<code class="fe lq lr ls lt b">npm run cypress-local</code>来查看测试运行。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/feb2385729f39b28ea1a13f7c3f11a6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hbHssmazrJJ6GCfJ.png"/></div></div></figure><p id="2cc8" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">当您第一次运行时，您会注意到默认情况下Cypress会打开一个<code class="fe lq lr ls lt b">Chrome</code>会话来实际测试您的应用程序。然后，测试运行程序会提供每个运行步骤的详细信息，当您单击运行的不同步骤时，您甚至可以进行“时间旅行”。</p><h1 id="636e" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">形式测试</h1><p id="0dbe" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">现在我们已经运行了第一个测试，让我们继续创建表单页面测试。转到<code class="fe lq lr ls lt b">integrations</code>文件夹，创建<code class="fe lq lr ls lt b">form.spec.js</code>，如下所示:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="1929" class="nh ma iq lt b gy ni nj l nk nl">describe('Form Test', () =&gt; {<br/>  it('should visit home page', () =&gt; {<br/>    cy.visit('/home-page');<br/>  });<br/><br/>  it('should visit home page and click start', () =&gt; {<br/>    cy.visit('/home-page');<br/>    cy.get('#startButton').click();<br/>    cy.get('h1').should('contain', 'Learn Cypress');<br/>  });<br/><br/>  it('should go to the forms page and enter login information', () =&gt; {<br/>    cy.visit('/home-page');<br/>    cy.get('#startButton').click();<br/>    cy.get('h1').should('contain', 'Learn Cypress');<br/>    cy.get('#formsButton').click();<br/>    cy.get("#email").type("HanSolo@gmail.com");<br/>    cy.get("#password").type("password");<br/>    cy.get("#submitButton").click();<br/>    cy.on("window:alert", (str) =&gt; {<br/>      expect(str).to.equal(<br/>        "successfully entered input with email HanSolo@gmail.com and password password"<br/>      );<br/>    });<br/>  });<br/>});</span></pre><p id="e62b" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">此外，继续修改<code class="fe lq lr ls lt b">cypress.json</code>文件，使其具有以下内容:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="2e84" class="nh ma iq lt b gy ni nj l nk nl">{ "baseUrl": "http://localhost:3000" }</span></pre><p id="1b45" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们刚刚在Cypress中创建了我们的第一个<code class="fe lq lr ls lt b">environment variable</code>。<code class="fe lq lr ls lt b">cypress.json</code>文件允许您创建可以在测试中引用的变量。<code class="fe lq lr ls lt b">baseUrl</code>是一个内置变量，但是你也可以<a class="ae kc" href="https://docs.cypress.io/guides/guides/environment-variables.html#Setting" rel="noopener ugc nofollow" target="_blank">创建你自己的自定义变量</a>。通过定义<code class="fe lq lr ls lt b">baseUrl</code>，我们可以将“访问主页测试”修改为:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="155c" class="nh ma iq lt b gy ni nj l nk nl">it('should visit home page', () =&gt; {<br/>    cy.visit('/home-page');<br/>  });</span></pre><p id="79b6" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">而不是:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="55af" class="nh ma iq lt b gy ni nj l nk nl">it("should visit home page", () =&gt; {<br/>    cy.visit("http://localhost:3000/home-page");<br/>  });</span></pre><p id="3481" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果您继续运行<code class="fe lq lr ls lt b">npm run cypress-local</code>，那么您应该会看到表单测试运行。如果您没有停止Cypress或本地应用程序，您应该已经看到test runner自动加载文件并重新加载页面。这是Cypress最好的部分之一，因为它允许在开发测试时进行“热重装”。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/e023df5022a161a444af5c31b4ab6158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NqSpA83Y1DqY1l7F.png"/></div></div></figure><p id="c42e" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果您在代码中注意到，我们正在向Cypress测试运行器对象<code class="fe lq lr ls lt b">cy</code>传递命令，如下所示:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="c3e5" class="nh ma iq lt b gy ni nj l nk nl">cy.get('#startButton').click();</span></pre><p id="4bd1" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我们在这里做的是识别页面上的对象，然后将事件传递给它。我们还可以获得信息，正如您在断言中看到的:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="f63e" class="nh ma iq lt b gy ni nj l nk nl">cy.get('h1').should('contain', 'Learn Cypress');</span></pre><p id="53ce" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这都是类似于传统的行为:</p><ol class=""><li id="9200" class="lc ld iq kg b kh ki kl km kp le kt lf kx lg lb lh li lj lk bi translated"><code class="fe lq lr ls lt b">arrange</code> =设置您的测试环境</li><li id="d5da" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb lh li lj lk bi translated"><code class="fe lq lr ls lt b">act</code> =运行实际测试</li><li id="6744" class="lc ld iq kg b kh ll kl lm kp ln kt lo kx lp lb lh li lj lk bi translated"><code class="fe lq lr ls lt b">assert</code> =验证输出结果</li></ol><p id="d92a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">有很多关于如何设置测试和与<code class="fe lq lr ls lt b">cy</code>对象交互的文档。我建议查看一下关于<a class="ae kc" href="https://docs.cypress.io/guides/getting-started/writing-your-first-test.html" rel="noopener ugc nofollow" target="_blank">编写第一个测试的指南</a>。</p><h1 id="2534" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">列表测试</h1><p id="1b29" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">所以现在我们也可以试着测试一下<code class="fe lq lr ls lt b">lists</code>页面。在<code class="fe lq lr ls lt b">integrations</code>文件夹中创建一个文件<code class="fe lq lr ls lt b">list.spec.js</code>:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="b25a" class="nh ma iq lt b gy ni nj l nk nl">describe("List Test", () =&gt; {<br/>  it("should go to the list page and add a value", () =&gt; {<br/>    cy.visit("/home-page");<br/>    cy.get("#startButton").click();<br/>    cy.get("h1").should("contain", "Learn Cypress");<br/>    cy.get("#listsButton").click();<br/>    cy.get("#createInput").type("use the force Luke!");<br/>    cy.get("#createButton").click();<br/>    cy.get("li").eq(4).should("contain", "use the force Luke!");<br/>  });<br/><br/>  it("should go to the list page and delete a value", () =&gt; {<br/>    cy.visit("/home-page");<br/>    cy.get("#startButton").click();<br/>    cy.get("h1").should("contain", "Learn Cypress");<br/>    cy.get("#listsButton").click();<br/>    cy.get("#createInput").type("use the force Luke!");<br/>    cy.get("#createButton").click();<br/>    cy.get("li").eq(4).should("contain", "use the force Luke!");<br/>    cy.get(":nth-child(5) &gt; .btn").click();<br/>    cy.get("[data-cy=listValues]").children().should("have.length", 4);<br/>  });<br/>});</span></pre><p id="ab5c" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一旦运行了它，您应该会看到如下所示的内容:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/0e9f79d3ee2d4d827085539f3de0d414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ufg32RPj3V_-vtLU.png"/></div></div></figure><p id="0228" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果您现在运行<code class="fe lq lr ls lt b">npm run cypress-local</code>，您可以在列表页面上运行测试。这类似于构建表单测试的方式，您会注意到，我们可以通过额外的步骤计算值，如下所示:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="b81e" class="nh ma iq lt b gy ni nj l nk nl">cy.get(":nth-child(5) &gt; .btn").click();<br/>cy.get("[data-cy=listValues]").children().should("have.length", 4);</span></pre><p id="a242" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这只是突出了你可以用<code class="fe lq lr ls lt b">cy</code>跑步者做的一件很酷的事情。它对列表特别有用，因为你经常需要看到列表的长度，或者一个值是否出现在前端项目的列表中。</p><h1 id="841c" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">网络请求</h1><p id="eca7" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">对于任何前端应用程序，网络请求总是任何工作流的关键部分。您需要与后端交互来获取或推送数据。</p><p id="b4e0" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">让我们通过创建一个名为<code class="fe lq lr ls lt b">network.spec.js</code>的文件，在<code class="fe lq lr ls lt b">integrations</code>文件夹中创建我们的网络请求测试，如下所示:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="2f40" class="nh ma iq lt b gy ni nj l nk nl">describe("Network Requests Page Test", () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    // server starts to listen for http calls<br/>    cy.server();<br/>    // create route that cypress will listen for, here it is the films endpoint of the SWAPI<br/>    cy.route("GET", "https://swapi.dev/api/films/**").as("films");<br/>  });<br/><br/>  it("should go to the network requests page and select a movie", () =&gt; {<br/>    cy.visit("/home-page");<br/>    cy.get("#startButton").click();<br/>    cy.get("h1").should("contain", "Learn Cypress");<br/>    cy.get("#networkButton").click();<br/>    cy.get("#movieSelect").select("A New Hope (1)");<br/>    cy.get("#movieTitle").should("contain", "A New Hope");<br/>    cy.get("#episodeNumber").should("contain", 4);<br/>  });<br/><br/>  it("should go to the network requests page and verify the HTTP payload called", () =&gt; {<br/>    cy.visit("/home-page");<br/>    cy.get("#startButton").click();<br/>    cy.get("h1").should("contain", "Learn Cypress");<br/>    cy.get("#networkButton").click();<br/>    cy.get("#movieSelect").select("A New Hope (1)");<br/>    // await the response from the SWAPI http call<br/>    cy.wait("@films").then((films) =&gt; {<br/>      expect(films.response.body.title).to.equal("A New Hope");<br/>    });<br/>    cy.get("#movieTitle").should("contain", "A New Hope");<br/>    cy.get("#episodeNumber").should("contain", 4);<br/>  });<br/>});</span></pre><p id="196d" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果运行它，您应该会看到以下内容:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oa"><img src="../Images/08f8c48c34df9a5111b286fef793cd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XIj5defBJ0TC5-fi.png"/></div></div></figure><p id="9cc2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在这个测试中，你会注意到我们有一个<code class="fe lq lr ls lt b">beforeEach</code>模块:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="b4bc" class="nh ma iq lt b gy ni nj l nk nl">beforeEach(() =&gt; {<br/>    // server starts to listen for http calls<br/>    cy.server();<br/>    // create route that cypress will listen for, here it is the films endpoint of the SWAPI<br/>    cy.route("GET", "https://swapi.dev/api/films/**").as("films");<br/>  });</span></pre><p id="4b3c" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这是<code class="fe lq lr ls lt b">mocha</code>和<code class="fe lq lr ls lt b">jasmine</code>的标准，因为它在实际执行测试之前设置了测试运行器。注意<code class="fe lq lr ls lt b">cy.server</code>对象的使用。这允许Cypress监听网络调用，特别是这个测试寻找“swapi . dev”API调用:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="6e0c" class="nh ma iq lt b gy ni nj l nk nl">cy.route("GET", "https://swapi.dev/api/films/**").as("films"); });</span></pre><p id="dc55" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后在实际的测试运行中，注意有一个<code class="fe lq lr ls lt b">cy.wait</code>等待API调用完成来验证结果:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="2fff" class="nh ma iq lt b gy ni nj l nk nl">// await the response from the SWAPI http call cy.wait("@films").then((films) =&gt; { expect(films.response.body.title).to.equal("A New Hope"); });</span></pre><p id="2d1a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这是非常强大的，因为它将允许您测试API调用的有效负载，并允许测试运行程序足够灵活，不仅可以处理页面上的DOM，还可以处理HTTP调用应该返回的正确有效负载。</p><h1 id="f7ec" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">命令</h1><p id="8365" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">因此，到目前为止，我们所有的测试都有如下内容:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="ee1a" class="nh ma iq lt b gy ni nj l nk nl">cy.visit("/home-page"); cy.get("#startButton").click(); cy.get("h1").should("contain", "Learn Cypress"); cy.get("#networkButton").click();</span></pre><p id="7621" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这就是我所认为的“锅炉板”,因为你总是必须访问主页并点击其中一个按钮来与适用的页面进行交互。</p><p id="4d86" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Cypress允许您通过在<code class="fe lq lr ls lt b">support</code>文件夹中创建<code class="fe lq lr ls lt b">commands</code>来减少样板文件。如果你打开文件<code class="fe lq lr ls lt b">cypress/support/commands.js</code>，你会注意到有一些文件指向<a class="ae kc" href="https://on.cypress.io/custom-commands" rel="noopener ugc nofollow" target="_blank">命令指南</a>。在Cypress中，您可以构建<code class="fe lq lr ls lt b">commands</code>，它们基本上只是一组步骤的别名。如果您在这里构建了一个命令，那么您可以在您的测试中引用它，避免大量的复制和粘贴。</p><p id="dc1c" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">继续将以下内容添加到<code class="fe lq lr ls lt b">commands.js</code>文件中:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="6416" class="nh ma iq lt b gy ni nj l nk nl">Cypress.Commands.add("start", () =&gt; {<br/>  cy.visit("/home-page");<br/>  cy.get("#startButton").click();<br/>  cy.get("h1").should("contain", "Learn Cypress");<br/>  cy.get("#formsButton").should("contain", "Forms");<br/>  cy.get("#listsButton").should("contain", "Lists");<br/>  cy.get("#networkButton").should("contain", "Network Requests");<br/>});</span></pre><p id="3cb4" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在这里，我们创建了一个<code class="fe lq lr ls lt b">start</code>命令，该命令一直流向<code class="fe lq lr ls lt b">content</code>页面。然后，它验证按钮标签的值是否正确。</p><p id="7f03" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后，我们可以返回到原始的表单测试文件(<code class="fe lq lr ls lt b">forst.spec.js</code>)并删除:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="f452" class="nh ma iq lt b gy ni nj l nk nl">cy.visit('/home-page'); cy.get('#startButton').click(); cy.get('h1').should('contain', 'Learn Cypress');</span></pre><p id="ad4e" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">并补充:</p><pre class="lv lw lx ly gt nd lt ne nf aw ng bi"><span id="688b" class="nh ma iq lt b gy ni nj l nk nl">before(() =&gt; { cy.start(); });</span></pre><p id="bdba" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这引用了我们创建的<code class="fe lq lr ls lt b">start</code>命令。现在，如果您运行测试，您将会看到<code class="fe lq lr ls lt b">start</code>命令，并且测试已经运行，您不需要引用相关的规范文件。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ob"><img src="../Images/692bdcda79b1acf8661b144d1d511135.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tLDfHojMJ3FAaEO4.png"/></div></div></figure><h1 id="f6a5" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">词中跑柏</h1><p id="ea9b" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">因此，我想介绍的最后一件事是当您在CI中运行Cypress时会发生什么。在开始部分，您会注意到我们创建了一个名为<code class="fe lq lr ls lt b">cypress run</code>而不是<code class="fe lq lr ls lt b">cypress open</code>的<code class="fe lq lr ls lt b">cypress-ci</code> npm脚本。这是在你的项目管道中“无头”运行的Cypress机制。</p><p id="1de2" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果您继续进行我们到目前为止编写的测试，您可以运行<code class="fe lq lr ls lt b">cypress-ci</code>来查看输出。首先停止你的应用程序和Cypress(如果你还没有这样做)，然后运行<code class="fe lq lr ls lt b">npm run cypress-ci</code>查看以下内容:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oc"><img src="../Images/aa92789574e96375f49ee35f9891feca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UZwlWHSjM6MextUI.png"/></div></div></figure><p id="ec72" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这是所有规格文件的运行记录。到目前为止，您将使用测试运行器GUI单独运行每个<code class="fe lq lr ls lt b">spec</code>文件。现在在CI中，Cypress将使用控制台输出运行您的所有规范文件，您可以将这些文件保存在各自的CI系统中。</p><p id="ebf1" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">您还会注意到在<code class="fe lq lr ls lt b">videos</code>文件夹中存储有<code class="fe lq lr ls lt b">mp4</code>文件:</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d0d30e90b2af95147cddc24f2fab5b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/0*vLf6mM9vvwQw8LQA.png"/></div></figure><p id="c37f" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这些是你的CI测试的实时运行。这里最酷的部分是，您可以编写这个过程的脚本，这样您就可以复制这些文件，并将它们发送到一个共享文件夹。这也可以在您进行部署时直接发送给项目的产品所有者。这里有很多选择。</p><h1 id="0c8a" class="lz ma iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">结论</h1><p id="b57d" class="pw-post-body-paragraph ke kf iq kg b kh mx kj kk kl my kn ko kp mz kr ks kt na kv kw kx nb kz la lb ij bi translated">我希望你喜欢我的帖子，并对赛普拉斯有所了解。我在几个项目中使用过它，发现它不仅强大，而且有趣。Cypress的工具和社区支持使它成为一个非常友好的开发工具。对记录和存储测试运行信息的支持也使它成为任何项目团队的强大资产。我建议在Cypress网站上查看文档和各种指南。</p><p id="07dd" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">感谢您阅读我的帖子！请在<a class="ae kc" href="https://andrewevans.dev/" rel="noopener ugc nofollow" target="_blank"> andrewevans.dev </a>上关注我，并在推特上关注我，网址是<a class="ae kc" href="https://twitter.com/AndrewEvans0102" rel="noopener ugc nofollow" target="_blank"> @AndrewEvans0102 </a>。也可以在<a class="ae kc" href="https://twitter.com/rhythmandbinary" rel="noopener ugc nofollow" target="_blank"> @rhythmandbinary </a>和<a class="ae kc" href="https://www.youtube.com/channel/UCvAKKewP_o2l3XnwDzSxftw" rel="noopener ugc nofollow" target="_blank"> YouTube频道</a>查看Rhythm和Binary的新Twitter feed。谢谢！</p></div><div class="ab cl oe of hu og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ij ik il im in"><p id="447a" class="pw-post-body-paragraph ke kf iq kg b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><em class="nq">原载于</em><a class="ae kc" href="https://rhythmandbinary.com/post/2021-03-15-how-to-use-cypress-for-e2e-with-react" rel="noopener ugc nofollow" target="_blank"><em class="nq">https://rhythmandbinary.com</em></a><em class="nq">。</em></p></div></div>    
</body>
</html>