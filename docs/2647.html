<html>
<head>
<title>How to Set Up React with a Ruby on Rails Project Part 2 — Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Ruby on Rails项目设置React第2部分— Redux</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-set-up-react-js-with-a-ruby-on-rails-project-part-2-redux-31ac07638f34?source=collection_archive---------16-----------------------#2021-05-31">https://javascript.plainenglish.io/how-to-set-up-react-js-with-a-ruby-on-rails-project-part-2-redux-31ac07638f34?source=collection_archive---------16-----------------------#2021-05-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/027b6234d18748604473049999dde17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4T-uSk4PqnjrD1EXrdwqog.jpeg"/></div></div></figure><p id="dcad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">之前，我们设置了Ruby on Rails应用程序来使用React。</p><p id="e2ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要做更多的事情来确保我们的应用程序真正发挥作用。我们仍然需要</p><ol class=""><li id="a69a" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">在rails中设置我们的模型</li><li id="d3ac" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">让我们的前端连接到我们的后端</li><li id="202a" class="kt ku in jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">集成Redux以便React更好地工作。</li></ol><p id="0933" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们开始吧。</p><h1 id="10ff" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">在rails中设置我们的Post模型和控制器</h1><p id="ac7e" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">这将是一个非常常见的Rails代码。首先在“app/models/Post.rb”中创建模型。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="3bb6" class="mt li in mp b gy mu mv l mw mx">class Post &lt; ApplicationRecord</span><span id="1282" class="mt li in mp b gy my mv l mw mx">end</span></pre><p id="738e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将设置我们的序列化程序。这基本上把我们的模型变成了JSON，我们可以把它发送到我们的前端。创建“app/serializer/post _ serializer . Rb”并放置以下内容:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="71f2" class="mt li in mp b gy mu mv l mw mx">class PostSerializer<br/>  include FastJsonapi::ObjectSerializer<br/>  attributes :title, :body</span><span id="c8e0" class="mt li in mp b gy my mv l mw mx">end</span></pre><p id="4411" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些属性是我们的模型上的属性，我们将把它们公开为JSON。这提醒了我，我们需要添加FastJsonapi宝石。转到您的gem文件并添加:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="e93b" class="mt li in mp b gy mu mv l mw mx">gem 'fast_jsonapi'</span></pre><p id="1439" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">运行捆绑包安装。</p><p id="c397" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们需要在数据库中建立我们的模型。运行以下命令:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="62e7" class="mt li in mp b gy mu mv l mw mx">rails g migration create_posts</span></pre><p id="d7d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在迁移文件中:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="7e85" class="mt li in mp b gy mu mv l mw mx">class CreatePosts &lt; ActiveRecord::Migration[6.1]<br/>  def change<br/>    create_table :posts do |t|<br/>      t.string :title<br/>      t.string :body<br/>      t.timestamps<br/>    end<br/>  end</span><span id="9617" class="mt li in mp b gy my mv l mw mx">end</span></pre><p id="dc01" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后运行迁移:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="3c58" class="mt li in mp b gy mu mv l mw mx">rails db:migrate</span></pre><p id="c24b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，在控制器上。在“app/controller/API/v1/posts _ controller . Rb”中设置您的控制器代码。这在通常的Rails CRUD控制器代码中很常见，但是我们将呈现JSON，而不是呈现视图或重定向。</p><p id="16a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是控制器的代码:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="ab4d" class="mt li in mp b gy mu mv l mw mx">module Api<br/>  module V1<br/>    class PostsController &lt; ApplicationController<br/> <br/>      def index<br/>        posts = Post.all<br/>        render json: PostSerializer.new(posts).serialized_json<br/>      end<br/>    <br/> <br/>    def show<br/>      post = Post.find(params[:id])<br/>      render json: PostSerializer.new(post).serialized_json<br/>    end<br/> <br/>    def create <br/>      post = Post.new(post_params)<br/> <br/>      if post.save<br/>        render json: PostSerializer.new(post).serialized_json<br/>      else<br/>        render json: {error: post.errors.messsages}<br/>      end<br/>    end<br/> <br/>    def update<br/>      post = Post.find(params[:id])<br/>      if post.update(post_params)<br/>        render json: PostSerializer.new(post).serialized_json<br/>      else<br/>        render json: { error: post.errors.messages }<br/>      end<br/>    end<br/> <br/>    def destroy<br/>      post = Post.find(params[:id])<br/> <br/>      if post.destroy<br/>        head :no_content<br/>      else<br/>        render json: { error: post.errors.messages }<br/>      end<br/>    end<br/> <br/>    private <br/>     <br/>    def post_params<br/>      params.require(:post).permit(:title, :body)<br/>    end<br/>  end</span><span id="3d20" class="mt li in mp b gy my mv l mw mx">end</span></pre><p id="b78d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在是用Postman之类的东西测试所有这些动作的好时机。在进入前端之前，继续测试您的API。</p><p id="982a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将在接下来的部分中编写大量代码来连接我们的后端。你的后端正常工作是很重要的。</p><p id="4d35" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">打开Rails控制台并添加一些记录，这样我们就可以看到我们的数据。我是这么做的。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="1914" class="mt li in mp b gy mu mv l mw mx">Post.create(title: "one", body:"something")</span><span id="9f36" class="mt li in mp b gy my mv l mw mx">Post.create(title: "two", body:"something else")</span></pre><p id="dc6f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，当您达到帖子的索引端点时，您应该会获得一些记录。</p><h1 id="1367" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">向Ruby on Rails添加Redux</h1><p id="92b6" class="pw-post-body-paragraph jv jw in jx b jy mf ka kb kc mg ke kf kg mh ki kj kk mi km kn ko mj kq kr ks ig bi translated">创建一个文件夹和文件夹“app/javascript/src/api/api.js”这是我们要用来和我们的后端对话的。我们的文件将是这样的:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="5ac9" class="mt li in mp b gy mu mv l mw mx">import axios from 'axios'<br/> <br/>const ROOT_PATH = '/api/v1'<br/>const POSTS_PATH = `${ROOT_PATH}/posts`<br/> <br/>export const getPosts = () =&gt; {<br/>  return axios.get(POSTS_PATH)</span><span id="df82" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="f3d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在导入axios，这样我们就可以向后端发出http请求。然后，我们为我们的路线设置一些常数。最后，我们将创建一个向我们的posts路由发出get请求的函数。</p><p id="dbad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用纱线添加axios:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="acc3" class="mt li in mp b gy mu mv l mw mx">yarn add axios</span></pre><p id="6adb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在是时候添加redux了。我将尽我所能解释清楚，但是我假设在您开始尝试将redux添加到Rails之前，您已经对redux的工作原理有所了解。</p><p id="289d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在“app/javascript/src/actions”中创建一个actions文件夹，并在该文件夹中创建一个posts.js文件。在文件中写下:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="224f" class="mt li in mp b gy mu mv l mw mx">import * as api from '../api/api'<br/> <br/>export const getPosts = () =&gt; async (dispatch) =&gt; {<br/>  const { data } = await api.getPosts()</span><span id="b588" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="9c3f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在导入我们的api，所以我们可以使用那里的方法。我们还创建了一个函数，它只调用我们的api并返回数据。“dispatch”部分可能看起来很奇怪，但是我们这样做是为了让redux-thunk工作。</p><p id="6440" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们稍后将回到这个函数，但这足以测试它。</p><p id="7b78" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编辑:在添加之前，我们不会测试这个函数。耐心等待，我们将回到这个函数。</p><p id="dbf0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到位于“app/javascript/packs/index.jsx”的index.jsx文件，使该文件如下所示</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="abbc" class="mt li in mp b gy mu mv l mw mx">import React from 'react'<br/>import ReactDOM from 'react-dom'<br/>import { BrowserRouter as Router, Route } from 'react-router-dom'<br/>import App from '../src/components/App'<br/> <br/>import { Provider } from 'react-redux'<br/>import { createStore, applyMiddleware, compose } from 'redux'<br/>import thunk from 'redux-thunk'<br/>import reducers from '../src/reducers'<br/> <br/>const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose<br/> <br/>const store = createStore(reducers, composeEnhancers(applyMiddleware(thunk)))<br/> <br/>document.addEventListener('DOMContentLoaded', () =&gt; {<br/>  ReactDOM.render(<br/>    &lt;Provider store={store}&gt;<br/>      &lt;Router&gt;<br/>        &lt;Route path="/" component={App}/&gt;<br/>      &lt;/Router&gt;<br/>    &lt;/Provider&gt;,<br/>    document.body.appendChild(document.createElement('div')),<br/>  )<br/>})</span></pre><p id="25e9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么这些代码是怎么回事呢？首先，我们从react-redux和redux-thunk导入我们需要的所有东西:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="7958" class="mt li in mp b gy mu mv l mw mx">import { Provider } from 'react-redux'<br/>import { createStore, applyMiddleware, compose } from 'redux'<br/>import thunk from 'redux-thunk'</span><span id="928e" class="mt li in mp b gy my mv l mw mx">import reducers from '../src/reducers'</span></pre><p id="b229" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还将导入一个reducers文件，稍后我们将创建该文件。</p><p id="9fed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，这一行设置Redux，这样我们就可以使用Chrome redux开发工具。如果你没有这样设置，Chrome扩展将无法工作:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="f7f3" class="mt li in mp b gy mu mv l mw mx">const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose</span></pre><p id="6752" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们将创建我们的商店，让我们能够与state合作。我们还告诉我们的应用程序，我们想使用redux-thunk。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="e53d" class="mt li in mp b gy mu mv l mw mx">const store = createStore(reducers, composeEnhancers(applyMiddleware(thunk)))</span></pre><p id="f46f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们将应用程序包装在Provider标签中。这与访问我们应用程序中的商店或状态有关。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="0008" class="mt li in mp b gy mu mv l mw mx">&lt;Provider store={store}&gt;<br/>      &lt;Router&gt;<br/>        &lt;Route path="/" component={App}/&gt;<br/>      &lt;/Router&gt;</span><span id="5789" class="mt li in mp b gy my mv l mw mx">&lt;/Provider&gt;</span></pre><p id="7dd3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">文件就这些了。现在我们需要创建我们刚刚导入的那个缩减器。但首先，确保你用纱线添加包装。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="68bb" class="mt li in mp b gy mu mv l mw mx">yarn add react-redux redux-thunk</span></pre><p id="3242" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在“app/javascript/src”中创建一个reducers文件夹，创建两个文件。创建一个“posts.js”文件和一个“index.js”文件。我们先打开“posts.js”文件。</p><p id="7344" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个文件将会记录你的应用状态中的帖子。这个文件的任务是当你的动作文件发出某些动作时，更新所有的文章。</p><p id="b0a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该文件如下所示:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="66f9" class="mt li in mp b gy mu mv l mw mx">import { GET_POSTS } from '../types/index'<br/> <br/>export default (posts = [], action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POSTS:<br/>      return action.payload<br/>    default:<br/>      return posts<br/>  }</span><span id="040a" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="18fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们来分析一下这里发生了什么。首先，我们导入一个GET_POSTS类型。我们一会儿就会创建它。</p><p id="556e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们导出一个函数，并将posts的初始状态设置为一个空数组。然后我们有了switch语句。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="27de" class="mt li in mp b gy mu mv l mw mx">switch (action.type) {<br/>   case GET_POSTS:<br/>     return action.payload<br/>   default:<br/>     return posts</span><span id="46d5" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="906a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是在说“每当我看到GET_POSTS动作时，我将从该动作中获取有效负载，并将我的帖子设置为等于该有效负载。对于所有其他操作(默认)，我只是返回帖子，什么也不做。</p><p id="fc42" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">稍后，当我们使用我们的动作时，我们将发送类似GET_POSTS的类型，告诉这个reducer使用我们传递给它的数据。如果有任何其他动作类型传递给它，它不会做任何事情。</p><p id="ddeb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们忘记之前，让我们在“app/JavaScript/src/types/index . js”中创建类型文件夹和文件。这将有助于我们以后打错任何类型。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="1181" class="mt li in mp b gy mu mv l mw mx">export const GET_POSTS = "GET_POSTS"</span></pre><p id="3ca7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们转到“app/JavaScript/src/reducers . index . js”文件。这个文件只是结合了你所有的减速器。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="5bf0" class="mt li in mp b gy mu mv l mw mx">import { combineReducers } from 'redux'<br/>import posts from './posts'<br/> <br/>export default combineReducers({<br/>  posts: posts</span><span id="2d3b" class="mt li in mp b gy my mv l mw mx">})</span></pre><p id="cbe1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这告诉redux我们需要一个名为“posts”的状态键，并将其设置为与状态中的posts相等。</p><p id="a98c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">既然我们已经设置了我们的reducers，我们可以返回到我们的action creator文件并分派操作。基本上，这让我们的行为与我们的还原者对话。回到“apps/JavaScript/src/actions/posts . js ”,让你的文件看起来像这样。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="4950" class="mt li in mp b gy mu mv l mw mx">import * as api from '../api/api'<br/>import { GET_POSTS } from '../types/index'<br/> <br/>export const getPosts = () =&gt; async (dispatch) =&gt; {<br/>  const { data } = await api.getPosts()<br/>  dispatch({<br/>    type: GET_POSTS,<br/>    payload: data.data<br/>  })<br/>}</span></pre><p id="56b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是我们正在做的。我们使用api从rails后端获取数据。然后，通过“dispatch”我们告诉我们所有的reducers“嘿，如果你订阅了GET_POSTS操作，我有一些数据给你。”</p><p id="33e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在只有一个reducer，但是所有的reducer都会关注这个动作，只有那些订阅了GET_POSTS的reducer才会执行任何操作。在我们的例子中，我们的posts reducer正在寻找这种动作类型。它将看到有效载荷中的数据，然后在我们的posts键中设置我们的状态。</p><p id="3ab3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们实际使用我们设置的所有代码！</p><p id="51a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回到我们的Posts组件“app/JavaScript/src/components/Posts/Posts ”,编写以下代码。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="6156" class="mt li in mp b gy mu mv l mw mx">import React, { useEffect } from 'react'<br/>import { useDispatch, useSelector } from 'react-redux'<br/>import { getPosts } from '../../actions/posts'<br/> <br/> <br/>const Posts = () =&gt; {<br/>  const dispatch = useDispatch()<br/>  const posts = useSelector(state =&gt; state.posts)<br/>  useEffect(() =&gt; {<br/>      dispatch(getPosts())<br/>  }, [])<br/> <br/>  if (posts.length === 0) { return &lt;div&gt;loading...&lt;/div&gt;}<br/> <br/>  console.log(posts)<br/> <br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;Posts&lt;/h1&gt;<br/>      &lt;p&gt;This is our posts page.&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="7e50" class="mt li in mp b gy my mv l mw mx">export default Posts</span></pre><p id="f1f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是怎么回事？</p><p id="56a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在从react-redux获得一些函数，并获得我们的动作创建器函数。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="44b4" class="mt li in mp b gy mu mv l mw mx">import { useDispatch, useSelector } from 'react-redux'<br/>import { getPosts } from '../../actions/posts'</span></pre><p id="0a37" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在这里设置我们的调度功能。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="0c53" class="mt li in mp b gy mu mv l mw mx">const dispatch = useDispatch()</span></pre><p id="249f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们告诉react创建一个名为posts的变量，并将其设置为redux存储中的posts。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="a177" class="mt li in mp b gy mu mv l mw mx">const posts = useSelector(state =&gt; state.posts)</span></pre><p id="6596" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们说“当这个组件加载时，使用我的动作创建器获取所有的帖子。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="7401" class="mt li in mp b gy mu mv l mw mx">useEffect(() =&gt; {<br/>     dispatch(getPosts())<br/>}, [])</span></pre><p id="8658" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们的页面在我们的数据返回之前加载，我们将有一个加载信号。否则，如果你在数据从服务器返回之前就开始尝试访问数据，你的应用就会崩溃。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="0cee" class="mt li in mp b gy mu mv l mw mx">if (posts.length === 0) { return &lt;div&gt;loading...&lt;/div&gt;}</span></pre><p id="b65c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们只是控制台。登录我们的职位。你应该也能在Chrome redux开发工具中看到它们。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="48db" class="mt li in mp b gy mu mv l mw mx">console.log(posts)</span></pre><p id="fd89" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">太棒了，现在我们的react应用程序可以从redux store读取数据，这些数据来自我们的后端。我们在最后冲刺阶段！</p><p id="4acf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不过，我们不只是想记录我们的数据。所以，让我们解决这个问题。在我们的返回函数中，我们要像这样放另一个函数。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="b2e5" class="mt li in mp b gy mu mv l mw mx">return (<br/>   &lt;div&gt;<br/>     &lt;h1&gt;Posts&lt;/h1&gt;<br/>     {renderPosts()}<br/>   &lt;/div&gt;</span><span id="777c" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="1d8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们在这个文件中创建一个名为renderPosts的函数。在这里，我们将遍历我们的每个帖子并呈现一个组件。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="685e" class="mt li in mp b gy mu mv l mw mx">const renderPosts = () =&gt; {<br/>    return posts.map(post =&gt; {<br/>      return &lt;PostListItem key={post.id} post={post} /&gt;<br/>    })</span><span id="488d" class="mt li in mp b gy my mv l mw mx">}</span></pre><p id="feb4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将当前帖子传递给每个项目。我们还要给它一个键，否则react会对我们大喊大叫，这会影响性能。</p><p id="3512" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">导入顶部的列表项目。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="6b79" class="mt li in mp b gy mu mv l mw mx">import PostListItem from './PostListItem'</span></pre><p id="0070" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后在“app/JavaScript/src/components/Post/PostListItem”处创建。</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="6469" class="mt li in mp b gy mu mv l mw mx">import React from 'react'<br/> <br/> <br/>const PostListItem = ({post}) =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;h2&gt;{post.attributes.title}&lt;/h2&gt;<br/>      &lt;p&gt;{post.attributes.body}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="e03e" class="mt li in mp b gy my mv l mw mx">export default PostListItem</span></pre><p id="d12b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你现在应该可以看到你所有的帖子了。</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/21601cb273b0f807aa338098e7a48e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*JfWTRZksyT75vlxPBW7S2A.png"/></div></figure><p id="3a97" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下一篇文章中，我将介绍Rails和React中的CRUD操作。敬请期待！</p><p id="fd19" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="na">更多内容尽在</em><a class="ae nb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="na">plain English . io</em></a></p></div></div>    
</body>
</html>