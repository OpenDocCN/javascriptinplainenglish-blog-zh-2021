<html>
<head>
<title>Publishing a TypeScript library in 2021</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在2021年发布一个类型脚本库</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/publishing-a-typescript-library-in-2021-751842afc10f?source=collection_archive---------17-----------------------#2021-05-31">https://javascript.plainenglish.io/publishing-a-typescript-library-in-2021-751842afc10f?source=collection_archive---------17-----------------------#2021-05-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="8354" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上一次想发布npm包是在2018年。它是一个React库，提供了创建表单的组件。当时发布这样一个库并不容易。你自己要处理的事情太多了，尤其是打字稿。</p><p id="5734" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设你已经熟悉了webpack，你会想:哈，这应该很容易，我可以利用我的知识，把我的库和webpack捆绑在一起，就像我的webapps一样。但是后来你突然听说了这个新的产品:Rollup，它似乎在捆绑库方面做得更好。所以你必须学习一个新的捆扎机，而且你自己还有很多事情要做。</p><p id="a9ea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">很好，我们现在快进到了2021年。镇上来了一个新玩家，让我们的生活变得更加轻松<strong class="jm io">。我给你介绍一下<a class="ae ki" href="https://tsdx.io" rel="noopener ugc nofollow" target="_blank"> tsdx.io </a></strong></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/035e4d2baaa431ab73b3204ec53d560e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HTG2cPJhSQFm8vBnJ95Tzg@2x.png"/></div></div></figure><h1 id="c0f6" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">用于TypeScript包开发的零配置CLI</h1><p id="0b3d" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">TSDX的目标是消除我上面提到的所有痛点，让您专注于开发下一个库，而不是“在配置上再浪费一个下午”。哦，天啊，他们在这方面做得非常好。实际上，我找不到TSDX首字母缩写词的含义，但我认为它代表TypeScript开发人员体验——这无疑增强了很多。</p><p id="2770" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TSDX附带Rollup under the hood，并为您提供开发和捆绑现代NPM包的最佳实践。它经过了很好的测试，TSDX背后的团队是<a class="ae ki" href="https://formium.io/" rel="noopener ugc nofollow" target="_blank"> formium </a>，他们也在开发流行的React forms库<a class="ae ki" href="https://github.com/formium/formik" rel="noopener ugc nofollow" target="_blank"> formik </a>，它也利用了TSDX的功能。</p><p id="9bb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TSDX附带的最佳实践对于大多数项目来说应该是完美的。即使你需要做一些调整，这个过程也很简单。例如对于<a class="ae ki" href="https://github.com/snappify-io/integration" rel="noopener ugc nofollow" target="_blank">我们的库</a>，我们希望使用更少的代码，而不是编写普通的css，稍后我将向您展示如何根据您的需求调整TSDX配置。</p><h1 id="be6e" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">创建新的TSDX项目</h1><p id="9b25" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">用TSDX创建一个新的TypeScript库就像键入<code class="fe ly lz ma mb b">npx tsdx create mylib</code>一样简单。该命令将引导您完成安装过程，之后您将看到一个打包的文件夹，您可以在其中开始开发您的新库。</p><p id="79e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TSDX有三种不同的项目类型，您必须从中选择一种:</p><ul class=""><li id="b81d" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh mh mi mj mk bi translated">一个普通的TypeScript项目(我们这样做是因为我们不想包含任何外部库，也不依赖React)</li><li id="2762" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">如果你想创建一个反应库，选择这个选项。TSDX负责创建一个现成的React库所必须做的所有事情</li><li id="1f38" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated"><code class="fe ly lz ma mb b">react-with-storybook</code> -与之前的选项相同，但包括故事书设置</li></ul><h2 id="5c47" class="mq kw in bd kx mr ms dn lb mt mu dp lf jv mv mw lj jz mx my ln kd mz na lr nb bi translated">开始</h2><p id="a37a" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">TSDX使开发你的图书馆超级容易。你只需输入<code class="fe ly lz ma mb b">npm start</code>，你的项目就会在观察模式下启动。您的库的入口点是<code class="fe ly lz ma mb b">index.ts</code>(或者对于React项目是<code class="fe ly lz ma mb b">index.tsx</code>)。因此，当你在相应的文件中进行修改时，TSDX会检测到并为你重建库，从而实现超级平滑的开发过程。</p><h2 id="9097" class="mq kw in bd kx mr ms dn lb mt mu dp lf jv mv mw lj jz mx my ln kd mz na lr nb bi translated">运行测试</h2><p id="49fe" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">TSDX还为您提供了Jest设置，因此您可以以<code class="fe ly lz ma mb b">*.test.ts(x)</code>文件的格式编写测试，如果您键入<code class="fe ly lz ma mb b">npm test</code>，Jest将自动识别并执行它们。</p><h2 id="0ebc" class="mq kw in bd kx mr ms dn lb mt mu dp lf jv mv mw lj jz mx my ln kd mz na lr nb bi translated">在本地试试你的图书馆</h2><p id="2834" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">当然，在将你的库发布到互联网上之前，你也想在本地试用一下。为此，npm命令<code class="fe ly lz ma mb b">npm link</code>非常方便。</p><ol class=""><li id="8249" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh nc mi mj mk bi translated">进入你的库文件夹<code class="fe ly lz ma mb b">cd ~/projects/mylib</code></li><li id="4de9" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh nc mi mj mk bi translated">键入<code class="fe ly lz ma mb b">npm link</code>创建库的本地符号链接</li><li id="3934" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh nc mi mj mk bi translated">切换到您想要包含您的库的项目文件夹<code class="fe ly lz ma mb b">cd ~/projects/myproject</code></li><li id="ab91" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh nc mi mj mk bi translated">键入<code class="fe ly lz ma mb b">npm link myproject</code>安装本地版本的库。如果您对您的库进行更改并重新构建它，这也将自动刷新(如果您在库项目中执行<code class="fe ly lz ma mb b">npm start</code>，这将由watch命令自动完成)</li></ol><p id="0d79" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">确保使用package.json中的完整库名(不是文件夹名)执行npm链接。在我们的例子中，我们必须键入<code class="fe ly lz ma mb b">npm link @snappify/integration</code>,因为我们的包包含在我们的npm组织中。</p><h1 id="3a57" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">调整默认配置</h1><p id="6124" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">现在您应该准备好开发您的库并测试它，直到您可以发布它。但是，如果默认的TSDX不能满足您的需求，您需要调整配置，该怎么办呢？</p><p id="2a6a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您想要调整构建配置，您必须在您的库文件夹的根目录下创建一个<code class="fe ly lz ma mb b">tsdx.config.js</code>文件。在它们中，您将导出一个包含<code class="fe ly lz ma mb b">rollup</code>函数的对象，该函数接收默认汇总配置作为第一个参数，并期望修改后的配置作为返回值。</p><p id="0d82" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里你可以看到我们的配置，我们增加了写得更少而不是css的可能性:</p><pre class="kk kl km kn gt nd mb ne nf aw ng bi"><span id="7b03" class="mq kw in mb b gy nh ni l nj nk">const less = require('rollup-plugin-less');<br/><br/>module.exports = {<br/>  rollup(config) {<br/>    config.plugins.push(<br/>      less({<br/>        insert: true,<br/>        output: false,<br/>      })<br/>    );<br/>    return config;<br/>  },<br/>};</span></pre><h1 id="6540" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">添加有用的GitHub工作流程</h1><p id="298c" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">对于一个严肃的图书馆来说，一套好的GitHub工作流是很有帮助的！例如，您希望在每次提交时执行测试或linter，或者如果某个更改导致您的包大小大幅增加，您希望有一个大小限制机器人对您的pull请求进行评论。</p><p id="b6ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">自由地看一看<a class="ae ki" href="https://github.com/snappify-io/integration/tree/main/.github/workflows" rel="noopener ugc nofollow" target="_blank">我们的GitHub工作流程</a>，在那里我们为我们的开源库设置了所有这些。大小限制的配置可以在<a class="ae ki" href="https://github.com/snappify-io/integration/blob/main/package.json#L37" rel="noopener ugc nofollow" target="_blank"> our package.json </a>中找到。</p><h1 id="b619" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">发布您的库</h1><p id="95a1" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">所以你知道一切都根据你的需要进行调整，有足够的时间来开发你的库并在本地试用。你确信:你的图书馆已经准备好被公众消费了！那么下一步是什么？在安装过程中，TSDX确保在你的<code class="fe ly lz ma mb b">package.json</code>中添加一个合适的<code class="fe ly lz ma mb b">prepare</code>脚本。每次你执行<code class="fe ly lz ma mb b">npm publish</code>的时候，准备脚本就会自动执行——所以每次你想发布一个新版本的包的时候。</p><p id="36aa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">TSDX在发布之前所做的是创建一个新的TSDX版本，这也确保了在您发布新版本之前该版本不会失败。所以你基本上只需要运行<code class="fe ly lz ma mb b">npm publish</code>(带有你想要的相应参数，例如，它是否应该公开发布)就可以了！</p><h1 id="ef33" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">摘要</h1><p id="32fb" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">当我们想为我们的产品创建一个npm包时，我有点害怕，因为我记得几年前创建这样一个库的所有困难。我听说过Timo Lins的react-hot-toast，并问他是否有一些开始创建TypeScript npm包的技巧。</p><p id="9704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">他指给我TSDX，我开始玩它，很快就迷上了。默认的最佳实践是可行的，正如网站所说:你可以专注于开发你的库，而不是试图找出正确的配置。</p><p id="9e4f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我要感谢TSDX背后的整个团队创建了这个令人敬畏的工具，并从创建TypeScript库的痛苦中解脱出来。🎉</p><p id="1773" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nl">更多内容请看</em><a class="ae ki" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nl">plain English . io</em></strong></a></p></div></div>    
</body>
</html>