<html>
<head>
<title>Error Handling For Angular HTTP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular HTTP的错误处理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/error-handling-for-angular-http-e39485398e61?source=collection_archive---------4-----------------------#2021-09-19">https://javascript.plainenglish.io/error-handling-for-angular-http-e39485398e61?source=collection_archive---------4-----------------------#2021-09-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/5f0a9f970e7683c0a97e897c12b64555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WMgdtzR7l6GGzNqh"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@dav420?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">David Pupaza</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9ad7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们将讨论在Angular中发出HTTP请求时处理错误的一些方法。</p><p id="a8d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们创建一个新的Angular项目，名称为<code class="fe ky kz la lb b">exercise1</code>。然后，我们将在这个项目中创建三个组件和一个服务。该项目的<code class="fe ky kz la lb b">src</code>目录如下所示。</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lc"><img src="../Images/37c065f04785401498f12f4b80a0d46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*da-YSJF2ZRyhlqCPKWcQ8A.png"/></div></div></figure><p id="eb31" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe ky kz la lb b">app.module.ts</code>中，我们将导入<code class="fe ky kz la lb b">HttpClientModule</code>。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="ce59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe ky kz la lb b">app.component.html</code>中，我们将包括以下所有三个部分—</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="08f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们将在<code class="fe ky kz la lb b">api-call.service.ts</code>文件中编写我们的HTTP请求服务。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="7e3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们将在三个组件中创建三个按钮。单击一个按钮时，将调用附加到该按钮的一个函数，该函数又向API端点发送一个HTTP GET请求，并在页面上显示数据。</p><p id="f4c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">example-one.component.html</code>和<code class="fe ky kz la lb b">example-one.component.ts</code>具有以下代码—</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="303f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">类似地，其他两个组件具有以下代码—</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="36b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，如果我们点击这些按钮，我们会得到以下结果—</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lj"><img src="../Images/29cd4caeb891879f27da327c370205dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4_67Rn0EmPVTc3Jvys6Yxg.png"/></div></div></figure><h1 id="f5fe" class="lk ll in bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">处理错误</h1><p id="25de" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">在进行HTTP请求时，我们经常会在某个时间点遇到错误。为了在不影响用户体验的情况下有效地处理这些错误，我们有一些方法，解释如下</p><p id="c0a2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们在<code class="fe ky kz la lb b">api-call.service.ts</code>文件中的<code class="fe ky kz la lb b">baseUrl</code>处打个小错别字。我们将改变<code class="fe ky kz la lb b">baseUrl</code></p><p id="bce9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从</p><pre class="ld le lf lg gt mn lb mo mp aw mq bi"><span id="76a4" class="mr ll in lb b gy ms mt l mu mv">https://jsonplaceholder.typicode.com/todos/</span></pre><p id="dfa6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到</p><pre class="ld le lf lg gt mn lb mo mp aw mq bi"><span id="bfd8" class="mr ll in lb b gy ms mt l mu mv">https://jsonplaceholder.typicode.com/tod/</span></pre><h2 id="fe01" class="mr ll in bd lm mw mx dn lq my mz dp lu kl na nb ly kp nc nd mc kt ne nf mg ng bi translated"><strong class="ak"> <em class="nh">第一法</em> </strong></h2><p id="4411" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">因为我们知道<code class="fe ky kz la lb b">subscribe</code>方法的第二个参数是一个错误处理函数，所以我们可以用它来捕捉错误响应。</p><p id="00fd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将在<code class="fe ky kz la lb b">example-one.component.ts</code>和<code class="fe ky kz la lb b">example-one.component.html</code>中做一些修改。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="f903" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，当我们点击第一个按钮时，我们会得到以下结果—</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ni"><img src="../Images/91e7ed6f26296364ff5048b91f4d3f74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ueFwxrgFB3rR9os1Ion3WQ.png"/></div></div></figure><h2 id="f468" class="mr ll in bd lm mw mx dn lq my mz dp lu kl na nb ly kp nc nd mc kt ne nf mg ng bi translated"><strong class="ak"> <em class="nh">第二法</em> </strong></h2><p id="72fa" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">在这个方法中，我们将使用<code class="fe ky kz la lb b">rxjs</code>中的<code class="fe ky kz la lb b">Subject</code>。</p><p id="a123" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，我们必须修改<code class="fe ky kz la lb b">api-call.service.ts</code>文件。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="8e0b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，我们使用<code class="fe ky kz la lb b">Subject</code>为结果和错误创建两个新的可观察值。如果<code class="fe ky kz la lb b">fetchDataTwo()</code>函数内部的HTTP调用成功，那么它将发出响应数据。但是如果失败，就会发出一条错误消息。</p><p id="63e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还将修改<code class="fe ky kz la lb b">example-two.component.ts</code>和<code class="fe ky kz la lb b">example-two.component.html</code>文件。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="559a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，当我们点击第二个按钮时，我们将得到以下结果——</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/e7db3eb70cbfea3fca76fbbf738a94c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nQEqkAH4oUs9g_U93nuA4A.png"/></div></div></figure><h2 id="b803" class="mr ll in bd lm mw mx dn lq my mz dp lu kl na nb ly kp nc nd mc kt ne nf mg ng bi translated">第三种方法</h2><p id="ff54" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">在这种方法中，我们使用<code class="fe ky kz la lb b">rxjs</code>的<code class="fe ky kz la lb b">catchError</code>运算符来处理错误。</p><p id="7d6e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将按如下方式修改<code class="fe ky kz la lb b">api-call.service.ts</code>文件——</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="aeaa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，在<code class="fe ky kz la lb b">fetchDataThree()</code>功能中，如果我们得到了成功的响应，那么我们就使用<code class="fe ky kz la lb b">rxjs</code>的<code class="fe ky kz la lb b">map</code>算子修改响应。如果我们在获取数据时出错，那么我们就是在使用<code class="fe ky kz la lb b">rxjs</code>的<code class="fe ky kz la lb b">catchError</code>运算符来捕捉该错误。捕捉到错误后，我们将使用<code class="fe ky kz la lb b">throwError</code>可观测值发出该错误响应。</p><p id="02f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还会修改<code class="fe ky kz la lb b">example-three.component.ts</code>和<code class="fe ky kz la lb b">example-three.component.html</code>文件。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="lh li l"/></div></figure><p id="037c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，当我们点击第三个按钮时，我们将得到以下结果——</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/2f50dc57e2994c56ba22bf3092cc8e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhBS2nYII0fpg7wr08TPVw.png"/></div></div></figure><p id="5ad1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nl">多内容于</em> <a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="nl">中</em></strong></a></p></div></div>    
</body>
</html>