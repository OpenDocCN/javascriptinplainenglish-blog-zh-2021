<html>
<head>
<title>Angular Reactive Forms With Validations And Custom Validations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带验证和自定义验证的角度反应式表单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-reactive-forms-create-simple-form-with-validations-1dfff3d84fa6?source=collection_archive---------12-----------------------#2021-06-03">https://javascript.plainenglish.io/angular-reactive-forms-create-simple-form-with-validations-1dfff3d84fa6?source=collection_archive---------12-----------------------#2021-06-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0c115f059975af1f17bed13bb4c7ea7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MlQD4TC6Oyw2cXS3O7cnWg.png"/></div></div></figure><blockquote class="jv jw jx"><p id="9834" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">一大类前端应用程序是非常表单密集型的，尤其是在企业开发的情况下。许多这样的应用程序基本上都是复杂的表单，有多个标签和对话框，有不同的验证逻辑。</p></blockquote><p id="99ef" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated"><strong class="kb io"><em class="ka"/></strong>呈现了几种可供选择的创作形式。<strong class="kb io"> <em class="ka">反应式表单</em> </strong>(也称模型驱动表单)和<strong class="kb io"> <em class="ka">模板驱动表单</em> </strong>是常用的构建角度表单的方法。反应式表单比模板驱动的表单好得多，模板驱动的表单功能更强大，测试也更容易，因为所有的逻辑都组合到了组件类中。</p><p id="5da4" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">在反应式表单中，创建表单的大部分繁重工作发生在组件类而不是模板中。</p><h2 id="c6f9" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated"><strong class="ak">首先，我们需要设置模块</strong></h2><p id="6208" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">在这一步，我们需要从<strong class="kb io"><em class="ka">@ angular/forms</em></strong>中导入<strong class="kb io"><em class="ka">ReactiveFormsModule</em></strong>到应用模块中。为此，为了简单起见，我将在<strong class="kb io"> <em class="ka"> AppComponent </em> </strong>中编写。下面的代码片段展示了如何做。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><h2 id="8cb4" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated">接下来，我们将<strong class="ak">创建一个反应式表单</strong></h2><p id="f9dd" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">在创建一个反应式表单时，我们要处理两个重要的概念:表单组 和表单控件  <em class="ka">。</em>表单控件<em class="ka"> </em>是可以处理任何表单元素的数据值和验证状态的类。<em class="ka">表单组</em>包装一组表单控件。表单控件可以表示用户的名字、姓氏、电子邮件或密码等。</p><p id="30a7" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated"><strong class="kb io">有两种方式</strong>在角度反应表单中启动表单组。</p><ul class=""><li id="5ef8" class="me mf in kb b kc kd kg kh kx mg ky mh kz mi kw mj mk ml mm bi translated">对于第一种方式，我们通过传递一组子控件作为第一个参数来启动一个表单组。该子控件的<strong class="kb io"> <em class="ka">键</em> </strong>注册控件的名称，每个控件都应该是FormControl的对象类型。下面的代码片段展示了这个实现。</li></ul><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><ul class=""><li id="9198" class="me mf in kb b kc kd kg kh kx mg ky mh kz mi kw mj mk ml mm bi translated">当表单变得更复杂时，第二种方式<strong class="kb io">很有用。在这里，我们注入了<code class="fe mn mo mp mq b">FormBuilder </code>类并调用了<code class="fe mn mo mp mq b">group </code>方法。</strong></li></ul><p id="165c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">作为group方法的参数，我们通过<strong class="kb io"> <em class="ka">键</em> </strong>将控件的名称和值定义为一个空数组。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="e656" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">在特殊情况下，我们需要为表单控件提供默认值。例如，如果我们想要默认的电子邮件为user@gmail.com，我们可以这样做，如下所示。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><h2 id="c51b" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated">接下来，让我们看看<em class="mr"> setValue </em>和<em class="mr">patch value</em><em class="mr"/>方法的<strong class="ak">用途</strong></h2><p id="7ae3" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">在某些情况下，我们需要在表单控件中设置或修补默认值，以应对用户在编辑表单中编辑细节的情况。</p><p id="2649" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">为此，我们使用setValue和patchValue方法。两者的区别在于，当我们使用<code class="fe mn mo mp mq b">setValue()</code>时，我们必须在<code class="fe mn mo mp mq b">FormGroup</code>中设置所有的表单控件，而当我们使用<code class="fe mn mo mp mq b">patchValue()</code>时，则可以设置选中的表单控件。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/af8a4e51b175dc632855808f2e125f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*ZU3yt6DAO_h6TkNlFElcuQ.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">patchValue method</figcaption></figure><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/d19bf96f5f2ef127709556be9383914c.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*bIxm1nwGOTScWWtOIaHJTQ.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">setValue method</figcaption></figure><p id="43b0" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">到目前为止，我们已经完成了组件类的基本步骤。接下来，我们继续模板中的步骤。</p><p id="1a8c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">在模板中，您需要用一个<code class="fe mn mo mp mq b">&lt;form&gt;.</code>包装表示表单控件的输入字段，然后将<code class="fe mn mo mp mq b">FormGroup </code>指令添加到表单标签中，并在组件类中传递实例化的表单组。</p><p id="231e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">完成上述步骤后，将<code class="fe mn mo mp mq b">FormControlName</code>指令添加到输入字段，并将表单控件的名称作为组件类中使用的字符串进行传递。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/eed3becf05e92849654b89c0b97150de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*-eoIhJhcaO626R0ArTb1Ag.png"/></div></figure><p id="8519" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">现在，我们已经介绍了表单的所有基本实现，但还没有完成提交。</p><h2 id="29c5" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated">让我们继续表单提交</h2><p id="5f95" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">下一步，我们将添加类型为<code class="fe mn mo mp mq b">submit</code>的提交按钮。此外，我们需要在<code class="fe mn mo mp mq b">form </code>标签中添加<code class="fe mn mo mp mq b">NgSubmit </code>处理程序。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="0783" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">当我们考虑表单提交时，有两种可能的方法可以发现它:</p><ul class=""><li id="8b13" class="me mf in kb b kc kd kg kh kx mg ky mh kz mi kw mj mk ml mm bi translated"><strong class="kb io"> <em class="ka">提交</em> </strong>:这是一个HTML默认表单提交事件，当表单提交时会调用底层方法。</li><li id="c69f" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><strong class="kb io"><em class="ka">ngSubmit</em></strong><em class="ka">:</em>如果处理程序代码抛出并导致实际的HTTP post请求，这将阻止表单被提交。</li></ul><h2 id="774b" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated">验证表单控件</h2><p id="14fb" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">在验证之前处理输入字段值可能会产生严重的后果。你最终可能会存储无效的数据，如无效的电子邮件、年龄、日期等。在这种情况下，Angular提供了很少的内置验证器:</p><ul class=""><li id="b07f" class="me mf in kb b kc kd kg kh kx mg ky mh kz mi kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">required</strong></code> -验证表单控件必须有一个值，并根据需要标记它。</li><li id="ff34" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">email</strong></code> -验证表单控件是否具有有效的电子邮件地址。</li><li id="fb2e" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">minLength</strong></code> -验证表单控件中文本的长度是否大于或等于值。</li><li id="9b7c" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">maxLength</strong></code> <strong class="kb io"> </strong> -验证表单控件中文本的长度小于或等于值。</li><li id="bb5e" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">Max</strong></code> -验证表单控件中的数字小于或等于值。</li><li id="cff2" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">Min</strong></code> <strong class="kb io"> </strong> -验证表单控件中的数字是否大于最小值或等于值。</li><li id="c666" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">Pattern</strong></code> <strong class="kb io"> </strong> -验证表单控件中的文本是否匹配特定的正则表达式。</li><li id="9e34" class="me mf in kb b kc mz kg na kx nb ky nc kz nd kw mj mk ml mm bi translated"><code class="fe mn mo mp mq b"><strong class="kb io">email</strong></code> -验证用户提供的电子邮件地址的正确性和完整性。</li></ul><p id="0f23" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">现在让我们看看如何将验证器添加到表单控件中。</p><p id="a32d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">我们需要将<code class="fe mn mo mp mq b">@angular/forms</code>中的<code class="fe mn mo mp mq b">Validators</code>类导入组件类。例如，这里我们将根据需要创建电子邮件和密码字段，电子邮件控件应该有一个有效的电子邮件。我们可以这样做，将<code class="fe mn mo mp mq b">Validators.required </code>添加到两个控件的数组中，只将<code class="fe mn mo mp mq b">Validators.email </code>添加到电子邮件控件的数组中，如下所示。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="b5e4" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">如上例所示，一个控件可以有多个验证器。</p><p id="f5c1" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">验证的有趣部分是我们可以将<strong class="kb io"> <em class="ka">自定义验证器</em> </strong>组合到我们的控件中。</p><p id="77f3" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">假设您想要将登录的默认密码设置为“admin123 ”,并需要根据用户输入对其进行验证。如果输入密码不同于默认密码，则密码字段应该无效。为此，您必须编写自己的函数并传递一个对象类型<code class="fe mn mo mp mq b">AbstractControl.</code></p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="eb62" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">然后将<code class="fe mn mo mp mq b">ValidatorPassword </code>函数添加到所需验证器旁边的密码控件数组中，如下所示。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="37a7" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">接下来，我们看看如何将这个自定义验证器应用到模板中。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="a595" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">这里我使用了<strong class="kb io"> <em class="ka"> bootstrap </em> </strong>中的<strong class="kb io"> <em class="ka">无效反馈</em> </strong>类来显示输入字段<em class="ka">的验证错误消息。</em>或者，您可以使用<code class="fe mn mo mp mq b">hasError </code>方法，在那里您需要传递错误的名称。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><h2 id="c708" class="la lb in bd lc ld le dn lf lg lh dp li kx lj lk ll ky lm ln lo kz lp lq lr ls bi translated">接下来，我们前进到获取关于表单状态的知识</h2><p id="50eb" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj kx lv km kn ky lw kq kr kz lx ku kv kw ig bi translated">角度形式及其控制可以有不同的状态，例如:</p><p id="3a55" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">-<strong class="kb io"><em class="ka"/></strong>:用户没有更改表单控件的值。</p><p id="dce4" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">——<strong class="kb io"><em class="ka"/></strong>:与质朴相反。</p><p id="e73d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">- <strong class="kb io"> <em class="ka">触摸</em> </strong>:用户已经访问并退出表单控件。</p><p id="113c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">- <strong class="kb io"> <em class="ka">未动</em> </strong>:已动相反。</p><p id="05e3" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">这些状态帮助您增强表单的行为方式。下面的示例显示了如何对控件应用上述状态。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="4c7e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">此外，在不久的将来，我们将在一篇单独的文章中详细解释表单状态是如何工作的。</p><p id="4045" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated">我们到了本文的目的地。我希望你喜欢这篇文章，并充分利用它来提高你对<strong class="kb io">角反应式</strong>的了解。</p><p id="db18" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj kx kl km kn ky kp kq kr kz kt ku kv kw ig bi translated"><em class="ka">多内容于</em> <a class="ae ne" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="ka">中</em></strong></a></p></div></div>    
</body>
</html>