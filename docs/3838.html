<html>
<head>
<title>I Coded a Script to Download the “Download Restricted” Files from Google Drive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我编写了一个脚本，从Google Drive下载“下载受限”文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-i-coded-a-script-to-download-the-download-restricted-files-of-google-drive-718e74c55a68?source=collection_archive---------8-----------------------#2021-08-02">https://javascript.plainenglish.io/how-i-coded-a-script-to-download-the-download-restricted-files-of-google-drive-718e74c55a68?source=collection_archive---------8-----------------------#2021-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eabf31f67e816d53d23414b93a349219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XEtIwxwUw3_JC7fUCfZqYg.png"/></div></div></figure><p id="47d2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我在<a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/you-can-download-the-download-restricted-files-as-pdf-google-drive-92271e28f148">之前的帖子</a>中提到的，我写了一个JavaScript程序从Google Drive下载文件，即使他们限制了下载访问。阅读我的<a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/you-can-download-the-download-restricted-files-as-pdf-google-drive-92271e28f148">上一篇文章</a>来了解更多。你可以在那篇文章中找到代码，也可以在这篇文章的底部找到。</p><p id="e5c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在今天的帖子中，我将仔细阅读每一行代码，并帮助您理解这一行代码的意图。所以事不宜迟，我们开始吧！</p><p id="ba74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">先决条件</strong> : JavaScript</p><h2 id="084c" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">代码的主要逻辑是-</h2><blockquote class="ln"><p id="a662" class="lo lp in bd lq lr ls lt lu lv lw ks dk translated">Google Drive以图片的形式存储文件。因此，浏览文档→检查有效图像→获取这些图像并将其保存为PDF。很简单，对吧？</p></blockquote><p id="a9ed" class="pw-post-body-paragraph jv jw in jx b jy lx ka kb kc ly ke kf kg lz ki kj kk ma km kn ko mb kq kr ks ig bi translated">就这样，你完成了！如果你懂JavaScript，代码几乎是不言自明的。</p><p id="4235" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，作为开始，我使用了“jspdf”库，它似乎服务于这个目的。我用的是jspdf提供的CDN。我把它附在了文件的主体上。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4b49" class="ku kv in mh b gy ml mm l mn mo">let JsPDF = document.createElement("script");<br/>JsPDF.src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js';<br/>document.body.appendChild(JsPDF);</span></pre><p id="e926" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们添加的脚本元素(jspdf)完全加载到文档中时，我们启动JsPDF。我们用“new jsPDF()”初始化PDF，并将默认PDF的高度存储在一个变量中。它是操纵图像在PDF页面上的位置。我们将文档中的所有图像元素存储在一个名为elements的数组中。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a247" class="ku kv in mh b gy ml mm l mn mo">JsPDF.onload = function () {     <br/>let pdf = new jsPDF();      <br/>var height = pdf.internal.pageSize.getHeight(); <br/>let elements = document.getElementsByTagName("img");</span></pre><p id="2328" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们循环遍历图像数组。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="8f27" class="ku kv in mh b gy ml mm l mn mo">for (let ith_image in elements) {  <br/>    let img = elements[ith_image];</span></pre><p id="350d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是整个代码中有趣的部分。图像以<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/API/Blob" rel="noopener ugc nofollow" target="_blank">斑点对象</a>的形式存储。因此，我们检查在图像的src中是否有“斑点”,如果没有就跳过迭代。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9d19" class="ku kv in mh b gy ml mm l mn mo">if (!/^blob:/.test(img.src)) continue;</span></pre><p id="99a3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们创建一个与图像高度和宽度相同的画布元素，并在画布上绘制图像。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="67ea" class="ku kv in mh b gy ml mm l mn mo">let canvas = document.createElement('canvas');   <br/>let context = canvas.getContext("2d");          <br/>canvas.width = img.width;        <br/>canvas.height = img.height;        <br/>context.drawImage(img, 0, 0, img.width, img.height);</span></pre><p id="7165" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于jspdf，图像必须是数据URL<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">的形式。因此，我们将画布图像转换为数据URL格式，然后将其添加到PDF中。最后，我们向现有的PDF添加一个页面。</a></p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="df17" class="ku kv in mh b gy ml mm l mn mo">   let imgData = canvas.toDataURL("image/jpeg", 1.0);<br/>   pdf.addImage(imgData, 'JPEG', 0, height/3.5);         <br/>   pdf.addPage();<br/>} // closing brace of "for" loop</span></pre><p id="53e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当这个循环结束时，我们将把所有的图像保存为PDF格式。但是我们将在PDF的末尾有一个额外的空白页，因为我们在每次迭代中增加了一个额外的页面。为了删除多余的空白页，我们从PDF中取出总页数并删除最后一页。(这与删除vector或list数据结构中的最后一个元素是一样的。)</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="d29e" class="ku kv in mh b gy ml mm l mn mo">var pageCount = pdf.internal.getNumberOfPages();    pdf.deletePage(pageCount);</span></pre><p id="821c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后一步，我们将PDF文件保存到我们的电脑上。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f157" class="ku kv in mh b gy ml mm l mn mo">   pdf.save("File_Name.pdf");<br/>}; // closing brace of the function  </span></pre><p id="daad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">仅此而已。您可以将代码粘贴到Developer's tools的console选项卡中，然后按enter键。在按回车键之前，请确保滚动到页面的末尾。这是为了确保文件的所有图像都已加载。</p><p id="8920" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是完整的代码:</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="0f0c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你觉得代码或帖子有意义，考虑在评论区分享你的想法和建议。</p><p id="6292" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你太高兴了，你可以给我买杯咖啡。😉</p><figure class="mc md me mf gt jo gh gi paragraph-image"><a href="https://www.buymeacoffee.com/mohithgupta"><div class="gh gi mr"><img src="../Images/3e2ed91ce5cc2250e760dc572b29c177.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*xujGHaA3g-j4GAZNm7Hllg.png"/></div></a></figure><p id="cbc0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以看看我其他的一些帖子:</p><p id="462a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://python.plainenglish.io/play-youtube-videos-in-vlc-with-just-1-click-2baca84c03f3" rel="noopener ugc nofollow" target="_blank">只需点击</a> <br/> <a class="ae kt" href="https://python.plainenglish.io/convert-your-py-to-exe-with-just-2-commands-4c6cefe9af4c" rel="noopener ugc nofollow" target="_blank">“转换您的”,即可在VLC播放YouTube视频。py '到a '。exe '文件，只需两个命令</a> <br/> <a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/all-you-need-to-know-about-the-fetch-api-6929930572a8">你需要知道的关于JavaScript </a>中的“获取API”</p><p id="9d0f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果还有其他疑问，你可以在mohithguptak@gmail.com上联系我，或者在推特上找到我。</p><p id="f5e8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下一集见。再见！</p><p id="9f14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ms">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ms">plain English . io</em></strong></a></p></div></div>    
</body>
</html>