<html>
<head>
<title>Secure Authentication via JSON Web Tokens (JWT)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过JSON Web令牌进行安全认证(JWT)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/most-secured-authentication-via-json-web-token-a45ae52a76df?source=collection_archive---------2-----------------------#2021-04-08">https://javascript.plainenglish.io/most-secured-authentication-via-json-web-token-a45ae52a76df?source=collection_archive---------2-----------------------#2021-04-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="811c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用具有三层保护的JSON web令牌创建身份验证过程</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d7a4a3a01b020e03450d3e984e9bd622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m0OW9jo-YUlmeRyI"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Winkler</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4dc7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">JSON Web Token是两层受保护的令牌，使用三个连续的进程联合在一起生成，这三个进程是JSON Web Token的组成部分，如下所示</p><ul class=""><li id="750c" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io">报头</strong>——报头部分定义了用于创建令牌的算法</li><li id="2a4c" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv io">签名</strong> -通过签名解码令牌并描述其真实性的部分。</li><li id="60d4" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv io"> Payload </strong> —顾名思义，以64base编码的安全形式封装任何需要通过token发送的数据。</li></ul><p id="f7d7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有关如何创建令牌的更多参考和深入说明，请参考下面的链接。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="b155" class="mi mj in me b gy mk ml l mm mn"><a class="ae ks" href="https://jwt.io/introduction" rel="noopener ugc nofollow" target="_blank">https://jwt.io/introduction</a></span></pre></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="6c3b" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">概观</h1><p id="5782" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">这个博客背后的想法是提供一个如何在后台与JWT工作的概述，并创建一个认证用户的过程。</p><ul class=""><li id="baae" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">我将为我们应用程序的用户创建<strong class="kv io">注册</strong>、<strong class="kv io">登录</strong>和<strong class="kv io">解码</strong>端点。</li><li id="98b9" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">用户创建或登录成功后，向用户提供使用用户电子邮件创建的JWT令牌。</li><li id="14ef" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">每个生成的令牌在其相应的有效负载中都有过期时间和用户数据。</li><li id="eb18" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">一旦用户登录，对我们服务器的所有其他请求都应该在头中使用这个令牌。</li><li id="f8ac" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">一旦在另一个API的头中收到令牌，我们将对其进行解码，以描述其真实性。</li><li id="9416" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">最后，一旦符合的令牌是有效的令牌，用户将被允许向我们的服务器发出请求。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/bdd40830fe306a3a03508c9bbf83cd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GwKPwdBKQsDYZcE1HcwIFw.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Overview Flow Chart</figcaption></figure></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="2e76" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">编写代码</h1><p id="54b4" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">我将从使用express设置一个基本存储库开始。继续安装我们将使用的所有必需的软件包。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="7b7e" class="mi mj in me b gy mk ml l mm mn">yarn add express, body-parser, cors, nodemon, axiox, jsonwebtoken</span></pre><p id="af42" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">添加包后，在<strong class="kv io"> authRoutes.js </strong>文件内的routes文件夹中创建一个登录和注册的基本路径。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Basic routes of logged in and signup</figcaption></figure><p id="ecc8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通过重定向到端点/登录和/注册本地主机端口3000来测试路由。</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="acbd" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">正在创建令牌</h1><p id="7623" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">在生成安全的JWT令牌时，其基本思想是使用密钥和用户电子邮件对令牌进行签名。</p><p id="6a93" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–我们将使用的密钥是我们手动添加的密钥，电子邮件将是API请求中提供的用户电子邮件id。</p><p id="1bfd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–我们将使用JWT的<strong class="kv io"> sign </strong>方法来签署和生成我们的令牌。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="3c2f" class="mi mj in me b gy mk ml l mm mn">jwt.sign({ email: email},process.env.JWTSecretKey,{expiresIn:'14d'})</span></pre><p id="bb46" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–我们使用电子邮件来签署令牌，因为每个用户都有一个唯一的电子邮件id来登录我们的服务器。没有两个用户会有相同的电子邮件id。</p><p id="5705" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–我们的令牌是使用用户<strong class="kv io">电子邮件id </strong>和<strong class="kv io">密钥生成的。这里的键是JWTSecretKey——请注意，这个键应该添加到env文件中。</strong></p><p id="030f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–使用dotenv npm包访问环境文件常量</p><p id="d5e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–添加dotenv npm包并运行根server.js中的<code class="fe nu nv nw me b"><strong class="kv io">dotenv.config()</strong></code></p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="19fc" class="mi mj in me b gy mk ml l mm mn">// Terminal <br/>  <strong class="me io">yarn add dotenv</strong></span><span id="028f" class="mi mj in me b gy nx ml l mm mn">// server.js<br/><strong class="me io"> const dotenv = require('dotenv'); <br/> dotenv.config();</strong></span></pre><p id="2726" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–使用<strong class="kv io"> process.env </strong>方法，您可以从<strong class="kv io">中获取所有常量。env </strong>文件。</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="32db" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">发送签名令牌</h1><p id="f7bc" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">我们将向用户发送令牌以响应<strong class="kv io">/登录</strong>端点。我们还可以检查用户发送的电子邮件的常规快递，并在电子邮件格式错误时返回一个错误。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">login.js</figcaption></figure><p id="4ada" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在API的响应对象中，我们将发送使用JWT.sign()方法生成的令牌。请将这个令牌存储在前端或后端的数据库中，因为我们确实需要这个令牌向我们的服务器发出API请求。</p></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="ab3b" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">解码令牌</h1><p id="2810" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">–为了解码令牌的真实性，我们再次需要用户电子邮件和令牌。</p><p id="3688" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–JWT本身提供了一个名为verify的方法，该方法接受发送的令牌和来自<code class="fe nu nv nw me b">env</code>文件的JWTSecretKey作为参数。</p><p id="4088" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–为了向您的令牌添加额外的安全层，我们已经使用相应用户的电子邮件注销了令牌，因此我们现在将检查该电子邮件是否存在于令牌中，然后将该电子邮件与API请求中发送的用户电子邮件进行交叉检查。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="01a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–在这种方法中，我们遵循以下步骤—</p><ul class=""><li id="c69b" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">我们首先分别检查请求正文和标题中的电子邮件和标题。</li><li id="f693" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">然后使用<strong class="kv io"> jwt.verify() </strong>方法检查令牌的有效性</li><li id="b5e6" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">另一层保护是检查解码的令牌有效负载是否包含用户电子邮件，并与请求正文中发送的电子邮件交叉检查该值。</li></ul><p id="3d0c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–这样，我们可以通过令牌检查用户的真实性，一旦用户是有效令牌，我们将允许用户访问我们的服务器和应用程序。</p><p id="1e93" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">–以下是<a class="ae ks" href="https://www.postman.com /" rel="noopener ugc nofollow" target="_blank"> Postman </a>桌面应用程序在<strong class="kv io"> /decodeToken </strong>端点所有阶段的截图。</p><div class="kd ke kf kg gt ab cb"><figure class="ny kh nz oa ob oc od paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/e1ba520d55b6172d0e879bfbb2340b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1028/format:webp/1*QFOsnodm5CtVP2qPosp3zQ.png"/></div></figure><figure class="ny kh oe oa ob oc od paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><img src="../Images/963d90e3293c7b9045af8abf7411925f.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*dwqwLnWT7UX5G7N5S0Tthw.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk of di og oh">The left image is when no email is added and the right image is when no headers are given in request</figcaption></figure></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/805097b80cd08e496b6660232f756f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b0xK1czd1nt2qZsLufyhoA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">Postman</a> screenshot from the desktop.</figcaption></figure></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><h1 id="7a99" class="mv mj in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated">结论</h1><p id="8bc5" class="pw-post-body-paragraph kt ku in kv b kw nm jo ky kz nn jr lb lc no le lf lg np li lj lk nq lm ln lo ig bi translated">这是最安全的方式来检查用户的真实性，让他/她访问我们的服务器。JWT本身是一个非常安全的方式使用2层安全，我们增加了一个第三层使用JWT的有效载荷中的数据，以提供一个更安全的方式到我们的服务器。最后，您可以直接将这些JWT令牌保存在浏览器的cookie中，或者从Cookie中的API发送令牌。这个过程有一个优点，我们只需在浏览器中检查cookie，并在前端应用程序中检查其有效性，以便允许用户访问受保护的路由。如果你想知道更多关于如何在前端使用令牌的细节，我在下面的文章中添加了链接。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="fb36" class="mi mj in me b gy mk ml l mm mn"><a class="ae ks" href="https://medium.com/p/c60db33f1921?source=post_stats_page-------------------------------------" rel="noopener">https://medium.com/p/c60db33f1921?source=post_stats_page-------------------------------------</a></span></pre><p id="b5a7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">直到下一次。祝大家愉快。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="aadf" class="mi mj in me b gy mk ml l mm mn">Code =&gt; <a class="ae ks" href="https://github.com/shreyvijayvargiya/iHateReadingLogs/tree/main/TechLogsBackend/GettingStartedWithJWT" rel="noopener ugc nofollow" target="_blank">https://github.com/shreyvijayvargiya/iHateReadingLogs/tree/main/TechLogsBackend/GettingStartedWithJWT</a></span></pre><p id="ad50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="oj">更多内容请看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="oj">plain English . io</em></strong></a></p></div></div>    
</body>
</html>