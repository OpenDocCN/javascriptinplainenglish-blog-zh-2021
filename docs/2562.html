<html>
<head>
<title>Physical Computing with JavaScript (3/8) — Reading State of Switch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript物理计算(3/8) —读取开关状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/physical-computing-with-javascript-3-8-reading-state-of-switch-106137a2f9d6?source=collection_archive---------9-----------------------#2021-05-26">https://javascript.plainenglish.io/physical-computing-with-javascript-3-8-reading-state-of-switch-106137a2f9d6?source=collection_archive---------9-----------------------#2021-05-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4c135d499066c60fee5562cf52a63ba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ctBs8BuFZ7_UezUMFPyPA.png"/></div></div></figure><p id="30bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我们将使用数字输入来读取开关是否被按下的状态。</p><blockquote class="kt ku kv"><p id="0fdb" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><a class="ae la" href="https://niklauslee.medium.com/physical-computing-with-javascript-table-of-contents-69c38fd74e61" rel="noopener">目录</a></p></blockquote><h1 id="432a" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">成分</h1><ul class=""><li id="cc08" class="lz ma in jx b jy mb kc mc kg md kk me ko mf ks mg mh mi mj bi translated">树莓派Pico — 1件。</li><li id="1112" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">试验板— 1个。</li><li id="5094" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">触觉开关— 1个。</li><li id="ba7d" class="lz ma in jx b jy mk kc ml kg mm kk mn ko mo ks mg mh mi mj bi translated">跳线(M-M型)</li></ul><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/db66ed9c8b09824a200b2ad61d5a480e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsaeyTNNQbK1p0EHYL7Fiw.jpeg"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Components for reading states of switch</figcaption></figure><p id="4582" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">触觉开关是一种非常简单的开关，当按下按钮时，它连接两个引脚。你可以很容易地在我们周围的许多电子产品中找到这些开关。一个触觉开关通常有4个引脚，左边的上下引脚互相连接，右边的上下引脚互相连接。所以，当连接到电路时，你必须使用一个左(任何上或下)和一个右(任何上或下)。</p><h1 id="d35e" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">数字输入</h1><p id="3047" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">所有支持GPIO的引脚都可以用于数字输出，但也可以用于数字输入。为了验证这一点，让我们做一个简单的实验。首先，让我们用跳线将<strong class="jx io"> GPIO14 </strong>直接连接到<strong class="jx io"> 3V3 </strong>。然后，将<strong class="jx io"> GPIO14 </strong>切换到输入模式并读取数值。</p><pre class="mq mr ms mt gt nb nc nd ne aw nf bi"><span id="bdff" class="ng lc in nc b gy nh ni l nj nk">&gt; pinMode(14, INPUT);<br/>&gt; digitalRead(14);</span></pre><p id="dfe2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将在终端中打印<code class="fe nl nm nn nc b">1</code>。<code class="fe nl nm nn nc b">1</code>意为<code class="fe nl nm nn nc b">HIGH</code>。相反，将<strong class="jx io"> GPIO14 </strong>连接到<strong class="jx io"> GND </strong>上，并读取相同的读数。然后<code class="fe nl nm nn nc b">0</code>会被打印出来。<code class="fe nl nm nn nc b">0</code>意为<code class="fe nl nm nn nc b">LOW</code>。</p><h1 id="cb6a" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">下拉模式</h1><p id="dd02" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">现在，在<strong class="jx io"> GPIO14 </strong>和<strong class="jx io"> 3V3 </strong>之间连接一个触觉开关，如下图所示。当按下开关时，由于<strong class="jx io"> GPIO14 </strong>和<strong class="jx io"> 3V3 </strong>连接，将读取<code class="fe nl nm nn nc b">HIGH</code>值。然后，当开关没有按下时，它实际上是在空中，因为它没有连接到任何地方。在这种情况下，什么价值会进来？</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/2e825617b0c4745b1f33d250aa37df1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANPogv6HK85m7CTmqvEQAg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Using a switch in pull-down mode</figcaption></figure><p id="a84e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">重要的是要记住，如果没有按下开关，GPIO处于“未知”状态，既不是<code class="fe nl nm nn nc b">HIGH</code>也不是<code class="fe nl nm nn nc b">LOW</code>。事实上，有时<code class="fe nl nm nn nc b">HIGH</code>值可能因为某些原因被读取，例如噪声。因此，不要让要使用的GPIO输入引脚处于这种状态。所以，当开关未按下时，必须强制到<code class="fe nl nm nn nc b">LOW</code>。那就是下拉模式(从下拉到<code class="fe nl nm nn nc b">LOW</code>的意义上很好理解)。所以，在这种情况下，你应该将其设置为<code class="fe nl nm nn nc b">INPUT_PULLDOWN</code>，而不是<code class="fe nl nm nn nc b">INPUT</code>模式。</p><pre class="mq mr ms mt gt nb nc nd ne aw nf bi"><span id="d607" class="ng lc in nc b gy nh ni l nj nk">&gt; pinMode(14, INPUT_PULLDOWN);</span></pre><p id="80f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这样做，不按下开关时总是<code class="fe nl nm nn nc b">LOW</code>，按下开关时总是<code class="fe nl nm nn nc b">HIGH</code>。</p><h1 id="f3df" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">上拉模式</h1><p id="25d7" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">如果是的话，是不是开关未按下时总是处于<code class="fe nl nm nn nc b">HIGH</code>状态，开关按下时总是处于<code class="fe nl nm nn nc b">LOW</code>状态？是的，这是可能的！如下图所示，连接<strong class="jx io"> GPIO14 </strong>和<strong class="jx io"> GND </strong>之间的开关。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/8151a0514b4d338f9e13a0c3d15c691e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yXXZpq1c2Yua9yf3GUBFBQ.jpeg"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Using switch in pull-up mode</figcaption></figure><p id="a6b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们把<strong class="jx io"> GPIO14 </strong>设置为上拉模式(从上拉至高的意义上来说方便理解)，用<code class="fe nl nm nn nc b">digitalRead()</code>检查开关按下和未按下时的状态。通常情况下，将读取<code class="fe nl nm nn nc b">HIGH</code>值，但仅当按下开关时，才会读取<code class="fe nl nm nn nc b">LOW</code>值。</p><pre class="mq mr ms mt gt nb nc nd ne aw nf bi"><span id="5b60" class="ng lc in nc b gy nh ni l nj nk">&gt; pinMode(14, INPUT_PULLUP);</span></pre><blockquote class="kt ku kv"><p id="459a" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">最初，上拉和下拉都使用外部电阻来形成电路，但现在微控制器在内部提供这些功能，因此它们只能在没有额外电阻的程序中使用。</p></blockquote><h1 id="32cc" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">倾听一个事件</h1><p id="958c" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">所以现在让我们在按下开关时在终端中打印<code class="fe nl nm nn nc b">clicked!</code>消息。首先想到的是使用如下所示的无限循环。将上面的代码输入IDE并上传到Pico。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/f962ab4cc054678166f41b28adb9e645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYS8mau6poPgFhCS-Vs-Rw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Reading switch state in a finite loop</figcaption></figure><p id="de04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当按下开关时，信息<code class="fe nl nm nn nc b">clicked!</code>将打印在终端上。然而，问题是大量的消息将被打印出来。因为循环运行速度太快，无论我按下开关多短，都会打印出无数条消息。第二个问题是终端卡顿。Pico处理无限循环，所以它根本不能响应来自终端的输入。如果要停止执行，可以在终端中按<strong class="jx io"> Ctrl+C </strong>来停止。</p><p id="fc3a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">按下开关时，信息不能只打印一次吗？只需将开关以前的状态存储在一个特定的变量中。也就是说，如果之前的状态是<code class="fe nl nm nn nc b">HIGH</code>，但是当前的状态是<code class="fe nl nm nn nc b">LOW</code>，那么就可以确定开关被按下的确切时刻。但是由于无限循环，终端还是卡死了。为了轻松解决这个问题，Kaluma提供了<code class="fe nl nm nn nc b">setWatch()</code>函数。如下图所示，使用这种方法可以非常简洁地解决问题，而且终端也可以工作。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/af6c20caebea997ba690e1e6293cdd75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b5iDfuYnHv3iw3NU1fc6dA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Listening switch events using setWatch()</figcaption></figure><p id="3d6e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe nl nm nn nc b">setWatch()</code>函数在观察一个特定的GPIO管脚时，当一个特定的事件发生时，调用一个特定的回调函数。第一个参数是要调用的回调函数，第二个参数是要观察的GPIO号。第三个参数表示要响应的事件类型，因为我们想要对从<code class="fe nl nm nn nc b">HIGH</code>到<code class="fe nl nm nn nc b">LOW</code>的变化做出响应，所以我们使用了<code class="fe nl nm nn nc b">FALLING</code>事件。相反，如果你使用下拉模式，你可以使用<code class="fe nl nm nn nc b">RISING</code>事件，如果你想对两者都做出反应，你可以使用<code class="fe nl nm nn nc b">CHANGE</code>事件。最后四分之一是给出去抖时间(10ms)。这仅在此涉及，更多信息请参考<a class="ae la" href="https://kalumajs.org/docs/" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p><p id="95e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，回想一下之前的教程，然后制作可以在每次按下开关时打开和关闭LED的电路和代码，如下图所示。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/36cc5298bd2911c4ae9871e99a319efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ga2Nt7TzEBZGg1lx5r7ZvQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Circuit for toggling LED with a switch</figcaption></figure><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/e608e9bcdd398da51a92f8ee0b2aaf95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uMRi878it8WDp4cOA9Om8w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Toggling LED with a switch</figcaption></figure><p id="a9bb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我们学习了数字输入、上拉和下拉模式。现在让我们进入下一课，学习模拟输入和输出。</p><div class="nr ns gp gr nt nu"><a href="https://niklauslee.medium.com/physical-computing-with-javascript-4-8-led-dimming-403696103d2f" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">使用JavaScript的物理计算— (4/8) LED调光</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">在本教程中，我将尝试通过使用模拟输入和输出来调整LED的亮度，而不是数字…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">niklauslee.medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jt nu"/></div></div></a></div><p id="d13c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">更多内容请看</em><a class="ae la" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="kw">plain English . io</em></a></p></div></div>    
</body>
</html>