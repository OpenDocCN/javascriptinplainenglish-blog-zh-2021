<html>
<head>
<title>Build an Auto Logout Session Timeout with React hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React挂钩构建自动注销会话超时</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-an-auto-logout-session-timeout-with-react-using-hooks-e7804ef973ec?source=collection_archive---------0-----------------------#2021-01-05">https://javascript.plainenglish.io/building-an-auto-logout-session-timeout-with-react-using-hooks-e7804ef973ec?source=collection_archive---------0-----------------------#2021-01-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8d860742f8e97b36c1721b1a01d3adba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vrBaDmT4OMCiSvwjM1iBzw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture: <a class="ae jz" href="https://www.pexels.com/photo/close-up-photo-of-street-clock-near-tall-building-937512/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/close-up-photo-of-street-clock-near-tall-building-937512/</a></figcaption></figure><p id="434c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有时，用户登录到您的应用程序，却忘记注销。让我们假设在你的应用程序中有很多关于用户的敏感信息，比如个人信息或者交易数据。这使得用户数据易受攻击。</p><p id="2fd7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">作为一名开发人员，您需要开发一个解决方案来检测应用程序上的用户非活动状态。该解决方案旨在帮助用户在不使用应用程序时注销。</p><p id="2ade" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本教程中，我们将使用react及其钩子来构建前端。在Vue或Angular上工作时，遵循这些步骤会让您有更好的理解。</p><p id="618f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">我们开始吧！</strong></p><p id="8c3c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们继续之前，请注意，本教程假设您对react和react钩子有基本的了解。如果没有，请找到可用的资源，引导你通过并回到这里。</p><p id="724c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，让我们从在组件文件夹中创建一个javascript文件开始，例如<em class="ky"> SessionTimeout.js </em></p><p id="060d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了加快速度，让我们导入本教程需要的所有东西。你需要安装<a class="ae jz" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank">力矩</a>。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="d9f2" class="li lj in le b gy lk ll l lm ln">npm install moment --save</span></pre><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="7e4e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">useState:</code>接受状态项的初始值，并返回一个包含状态变量的数组，以及您调用来改变状态的函数。</p><p id="a4fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">useCallback:</code>当你有一个子组件频繁重渲染时，这个钩子很有用。</p><p id="5820" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">useEffect:</code>该函数在组件第一次渲染时运行，并在随后的每次重新渲染/更新时运行。</p><p id="a7d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">useRef:</code>这个钩子允许我们强制访问一个DOM元素。</p><p id="3dad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">Fragment:</code>这让您可以在不增加额外节点的情况下对孩子列表进行分组。</p><p id="9154" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们列出所有需要的状态。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="32d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">events:</code>这个状态有助于定义我们的事件监听器。您可以添加任意数量的侦听器。</p><p id="2fbe" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">second:</code>该状态有助于定义用户注销前剩余的秒数。</p><p id="d78a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们编写一个在组件挂载时初始化定时器的函数。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="316f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">resetTimer:</code>首先，我们检查用户是否经过身份验证。如果是，我们在sessionStorage中设置时间戳，如果没有通过身份验证，我们从存储中删除时间戳。<code class="fe lq lr ls le b">usecallback </code>钩子用于查找用户认证的变化。</p><p id="5909" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的<code class="fe lq lr ls le b">useEffect </code>钩子中，我们然后在我们的<strong class="kc io">窗口中传递函数</strong></p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="734f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们编写一个setTimeout函数来检查我们存储的<strong class="kc io">时间戳。</strong></p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="a2cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们用这个函数来初始化定时器。<strong class="kc io"> setTimeout </strong>方法设置一个定时器，一旦定时器在1分钟时到期，该定时器就执行一个功能。我们从sessionStorage获取存储的时间戳，然后将它发送给我们的警告函数。我们一会儿会看看<strong class="kc io">警告激活</strong>函数。</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="d6f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们运行时间检查器功能</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="7e1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如你所看到的，理想的计时器正在逐渐实现。以下是更新内容:</p><ol class=""><li id="2081" class="ma mb in kc b kd ke kh ki kl mc kp md kt me kx mf mg mh mi bi translated">我们在<strong class="kc io">使用效果</strong>和<strong class="kc io">重置计时器上运行<strong class="kc io">时间检查器</strong>。</strong>这是因为我们希望timeChecker在组件挂载时和窗口上有监听事件时进行检查。</li><li id="62c8" class="ma mb in kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi bi translated">我们还在resetTimer函数中清除setTimeout。这将帮助我们停止任何连续的循环。</li></ol></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="3dd3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们已经能够编写一个时间检查器，让我们编写一个警告用户的函数。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="d7d6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好吧，别害怕。我知道这是一堆代码。我会解释一切。</p><p id="faff" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe lq lr ls le b">warningInactive:</code>在使用这个函数之前，让我们先清除setTimeout。现在，我们可以使用<strong class="kc io"> setInterval </strong>方法。setInterval方法被设置为每1秒重复运行一次。而在这里，多亏了<code class="fe lq lr ls le b">momentjs</code>，我们可以很容易地用它来检查时差。</p><p id="ecd4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您还不了解<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout" rel="noopener ugc nofollow" target="_blank">设置超时</a>和<a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval" rel="noopener ugc nofollow" target="_blank">设置间隔</a>之间的区别，请点击这些链接。</p><p id="31c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们检查<strong class="kc io">当前时间</strong>和<strong class="kc io">存储时间之间的时间差。minPast </strong>为过去一分钟<strong class="kc io">和leftSecond </strong>为倒计时秒。</p><p id="b75d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事情到此为止:</p><ol class=""><li id="29dc" class="ma mb in kc b kd ke kh ki kl mc kp md kt me kx mf mg mh mi bi translated">最大理想时间为2分钟，<strong class="kc io"> popTime </strong>(通知时间)设置为用户理想时间的1分钟。</li><li id="b37c" class="ma mb in kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi bi translated">一旦<strong class="kc io"> minPast </strong>等于<strong class="kc io"> popTime，我们设置秒开始计数。</strong></li><li id="7b81" class="ma mb in kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi bi translated">您可以更改<strong class="kc io"> maxTime </strong>来增加用户的理想定时器。</li><li id="a1ab" class="ma mb in kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi bi translated">最后，一旦<strong class="kc io"> minPast </strong>与<strong class="kc io"> maxTime </strong>相等，即一旦达到用户理想的2分钟，我们就清除setInterval和sessionStorage。</li></ol><p id="8a11" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，我们写了很多代码。不管怎样，我们快完成了。</p></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="c9c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，让我们回到我们的resetTimer函数，并做一些清理。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="lo lp l"/></div></figure><p id="4c7f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是我们做的几件事:</p><ol class=""><li id="df4b" class="ma mb in kc b kd ke kh ki kl mc kp md kt me kx mf mg mh mi bi translated">我们在重置计时器上添加了一个<strong class="kc io"> clearInterval </strong>方法。这对于避免不必要的循环是必要的。并且当用户未被认证时也清除所有运行条件。</li><li id="917c" class="ma mb in kc b kd mj kh mk kl ml kp mm kt mn kx mf mg mh mi bi translated">我们还添加了组件卸载后的清理。</li></ol></div><div class="ab cl lt lu hr lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ig ih ii ij ik"><p id="a3ab" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">终于！一切就这些了。现在，我们可以通过将<strong class="kc io"> SessionTimeout.js </strong>添加到<strong class="kc io"> app.js </strong>中或者您认为需要它的地方来测试我们的代码。</p><p id="124e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了增加趣味，您可以将<code class="fe lq lr ls le b">fragment</code>更改为通知用户警告的模态。你也可以把它应用到其他框架中。</p><p id="8079" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本教程的完整代码可以在https://github.com/sadewole/Idle-session-timer找到。多亏了弗拉维奥·科普斯，我使用了他对钩子的定义。</p><p id="0b2e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请喜欢并留下任何贡献的评论。谢谢你。</p></div></div>    
</body>
</html>