# 为什么您更喜欢 REST 而不是 RPC

> 原文：<https://javascript.plainenglish.io/why-is-rest-more-popular-than-rpc-2edb5bb0e368?source=collection_archive---------9----------------------->

## 灵活性是王道

![](img/939665dab3c4bb0c74f6a15ec8fdf595.png)

Photo by [Isaac Smith](https://unsplash.com/@isaacmsmith?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

微服务架构的主要目标是部署独立的服务，以便产品可以在不同的时间创建多个快速迭代。因此，每个团队可以单独部署服务，而不需要与其他团队协作。

使用微服务架构，服务和服务通过网络调用进行通信，并且两个服务通常在一些称为 API 的契约上达成一致。

问一个开发人员为什么他们需要定义一个 API，他们会告诉你 API 帮助应用程序与另一个服务集成。设计这种 API 的一个优先考虑因素是开发和集成的容易性以及客户端和服务器端的执行效率。

RPC 似乎很适合这个问题。RPC 试图像您的编程语言中的函数调用或方法一样进行远程网络调用。当发送网络调用时，每个应用程序都需要包含代码生成和自动化工具。

通过使用他们最喜欢的编程语言，API 与 RPC 的集成可以是无缝的——通过与 RPC 等价集成，你不需要学习新的设计哲学。由于 RPC 使用二进制格式在网络之间发送请求，因此与 RPC 集成比 RESTful API 更高效、更紧凑。

如果 RPC 是创建 API 的好主意，为什么大多数 API 集成使用 REST？

# RPC 的问题

尽管用 RPC 构建 API 似乎更容易，但维护是主要的威胁。

RPC 试图像您的编程语言中的函数调用或方法一样进行远程网络调用。然而，这抽象了位置透明性，以便于在应用程序代码中封装网络调用。而且，网络调用和函数调用完全不同。

# 可预测性

局部函数调用是可预测的。它要么成功，要么失败。但是，由于网络连接丢失，网络呼叫可能会停滞。远程机器速度慢或不可用，网络调用可能收不到任何东西。这些问题超出了我们的控制范围，唯一的恢复选项是重试失败的请求。

一个局部函数可能返回一个成功，一个异常，或者它可能永远不会返回。但是，网络调用可以返回上述所有内容，并且由于超时，另一种可能的结果可能会返回而没有任何结果。超时的可能性很大。可能是您发送的请求通过了，但是来自远程服务的响应遇到了网络问题。也可能是请求根本没有通过远程服务。

当运行一个本地函数时，通常需要相同的时间来执行。网络请求比函数调用慢得多，而且它的延迟是一个很大的变量。网络好的时候，几毫秒就能回来。但是，当网络拥塞或远程服务过载时，可能需要几秒钟才能得到响应。

# 非参照透明的

如果一加二等于三。然后，您可以放心地将三替换为一加二，而不改变任何包含三的程序的行为。我们可以说相应的值是指涉透明的。

局部函数调用(没有任何副作用)是引用透明的。因此，如果您多次运行该函数，您将始终得到相同的结果。但是，如果协议中没有幂等性，重试网络调用可能会导致操作运行多次。

# 易碎

集成 RPC 看起来很简单，因为网络调用类似于调用函数调用。然而，当集成使用不同编程语言的服务时，这可能会很复杂。

RPC 框架必须将数据类型从一种语言翻译成另一种语言。由于不是所有的语言都有相同的数据类型，这最终会变得很难看。例如，JavaScript 对大于 2⁵的数字有问题。因此，我们可能需要强制服务器和客户端使用相同的编程语言。

当您第一次开始编写软件来自动化一个特定的问题域时，您的大部分开发将集中在自动化基本特性和工作流上。随着软件的成熟，系统的许多价值来自于对现有系统的集成和扩充，而不是构建一个新的系统。

许多公司都计划将 API 公开给其他系统，以实现更好的客户交互。还有一个计划是，我们希望向企业公开我们的 API，以了解其客户、供应商或跨多个系统的合作伙伴的整体情况。

这些系统创建 API，以创新的方式将数据用于移动应用集成或第三方合作伙伴集成。因此，系统需要是可扩展的，否则集成可能会花费大量的时间和资源。

# 休息有什么不同

# 灵活的

万维网的一个显著特征是网络上的每个地址都公开完全相同的 API——HTTP。这意味着，在万维网中导航，你只需要一个 API——HTTP。

通常，RESTful API 会使用 JSON 通过网络发送消息。REST 将有效负载请求与实现该请求的编码和解码的服务解耦。因此，每个服务都可以轻松地与他们想要的任何编程语言集成，只要他们实现了有效负载上的编码和解码。

HTTP 并没有强制要求特定的数据格式，但是 JSON 是目前最流行的。JSON 最初是为了很好地匹配 JavaScript 表示数据的方式而设计的，但是所有编程语言都支持它。

JSON 是一种抽象格式，它不受特定技术的限制——服务在集成期间不必维护各种编程语言。

REST 有助于创建将不同系统中的多个实体链接在一起的规则。例如，订单服务、价格服务和支付服务都需要链接在一起才能购买商品或进行退款。为了将这个实体链接在一起，它们中的每一个都需要有一个清晰的标识，可以在应用程序之外被引用。REST 有助于创建统一的 URL 概念，这是一个在任何地方都有效的资源标识符。与基于 RPC 的 API 相比，实体的身份以本地应用程序的形式表示。它加重了集成过程中其他服务的负担，因为它们需要理解本地应用程序的细微差别。

# 透明的

我们希望函数尽可能透明。透明功能减少了生产环境中的错误数量。

在你的编程语言中，试图让一个远程服务看起来太像一个本地对象是没有用的，因为它本质上是不同的。

HTTP 没有隐藏它是一种网络协议的事实。如果您正在从某个第三方实体获取身份引用，您将执行 GET 调用，并且您可以确保多次 GET 不会改变服务的结果。

如果你试图在第三方实体上创建一些东西，你会做一个 POST 调用。您知道，如果在此过程中发生了一些错误，您可以根据 HTTP 状态代码看到网络问题或服务器错误。

# 实验的容易程度

这一点与灵活性有关。当我们想做快速原型和实验时，灵活性是王道。

您可以简单地使用 web 浏览器或命令行工具 curl，而无需设置代码生成或软件安装。REST 也受到所有编程语言的支持，并拥有一个庞大的工具生态系统，如服务器、缓存、负载平衡器、监控、调试工具、测试工具等。

# 这是不是意味着 RPC 已经死了？

尽管存在上述问题，RPC 框架并没有消失。构建在 RPC 框架之上的新框架解决了这些问题。例如，Thrift 和 Avro 附带了 RPC 支持。gRPC 是使用协议缓冲区的 RPC 实现。[骗](https://twitter.github.io/finagle/)用节俭。

这种新一代的 RPC 框架更加明确了远程请求不同于本地函数调用。例如，Finagle 使用期货来封装可能失败的异步操作。Futures 创建了一个抽象来简化多个服务调用的调用，并在之后组合它们的结果(使用`traverse`或`sequence`)。

RPC 的另一个优点是，通过使用二进制编码格式发送请求，它比 REST 紧凑得多。因此，它比 REST 更有内存效率。

# 选择符合您目标的 API 风格

假设您的目标是创建一个 API，它可以在同一数据中心内同一组织的两个服务之间进行通信。在这种情况下，RPC 或 gRPC 可能是设计和实现 API 的绝佳选择。

RPC 有助于使在数据中心的服务内发送请求比 REST 更有效。

如果您的服务想要公开公共 API 或创建隔离，那么使用 HTTP 和 REST API 可以在您的系统中提供更多的可扩展性。任何从标准文档中了解 HTTP 的人都可以使用您的 API。

# 来源

*   REST 与 RPC:你试图用你的 API 解决什么问题？|谷歌云博客

*最初发表于*[T5【https://edward-huang.com】](https://edward-huang.com/programming/system-thinking/architecture/2021/08/24/why-is-rest-more-popular-than-rpc/)*。*

*更多内容请看*[***plain English . io***](http://plainenglish.io/)