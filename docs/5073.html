<html>
<head>
<title>Understand Custom Hooks in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解React中的自定义挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/custom-hooks-in-react-6e78aeca44d2?source=collection_archive---------10-----------------------#2021-10-14">https://javascript.plainenglish.io/custom-hooks-in-react-6e78aeca44d2?source=collection_archive---------10-----------------------#2021-10-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4832352565a0c53d4f01b72087df1432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*swGSCOmBI2xY0EAyHdYKEg.png"/></div></div></figure><p id="1719" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不能说其他的，但很长一段时间，我不知道为什么钩子在基于类的React组件中不可用。正因为如此，每当我在类组件中使用钩子时，我都会得到一个错误，这是我不能完全理解的。但是我很高兴我在React中使用了功能组件。真的！我不知道为什么，但我发现为我的React项目编写所有这些函数很有趣。无论如何，让我们谈谈钩子，尤其是React中的定制钩子。</p><p id="9298" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">找到React中的钩子的最好方法是浏览React官方文档，其中说:</p><blockquote class="kt ku kv"><p id="efb1" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated">挂钩<em class="in">是React 16.8中的新增功能，它让你不用写类就可以使用状态和其他React特性。</em></p></blockquote><p id="defc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在胡克之前，</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="493f" class="lj lk in lf b gy ll lm l ln lo">import React from ‘react’<br/>class App extends React.Component {<br/>    constructor(props){<br/>       super(props)<br/>       this.state = { counter: 0 }<br/>    }</span><span id="74dd" class="lj lk in lf b gy lp lm l ln lo"><br/> <br/>   // rest of the code}</span></pre><p id="66ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，用钩子，</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="deb3" class="lj lk in lf b gy ll lm l ln lo">import React, { useState }<br/>const App = () =&gt; {<br/>    const [counter, setCounter] = useState(0)</span><span id="0195" class="lj lk in lf b gy lp lm l ln lo">    //rest of the code<br/>}</span></pre><p id="6ec3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就像我说的，我只是喜欢功能组件的世界。当然，你明白我的意思，因为你可能两种方式都做了。我喜欢第二个。你可能会也可能不会。那很好。</p><h2 id="b2df" class="lj lk in bd lq lr ls dn lt lu lv dp lw kg lx ly lz kk ma mb mc ko md me mf mg bi translated">但是如果我们已经在React中内置了钩子，为什么我们还需要定制钩子呢？为什么要大费周章？</h2><p id="83e0" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">说得好。但我也确信，有一天，当某些钩子没有按照你想象的方式工作时，你可能会想要更多的灵活性，或者做你想做的任何事情。尽管钩子有很多优点，但也有一些限制，这只会促使我们自己制作钩子。</p><ul class=""><li id="939b" class="mm mn in jx b jy jz kc kd kg mo kk mp ko mq ks mr ms mt mu bi translated"><strong class="jx io">问题#1 </strong>:开箱即用的react钩子的问题是，它们只能在<code class="fe mv mw mx lf b">functional components</code>或<code class="fe mv mw mx lf b">custom hooks</code>本身中使用。</li><li id="5fa0" class="mm mn in jx b jy my kc mz kg na kk nb ko nc ks mr ms mt mu bi translated"><strong class="jx io">问题#2 </strong>:此外，react钩子只能在代码块的最顶层调用，不能嵌套在代码块的下面。这意味着如果我做了下面的事情，<code class="fe mv mw mx lf b">useState</code>就不会工作。</li></ul><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="b6e4" class="lj lk in lf b gy ll lm l ln lo">const App = () =&gt; {<br/>    // some cool logic {<br/>        // some more cool logic<br/>        const [counter, setCounter] = useState(0)<br/>    }<br/>}</span></pre><h1 id="96b2" class="nd lk in bd lq ne nf ng lt nh ni nj lw nk nl nm lz nn no np mc nq nr ns mf nt bi translated">输入，自定义挂钩</h1><p id="6502" class="pw-post-body-paragraph jv jw in jx b jy mh ka kb kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">定制钩子没有什么特别的，除了是你和我制造它，谁决定发生什么以及如何发生。我觉得这很特别，对吧？哈哈！就像任何其他函数一样，自定义钩子可以有返回类型，可以返回字符串、数组、对象、数字——无论JavaScript有什么数据类型，它都可以返回。那真的很酷。</p><p id="ac55" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在制作我们的定制挂钩时要记住的一点是，最好将其命名为<code class="fe mv mw mx lf b">use&lt;HookName&gt;</code>，就像有<code class="fe mv mw mx lf b">useState</code>、<code class="fe mv mw mx lf b">useEffect</code>、<code class="fe mv mw mx lf b">useCallback</code>……你明白我的意思了。这让React注意到我们将来可能会做的任何违规行为，并指出来。</p><p id="27af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一个定制钩子的例子— <code class="fe mv mw mx lf b">useCounter</code>。在这里，我在我的自定义钩子中使用了useState和useEffect，解决了我在上面第一期提到的问题。</p><p id="654b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe mv mw mx lf b">useCounter.js</code>中(命名由您决定，尽管在开头使用单词<code class="fe mv mw mx lf b">use</code>是个好主意)。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="7654" class="lj lk in lf b gy ll lm l ln lo">import { useState, useEffect }<br/>const useCounter = () =&gt; {<br/>    const [counter, setCounter] = useState(0)</span><span id="5f5e" class="lj lk in lf b gy lp lm l ln lo">    useEffect(() =&gt; {<br/>        const interval = setInterval(() =&gt; {<br/>             setCounter((prevCounter) =&gt; prevCounter + 1)<br/>        }, 1000)<br/>    <br/>    return () =&gt; clearInterval(interval)<br/>    <br/>    }, [])</span><span id="be54" class="lj lk in lf b gy lp lm l ln lo">    return counter<br/>}</span><span id="1554" class="lj lk in lf b gy lp lm l ln lo">export default useCounter</span></pre><p id="f59b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这样一来，我现在可以在任何组件中使用这个钩子了。可能在应用程序组件中，或者在我的组件树中的某个组件中。</p><p id="df1e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在App.js中，使用useCounter就像使用任何默认的React挂钩一样简单。假设我想要呈现由<code class="fe mv mw mx lf b">useCounter</code>钩子返回的<code class="fe mv mw mx lf b">counter</code>状态的值(一个数字)。没问题…</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="a733" class="lj lk in lf b gy ll lm l ln lo">import React from 'react'</span><span id="6456" class="lj lk in lf b gy lp lm l ln lo">const App = () =&gt; {<br/>    const counter = useCounter()</span><span id="99a1" class="lj lk in lf b gy lp lm l ln lo">    return (<br/>        &lt;main className = 'App'&gt;<br/>            &lt;p&gt;Counter: {counter}&lt;/p&gt;<br/>        &lt;/main&gt;<br/>    )<br/>}</span><span id="d73d" class="lj lk in lf b gy lp lm l ln lo">export default App</span></pre><p id="5d52" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就这么简单。当然，随着定制钩子处理的逻辑变得复杂，实现会变得有点棘手，尤其是当钩子处理HTTP请求时。但最核心的是，这就是React中定制钩子的样子，并且和普通钩子一样容易使用。</p><p id="6060" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望我能保持简单。我知道React中已经有了与自定义挂钩相关的文档，但是我发布其中一个的主要原因是，让我自己负责，用我的语言简化事情，并且与所有人分享我的学习之旅。</p><p id="581d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">谢谢你过来。快乐反应！</p><p id="003d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">更多内容看</em> <a class="ae nu" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kw">说白了就是</em> </strong> </a> <em class="kw">。报名参加我们的</em> <a class="ae nu" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kw">免费周报</em> </strong> </a> <em class="kw">。在我们的</em> <a class="ae nu" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="kw">社区获得独家访问写作机会和建议</em> </strong> </a> <em class="kw">。</em></p></div></div>    
</body>
</html>