<html>
<head>
<title>The Most Expensive and Outrageous Bug I Have Ever Encountered</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我遇到过的最贵最离谱的Bug</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-most-expensive-and-outrageous-bug-i-have-ever-encountered-625d917dc5fa?source=collection_archive---------2-----------------------#2021-12-01">https://javascript.plainenglish.io/the-most-expensive-and-outrageous-bug-i-have-ever-encountered-625d917dc5fa?source=collection_archive---------2-----------------------#2021-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8f6d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">我们必须承担成本。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c88b51149ac0353dfcf48989646a3cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Zc-MTp8pJLZp4pjj"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@christinhumephoto?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christin Hume</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e00c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我的职业生涯中，我遇到过的最荒谬、最具创伤性的错误之一是微软SQL Server中的一个已知但未记录在案的错误。因为那件事我损失惨重。</p><p id="d7ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">故事如下:一家大型啤酒厂的客户想要开发一个管理其经销商(批发商)的系统。这个想法是要有一个完整的系统来处理从销售到饮料配送的路线。</p><p id="eb1f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一组配备掌上电脑的销售人员每天拜访客户，接受订单，完成交易，并在一天结束时返回总部并下载订单。这些订单会在一夜之间得到处理并开出账单，在第二天的早上/上午，会开具带有送货路线的发票。</p><p id="8e83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据客户的要求，数据库应该是微软的MS SQL Server。但是，考虑到数据量，最推荐的做法是将数据库放在运行Oracle的Unix/Linux机器上。是年纪大了，好吗？没有像我们今天这样的移动互联网，那是另一个时代。</p><p id="f0ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一大群卖家回来了。它卸载了4000到5000份订单，其中有20到30件商品(我记得目录中的一件商品是“马拉松西瓜”，几乎什么也没卖出去)。</p><p id="70a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个晴朗的夜晚，我接到技术支持的电话，升级了一个严重的故障情况。整个系统已经离线，客户无法处理订单。</p><p id="2c61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们到了客户端的网站(当时还没有云计算，那是上个世纪)，直接分析应用和数据库服务器。应用程序服务器正常。数据库服务器处于昏迷状态。它既不前进也不后退。</p><p id="b267" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当控制台发出命令时，他根本不理会。因此，没有客户端能够连接到数据库。不是直接的，不是愤怒的祈祷。没有办法。数据库服务器处于昏迷状态。</p><p id="eafa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人建议使用TMSP(微软故障排除技术)，包括重新启动Windows NT(当时没有Windows服务器，我在说，已经很久了，至少计算机不是阀门)。</p><ul class=""><li id="311e" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">我们重启数据库服务器。没有任何东西</li><li id="eef4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">我们重启整个服务器。没有任何东西</li><li id="2c0c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">数据库根本没有恢复联机。</li></ul><p id="3c43" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们恢复了一个备份，怀疑银行文件已经损坏。但是SQL Server没有离线实用工具来检查文件完整性。他甚至做到了，但他必须上电视。现在吗？但是怎么做呢？我们开始服务的时候他还在昏迷中！</p><p id="720b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我的一个同事想到了一个绝妙的主意。数据库服务器必须进行回滚，所以它看起来像是处于昏迷状态。我们打赌。</p><p id="a93b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于服务器出现故障，TMSP试图恢复广播。这发生在服务器有机会完成回滚之前。当我们重新启动银行时，服务器正在回滚，你知道吗？</p><p id="35fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我决定按照这位同事(他是DBA)的建议去做。于是我们让服务器安静下来，大概过了3、4个小时，控制台反应一般，数据完好，一切都很漂亮，我们就同意了。</p><p id="25a8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个错误是SQL Server的一个限制。数据库中的大量插入同时发生(几十个供应商同时到达)导致了一些RAM资源或类似资源的耗尽。SQL Server只是拆分事务并回滚。</p><p id="bf16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这家客户酿酒厂是微软在全球最重要的客户之一。她有一个专属的客户/产品经理。当我们激活MS的本地支持时，他不得不爬上公司总部，然后爬上MS本身，事情逐步升级，直到到达雷德蒙，会见MS的那个从SQL Server学到最多东西的人。</p><p id="5b27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他分析了情况，从那里，从那里，检查了场景，并对我们说，“这是SQL Server的一个未记录的错误，”并展示了一份来自MS的内部机密报告，告诉我们大约八个月前发现的这个问题。我们松了口气，问修正什么时候出来。MS只是说它不会修复这个问题，SQL server下一个版本会修复它(详细说明，SQL Server是一个全新的产品，完全重写并适合)，我们必须重写应用程序。</p><p id="6839" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，针对客户端的数据量扩展服务器是不够的，MS professional为我们指定了兼容的服务器硬件。</p><p id="3166" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">结果，不幸的是，这家啤酒厂的客户拒绝支付对软件进行必要修改的费用，我们不得不承担这笔费用。</p><p id="9383" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mg">更多内容看</em> <strong class="ky ir"> <em class="mg"> </em> </strong> <a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mg">说白了. io </em> </strong> </a> <strong class="ky ir"> <em class="mg">。</em> </strong> <em class="mg">报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="mg">免费每周简讯点击这里</em> </strong> </a> <strong class="ky ir"> <em class="mg">。</em> </strong></p></div></div>    
</body>
</html>