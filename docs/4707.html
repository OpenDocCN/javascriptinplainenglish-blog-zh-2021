<html>
<head>
<title>How to Set Timeout with the JavaScript Fetch API using AbortController</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AbortController通过JavaScript Fetch API设置超时</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-set-api-timeout-with-javascript-fetch-api-2d7c95782fa9?source=collection_archive---------1-----------------------#2021-09-20">https://javascript.plainenglish.io/how-to-set-api-timeout-with-javascript-fetch-api-2d7c95782fa9?source=collection_archive---------1-----------------------#2021-09-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/6fdc287840f6393834ac42163875eea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*0rFZlPd9yV2WkslyhIryCQ.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Photo by <a class="ae jv" href="https://unsplash.com/@jodaarba?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jose Aragones</a> on <a class="ae jv" href="https://unsplash.com/s/photos/stop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0fc5" class="jw jx in bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h1><p id="22c5" class="pw-post-body-paragraph ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">最近，我一直在构建需要对服务器进行API调用的示例项目。我选择了JavaScript Fetch API，因为我不想用外部库和管理依赖项来膨胀我的应用程序。在测试其中一个项目时，我失去了互联网连接，应用程序在进行API调用时被卡住，它没有超时或显示适当的错误。</p><p id="eadd" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated">考虑到这一点，我研究了Fetch API，看它是否在其接口、请求体或头中支持超时。不幸的是，它没有其他基于承诺的HTTP客户端支持的超时选项。</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">An example of <a class="ae jv" href="https://axios-http.com/" rel="noopener ugc nofollow" target="_blank">Axios</a>’s timeout option</figcaption></figure><p id="2778" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated">在本帖中，我们将讨论如何在使用Fetch API时使用AbortController来设置超时。我们将使用React开发我们的前端应用程序。(<em class="md">注意:您可以在其他前端库/框架上使用相同的方法。</em>)。</p><h1 id="1a91" class="jw jx in bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">沙箱</h1><p id="5e23" class="pw-post-body-paragraph ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">我们在一个<a class="ae jv" href="https://codesandbox.io/s/magical-wave-53dgk?file=/src/App.js:173-217" rel="noopener ugc nofollow" target="_blank"> Codesandbox </a>中完成了这个项目，你可以派生它来运行代码。</p><h1 id="cab1" class="jw jx in bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">让我们编码</h1><p id="3f9b" class="pw-post-body-paragraph ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">在开始之前，我们需要了解什么是<strong class="kw io">人工控制器</strong>以及它是如何工作的。AbortController是一个对象，它允许我们在需要时中止一个或多个web请求。它包含一个<code class="fe me mf mg mh b">signal</code>属性和一个<code class="fe me mf mg mh b">abort</code>方法，用于根据需要分别传递和停止请求。</p><p id="45a5" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated">没有超时的<code class="fe me mf mg mh b">fetch</code>函数如下所示:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">using the Fetch API without a timeout</figcaption></figure><h2 id="b879" class="mi jx in bd jy mj mk dn kc ml mm dp kg lf mn mo kk lj mp mq ko ln mr ms ks mt bi translated"><strong class="ak">集成人工控制器</strong></h2><p id="8d0c" class="pw-post-body-paragraph ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">为了将AbortController与<code class="fe me mf mg mh b">fetch</code> API集成，我们需要创建一个<code class="fe me mf mg mh b">Timeout</code>函数，如下所示:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">using the abort contoller</figcaption></figure><p id="f21d" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated">上述代码执行这些任务:</p><ul class=""><li id="a484" class="mu mv in kw b kx ls lb lt lf mw lj mx ln my lr mz na nb nc bi translated">创建一个<code class="fe me mf mg mh b">Timeout</code>函数和一个AbortController实例。</li><li id="2da9" class="mu mv in kw b kx nd lb ne lf nf lj ng ln nh lr mz na nb nc bi translated">使用<code class="fe me mf mg mh b">setTimeout</code>函数在指定时间后触发<code class="fe me mf mg mh b">abort</code>方法(通过乘以1000转换为秒)并返回控制器。</li></ul><p id="3bbb" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated">最后，要使用<code class="fe me mf mg mh b">timeout</code>函数，我们需要修改<code class="fe me mf mg mh b">fetch</code>请求对象<code class="fe me mf mg mh b">signal</code>，如下所示:</p><figure class="lx ly lz ma gt jo"><div class="bz fp l di"><div class="mb mc l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">updated App.js with a timeout of 10 seconds</figcaption></figure><h1 id="114b" class="jw jx in bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h1><p id="03d0" class="pw-post-body-paragraph ku kv in kw b kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">这篇文章讨论了在用Fetch API调用REST API时，如何使用AbortController设置超时。</p><p id="850b" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated"><strong class="kw io">参考:</strong></p><ul class=""><li id="5bab" class="mu mv in kw b kx ls lb lt lf mw lj mx ln my lr mz na nb nc bi translated"><a class="ae jv" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank">获取API </a></li><li id="e614" class="mu mv in kw b kx nd lb ne lf nf lj ng ln nh lr mz na nb nc bi translated"><a class="ae jv" href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController" rel="noopener ugc nofollow" target="_blank">流产控制员</a></li></ul><p id="7a30" class="pw-post-body-paragraph ku kv in kw b kx ls kz la lb lt ld le lf lu lh li lj lv ll lm ln lw lp lq lr ig bi translated"><em class="md">更多内容看</em><a class="ae jv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="md">plain English . io</em></strong></a></p></div></div>    
</body>
</html>