<html>
<head>
<title>Getting Started with Yarn 3 with TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TypeScript开始使用Yarn 3</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-yarn-3-and-typescript-125e7b537e6c?source=collection_archive---------3-----------------------#2021-10-21">https://javascript.plainenglish.io/getting-started-with-yarn-3-and-typescript-125e7b537e6c?source=collection_archive---------3-----------------------#2021-10-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/4485bb481d4e13c5bcd11ce41eabde34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9bB0z5AEpSSNoEiU"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@maxcodes?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Maxwell Nelson</a> on <a class="ae ja" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="0a6c" class="pw-subtitle-paragraph ka jc jd bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">粉丝最喜欢的软件包管理器的下一个令人印象深刻的迭代。</h2></div><p id="7650" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在我们开始之前，请随意查看我关于Yarn 2的文章，“<a class="ae ja" href="https://medium.com/swlh/getting-started-with-yarn-2-and-typescript-43321a3acdee" rel="noopener">开始使用Yarn 2和TypeScript </a>”，它有点过时(2020年6月👀)但是如果你不打算升级，需要一个介绍，你已经有了。都准备好了吗？那好吧。</p><p id="fc42" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">所以已经很久很久了。纱线2在发布后几乎立即发生了很大变化。在针对VS代码和其他编辑器和环境的SDK变更之间，对于如何存储和命名各种核心包文件，这是一个理所应当的头痛问题，但对于关注该版本的专门开发人员来说，这是一个受欢迎的问题。包括我自己！然而，现代纱线终于稳定下来，随着新发现的稳定性和大量的反馈，我们发现自己正处于一个全新的纱线迭代中，纱线3.0！</p><h1 id="5c49" class="lo lp jd bd lq lr ls lt lu lv lw lx ly kj lz kk ma km mb kn mc kp md kq me mf bi translated">移民</h1><p id="692b" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">随着每个主要版本的变化，一些突破性的变化是意料之中的。好消息是，与最初的Yarn 1 → Yarn 2切换相比，Yarn团队已经减少了这种迭代的麻烦。我将只讨论普通开发人员将面临的主要问题，而不是只有Yarn API开发人员会遇到的较低级别的变化，比如虚拟文件系统从<code class="fe ml mm mn mo b">$$virtual</code>重命名为<code class="fe ml mm mn mo b">__virtual__</code>。</p><h2 id="4eed" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">现在不支持节点10</h2><p id="c789" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">在Node 10于2021年4月最终停产后，Yarn 3继亚马逊AWS等其他公司之后，停止了对Node 10的支持。没有什么不寻常的，但如果你发现自己处理错误，你应该仍然使用节点10，并试图安装纱线3。</p><p id="959c" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">大多数当前和新的节点开发人员可能会发现自己使用的是最新的LTS版本12或当前的LTS版本14，所以这不是问题。另一方面，在Node 10上运行的现有和较老的项目如果希望这次使用Yarn 3，就需要升级。</p><h2 id="a532" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">@yarnpkg/sdks</h2><p id="a7c5" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">如果您使用带有Yarn的编辑器或环境，您通常需要通过工具添加额外的支持，以便Yarn文件系统可以被它识别。我不会深入讨论Yarn文件系统，但总的来说，它使用一个虚拟文件系统，并将您的模块物理存储在压缩文件中，而不是普通文件，如流行的<code class="fe ml mm mn mo b">node_modules</code>，由于依赖关系树，它可以轻松地在单个依赖关系安装中占用1 GB。</p><p id="dee8" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">之前你可以简单地<code class="fe ml mm mn mo b">yarn pnpify --sdk vscode</code>(我想那是旧的命令？)，然而，对于Yarn 3，你需要使用<code class="fe ml mm mn mo b">@yarnpkg/sdks</code>来添加所需的支持。这一次您有两个选择，可执行的或基于依赖的SDK支持。</p><ul class=""><li id="bf23" class="nb nc jd ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated"><em class="nk">基于依赖的</em>支持意味着你只需运行<code class="fe ml mm mn mo b">yarn add --dev @yarnpkg/sdks</code>然后运行<code class="fe ml mm mn mo b">yarn sdks vscode</code>例如，如果你想确保VS代码理解Yarn正在做什么。</li><li id="3c5a" class="nb nc jd ku b kv nl ky nm lb nn lf no lj np ln ng nh ni nj bi translated"><em class="nk">基于二进制的</em>支持允许你使用<code class="fe ml mm mn mo b">yarn dlx @yarnpkg/sdks vscode</code>，而不是增加依赖项。考虑到你很少使用SDK支持工具，我推荐这个选项。</li></ul><h2 id="e87e" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">重新生成您的缓存</h2><p id="f2c7" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">需要修改时间戳来修复zip规范的一个缺陷，这个缺陷导致了一些第三方工具的问题，所以建议您重新生成您的<code class="fe ml mm mn mo b">.yarn/cache</code>。这个超级简单，只需运行<code class="fe ml mm mn mo b">yarn cache clean</code>，然后运行<code class="fe ml mm mn mo b">yarn</code>，重新安装你的依赖项！</p><p id="d772" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">好了，我相信这就结束了一般的迁移，到了新手身上！</p><h1 id="fccf" class="lo lp jd bd lq lr ls lt lu lv lw lx ly kj lz kk ma km mb kn mc kp md kq me mf bi translated">安装纱线全局</h1><p id="495f" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">为了做任何事情，首先，确保您已经安装了<a class="ae ja" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a>。我推荐Node 14，因为它是当前的LTS，但也可以随意使用Node 17或任何最新的版本。请记住，并不是所有的工具都支持最新的节点。</p><p id="08e0" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果您已经安装了Node，那么我们就可以安装Yarn Global，也就是Yarn Classic (Classic是一个不错的名字，但是Yarn Global更好地代表了它的目的，因为Yarn Modern (2及以上)只能通过Yarn Global按项目安装)，所以我们将使用默认情况下随Node附带的npm来安装Yarn。所以还是装纱吧！</p><pre class="nq nr ns nt gt nu mo nv nw aw nx bi"><span id="c915" class="mp lp jd mo b gy ny nz l oa ob">npm i -g yarn</span></pre><p id="4b65" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这比以前简单多了，你过去必须通过MSI包、Chocolatey和其他方法手动安装Yarn，这使得更新变得很痛苦。无论如何，一旦安装完成，你就可以开始使用Yarn Modern了！</p><h1 id="7775" class="lo lp jd bd lq lr ls lt lu lv lw lx ly kj lz kk ma km mb kn mc kp md kq me mf bi translated">创建新项目</h1><p id="14c4" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">创建一个新项目很容易，但是您有几个选择。现代初始化和经典初始化。虽然两者做的工作大致相同，但您可能会发现自己更喜欢现代的init，而不是经典的init，因为它附带了设置。</p><h2 id="4eb7" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">经典初始化</h2><p id="0672" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">要开始，你需要注意创建目录和运行<code class="fe ml mm mn mo b">yarn init</code>以及回答设置问题的基础知识。</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/78553bdeda9c99baf5d4edff83a74c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*-1WkJIEU1wpFkCpxwQoIIA.png"/></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Yarn Classic init prompt</figcaption></figure><p id="1fc4" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在这里，你会看到一个冗长的设置提示，询问名称、版本等……最后，结果只是简单的<code class="fe ml mm mn mo b">package.json</code>和几秒钟的浪费时间。🤦🏻‍♂️</p><p id="39ae" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这就是为什么Classic的init远不是首选，但绝对是最简单的一个。</p><h2 id="93cf" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">现代初始化</h2><p id="a9f7" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">在这里，我们有一些额外的步骤来获得Modern init，除了创建目录之外，我们还需要将版本设置为“berry ”,然后使用init命令来完成。</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a38a4af1000f62dc23f7c8676912d215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*9qQKRgl3-g7a_Nhq6dJ9Iw.png"/></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Yarn Modern’s init</figcaption></figure><p id="8325" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在我们已经尝到了纱现代的最小初始！如你所见，我们首先运行<code class="fe ml mm mn mo b">yarn set version berry</code>来安装纱线3，然后是<code class="fe ml mm mn mo b">yarn init</code>，它现在使用纱线3来启动我们。更好的是，它自动生成我们的<code class="fe ml mm mn mo b">package.json</code>,没有任何问题！但是等等，还有呢！除了我们的包文件之外，Yarn 2和up给了我们一个开始项目的结构，让我们真正开始工作。这包括事实上的“README ”,在幕后自动运行的<code class="fe ml mm mn mo b">git init</code>,以及一个用于平滑交叉编辑器设置的<code class="fe ml mm mn mo b">.editorconfig</code>文件。下面是一个例子:</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi od"><img src="../Images/a4efdfc12334a3c219ef0067fc1c98cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GeuWDcC02l2PWRWBT9yrmw.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">An overview of the Yarn 3 project structure</figcaption></figure><p id="2b0d" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">这已经是我最喜欢的设置程序了，但是你可以随意使用你喜欢的东西！</p><h1 id="789f" class="lo lp jd bd lq lr ls lt lu lv lw lx ly kj lz kk ma km mb kn mc kp md kq me mf bi translated">添加TypeScript</h1><p id="709b" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">既然你已经读到这里，我假设你已经熟悉了TypeScript，跳过介绍，如果没有，那么一定要亲自看看<a class="ae ja" href="https://www.typescriptlang.org/" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>！</p><p id="a9a3" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">当然，这可能是您阅读本文的主要原因，就像上一篇《Yarn 2》发布时一样。遵循这种模式，由于插件的存在，集成变得尽可能容易。首先，您需要导入Yarn的TypeScript插件，当然还要安装TypeScript本身，并使用我们之前学习过的<code class="fe ml mm mn mo b">@yarnpkg/sdks</code>进行环境设置。我们开始吧！</p><h2 id="74b0" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">安装TypeScript</h2><p id="a271" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">安装TypeScript非常简单，任何依赖项都是如此，而且多亏了Yarn，安装速度也非常快！</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/317f317fb9100adf70119b95ca7898ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Fh-9hAWeBld4QzwlCLX_Qg.png"/></div></figure><h2 id="2293" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">可选:导入TypeScript插件</h2><p id="6eba" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">在这里，您可以像往常一样很容易地开始开发，但是有一件关于包的TypeScript支持的事情一直是个难题，那就是安装类型。有些包确实提供了包内自带的TypeScript类型，但是其他的包往往太大了，以至于宁愿单独提供可选的特性。这方面的一个例子是<a class="ae ja" href="https://yarnpkg.com/package/react" rel="noopener ugc nofollow" target="_blank"> React </a>，<em class="nk">顺便说一下，我添加了Yarn包链接而不是React的网站，这样你就可以看到Yarn是如何告诉你哪些包有TypeScript typings/support </em>。</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/f7d37042dc8b15cdfaf41ad1f1eb95fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*YNZGA2m5g0WugL31kMCuNQ.png"/></div></figure><p id="b184" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然而，这个插件所做的是，每当我们安装一个支持的包时，自动为我们导入这些类型！所以我们只需要<code class="fe ml mm mn mo b">yarn add react</code>而不是<code class="fe ml mm mn mo b">yarn add react &amp;&amp; yarn add @types/react --dev</code>！</p><h2 id="f1cc" class="mp lp jd bd lq mq mr dn lu ms mt dp ly lb mu mv ma lf mw mx mc lj my mz me na bi translated">向我们的编辑器添加类型脚本支持</h2><p id="7af7" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">在幕后，Yarn将对包进行修补，以允许它们与它的虚拟文件系统一起工作。我不知道许多软件包，但从个人经验来看，我知道TypeScript是其中之一，它的支持历史相当坎坷，不久前才趋于平稳。这个补丁的问题是，虽然软件包理解Yarn如何工作，但我们的编辑器不再理解TypeScript的语言服务器如何工作，这意味着当使用TypeScript时，我们会遇到各种问题，如模块丢失或随机语言功能被禁用，因为我们使用了两个不同的版本。</p><p id="0a46" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">因此，为了解决这个问题，我们将只使用<code class="fe ml mm mn mo b">yarn dlx @yarnpkg/sdks</code>或<code class="fe ml mm mn mo b">yarn sdks</code>(如果您选择了依赖路径)来更新所有内容。</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2d2782683f37f5b9afe5a4c210299d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*W829jU1ywLgRxD6RTq56VQ.png"/></div></figure><p id="09f8" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您可以看到它现在在TypeScript旁边显示了一个复选标记，此外，一旦我们在编辑器中打开TypeScript文件，我们将收到一个请求，告诉我们检测到了不同的版本。这个版本是我们通过SDKs工具添加到编辑器工作区设置中的补丁版本。</p><figure class="nq nr ns nt gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi od"><img src="../Images/018623d6b526937a8c6a5cbb2764ff76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_R-y5tMc4jsLipVMGmQA7w.png"/></div></div></figure><h1 id="20f3" class="lo lp jd bd lq lr ls lt lu lv lw lx ly kj lz kk ma km mb kn mc kp md kq me mf bi translated">结论</h1><p id="5429" class="pw-post-body-paragraph ks kt jd ku b kv mg ke kx ky mh kh la lb mi ld le lf mj lh li lj mk ll lm ln ig bi translated">无论是开始还是迁移，这都是您需要知道的。老实说，这一次他们做得再简单不过了，总的来说，这是一次愉快的使用纱线的经历。虽然许多人对每个项目的安装表示厌恶，但由于Yarn Classic没有被项目锁定，所以这是一个要求，但总体来说，在我看来这是一个完美的系统。</p><p id="4252" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">Yarn Classic是一个基本的但仍然快速的包管理器，它可以在任何可以使用npm的地方使用，但是Yarn Modern (2，3等)可以随意使用，如果你想使用更高级的特性，如插件等。这意味着如果你在后端工作，Yarn Classic的行为类似于版本管理器，每个项目都可以有自己的版本和补丁。隔离对我有利，你呢？</p></div><div class="ab cl oe of hr og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="ig ih ii ij ik"><p id="0e6b" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">所以，很久没写了。在写完《Yarn 2和TypeScript入门》之后，我真的与它完全脱节了，因为我的生活总是到处走错路。但我不断收到关于那篇文章的电子邮件，它在没有我宣传的情况下获得的成功，甚至在我的新闻订阅中看到它，都让我无法理解。所以那篇文章显然已经过时了。</p><p id="14cb" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">但不久前我在Twitter上收到了一条消息，感谢我个人撰写了一篇关于Webpack和Yarn 2的后续文章，这激励我尝试并重新撰写文章，以帮助其他可能很难找到答案的人，我自己也找到了答案，并希望分享解决方案。</p><p id="375a" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">谢谢你读到这里，这意味着很多😊。也请随时提供反馈，告诉我如何改进，或者您认为我可能遗漏了什么！</p><p id="1fa1" class="pw-post-body-paragraph ks kt jd ku b kv kw ke kx ky kz kh la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="nk">更多内容看</em><a class="ae ja" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku je"><em class="nk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>