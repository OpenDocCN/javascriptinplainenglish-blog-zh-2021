<html>
<head>
<title>Type-Safe Next.js API Routes with Nextkit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nextkit的类型安全Next.js API路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/type-safe-next-js-api-routes-with-nextkit-b95d78e53c7d?source=collection_archive---------1-----------------------#2021-10-20">https://javascript.plainenglish.io/type-safe-next-js-api-routes-with-nextkit-b95d78e53c7d?source=collection_archive---------1-----------------------#2021-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dfb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Next.js的API routes是一个非常强大的特性，可以让你在一个Next.js应用中编写整个应用，整个堆栈。</p><p id="b670" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为一个TypeScript用户，它们缺少一个对我来说至关重要的特性，那就是类型安全。</p><p id="3539" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们一起用<a class="ae km" href="https://www.npmjs.com/package/nextkit" rel="noopener ugc nofollow" target="_blank"> Nextkit </a>来解决这个问题吧！</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/09b8fc192d41ba753dd4d6112c55bd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CPp5keglpw9fSysd.png"/></div></div></figure><h1 id="b1ee" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">问题是</h1><p id="01b6" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">假设我们的API文件夹中有这个路径。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">An example of a basic Next.js API route</figcaption></figure><p id="7303" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这是一个很好的起点。我希望能够推断出我的API在我的React组件中返回的类型。如果我做不到这一点，我为什么还要使用TypeScript呢？</p><h1 id="00fb" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">解决问题！</h1><p id="d560" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我们将一起创建我们的第一个类型安全的API路由！</p><p id="77a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一步是生成一个利用Typescript的新Next.js应用程序。您可以使用以下命令轻松做到这一点:</p><pre class="ko kp kq kr gt mi mj mk ml aw mm bi"><span id="efb4" class="mn la iq mj b gy mo mp l mq mr">npx create-next-app --ts<br/>// or with yarn<br/>yarn create next-app --ts</span></pre><p id="2dfc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行完成后，导航到新创建的文件夹并添加<a class="ae km" href="https://www.npmjs.com/package/nextkit" rel="noopener ugc nofollow" target="_blank"> Nextkit </a>！</p><pre class="ko kp kq kr gt mi mj mk ml aw mm bi"><span id="8b45" class="mn la iq mj b gy mo mp l mq mr">npm i nextkit<br/>// or with yarn<br/>yarn add nextkit</span></pre><p id="3b26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果一切顺利，您现在有了一个新的Next.js应用程序，它已经在<code class="fe ms mt mu mj b">/pages/api/hello.ts</code>文件中包含了一个API路由。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">The API route generated by Next.js</figcaption></figure><p id="a1bb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于我们指定要使用TypeScript，Next.js已经使用了NextApiResponse泛型。<br/>我们将继续努力，让我们开始添加Nextkit吧！</p><p id="4bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除这个<code class="fe ms mt mu mj b">hello.ts</code>文件中的所有内容，并用下面的设置替换它。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="a1ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们刚刚改变的是:</p><ul class=""><li id="61da" class="mv mw iq jp b jq jr ju jv jy mx kc my kg mz kk na nb nc nd bi translated">使用Nextkit API代替常规处理程序</li><li id="5d12" class="mv mw iq jp b jq ne ju nf jy ng kc nh kg ni kk na nb nc nd bi translated">创建一个简单的GET路径，返回<code class="fe ms mt mu mj b">Hello World!</code></li></ul><p id="d95f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这意味着我们现在有了一个完全类型安全的API路由，剩下要做的就是调用它。</p><p id="1862" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为此，我们需要导航到<code class="fe ms mt mu mj b">/pages/index.tsx</code>，就像我们的API路由一样，您可以删除其中的所有内容，并用以下内容替换。</p><figure class="ko kp kq kr gt ks"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Our new and improved index</figcaption></figure><p id="9a10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">重要！<br/> </strong>看看我们是怎么从<code class="fe ms mt mu mj b">./api/hello</code>进口API的，别忘了在前面加<code class="fe ms mt mu mj b">type</code>。不然不行！</p><p id="bd59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想既然你在寻找API路由中的类型安全，你已经很清楚React是如何工作的了，但是让我们一起回顾一下我们刚刚做的事情吧！</p><p id="c47d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的第一步是使用Nextkit的<code class="fe ms mt mu mj b">InferAPIResponseType</code>创建一个新类型。通过将<code class="fe ms mt mu mj b">typeof api</code>添加到通用部件，我们创建了一个新的类型，它将包含我们的API的返回类型。</p><p id="d5cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后，我们创建一个名为data的新的空状态变量，并使用一个泛型将类型设置为<code class="fe ms mt mu mj b">null | Res</code>。<br/> <code class="fe ms mt mu mj b">Res</code>是我们刚刚使用Nextkit的<code class="fe ms mt mu mj b">InferAPIReponseType</code>创建的类型。</p><p id="8516" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后我们添加一个新的<code class="fe ms mt mu mj b">useEffect</code>，在其中我们使用一个简单的获取来调用我们的API路由。</p><p id="4c5d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当解析我们的数据时，我们做了一些有点特别的事情！<code class="fe ms mt mu mj b">fetch</code>异步工作，我们首先添加一个<code class="fe ms mt mu mj b">.then</code>处理程序，在其中我们将来自API的响应解析为JSON。我们还使用了<code class="fe ms mt mu mj b">as</code>关键字，让TypeScript知道<code class="fe ms mt mu mj b">res.json()</code>将返回一个类型为<code class="fe ms mt mu mj b">ApiReponse&lt;Res&gt;</code>的新承诺。<br/>之后<code class="fe ms mt mu mj b">.then</code>我们当然需要再放一个，因为我们的第一个<code class="fe ms mt mu mj b">.then</code>做了一个异步动作。</p><p id="d768" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个是真正神奇的地方。如果我们看一下<code class="fe ms mt mu mj b">res</code>的类型，我们可以看到它现在具有我们在API route中指定的类型！</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/145c832e9bb2fea92584875f4fe27f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*8iOn1l0s8JxuvR7Tk1Q4ug.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">The type of our returned data</figcaption></figure><p id="deed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在需要做的就是将我们的状态变量设置为<code class="fe ms mt mu mj b">res.data</code>，我们已经准备好渲染结果了！</p><p id="a1a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你正在寻找一个完整的例子，你应该访问<a class="ae km" href="https://github.com/alii/nextkit" rel="noopener ugc nofollow" target="_blank"> Nextkit仓库</a>。这个库包含一个带有fetch的普通例子和一个使用来自Vercel 的<a class="ae km" href="https://swr.vercel.app/" rel="noopener ugc nofollow" target="_blank"> SWR的例子。</a></p><h1 id="e9a0" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Nextkit主要特性</h1><p id="4f94" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">我知道这需要理解很多东西，所以这里有您需要记住的Nextkit的所有关键组件！</p><h2 id="023b" class="mn la iq bd lb nk nl dn lf nm nn dp lj jy no np ln kc nq nr lr kg ns nt lv nu bi translated">美国石油学会(American Petroleum Institute)</h2><p id="179a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">API是用于创建新路线的功能。因为它是一个TypeScript库，您将总是得到您需要的自动完成！<br/> Nextkit支持所有的HTTP方法，所以你不仅仅局限于获取数据，你还可以用它来创建POST和PUT路径。</p><h2 id="2892" class="mn la iq bd lb nk nl dn lf nm nn dp lj jy no np ln kc nq nr lr kg ns nt lv nu bi translated">InferApiReponseType</h2><p id="1141" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">这个泛型类型用于推断API路由返回的内容。对于您创建的每一个处理程序，您都需要导出一个新的类型来推断您的处理程序的类型。大概是这样的<code class="fe ms mt mu mj b">type HandlerResponse = InferApiReponseType&lt;typeof handler&gt;;</code>。这样，我们可以在前端导入类型，并在那里使用它！</p><h2 id="d7c7" class="mn la iq bd lb nk nl dn lf nm nn dp lj jy no np ln kc nq nr lr kg ns nt lv nu bi translated">APIResponse</h2><p id="36f8" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">APIReponse是我们在前端使用的通用类型。您需要像这样指定您试图调用的特定处理程序响应<code class="fe ms mt mu mj b">APIReponse&lt;HandlerResponse&gt;</code>。</p><h2 id="3a68" class="mn la iq bd lb nk nl dn lf nm nn dp lj jy no np ln kc nq nr lr kg ns nt lv nu bi translated">http异常</h2><p id="dfff" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">Nextkit的创造者Alistair知道，并不是所有的路线都遵循一条平坦的道路。这就是为什么Nextkit有内置的HttpException类，您可以使用它轻松地抛出异常。<br/>工作原理是这样的<code class="fe ms mt mu mj b">throw new HttpException(404, 'Not found!');</code>。第一个参数是状态号，第二个参数是要传递的消息。</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="2545" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">祝你有乐观的一天！💙</p></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="e6f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">更多内容看</em> <a class="ae km" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">说白了。</em></strong></a></p><p id="006b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">报名参加我们的</em> <a class="ae km" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">免费每周简讯</em> </strong> </a> <em class="kl">。关注我们关于</em> <a class="ae km" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">推特</em> </strong> </a>，<a class="ae km" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">LinkedIn</em></strong></a><em class="kl">，</em><a class="ae km" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="kl">YouTube</em></strong></a><em class="kl">，以及</em> <a class="ae km" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">不和</em> </strong> </a> <strong class="jp ir"> <em class="kl">。</em>T53】</strong></p><p id="d29c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">对缩放您的软件启动感兴趣</em> </strong> <em class="kl">？检查出</em> <a class="ae km" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="kl">电路</em> </strong> </a> <em class="kl">。</em></p><h1 id="da1d" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">进一步阅读</h1><div class="oc od gp gr oe of"><a rel="noopener  ugc nofollow" target="_blank" href="/typescript-made-easy-a-guide-to-your-first-type-safe-app-with-next-js-wundergraph-and-prisma-e197a59e2b30"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">轻松编写类型脚本:使用Next.js、WunderGraph和Prisma编写第一个类型安全应用程序的指南</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">是时候抛开恐惧，学习TypeScript了。让我们给你第一次“发现！”瞬间通过建立一个完整的…</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oo l"><div class="op l oq or os oo ot kx of"/></div></div></a></div></div></div>    
</body>
</html>