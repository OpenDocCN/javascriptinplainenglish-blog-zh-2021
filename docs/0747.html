<html>
<head>
<title>Deno — Workers, Libraries, and Modules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno —工人、库和模块</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deno-workers-libraries-and-modules-1cb3ed6c42bc?source=collection_archive---------8-----------------------#2021-02-15">https://javascript.plainenglish.io/deno-workers-libraries-and-modules-1cb3ed6c42bc?source=collection_archive---------8-----------------------#2021-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/aae6655639d15110d0157665c256492a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NFAg9wXbn8gfvvKl"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@solimonster?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">sol</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="987e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deno是一个新的服务器端运行时环境，用于运行JavaScript和TypeScript应用程序。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始为Deno开发应用程序。</p><h1 id="e787" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">工人</h1><p id="fb86" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Deno支持web worker API。</p><p id="74f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="c9d9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ebe1" class="mq lc iq mh b gy mr ms l mt mu">const worker = new Worker(new URL("worker.js", import.meta.url).href, {<br/>  type: "module",<br/>  deno: true,<br/>});<br/>worker.postMessage({ filename: "./log.txt" });</span></pre><p id="c82f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">worker.js</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fe99" class="mq lc iq mh b gy mr ms l mt mu">self.onmessage = async (e) =&gt; {<br/>  const { filename } = e.data;<br/>  const text = await Deno.readTextFile(filename);<br/>  console.log(text);<br/>  self.close();<br/>};</span></pre><p id="d8d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">log.txt</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="638b" class="mq lc iq mh b gy mr ms l mt mu">hello</span></pre><p id="40de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4359" class="mq lc iq mh b gy mr ms l mt mu">deno run  --unstable --allow-read index.ts</span></pre><p id="e8e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">Worker</code>构造函数创建工人。</p><p id="c32f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将URL传递给工人。</p><p id="e3e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对象将<code class="fe me mf mg mh b">type</code>指定为<code class="fe me mf mg mh b">'module'</code>，将<code class="fe me mf mg mh b">deno</code>设置为<code class="fe me mf mg mh b">true</code>，这样我们就可以运行worker了。</p><p id="c9de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">worker.js</code>有工人。</p><p id="601c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">self</code>是worker实例。<code class="fe me mf mg mh b">onmessage</code>方法通过调用<code class="fe me mf mg mh b">postMessage</code>接受传入的消息。</p><p id="abea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">Deno.readTextFile</code>方法来读取worker中的一个文件。</p><p id="aabc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们应该会看到控制台中记录的<code class="fe me mf mg mh b">hello</code>。</p><h1 id="fbae" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">重新加载模块</h1><p id="9a68" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">默认情况下，Deno缓存模块，而不提取或重新编译它。</p><p id="54fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们需要重新加载它们，我们运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ff78" class="mq lc iq mh b gy mr ms l mt mu">deno cache --reload index.ts</span></pre><p id="c378" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重新加载<code class="fe me mf mg mh b">index.ts</code>使用的所有东西。</p><p id="bd77" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以通过运行以下命令来重新加载<code class="fe me mf mg mh b">index.ts</code>使用的特定模块:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1440" class="mq lc iq mh b gy mr ms l mt mu">deno cache --reload=https://deno.land/std@0.75.0 index.ts</span></pre><p id="4e01" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们想重新加载<code class="fe me mf mg mh b">index.ts</code>使用的多个模块，我们运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1487" class="mq lc iq mh b gy mr ms l mt mu">deno cache --reload=https://deno.land/std@0.75.0/fs/copy.ts,https://deno.land/std@0.75.0/fmt/colors.ts index.ts</span></pre><h1 id="705b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">锁定文件</h1><p id="03ce" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Deno使用一个小的JSON文件存储并检查模块的子资源完整性。</p><p id="e531" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">-lock=lock.json</code>标志启用并指定锁文件检查。</p><p id="5783" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更新锁文件，我们运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="c8aa" class="mq lc iq mh b gy mr ms l mt mu">--lock=lock.json --lock-write</span></pre><p id="647c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">运行应用程序时，我们可以使用<code class="fe me mf mg mh b"> — -lock=lock.json</code>选项来检查数据。</p><h1 id="6dd4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">标准程序库</h1><p id="67c8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们应该运行导入的固定版本，以避免意外的更改。</p><p id="9045" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，不要写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="13ed" class="mq lc iq mh b gy mr ms l mt mu">import { copy } from "https://deno.land/std/fs/copy.ts";</span></pre><p id="c3ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该在导入时包含版本号，方法是:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="fe0c" class="mq lc iq mh b gy mr ms l mt mu">import { copy } from "https://deno.land/std@0.75.0/fs/copy.ts";</span></pre><p id="422f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用具有不稳定Deno APIs的库。</p><p id="dd08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的<code class="fe me mf mg mh b">copy</code>模块不稳定，所以要使用它，我们运行:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="7789" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-read --allow-write --unstable main.ts</span></pre><p id="2755" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启用不稳定的API。</p><h1 id="5a24" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导入和导出模块</h1><p id="e84d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用标准的ES模块来处理Deno应用程序。</p><p id="380d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="8963" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">math.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9d3a" class="mq lc iq mh b gy mr ms l mt mu">export const add = (a: number, b: number) =&gt; a + b;<br/>export const multiply = (a: number, b: number) =&gt; a * b;</span></pre><p id="db5e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="0443" class="mq lc iq mh b gy mr ms l mt mu">import { add, multiply } from "./math.ts";</span><span id="4efc" class="mq lc iq mh b gy mv ms l mt mu">console.log(add(1, 2))<br/>console.log(multiply(1, 2))</span></pre><p id="e954" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">math.ts</code>，它导出了<code class="fe me mf mg mh b">add</code>和<code class="fe me mf mg mh b">multiply</code>函数。</p><p id="4177" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<code class="fe me mf mg mh b">index.ts</code>中使用它们。</p><h1 id="c1ee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">远程导入</h1><p id="214d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们也可以直接从远程URL导入模块。</p><p id="0a8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="349f" class="mq lc iq mh b gy mr ms l mt mu">import {<br/>  add,<br/>  multiply,<br/>} from "https://x.nest.land/ramda@0.27.0/source/index.js";</span><span id="b6a4" class="mq lc iq mh b gy mv ms l mt mu">console.log(add(1, 2))<br/>console.log(multiply(1, 2))</span></pre><p id="d85b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe me mf mg mh b">https://x.nest.land/ramda@0.27.0/source/index.js</code>导入<code class="fe me mf mg mh b">add</code>和<code class="fe me mf mg mh b">multiple</code>函数。</p><p id="b1d1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用同样的方式使用它们。</p><h1 id="7f63" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="3a5c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过Deno直接使用web workers。</p><p id="fe07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以从各种来源导入模块。</p></div></div>    
</body>
</html>