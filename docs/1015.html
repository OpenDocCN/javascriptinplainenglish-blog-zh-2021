<html>
<head>
<title>Creating a REST API in Node with MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用MongoDB在Node中创建REST API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-rest-api-in-node-with-mongodb-488915bf430?source=collection_archive---------13-----------------------#2021-03-03">https://javascript.plainenglish.io/creating-a-rest-api-in-node-with-mongodb-488915bf430?source=collection_archive---------13-----------------------#2021-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/bb10854d8d01fc7d40c95a6a535e348e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x3z5o6wPLI_zNY21Tc-lYg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Source: <a class="ae kc" href="https://nordicapis.com/building-a-restful-api-using-node-js-and-mongodb/" rel="noopener ugc nofollow" target="_blank">https://nordicapis.com/building-a-restful-api-using-node-js-and-mongodb/</a></figcaption></figure><p id="0b1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将使用Node.js、Express和Mongoose构建一个具有完整CRUD功能的REST API。首先，我们将从基本的Express服务器开始。接下来，我们将为MongoDB添加配置，用Mongoose创建一个模型，并构建具有完整CRUD功能的控制器。最后，我们将定义处理传入请求的RESTful路由，并将它们路由到适当的控制器动作。</p><h1 id="a1ff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">入门指南</h1><p id="c641" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们将从安装以下npm包开始:<strong class="kf ir"> express </strong>，<strong class="kf ir">mongose，dotenv &amp; nodemon </strong>作为DevDependency。</p><p id="a660" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将设置初始的express服务器，并创建一个简单的测试路由。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/bce3c274fe2c034df4e0d74c49f43af2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/0*BYBh-p1lrusganvD"/></div></figure><h1 id="0416" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><strong class="ak">设置猫鼬</strong></h1><p id="65a2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Mongoose是Node.js最受欢迎的MongoDB包装器。它允许我们轻松地与MongoDB数据库进行交互。我们可以开始将服务器连接到我们的MongoDB数据库。(关于设置数据库的详细信息，请点击这里查看MongoDB文档<a class="ae kc" href="https://docs.atlas.mongodb.com/getting-started/" rel="noopener ugc nofollow" target="_blank"/></p><p id="39fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了连接到数据库，我们利用了Mongoose内置的<strong class="kf ir"> <em class="mj"> connect </em> </strong>方法，并从环境变量传入了我们的mongodb连接URI。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/b3a7eb7811f003a274cdaad1bc578dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/0*Q2XFbdRF-LnsARpm"/></div></figure><p id="28d2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着我们的数据库连接的建立，我们可以转移到模型上。</p><h1 id="94c4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建模型</h1><p id="f2e8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在NoSQL环境中，每一条数据都存储在一个文档中。同一类型的多个文档一起存储在一个集合中。模型是一个类，它让我们与数据库中的特定集合进行交互。</p><p id="5619" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义一个模型也需要我们定义一个模式。我们的模式定义了文档的外观。尽管在NoSQL数据库中，文档模式是完全灵活的，但mongoose帮助我们保持数据更加一致。</p><p id="407a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们正在创建一个博客API，它需要有一个Post模型。我们的Post模型需要一个模式，其中包含可以添加到单个文档中的字段。对于这个例子，我们将保持简单，只有一个标题，内容和日期字段。</p><p id="e218" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，我们向我们的项目添加了一个名为<strong class="kf ir"> <em class="mj"> models </em> </strong>的新目录，并创建了一个名为<strong class="kf ir"> <em class="mj"> Post.js </em> </strong>的文件来存放我们的mongose<strong class="kf ir">模式</strong> &amp; <strong class="kf ir"> model </strong>。我们定义字段和它们对应的数据类型，然后根据我们概述的模式导出新创建的模型。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/cca563ea60fdd8461daa498f5a25270f.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/0*lvTT3cEjxqPN6Kxw"/></div></figure><h1 id="8627" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建控制器</h1><p id="ca38" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有了我们的模型集，我们现在可以继续控制器逻辑。谢天谢地，mongoose提供了大量的方法来简化我们的CRUD动作:</p><ul class=""><li id="13a6" class="ml mm iq kf b kg kh kk kl ko mn ks mo kw mp la mq mr ms mt bi translated">创建一个新帖子:<strong class="kf ir"> Post.create(data) </strong></li><li id="ac95" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">通过id查找帖子:<strong class="kf ir"> findById(id) </strong></li><li id="87fc" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">查找所有帖子:<strong class="kf ir"> find() </strong></li><li id="a01d" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">更新一个帖子:<strong class="kf ir"> findByIdAndUpdate(id，data) </strong></li><li id="8959" class="ml mm iq kf b kg mu kk mv ko mw ks mx kw my la mq mr ms mt bi translated">删除一个帖子:<strong class="kf ir"> findByIdAndDelete(id) </strong></li></ul><p id="24b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">创建</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a1a66377082c912ef32769a2db1aab1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/0*aiCm1XzGoT0J8NZ3"/></div></figure><p id="adb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">改为</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/2781c149132bc203521f1addc4d5bf0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/0*--EAl4xJd6-hd7AZ"/></div></figure><p id="ea04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">更新</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b82af16a9d9e7486a11f1f3c5bd22869.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/0*9HB-SnfIH1p8GAHx"/></div></figure><p id="9903" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">删除</strong></p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5951566d6643c512bfdfc3b8274884e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/0*B9cMDQ4x4gnMrux8"/></div></figure><p id="23c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成控制器逻辑后，我们可以继续定义路线。</p><h1 id="2fde" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">定义路线</h1><p id="5937" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">按照RESTful模式，我们将构建以下路线:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/38e8b13817d378a78cc83951833c826e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*LgspnMcyO7rzz0itNaJcgA.png"/></div></figure><p id="e3a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在新的<strong class="kf ir"> routes </strong>目录中，我们将创建一个<strong class="kf ir"> posts.routes.js </strong>文件，并设置Express router来处理上述路由，并将它们路由到适当的控制器动作。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/ec899426e8f45d7e4599e03578d5ffc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/0*w2QIiwo3TTHcCFOV"/></div></figure><p id="d70c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们导出我们的posts路由器，我们需要将它包含在我们的app.js文件中，并通过添加行:<strong class="kf ir"> app.use('/posts '，postRouter) </strong>将所有指向'/posts '的请求指向路由器</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5c6f074eb3ad6f2e98f04e3770fdfd17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/0*gEOJ8UmBE49fRFQL"/></div></figure><p id="b6b4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至此，我们的REST API就完成了！</p><p id="60b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">进一步阅读/文献:</strong></p><div class="ng nh gp gr ni nj"><a href="https://mongoosejs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">猫鼬</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">让我们面对现实吧，编写MongoDB验证、造型和业务逻辑样板文件是一件很麻烦的事情。这就是为什么我们写了…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">mongoosejs.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jw nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://expressjs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">Express - Node.js web应用程序框架</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">Express是一个最小且灵活的Node.js web应用程序框架，它为web和…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">expressjs.com</p></div></div><div class="ns l"><div class="ny l nu nv nw ns nx jw nj"/></div></div></a></div><div class="ng nh gp gr ni nj"><a href="https://docs.atlas.mongodb.com/getting-started/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">开始使用Atlas - MongoDB Atlas</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">MongoDB Atlas提供了一种在云中托管和管理数据的简单方法。本教程将指导您创建…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">docs.atlas.mongodb.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx jw nj"/></div></div></a></div></div></div>    
</body>
</html>