<html>
<head>
<title>How to Build a Wallet System with Flutterwave Payment Integration Into Node.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Flutterwave支付集成到Node.js应用程序中来构建钱包系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-a-wallet-system-with-flutterwave-payment-integration-into-nodejs-application-5c14350f4eab?source=collection_archive---------1-----------------------#2021-11-12">https://javascript.plainenglish.io/how-to-build-a-wallet-system-with-flutterwave-payment-integration-into-nodejs-application-5c14350f4eab?source=collection_archive---------1-----------------------#2021-11-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/443a30c1cb5b3ef643c5edfc6aa3056d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mi-sSI3rLsoFi9Ar"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@emkal?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Emil Kalibradov</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3851" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天，许多网站所有者想要在线支付网关，尤其是在行业飞速发展的情况下。为卫生部门、金融部门或其他部门设计应用程序时，创建钱包系统有点像噩梦。</p><p id="6afc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本教程中，我们将学习如何创建一个钱包系统，以及如何集成Flutterwave支付系统。</p><h1 id="cd56" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">先决条件</h1><p id="6af7" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">为了完成本教程，我们需要:</p><ul class=""><li id="46ac" class="mb mc in kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">JavaScript的工作知识。</li><li id="de6b" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">很好的理解Node.js。</li><li id="38d6" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">对MongoDB或我们选择的任何数据库有基本的了解。</li><li id="b9d8" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated"><a class="ae jz" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">邮差</a>以及一些如何使用邮差的知识。</li></ul><p id="5499" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要一个<a class="ae jz" href="https://dashboard.flutterwave.com/signup" rel="noopener ugc nofollow" target="_blank"> Flutterwave </a>账户来接收或接受我们应用程序的付款。</p><h1 id="d758" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">什么是钱包系统？</h1><p id="50f6" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated"><a class="ae jz" href="https://en.wikipedia.org/wiki/Digital_wallet" rel="noopener ugc nofollow" target="_blank">数字钱包</a>，通常被称为电子钱包，是一种电子设备、互联网服务或软件应用程序，允许一方与另一方交换数字货币单位以获得产品和服务。这可以包括利用电脑在线购买产品或使用智能手机在商店购买。</p><p id="d868" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在任何交易之前，钱可以存入数字钱包，或者在其他情况下，个人的银行账户可以链接到数字钱包。</p><h1 id="6d45" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">数字钱包有什么好处？</h1><ul class=""><li id="c368" class="mb mc in kc b kd lw kh lx kl mp kp mq kt mr kx mg mh mi mj bi translated">每次你想进行网上交易时，不必从鼓鼓囊囊的钱包里掏出你的卡，你只需拿着你的智能手机，登录你的账户，就可以开始了。</li><li id="5442" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">大多数应用程序允许你以一种容易获取的方式组织你所有的信息，节省你翻遍钱包寻找你需要的东西的时间。</li><li id="5ba8" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">许多数字钱包应用程序向用户提供各种奖金和奖品，这可能有助于你在特定交易中获得更多“物有所值”。</li></ul><h1 id="e863" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">什么是Flutterwave？</h1><p id="b7c3" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">从在线收款到支付，以及这两者之间的一切，<a class="ae jz" href="https://flutterwave.com" rel="noopener ugc nofollow" target="_blank"> Flutterwave </a>可以帮助您为您的特定用例开发任何形式的支付流程。</p><p id="1b91" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">他们还提供几项服务，让你在几分钟内就可以在世界各地转账和收款。</p><h1 id="9bef" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建目录，安装依赖项，并设置身份验证</h1><p id="db9f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">要开始，我们需要设置我们的项目。</p><p id="ea00" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过导航到我们在机器上选择的目录并在终端上打开它来打开Visual Studio代码。</p><p id="206d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后执行:</p><blockquote class="ms mt mu"><p id="21bb" class="ka kb mv kc b kd ke kf kg kh ki kj kk mw km kn ko mx kq kr ks my ku kv kw kx ig bi translated"><em class="in">注意:</em> <code class="fe mz na nb nc b"><em class="in">code .</em></code> <em class="in">如果我们的系统上没有安装Visual Studio代码就无法工作。</em></p></blockquote><h1 id="15ce" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建目录并初始化<code class="fe mz na nb nc b">npm.</code></h1><p id="a4a8" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通过键入以下命令创建目录并初始化npm:</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="d29d" class="nl kz in nc b gy nm nn l no np">mkdir wallet-demo-with-flutterwave cd wallet-demo-with-flutterwave npm init -y</span><span id="07c6" class="nl kz in nc b gy nq nn l no np">mkdir wallet-demo-with-flutterwave cd wallet-demo-with-flutterwave npm init -y</span></pre><h1 id="7a9c" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建文件和目录</h1><p id="d6a2" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在前面的步骤中，我们用命令“npm init -y”初始化了<code class="fe mz na nb nc b">npm</code>，这将自动创建一个package.json。</p><p id="9790" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要使用下面的命令创建模型、配置目录和文件，例如<code class="fe mz na nb nc b">wallet.js, wallet_transaction.js, transaction.js, database.js</code>。</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="614f" class="nl kz in nc b gy nm nn l no np">mkdir model config touch config/database.js model/wallet.js model/wallet_transaction.js model/transaction.js model/user.js</span></pre><p id="a637" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在可以用命令在项目的根目录下创建<code class="fe mz na nb nc b">index.js</code>和<code class="fe mz na nb nc b">app.js</code>文件。</p><p id="5718" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如下图所示:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a65b00a0d99315d414fc5febd4e53c4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/0*9CKNa1JZIZ9iGP4i"/></div></figure><h1 id="dddc" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">安装依赖项</h1><p id="c6fe" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们将安装几个像<code class="fe mz na nb nc b">mongoose, jsonwebtoken, express, dotenv, axios, bcryptjs,</code>这样的依赖项和像<code class="fe mz na nb nc b">nodemon</code>这样的开发依赖项，以便在我们自动进行更改时重启服务器。</p><p id="0386" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将安装mongoose，因为我将在本教程中使用MongoDB。</p><p id="ad7c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将根据我们数据库中的信息检查用户凭证。因此，整个认证过程并不局限于我们将在本教程中使用的数据库。</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="5742" class="nl kz in nc b gy nm nn l no np">npm install jsonwebtoken dotenv mongoose express bcryptjs npm install nodemon -D</span></pre><h1 id="97cb" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建Node.js服务器并连接数据库</h1><p id="2e1a" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">通过将以下代码片段添加到我们的app.js、index.js、database.js。按照这个顺序，我们现在可以创建Node.js服务器并将其连接到数据库。</p><p id="7e79" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的<code class="fe mz na nb nc b">database.js.</code></p><p id="cdba" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">config/database.js:</code></p><p id="2a8f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的app.js中:</p><p id="2f29" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">wallet-demo-with-flutterwave/app.js</code></p><p id="fef7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的index.js中:</p><p id="f707" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">wallet-demo-with-flutterwave/index.js</code></p><p id="fe59" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你注意到，我们的文件需要一些环境变量。我们将创建一个新的<code class="fe mz na nb nc b">.env</code>文件，并在启动应用程序之前添加变量。</p><p id="86ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的. env中。</p><p id="874d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要启动我们的服务器，请编辑package.json中的脚本对象，如下所示。</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="9e15" class="nl kz in nc b gy nm nn l no np">"scripts": { "start": "node index.js", "dev": "nodemon index.js", "test": "echo \"Error: no test specified\" &amp;&amp; exit 1" }</span></pre><p id="ffce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的代码片段已经成功地插入到<code class="fe mz na nb nc b">app.js, index.js, and database.js.</code>中。首先，我们在<code class="fe mz na nb nc b">index.js</code>中构建node.js服务器，并导入配置了路由的<code class="fe mz na nb nc b">app.js</code>文件。</p><p id="29ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，如<code class="fe mz na nb nc b">database.js,</code>所示，我们使用mongoose创建一个到数据库的连接。</p><p id="0c89" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">执行命令<code class="fe mz na nb nc b">npm run dev</code>。</p><p id="9cea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">服务器和数据库都应该正常运行，不会崩溃。</p><h1 id="a2b5" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">创建用户模型和路线</h1><p id="1fdd" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们将在第一次注册时为用户详细信息定义模式，并在登录时根据保存的凭证验证它们。</p><p id="af19" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将以下代码片段添加到模型文件夹内的user.js中。</p><p id="9dcc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">model/user.js</code></p><p id="b0a2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们分别为注册和登录创建路由。</p><p id="236f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">app.js</code>文件的根目录下，我们将添加下面的代码片段用于用户注册和登录。</p><h1 id="f597" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">实现注册和登录功能</h1><p id="4e86" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们将在应用程序中实现这两条路线。我们将使用JWT来签署凭证，并使用bycrypt来加密密码，然后将它们存储在我们的数据库中。</p><p id="f9b9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从/register路径，我们将:</p><ul class=""><li id="91b7" class="mb mc in kc b kd ke kh ki kl md kp me kt mf kx mg mh mi mj bi translated">获取用户输入。</li><li id="925c" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">验证用户输入。</li><li id="a49e" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">验证用户是否已经存在。</li><li id="2057" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">加密用户密码。</li><li id="782d" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">在我们的数据库中创建一个用户。</li><li id="d6e2" class="mb mc in kc b kd mk kh ml kl mm kp mn kt mo kx mg mh mi mj bi translated">最后，创建一个签名的JWT令牌。</li></ul><p id="47c9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">修改我们之前创建的/register路由结构，如下所示。</p><blockquote class="ms mt mu"><p id="cd57" class="ka kb mv kc b kd ke kf kg kh ki kj kk mw km kn ko mx kq kr ks my ku kv kw kx ig bi translated"><em class="in">注意:更新您的。env文件，它可以是一个随机字符串。</em></p></blockquote><p id="edd0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用Postman测试端点，在成功注册后，我们将得到如下所示的响应。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/859b2573e6b29ba90dff17b0e4be4583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GOxdSAOlnwPHW04y"/></div></div></figure><p id="a00c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击<a class="ae jz" href="https://www.section.io/engineering-education/how-to-build-authentication-api-with-jwt-token-in-nodejs/" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多关于如何在Node.js中使用JWT令牌构建认证API的信息</p><h1 id="ac3e" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建集成Flutterwave支付的钱包系统</h1><p id="aeab" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">现在，我们可以利用用户详细信息来创建钱包、保存钱包交易以及在系统中执行其他操作，因为我们已经在上一步中成功创建了用户收集和身份验证功能。</p><p id="5da2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们使用下面的代码更新我们的wallet.js、wallet_transaction和transaction。</p><p id="638f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mz na nb nc b">model/wallet.js</code> <code class="fe mz na nb nc b">model/wallet_transaction.js</code> <code class="fe mz na nb nc b">model/transaction.js</code></p><p id="523f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经创建了我们的钱包、钱包交易和交易模式，这意味着我们现在可以从客户端接收资金，在后端使用flutterwave验证支付，分别在钱包、钱包交易和交易集合中记录和更新支付细节。</p><p id="c64e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们让前端客户端准备好接受来自客户的付款。</p><p id="4ef3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用以下命令在我们的根目录下创建一个<code class="fe mz na nb nc b">index.html</code>文件。</p><p id="f056" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用下面的代码片段更新我们刚刚创建的<code class="fe mz na nb nc b">index.html</code>:</p><p id="599a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以从<a class="ae jz" href="https://developer.flutterwave.com/docs/flutterwave-inline" rel="noopener ugc nofollow" target="_blank"> Flutterwave文档</a>中了解更多关于上面片段的信息</p><p id="16f6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更新我们的<code class="fe mz na nb nc b">app.js</code>以从服务器端呈现<code class="fe mz na nb nc b">index.html</code>文件，我们将使用下面的代码片段:</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="a082" class="nl kz in nc b gy nm nn l no np">const path = require('path'); app.post("/login", async (req, res) =&gt; { } app.get("/pay", (req, res) =&gt; { res.sendFile(path.join(__dirname + "/index.html")); });</span></pre><p id="2a28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们测试我们的应用程序之前，我们会在我们之前创建的“index.html”中看到短语“YOUR_PUBLIC_KEY_HERE ”,这意味着我们需要一个来自我们的<a class="ae jz" href="https://dashboard.flutterwave.com/dashboard/settings/apis" rel="noopener ugc nofollow" target="_blank"> flutterwave仪表板</a>的公钥。让我们到仪表板上检索我们的公钥。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/55b9e2ab04606968ff596aedf589fe77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Lzgki1FRfPiz8vNb"/></div></div></figure><p id="3518" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们在浏览器上输入<code class="fe mz na nb nc b">http://localhost:4001/pay</code>来测试一下。单击<code class="fe mz na nb nc b">Pay Now</code>按钮后，我们应该会看到类似下面的内容:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/26dbacc21bd43f006dfbbe655172c12b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7Aa_vQnXKiiO9_UO"/></div></div></figure><p id="5f70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用测试卡号:<code class="fe mz na nb nc b">4242424242424242</code>，有效期:<code class="fe mz na nb nc b">04/25</code>，CVV: <code class="fe mz na nb nc b">202</code>。我们会被重定向到下面的页面进入OTP，是<code class="fe mz na nb nc b">12345</code>因为我们用的是测试卡。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/94462cf95a3d366f5cdc1e327a32dfa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7xXDpzbrXeneiLbe"/></div></div></figure><p id="cd37" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">进入OTP后，我们将被重定向到localhost:3000/response，但是什么也不会发生。让我们通过实现处理接下来发生的事情的逻辑来解决这个问题。</p><p id="b316" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建。<code class="fe mz na nb nc b">/response</code> endpoint，我们将使用下面的代码片段更新我们的app.js:</p><p id="04c3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们从上面代码中回调函数的查询参数中获取<code class="fe mz na nb nc b">transaction_id</code>，并通过向flutterwave端点发送请求来验证事务。我们应该会在日志中看到类似下面的截图。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/98edfc65e6fa32c86c65a2160ef021bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3nF_grTzWK35Cs_Y"/></div></div></figure><p id="76b0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们创建一个逻辑来管理诸如验证用户的钱包、创建钱包交易和交易等操作。</p><p id="9bec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的<code class="fe mz na nb nc b">app.js</code>中，让我们导入钱包、钱包交易和交易模型。</p><p id="5949" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用管理操作的逻辑更新app.js:</p><p id="269d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们现在可以用我们创建的管理不同操作的所有函数来更新<code class="fe mz na nb nc b">/response</code>端点。</p><p id="b293" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">瞧，🥳，我们差不多完成了，让我们测试一下我们的应用程序。完成付款后，我们应该得到类似于下面的内容:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/ba8125ec4d9565e1085410d722d1c899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6xYdBxHMpAs3Ajo_"/></div></div></figure><p id="25c2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为几次尝试，在试图资助我们钱包的同时，我们有了上面截图中的<code class="fe mz na nb nc b">10,000</code>余额；但是，如果仔细检查，这个数字可能会有所不同。</p><p id="9ed5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们用下面的代码片段创建一个端点来检索用户余额:</p><pre class="nd ne nf ng gt nh nc ni nj aw nk bi"><span id="e42d" class="nl kz in nc b gy nm nn l no np">app.get("/wallet/:userId/balance", async (req, res) =&gt; { try { const { userId } = req.params; const wallet = await Wallet.findOne({ userId }); res.status(200).json(wallet.balance); } catch (err) { console.log(err); } });</span></pre><p id="d9d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">测试我们返回用户余额的端点:</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/6aa77dfe490370fd01876a90c6a1a27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*COx_9iKX9AIhXIFl"/></div></div></figure><blockquote class="ms mt mu"><p id="72a1" class="ka kb mv kc b kd ke kf kg kh ki kj kk mw km kn ko mx kq kr ks my ku kv kw kx ig bi translated"><em class="in">注意:我们可能已经注意到，如果我们在重定向到“/response”端点后重新加载页面，我们的wallet中将更新相同金额的相同交易。为了防止这种情况，我们必须验证我们的系统中不存在这样的</em><code class="fe mz na nb nc b"><em class="in">transaction_id</em></code><em class="in">；否则，我们将收到重复交易错误。</em></p></blockquote><p id="cbde" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以修改我们的逻辑，如下所示:</p><p id="e54e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，当我们刷新页面时，我们应该会看到类似下面的截图。</p><figure class="nd ne nf ng gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/03b82546079caedd8bde7d6756386cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HOc9_F0BJ51u9-JE"/></div></div></figure><p id="fa88" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完整代码可从<a class="ae jz" href="https://github.com/Olanetsoft/wallet-demo-with-flutterwave" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得</p><h1 id="b51d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="7f6a" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在本文中，我们学习了如何在Node.js应用程序中构建一个简单的身份验证、钱包系统和Flutterwave支付集成</p><h1 id="461a" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">参考</h1><p id="398d" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我很乐意在<a class="ae jz" href="https://twitter.com/olanetsoft" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae jz" href="https://www.linkedin.com/in/olubisi-idris-ayinde-05727b17a/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae jz" href="https://github.com/Olanetsoft" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae jz" href="https://idrisolubisi.com/" rel="noopener ugc nofollow" target="_blank">Portfolio</a>与你联系</p><p id="4dc0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我的下一篇博客文章中再见。保重！！！</p></div><div class="ab cl ny nz hr oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="ig ih ii ij ik"><p id="2d39" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mv">最初发表于</em><a class="ae jz" href="https://blog.idrisolubisi.com/how-to-build-a-wallet-system-with-flutterwave-payment-integration-into-nodejs-application" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://blog.idrisolubisi.com</em></a><em class="mv">。</em></p><p id="fb2f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mv">更多内容看</em> <a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mv">说白了就是</em> </strong> </a> <em class="mv">。报名参加我们的</em> <a class="ae jz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mv">免费每周简讯</em> </strong> </a> <em class="mv">。在我们的</em> <a class="ae jz" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mv">社区不和谐</em> </strong> </a> <em class="mv">获得独家获取写作机会和建议。</em></p></div></div>    
</body>
</html>