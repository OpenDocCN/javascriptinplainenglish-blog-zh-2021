<html>
<head>
<title>How to Upload Files in Node.js using Multer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Multer上传Node.js中的文件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/uploading-files-in-node-js-using-multer-754526aa6817?source=collection_archive---------0-----------------------#2021-11-06">https://javascript.plainenglish.io/uploading-files-in-node-js-using-multer-754526aa6817?source=collection_archive---------0-----------------------#2021-11-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9a86d2f333db34ad07fb67e610910c5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gkQuAqB6mio5nuUqyee-AA.png"/></div></div></figure><p id="c719" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Node.js应用程序中，如果需要将文件上传到服务器，Multer是一个不错的选择。它可以在任何JavaScript后端使用。对于本文，我们将使用Express。</p><p id="644f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://www.npmjs.com/package/multer" rel="noopener ugc nofollow" target="_blank"> Multer </a>是一个Node.js中间件，用于处理<code class="fe ku kv kw kx b">multipart/form-data</code></p><h1 id="c34d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Multer的使用方法:</h1><p id="20a7" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">使用Multer有多种方式:</p><p id="fcbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">1.我们将文件直接上传到节点服务器(在服务器中)</p><p id="92ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.在数据库中保存文件数据或base64数据</p><p id="5a33" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.保存AWS S3存储桶以保存和管理文件(使用服务)</p><p id="b0bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文中，我们将把文件直接保存到服务器。</p></div><div class="ab cl mb mc hr md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ig ih ii ij ik"><h1 id="9b3a" class="ky kz in bd la lb mi ld le lf mj lh li lj mk ll lm ln ml lp lq lr mm lt lu lv bi translated">设置快速应用程序:</h1><p id="c584" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">→我们需要使用以下命令安装基本快速设置</p><pre class="mn mo mp mq gt mr kx ms mt aw mu bi"><span id="aff2" class="mv kz in kx b gy mw mx l my mz">express &lt;your_app_name&gt; --view=ejs</span></pre><p id="f571" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→在express根目录下运行以下命令安装Multer:</p><pre class="mn mo mp mq gt mr kx ms mt aw mu bi"><span id="5091" class="mv kz in kx b gy mw mx l my mz">npm i multer</span></pre><p id="6736" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">步骤1:创建路线:</p><p id="d965" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以上传单个文件以及多个文件。</p><pre class="mn mo mp mq gt mr kx ms mt aw mu bi"><span id="5de6" class="mv kz in kx b gy mw mx l my mz">var express = require("express");<br/>var router = express.Router();</span><span id="6b8b" class="mv kz in kx b gy na mx l my mz">const upload = require("../common");</span><span id="5831" class="mv kz in kx b gy na mx l my mz">/* GET home page. */<br/>router.get("/", function (req, res, next) {<br/>  res.render("index", { title: "Express" });<br/>});</span><span id="554f" class="mv kz in kx b gy na mx l my mz">// Single file Upload - image key should be passed postman</span><span id="20ac" class="mv kz in kx b gy na mx l my mz">router.post("/single", upload.single("image"), (req, res, next) =&gt; {<br/>  console.log(req.file);  // UPLOADED FILE DESCRIPTION RECEIVED<br/>  res.send("uploaded successfully");<br/>});</span><span id="274d" class="mv kz in kx b gy na mx l my mz">// Multiple files Upload - images key should be passed in postman</span><span id="a837" class="mv kz in kx b gy na mx l my mz">router.post("/multiple", upload.array("images"), (req, res) =&gt; {<br/>  console.log(req.files); // UPLOADED FILE DESCRIPTION RECEIVED<br/>  res.send({<br/>    status: "success",<br/>    message: "Files uploaded successfully",<br/>    data: req.files,<br/>  });<br/>});</span><span id="f470" class="mv kz in kx b gy na mx l my mz">module.exports = router;</span></pre><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/662de142e324495e93c3ffe8ca9bea70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2Srij5Se0gMQq9A2NFE3w.png"/></div></div></figure><p id="e60c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> common.js(处理上传功能)</strong></p><p id="d0fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→这里我们写上传文件的逻辑</p><pre class="mn mo mp mq gt mr kx ms mt aw mu bi"><span id="b236" class="mv kz in kx b gy mw mx l my mz">const multer = require("multer");<br/>var fs = require("fs");</span><span id="b709" class="mv kz in kx b gy na mx l my mz">var dir = "./public/images/nov";   // PATH TO UPLOAD FILE<br/>if (!fs.existsSync(dir)) {  // CREATE DIRECTORY IF NOT FOUND<br/>  fs.mkdirSync(dir, { recursive: true });<br/>}</span><span id="ecf5" class="mv kz in kx b gy na mx l my mz">const fileStorageEngine = multer.diskStorage({<br/>  destination: (req, file, cb) =&gt; {<br/>    cb(null, dir);<br/>  },<br/>  filename: (req, file, cb) =&gt; {<br/>    cb(null, Date.now() + "-" + file.originalname);<br/>  },<br/>});</span><span id="06c1" class="mv kz in kx b gy na mx l my mz">const upload = multer({ storage: fileStorageEngine });</span><span id="2822" class="mv kz in kx b gy na mx l my mz">module.exports = upload;</span></pre><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/90ad2fa26d9b009eb97cbadc57c0f35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HnoI87DktRv1iBVsGgIjxA.png"/></div></div></figure><p id="6b1f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→使用以下命令运行节点服务器</p><pre class="mn mo mp mq gt mr kx ms mt aw mu bi"><span id="df43" class="mv kz in kx b gy mw mx l my mz">npm start</span></pre><p id="c902" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→我们将使用Postman导入文件。你可以按照下面的截图和视频为邮递员</p><blockquote class="nc nd ne"><p id="c8ce" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">路线:<a class="ae kt" href="http://localhost:5000/single" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/single</a></p><p id="f16e" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">类型:邮政</p><p id="a7f2" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">正文:表单数据，选择关键字作为类型文件的图像</p></blockquote><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/ed32466f0fa39d9f988e43bf9ac1d80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TE1hCyAdlsYw9RY4a46C3g.png"/></div></div></figure><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/14cc9d4170b212778cee357d909e28c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFD83w4gM4AD36QQk3Z_uQ.png"/></div></div></figure><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/9c5b4ede20560c48fbc1c4c328ab06e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPldIHf7JBhxaFoTtHJqXg.png"/></div></div></figure><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/aa8138b185fa048baf3cce12fc172603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FdFgqDCrbO3BtIyz6cnh8Q.png"/></div></div></figure><p id="97c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→我们得到保存文件的文件名和路径。现在让我们转到代码库中的以下路径。</p><p id="bc3b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→我们已成功上传文件</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/1c1b9f19582f2a56ac818890a53fc9e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0F71u_FHreeir-cxMnhe4Q.png"/></div></div></figure><p id="3d97" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→现在让我们使用第二条路线进行<strong class="jx io">多次上传</strong>:</p><blockquote class="nc nd ne"><p id="45bd" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">路由:<a class="ae kt" href="http://localhost:5000/single" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/m</a>multiple</p><p id="be53" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">类型:邮政</p><p id="5a11" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">Body: form-data，选择键作为类型文件的<strong class="jx io">图像</strong></p></blockquote><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/1aecfb24aab1f8f0472aa559cb76f74e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eQ_5MUBHf73dxipmZGBxfw.png"/></div></div></figure><p id="303a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→我们得到一个带有文件名和路径的图像数组</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/6061ff37311c4618800a67ffbd90592d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fudyAzuHBAuuAR4Pm-xUHA.png"/></div></div></figure><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nl"><img src="../Images/9a1bce7d5c39df7f55935e2662858892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O1PmXtr5Wn65kTXhgFWwTg.png"/></div></div></figure><p id="b8ba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">→让我们检查代码库中的文件</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/00a6169937fe79f5a8fe10474889da10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*03w4RbTE-DcsW-yQsK3fTg.png"/></div></div></figure><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/da315f929472d814bb0e321d80b661b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phZwt5I3P2OqIthl8PmVyw.png"/></div></div></figure><h1 id="487d" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">视频:</h1><p id="fc31" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated"><a class="ae kt" href="https://secure.vidyard.com/organizations/1904214/players/EkWR8TTLuNCPL6vnsV6hTU?edit=true&amp;npsRecordControl=1" rel="noopener ugc nofollow" target="_blank">https://secure . vid yard . com/organizations/1904 214/players/QR 56 rbg 9 fmt qb1 sretx 2 ut？edit = true&amp;npsRecordControl = 1</a></p><h1 id="1bde" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">存储库:</h1><p id="f353" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated"><a class="ae kt" href="https://github.com/AmirMustafa/upload_file_nodejs" rel="noopener ugc nofollow" target="_blank">https://github.com/AmirMustafa/export-to-excel</a></p><h1 id="faf4" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结束语:</h1><p id="0de7" class="pw-post-body-paragraph jv jw in jx b jy lw ka kb kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks ig bi translated">我们已经学习了如何在Node.js中直接上传文件。我们还可以在AWS S3存储桶中上传文件，以及在数据库中上传base 64数据。</p><blockquote class="nc nd ne"><p id="3041" class="jv jw nf jx b jy jz ka kb kc kd ke kf ng kh ki kj nh kl km kn ni kp kq kr ks ig bi translated">谢谢你一直坚持到最后🙌。如果你喜欢这篇文章或者学到了新的东西，请点击下面的分享按钮来支持我，让更多的人了解我和/或在<a class="ae kt" href="https://twitter.com/amir__mustafa" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，看看我在那里学到和分享的其他技巧、文章和东西。</p></blockquote><div class="no np gp gr nq nr"><a href="https://twitter.com/amir__mustafa" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd io gy z fp nw fr fs nx fu fw im bi translated">关注Amir Mustafa的JavaScript、TypeScript和AWS内容。</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">twitter.com</h3></div></div><div class="nz l"><div class="oa l ob oc od nz oe jt nr"/></div></div></a></div><p id="66e9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nf">更多内容尽在</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nf">plain English . io</em></strong></a></p></div></div>    
</body>
</html>