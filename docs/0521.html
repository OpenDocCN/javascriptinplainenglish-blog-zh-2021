<html>
<head>
<title>Vue Konva — Animation and Caching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue Konva —动画和缓存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vue-konva-animation-and-caching-222caacf2a53?source=collection_archive---------13-----------------------#2021-01-31">https://javascript.plainenglish.io/vue-konva-animation-and-caching-222caacf2a53?source=collection_archive---------13-----------------------#2021-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c9b385af224386453139c268daa32829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Db5jBP-bWgzstvQ0"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@yogidan2012?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniele Levis Pelusi</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="acaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">借助Vue Konva库，我们可以在Vue应用程序中更轻松地使用HTML画布。</p><p id="f6bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Vue Konva来简化Vue应用程序中的HTML画布。</p><h1 id="41a6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">动画</h1><p id="10e0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">Konva.Animation</code>构造函数制作形状的动画。</p><p id="c792" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d932" class="mq lc iq mh b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;v-stage ref="stage" :config="stageSize"&gt;<br/>    &lt;v-layer ref="layer"&gt;<br/>      &lt;v-rect<br/>        ref="rect"<br/>        @dragstart="changeSize"<br/>        @dragend="changeSize"<br/>        :config="{<br/>          width: 50,<br/>          height: 50,<br/>          fill: 'green',<br/>          draggable: true,<br/>        }"<br/>      /&gt;<br/>      &lt;v-regular-polygon<br/>        ref="octagon"<br/>        :config="{<br/>          x: 200,<br/>          y: 200,<br/>          sides: 8,<br/>          radius: 20,<br/>          fill: 'red',<br/>          stroke: 'black',<br/>          strokeWidth: 4,<br/>        }"<br/>      /&gt;<br/>    &lt;/v-layer&gt;<br/>  &lt;/v-stage&gt;<br/>&lt;/template&gt;</span><span id="b0c4" class="mq lc iq mh b gy mv ms l mt mu">&lt;script&gt;<br/>import Konva from "konva";<br/>const width = window.innerWidth;<br/>const height = window.innerHeight;</span><span id="c4a8" class="mq lc iq mh b gy mv ms l mt mu">export default {<br/>  data() {<br/>    return {<br/>      stageSize: {<br/>        width: width,<br/>        height: height,<br/>      },<br/>    };<br/>  },<br/>  methods: {<br/>    changeSize(e) {<br/>      e.target.to({<br/>        scaleX: Math.random() + 0.8,<br/>        scaleY: Math.random() + 0.8,<br/>        duration: 0.2,<br/>      });<br/>    },<br/>  },<br/>  mounted() {<br/>    const vm = this;<br/>    const amplitude = 100;<br/>    const period = 5000;<br/>    const centerX = vm.$refs.stage.getNode().getWidth() / 2;<br/>    const octagon = this.$refs.octagon.getNode();<br/>    const anim = new Konva.Animation((frame) =&gt; {<br/>      octagon.setX(<br/>        amplitude * Math.sin((frame.time * 2 * Math.PI) / period) + centerX<br/>      );<br/>    }, octagon.getLayer());<br/>    anim.start();<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="6dfa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用回调函数调用<code class="fe me mf mg mh b">Konva.Animation</code>构造函数来改变带有<code class="fe me mf mg mh b">setX</code>的项目的x坐标。</p><p id="0092" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">anim.start</code>开始动画。</p><p id="e349" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们拖动矩形时会调用<code class="fe me mf mg mh b">changeSize</code>方法。</p><p id="5a22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们拖动对象时，它会改变位置。</p><h1 id="1f78" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">隐藏物</h1><p id="740f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以缓存用<code class="fe me mf mg mh b">cache</code>方法渲染的项目。</p><p id="b148" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6490" class="mq lc iq mh b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;v-stage ref="stage" :config="stageConfig"&gt;<br/>      &lt;v-layer ref="layer"&gt;<br/>        &lt;v-group ref="group"&gt;<br/>          &lt;v-star<br/>            v-for="item in list"<br/>            :key="item.id"<br/>            :config="{<br/>              x: item.x,<br/>              y: item.y,<br/>              rotation: item.rotation,<br/>              id: item.id,<br/>              numPoints: 5,<br/>              innerRadius: 30,<br/>              outerRadius: 50,<br/>              fill: 'lightgreen',<br/>              opacity: 0.8,<br/>              shadowColor: 'black',<br/>              shadowBlur: 10,<br/>              shadowOpacity: 0.6,<br/>              scaleX: item.scale,<br/>              scaleY: item.scale,<br/>            }"<br/>          /&gt;<br/>        &lt;/v-group&gt;<br/>      &lt;/v-layer&gt;<br/>    &lt;/v-stage&gt;<br/>    &lt;div class="cache"&gt;<br/>      &lt;input type="checkbox" @change="handleCacheChange" /&gt; cache shapes<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="4dd3" class="mq lc iq mh b gy mv ms l mt mu">&lt;script&gt;<br/>const width = window.innerWidth;<br/>const height = window.innerHeight;<br/>export default {<br/>  data() {<br/>    return {<br/>      list: [],<br/>      dragItemId: null,<br/>      stageConfig: {<br/>        width: width,<br/>        height: height,<br/>        draggable: true,<br/>      },<br/>    };<br/>  },<br/>  methods: {<br/>    handleCacheChange(e) {<br/>      const shouldCache = e.target.checked;<br/>      if (shouldCache) {<br/>        this.$refs.group.getNode().cache();<br/>      } else {<br/>        this.$refs.group.getNode().clearCache();<br/>      }<br/>    },<br/>  },<br/>  mounted() {<br/>    for (let n = 0; n &lt; 300; n++) {<br/>      this.list.push({<br/>        id: n.toString(),<br/>        x: Math.random() * width,<br/>        y: Math.random() * height,<br/>        rotation: Math.random() * 180,<br/>        scale: Math.random(),<br/>      });<br/>    }<br/>  },<br/>};<br/>&lt;/script&gt;</span><span id="f367" class="mq lc iq mh b gy mv ms l mt mu">&lt;style&gt;<br/>body {<br/>  margin: 0;<br/>  padding: 0;<br/>}</span><span id="63b3" class="mq lc iq mh b gy mv ms l mt mu">.cache {<br/>  position: absolute;<br/>  top: 0;<br/>  left: 0;<br/>}<br/>&lt;/style&gt;</span></pre><p id="4972" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">增加300颗星星。</p><p id="5b67" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">handleCacheChange</code>方法中，如果复选框被选中，我们调用<code class="fe me mf mg mh b">v-group</code>的ref上的<code class="fe me mf mg mh b">cache</code>来缓存内容。</p><p id="415c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们用<code class="fe me mf mg mh b">clearCache</code>清除缓存。</p><h1 id="cbdf" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="0f48" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Vue Konva制作形状动画并缓存它们。</p></div></div>    
</body>
</html>