# 如何在你的代码中应用单一责任原则

> 原文：<https://javascript.plainenglish.io/how-to-apply-the-single-responsibility-principle-in-your-code-3d674cb4d895?source=collection_archive---------13----------------------->

## 单一责任原则(SRP)及其在 Angular

![](img/797374e5fb1f068547f6c9c09ef4521f.png)

Photo by [Thomas Park](https://unsplash.com/@thomascpark?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

你有没有遇到过这样一个类或方法，它有太多的东西让你感到头晕？

单一责任原则(SRP)是一种最佳实践方法，它规定一个函数、方法或类应该有一个主要的特定目的。

拥有有很多用途的类或函数会使你的代码难以阅读、理解、难以跟踪错误，并且难以长期维护。

创建更小的类、函数或模块来满足特定的目的将会产生更健壮、更易维护的代码。此外，您的代码变得更容易进行单元测试。

在本指南中，我们将了解如何通过将一个有多种用途的组件文件重构为一个有特定用途的文件来编写满足单一责任原则的代码。

# 个案研究

下面的代码是一个 ***的反面例子。*** 组件代码定义 AppComponent，启动 app，定义英雄模型对象，从服务器加载英雄，有货币转换功能都在同一个文件里。更糟糕的是，它包含 HTML 模板代码*。*

下面的反例改编自《Angular style guide》，你可以在这里找到原代码[。](https://angular.io/guide/styleguide)

# 重构代码

上面的组件代码显然有很多工作要做。如果有人看到这些代码，他们会感到有点不知所措。但是如果我们把它分解成更小的部分，从长远来看，它将提高可读性和可维护性。

我们的目标是创建有一个主要目的的类，并且擅长它们执行的功能。

我们将在下面概述的五个主要步骤中重构代码。

# 1.将模板代码与组件分开

为了改进上面组件中的代码，我们首先必须通过创建一个名为***app . component***的文件，将模板代码移除到它自己的文件中。 ***html*** 模板文件的代码如下所示。

如您所见，模板代码目前只有两行代码，如果这段代码中有任何错误的话。找出哪里出了问题肯定会非常容易。

# 2.创建一个专用的模型类

负组件类也为英雄定义了一个模型。不幸的是，这种模型可能会在很多地方被使用，例如在管道或服务中。因此，最好将它放在一个单独的模型类中。

万一模型改变了，你就能准确地知道在哪里进行调整，而不会篡改其他类。我们的模型类如下所示。

# 3.将服务用于共享业务逻辑

在 Angular 中，我们倾向于为业务逻辑使用一种服务，这种服务必然会在应用程序的几个组件中共享。一个典型的例子是从服务器获取数据。

在反面示例组件中，组件代码中有一个从服务器获取数据的函数。

我们将创建一个单独的 Angular 服务，它的唯一目的是从服务器获取英雄列表，而不是这样做。

英雄以数组的形式返回，如下所示:

```
const HEROES: Hero[] = [
  { id: 1, name: 'Bombasto', earnings:34},
  { id: 2, name: 'Tornado', earnings:43},
  { id: 3, name: 'Magneta', earnings:33 }
];
```

该服务将被命名为 ***hero.service.ts*** ，如下所示。我们甚至删除了之前存在的不必要的注释，因为代码很容易理解。

# 4.使用管道进行格式化

我包括了一个荒谬的货币转换函数，但它只是为了强调一点。模板中需要快速转换或格式化的东西最好放在管道中。管道非常擅长快速数据转换。

我们将进一步重构组件代码，删除货币转换函数，并将它放在一个专用的管道类中。

同样，从下面的代码中可以看出。管道有一个主要用途:兑换货币。具体来说，从美元到挪威克朗。

现在可以在应用程序模板的任何地方使用这个管道，方法是如下调用它。

```
<div> {{earnings | currencyConverter}} </div>
```

# 5.创建一个专用模块

我们现在将为组件文件中的模块逻辑创建一个专用的模块文件。

有了 Angular，你应该瞄准模块化应用。为了实现这一点，Angular 使用了一个名为 NgModules 的模块化系统。对于大型应用程序，每个特定的特性都应该放在自己的模块中。

对于模块化应用程序，您还可以利用延迟加载来实现更快的应用程序加载时间。想了解更多 Angular 中的懒加载，可以看一下 [Sai gowtham](https://medium.com/u/5bcfd37b5075?source=post_page-----3d674cb4d895--------------------------------) [的一篇文章这里](https://codeburst.io/how-to-implement-lazy-loading-in-angular-bb2a670b34d)。

在这种情况下，App 模块的主要目的是引导应用程序。它也恰好是整个应用程序的根模块。我们的专用模块类代码如下。

# 重构的组件

现在我们已经重构了组件，这就是最终产品的样子。我们从大约 53 行代码减少到大约 18 行。有了这样几行代码，就更容易理解组件代码中发生了什么。

该组件的主要功能是订阅英雄列表，并将其显示在相应的模板文件中。重构后的组件如下所示。

# 最后的想法

在本指南中，我们从一个巨大的组件开始，它正在做大量的事情，并使用单一责任原则(SRP)作为我们的指南，将其重构为一个具有特定用途的组件。

创建可读的、可维护的代码需要做很多工作，但是应用单一责任原则将对实现可靠的代码大有帮助。