<html>
<head>
<title>How to Capture the Content of an HTML Canvas as an Image File?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将HTML画布的内容捕获为图像文件？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-capture-the-content-of-an-html-canvas-as-an-image-file-d753712bb056?source=collection_archive---------8-----------------------#2021-11-26">https://javascript.plainenglish.io/how-to-capture-the-content-of-an-html-canvas-as-an-image-file-d753712bb056?source=collection_archive---------8-----------------------#2021-11-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/35a5c8bd494fac3d676ef399ee94fcf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iLObRv1UPgFX6nzr"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jxk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jan Kopřiva</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4366" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能希望将HTML画布的内容捕获为图像文件。</p><p id="0ce3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用JavaScript实现这一点。</p><h1 id="e62e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">捕捉画布</h1><p id="e593" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过使用canvas元素对象附带的<code class="fe me mf mg mh b">toDataURL</code>方法来捕获画布。</p><p id="13fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以编写以下HTML:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="e634" class="mq lc iq mh b gy mr ms l mt mu">&lt;canvas&gt;&lt;/canvas&gt;</span></pre><p id="66cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以编写以下JavaScript来绘制一些内容，并将其捕获为图像文件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8f75" class="mq lc iq mh b gy mr ms l mt mu">const canvas = document.querySelector("canvas");<br/>const context = canvas.getContext("2d");<br/>context.fillStyle = "lightblue";<br/>context.fillRect(50, 50, 100, 100);<br/>window.location = canvas.toDataURL("image/png");</span></pre><p id="0c5a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">querySelector</code>得到画布元素。</p><p id="be4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">getContext</code>得到画布的上下文。</p><p id="33d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">fillStyle</code>设置填充样式。</p><p id="bbf0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">fillRect</code>画一个长方形。</p><p id="1114" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们只需在画布上调用我们想要生成的MIME类型文件的<code class="fe me mf mg mh b">toDataURL</code>来捕获画布，并将其转换为base64字符串。</p><h1 id="c37a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将画布捕捉到PDF</h1><p id="4fcd" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要捕获画布并将其转换为PDF，我们可以使用jaPDF库。</p><p id="2bc7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使用它，我们编写以下HTML:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="80bc" class="mq lc iq mh b gy mr ms l mt mu">&lt;script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"&gt;&lt;/script&gt;<br/>&lt;canvas&gt;&lt;/canvas&gt;</span></pre><p id="aab2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下代码添加JavaScript代码来进行捕获:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="ced2" class="mq lc iq mh b gy mr ms l mt mu">const { jsPDF } = window.jspdf;<br/>const canvas = document.querySelector("canvas");<br/>const context = canvas.getContext("2d");<br/>context.fillStyle = "lightblue";<br/>context.fillRect(50, 50, 100, 100);<br/>const imgData = canvas.toDataURL("image/png");<br/>const doc = new jsPDF('p', 'mm');<br/>doc.addImage(imgData, 'PNG', 10, 10);<br/>doc.save('sample.pdf');</span></pre><p id="cedf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们从脚本标签添加的<code class="fe me mf mg mh b">jspdf</code>全局变量中获取<code class="fe me mf mg mh b">jsPDF</code>对象。</p><p id="55d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后接下来的4行和前面的例子一样。</p><p id="2864" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">canvs.toDataURL</code>并将返回的base64字符串赋给<code class="fe me mf mg mh b">imgData</code>。</p><p id="d6f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们用<code class="fe me mf mg mh b">jsPDF</code>构造函数创建一个新的jsPDF文档对象。</p><p id="84a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是文档的方向。<code class="fe me mf mg mh b">p</code>表示门。</p><p id="9c8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是单位，<code class="fe me mf mg mh b">mm</code>是毫米。</p><p id="4897" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">imgData</code>调用<code class="fe me mf mg mh b">addImage</code>将图像添加到我们的文档中。</p><p id="76dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个参数是格式。</p><p id="9890" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第三和第四个参数是图像相对于页面上边缘的x和y坐标。</p><p id="cfce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用文件名和扩展名调用<code class="fe me mf mg mh b">doc.save</code>来保存PDF。</p><h1 id="4b2b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b26e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">toDataURL</code>方法将画布的内容捕捉到图像中。</p><p id="c135" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用jsPDF库把图像放入PDF中。</p></div></div>    
</body>
</html>