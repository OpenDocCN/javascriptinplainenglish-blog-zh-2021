<html>
<head>
<title>This JavaScript Debugging Technique Can Save You Hours Of Effort</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">这种JavaScript调试技术可以节省您数小时的精力</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/js-debugging-technique-proxy-17c707518b7a?source=collection_archive---------14-----------------------#2021-08-02">https://javascript.plainenglish.io/js-debugging-technique-proxy-17c707518b7a?source=collection_archive---------14-----------------------#2021-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="3879" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">使用代理用JavaScript监视对象值的变化。</h2><div class=""/><div class=""><h2 id="5d17" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">使用JavaScript代理对象观察代码中的对象变化。</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/68e11327a1de6a3465c39cd3e6bfd79f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Wf-Dq1aAlxIYj1rNfojUA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@heylagostechie?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Techie</a> on <a class="ae lb" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="efba" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">JavaScript开发人员职业生涯中最令人麻木的任务之一就是调试全局变量的变化。当你调试别人的代码时，这变得更加困难。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><p id="9a8b" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">在我们进入正题之前，让我给你描述一下:假设你正在使用一个非常老的代码库。随着时间的推移，许多开发人员为此做出了贡献。因为每个人都有不同的编码风格，所以不再遵循特定的编码模式/风格。因为这是古老的代码，所有的关键变量都暴露在窗口对象中。不同的模块可以访问和操作变量，您无法知道全局变量是如何或何时被更改的。</p><p id="53b9" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">不久前，我也遇到过同样的情况——旧代码，大量的全局变量，无法知道谁在改变一个全局对象的值。在调试过程中花了几个小时后，我在MDN上的JavaScript代理对象上发现了这一点。根据MDN:</p><blockquote class="mf mg mh"><p id="2e9a" class="lc ld mi le b lf lg jx lh li lj ka lk mj lm ln lo mk lq lr ls ml lu lv lw lx ig bi translated"><code class="fe mm mn mo mp b">Proxy</code>对象使您能够为另一个对象创建一个代理，它可以截取并重新定义该对象的基本操作。</p></blockquote><p id="886a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">基本上，您可以用定制的对象方法创建目标对象的副本。让我们快速看一下如何创建代理对象:</p><h2 id="f945" class="mq mr in bd ms mt mu dn mv mw mx dp my ll mz na nb lp nc nd ne lt nf ng nh it bi translated">如何使用代理:</h2><p id="9532" class="pw-post-body-paragraph lc ld in le b lf ni jx lh li nj ka lk ll nk ln lo lp nl lr ls lt nm lv lw lx ig bi translated">您需要创建一个<code class="fe mm mn mo mp b">Proxy</code>类的新实例来制作一个对象的代理。<code class="fe mm mn mo mp b">Proxy</code>有两个参数:一个<code class="fe mm mn mo mp b">target</code>和一个<code class="fe mm mn mo mp b">handler</code>。让我们看一个例子:</p><p id="4aea" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">假设您有一个对象<code class="fe mm mn mo mp b">obj</code>，并且您想要创建一个代理:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nn"><img src="../Images/7837826354b4bcf7c9682d3f40713289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T--XvUHFEe8qu5N6z7V4yQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">creating proxy of obj</figcaption></figure><p id="7798" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这里，<code class="fe mm mn mo mp b">objProxy</code>是对象<code class="fe mm mn mo mp b">obj</code>的代理。我们向代理传递了两个参数，第一个是<code class="fe mm mn mo mp b">target</code>对象(您想要为其创建代理的对象)，第二个对象传递定制的处理程序。在这个例子中，我将它保持为空。我将在下一个例子中解释如何使用这个对象。从这个例子中得到的主要信息是<code class="fe mm mn mo mp b">proxyObj</code>已经得到了<code class="fe mm mn mo mp b">obj</code>的所有条目。</p><h2 id="8a37" class="mq mr in bd ms mt mu dn mv mw mx dp my ll mz na nb lp nc nd ne lt nf ng nh it bi translated">如何向代理添加定制的处理程序:</h2><p id="496f" class="pw-post-body-paragraph lc ld in le b lf ni jx lh li nj ka lk ll nk ln lo lp nl lr ls lt nm lv lw lx ig bi translated">现在我们知道了如何创建代理，让我们看看如何向代理对象添加定制的处理程序:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi no"><img src="../Images/27ed3a776e630d048addc1a25de026ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lz5nQE2gnZv1DMlLm_MguQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">setting custom handler `set` to proxyObj.</figcaption></figure><p id="a323" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在我们将自定义的<code class="fe mm mn mo mp b">set</code>作为键传递给<code class="fe mm mn mo mp b">handler</code>参数。您也可以将其他对象方法传递给该对象。我用<code class="fe mm mn mo mp b">set</code>是因为它与这篇文章更相关。<code class="fe mm mn mo mp b">set</code>函数接受三个参数:<code class="fe mm mn mo mp b">target</code>(同一个目标对象)、<code class="fe mm mn mo mp b">key</code>(要更新的键)、<code class="fe mm mn mo mp b">value</code>(键的新值)。在函数内部，我只是安慰所有三个参数。现在，当您修改或添加一个新键到<code class="fe mm mn mo mp b">objProxy</code>对象时，自定义的<code class="fe mm mn mo mp b">set</code>函数将被触发。您将在浏览器中看到一个控制台值。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="8241" class="mq mr in bd ms mt mu dn mv mw mx dp my ll mz na nb lp nc nd ne lt nf ng nh it bi translated">如何使用代理对象观察对象变化？</h2><p id="5ac7" class="pw-post-body-paragraph lc ld in le b lf ni jx lh li nj ka lk ll nk ln lo lp nl lr ls lt nm lv lw lx ig bi translated">到目前为止，我们已经向proxyObj添加了一个自定义的set函数。这将控制浏览器中的新值。但是这如何帮助我们监控目标对象的变化呢？现在是时候让我们来看看最棘手的部分了:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi np"><img src="../Images/7f4eca899c0b5f8f7b3a0922dedfa6c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVOH6swDWkkKuGwirmZ7sA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">assigning proxy object to the target object.</figcaption></figure><p id="4105" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">注意截图中的第15行。我们将<code class="fe mm mn mo mp b">proxyObj</code>分配给实际的<code class="fe mm mn mo mp b">obj</code>。现在<code class="fe mm mn mo mp b">obj</code>有了和以前一样的值(因为<code class="fe mm mn mo mp b">proxyObj</code>是<code class="fe mm mn mo mp b">obj</code>的克隆版),另外，它还有一个自定义的<code class="fe mm mn mo mp b">set</code>函数，当我们改变obj中的值时，它会控制这些值。这样，我们可以监听<code class="fe mm mn mo mp b">obj</code>中的任何变化。如果我们用一个<code class="fe mm mn mo mp b">debugger</code>替换<code class="fe mm mn mo mp b">console</code>，我们就可以停止执行，并回溯到发生变化的确切位置。以下是相同的截图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/77489527b3d85fed9b26bed7d3d73d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_7VNznC_wcvi1aXPujxYg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">add a debugger to stop the execution.</figcaption></figure><p id="42a9" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">现在，如果对象太大并且频繁更改，那么您也可以有条件地添加调试器:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/8a18a6d9643513670b55bd09893fa3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50Jr50jBOZyK3NsDgGFb7g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">add conditional debugger.</figcaption></figure><p id="273d" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这样，您就不必多次切换脚本执行。</p><p id="dde7" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">以下是要点的链接:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="ns nt l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">copy the code from this gist.</figcaption></figure></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="07c5" class="mq mr in bd ms mt mu dn mv mw mx dp my ll mz na nb lp nc nd ne lt nf ng nh it bi translated">参考链接:</h2><div class="nu nv gp gr nw nx"><a href="https://tc39.es/ecma262/multipage/reflection.html#sec-proxy-objects" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ix gy z fp oc fr fs od fu fw iw bi translated">ECMAScript 2022语言规范</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">编辑描述</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">tc39.es</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kv nx"/></div></div></a></div><div class="nu nv gp gr nw nx"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ix gy z fp oc fr fs od fu fw iw bi translated">代理- JavaScript | MDN</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">代理对象使您能够为另一个对象创建代理，它可以截取和重新定义基本的…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">developer.mozilla.org</p></div></div><div class="og l"><div class="om l oi oj ok og ol kv nx"/></div></div></a></div></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h1 id="f165" class="on mr in bd ms oo op oq mv or os ot my kc ou kd nb kf ov kg ne ki ow kj nh ox bi translated">关于作者</h1><p id="4f49" class="pw-post-body-paragraph lc ld in le b lf ni jx lh li nj ka lk ll nk ln lo lp nl lr ls lt nm lv lw lx ig bi translated">Bharat自2011年以来一直是前端开发人员。他对“前端开发经验”情有独钟。他喜欢学习和教授技术。他和最可爱的女人以及珍贵的双胞胎孩子一起享受生活。</p><p id="57a8" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">总的来说是个好人。在<a class="ae lb" href="https://twitter.com/iiisoni" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae lb" href="https://github.com/iiison" rel="noopener ugc nofollow" target="_blank"> Github </a>、<a class="ae lb" href="https://www.linkedin.com/in/iiison/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到他。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oy nt l"/></div></figure><p id="01eb" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="mi">更多内容看</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="le ix"><em class="mi">plain English . io</em></strong></a></p></div></div>    
</body>
</html>