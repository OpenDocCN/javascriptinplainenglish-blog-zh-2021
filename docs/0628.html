<html>
<head>
<title>API Server Setup with Express.js and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express.js和TypeScript设置API服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/api-server-setup-with-express-js-mongodb-and-typescript-part-1-bea7e4f5b526?source=collection_archive---------8-----------------------#2021-02-08">https://javascript.plainenglish.io/api-server-setup-with-express-js-mongodb-and-typescript-part-1-bea7e4f5b526?source=collection_archive---------8-----------------------#2021-02-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e1c1" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第1部分:如何设置基本Express API服务器</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4727d56770d6c554640bc7915f101833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xu6sBN2e6ExZS68FS83hgQ.png"/></div></div></figure><p id="f05f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这将快速介绍如何设置基本的<a class="ae lk" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express </a> API服务器。</p><p id="e303" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">继续创建一个新目录，并在IDE中打开它。使用以下命令启动npm项目</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="5cab" class="lq lr in lm b gy ls lt l lu lv">$ npm init -y</span></pre><p id="df45" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这将使用所有默认值设置package.json文件。如果您希望通过提示手动填写所有字段，只需移除<code class="fe lw lx ly lm b">-y</code>标志。</p><p id="313e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">好吧，让我们开始工作。首先，让我们安装express。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="4873" class="lq lr in lm b gy ls lt l lu lv">$ npm i express </span></pre><p id="968f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">由于我们正在使用<a class="ae lk" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>让我们将它添加到项目中，以及express和Nodejs的类型和一个用于node的<a class="ae lk" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>编译器，但是这次我们将抛出<code class="fe lw lx ly lm b">-D</code>标志，因为我们将只需要开发这些包。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="7b9f" class="lq lr in lm b gy ls lt l lu lv">$ npm i -D @types/express @types/node typescript ts-node</span></pre><p id="a6bf" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在让我们初始化将在我们的项目中使用的类型脚本</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="f45e" class="lq lr in lm b gy ls lt l lu lv">$ npx tsc --init</span></pre><p id="fbdb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">一个名为<code class="fe lw lx ly lm b">tsconfig.json</code>的新文件将被创建。因为TypeScript在这里，你可以设置你希望你的<a class="ae lk" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"> typescript </a>编译成什么版本的JavaScript，以及你希望类型检查有多严格。详细解释请查看<a class="ae lk" href="https://www.typescriptlang.org/docs/handbook/tsconfig-json.html" rel="noopener ugc nofollow" target="_blank"> tsconfig文档</a>。</p><p id="e95a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，在IDE中打开<code class="fe lw lx ly lm b">package.json</code>文件。你应该看到一个键<code class="fe lw lx ly lm b">"main"</code>，它的值是<code class="fe lw lx ly lm b">index.js</code>。因为我们使用的是<a class="ae lk" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank">类型脚本</a>，所以让我们将其设置为<code class="fe lw lx ly lm b">index.ts</code>。您还应该看到一个键<code class="fe lw lx ly lm b">"scripts"</code>，在它的值里面是一个键<code class="fe lw lx ly lm b">"test"</code>。在<code class="fe lw lx ly lm b">"test"</code>值的末尾添加一个逗号，并添加一个新的键<code class="fe lw lx ly lm b">"start"</code>，并将其设置为等于<code class="fe lw lx ly lm b">“ts-node ./src/index.ts”</code>。这样，当我们在终端中键入<code class="fe lw lx ly lm b">npm start</code>时，它将为我们运行我们的应用程序。</p><p id="e691" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这不是必须的，但更多的是一种偏好。我通常会安装nodemon，以便在发生变化时自动运行我的代码，并且已经习惯了使用<code class="fe lw lx ly lm b">npm start</code>来运行我的代码。我们将在本系列教程的后续部分向该应用程序添加nodemon。</p><p id="ffcd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">除了版本差异之外，您的package.json应该类似于下面这样。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lz"><img src="../Images/7ed24c125ba5249e006d155a84df8951.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4LBlmo0DAtqNEfUbUnlggg.png"/></div></div></figure></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="c056" class="mh lr in bd mi mj mk ml mm mn mo mp mq jt mr ju ms jw mt jx mu jz mv ka mw mx bi translated">进口快递</h1><p id="64f1" class="pw-post-body-paragraph ko kp in kq b kr my jo kt ku mz jr kw kx na kz la lb nb ld le lf nc lh li lj ig bi translated">现在我们准备开始建设。创建一个名为<code class="fe lw lx ly lm b">src</code>的文件夹，并在该文件夹中创建一个名为<code class="fe lw lx ly lm b">index.ts</code>的文件。</p><p id="e203" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这个文件将首先加载。它将连接到数据库并将请求发送到路由器，然后路由器将请求发送到适当的控制器。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="cf92" class="lq lr in lm b gy ls lt l lu lv">import express from 'express'</span></pre><p id="a878" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们已经进口了<a class="ae lk" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> express </a>，但是我们还没有使用它。创建一个名为<code class="fe lw lx ly lm b">app</code>的常量，并将其设置为等于<code class="fe lw lx ly lm b">express()</code>。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="b8b8" class="lq lr in lm b gy ls lt l lu lv">const app = express()</span></pre></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="037f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nd">边注:我见过一些带有</em><a class="ae lk" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"><em class="nd">typescript</em></a><em class="nd">的express示例明确声明了什么类型</em> <code class="fe lw lx ly lm b"><em class="nd">app</em></code> <em class="nd">是什么类型，当您用下面的代码行导入express时，您可以通过导入</em> <code class="fe lw lx ly lm b"><em class="nd">Application</em></code> <em class="nd">类型很容易地做到这一点。</em></p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="c1f3" class="lq lr in lm b gy ls lt l lu lv">import express, { Application } from 'express'</span></pre><p id="a215" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，当你从express函数中声明app常量时，你可以简单地写。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="ed20" class="lq lr in lm b gy ls lt l lu lv">const app: Application = express()</span></pre><p id="e620" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有些人在他们的typescript文件中显式声明所有内容，但是我的方法是如果类型还没有包含在包中就导入它们，并且只有当typescript linter对我大喊大叫时才显式声明一个类型。优势在于通过vscode提供的工具。Typescript知道所有声明的内容，因此智能感知甚至比javascript更有用</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="22e1" class="mh lr in bd mi mj mk ml mm mn mo mp mq jt mr ju ms jw mt jx mu jz mv ka mw mx bi translated">设置Express在端口监听</h1><p id="ab9e" class="pw-post-body-paragraph ko kp in kq b kr my jo kt ku mz jr kw kx na kz la lb nb ld le lf nc lh li lj ig bi translated">让我们通过创建另一个名为<code class="fe lw lx ly lm b">port</code>的常量来创建我们的服务器将监听的端口，并将其设置为我们系统中一个未使用的端口。我就用端口<code class="fe lw lx ly lm b">3000</code>。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="eceb" class="lq lr in lm b gy ls lt l lu lv">const port = 5000</span></pre><p id="b050" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">告诉express监听这个端口非常简单。我们利用<code class="fe lw lx ly lm b">listen</code>方法并输入两个参数，端口变量和一个匿名函数，该函数调用<code class="fe lw lx ly lm b">console.log</code>来</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="9b0f" class="lq lr in lm b gy ls lt l lu lv">app.listen(port, () =&gt; {<br/>  console.log(`Server is listening on port ${port}`)</span></pre><p id="9bef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您在终端中运行命令<code class="fe lw lx ly lm b">npm start</code>，它将启动应用程序，您将看到<code class="fe lw lx ly lm b">Server is listening on port 3000</code>的输出。</p><h1 id="d2cd" class="mh lr in bd mi mj ne ml mm mn nf mp mq jt ng ju ms jw nh jx mu jz ni ka mw mx bi translated">你好世界端点</h1><p id="2b33" class="pw-post-body-paragraph ko kp in kq b kr my jo kt ku mz jr kw kx na kz la lb nb ld le lf nc lh li lj ig bi translated">现在让我们测试我们是否可以通过Postman或我们的浏览器导航到服务器并获得响应。同样，Express让我们轻松做到这一点。</p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="3769" class="lq lr in lm b gy ls lt l lu lv">app.get('/', (req, res) =&gt; {<br/>  res.send('Hello World')<br/>})</span></pre><p id="a368" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们把它放在app.listen函数和两个常量之间。如果express在基本url上收到一个get请求，在我们的例子中是<code class="fe lw lx ly lm b"><a class="ae lk" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></code>,服务器将把字符串<code class="fe lw lx ly lm b">"Hello World!"</code>发送回用户。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="44f9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nd">和上面的</em> <code class="fe lw lx ly lm b">Application</code> <em class="nd">类型一样，我们可以导入</em> <code class="fe lw lx ly lm b">req</code> <em class="nd">和</em> <code class="fe lw lx ly lm b">res</code> <em class="nd">的类型，如果我们想用下面的import… </em></p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="de32" class="lq lr in lm b gy ls lt l lu lv">import express, { Request, Response } from 'express'</span></pre><p id="51ea" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nd">…和实施。但是为了在我们的</em> <code class="fe lw lx ly lm b"><em class="nd">app.get()</em></code> <em class="nd">函数声明中真正明确，我们需要声明函数的返回类型。在这种情况下，因为我们实际上不返回任何东西，而是将数据传递给</em> <code class="fe lw lx ly lm b"><em class="nd">res</em></code> <em class="nd">变量。返回类型为</em> <code class="fe lw lx ly lm b"><em class="nd">void</em></code> <em class="nd">。</em></p><pre class="kd ke kf kg gt ll lm ln lo aw lp bi"><span id="4fbc" class="lq lr in lm b gy ls lt l lu lv">app.get('/', (req: Request, res: Response): void =&gt; {<br/>  res.send('Hello World')<br/>})</span></pre><p id="26c8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">再次重申，我们不需要这么明确，因为我们已经导入了express数据类型。但是，如果你喜欢，请自便！</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="7c6f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这样我们就有了一个非常基本的<a class="ae lk" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express </a>服务器设置。您可能想知道“这看起来就像JavaScript？我以为这应该是打字稿？”因为我们导入了将要使用的类型，所以TypeScript 能够计算出每样东西的类型！TypeScript 在后台检查我们所有的代码，以确保类型是正确的，这样我们就可以放心，我们的代码会工作，我们犯的许多懒惰的错误不会出现。这也是允许我们使用ES模块<code class="fe lw lx ly lm b">import</code>而不是<code class="fe lw lx ly lm b">require</code>的原因。</p><p id="2794" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们能够编写更现代的代码，并且能够放心地运行我们的代码！</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="feb3" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">敬请关注下次更新。我们将增加更多的功能。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="d14d" class="mh lr in bd mi mj mk ml mm mn mo mp mq jt mr ju ms jw mt jx mu jz mv ka mw mx bi translated">系列教程</h1><p id="747c" class="pw-post-body-paragraph ko kp in kq b kr my jo kt ku mz jr kw kx na kz la lb nb ld le lf nc lh li lj ig bi translated">第一部分:“你好，世界！”</p><p id="d27a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae lk" href="https://wardprice.medium.com/api-server-setup-with-express-js-and-typescript-part-2-531f9546993c" rel="noopener"> <strong class="kq io">第二部分:设置路由器</strong> </a></p><p id="6a88" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae lk" href="https://wardprice.medium.com/api-server-setup-with-express-js-typescript-and-mongodb-part-3-b02409f072e4" rel="noopener"> <strong class="kq io">第3部分:连接到MongoDB </strong> </a></p></div></div>    
</body>
</html>