<html>
<head>
<title>Hide popups when the user scrolls away with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当用户用React滚动离开时隐藏弹出窗口</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/hide-popups-when-the-user-scrolls-away-with-react-69c043a412fb?source=collection_archive---------1-----------------------#2021-10-17">https://javascript.plainenglish.io/hide-popups-when-the-user-scrolls-away-with-react-69c043a412fb?source=collection_archive---------1-----------------------#2021-10-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="26ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何编写一个自定义钩子来确保粘性弹出窗口不会破坏React应用程序中的UX。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/662411a1e7ed75bed0bb8041cfa49b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ed_rXvjZLG70l-A1"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@pinjasaur?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paul Esch-Laurent</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f7a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，困扰我们的场景是:</p><p id="0942" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">比方说，在你的应用程序中，当你点击一个用户时，会有一个弹出窗口打开。在弹出窗口中，您可以显示该用户的一些基本信息。除了这个配置文件预览弹出窗口，您可能有一些下拉菜单，用户可以从中编辑或删除一些项目。可能性是无限的，我们在应用程序的许多用例中使用弹出窗口。</p><p id="0383" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，当弹出窗口打开时，用户点击离开或开始滚动会发生什么呢？我们希望弹出窗口消失——否则，他们最终会看到一个幽灵弹出窗口，不会从应用程序的视窗中消失(除非他们专门点击了弹出窗口的X按钮)。你加了个X按钮吧？).</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="b584" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解决这个问题需要3个步骤。</p><ol class=""><li id="1331" class="lj lk iq jp b jq jr ju jv jy ll kc lm kg ln kk lo lp lq lr bi translated">我们希望识别发生滚动的元素(简单地说，就是当你在应用程序中的页面上滚动时滚动条移动的元素的ID)。</li><li id="ac85" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">我们希望向该元素添加一个侦听器，它将依次调用我们定义的函数——当然，在这个函数中，我们将隐藏任何需要隐藏的内容。</li><li id="261c" class="lj lk iq jp b jq ls ju lt jy lu kc lv kg lw kk lo lp lq lr bi translated">我们还想为clicking away动作添加一个侦听器——如果用户在弹出窗口之外单击，它应该会关闭。</li></ol></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="0454" class="lx ly iq bd lz ma mb dn mc md me dp mf jy mg mh mi kc mj mk ml kg mm mn mo mp bi translated">在父元素的滚动事件上设置动作</h2><p id="26db" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">在下面的代码片段中，我将向您展示如何实现用可滚动元素的ID调用的钩子，以及每当检测到滚动事件时应该调用的函数。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="e13f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当然，您可以使用这个钩子来收听您感兴趣的任何其他事件。</p><p id="0770" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mx my mz na b">useEffect</code> cleanup函数中，我们删除了事件监听器，这样它的幽灵就不会再纠缠我们了。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="b006" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们假设根组件——在我们的例子中是可滚动容器——位于组件树的根，看起来像这样:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="a6e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，每当屏幕上出现一个弹出窗口时，我们又对在id为<code class="fe mx my mz na b">INFINITE_SCROLL_ID</code>的元素上设置一个监听器感兴趣。当然，这个弹出窗口必须能够自行关闭。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="dcda" class="lx ly iq bd lz ma mb dn mc md me dp mf jy mg mh mi kc mj mk ml kg mm mn mo mp bi translated">使用弹出式菜单中的挂钩</h2><p id="4dba" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">在<code class="fe mx my mz na b">Popup</code>组件中，我们将根据需要使用钩子:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="deee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当<code class="fe mx my mz na b">isPopupOpen</code>属性被检测为真时，<code class="fe mx my mz na b">handleScroll</code>回调将被重新创建。我们需要将属性传递给依赖数组的原因是，否则回调就不会被正确创建。尽管已经将一个真值传递给了这个子组件，但是它将被创建并把<code class="fe mx my mz na b">isPopupOpen</code>设置为假。</p><p id="9bac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按照同样的逻辑，你可以回到<code class="fe mx my mz na b">useOnScrollEffect</code>钩子，你会注意到<code class="fe mx my mz na b">fun</code>变量也被传递到依赖数组中——这是因为<code class="fe mx my mz na b">handleScroll</code>回调发生了变化，所以它检测到了<code class="fe mx my mz na b">isPopupOpen</code>属性的正确值。</p><p id="76a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为什么我们需要传入这些依赖数组？从纯粹的“它工作，离开它”的角度来看，没有依赖数组也很好。然而，您会注意到，如果没有<code class="fe mx my mz na b">if (props.isPopupOpen)</code>检查，那么<code class="fe mx my mz na b">closePopup</code>调用将会被无用地调用数百次。您可以通过在<code class="fe mx my mz na b">handleScroll</code>回调函数体中传递一个<code class="fe mx my mz na b">console.log(“onscroll")</code>来验证这一点。我向下滚动了2到3次，日志被触发了400多次。想象一下，我们是如何徒劳地将一个真值设置为true几百次。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h2 id="e7d9" class="lx ly iq bd lz ma mb dn mc md me dp mf jy mg mh mi kc mj mk ml kg mm mn mo mp bi translated">在弹出窗口外单击</h2><p id="5614" class="pw-post-body-paragraph jn jo iq jp b jq mq js jt ju mr jw jx jy ms ka kb kc mt ke kf kg mu ki kj kk ij bi translated">为了处理“click away”事件，我们将使用MaterialUI中的一个组件:<a class="ae lb" href="https://mui.com/api/click-away-listener/" rel="noopener ugc nofollow" target="_blank"> ClickAwayListener </a>。</p><p id="115b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将修改我们的弹出窗口，使其内容包装在这个组件中。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="61bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，当在我们的弹出窗口之外检测到任何点击时，它将表现良好，并会自动关闭。我们还可以调整<code class="fe mx my mz na b">ClickAwayListener</code>,让它识别其他事件，而不仅仅是点击弹出窗口之外。组件上有一个<code class="fe mx my mz na b">mouseEffect</code> prop，它根据您的需要接受以下值:</p><pre class="km kn ko kp gt nb na nc nd aw ne bi"><span id="204a" class="lx ly iq na b gy nf ng l nh ni">‘onClick’<br/>‘onMouseDown’<br/>‘onMouseUp’</span></pre><p id="0f95" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，对于当前的目的，默认行为就足够了。您会注意到，当您开始滚动页面或在页面外单击时，弹出窗口会关闭。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><p id="5d73" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望文章对你有所帮助。我们都希望我们的应用程序中的UX尽可能好，所以我们也需要考虑这样的边缘情况。</p><p id="8b9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非常感谢你的阅读！</p><p id="b41c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="nj">更多内容请看</em><a class="ae lb" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="nj">plain English . io</em></strong></a></p></div></div>    
</body>
</html>