<html>
<head>
<title>Serverless with Local DynamoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带本地DynamoDB的无服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/serverless-with-local-dynamodb-afc90940798?source=collection_archive---------3-----------------------#2021-07-25">https://javascript.plainenglish.io/serverless-with-local-dynamodb-afc90940798?source=collection_archive---------3-----------------------#2021-07-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b909aa3acd991bd7537e17a02d6a9c93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2uF6_Yb-m4lhVtyj"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@ianjbattaglia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ian Battaglia</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="b23d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak">简介</strong></h1><p id="7de9" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">希望你们过得很好。本文是关于通过在本地安装DynamoDB并对其进行配置来构建您自己的无服务器应用程序。如果你不熟悉什么是无服务器或者什么是DynamoDB，那么我建议你先了解一下这个系统的基本概念。对于本文，我假设您已经对serverless如何使用DynamoDB有了基本的了解。所以让我们来了解一下离线设置的必要性。Bdw，你可以在这里找到源代码<a class="ae jz" href="https://github.com/Classy-Endevours/serverless-dynamodb-starter" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="c943" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">为什么需要它？</h1><p id="f9e3" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">众所周知，无服务器比常规的服务器安装成本更高(如果你做的一切都是正确的)。因此，最重要的是将成本降到最低，通过进行本地设置和正确的迁移，您可以使用ngrok或类似工具为您和您的团队建立一个很酷的工作环境。现在让我们开始编码。</p><h1 id="34b5" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">开始</h1><p id="27d2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">要开始使用无服务器，您需要在本地安装无服务器软件包。你可以使用<code class="fe lw lx ly lz b">npm i serverless -g</code>或<code class="fe lw lx ly lz b">yarn global add serverless.</code>来完成。一旦你安装了应用程序，你可以使用命令来创建一个应用程序，但是对于本教程，我从头开始使用所有的东西。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/6cea7414b9cd315b4090169d544c99b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FR3Ww16ij77Gvqib"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@giabyte?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Gia Oris</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4eca" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在，我们完成了理论，让我们跳到一些代码上。首先，我们需要创建一个文件名<code class="fe lw lx ly lz b">serverless.yml</code>，这将是我们在这里的入口点。以下是该文件的内容。</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/8da0b602c65afa37a9d4b80cafa35685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6bHEFLZwrRAjn8eP7JWLiw.png"/></div></div></figure><p id="cb09" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">在这个文件中，你会看到让你困惑的代码，但是不要担心，我们会一部分一部分地介绍。</p><blockquote class="ml mm mn"><p id="f129" class="ky kz mo la b lb mf ld le lf mg lh li mp mh ll lm mq mi lp lq mr mj lt lu lv ig bi translated">您可以根据需要在文件中添加或删除内容，比如删除中间件或添加. env文件</p></blockquote><ul class=""><li id="0eab" class="ms mt in la b lb mf lf mg lj mu ln mv lr mw lv mx my mz na bi translated">服务—它是您的无服务器应用程序的名称</li><li id="e7b9" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">框架版本—框架版本，您可以从无服务器指南中指定</li><li id="a481" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">提供商—您的无服务器提供商。我的是AWS。您还可以在应用程序级别向其添加其他字段</li><li id="1a5a" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">功能——这是您将花费大部分时间编写业务逻辑的地方。一个函数会有多种状态，比如句柄、内存大小、要触发的事件</li><li id="0102" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">插件——运行应用程序所需的附加库，如中间件、本地数据库、无服务器离线</li><li id="2da1" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">自定义—插件的自定义对象</li><li id="052d" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">资源—您的数据库迁移(如果有)</li><li id="1942" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">包—构建时打包，以包含或排除模块</li></ul><p id="8737" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在你对这个方法有了一个基本的概念，我们可以继续使用本地DynamoDB了</p><p id="99d0" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">首先，我们需要安装几个包</p><ul class=""><li id="ab79" class="ms mt in la b lb mf lf mg lj mu ln mv lr mw lv mx my mz na bi translated">蓝鸟——处理承诺</li><li id="e81b" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">无服务器中间件——向您的处理程序添加中间件</li><li id="d555" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">UUID —为您的文档生成新的ID</li><li id="3abd" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">无服务器-dynamo db-local—[Dev]管理DynamoDB local</li><li id="8fc7" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">无服务器-脱机[开发]</li></ul><h2 id="9330" class="ng kb in bd kc nh ni dn kg nj nk dp kk lj nl nm ko ln nn no ks lr np nq kw nr bi translated">装置</h2><p id="b66c" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">要开始安装，您需要为您的机器准备好Java。一旦你下载了Java。你可以手动下载DynamoDB local或者运行<code class="fe lw lx ly lz b">npm i db-setup</code>来获取副本。</p><blockquote class="ml mm mn"><p id="c0db" class="ky kz mo la b lb mf ld le lf mg lh li mp mh ll lm mq mi lp lq mr mj lt lu lv ig bi translated">如果您没有使用npm软件包，则需要先下载副本，然后在同一文件夹中运行以下命令</p><p id="cbdd" class="ky kz mo la b lb mf ld le lf mg lh li mp mh ll lm mq mi lp lq mr mj lt lu lv ig bi translated">java -Djava.library.path*。/DynamoDBLocal _ lib-jar DynamoDBLocal . jar-shared db</p></blockquote><p id="6f7c" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在，让我们在根项目中创建一个数据库文件夹，并在它下面创建一个<code class="fe lw lx ly lz b">dynamodb.js</code>文件。以下是连接的内容</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/352e8f9df64770a66cc03b17d24cb85a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SDLAJtv_ubuM7tz2xrMiw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">dynamodb.js</figcaption></figure><p id="7b2d" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated"><code class="fe lw lx ly lz b">process.env.IS_OFFLINE</code>是无服务器脱机软件包给定的值。我们已经据此配置了数据库。我们只需要给副本一个本地地址。</p><p id="ad7e" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在数据库已经连接好了。我们需要为它们创建处理程序和中间件。但在此之前，我们需要为该方法添加一些操作和实用程序。你可以从repo <a class="ae jz" href="https://github.com/Classy-Endevours/serverless-dynamodb-starter" rel="noopener ugc nofollow" target="_blank">这里</a>复制这些文件。这些只是为了更好的编码方法，仅此而已。</p><p id="e0a3" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在让我们创建一个名为<code class="fe lw lx ly lz b">offline/migrations</code>的文件夹来创建和存储项目的迁移和种子。创建一个名为<code class="fe lw lx ly lz b">user.yml</code>的文件，它将为我们创建表格</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/ded0586a54abe2b304242d8a21266f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q0weXEFZ9KRHjjlb42qoQQ.png"/></div></div></figure><p id="66ac" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">这将为表提供id。您可以根据自己的需要进行配置，并添加种子，您可以看到任何具有唯一id的原始数据作为必填字段。如果你回到<code class="fe lw lx ly lz b">serverless.yml</code>，我们有一个定制的对象被配置为获取数据源</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/2b4c8fb77cd0d0756468577e3485b32d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eevTRzAkkBCjlOpvRU1_Kg.png"/></div></div></figure><p id="659e" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在让我们创建一个<code class="fe lw lx ly lz b">config.yml</code>文件来存储基于阶段的配置变量。你可以借助。env文件也一样</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/5442ebc94f8e2d825325ab9fb77f22c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YVQT8sPm_Xf9ASYAHJXeRA.png"/></div></div></figure><p id="5a11" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">这也类似于获取env变量的<code class="fe lw lx ly lz b">serverless.yml</code>文件。</p><p id="d64c" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在让我们创建一个文件<code class="fe lw lx ly lz b">operations/user.js</code>来处理数据库操作</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/09674b8a2bc8c8df2dd1a5f8117c70de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4y9Yi7utEMu0kcdTivWXg.png"/></div></div></figure><p id="98ff" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">在这里，您可以创建对数据库的小查询，为我们执行CRUD操作。</p><p id="3994" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">现在让我们在根项目中创建一个名为<code class="fe lw lx ly lz b">api</code>的文件夹，并添加一个文件<code class="fe lw lx ly lz b">user.js</code>。如果你不想要中间件，你可以清理掉serverless.yml</p><p id="94b4" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">以下是<code class="fe lw lx ly lz b">user.js,</code>中的内容</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/bf309710e8e2ef925badd33807bf5df9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9go4PxxAe2D_ET4GTmOLCw.png"/></div></div></figure><h2 id="edf5" class="ng kb in bd kc nh ni dn kg nj nk dp kk lj nl nm ko ln nn no ks lr np nq kw nr bi translated">运行应用程序</h2><p id="5bba" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">要运行应用程序，您只需键入命令<code class="fe lw lx ly lz b">npm run dev</code>来启动服务器，如果您离线，还可以运行您刚刚创建的迁移</p><figure class="mb mc md me gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/b4c13605d92e9a429edf36e7494232c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brhaLXw62-Yi8rt0d-fb5g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">server starts</figcaption></figure><p id="bb05" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">如果一切顺利，你会看到类似的情况。你可以试着按照你的要求来处理代码。</p><p id="7c9d" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated">希望这篇文章能帮助你用本地DynamoDB配置无服务器。谢了。</p><p id="e4d4" class="pw-post-body-paragraph ky kz in la b lb mf ld le lf mg lh li lj mh ll lm ln mi lp lq lr mj lt lu lv ig bi translated"><em class="mo">更多内容看</em><a class="ae jz" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="la io"><em class="mo">plain English . io</em></strong></a></p></div></div>    
</body>
</html>