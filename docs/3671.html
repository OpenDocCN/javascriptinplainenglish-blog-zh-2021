<html>
<head>
<title>How to Implement Your Own Rate Limiter in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Node.js中实现自己的速率限制器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-implement-your-own-rate-limiter-in-node-js-16166045a2a5?source=collection_archive---------13-----------------------#2021-07-23">https://javascript.plainenglish.io/how-to-implement-your-own-rate-limiter-in-node-js-16166045a2a5?source=collection_archive---------13-----------------------#2021-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1734" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Node.js开发一个轻量级的内存API速率限制器。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/ec4f4c1159176a7236f7fbe9df4aec01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGy4CoD2ihEZVXXRiuDFPQ.png"/></div></div></figure><p id="d6fe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">速率限制是每个web应用程序都应该实现的最重要的特性之一。在限速的情况下有很多变化，比如-</p><ul class=""><li id="bdc5" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated">基于IP的速率限制—防止拒绝服务攻击</li><li id="34f3" class="lk ll in kq b kr lt ku lu kx lv lb lw lf lx lj lp lq lr ls bi translated">特定于帐户的速率限制—防止暴力攻击</li></ul><p id="55ef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这个演示中，我们将实现一个基本的速率限制机制，该机制将在连续Y次无效尝试后锁定用户帐户X个时间段。此外，我们不打算为此使用任何数据库，因为我想让它更简单和精确。</p><p id="f350" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我将使用Node.js来实现速率限制器，但是这个逻辑可以使用任何编程语言来实现。</p><h1 id="d493" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">流程:</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/d875f876fdbbc8cac811c2a45b90cd7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WP20K-us_OEJTSgUeFet7g.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">This is how it works!</figcaption></figure><h1 id="a3f9" class="ly lz in bd ma mb mc md me mf mg mh mi jt mj ju mk jw ml jx mm jz mn ka mo mp bi translated">给我看看代码…</h1><p id="2f9d" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">使用<code class="fe na nb nc nd b">npm init --y</code>命令创建一个新的NodeJS项目。我们需要安装<code class="fe na nb nc nd b">express</code>来处理HTTP请求，安装<code class="fe na nb nc nd b">moment</code>来显示用户帐户解锁的相对剩余时间。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="da89" class="ni lz in nd b gy nj nk l nl nm">npm install express moment --save</span></pre><p id="1b63" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安装完成后，我们可以将下面的代码添加到<code class="fe na nb nc nd b">app.js</code>文件中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="ce2c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">让我们保存文件并使用Postman运行一些测试！</p><ul class=""><li id="7c79" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><strong class="kq io"> <em class="np">场景1——成功登录</em> </strong></li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/67c61a2c6675ceac60fd2358ab6acdd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YUxesKERg8NB4UROHXgEGg.gif"/></div></div></figure><ul class=""><li id="5871" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><strong class="kq io"> <em class="np">场景2 —无效登录</em> </strong></li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/d6e46607b7ec53f3be89681b0d103d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2c0BQR6yuyS4kmaLgPkIpA.gif"/></div></div></figure><ul class=""><li id="2bc1" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><strong class="kq io"> <em class="np">场景3——连续2次以上无效尝试</em> </strong></li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/c74ca1e86cfe33bffedc1c9fc8209244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JPlKS5WNOf5cn7wDWAJMjA.gif"/></div></div></figure><ul class=""><li id="2791" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><strong class="kq io"> <em class="np">场景4— 2次无效尝试后跟随一次有效登录尝试</em> </strong></li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/6c74e7c5f342507b28bba35ce9c15c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*igp6Michdir-EdoRqT-qmQ.gif"/></div></div></figure><p id="6380" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以看到，在所有场景中，限速器都按预期工作。如上所述，这是一个非常基本的实现，它可以在许多方面进一步改进，例如，我们可以定义一个时间范围，在这个时间范围内可以限制点击次数，比如说，3分钟内5次无效登录尝试应该将帐户锁定24小时。这些锁存储在应用程序的内存中，因此如果服务器重启或崩溃，它们将会丢失。因此，锁可以在Redis或MongoDB等数据存储中持久化，以获得更高的一致性和可靠性。此外，还有一些npm模块可用于实现速率限制。</p><p id="162d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">编码快乐！🎉</p><p id="03a6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="np">更多内容请看</em><a class="ae ns" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="np">plain English . io</em></strong></a></p></div></div>    
</body>
</html>