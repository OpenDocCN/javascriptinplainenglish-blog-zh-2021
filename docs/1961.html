<html>
<head>
<title>Managing Local State in React with Apollo, Immer, and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Apollo、Immer和TypeScript管理本地状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/managing-local-state-in-react-with-apollo-immer-and-typescript-e966abe58476?source=collection_archive---------7-----------------------#2021-04-24">https://javascript.plainenglish.io/managing-local-state-in-react-with-apollo-immer-and-typescript-e966abe58476?source=collection_archive---------7-----------------------#2021-04-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="95de" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">我们将学习如何使用<em class="kc">反应变量在Apollo应用中本地管理状态。</em></h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi kd"><img src="../Images/67614a106e193a378abb77de34c296c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*8WXOlVLa6q-WZ8k14bszSw.png"/></div></figure><p id="cce5" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">Apollo是一个广泛的开发平台，可用于前端和后端开发。</p><p id="be60" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">今天我们将关注Apollo对React的实现，即Apollo-Client。Apollo-Client是一个数据获取和缓存工具，它使用GraphQL来收集和管理其数据，但他们最近推出了一个名为Reactive Variables的新功能，它完全不依赖于GraphQL。我们将使用反应变量和一个名为Immer的库(稍后将详细介绍)来实现一个本地状态管理的待办事项列表。</p><p id="d777" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">下面是阿波罗客户文档<em class="lh">反应变量</em>的链接，供那些想了解更多的人参考。</p><div class="li lj gp gr lk ll"><a href="https://www.apollographql.com/docs/react/local-state/reactive-variables/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">反应变量</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">在Apollo Client 3中新增的反应变量是一种在Apollo客户端之外存储本地状态的有用机制…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">www.apollographql.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz kj ll"/></div></div></a></div></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="ff33" class="mh mi in bd mj mk ml mm mn mo mp mq mr jt ms ju mt jw mu jx mv jz mw ka mx my bi translated">我们在建造什么</h1><p id="45b4" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">今天，我们将使用一些非常酷的React技术来创建一个类似这样的待办事项列表。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/07466d3cf51e87754a812e04978a81d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*kj4hnLJZRJiEy5FUR20ArA.gif"/></div></figure></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="7a69" class="mh mi in bd mj mk ml mm mn mo mp mq mr jt ms ju mt jw mu jx mv jz mw ka mx my bi translated">项目设置</h1><p id="1def" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">我们需要做的第一件事是打开终端或命令提示符(取决于操作系统)并导航到我们想要创建React项目的目录。</p><p id="8b9a" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">导航到所需目录后，运行此命令。</p><pre class="ke kf kg kh gt nf ng nh ni aw nj bi"><span id="7073" class="nk mi in ng b gy nl nm l nn no">npx create-react-app apollo-state-demo --template typescript</span></pre><p id="856a" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">创建项目后，我们只需要安装几个包。</p><pre class="ke kf kg kh gt nf ng nh ni aw nj bi"><span id="46fc" class="nk mi in ng b gy nl nm l nn no">npm i @apollo/client immer uuid @material-ui/core @material-ui/icons @types/uuid graphql</span></pre><p id="a694" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">一旦安装了包，您就可以在您选择的代码编辑器中打开项目。</p><p id="481a" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><em class="lh">我将使用VS代码。下面是一个下载链接，供那些想尝试一下的人使用。</em></p><div class="li lj gp gr lk ll"><a href="https://code.visualstudio.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">Visual Studio代码-代码编辑。重新定义的</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">Visual Studio Code是一个重新定义和优化的代码编辑器，用于构建和调试现代web和云…</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">code.visualstudio.com</p></div></div><div class="lu l"><div class="np l lw lx ly lu lz kj ll"/></div></div></a></div><p id="8559" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">现在我们的项目已经在代码编辑器中打开，是时候删除src目录中所有不必要的文件了。您可以继续删除除了下面截图中的这3个文件之外的所有文件。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/eb841871cc6203e8451b743543d7e247.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*YlSSs4gpHSGCbOM1sfFjzQ.png"/></div></figure><p id="fa8a" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">我们将在src目录中创建两个新文件，分别名为<strong class="kn io"> todoState.ts </strong>和<strong class="kn io"> todo.ts </strong>。当我们完成时，我们的项目应该是这样的。</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/e507944889a90025fa029a83ed252675.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*j4gD1lv1vRYQ5wc03GuTvg.png"/></div></figure></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="0e02" class="mh mi in bd mj mk ml mm mn mo mp mq mr jt ms ju mt jw mu jx mv jz mw ka mx my bi translated">让我们开始编码吧</h1><p id="8c23" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">我们将把它分成两部分。首先，我们将使用反应变量和Immer实现状态管理逻辑。其次，我们将把这个状态管理逻辑连接到我们的UI。</p><h2 id="e073" class="nk mi in bd mj ns nt dn mn nu nv dp mr ku nw nx mt ky ny nz mv lc oa ob mx oc bi translated">第一部分。设置状态管理</h2><p id="a490" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">我们要做的第一件事是创建我们的模型，我们的状态将基于该模型。这将会非常简单。我们将有一个todo类型，它具有id、描述和已完成的属性。继续修改<strong class="kn io"> todo.ts </strong>文件，使其看起来像下面的代码。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="69f5" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">随着我们的<em class="lh"> Todo </em>类型的创建，是时候使用<em class="lh">反应变量</em>和<em class="lh"> Immer </em>来设置我们的状态了。我们将在下面的代码中做一些事情。我们将为我们的状态设置初始值，并创建不同的函数来修改我们的状态(添加todos、删除todos和切换completed属性)。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="2589" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">你会看到在第7行的<strong class="kn io">，</strong>我们正在初始化我们的状态，并告诉TypeScript我们的状态类型将是一个列表<em class="lh">todo</em>。</p><p id="f045" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">关于<em class="lh">反应变量</em>的工作方式，真正酷的是你只需调用我们在第7行声明的内容，并传递你希望新状态是什么(你可以在<strong class="kn io">第13、26、</strong>和<strong class="kn io"> 35 </strong>行看到这一点)。</p><p id="3a6f" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">现在我不打算深入探究我们是如何向数组中添加和移除项目的，但是你们中的很多人可能对在几个地方弹出的<em class="lh"> produce </em>函数感到疑惑。该函数是由Immer库带来的，基本上，它允许我们在使用不可变状态的事物上编写可变状态操作。</p><p id="a3e3" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">要了解有关Immer的更多信息，您可以参考以下链接中的文档:</p><div class="li lj gp gr lk ll"><a href="https://immerjs.github.io/immer/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">Immer简介| Immer</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">总是（德语词）</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">| Immer Immer js . github . io</p></div></div><div class="lu l"><div class="of l lw lx ly lu lz kj ll"/></div></div></a></div><p id="e13e" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">现在我们的状态管理已经设置好了，剩下的就是将它连接到我们的UI。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h2 id="97cb" class="nk mi in bd mj ns nt dn mn nu nv dp mr ku nw nx mt ky ny nz mv lc oa ob mx oc bi translated">第二部分。将用户界面连接到状态管理</h2><p id="c34a" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">对于我们的UI，我们将使用一个名为Material-UI的库。对于那些不知道的人，你可以通过下面的链接了解更多。不过，我们会让事情变得非常简单，所以如果你不熟悉Material-UI及其工作原理，也不用担心。</p><div class="li lj gp gr lk ll"><a href="https://material-ui.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">Material-UI:一个流行的React UI框架</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">React组件使web开发更快更容易。建立自己的设计体系，或者从材料设计开始。</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">material-ui.com</p></div></div><div class="lu l"><div class="og l lw lx ly lu lz kj ll"/></div></div></a></div><p id="0e43" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">我们需要做的第一件事是用下面的代码替换我们的<strong class="kn io"> index.tsx </strong>文件中的旧代码。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="75fd" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">这个文件中唯一值得注意的是CssBaseline 组件。Material-UI引入了这个组件。它所做的只是引入一些智能的CSS默认和重置。</p><p id="c053" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">随着我们的<strong class="kn io"> index.tsx </strong>文件准备就绪，是时候用下面的代码替换我们的<strong class="kn io"> App.tsx </strong>文件中的旧代码了。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="od oe l"/></div></figure><p id="c2bd" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">上面代码中唯一值得注意的与<em class="lh">反应变量</em>相关的是<em class="lh"> useReactiveVar </em>钩子，它本质上允许我们订阅/监听待办事项列表状态的变化。</p><p id="91c8" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">仅此而已。我们做到了。我们用我认为非常简单的管理状态的方法做了一个待办事项列表。</p><p id="9366" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">下面是CodeSandbox中该应用程序代码的链接，供那些想在浏览器中使用它的人使用。</p><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="oh oe l"/></div></figure><p id="601e" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated">下面是Github中该项目的链接。</p><div class="li lj gp gr lk ll"><a href="https://github.com/13bfrancis/apollo-local-state-demo" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab fo"><div class="ln ab lo cl cj lp"><h2 class="bd io gy z fp lq fr fs lr fu fw im bi translated">13 b法国/阿波罗-本地-州-演示</h2><div class="ls l"><h3 class="bd b gy z fp lq fr fs lr fu fw dk translated">这个项目是用Create React App引导的。在项目目录中，您可以运行:在…中运行应用程序</h3></div><div class="lt l"><p class="bd b dl z fp lq fr fs lr fu fw dk translated">github.com</p></div></div></div></a></div></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h1 id="462e" class="mh mi in bd mj mk ml mm mn mo mp mq mr jt ms ju mt jw mu jx mv jz mw ka mx my bi translated">结论</h1><p id="5d80" class="pw-post-body-paragraph kl km in kn b ko mz jo kq kr na jr kt ku nb kw kx ky nc la lb lc nd le lf lg ig bi translated">希望通过阅读本文，您已经掌握了一个关于React状态管理的新工具。一如既往，如果你有任何想法或建议，请随时留下评论。</p><p id="1fb3" class="pw-post-body-paragraph kl km in kn b ko kp jo kq kr ks jr kt ku kv kw kx ky kz la lb lc ld le lf lg ig bi translated"><em class="lh">更多内容看</em><a class="ae oi" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kn io"><em class="lh">plain English . io</em></strong></a></p></div></div>    
</body>
</html>