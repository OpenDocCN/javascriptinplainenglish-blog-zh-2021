<html>
<head>
<title>Building a simple countdown timer in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中构建一个简单的倒计时器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-simple-countdown-timer-in-react-f24fdc2a5fd5?source=collection_archive---------7-----------------------#2021-01-14">https://javascript.plainenglish.io/building-a-simple-countdown-timer-in-react-f24fdc2a5fd5?source=collection_archive---------7-----------------------#2021-01-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/705209ba2ec8cbbb9a234df204df96e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAd_5bm2Y7HEuZJeBYTyow.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@neonbrand?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">NeONBRAND</a> on <a class="ae jz" href="https://unsplash.com/s/photos/timer?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="941f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我的上一个项目中，我不得不写一个定时器，你可以设置，启动/暂停和重置。这不是最难写的东西，但有几件事，我最初没有想到。我们一步一步来，看看怎么做。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="5964" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">目标</h1><p id="a65d" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我们的计时器应该是这样的:</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/4b7e57a7f06d1bf05210463d08d46fa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ON_qXGe1eOX0pzd-vVf5Gw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Figma prototype</figcaption></figure><p id="6047" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">计时器将始终初始化为20分钟，但是您可以通过单击它旁边的按钮来减少或增加分钟数。在显示的时间下方有两个按钮。一个启动计时器，这也将是一个暂停按钮，另一个重置计时器。</p><h1 id="f939" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">让我们开始编码吧</h1><p id="da77" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">首先，你需要制作一个<code class="fe ms mt mu mv b">Timer.js</code>和<code class="fe ms mt mu mv b">Timer.css</code>文件。因为我们一开始就应该有一个漂亮的计时器，打开<code class="fe ms mt mu mv b">Timer.css</code>文件，并粘贴以下代码:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="913d" class="my lg in bd lh mz na dn ll nb nc dp lp kl nd ne lt kp nf ng lx kt nh ni mb nj bi translated">Timer.js框架代码</h2><p id="e1fd" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我们定义了<code class="fe ms mt mu mv b">timer</code>、<code class="fe ms mt mu mv b">isActive</code>和<code class="fe ms mt mu mv b">isPaused</code>变量。</p><p id="3195" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ms mt mu mv b">timer</code>值最初设置为<code class="fe ms mt mu mv b">20</code>分钟。</p><p id="bfac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ms mt mu mv b">isActive</code>是定义的变量，用于查看定时器是否激活，并初始设置为<code class="fe ms mt mu mv b">false</code>。</p><p id="9bfb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ms mt mu mv b">isPaused</code>是定义的变量，用于查看定时器是否暂停，并初始设置为<code class="fe ms mt mu mv b">false</code>。</p><p id="e0ce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，复制并粘贴我们的框架代码:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nk mx l"/></div></figure><p id="9ad4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，我们使用<code class="fe ms mt mu mv b">useRef</code>钩子来获取或控制任何元素的引用。这与使用<code class="fe ms mt mu mv b">document.getElementById("demo")</code>是一样的，这意味着我们跳过了虚拟dom，直接与浏览器打交道。</p><h1 id="e88d" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">编写按钮的所有功能</h1><h2 id="7b6e" class="my lg in bd lh mz na dn ll nb nc dp lp kl nd ne lt kp nf ng lx kt nh ni mb nj bi translated">函数handleDecrease和handleIncrement</h2><p id="326a" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">增加或减少定时器值的简单功能。</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nl mx l"/></div></figure><h2 id="5768" class="my lg in bd lh mz na dn ll nb nc dp lp kl nd ne lt kp nf ng lx kt nh ni mb nj bi translated">功能手柄启动</h2><p id="7b40" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">当我们点击开始按钮，计时器将开始减少，并保持递减，直到我们暂停或停止它。为此，我们将使用<code class="fe ms mt mu mv b">setInterval</code>方法。<code class="fe ms mt mu mv b">setInterval</code>是一个在特定的时间间隔后调用函数或运行一些代码的方法，通过第二个参数指定。只要我们不阻止它，它就会一直运行。它需要两个参数。回调和时间(毫秒)。</p><p id="f9d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们按下开始按钮时，<code class="fe ms mt mu mv b">isActive</code>将变成<code class="fe ms mt mu mv b">true</code>,每秒钟计时器值将减1。我们将<code class="fe ms mt mu mv b">countRef</code> <strong class="kc io">当前</strong>属性设置为<code class="fe ms mt mu mv b">setInterval</code>函数，这意味着我们在变量<code class="fe ms mt mu mv b">countRef</code>中设置了<code class="fe ms mt mu mv b"><strong class="kc io">timerId</strong></code>，现在我们可以在其他函数中使用它。我们使用<code class="fe ms mt mu mv b">countRef.current</code>来获取参考的当前值。</p><p id="b4c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的开始按钮也是一个暂停按钮，这就是为什么这里实现了这个逻辑。如果开始按钮已经激活(也称为。如果isActive值设置为true—if语句),其变量<code class="fe ms mt mu mv b">isActive</code>将变为<code class="fe ms mt mu mv b">false</code>。为了使<strong class="kc io">停止</strong>或<strong class="kc io">暂停</strong>计时器，我们需要使用<code class="fe ms mt mu mv b">clearInterval</code>功能。<code class="fe ms mt mu mv b">clearInterval</code>需要一个参数。我们将在<code class="fe ms mt mu mv b">clearInterval</code>方法中传递<code class="fe ms mt mu mv b">countRef.current</code>作为参数。</p><p id="9531" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恢复它将再次启动计时器。</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nm mx l"/></div></figure><h2 id="8809" class="my lg in bd lh mz na dn ll nb nc dp lp kl nd ne lt kp nf ng lx kt nh ni mb nj bi translated">功能句柄重置</h2><p id="6089" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">重置功能会将所有内容重置为初始值。它将停止计时器，清除间隔并将值设置为20。</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nn mx l"/></div></figure><h1 id="b491" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">有条件地呈现按钮</h1><p id="0a35" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">当我们按下开始按钮时，它会变成暂停按钮。所以这意味着如果<code class="fe ms mt mu mv b">isActive</code>为真，按钮上应该写着暂停。这个小小的调整如下所示:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="no mx l"/></div></figure><h1 id="2e6f" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">格式化时间</h1><p id="f22c" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">现在，我们的计时器只显示秒，但是我们希望它看起来像— 00:00。</p><p id="8b15" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将创建一个函数<code class="fe ms mt mu mv b">formatTime</code>来显示我们想要的时间。<code class="fe ms mt mu mv b">timer</code> const将具有以秒为单位的值。我们的函数现在看起来像这样:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nl mx l"/></div></figure><p id="2b16" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们的常量<code class="fe ms mt mu mv b">timer</code>只有1秒，当我们想增加或减少这个值时，我们应该增加60秒:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nl mx l"/></div></figure><h1 id="1477" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">问题</h1><p id="ca93" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">当我们到00:00时，计时器应该停止。现在我们有一个计时器，当它到达那个值时，下一个是-1:-1 → -1:-2，以此类推。这是因为<code class="fe ms mt mu mv b">setInterval </code>没有最新的定时器值。</p><p id="9e90" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将添加跟踪<code class="fe ms mt mu mv b">timer</code>值的<code class="fe ms mt mu mv b">useEffect</code>钩子。如果数值低于1秒<code class="fe ms mt mu mv b">clearInterval.</code></p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="np mx l"/></div></figure><p id="ca52" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">同样，如果<code class="fe ms mt mu mv b">timer</code>值小于1，我们也不想启动计时器。我们只需要稍微调整一下:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nq mx l"/></div></figure><h1 id="5dbf" class="lf lg in bd lh li mn lk ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc bi translated">搞定了。</h1><p id="79b0" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我们已经完成了倒计时。一开始你可以找到CSS代码。下面是我们完成的JS代码:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="nr mx l"/></div></figure><p id="3636" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">而我们的成品<strong class="kc io">(未激活):</strong></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/a3fb754447c45055a8e7e4e6bbadf03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QIlw3zItu6yWwuQ3a2GOA.png"/></div></div></figure><p id="7e03" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还有<strong class="kc io">主动:</strong></p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/ea042b72cb29017367bf751cd3248c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ChMD_2BnpBWt_MWCGLuiWg.png"/></div></div></figure></div></div>    
</body>
</html>