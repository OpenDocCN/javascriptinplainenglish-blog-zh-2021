<html>
<head>
<title>How to Get the User’s Time Zone and Offset in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中获取用户的时区和偏移量？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-get-the-users-time-zone-and-offset-in-javascript-da53adb27f32?source=collection_archive---------3-----------------------#2021-12-03">https://javascript.plainenglish.io/how-to-get-the-users-time-zone-and-offset-in-javascript-da53adb27f32?source=collection_archive---------3-----------------------#2021-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/144b7b99dced0e8fd89e2b953d50fd60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7qETQDYFwycaCH9p"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jlmagata?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JL Magata</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="52cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们需要在JavaScript web应用程序中获取用户的时区。</p><p id="bc3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何在JavaScript中获取用户的时区和时差。</p><h1 id="8c2e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">date . prototype . gettimezoneoffset</h1><p id="7da9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">JavaScript的本机<code class="fe me mf mg mh b">Date</code>对象具有返回用户时区的<code class="fe me mf mg mh b">getTimezoneOffset</code>方法。</p><p id="4764" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="af6a" class="mq lc iq mh b gy mr ms l mt mu">const offset = new Date().getTimezoneOffset();<br/>console.log(offset);</span></pre><p id="cf52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回UTC和本地时间之间的差值。</p><p id="861d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，如果我们使用太平洋标准时间，我们会看到<code class="fe me mf mg mh b">offset</code>是480。</p><p id="ed93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当它落后于UTC时，偏移量为正，否则为负。</p><p id="629f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">偏移量以分钟为单位，所以我们用它除以60来得到小时数。</p><p id="8d51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">夏令时防止该值保持不变。</p><h1 id="6c39" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe me mf mg mh b">The Intl.DateTimeFormat Constructor</code></h1><p id="e515" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">此外，我们可以使用<code class="fe me mf mg mh b">Intl.DateTimeFormat().resolvedOptions().timeZone</code>属性来获取用户的时区。</p><p id="eee1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="6569" class="mq lc iq mh b gy mr ms l mt mu">console.log(Intl.DateTimeFormat().resolvedOptions().timeZone)</span></pre><p id="7037" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在太平洋时区，我们可能会得到这样的结果:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="659e" class="mq lc iq mh b gy mr ms l mt mu">'America/Los_Angeles'</span></pre><p id="28c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已退回。</p><h1 id="738d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">从日期字符串中提取时区</h1><p id="504d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以从JavaScript本地<code class="fe me mf mg mh b">Date</code>实例的<code class="fe me mf mg mh b">toString</code>方法返回的字符串中提取时区。</p><p id="07a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3655" class="mq lc iq mh b gy mr ms l mt mu">const split = new Date().toString().split(" ");<br/>const timeZone = split.slice(-3).join(' ')<br/>console.log(timeZone)</span></pre><p id="f268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在太平洋标准时区，那么<code class="fe me mf mg mh b">timeZone</code>应该是<code class="fe me mf mg mh b">‘(Pacific Standard Time)’</code>。</p><p id="f4de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将从<code class="fe me mf mg mh b">toString</code>返回的日期字符串用一个空格与<code class="fe me mf mg mh b">split</code>分开。</p><p id="ace4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用-3调用<code class="fe me mf mg mh b">slice</code>来获得字符串的最后3部分。</p><p id="b248" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">join</code>将它们连接在一起。</p><p id="293c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了使提取更容易，我们可以使用一个regex对象。</p><p id="b4a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b111" class="mq lc iq mh b gy mr ms l mt mu">const [timeZone] = new Date().toString().match(/([A-Z]+[\+-][0-9]+.*)/)<br/>console.log(timeZone)</span></pre><p id="0775" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获取日期字符串中包含大写字母、加号或减号、数字和时区名称的部分。</p><p id="db37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在它上面调用<code class="fe me mf mg mh b">match</code>来获得匹配。</p><p id="d40b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它返回一个对象，所以我们可以析构结果并将其赋给<code class="fe me mf mg mh b">timeZone</code>。</p><p id="6190" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以<code class="fe me mf mg mh b">timeZone</code>是:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="539e" class="mq lc iq mh b gy mr ms l mt mu">'GMT-0800 (Pacific Standard Time)'</span></pre><p id="627b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们只能通过书写来提取字母和数字部分:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1e71" class="mq lc iq mh b gy mr ms l mt mu">const [timeZone] = new Date().toString().match(/([A-Z]+[\+-][0-9]+)/)<br/>console.log(timeZone)</span></pre><p id="73dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">timeZone</code>得到<code class="fe me mf mg mh b">'GMT-0800'</code>。</p><p id="2f29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用以下内容提取括号中的文本:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d272" class="mq lc iq mh b gy mr ms l mt mu">const [timeZone] = new Date().toString().match(/\(([A-Za-z\s].*)\)/)<br/>console.log(timeZone)</span></pre><p id="ce31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe me mf mg mh b">timeZone</code>将会是<code class="fe me mf mg mh b">‘(Pacific Standard Time)‘</code>。</p><p id="84f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以通过编写以下内容来提取UTC的小时差异:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8274" class="mq lc iq mh b gy mr ms l mt mu">const [timeZone] = new Date().toString().match(/([-\+][0-9]+)\s/)<br/>console.log(timeZone)</span></pre><p id="584d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在太平洋标准时间时区，就会得到<code class="fe me mf mg mh b">'-0800'</code>。</p><h1 id="66f5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f708" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用JavaScript以多种方式获取用户的时区。</p><p id="78e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以从日期字符串中提取项目，或者我们可以使用库的内置方法来提取它们。</p><p id="254d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mv">更多内容看</em> <a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mv">说白了. io </em> </strong> </a> <strong class="kf ir"> <em class="mv">。</em> </strong> <em class="mv">报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mv">免费每周简讯点击这里</em> </strong> </a> <strong class="kf ir"> <em class="mv">。</em> </strong></p></div></div>    
</body>
</html>