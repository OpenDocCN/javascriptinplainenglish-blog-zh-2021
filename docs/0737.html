<html>
<head>
<title>Deno — Command-Line and Permissions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno —命令行和权限</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deno-command-line-and-permissions-e6fafadcd553?source=collection_archive---------18-----------------------#2021-02-14">https://javascript.plainenglish.io/deno-command-line-and-permissions-e6fafadcd553?source=collection_archive---------18-----------------------#2021-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8f8972ba3a805a9e76b5c1f413734d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HV63zhgATGyWETcH"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mael_bld?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mael BALLAND</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d239" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deno是一个新的服务器端运行时环境，用于运行JavaScript和TypeScript应用程序。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始为Deno开发应用程序。</p><h1 id="bc95" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">命令行界面</h1><p id="fa00" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过跑步获得帮助:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ef4c" class="mn lc iq mj b gy mo mp l mq mr">deno help</span></pre><p id="a9dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7565" class="mn lc iq mj b gy mo mp l mq mr">deno -h</span></pre><p id="df33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">简称。</p><p id="26b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b8c8" class="mn lc iq mj b gy mo mp l mq mr">deno --help</span></pre><p id="e511" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">做同样的事情。</p><h1 id="8b21" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">脚本参数</h1><p id="b225" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用<code class="fe ms mt mu mj b">Deno.args</code>属性在脚本中获得命令行参数。</p><p id="d920" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="5261" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.ts</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="02f3" class="mn lc iq mj b gy mo mp l mq mr">console.log(Deno.args);</span></pre><p id="bc8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1696" class="mn lc iq mj b gy mo mp l mq mr">deno run index.ts a b -c --quiet</span></pre><p id="cc64" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2dd7" class="mn lc iq mj b gy mo mp l mq mr">[ "a", "b", "-c", "--quiet" ]</span></pre><p id="8a1c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从控制台输出。</p><h1 id="762e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">许可</h1><p id="0b91" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">运行需要访问各种资源的代码需要权限。</p><p id="fd3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">默认情况下，必须特别启用它们。</p><p id="e66d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下权限可用:</p><ul class=""><li id="d028" class="mv mw iq kf b kg kh kk kl ko mx ks my kw mz la na nb nc nd bi translated"><code class="fe ms mt mu mj b">-A</code>，<code class="fe ms mt mu mj b"> — allow-all</code> —允许所有权限。这将禁用所有安全性。</li><li id="e69e" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-env</code> —允许环境访问，例如获取和设置环境变量。</li><li id="211b" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-hrtime </code> —允许高分辨率时间测量。高分辨率时间可用于计时攻击和指纹识别。</li><li id="bd3f" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-net=&lt;url&gt;</code> —允许网络访问。我们可以指定一个可选的逗号分隔的域列表，以提供允许域的允许列表。</li><li id="3a5b" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-plugin </code> —允许加载插件。请注意—允许插件是一个不稳定的特性。</li><li id="8ac0" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-read=&lt;allow-read&gt; </code> —允许文件系统读取访问。我们可以指定一个可选的逗号分隔的目录或文件列表，以提供允许文件系统访问的允许列表。</li><li id="2765" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-run </code> —允许运行子流程。请注意，子进程不是在沙箱中运行的，因此没有与Deno进程相同的安全限制。因此，慎用。</li><li id="9e3a" class="mv mw iq kf b kg ne kk nf ko ng ks nh kw ni la na nb nc nd bi translated"><code class="fe ms mt mu mj b">— allow-write=&lt;allow-write&gt; </code> —允许文件系统写访问。您可以指定可选的逗号分隔的目录或文件列表，以提供允许的文件系统访问的允许列表。</li></ul><p id="9c5b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，如果我们有一个发出HTTP请求的程序，比如:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="51b7" class="mn lc iq mj b gy mo mp l mq mr">const [url] = Deno.args;<br/>const res = await fetch(url);<br/>const body = new Uint8Array(await res.arrayBuffer());<br/>await Deno.stdout.write(body);</span></pre><p id="4f10" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用以下方式运行它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="41df" class="mn lc iq mj b gy mo mp l mq mr">deno run --allow-net index.ts https://yesno.wtf/api</span></pre><p id="9295" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让程序访问互联网。</p><h1 id="dac3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">权限API</h1><p id="c893" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe ms mt mu mj b">Deno.permissions.query</code>方法和一个拥有我们想要查询的权限的对象来查询表单权限。</p><p id="5480" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="23ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.ts</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d715" class="mn lc iq mj b gy mo mp l mq mr">const desc1 = { name: "read", path: "/foo" } as const;<br/>console.log(await Deno.permissions.query(desc1));</span><span id="417b" class="mn lc iq mj b gy nj mp l mq mr">const desc2 = { name: "read", path: "/foo/bar" } as const;<br/>console.log(await Deno.permissions.query(desc2));</span><span id="3c03" class="mn lc iq mj b gy nj mp l mq mr">const desc3 = { name: "read", path: "/bar" } as const;<br/>console.log(await Deno.permissions.query(desc3));</span></pre><p id="00df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="d2bd" class="mn lc iq mj b gy mo mp l mq mr">deno run --unstable index.ts</span></pre><p id="fe21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们看到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="da66" class="mn lc iq mj b gy mo mp l mq mr">PermissionStatus { state: "prompt" }<br/>PermissionStatus { state: "prompt" }<br/>PermissionStatus { state: "prompt" }</span></pre><p id="2158" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已登录控制台。</p><p id="de97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要<code class="fe ms mt mu mj b">--unstable</code>选项来使<code class="fe ms mt mu mj b">Deno.permissions.query</code>方法可用。</p><p id="6446" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过使用<code class="fe ms mt mu mj b">Deno.permissions.revoke</code>方法来撤销权限:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="15e4" class="mn lc iq mj b gy mo mp l mq mr">const desc = { name: "read", path: "/foo/bar" } as const;<br/>console.log(await Deno.permissions.revoke(desc));</span><span id="206a" class="mn lc iq mj b gy nj mp l mq mr">const strongDesc = { name: "read", path: "/foo" } as const;<br/>await Deno.permissions.revoke(strongDesc);</span></pre><p id="ab98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3553" class="mn lc iq mj b gy mo mp l mq mr">PermissionStatus { state: "prompt" }</span></pre><p id="a66f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">已显示。</p><h1 id="f897" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f709" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Deno获取和设置权限。</p><p id="229f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以在脚本中轻松获得命令行参数。</p><p id="8255" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>