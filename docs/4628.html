<html>
<head>
<title>How to Listen for Changes to HTML Elements with the contenteditable Attribute with JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript监听带有contenteditable属性的HTML元素的变化？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-listen-for-changes-to-html-elements-with-the-contenteditable-attribute-with-javascript-b715eeb4431e?source=collection_archive---------3-----------------------#2021-09-15">https://javascript.plainenglish.io/how-to-listen-for-changes-to-html-elements-with-the-contenteditable-attribute-with-javascript-b715eeb4431e?source=collection_archive---------3-----------------------#2021-09-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/19493f474f4374b33c6f49de04c58d4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HHSS8jQlGplSPWhm"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@arnelhasanovic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arnel Hasanovic</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a67f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加了<code class="fe lb lc ld le b">contenteditable</code>属性的元素允许用户编辑元素内部的内容。</p><p id="958f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能希望监听对元素进行的更改事件。</p><p id="e98d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何监听应用了<code class="fe lb lc ld le b">contenteditable</code>属性的元素中触发的更改。</p><h1 id="8b10" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">侦听元素发出的输入事件</h1><p id="059f" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">当我们改变添加了<code class="fe lb lc ld le b">contenteditable</code>属性的元素的内容时，就会发出<code class="fe lb lc ld le b">input</code>事件。</p><p id="4e6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们可以监听元素的<code class="fe lb lc ld le b">input</code>事件来监听其内容的变化。</p><p id="491a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以编写以下HTML:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="6880" class="mq lg iq le b gy mr ms l mt mu">&lt;div contenteditable&gt;<br/>  hello world<br/>&lt;/div&gt;</span></pre><p id="9fdb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe lb lc ld le b">addEventListener</code>添加一个事件监听器:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="24ac" class="mq lg iq le b gy mr ms l mt mu">const div = document.querySelector("div")<br/>div.addEventListener("input", (e) =&gt; {<br/>  console.log(e);<br/>}, false);</span></pre><p id="ca57" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们更改div中的内容时，我们将看到<code class="fe lb lc ld le b">input</code>事件监听器运行。</p><p id="f035" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe lb lc ld le b">e.target</code>属性获得元素的属性和样式。</p><p id="8c2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">e.timestamp</code>属性是创建事件的时间，以毫秒为单位。</p><h1 id="9b79" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated"><code class="fe lb lc ld le b">MutationObserver</code></h1><p id="a5bc" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们还可以使用<code class="fe lb lc ld le b">MutationObserver</code>来观察元素内容的变化。</p><p id="0270" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为它可以监听DOM中的变化，包括元素中的任何内容变化。</p><p id="6730" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="196c" class="mq lg iq le b gy mr ms l mt mu">const div = document.querySelector("div")<br/>const observer = new MutationObserver((mutationRecords) =&gt; {<br/>  console.log(mutationRecords[0].target.data)<br/>})<br/>observer.observe(div, {<br/>  characterData: true,<br/>  subtree: true,<br/>})</span></pre><p id="9f72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并保持HTML不变。</p><p id="d9f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传递一个带有<code class="fe lb lc ld le b">mutationRecords</code>对象的回调来获取突变记录。</p><p id="e26d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">chartacterData</code>设置为<code class="fe lb lc ld le b">true</code>表示我们观察文本内容的变化。</p><p id="49c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将<code class="fe lb lc ld le b">subtree</code>设置为<code class="fe lb lc ld le b">true</code>意味着我们观察元素的DOM子树变化。</p><p id="0581" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe lb lc ld le b">mutationRecords[0].target.data</code>属性获取div的最新内容。</p><h1 id="c5a9" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="fdc1" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以通过应用了<code class="fe lb lc ld le b">MutationObserver</code>的<code class="fe lb lc ld le b">contenteditable</code>属性来观察HTML内容的变化，或者监听元素的<code class="fe lb lc ld le b">input</code>事件。</p><p id="43b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mv">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mv">plain English . io</em></strong></a><em class="mv">。报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mv">免费周报</em> </strong> </a> <em class="mv">。关注我们关于</em><a class="ae kc" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mv">Twitter</em></strong></a><em class="mv">和</em><a class="ae kc" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mv">LinkedIn</em></strong></a><em class="mv">。加入我们的</em> <a class="ae kc" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mv">社区不和谐</em> </strong> </a> <em class="mv">。</em></p></div></div>    
</body>
</html>