<html>
<head>
<title>A Comprehensive MongoDB Tutorial for Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个全面的MongoDB初学者教程</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/mongodb-tutorial-76748a5549f8?source=collection_archive---------12-----------------------#2021-07-11">https://javascript.plainenglish.io/mongodb-tutorial-76748a5549f8?source=collection_archive---------12-----------------------#2021-07-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c1aa" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过创建Node.js应用程序，开始使用MongoDB &amp; Mongoose</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4d2322262c1f6a814dcd21db97ed8a50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FHK6-4edbmJvcNCr.jpg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://www.pexels.com/@donghuangmingde?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Huỳnh Đạt</a> from <a class="ae ks" href="https://www.pexels.com/photo/books-on-shelves-2177482/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><h2 id="d3a9" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">内容</h2><h2 id="df85" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><a class="ae ks" href="#f35a" rel="noopener ugc nofollow"> 1。概述</a></h2><h2 id="3ccd" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><a class="ae ks" href="#9f4e" rel="noopener ugc nofollow"> 2。安装</a></h2><ul class=""><li id="9b4e" class="lp lq in lr b ls lt lu lv lc lw lg lx lk ly lz ma mb mc md bi translated"><a class="ae ks" href="#7016" rel="noopener ugc nofollow">T5【快速安装(Ubuntu 20.04)T7】</a></li><li id="1a69" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><a class="ae ks" href="#03d1" rel="noopener ugc nofollow"> <strong class="lr io">使用Docker </strong> </a></li><li id="4ce0" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><a class="ae ks" href="#7c61" rel="noopener ugc nofollow"> <strong class="lr io"> MongoDB图集</strong> </a></li></ul><h2 id="04cf" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><a class="ae ks" href="#e267" rel="noopener ugc nofollow"> <strong class="ak"> 3。MongoDB GUI </strong> </a></h2><h2 id="8c5f" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><a class="ae ks" href="#7d0d" rel="noopener ugc nofollow"> 4。连接我们的应用程序</a></h2><ul class=""><li id="49cb" class="lp lq in lr b ls lt lu lv lc lw lg lx lk ly lz ma mb mc md bi translated"><a class="ae ks" href="#d067" rel="noopener ugc nofollow"> <strong class="lr io">初始设置</strong> </a></li><li id="846b" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><a class="ae ks" href="#a275" rel="noopener ugc nofollow"> <strong class="lr io">利用獴</strong> </a></li><li id="922a" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><a class="ae ks" href="#7ac9" rel="noopener ugc nofollow"> <strong class="lr io">使用模型</strong> </a>创建&amp;</li><li id="9de6" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><a class="ae ks" href="#8548" rel="noopener ugc nofollow"><strong class="lr io"/></a><strong class="lr io">:</strong><a class="ae ks" href="#0b34" rel="noopener ugc nofollow"><strong class="lr io">查看所有书籍</strong> </a> <strong class="lr io">，</strong> <a class="ae ks" href="#e41e" rel="noopener ugc nofollow"> <strong class="lr io">添加书籍</strong> </a> <strong class="lr io">，</strong> <a class="ae ks" href="#53aa" rel="noopener ugc nofollow"> <strong class="lr io">获取书籍</strong> </a> <strong class="lr io">，</strong> <a class="ae ks" href="#3acb" rel="noopener ugc nofollow"> <strong class="lr io">添加评论</strong> </a> <strong class="lr io">，</strong> <a class="ae ks" href="#8a16" rel="noopener ugc nofollow"/></li></ul><h2 id="397c" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><a class="ae ks" href="#caca" rel="noopener ugc nofollow"> 5。结论</a></h2></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="f35a" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">概观</h2><p id="e752" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">本教程面向懂一点JavaScript并想开始使用MongoDB的初学者。</p><p id="c324" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们将用<strong class="lr io"> MongoDB </strong>作为我们的数据库，使用<strong class="lr io"> Express </strong>框架创建一个<strong class="lr io"> NodeJS </strong>应用程序。这是一个简单的个人图书馆，在这里我们可以:</p><ul class=""><li id="dec0" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">查看图书列表。</li><li id="50f7" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">加一本书。</li><li id="97b5" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">添加关于图书的评论。</li><li id="a6b1" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">查看特定图书及其相关评论。</li><li id="01a8" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">删除一本书。</li><li id="ed3d" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">从图书馆删除所有的书。</li></ul><p id="9626" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">本教程有一节概述了各种MongoDB安装选项。如果您已经安装了它，请跳到<a class="ae ks" href="#7d0d" rel="noopener ugc nofollow">连接我们的应用程序</a>部分。</p><p id="7352" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">先解决后端吧。本节假设您已经安装了NodeJS，但没有安装MongoDB。如果没有，<a class="ae ks" href="https://docs.npmjs.com/downloading-and-installing-node-js-and-npm" rel="noopener ugc nofollow" target="_blank">这里有一个快速指南</a>。有许多方法可以运行和使用MongoDB。回顾并选择一个对你最方便的。</p><p id="99d5" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">就设置的容易程度而言，MongoDB Atlas是启动和运行的最快方式，其次是Docker(如果已经安装了的话),否则只需使用快速安装方法，除非您使用的是Windows或Mac。老实说，不知道为什么他们在下面的顺序🤷🏾‍♂️️.</p><p id="5bcb" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">无论您使用安装的还是托管的MongoDB版本，我都推荐安装一个MongoDB GUI，它为MongoDB数据库提供了一个用户界面。有了GUI，我们可以可视化数据和编辑查询，而无需使用shell命令。参考下面的<a class="ae ks" href="#e267" rel="noopener ugc nofollow"> MongoDB GUI部分</a></p></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h1 id="9f4e" class="nl ku in bd kv nm nn no ky np nq nr lb jt ns ju lf jw nt jx lj jz nu ka ln nv bi translated">MongoDB安装</h1><h2 id="7016" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak"> 1。快速安装(Ubuntu 20.04) </strong></h2><ul class=""><li id="2535" class="lp lq in lr b ls lt lu lv lc lw lg lx lk ly lz ma mb mc md bi translated">通过运行以下命令，为MongoDB的最新稳定版本导入公共GPG密钥。</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="0be5" class="kt ku in nx b gy ob oc l od oe">curl -fsSL https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -</span></pre><ul class=""><li id="65e8" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">为MongoDB创建一个<code class="fe of og oh nx b">sources.list</code>文件，将它列为APT数据的活动源。在这种情况下，文件是在<code class="fe of og oh nx b">sources.list.d</code>文件夹中的<code class="fe of og oh nx b">mongodb-org-4.4.list</code>。</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="7e3e" class="kt ku in nx b gy ob oc l od oe">echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list</span></pre><ul class=""><li id="2035" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">更新本地包索引以便APT知道在哪里可以找到<code class="fe of og oh nx b">mongodb-org</code>包，并安装MongoDB <strong class="lr io">。</strong></li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="4cec" class="kt ku in nx b gy ob oc l od oe">sudo apt update; sudo apt install mongodb-org -y</span></pre><ul class=""><li id="702f" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">启动MongoDB服务:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="214b" class="kt ku in nx b gy ob oc l od oe">sudo systemctl start mongod.service</span></pre><ul class=""><li id="749c" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">使用以下命令检查MongoDB服务的状态:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="16af" class="kt ku in nx b gy ob oc l od oe">sudo systemctl status mongod</span></pre><ul class=""><li id="b62e" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">输出:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="aed1" class="kt ku in nx b gy ob oc l od oe">● mongod.service - MongoDB Database Server<br/>    Loaded: loaded (/lib/systemd/system/mongod.service; enabled; vendor preset: enabled)<br/>    Active: active (running) since Sun 2021-07-04 13:35:51 CAT; 2 days ago<br/>    Docs: <a class="ae ks" href="https://docs.mongodb.org/manual" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.org/manual</a><br/>    Main PID: 1251 (mongod)<br/>    Memory: 78.6M.<br/>    CGroup: /system.slice/mongod.service<br/>        └─1251 /usr/bin/mongod --config /etc/mongod.conf</span></pre><p id="4c4e" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><a class="ae ks" href="https://www.digitalocean.com/community/tutorials/how-to-secure-mongodb-on-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank">进一步保护您的MongoDB安装</a>(可选)。</p><h2 id="03d1" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak"> 2。使用Docker </strong></h2><ul class=""><li id="6351" class="lp lq in lr b ls lt lu lv lc lw lg lx lk ly lz ma mb mc md bi translated">在<a class="ae ks" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank"> Ubuntu </a>或<a class="ae ks" href="https://docs.docker.com/desktop/" rel="noopener ugc nofollow" target="_blank"> Mac或Windows </a>上安装Docker。</li><li id="1512" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">从Docker Hub中提取MongoDB映像。</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="d3d1" class="kt ku in nx b gy ob oc l od oe">docker pull mongo</span></pre><ul class=""><li id="2300" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">运行MongoDB实例，并使用<code class="fe of og oh nx b">— name</code>选项为容器指定一个名称。</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="172c" class="kt ku in nx b gy ob oc l od oe">docker run — name mongodb -p 27017:27017 -d mongo</span></pre><ul class=""><li id="69e9" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">要在<code class="fe of og oh nx b">27017</code>之外的另一个端口上运行MongoDB，例如<code class="fe of og oh nx b">37017</code> <strong class="lr io"> </strong>:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="bb5c" class="kt ku in nx b gy ob oc l od oe">docker run — name mongodb -p 37017:27017 -d mongo</span></pre><ul class=""><li id="7d04" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">输出将是指示容器ID的字符串:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="3002" class="kt ku in nx b gy ob oc l od oe">470d71083f835c…</span></pre><ul class=""><li id="143c" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">要检查Docker是否正在运行:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="9838" class="kt ku in nx b gy ob oc l od oe">docker ps</span></pre><ul class=""><li id="ccdd" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">输出:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="0a01" class="kt ku in nx b gy ob oc l od oe">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS       NAMES 470d71083f83   mongo     "docker-entrypoint.s…"   2 minutes ago   Up 2 minutes   27017/tcp   mongodb</span></pre><ul class=""><li id="f3ba" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">如果容器在创建后由于某种原因停止了，只需运行:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="8fc8" class="kt ku in nx b gy ob oc l od oe">docker start mongodb</span></pre><ul class=""><li id="01e3" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">要一起停止容器:</li></ul><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="9979" class="kt ku in nx b gy ob oc l od oe">docker stop mongodb</span></pre><h2 id="7c61" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated"><strong class="ak"> 3。MongoDB图集</strong></h2><ul class=""><li id="0c31" class="lp lq in lr b ls lt lu lv lc lw lg lx lk ly lz ma mb mc md bi translated">或者，您可以通过使用<strong class="lr io"> MongoDB Atlas </strong>来使用托管在云中的MongoDB。</li><li id="4215" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">创建一个账户。有一个免费层可用。</li><li id="96f8" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">注册后，您将被要求命名您的组织和项目以及首选语言。</li><li id="629a" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">在<code class="fe of og oh nx b"><strong class="lr io">Shared Clusters</strong></code>选项卡上创建一个集群。</li><li id="b3ce" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">出于测试的目的，选择一个离您自己的地理位置更近的地区，其他一切保持不变，可能会改变<code class="fe of og oh nx b"><strong class="lr io">Cluster Name</strong></code>。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oi"><img src="../Images/98d4c58c1e70d1c0a5ebaee465e81de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EeG23or0o8-1QgMu.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Atlas setup</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oj"><img src="../Images/0edbcf5b92761a8aabe5f77e7e91c4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ir6ySEhlYDP2bjSZ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Atlas cluster name</figcaption></figure><ul class=""><li id="12de" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">选择页面底部的<code class="fe of og oh nx b"><strong class="lr io">Create Cluster</strong></code>。</li><li id="fb1b" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">等待集群创建完成，然后点击集群名称下方的<code class="fe of og oh nx b"><strong class="lr io">CONNECT</strong></code>选项卡。这一部分可能会因您的浏览器而异。可能会要求您首先创建一个数据库用户。</li><li id="e38c" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">要创建或添加新的数据库用户，点击屏幕左侧<code class="fe of og oh nx b"><strong class="lr io">SECURITY</strong></code>下的<code class="fe of og oh nx b"><strong class="lr io">Database Access</strong></code>选项卡。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/d1ba57ce5d2ee5cd6718e080712fcd0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ExMAsvz_PK7Tf5Kh.png"/></div></div></figure><ul class=""><li id="c3a5" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">要更改或添加IP地址，选择<code class="fe of og oh nx b"><strong class="lr io">SECURITY</strong></code>下的<code class="fe of og oh nx b"><strong class="lr io">Network Access</strong></code>选项卡。</li><li id="c4c7" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">假设您没有存储敏感数据，单击<code class="fe of og oh nx b"><strong class="lr io">Allow Access from Anywhere</strong></code>按钮，保持原样并选择<code class="fe of og oh nx b"><strong class="lr io">Add IP Address</strong></code>。或者，如果您看不到该选项，请参见下文。</li><li id="1d4e" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">使用用户名和口令创建数据库用户。点击<code class="fe of og oh nx b"><strong class="lr io">Create User</strong></code>。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/983b4dc173f48ca01d6e02f4b8d96a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/0*Nq13PtKJzv7atYA_.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create database user using a username and password</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi om"><img src="../Images/1ad0ed77b2a6f40e960f81f4685aaa50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HyswK5NgKM0wze87.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Select My Local Environment</figcaption></figure><ul class=""><li id="9b30" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">要允许您的应用程序访问MongoDB Atlas，请在<code class="fe of og oh nx b"><strong class="lr io">IP Address</strong></code>字段中输入<code class="fe of og oh nx b">0.0.0.0/0</code>并输入<code class="fe of og oh nx b"><strong class="lr io">Add Entry</strong></code>。</li><li id="2d17" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">通过点击<code class="fe of og oh nx b"><strong class="lr io">SECURITY</strong></code>下的<code class="fe of og oh nx b"><strong class="lr io">Network Access</strong></code>选项卡，可以添加或更改IP</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi gj"><img src="../Images/63ce19ad0fdb00ccc060fd797cf329dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vDbvxZOjEE7Kpbod.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Allow app to access MongoDB Atlas from anywhere.</figcaption></figure><ul class=""><li id="3665" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">通过选择第二个选项<code class="fe of og oh nx b">Connect your application</code>选择连接方式。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi on"><img src="../Images/5ce4e7fefd2684baf2ec279837e4e02f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*thoVEggjc-4525Ia.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Atlas Connect your application</figcaption></figure><ul class=""><li id="f9d6" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">将步骤2中的连接字符串复制到安全位置。用创建数据库用户时使用的密码替换<code class="fe of og oh nx b">&lt;password&gt;</code>。我们将在应用程序中将它用作环境变量。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oo"><img src="../Images/fab48bacf18af8f78da422b07d91dbbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OYCPuMaD7sSje1kC.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Atlas connection string</figcaption></figure><ul class=""><li id="a48b" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated"><code class="fe of og oh nx b">Close</code>。</li><li id="0074" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">点击<code class="fe of og oh nx b">COLLECTIONS</code>创建一个数据库。创建数据库和收藏后，它们将出现在此处。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ok"><img src="../Images/741632b238598bd8ae75bc527dced1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WKxRsouI-zRwGyWx.png"/></div></div></figure><ul class=""><li id="3087" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">选择<code class="fe of og oh nx b">Add My Own Data</code>并为您的数据库和收藏命名</li><li id="6f35" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">您应该会看到您创建的数据库和集合。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi op"><img src="../Images/f293d3285e8cba9ee20e83b926653a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ISnuSU6Hx4WFm1aT.png"/></div></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h1 id="e267" class="nl ku in bd kv nm nn no ky np nq nr lb jt ns ju lf jw nt jx lj jz nu ka ln nv bi translated">MongoDB GUI</h1><p id="a5a9" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">MongoDB GUI有许多选项可以提高MongoDB的易用性，并与上述3种方法兼容，例如MongoDB Compass、Robo3T、Studio3T。</p><p id="a3be" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在本教程中，我们将使用MongoDB指南针。</p><p id="08c8" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">下载你的系统版本，安装后打开。</p><p id="1b7d" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果您使用本地MongoDB实例，确保它正在运行，然后选择<code class="fe of og oh nx b">Fill in connection fields individually</code>。除非设置期间指定的端口不是<code class="fe of og oh nx b">27017</code>，否则保留设置。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/cf30165696381497e1ef82a0f342c9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/0*rpBcDD87ezx9fMKo.png"/></div></figure><p id="c8fb" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果使用MongoDB Atlas，粘贴通过在集群中单击<code class="fe of og oh nx b">CONNECT</code>选项卡获得的连接字符串。记得更换<code class="fe of og oh nx b">&lt;password&gt;</code>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/c314e2822ac7e5376165a421804c94f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/0*h4GhS2LcYhZ0N3zM.png"/></div></figure><ul class=""><li id="059b" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">除了您创建的任何其他数据库之外，您还应该看到<code class="fe of og oh nx b">admin</code>、<code class="fe of og oh nx b">local</code>、&amp;、<code class="fe of og oh nx b">config</code>数据库。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi or"><img src="../Images/f1d42d59fed19f0498734e1734b07a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KZcXMyyrl9VMyknv.png"/></div></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h1 id="7d0d" class="nl ku in bd kv nm nn no ky np nq nr lb jt ns ju lf jw nt jx lj jz nu ka ln nv bi translated">连接我们的应用程序</h1><h2 id="d067" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">初始设置</h2><p id="8280" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">我们的应用程序将具有以下文件夹结构:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi os"><img src="../Images/c59f9f729f157a150cfb0a710c8a39a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/0*e8JibaLGU_mpPbDe.png"/></div></div></figure><p id="c6d9" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">通过首先为应用程序创建一个空目录来初始化应用程序:</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="65ec" class="kt ku in nx b gy ob oc l od oe">mkdir personal-library</span></pre><p id="655d" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">切换到创建的目录:</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="14d8" class="kt ku in nx b gy ob oc l od oe">cd personal-library</span></pre><p id="18b0" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">使用<code class="fe of og oh nx b">express-generator</code>生成一个准系统应用:</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="d95f" class="kt ku in nx b gy ob oc l od oe">npx express-generator</span></pre><p id="799a" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">用以下内容替换<code class="fe of og oh nx b">package.json</code>的内容，并安装依赖项。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">package.json</figcaption></figure><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="7c0c" class="kt ku in nx b gy ob oc l od oe">npm i</span></pre><p id="f6d1" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在应用程序的根目录下创建一个<code class="fe of og oh nx b">.env</code>文件。根据您正在使用的MongoDB实例的类型使用适当的变量名，如果使用MongoDB Atlas，则使用<code class="fe of og oh nx b">MONGO_ATLAS</code>。从您的MongoDB Atlas帐户获取连接字符串。更换<code class="fe of og oh nx b">&lt;password&gt;</code>。</p><p id="520b" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果使用MongoDB的本地实例，请使用<strong class="lr io"> </strong> <code class="fe of og oh nx b">MONGO_LOCAL</code>。格式为<code class="fe of og oh nx b">mongodb://localhost:27017/&lt;database&gt;</code>。用数据库的名称替换<code class="fe of og oh nx b">&lt;database&gt;</code>。在这种情况下，使用<code class="fe of og oh nx b">library</code>。</p><p id="f505" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">删除不使用的。</p><p id="cc53" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果数据库不存在，它将被创建。</p><p id="5267" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">该文件应该类似于以下两行中的任何一行:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="e1a8" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果你计划提交这个项目，创建一个<code class="fe of og oh nx b">.gitignore</code>文件并在其中包含<code class="fe of og oh nx b">.env </code>。这里有一个有用的repo ，它有针对不同编程语言和框架的<code class="fe of og oh nx b">.gitignore</code>文件。</p><p id="f970" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">通过在应用程序的根目录下运行以下命令，直接创建一个包含NodeJS必要规范的<code class="fe of og oh nx b">.gitignore</code>文件。</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="b7f6" class="kt ku in nx b gy ob oc l od oe">wget -O .gitignore <a class="ae ks" href="https://raw.githubusercontent.com/github/gitignore/master/Node.gitignore" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/github/gitignore/master/Node.gitignore</a></span></pre><p id="da89" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">或者，如果您必须手动完成，请在应用程序的根目录中:</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="abd2" class="kt ku in nx b gy ob oc l od oe">touch .gitignore</span></pre><p id="13bf" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">将文件的内容复制到其中。</p><p id="5c70" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">用以下初始设置替换<code class="fe of og oh nx b">app.js</code>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div></figure><p id="36c9" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">将<code class="fe of og oh nx b">views</code>文件夹中的<code class="fe of og oh nx b">index.jade</code>文件重命名为<code class="fe of og oh nx b">index.html</code>文件，并将内容替换为:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">views/index.html</figcaption></figure><p id="5c77" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">删除其他<code class="fe of og oh nx b">.jade</code> <strong class="lr io"> </strong>文件。</p><p id="25c2" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">同样将下面的JavaScript和CSS内容分别复制到<code class="fe of og oh nx b">public/javascripts/client.js</code> &amp; <code class="fe of og oh nx b">public/stylesheets/style.css</code>中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">public/javascripts/client.js</figcaption></figure><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">public/stylesheets/style.css</figcaption></figure><p id="44a7" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">客户端JavaScript被忽略了，因为它不是本教程的重点。但是你可以在文档中查找<a class="ae ks" href="https://api.jquery.com/jquery/" rel="noopener ugc nofollow" target="_blank">使用的jQuery方法。</a></p><p id="2e04" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在<code class="fe of og oh nx b">routes</code>文件夹中创建一个文件<code class="fe of og oh nx b">api.js</code>，它将保存我们的路线。我们不需要其他文件，所以可以删除它们。<br/>通过这些路线，我们将能够:</p><ul class=""><li id="e1ef" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated">查看所有书籍👉🏾️ <code class="fe of og oh nx b">GET</code>请求到<code class="fe of og oh nx b">/api/books</code>。</li><li id="8508" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">添加一本书👉🏾️ <code class="fe of og oh nx b">POST</code>请求到<code class="fe of og oh nx b">/api/books</code>。</li><li id="4e38" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">删除所有书籍👉🏾️ <code class="fe of og oh nx b">DELETE</code>请求到<code class="fe of og oh nx b">/api/books</code>。</li><li id="ce6b" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">查看一本书👉🏾️ <code class="fe of og oh nx b">GET</code>请求到<code class="fe of og oh nx b">/api/books/:id</code>。</li><li id="0a56" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">在现有图书上添加评论👉🏾️ <code class="fe of og oh nx b">POST</code>请求到<code class="fe of og oh nx b">/api/books/:id</code>。</li><li id="f83c" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated">删除一本书👉🏾️对<code class="fe of og oh nx b">/api/books/:id</code>的<code class="fe of og oh nx b">DELETE</code>请求。</li></ul><p id="b573" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们最初的<code class="fe of og oh nx b">api.js</code>文件类似于:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js</figcaption></figure><p id="1393" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">导入并实例化<code class="fe of og oh nx b">app.js</code>中的路线(线路<code class="fe of og oh nx b">5</code> &amp; <code class="fe of og oh nx b">19</code>)。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">app.js</figcaption></figure><p id="f8a1" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们可以通过运行下面的命令来查看我们的应用程序的前端，并导航到<a class="ae ks" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>。</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="c85e" class="kt ku in nx b gy ob oc l od oe">npm start</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/a0ebb329bdca9076f542f4f0db55b1c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/0*N9SjI3GJxTAfCM6c.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Front-end, personal library app</figcaption></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="a275" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">使用<code class="fe of og oh nx b">mongoose</code></h2><p id="0aaa" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">我们将使用<code class="fe of og oh nx b">mongoose</code>，一个为MongoDB实现对象文档映射方法的模块。</p><p id="f63d" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">它简化了CRUD ( <a class="ae ks" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete#RESTful_APIs" rel="noopener ugc nofollow" target="_blank">创建、读取、更新和删除</a>)操作、文档验证和其他功能，而不太关心文档如何与其数据源相关联。</p><p id="9cfe" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">通过将应用程序导入<code class="fe of og oh nx b">app.js</code>来设置应用程序以使用<code class="fe of og oh nx b">mongoose</code>。然后，我们将使用它来建立到数据库的连接。</p><p id="5021" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">取消注释适当的行<code class="fe of og oh nx b">12</code>或<code class="fe of og oh nx b">13</code>，根据您的MongoDB设置定义变量<code class="fe of og oh nx b">DB</code> <strong class="lr io"> </strong>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">app.js</figcaption></figure><p id="4bdc" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">注意<code class="fe of og oh nx b">dotenv</code>模块在<code class="fe of og oh nx b">2</code>行导入。这允许我们从之前创建的<code class="fe of og oh nx b">.env</code>文件中加载环境变量。我们可以通过<code class="fe of og oh nx b">process.env</code>作为<code class="fe of og oh nx b">process.env.VARIABLE_NAME</code>在整个应用程序中访问这些变量。在这种情况下，我们的变量不是<code class="fe of og oh nx b">MONGO_LOCAL</code>就是<code class="fe of og oh nx b">MONGO_ATLAS</code>。使用环境变量允许为不同的环境设置不同的配置选项。</p></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="7ac9" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">创建和使用模型</h2><p id="4ff4" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">接下来，我们将创建一个文件夹来存放应用程序模型。模型是我们用来向数据库发送数据的对象。在这种情况下，我们只有一个模型— <code class="fe of og oh nx b">Book</code>，它具有以下属性:</p><ul class=""><li id="55e5" class="lp lq in lr b ls nd lu ne lc ni lg nj lk nk lz ma mb mc md bi translated"><code class="fe of og oh nx b">title</code>用字符串表示。</li><li id="e4c5" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><code class="fe of og oh nx b">comments</code>由字符串数组表示。</li><li id="3aae" class="lp lq in lr b ls me lu mf lc mg lg mh lk mi lz ma mb mc md bi translated"><code class="fe of og oh nx b">commentcount</code>用数字表示，初始值为<code class="fe of og oh nx b">0</code>。</li></ul><p id="f957" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">创建<code class="fe of og oh nx b">models</code>目录。</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="f98f" class="kt ku in nx b gy ob oc l od oe">mkdir models</span></pre><p id="04d0" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在<code class="fe of og oh nx b">models</code>文件夹中创建<code class="fe of og oh nx b">book.js</code>文件。</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="79a7" class="kt ku in nx b gy ob oc l od oe">touch models/book.js</span></pre><p id="eb98" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们将为一本书创建一个模式。<code class="fe of og oh nx b">mongoose</code>中的一个模式映射到一个MongoDB集合，并定义存储在该集合中的文档的形状。文档的形状指的是模式中定义的属性(<code class="fe of og oh nx b">title</code>、<code class="fe of og oh nx b">comments</code>、&amp;、<code class="fe of og oh nx b">commentcount</code>)。</p><p id="f534" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">为了使用我们的模式定义，我们需要将<code class="fe of og oh nx b">bookSchema</code>转换成一个模型(<code class="fe of og oh nx b">line 10</code>)，这是一个从模式定义编译而来的奇特的构造函数。当我们添加一本书时，就创建了一个模型的实例。这个模型实例是一个文档，然后存储在数据库的集合中。</p><p id="f592" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">第<code class="fe of og oh nx b">2</code>行是<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#object_destructuring" rel="noopener ugc nofollow" target="_blank">对象析构</a>的一个例子，它可以将数组中的值或对象中的属性解包到不同的变量中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">models/book.js</figcaption></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="8548" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">定义路线</h2><p id="1284" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">我们可以在路由中使用我们的<code class="fe of og oh nx b">Book</code>模型来执行CRUD功能。将其导入<code class="fe of og oh nx b">routes/api.js</code>。我们将定义的第一条路线是获取图书列表。</p><p id="0b34" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><strong class="lr io">查看所有书籍</strong></p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js</figcaption></figure><p id="c4f1" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们使用<code class="fe of og oh nx b">mongoose</code>的<code class="fe of og oh nx b">Model.find()</code>方法。将空对象<code class="fe of og oh nx b">{}</code>作为参数传递给<code class="fe of og oh nx b">find</code>方法将返回所有文档。如果连接不成功，将抛出一个错误并记录到控制台中。如果只有一条语句，花括号(<code class="fe of og oh nx b">{}</code>)可以从<code class="fe of og oh nx b">if</code>语句中省略，在这种情况下我们抛出错误。</p><p id="c0ae" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">如果我们在浏览器中导航到<a class="ae ks" href="http://localhost:3000/api/books" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/books</a>，我们会得到一个空数组，因为我们的集合仍然是空的。</p><p id="e41e" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><strong class="lr io">加一本书</strong></p><p id="7aca" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">为了向库中添加一本书，我们的<code class="fe of og oh nx b">POST</code>方法检查请求体是否有属性<code class="fe of og oh nx b">title</code>并且是否是一个非空字符串，否则抛出一个错误，指示缺少一个必需的字段。创建了一个<code class="fe of og oh nx b">Book</code>模型的新实例，保存的文档作为<code class="fe of og oh nx b">JSON</code>返回</p><p id="73d5" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">编辑<code class="fe of og oh nx b">/api/books</code>路线的<code class="fe of og oh nx b">POST</code>方法。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.</figcaption></figure><p id="3c50" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">从我们的运行前端，让我们添加一本书，如炼金术士。当我们访问<a class="ae ks" href="http://localhost:3000/api/books" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/books</a>时，返回一个包含添加的图书的数组</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/4704a64bcd401e78d77cf64792abdbc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/0*cRM94zvHE0OjFKQT.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">JSON Viewer in a browser</figcaption></figure><p id="3bdd" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">返回的book对象有两个附加的新属性<code class="fe of og oh nx b">_id</code>和<code class="fe of og oh nx b">__v</code>。<code class="fe of og oh nx b">_id</code>是MongoDB自动分配给存储在集合中的每个文档的惟一ID。我们将使用这个属性与其他路径中的一本书进行交互。</p><p id="35f4" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><code class="fe of og oh nx b">__v</code>是由mongoose首次创建时在每个文档上设置的属性。该键值包含文档的内部修订。</p><p id="b43a" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在MongoDB Compass中也有同样的体现。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi or"><img src="../Images/f6c058860c0457fd18f3c67cd6400e0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1zuCutVGgMTo9J15.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Compass database.collection with document</figcaption></figure><p id="a8ee" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">继续将更多的书添加到数据库中。您应该会看到前端和MongoDB Compass上的书籍列表。</p><p id="53aa" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">查看/获得一本书</p><p id="4e1e" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">当向<code class="fe of og oh nx b">/api/books/{bookId} </code>发出<code class="fe of og oh nx b">GET</code>请求时，我们检索一本书，其中<code class="fe of og oh nx b">bookId</code>是一个动态URL的占位符。在路由<code class="fe of og oh nx b">/api/books/:id</code>中，URL的<code class="fe of og oh nx b">:id </code>段是一个路由参数。它用于捕获URL中该位置指定的值。在这种情况下，一本书的<code class="fe of og oh nx b">id</code>。捕获的值存储在<code class="fe of og oh nx b">req.params</code>对象中，以路线参数的名称(<code class="fe of og oh nx b">id</code>)作为关键字。</p><p id="2d14" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">当我们单击列表中的第一本书时，将显示书名及其id。在这个例子中，id为<code class="fe of og oh nx b">60e79c75e3280d4c52fce456</code>的炼金术士将在URL中被捕获，并通过<code class="fe of og oh nx b">req.params.id</code>被访问。</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="00a9" class="kt ku in nx b gy ob oc l od oe">Route path: /api/books/:id</span><span id="0a60" class="kt ku in nx b gy ox oc l od oe">Request URL: <a class="ae ks" href="http://localhost:3000/api/books/60e79c75e3280d4c52fce456" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/books/60e79c75e3280d4c52fce456</a></span><span id="9493" class="kt ku in nx b gy ox oc l od oe">req.params: { "id": "60e79c75e3280d4c52fce456" }</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js GET /api/books/:id</figcaption></figure><p id="0b4f" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">从第<code class="fe of og oh nx b">56</code>-<code class="fe of og oh nx b">68</code>行定义了一本书的<code class="fe of og oh nx b">GET</code>方法。我们从<code class="fe of og oh nx b">req.params</code>对象中获取图书的ID。如果没有找到ID，我们抛出一个错误。我们使用<code class="fe of og oh nx b">mongoose</code>的<code class="fe of og oh nx b">Model.findById()</code>方法，将ID作为参数传入。<code class="fe of og oh nx b">orFail()</code>方法附加到查询中，如果没有找到匹配的文档，即查询中使用了无效的id，则抛出错误。匹配的图书作为<code class="fe of og oh nx b">JSON</code>返回，由客户端JavaScript解析，并显示图书及其评论。</p><p id="7f5d" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们捕获<code class="fe of og oh nx b">mongoose</code>的<code class="fe of og oh nx b">CastError</code>，当<code class="fe of og oh nx b">mongoose</code>无法将过滤器(<code class="fe of og oh nx b">id</code>)转换到我们的模式时，返回该消息。即使我们遇到这个错误，这也能让应用程序继续运行。</p><h2 id="3acb" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">添加评论</h2><p id="8677" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">单击列表中的一本书会打开一个表单，允许我们向该书添加评论。在添加实际注释时，表格数据被发送到<code class="fe of og oh nx b">/api/books/:id</code>。表单数据在<code class="fe of og oh nx b">req.body</code>对象中被捕获。例如添加评论ID为<code class="fe of og oh nx b">60e79c75e3280d4c52fce456</code>的炼金术士:</p><pre class="kd ke kf kg gt nw nx ny nz aw oa bi"><span id="e3bf" class="kt ku in nx b gy ob oc l od oe">Route path: /api/books/:id</span><span id="5afa" class="kt ku in nx b gy ox oc l od oe">Request URL: <a class="ae ks" href="http://localhost:3000/api/books/60e79c75e3280d4c52fce456" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/api/books/60e79c75e3280d4c52fce456</a></span><span id="562a" class="kt ku in nx b gy ox oc l od oe">req.params: { "id": "60e79c75e3280d4c52fce456" }</span><span id="126d" class="kt ku in nx b gy ox oc l od oe">req.body: { "comment": "Great book" }</span></pre><p id="167b" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">让我们更新<code class="fe of og oh nx b">/api/books/:id</code>路线的<code class="fe of og oh nx b">POST</code>方法</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js POST /api/books/:id</figcaption></figure><p id="5e67" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">我们分别从<code class="fe of og oh nx b">req.params</code>和<code class="fe of og oh nx b">req.body</code>对象中获取图书的标识和注释。如果注释为空，则会引发错误。我们使用猫鼬的<code class="fe of og oh nx b">Model.findOneAndUpdate()</code>方法，通过<code class="fe of og oh nx b">id</code>和<code class="fe of og oh nx b">comment</code>以及其他选项作为论据。</p><p id="e891" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">第一个参数是用<code class="fe of og oh nx b">_id</code>找到的对象。MongoDB的<code class="fe of og oh nx b">$push</code>运算符将一个指定的值附加到带有该特定的<code class="fe of og oh nx b">_id</code>的文档中的一个数组中。在这种情况下，对<code class="fe of og oh nx b">comments</code>数组的新添加注释。<code class="fe of og oh nx b">$inc</code>运算符将字段增加指定的值。在这里，我们每次添加评论时都会将<code class="fe of og oh nx b">commentcount</code>、<code class="fe of og oh nx b">versionKey</code> ( <code class="fe of og oh nx b">__v</code>)增加<code class="fe of og oh nx b">1</code>。我们增加了<code class="fe of og oh nx b">new: true</code>选项，以便在更新时修改后返回文档。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/0a39daba50d10dc528cdba2dbd7d0834.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/0*UHI_y-q-HFFylpB-.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Personal library with comments</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/97366c1a65e9241e43a61f592da037e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/0*U1VGF8MHZcwMD0lG.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB Compass</figcaption></figure><p id="8a16" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><strong class="lr io">删书</strong></p><p id="a45e" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">当我们点击<code class="fe of og oh nx b">Delete book</code>按钮时，一本书被删除。该图书的ID随<code class="fe of og oh nx b">DELETE</code>请求发送至<code class="fe of og oh nx b">/api/books/:id</code>。从<code class="fe of og oh nx b">req.params</code>对象中解析图书的标识，并在<code class="fe of og oh nx b">Model.findByIdAndRemove()</code>方法中作为参数传入。如果标识无效或不存在，将引发错误，否则将返回一条指示成功删除的消息。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js DELETE api/books/:id</figcaption></figure><p id="5972" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><strong class="lr io">删除所有书籍</strong></p><p id="78ba" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">最后，通过向<code class="fe of og oh nx b">/api/books</code>发送<code class="fe of og oh nx b">DELETE</code>请求，执行<code class="fe of og oh nx b">Model.deleteMany()</code>方法，无需任何参数，即可删除图书馆馆藏的所有书籍。</p><p id="a71c" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">完整的<code class="fe of og oh nx b">api.js</code>文件将是:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ot ou l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">routes/api.js</figcaption></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="caca" class="kt ku in bd kv kw kx dn ky kz la dp lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">包扎</h2><p id="4725" class="pw-post-body-paragraph mq mr in lr b ls lt jo ms lu lv jr mt lc mu mv mw lg mx my mz lk na nb nc lz ig bi translated">我们的应用程序现在已经完成，我们可以执行我们在本教程开始时设定的功能。</p><p id="ea19" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">这是MongoDB中的入门知识，也是与您将在数据库上执行的常见操作相关的一些方法。随意调整你想要的应用，尝试更多MongoDB和<a class="ae ks" href="https://mongoosejs.com/docs/" rel="noopener ugc nofollow" target="_blank">猫鼬方法</a>。</p><p id="0a48" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated">在评论中告诉我你的想法。快乐黑客👍🏾️.</p><p id="f8c7" class="pw-post-body-paragraph mq mr in lr b ls nd jo ms lu ne jr mt lc nf mv mw lg ng my mz lk nh nb nc lz ig bi translated"><em class="pa">多内容见于</em> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lr io"> <em class="pa">中</em></strong></a></p></div></div>    
</body>
</html>