<html>
<head>
<title>PDF Generation in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js中的PDF生成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/pdf-generation-in-node-js-5015f7bbd522?source=collection_archive---------3-----------------------#2021-05-20">https://javascript.plainenglish.io/pdf-generation-in-node-js-5015f7bbd522?source=collection_archive---------3-----------------------#2021-05-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2176387e77991fe03a5cb54e4df6ccf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGAAkRcW5pwDc5Wgtb-0UQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Pdf generation in Nodejs</figcaption></figure><p id="c2cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">pdf是我们日常生活中常用的文档之一。<strong class="kb io"> PDF </strong>表示可移植文档格式，用于以电子形式显示文档，与查看文档的软件、硬件或操作系统无关。一个<strong class="kb io"> PDF </strong>的主要目的是在不同的操作系统和设备之间共享文档。</p><p id="4d81" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">pdf通常用在任何地方，包括发票、电子书、申请表等。</p><p id="7520" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在今天的帖子中，我们将看到在Node.js. <br/>中创建pdf的两种方法。使用木偶师。<br/> 2。PDF制作包</p></div><div class="ab cl kx ky hr kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ig ih ii ij ik"><h2 id="d259" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated">木偶师:</h2><p id="e81e" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">Puppeteer是一个节点库，它提供了一个高级API来通过DevTools协议控制Chrome或Chrome。默认情况下，Puppeteer是无头运行的，但是可以配置为运行完整的(非无头)Chrome或Chrome。使用木偶师，你可以渲染文档，然后从中生成PDF文件。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/67506298d2603d023ae8bcb7ac57485c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YlwO44OnspAqxLmppd7MrA.png"/></div></div></figure><p id="ce28" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤1:使用npm或yarn安装木偶师</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="bc98" class="le lf in mi b gy mm mn l mo mp">npm i puppeteer<br/>or <br/>yarn add puppeteer</span></pre><p id="fce8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">木偶师有很多依赖。因此，请确保它与您的节点版本兼容。</p><p id="7e8a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤2:导入木偶师</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="28e6" class="le lf in mi b gy mm mn l mo mp">const puppeteer = require('puppeteer');</span></pre><p id="d959" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤3:启动浏览器</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="34ce" class="le lf in mi b gy mm mn l mo mp">const browser = await puppeteer.launch({<br/> headless: true<br/>})</span></pre><p id="0bca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">headless选项指定了一个布尔值，该值指示木偶师是否在headless模式下启动Chromium。在启动木偶师时，你有很多选择，你可以在这里阅读它们<a class="ae mq" href="https://github.com/puppeteer/puppeteer/blob/v9.1.1/docs/api.md#puppeteerlaunchoptions" rel="noopener ugc nofollow" target="_blank">。您可以在开发时关闭headless模式，这让您可以看到幕后发生了什么。</a></p><p id="ee61" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤4:创建新的浏览器页面</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="7969" class="le lf in mi b gy mm mn l mo mp">const page = await browser.newPage();</span></pre><p id="03d5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这类似于在浏览器中打开一个新的选项卡，您可以在其中呈现您的HTML。</p><p id="16d1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第五步:将内容设置为页面。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="11e3" class="le lf in mi b gy mm mn l mo mp">const html = '&lt;p&gt;Hello world!&lt;/p&gt;'<br/>await page.setContent(html)</span></pre><p id="aeba" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">set content方法用于设置呈现的HTML内容。</p><p id="0142" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤6:生成pdf并关闭页面</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="696e" class="le lf in mi b gy mm mn l mo mp">await page.pdf({ <br/> path: 'sample-pdf.pdf', <br/> format: 'A4',<br/> displayHeaderFooter: false,<br/>});<br/>await page.close()</span></pre><p id="d5bc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Page.pdf方法采用多个选项，如<br/> i. path，指定pdf文件的输出路径。<br/>二。格式指定了纸张格式。<br/>三。displayHeaderFooter指定一个布尔值，该值指示是否包含页眉&amp;页脚。<br/>点击可以了解更多选项<a class="ae mq" href="https://github.com/puppeteer/puppeteer/blob/v9.1.1/docs/api.md#pagepdfoptions" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e623" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤7:关闭浏览器</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="56ae" class="le lf in mi b gy mm mn l mo mp">await browser.close()</span></pre><p id="1302" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">由于chrome相当笨重，因此一旦生成pdf，就必须关闭浏览器，以避免内存泄漏。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/3e6815b4087a8e0b6684571a7b6ff3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/1*IEN5_OfaiPUIAGbZAXcMIw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">PDF generation API using puppeteer</figcaption></figure><h2 id="d14d" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated">PDFMake:</h2><p id="ba5d" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">PDF make是一个轻量级的纯javascript库，用于生成PDF。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/9d8458df0ed2be3924d30e8065da879d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*TFR-_8fKVD04_-K8TZfwxw.png"/></div></figure><p id="5b33" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤1:通过npm安装软件包</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="39ab" class="le lf in mi b gy mm mn l mo mp">npm i pdfmake</span></pre><p id="6963" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤2:导入包</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f138" class="le lf in mi b gy mm mn l mo mp">const PdfPrinter = require('pdfmake')</span></pre><p id="818e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤3:使用字体创建pdf make的新实例</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="1aec" class="le lf in mi b gy mm mn l mo mp">const printer = new PdfPrinter(fonts)</span></pre><p id="aa1a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤4:在docDefinition对象中设置文档的内容</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="516e" class="le lf in mi b gy mm mn l mo mp">const docDefinition = {<br/>content: [<br/> 'This is a standard paragraph, using default style',<br/> {<br/>  text: 'This paragraph will have a bigger font',<br/>  fontSize: 15<br/> },<br/> {<br/> text: [<br/>  'This paragraph is defined as an array of elements to make it possible to ',<br/>  {<br/>   text: 'restyle part of it and make it bigger ',<br/>   fontSize: 15<br/>  },<br/>  'than the rest.'<br/>  ]<br/> }]<br/>};</span></pre><p id="ac8e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">“docDefinition”包含一个数组对象，该对象指定要在pdf文件上显示的内容。你可以在<a class="ae mq" href="https://pdfmake.github.io/docs/0.1/document-definition-object/styling/" rel="noopener ugc nofollow" target="_blank">官方文档</a>中了解更多信息。</p><p id="1127" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤5:通过调用方法创建pdf</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="8081" class="le lf in mi b gy mm mn l mo mp">const pdfDoc = printer.createPdfKitDocument(docDefinition)</span></pre><p id="8c8c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">CreatePdfKitDocument方法将文档定义和缓冲区选项作为参数，并以缓冲区页面的形式从中生成一个文档。</p><p id="35e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">步骤6:传输pdf内容</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="817d" class="le lf in mi b gy mm mn l mo mp">pdfDoc.pipe(fs.createWriteStream('document.pdf'));</span></pre><p id="2830" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> pipe </strong>()方法用于将pdf内容的可写流附加到打印机流，以便它随后切换到流动模式，然后将所有数据推送到附加的可写流。</p><p id="64d6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">第七步:关闭流</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f66a" class="le lf in mi b gy mm mn l mo mp">pdfDoc.end()</span></pre><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/e445bfe44660d48cf029e9dd7bd0ee8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*svGwnxGnqA7MCYC219zu1Q.png"/></div></figure><h2 id="83f4" class="le lf in bd lg lh li dn lj lk ll dp lm kk ln lo lp ko lq lr ls ks lt lu lv lw bi translated"><strong class="ak">在木偶戏演员中选择哪一个&amp; pdfmake: </strong></h2><p id="8584" class="pw-post-body-paragraph jz ka in kb b kc lx ke kf kg ly ki kj kk lz km kn ko ma kq kr ks mb ku kv kw ig bi translated">1.木偶师通过使用HTML模板生成pdf，这使得开发者可以编写HTML模板并动态生成pdf。而pdfmake使用自己的对象数组结构，这使得创建具有大量自定义样式的多页pdf变得困难。</p><p id="2d46" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2.要创建PDF，每次都需要启动Puppeteer，这会产生一些开销。它是缓慢的。而pdfmake速度更快，因为它不打开任何浏览器。</p><p id="0846" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3.使用木偶师时，您可以使用任何字体。当您在使用Webpack时尝试嵌入自定义字体时，Pdfmake可能会遇到问题。</p><p id="faf6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">4.如果您使用Docker来部署您的节点应用程序，安装puppeteer需要额外的步骤，而pdfmake可以通过您的package.json来安装。</p><p id="b5c5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，根据你的标准，你可以选择任何一个包。就我个人而言，我使用木偶戏，因为与pdfmake相比，它在渲染方面提供了更多的灵活性。</p><p id="9ebe" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="mu">感谢您的阅读。</em> </strong> <em class="mu">如果您有任何问题或想了解更多关于任何技术或方法的信息，请随时发表评论！</em></p><p id="b88a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="mu">更多内容请看</em><a class="ae mq" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mu">plain English . io</em></a></p></div></div>    
</body>
</html>