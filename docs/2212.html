<html>
<head>
<title>Let’s Create a Retry Mechanism Using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们使用JavaScript创建一个重试机制</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-make-a-retry-mechanism-a339307d44bc?source=collection_archive---------2-----------------------#2021-05-09">https://javascript.plainenglish.io/lets-make-a-retry-mechanism-a339307d44bc?source=collection_archive---------2-----------------------#2021-05-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/07d0848e8207022b12b5c0c64c3c5ca1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fy__WRjsJiNGyFdL"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@cgower?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="1c8b" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">你为什么要费心重试呢？</h1><p id="3d17" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">有时候，当向某个API发出请求时，事情会出错。</p><p id="2067" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我记得在工作中有某个<strong class="la io"> bug </strong>需要修复。</p><p id="ed60" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我们需要<strong class="la io">谷歌地理定位库</strong>来完成一些特定的操作。</p><p id="ddca" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">不幸的是，由于一些问题，它有时无法加载，我们的应用程序部分将无法正常工作。</p></div><div class="ab cl mb mc hr md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ig ih ii ij ik"><p id="eeed" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我的任务是实现一个<strong class="la io">重试机制</strong>来尝试多次重新加载，从而使应用程序更有弹性<strong class="la io"/>。</p><p id="9e62" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">为此，我们需要创建一个基本上一直调用另一个函数的函数(在本例中，后者是加载库的那个)。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="10f2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这个代码片段有我们的<strong class="la io">重试函数</strong>的起始代码，默认情况下重试3次，并在后续调用之间设置2.5秒的间隔来加载库。</p><p id="2f80" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">另外，<code class="fe mo mp mq mr b">loadLibrary()</code>是一个模拟Google库负载的函数。</p><p id="43d2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">它返回一个包含一个在500毫秒后调用一个回调的<code class="fe mo mp mq mr b">setTimeout</code>的<code class="fe mo mp mq mr b">Promise</code>。</p><p id="23ae" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">但是这不会起作用，因为我们只需要调用这个<strong class="la io">加载函数</strong>一定的次数，而不是永远！</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="0ac9" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">通过这些增加，我们有了一个<strong class="la io">工作重试功能</strong>。</p><p id="d64f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">通过递增<code class="fe mo mp mq mr b">numberOfTries</code>变量，<code class="fe mo mp mq mr b">retry()</code>函数知道到目前为止已经尝试了多少次加载。</p><p id="0b8b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated"><code class="fe mo mp mq mr b">try/catch</code>块用于<strong class="la io">错误处理</strong>目的:</p><ul class=""><li id="22f2" class="ms mt in la b lb lw lf lx lj mu ln mv lr mw lv mx my mz na bi translated">在<strong class="la io">成功</strong>时，它通过调用<code class="fe mo mp mq mr b">clearInterval()</code>结束循环，并且<strong class="la io">履行</strong>承诺。</li><li id="1b4d" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">在出现<strong class="la io">错误</strong>的情况下，它会被捕获并记录到控制台，同时记录当前的尝试次数。</li></ul><p id="942f" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">为了停止无用的函数调用，不要忘记相应地<code class="fe mo mp mq mr b">clearInterval()</code>。</p><p id="7d41" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated"><strong class="la io">重试机制在以下两种情况下结束</strong>:</p><ul class=""><li id="3287" class="ms mt in la b lb lw lf lx lj mu ln mv lr mw lv mx my mz na bi translated">已经达到重试的<strong class="la io">限制</strong>。</li><li id="be0e" class="ms mt in la b lb nb lf nc lj nd ln ne lr nf lv mx my mz na bi translated">在一次重试调用后，我们设法<strong class="la io">成功加载了</strong>我们的库。</li></ul><p id="cdaf" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">还有最后一件事要改变。</p><p id="b86a" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">目前，我们的<code class="fe mo mp mq mr b">loadLibrary()</code>功能<strong class="la io">每次都工作</strong>。在“随机”数字的帮助下，我们将模拟一种情况，其中负载试验将在时间的<strong class="la io"> ~30% </strong>中工作。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="8247" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">就是这样！</p><p id="ab65" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我们的<code class="fe mo mp mq mr b">retry()</code>函数将尝试加载库一个设定的次数，并将告诉它是否<strong class="la io">成功</strong>，以及在什么<strong class="la io">尝试计数</strong>时它停止。</p><p id="6444" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">希望这篇文章能引起你的兴趣，对你有所帮助！</p><p id="1d21" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">您在获取/加载数据时是否遇到过任何问题，并且您需要一个<strong class="la io">重试机制</strong>？也许这段代码可以拯救你的一天，我会很高兴。</p><p id="5b8a" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">我渴望看到你的<strong class="la io">评论</strong>和<strong class="la io">反馈</strong>！</p><p id="2cf7" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated"><em class="ng">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="ng">plain English . io</em></a></p></div></div>    
</body>
</html>