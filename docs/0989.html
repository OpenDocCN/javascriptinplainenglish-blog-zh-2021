<html>
<head>
<title>How To Use Stripe Payment with Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Firebase的条纹支付</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-stripe-payment-with-firebase-9dc0a7c82080?source=collection_archive---------4-----------------------#2021-03-02">https://javascript.plainenglish.io/using-stripe-payment-with-firebase-9dc0a7c82080?source=collection_archive---------4-----------------------#2021-03-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/366abb7cd1013b31df5260635b3347a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4qYEGXxPuih20Z1l"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@christiannkoepke?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christiann Koepke</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="c9ae" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">向Firebase项目添加订阅计划</h2></div><p id="b6d2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将演示如何在Firebase项目中使用条带扩展。我们将创建一个简化的网飞克隆，列出了计划，用户可以订阅计划，同时，这些数据是同步的。这意味着Stripe的客户数据与Firebase中的认证数据相同。添加到Stripe中的产品也将记录在Firebase firestore中。</p><p id="e802" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们开始吧！</p><p id="d2e8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">源代码:</p><p id="31a1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" href="https://www.udemy.com/course/complete-react-course-w-hooks-react-router-redux-usecontext/?referralCode=B192869617ADE079536F" rel="noopener ugc nofollow" target="_blank">https://www . udemy . com/course/complete-react-course-w-hooks-react-router-redux-use context/？referral code = b 192869617 ade 079536</a></p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><h2 id="85c1" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">1.打开条带帐户</h2><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/c8a568960cc83f24640bf928f3c19546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WLltwWFjXSpOko_utvNTyw.png"/></div></div></figure><p id="359b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们创建了一个名为“Company1”的帐户。我们在左侧菜单中切换查看测试数据。然后你应该看到获取你的API键，这些键用于连接Firebase和测试数据。</p><h2 id="1a72" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">2.创建Firebase项目</h2><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/feb3be7dd5c8337c5f954d620a08855b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ct8-5PT1y8gvY2P__1iDlw.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/32bb86cf6ca83c2f8339ca6a278153f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jH-JNfVOxDXt-mHpoPEl1w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Turn off the Google Analytics</figcaption></figure><p id="34d5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们创建一个Firebase项目，然后禁用这个项目的谷歌分析。</p><p id="9370" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，我们打开电子邮件认证并启动云Firestore。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/c531a22ceef5e0fe4f70d8b4729c1c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3e5sNQ3_Im_p6UisjhL8Q.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/9d27078a524c26d817d9a93a2229a507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAQJQ8g04ObqA-C547iJng.png"/></div></div></figure><h2 id="0f0b" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">3.安装Firebase条带扩展</h2><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/4c6dfebe090805d1d7c7940c5ec29c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqJuuYetj8ao7rnPbDs30A.png"/></div></div></figure><p id="bf90" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们单击扩展菜单，然后单击安装条带扩展。安装完成后，点击“这个扩展是如何工作的”</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/d7f26867d6db97124dd95cd385431708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCHK7LEP6djUZkoFEJzkrg.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/0d2738957fc1158bfe03f976e884e4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9kyFzmdIAlVNC3xy2_xIA.png"/></div></div></figure><p id="415b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在“配置条带webhooks”的步骤2下，我们将此端点复制到条带。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/8825f1ec466b21c02568ea59df11e0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bqX502sQLub9ilUDt5RF9g.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/cb384c09fe774c424b34a4c26d86e8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yN324bEnKqSPEGIyefu-1Q.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/15ae5287c4092c7d62582dc2a2445e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApD1O5MWZBFTCNP3gRbwKg.png"/></div></div></figure><p id="ded4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从“配置条带webhooks”的步骤3开始，我们将这些事件添加到端点。</p><p id="8f9e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在“配置Stripe webhooks”的第4步中，我们从Stripe复制“签名密码”并将其粘贴到Firebase的“Stripe webhook密码”中。</p><p id="db0c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们还将“测试API密钥”的“秘密密钥”复制到“限制访问的条带API密钥”中。记得也打开同步功能。</p><p id="a41d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，我们单击保存。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/ddc81f39dbedcb890d6aec3be5087ba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-QrmMdUiqh8VIsNCyZ2qw.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/d59fca0a2b1661a4aa1d25ec1e8b5547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yES3_luNESkm_8ft646ijw.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/7a1255577e61d735f19d6bfe5ee3e2a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kxHcBI6kuWHMRkRHFnjUMg.png"/></div></div></figure><h2 id="e9c4" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">4.添加产品或计划</h2><p id="4253" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">接下来，我们将向条带中添加产品或订阅计划。所以我们需要点击侧边菜单上的“产品”，然后点击“+添加产品”。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/6a5623aa4634d5cb2a63f2c4e04099e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfFHVu8KTn5RFA_T-godqw.png"/></div></div></figure><p id="b781" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们输入产品的名称、描述和价格，如果您只有一个产品，请单击“保存产品”;如果您有多个产品，请单击“保存并添加更多”,这样您就可以继续添加更多产品</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/42abe64804db913e6d4503d6d04a0fc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fP_qT3yYTq7RMrS3eHQcYw.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/9a147c91c68beb976d91a93a1afaad84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qx46ufSGKuor3QO6n_uA7w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">example product (plan 1)</figcaption></figure><p id="85df" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">输入所有产品信息后，我们单击“设置”，然后单击“客户门户”。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/d03aa63e932fad12613a2eb2821d0665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EqueXzHUbWqR5k6wU_C20Q.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/355f43ccf050f26d17b371ec3ea5e799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--iHZtgmL342objvOYq3nA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/6d1593017e6b2f5f8bce29ceb4f2a232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V103_pTqX_htxAe8sMHaOg.png"/></div></div></figure><p id="8db4" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们打开</p><p id="51c7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">"允许客户查看他们的发票历史记录"</p><p id="566b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">"允许客户更新以下帐单信息"</p><p id="8e99" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">"允许客户取消订阅"</p><p id="99b5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">“允许客户切换不同的定价方案”</p><p id="aa55" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们需要将产品添加到“添加的产品”中</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/88da99de42d5e5e3a059804647753bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOyIGwI2dGtewBoIfPlF_g.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mw"><img src="../Images/e01079b2a6147e225a699cf0b4e06b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwFumFkIZFM24b_1zb0vtg.png"/></div></div></figure><p id="d883" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要在“服务条款”和“隐私政策”中输入“【https://example.com/terms】T5”和“<a class="ae jd" href="https://example.com/privacy" rel="noopener ugc nofollow" target="_blank">https://example.com/privacy T7”。最后，我们点击“保存”。</a></p><h2 id="63cb" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">5.添加firebase配置文件</h2><p id="c4f4" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">我们用这个<a class="ae jd" href="https://medium.com/swlh/react-firebase-authentication-b68bd0f078a8" rel="noopener">项目</a>继续。如果您在Firebase中创建了一个新项目，请记住您需要将配置文件从Firebase复制到您的项目中。</p><p id="2b22" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">点击齿轮图标，然后点击</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/cfeb53e8501db7fd1ab9f009a84f59d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGoovYgu62-XOoEiYkdYBA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mr"><img src="../Images/1b02999af2c3a8b6cb7a4a937a4be4c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r63ID1mAr_z7utEu6gy7Hg.png"/></div></div></figure><p id="f16c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">键入应用程序昵称，然后单击“注册应用程序”。然后将配置文件复制到项目的firebase.js中。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/002afa0980614e6c5be4b15a62a33934.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*gRxmMivA88HsH1SbZvcw0g.png"/></div></figure><h2 id="72dd" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">6.从Firebase获取产品和价格</h2><p id="6824" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在Home.js内部，我们需要添加状态“products”和更新函数“setProducts”。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="1ab4" class="ly lz jg ne b gy ni nj l nk nl">const [products, setProducts] = useState([])</span></pre><p id="0027" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">由于我们将使用useState和useEffect，所以我们还需要从“react”中导入它们。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="427f" class="ly lz jg ne b gy ni nj l nk nl">import React, { useContext, useEffect, useState } from 'react'</span><span id="077b" class="ly lz jg ne b gy nm nj l nk nl">useEffect(() =&gt; {</span><span id="8d88" class="ly lz jg ne b gy nm nj l nk nl">db.collection('products').where('active', '==', true).get().then(snapshot =&gt; {</span><span id="ae60" class="ly lz jg ne b gy nm nj l nk nl">console.log('products snapshot',snapshot)</span><span id="ff6d" class="ly lz jg ne b gy nm nj l nk nl">const products = {};</span><span id="9721" class="ly lz jg ne b gy nm nj l nk nl">snapshot.forEach(async productDoc =&gt; {</span><span id="5f76" class="ly lz jg ne b gy nm nj l nk nl">products[productDoc.id] = productDoc.data();</span><span id="c7b2" class="ly lz jg ne b gy nm nj l nk nl">const priceSnap = await productDoc.ref.collection("prices").get();</span><span id="fdb6" class="ly lz jg ne b gy nm nj l nk nl">console.log('rpiceSnap', priceSnap)</span><span id="b4bd" class="ly lz jg ne b gy nm nj l nk nl">priceSnap.forEach(priceDoc =&gt; {</span><span id="0bb9" class="ly lz jg ne b gy nm nj l nk nl">products[productDoc.id].prices = {</span><span id="2d81" class="ly lz jg ne b gy nm nj l nk nl">priceId: priceDoc.id,</span><span id="0a0d" class="ly lz jg ne b gy nm nj l nk nl">priceData: priceDoc.data()</span><span id="ad90" class="ly lz jg ne b gy nm nj l nk nl">}</span><span id="a347" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="9651" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="fb33" class="ly lz jg ne b gy nm nj l nk nl">setProducts(products)</span><span id="e610" class="ly lz jg ne b gy nm nj l nk nl">console.log('products', products)</span><span id="7055" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="84a2" class="ly lz jg ne b gy nm nj l nk nl">}, [])</span></pre><p id="1b2e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">选择那些活动的产品，从快照中，我们可以看到一组数据，这些是产品吗，我们可以看到产品id</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/ff86a9bf7324fb5ddb8a929d9a79e351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*xEv3WvnUpqGx7WZlz2GDCA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div class="gh gi no"><img src="../Images/2cae0ea5bc844c9da66a37c7a9611163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*eOPEtm5PeMogCu_9E8FlAA.png"/></div></figure><p id="513c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建一个空的products对象，然后从快照中获取文档，设置如下所示的键值对。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="dc4e" class="ly lz jg ne b gy ni nj l nk nl">products[productDoc.id] = productDoc.data();</span></pre><p id="34d9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是因为最后我们要获得follow products JSON对象，下面是该对象的一个例子。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="75bd" class="ly lz jg ne b gy ni nj l nk nl">{<br/> "prod_IzXyGOiGETVCsx": {<br/>  "active": true,<br/>  "name": "plan1",<br/>  "role": "plan1",<br/>  "images": [],<br/>  "description": "plan1 is cheaper"<br/> },<br/> "prod_IzXzUtzeWTYwij": {<br/>  "images": [],<br/>  "description": "plan2 is more expensive",<br/>  "name": "plan2",<br/>  "role": "plan2",<br/>  "active": true<br/> },<br/> "prod_IzYUChfToedtdz": {<br/>  "active": true,<br/>  "name": "plan3",<br/>  "images": [],<br/>  "role": "plan3",<br/>  "description": "plan 3"<br/> }<br/>}</span></pre><p id="68f3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因为我们还想从firestore获取价格数据，该数据在子集合中。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/077a392cd59324125843eb1da0257a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oeaOnKS1jfh_K-VQ7JsuVw.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/cfd97627b5fb3b58204ab07acdc624a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uez_PfeTFPQHjHOncHUNTg.png"/></div></div></figure><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="f361" class="ly lz jg ne b gy ni nj l nk nl">const priceSnap = await productDoc.ref.collection("prices").get();</span><span id="cf44" class="ly lz jg ne b gy nm nj l nk nl">priceSnap.forEach(priceDoc =&gt; {</span><span id="a440" class="ly lz jg ne b gy nm nj l nk nl">products[productDoc.id].prices = {</span><span id="ec2c" class="ly lz jg ne b gy nm nj l nk nl">priceId: priceDoc.id,</span><span id="1fd4" class="ly lz jg ne b gy nm nj l nk nl">priceData: priceDoc.data()</span><span id="874c" class="ly lz jg ne b gy nm nj l nk nl">}</span><span id="f9e1" class="ly lz jg ne b gy nm nj l nk nl">})</span></pre><p id="8564" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们从子集合“prices”中获取快照。之后，我们获取价格id和价格数据，并将其存储在products对象中</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/d7eb300d1d805f2a3f33a7663c5f998f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tt7pfU-3454pAo0KA9DaSg.png"/></div></div></figure><h2 id="2154" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">7.呈现产品和订阅按钮</h2><p id="2428" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">Home.js内部</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="47a4" class="ly lz jg ne b gy ni nj l nk nl">return (</span><span id="e19c" class="ly lz jg ne b gy nm nj l nk nl">&lt;div&gt;</span><span id="160a" class="ly lz jg ne b gy nm nj l nk nl">&lt;h1&gt;Welcome home&lt;/h1&gt;</span><span id="38fc" class="ly lz jg ne b gy nm nj l nk nl">&lt;p&gt;&lt;button onClick={() =&gt; auth.signOut()}&gt;Sign out&lt;/button&gt;&lt;/p&gt;</span><span id="eba8" class="ly lz jg ne b gy nm nj l nk nl">{Object.entries(products).map(([productId, productData]) =&gt; {</span><span id="9048" class="ly lz jg ne b gy nm nj l nk nl">return (&lt;div className="plans" key={productId}&gt;</span><span id="595c" class="ly lz jg ne b gy nm nj l nk nl">&lt;div&gt;</span><span id="c343" class="ly lz jg ne b gy nm nj l nk nl">{productData.name} - {productData.description}</span><span id="68ac" class="ly lz jg ne b gy nm nj l nk nl">&lt;/div&gt;</span><span id="67b1" class="ly lz jg ne b gy nm nj l nk nl">&lt;button&gt;subscribe&lt;/button&gt;</span><span id="e2e0" class="ly lz jg ne b gy nm nj l nk nl">&lt;/div&gt;)</span><span id="68e6" class="ly lz jg ne b gy nm nj l nk nl">})}</span><span id="1bbe" class="ly lz jg ne b gy nm nj l nk nl">&lt;/div&gt;</span><span id="bb2d" class="ly lz jg ne b gy nm nj l nk nl">)</span></pre><blockquote class="ns nt nu"><p id="9425" class="kv kw nv kx b ky kz kh la lb lc kk ld nw lf lg lh nx lj lk ll ny ln lo lp lq ij bi translated">什么是Object.entries？<br/><code class="fe nz oa ob ne b"><strong class="kx jh">Object.entries()</strong></code>方法返回给定对象自己的可枚举字符串键属性<code class="fe nz oa ob ne b">[key, value]</code>对的数组，其顺序与<code class="fe nz oa ob ne b"><a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in" rel="noopener ugc nofollow" target="_blank">for...in</a></code>循环提供的顺序相同。(唯一重要的区别是一个<code class="fe nz oa ob ne b">for...in</code>循环也枚举了原型链中的属性)。</p></blockquote><div class="ip iq gp gr ir oc"><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/entries" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jh gy z fp oh fr fs oi fu fw jf bi translated">Object.entries()</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">Object.entries()方法返回给定对象自己的可枚举字符串键属性[key，value]的数组…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">developer.mozilla.org</p></div></div><div class="ol l"><div class="om l on oo op ol oq ix oc"/></div></div></a></div><p id="9c0b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用Object.entries来获取键(即productId)和数据(即productData)。</p><p id="2179" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用productId作为列表项的键，并从productData中获取产品名称和描述。</p><p id="3a9d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们将css添加到Home.css中，并将其导入Home.js</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="848e" class="ly lz jg ne b gy ni nj l nk nl">import './Home.css';</span><span id="c26e" class="ly lz jg ne b gy nm nj l nk nl">.plans{</span><span id="226c" class="ly lz jg ne b gy nm nj l nk nl">display:flex;</span><span id="1af0" class="ly lz jg ne b gy nm nj l nk nl">justify-content: space-between;</span><span id="9ac3" class="ly lz jg ne b gy nm nj l nk nl">margin-left: auto;</span><span id="d7e5" class="ly lz jg ne b gy nm nj l nk nl">margin-right: auto;</span><span id="e878" class="ly lz jg ne b gy nm nj l nk nl">max-width: 500px;</span><span id="bbb1" class="ly lz jg ne b gy nm nj l nk nl">}</span></pre><figure class="ms mt mu mv gt is gh gi paragraph-image"><div class="gh gi or"><img src="../Images/50dcea65737489f50c07b199c5affd8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*1fPsDhZyo0lWacn71iz4AA.png"/></div></figure><h2 id="b44b" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">8.加载检验</h2><p id="2809" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">因为我们将向用户或客户添加数据，所以我们需要获取用户数据。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/e3685d4df8f2278310c83b33d8f68f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*-PGqfy7jr0rcwvxTUP4P9A.png"/></div></figure><p id="8330" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们需要在src文件夹下创建UserContext.js。</p><p id="f859" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在UserContext.js内部</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="3ac8" class="ly lz jg ne b gy ni nj l nk nl">import {createContext} from 'react';</span><span id="d589" class="ly lz jg ne b gy nm nj l nk nl">export const UserContext = createContext(null)</span></pre><p id="e614" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">回到App.js，我们需要导入UserContext</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="e5ee" class="ly lz jg ne b gy ni nj l nk nl">import {UserContext} from './UserContext';</span></pre><p id="20a2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">之后，我们使用用户上下文。提供者来包装整个内容。提供者将把值“user”传递给组件。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="68aa" class="ly lz jg ne b gy ni nj l nk nl">return (</span><span id="c851" class="ly lz jg ne b gy nm nj l nk nl">&lt;div className="App"&gt;</span><span id="d941" class="ly lz jg ne b gy nm nj l nk nl">&lt;UserContext.Provider value={{user}}&gt;</span><span id="b13a" class="ly lz jg ne b gy nm nj l nk nl">{user ? &lt;Home /&gt; : &lt;Signin /&gt;}</span><span id="5d1f" class="ly lz jg ne b gy nm nj l nk nl">&lt;/UserContext.Provider&gt;</span><span id="f696" class="ly lz jg ne b gy nm nj l nk nl">&lt;/div&gt;</span><span id="bd8d" class="ly lz jg ne b gy nm nj l nk nl">);</span></pre><p id="75fc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在Home.js中，我们可以通过从react导入useContext并导入UserContext来获得值“user”。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="6b4d" class="ly lz jg ne b gy ni nj l nk nl">import React, { useContext, useEffect, useState } from 'react'</span><span id="7d89" class="ly lz jg ne b gy nm nj l nk nl">import { UserContext } from '../UserContext';</span><span id="b841" class="ly lz jg ne b gy nm nj l nk nl">const { user } = useContext(UserContext)</span></pre><p id="8799" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在我们已经获得用户数据之后，我们可以继续创建loadCheckout函数，我们将把这个函数绑定到subscribe按钮。因为我们需要在这个函数中使用stripe包，所以让我们通过在终端中输入以下命令来安装它。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="c066" class="ly lz jg ne b gy ni nj l nk nl">npm i @stripe/stripe-js</span><span id="869d" class="ly lz jg ne b gy nm nj l nk nl">const loadCheckout = async (priceId) =&gt; {</span><span id="f39d" class="ly lz jg ne b gy nm nj l nk nl">const docRef = await db.collection("customers").doc(user.uid).collection("checkout_sessions").add({</span><span id="4292" class="ly lz jg ne b gy nm nj l nk nl">price: priceId,</span><span id="bd47" class="ly lz jg ne b gy nm nj l nk nl">success_url: window.location.origin,</span><span id="178a" class="ly lz jg ne b gy nm nj l nk nl">cancel_url: window.location.origin</span><span id="6756" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="5921" class="ly lz jg ne b gy nm nj l nk nl">docRef.onSnapshot(async (snap) =&gt; {</span><span id="97cb" class="ly lz jg ne b gy nm nj l nk nl">const { error, sessionId } = snap.data()</span><span id="6fcf" class="ly lz jg ne b gy nm nj l nk nl">console.log('error sessionId', error, sessionId)</span><span id="6326" class="ly lz jg ne b gy nm nj l nk nl">if (error) {</span><span id="4fe3" class="ly lz jg ne b gy nm nj l nk nl">alert(`An error occured: ${error.message} `)</span><span id="d199" class="ly lz jg ne b gy nm nj l nk nl">}</span><span id="e412" class="ly lz jg ne b gy nm nj l nk nl">if (sessionId) {</span><span id="9e3b" class="ly lz jg ne b gy nm nj l nk nl">console.log('sessionID', sessionId)</span><span id="e1f0" class="ly lz jg ne b gy nm nj l nk nl">const stripe = await loadStripe("pk_test_51INW8eAI3J7s6NihgTfXwK6LckSo4tEJ1WhsoUmWGDftnJOBlXAXCSAqCVkSw89xsgAQjvtpMCTjTMknulKZ2wj900Nus791uw")</span><span id="293b" class="ly lz jg ne b gy nm nj l nk nl">stripe.redirectToCheckout({ sessionId });</span><span id="8407" class="ly lz jg ne b gy nm nj l nk nl">}</span><span id="f739" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="cf2f" class="ly lz jg ne b gy nm nj l nk nl">}</span></pre><p id="9fce" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们将向客户添加priceId、success_url和cancel_url</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="dd78" class="ly lz jg ne b gy ni nj l nk nl">const docRef = await db.collection("customers").doc(user.uid).collection("checkout_sessions").add({</span><span id="9ee0" class="ly lz jg ne b gy nm nj l nk nl">price: priceId,</span><span id="5e90" class="ly lz jg ne b gy nm nj l nk nl">success_url: window.location.origin,</span><span id="2155" class="ly lz jg ne b gy nm nj l nk nl">cancel_url: window.location.origin</span><span id="66c4" class="ly lz jg ne b gy nm nj l nk nl">})</span></pre><p id="71c2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，当内容发生变化时，它将创建一个签出会话。</p><p id="9597" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果有签出会话，那么它<a class="ae jd" href="https://stripe.com/docs/payments/accept-a-payment" rel="noopener ugc nofollow" target="_blank">将使用可发布的API键</a>创建条带对象的实例。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="dd63" class="ly lz jg ne b gy ni nj l nk nl">loadStripe("pk_test_adsfdsafdsafdsafdsafsadfadfdsafasdfsdafsafsad")</span></pre><p id="e967" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">(我们可以从条带中获得可发布的API密钥)</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ot"><img src="../Images/77cca325fe8cb83eb82bdd9dd640c285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXqAFUQUP5NnA00Y8r5B3Q.png"/></div></div></figure><p id="b2c3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">它会将顾客重定向到结帐页面。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="fca3" class="ly lz jg ne b gy ni nj l nk nl">stripe.redirectToCheckout({ sessionId });</span></pre><p id="6319" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，我们将该功能绑定到订阅按钮上</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="3378" class="ly lz jg ne b gy ni nj l nk nl">&lt;button disabled={isCurrentPlan} onClick={() =&gt; loadCheckout(productData.prices.priceId)}&gt;subscribe&lt;/button&gt;</span></pre><h2 id="2aa8" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">9.检查当前计划</h2><p id="27fd" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">为了检查计划是否被订阅，我们需要向计划的元数据添加一个firebaseRole。</p><p id="ddec" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">要添加firebaseRole，我们可以单击产品名称，然后单击“编辑元数据”，将plan1的元数据值添加到plan1，plan2的元数据值添加到plan2，plan3的元数据值添加到plan3。</p><p id="c7f0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果客户订阅了计划3，他将在firestore中获得一个属性角色，即计划3，因此稍后我们可以比较该角色和计划的名称，如果它们相同，那么我们可以得出结论，他订阅了该计划，然后禁用相应的“订阅”按钮。</p><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ou"><img src="../Images/377b45368bed31c9a4d484a5f050fe39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3b2JoCw2PHnv9NHQvafKA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ov"><img src="../Images/dbb0efbaae916da5c85a048288783560.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQusZCjpKEhFoNvSr6uaWA.png"/></div></div></figure><figure class="ms mt mu mv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ow"><img src="../Images/3ce8b28d9c15bdf1feacf2b69132ae63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MTvEW9ASW9DJYtsVnaj-jA.png"/></div></div></figure><p id="3a08" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，在重新创建新用户并订阅新计划后，如果客户订阅了计划3，您可以看到现在有一个角色属性“计划3”。</p><h2 id="c667" class="ly lz jg bd ma mb mc dn md me mf dp mg le mh mi mj li mk ml mm lm mn mo mp mq bi translated">10.检查这是否是当前计划</h2><p id="b66a" class="pw-post-body-paragraph kv kw jg kx b ky mx kh la lb my kk ld le mz lg lh li na lk ll lm nb lo lp lq ij bi translated">在这一部分，我们将检查该特定计划是否被客户订阅。</p><p id="7d5d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了检查客户订阅了哪个计划，我们需要比较产品名称和客户角色。</p><p id="168c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，我们需要添加订阅状态。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="9ff2" class="ly lz jg ne b gy ni nj l nk nl">const [subscription, setSubscription] = useState(null);</span></pre><p id="d6fa" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，我们需要从“订阅”集合中获取数据</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="a3fc" class="ly lz jg ne b gy ni nj l nk nl">useEffect(() =&gt; {</span><span id="0b78" class="ly lz jg ne b gy nm nj l nk nl">db.collection('customers').doc(user.uid).collection('subscriptions').get().then(snapshot =&gt; {</span><span id="c2cf" class="ly lz jg ne b gy nm nj l nk nl">console.log('snapshot', snapshot)</span><span id="f854" class="ly lz jg ne b gy nm nj l nk nl">snapshot.forEach(subscription =&gt; {</span><span id="88d4" class="ly lz jg ne b gy nm nj l nk nl">console.log('subscription', subscription.data())</span><span id="36ff" class="ly lz jg ne b gy nm nj l nk nl">setSubscription({</span><span id="1be6" class="ly lz jg ne b gy nm nj l nk nl">role: subscription.data().role,</span><span id="deb7" class="ly lz jg ne b gy nm nj l nk nl">current_period_start: subscription.data().current_period_start.seconds,</span><span id="b2fe" class="ly lz jg ne b gy nm nj l nk nl">current_period_end: subscription.data().current_period_end.seconds</span><span id="d717" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="17e5" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="e638" class="ly lz jg ne b gy nm nj l nk nl">})</span><span id="6dd4" class="ly lz jg ne b gy nm nj l nk nl">}, [])</span><span id="b9a4" class="ly lz jg ne b gy nm nj l nk nl">const isCurrentPlan = productData?.name?.toLowerCase().includes(subscription?.role)</span></pre><p id="a119" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果该计划是用户订阅的，那么我们将禁用该按钮。</p><pre class="ms mt mu mv gt nd ne nf ng aw nh bi"><span id="76d8" class="ly lz jg ne b gy ni nj l nk nl">&lt;button disabled={isCurrentPlan} onClick={() =&gt; loadCheckout(productData.prices.priceId)}&gt;subscribe&lt;/button&gt;</span></pre></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="fe36" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你喜欢这个故事，你可能也喜欢中等会员。一个月才5美元(一杯咖啡的价格！)但是它会在支持你最喜欢的作家的同时，给你无限的接触故事的机会。如果你注册使用<a class="ae jd" href="https://ckmobile.medium.com/membership" rel="noopener">这个链接</a>，我会赚一小笔佣金。谢谢！</p></div><div class="ab cl lr ls hu lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ij ik il im in"><p id="3388" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">免费YouTube教程:</p><div class="ip iq gp gr ir oc"><a href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww" rel="noopener  ugc nofollow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd jh gy z fp oh fr fs oi fu fw jf bi translated">ckmobile</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">无论你是在后台还是前台工作，JavaScript现在都非常重要。NodeJS、Angular、VueJS或React all…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">www.youtube.com</p></div></div><div class="ol l"><div class="ox l on oo op ol oq ix oc"/></div></div></a></div><p id="633e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">关注我们:</p><p id="c1d8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">【https://www.linkedin.com/company/ckmobi/ T4】</p><p id="7c4d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><a class="ae jd" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ckmobilejavasc1</a></p></div></div>    
</body>
</html>