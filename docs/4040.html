<html>
<head>
<title>React Custom Hooks #1: useLocalStorage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React自定义钩子#1: useLocalStorage</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-custom-hooks-1-uselocalstorage-746fda23c3f8?source=collection_archive---------12-----------------------#2021-08-12">https://javascript.plainenglish.io/react-custom-hooks-1-uselocalstorage-746fda23c3f8?source=collection_archive---------12-----------------------#2021-08-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="2a38" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">REACT HOOKS食谱</h2><div class=""/><div class=""><h2 id="f754" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用React在localStorage上创建简单的持久化数据，以保存用户首选项。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/93a370dd06522ea51b9bf5d68d76144e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TLCnSssNSuu-L9LYOAoIig.png"/></div></div></figure><p id="7db6" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在我开始创建自己的设计系统<a class="ae lw" href="https://www.npmjs.com/search?q=%40mountain-ui" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> mountain-ui </strong> </a>之后，我认为我在职业生涯中迄今为止所学到的东西以及我在实现中所应用的东西可能会对其他希望更好地学习如何充分利用React API的开发人员有所帮助。</p><p id="b778" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">所以，我开始了一个新的系列文章，我们将一起看看我是如何创建一些我每天都在使用的定制钩子的。有时我会修改现有的解决方案，其他的我会根据自己的需求从头开始创建。</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h2 id="2802" class="me mf iq bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv iw bi translated">使用本地存储挂钩的原因</h2><p id="f132" class="pw-post-body-paragraph la lb iq lc b ld mw ka lf lg mx kd li lj my ll lm ln mz lp lq lr na lt lu lv ij bi translated">我不止一次发现自己需要跨用户会话持久化一条信息，比如页面的选定字体大小，或者用户的黑暗模式偏好。</p><p id="9c7d" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">对我来说，让localStorage与React状态同步是必须的。</p><p id="5bfa" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">当钩子随React 16.8出现时，许多开发人员开始使用它们，创建能够与浏览器API交互的自定义钩子，并创建更好的开发人员体验。</p><p id="bab0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">那时我发现了这个钩子的第一个实现，随着时间的推移，它一直在不断迭代，以始终为开发人员的需求提供更好的支持。</p><p id="0a76" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在<a class="ae lw" href="https://github.com/tonyghiani/mountain-ui" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> mountain-ui </strong> </a>中，我正在为个人发展和我的<a class="ae lw" href="https://marcoghiani.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja">个人网站</strong> </a>构建库，我创建了一个包，我将在其中定义我们将在本系列中看到的所有挂钩，可以随意使用它，如果您愿意，也可以投稿。</p><h2 id="328d" class="me mf iq bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv iw bi translated">幕后是怎么运作的？</h2><p id="2be2" class="pw-post-body-paragraph la lb iq lc b ld mw ka lf lg mx kd li lj my ll lm ln mz lp lq lr na lt lu lv ij bi translated">这个自定义挂钩为开发人员提供了与本地存储交互的基本功能:</p><ul class=""><li id="1818" class="nb nc iq lc b ld le lg lh lj nd ln ne lr nf lv ng nh ni nj bi translated">在客户端设备的本地存储中存储一个键/值对。</li><li id="865a" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">将存储的值与反应状态同步，以便在设置新值时重新呈现组件。</li><li id="30cb" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">它还负责SSR，避免在构建时或服务器端调用钩子时出错。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/43c5b3e3c232b5f6200262f5b42aa15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bmZmvysEv7hEOWLV"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Photo by <a class="ae lw" href="https://unsplash.com/@tata186?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tatiana Rodriguez</a> on <a class="ae lw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="d99c" class="me mf iq bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv iw bi translated">编码时间</h2><p id="cc83" class="pw-post-body-paragraph la lb iq lc b ld mw ka lf lg mx kd li lj my ll lm ln mz lp lq lr na lt lu lv ij bi translated">现在让我们一起检查一下这个钩子的实现，我们会一步一步地看到当我们在一个组件内部调用钩子时会发生什么！</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="043c" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这是一段很长的代码。但是让我们从头开始理解它的作用:</p><ul class=""><li id="f9bc" class="nb nc iq lc b ld le lg lh lj nd ln ne lr nf lv ng nh ni nj bi translated">首先，它为实现导入了一个实用程序，您可以在<a class="ae lw" href="https://github.com/tonyghiani/mountain-ui" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> mountain-ui存储库</strong> </a> <strong class="lc ja">中找到的函数<code class="fe nw nx ny nz b">hasWindow</code>。</strong></li><li id="6ace" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">在初始导入之后，我们开始声明钩子函数。它需要两个参数，第一个是强制的，是用于将值存储到localStorage中的<strong class="lc ja">键</strong>。第二个是可选的，是与<em class="oa">键</em>参数相关联的要保存的<strong class="lc ja"> initialValue </strong>。</li><li id="d1a6" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">实现的第一步是定义一个函数<code class="fe nw nx ny nz b">loadStoredValue</code>，该函数允许从localStorage中检索用<em class="oa">键</em>参数保存的值。它还控制是否使用<code class="fe nw nx ny nz b">hasWindow</code>函数在服务器中调用钩子，防止在下面几行中访问窗口对象时出错。</li><li id="e699" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">一旦我们定义了<code class="fe nw nx ny nz b">loadStoredValue</code> init函数，我们就创建一个新的React状态来保存存储的值。这个状态对于保持localStorage值和UI的同步是必不可少的，这样一旦存储了新值，使用这个钩子的组件就可以重新呈现。</li><li id="bc52" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">既然已经创建了一个状态，下一步就是定义一个updater函数，它能够将新值存储到localStorage中，并更新以前创建的状态。</li><li id="6b67" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated">最后，在将钩子调用的结果作为<code class="fe nw nx ny nz b">[storedValue, setValue]</code>返回之前，我们应用了一个应该只在挂载上运行的副作用，以从localStorage恢复值，并将其与React状态同步。</li></ul><h2 id="b1f8" class="me mf iq bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv iw bi translated">挂钩用法</h2><p id="081a" class="pw-post-body-paragraph la lb iq lc b ld mw ka lf lg mx kd li lj my ll lm ln mz lp lq lr na lt lu lv ij bi translated">正如我之前指出的，这个定制钩子有很多用途，这取决于你的需求。您可以使用这个钩子来创建其他自定义实现，并将更多的逻辑提取到可重用的钩子中！</p></div><div class="ab cl lx ly hu lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ij ik il im in"><h2 id="b949" class="me mf iq bd mg mh mi dn mj mk ml dp mm lj mn mo mp ln mq mr ms lr mt mu mv iw bi translated">结论</h2><p id="3629" class="pw-post-body-paragraph la lb iq lc b ld mw ka lf lg mx kd li lj my ll lm ln mz lp lq lr na lt lu lv ij bi translated">我们已经结束了第一个React Hooks的故事，我希望它能有所帮助，我希望听到你的任何疑问，你可以直接在<a class="ae lw" href="https://twitter.com/tonyghiani" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> Twitter </strong> </a>上ping我，或者在这里评论帖子！</p><p id="a031" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您还可以在以下页面找到更多关于我正在使用的资源的信息:</p><ul class=""><li id="aa8d" class="nb nc iq lc b ld le lg lh lj nd ln ne lr nf lv ng nh ni nj bi translated"><a class="ae lw" href="https://github.com/tonyghiani/mountain-ui" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja"> Mountain-ui </strong> </a></li><li id="17c4" class="nb nc iq lc b ld nk lg nl lj nm ln nn lr no lv ng nh ni nj bi translated"><a class="ae lw" href="https://marcoghiani.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lc ja">我的个人页面</strong> </a></li></ul><p id="122c" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">感谢您花时间阅读，下一篇文章再见！🚀</p><p id="dff0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="oa">更多内容请看</em><a class="ae lw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lc ja"><em class="oa">plain English . io</em></strong></a></p></div></div>    
</body>
</html>