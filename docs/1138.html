<html>
<head>
<title>How to Access Private S3 Buckets Securely</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何安全地访问私有S3存储桶</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-access-private-s3-buckets-securely-87778efd93bd?source=collection_archive---------0-----------------------#2021-03-10">https://javascript.plainenglish.io/how-to-access-private-s3-buckets-securely-87778efd93bd?source=collection_archive---------0-----------------------#2021-03-10</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="48e8" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">使用预签名的URL</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/4caee147dde2465fbdec90ea7763abc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*popLGIUJaWpO7fuWAjlArA.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@franckinjapan?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Franck</a> on <a class="ae kw" href="/s/photos/security?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7d73" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">将文件上传到远程服务器是任何现代应用程序最常见的任务之一。AWS有一个名为S3(简单存储服务)的服务，使这项工作变得非常容易。</p><p id="9fda" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是<strong class="kz is">你知道</strong>我们如何安全地访问这些桶吗？</p><p id="10df" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">今天，我们将看看如何安全地执行最常见的两种操作</p><ol class=""><li id="bbe5" class="lt lu ir kz b la lb ld le lg lv lk lw lo lx ls ly lz ma mb bi translated"><strong class="kz is">上传</strong>文件到S3</li><li id="9351" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls ly lz ma mb bi translated">从S3下载文件</li></ol><p id="e1df" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">先从上传文件说起。</p><h1 id="08e6" class="mh mi ir bd mj mk ml mm mn mo mp mq mr jx ms jy mt ka mu kb mv kd mw ke mx my bi translated">重要的事情先来</h1><p id="a74f" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">我假设你已经知道如何创建一个S3桶。如果没有，有大量的文章。</p><p id="574b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">您可以从您已经拥有的任何铲斗开始，并执行以下操作</p><p id="22af" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">转到<strong class="kz is">桶</strong>-&gt;-<strong class="kz is">权限</strong>-&gt;-<strong class="kz is">阻止<em class="ne">所有</em>公共访问</strong></p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nf"><img src="../Images/3a951db27316690757259dbbdeb9a835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m8ULOFnhBVQz5i91ZZkOXA.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Block All Public Access</figcaption></figure><p id="490a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们的水桶是<strong class="kz is">安全的</strong>。现在，当任何人试图访问桶时，他们将看到这个而不是实际的文件。</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nf"><img src="../Images/b1b8cbc9c0dfcb93d51eb692cd3da77c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpuxQGGUBdoy3cRgKFO0pA.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Access denied</figcaption></figure><p id="8131" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">好了，现在我们的桶安全了。但我们需要访问它，对吗？</p><p id="8039" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">让我们从如何将文件上传到我们的bucket开始。</p><h1 id="aaec" class="mh mi ir bd mj mk ml mm mn mo mp mq mr jx ms jy mt ka mu kb mv kd mw ke mx my bi translated">备选方案1。通过自定义后端上传</h1><p id="091d" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">您可以将文件发送到某种服务器，然后进行验证，使用适当的身份验证令牌将文件发送到s3，并将URL返回给用户。</p><p id="b495" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">流程看起来像这样，</p><p id="5316" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe ng nh ni nj b">Frontend Application</code>-&gt;-<code class="fe ng nh ni nj b">Custom Backend</code>-&gt;-<code class="fe ng nh ni nj b">S3 Bucket</code></p><h2 id="9388" class="nk mi ir bd mj nl nm dn mn nn no dp mr lg np nq mt lk nr ns mv lo nt nu mx nv bi translated">这种方法的问题</h2><ul class=""><li id="e70e" class="lt lu ir kz b la mz ld na lg nw lk nx lo ny ls nz lz ma mb bi translated">它增加了服务器的负载。</li><li id="efa9" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nz lz ma mb bi translated">用户首先必须等待文件上传到服务器，然后再上传到s3，这需要时间。</li><li id="443f" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nz lz ma mb bi translated">对于大型文件，存在多个故障点，这是不可取的。</li></ul></div><div class="ab cl oa ob hv oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ik il im in io"><h1 id="99f5" class="mh mi ir bd mj mk oh mm mn mo oi mq mr jx oj jy mt ka ok kb mv kd ol ke mx my bi translated">选项2。直接从前端上传</h1><p id="f824" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">您可以直接将文件上传到远程服务器。这样我们等待的时间就少了。</p><p id="a0b7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><code class="fe ng nh ni nj b">Frontend Application</code>-&gt;-<code class="fe ng nh ni nj b">S3 Bucket</code></p><p id="ea77" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">下面的文章展示了如何做到这一点。</p><div class="om on gq gs oo op"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-upload-files-to-aws-s3-in-react-591e533d615e"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">如何在React中将文件上传到AWS S3</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">以两种不同的方式</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd kq op"/></div></div></a></div><h2 id="06c7" class="nk mi ir bd mj nl nm dn mn nn no dp mr lg np nq mt lk nr ns mv lo nt nu mx nv bi translated">这种方法的问题</h2><ul class=""><li id="f991" class="lt lu ir kz b la mz ld na lg nw lk nx lo ny ls nz lz ma mb bi translated">你必须直接在你的前端代码中存储安全令牌，这不是一个好主意。</li><li id="b6a4" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nz lz ma mb bi translated">如果你的安全令牌暴露了，你会损失一大笔钱。</li></ul></div><div class="ab cl oa ob hv oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ik il im in io"><h1 id="f727" class="mh mi ir bd mj mk oh mm mn mo oi mq mr jx oj jy mt ka ok kb mv kd ol ke mx my bi translated">改进的解决方案:预签名URL方法</h1><p id="3e57" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">现在我们来看看如何解决前两种方法的所有问题。在这种方法中，我们可以使用我们的<code class="fe ng nh ni nj b">aws-sdk</code>来生成一个预签名的URL，这样我们就可以直接访问S3桶，而不用暴露安全令牌。</p><p id="597d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">首先，我们将一些关于对象的信息(不是实际的文件)从前端发送到某种后端API(可以是lambda函数)。</p><p id="ab15" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这个函数获取信息并为我们创建一个post API。</p><p id="4943" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后我们可以使用<code class="fe ng nh ni nj b">axios</code>或<code class="fe ng nh ni nj b">fetch</code>将对象直接从前端发送到S3桶。</p><h2 id="ae8e" class="nk mi ir bd mj nl nm dn mn nn no dp mr lg np nq mt lk nr ns mv lo nt nu mx nv bi translated">这种方法的好处</h2><ul class=""><li id="2e67" class="lt lu ir kz b la mz ld na lg nw lk nx lo ny ls nz lz ma mb bi translated">我们不需要在前端代码中存储任何种类的<strong class="kz is">秘密</strong>。</li><li id="b8b5" class="lt lu ir kz b la mc ld md lg me lk mf lo mg ls nz lz ma mb bi translated">我们不需要等待将实际文件发送到后端，从而将响应时间减少了50%!</li></ul><h1 id="bc23" class="mh mi ir bd mj mk ml mm mn mo mp mq mr jx ms jy mt ka mu kb mv kd mw ke mx my bi translated">第一步。准备后端</h1><p id="9b6d" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">下面是可以用来生成签名URL的函数</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="pe pf l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">function to generate signed URL</figcaption></figure><p id="043b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">你可以把这个函数保存在lambda或者你自己的后端。</p><h1 id="14e3" class="mh mi ir bd mj mk ml mm mn mo mp mq mr jx ms jy mt ka mu kb mv kd mw ke mx my bi translated">第二步。在前端使用</h1><p id="efeb" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">在您的前端，您只需调用这个API或Lambda并获取URL，然后向您提供的端点发出一个简单的<code class="fe ng nh ni nj b">PUT</code>请求。</p><p id="c582" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">有效载荷必须是你的实际文件，而不是某种多部分数据。</p><p id="cb59" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">下面是一个简单的React组件来实现这一点</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="pe pf l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Frontend Code</figcaption></figure><p id="3e64" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">该组件可用于安全地将文件上传到s3存储桶。</p></div><div class="ab cl oa ob hv oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ik il im in io"><h1 id="91e4" class="mh mi ir bd mj mk oh mm mn mo oi mq mr jx oj jy mt ka ok kb mv kd ol ke mx my bi translated">安全地获取对象</h1><p id="2cc8" class="pw-post-body-paragraph kx ky ir kz b la mz js lc ld na jv lf lg nb li lj lk nc lm ln lo nd lq lr ls ik bi translated">我们已经看到了如何通过预先签名的URL安全地上传文件。下载呢？</p><p id="fb80" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">好吧，这里我们可以再次使用这种预先签名的URL方法！现在不是<code class="fe ng nh ni nj b">putObject</code>类型的网址，我们需要的是<code class="fe ng nh ni nj b">getObject</code>类型的预签名网址。我们可以使用下面的函数来实现。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="pe pf l"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">get pre-signed get object url</figcaption></figure><p id="2a6b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，每当我们的用户需要查看一些图像时，我们将向他们显示带有<strong class="kz is">预签名URL </strong>而不是<strong class="kz is">实际URL </strong>的图像。</p><p id="55ab" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">就是这样！我希望这篇文章能对如何<strong class="kz is">安全地</strong>访问<strong class="kz is"> S3桶</strong>来上传和下载数据有所启发。</p><p id="c7ae" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">祝您愉快！</p><p id="f73d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">有话要说？</strong></p><p id="5473" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">通过</strong><a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is">LinkedIn</strong></a><strong class="kz is">或我的</strong> <a class="ae kw" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is">个人网站</strong> </a> <strong class="kz is">与我取得联系。</strong></p></div><div class="ab cl oa ob hv oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ik il im in io"><div class="kh ki kj kk gu op"><a rel="noopener  ugc nofollow" target="_blank" href="/20-essential-parts-of-any-large-scale-react-app-ee4bd35436a0"><div class="oq ab fp"><div class="or ab os cl cj ot"><h2 class="bd is gz z fq ou fs ft ov fv fx iq bi translated">任何大型React应用程序的20个基本部分</h2><div class="ow l"><h3 class="bd b gz z fq ou fs ft ov fv fx dk translated">如果您正在编写企业级代码，您需要了解这一点</h3></div><div class="ox l"><p class="bd b dl z fq ou fs ft ov fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="oy l"><div class="pg l pa pb pc oy pd kq op"/></div></div></a></div></div></div>    
</body>
</html>