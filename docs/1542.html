<html>
<head>
<title>Stripe Integration with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Node.js的条带集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/stripe-integration-with-node-js-6adb8cbc81f7?source=collection_archive---------6-----------------------#2021-04-02">https://javascript.plainenglish.io/stripe-integration-with-node-js-6adb8cbc81f7?source=collection_archive---------6-----------------------#2021-04-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8268257b5f38cfd1327d46a7b2a5c0ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Mo8aRkYbhvmh-QhzudO3g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Stripe+node.js</figcaption></figure><p id="4575" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">数字时代增加了在线支付方式。只需点击一下，就可以轻松地在网上购买任何产品。为了达到这个目的，市场上有许多支付网关。</p><p id="aab4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Stripe是最受欢迎的国际支付网关之一。您可以向客户收取一次性费用或连续定期订购费用。使用stripe，您可以轻松地选择其中一种类型，并在自己的数据库中维护一个记录。</p><p id="1520" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，不再浪费时间，让我们深入了解与Node.js项目的条带集成。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/63cf4f8e0552b180b8e3daa2c67102fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*ZgPATdTUC98YrcpCCoBthA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Account creation to checkout flow</figcaption></figure><h2 id="28d7" class="lc ld in bd le lf lg dn lh li lj dp lk kk ll lm ln ko lo lp lq ks lr ls lt lu bi translated"><strong class="ak">第一步。条带帐户创建</strong></h2><p id="d9ca" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">首先，在https://stripe.com/en-in的<a class="ae ma" href="https://stripe.com/en-in" rel="noopener ugc nofollow" target="_blank">上创建stripe账户，并填写您的数据。它看起来会像这样。</a></p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/9ace92aa518373369e28ec0dbbafc263.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFp9mHkvKtXrnl_FdBlkyA.png"/></div></div></figure><p id="e950" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">默认情况下，它会为您创建一个测试环境，让您尝试所有选项。您可以通过在“激活您的帐户”部分填写业务相关信息来激活您的帐户。Stripe在“开发人员”部分提供日志和事件，供开发人员检查与stripe活动相关的日志和事件。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/7239136532d8b233a155e7d7abe95c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhnRIx5KcSoHwgMhPnI41g.png"/></div></div></figure><p id="67fc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在转到“API密匙”一节来获取应用程序的API密匙。有两种类型的密钥“可公开密钥”和“秘密密钥”。可发布密钥用于客户机环境&amp;秘密密钥用于服务器端环境。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/e4fa6c6c1cf483e70afcfb7a7089af87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pW5lvpJUPVKjS-NVKpDhaA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">API keys for stripe account</figcaption></figure><h2 id="7cfd" class="lc ld in bd le lf lg dn lh li lj dp lk kk ll lm ln ko lo lp lq ks lr ls lt lu bi translated"><strong class="ak">第二步。Node.js设置</strong></h2><p id="378a" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">用npm或纱线安装包装:</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="90a7" class="lc ld in mf b gy mj mk l ml mm">npm install stripe --save</span><span id="eed0" class="lc ld in mf b gy mn mk l ml mm">yarn add stripe</span></pre><p id="0fc0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在让我们创建index.js文件，并创建客户&amp;为客户结帐生成会话。导入条带时提供服务器密钥。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="7594" class="lc ld in mf b gy mj mk l ml mm">const stripe = require('stripe')('sk_test_...');</span><span id="6022" class="lc ld in mf b gy mn mk l ml mm">const customer = await stripe.customers.create({<br/> email: req.body.email,<br/> name: `${req.body.firstName} ${req.body.lastName}`,<br/> phone: `${req.body.countryCode} ${req.body.phoneNo}`,<br/> description: 'User Account Created'<br/>})</span></pre><p id="7c2b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">可以创建checkout对象并根据条件添加其他数据。您可以在订阅支付模式下指定优惠券代码或免费试用。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="575b" class="lc ld in mf b gy mj mk l ml mm">const checkoutObject = {<br/>/* Specify different payment method */<br/>payment_method_types: ['card'],<br/>line_items: [{<br/> price: "price_1IXkvZKjhdisu8333",<br/> quantity: 1,<br/>}],<br/>metadata: {<br/> firstName: req.body.firstName,<br/> /* any meta data for your ref */<br/>},<br/>customer: customer.customerId,<br/>mode: "payment", // payment, subscription etc<br/>success_url: `${getConfig().PROJECT_URL}/thankyou`,<br/>cancel_url: `${getConfig().PROJECT_URL}/subscribe`,<br/>}<br/>if (req.body.couponId) {<br/> checkoutObject.discounts = [{<br/>  coupon: req.body.couponId,<br/> }]<br/>}<br/>/* If payment mode is subscription */<br/>if (req.body.subscriptionType === 'subscription') {<br/> checkoutObject.subscription_data = {<br/>  trial_period_days: 30<br/> }<br/>}</span><span id="98bf" class="lc ld in mf b gy mn mk l ml mm">const session = await stripe.checkout.sessions.create(checkoutObject)</span></pre><p id="dc2e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下面是一个文件中的全部代码。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/b3ee20702e29bf562677e1c3ac4543d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*WamwqZek-DXz5oONUQG8kQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Stripe create customer API</figcaption></figure><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/9cd91df39c501c2e8a8e66329f90a14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*EeWL8VDlrN7-jzWIkbsz3A.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Stripe checkout session API</figcaption></figure><p id="7006" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在创建表单并要求用户数据提交表单。点击订阅表单，收集数据并调用创建帐户API注册成功后，将用户导航到帐户页面，并向用户展示产品。在点击购物车时，结帐按钮调用结帐订单API。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/92543dd42443e26d0fb794ebd2d7d4be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*6DC5ET5PoZQkYO43nfTKvg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Call create account API</figcaption></figure><p id="879c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果会话创建成功，它将被重定向到条带结帐页面，否则将向客户显示错误。</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/c7df016ef0741d9cf53f90ab7fb82191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*u5RJxzdjdBPMGTJTgTf1KQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Call checkout Order API</figcaption></figure><h2 id="5100" class="lc ld in bd le lf lg dn lh li lj dp lk kk ll lm ln ko lo lp lq ks lr ls lt lu bi translated">结论</h2><p id="67b8" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">仅此而已。您已经准备好开始您的在线支付业务。欲了解更多信息，请访问条带集成的官方文档<a class="ae ma" href="https://stripe.com/docs/api" rel="noopener ugc nofollow" target="_blank"/>。要了解如何模仿Stripe APIs进行自动化测试<a class="ae ma" rel="noopener ugc nofollow" target="_blank" href="/mock-stripe-api-in-node-js-with-jest-c9d8df595ff4">，请阅读这里的</a>。感谢阅读。</p><p id="b0fa" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="ms">更多内容请看</em><a class="ae ma" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="ms">plain English . io</em></strong></a></p></div></div>    
</body>
</html>