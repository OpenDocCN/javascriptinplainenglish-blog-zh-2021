<html>
<head>
<title>How to Upload Files to an S3 Bucket in a Vue.js App and Save to MongoDB (A Beginner’s Guide)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将文件上传到Vue.js应用中的S3桶并保存到MongoDB(初学者指南)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-upload-files-to-an-s3-bucket-in-a-vue-js-app-and-save-to-mongodb-a-beginners-guide-dfada815b7eb?source=collection_archive---------1-----------------------#2021-04-14">https://javascript.plainenglish.io/how-to-upload-files-to-an-s3-bucket-in-a-vue-js-app-and-save-to-mongodb-a-beginners-guide-dfada815b7eb?source=collection_archive---------1-----------------------#2021-04-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b36e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Multer和Express将文件上传到具有Node.js后端和Vue.js前端的S3 bucket，并将它们保存在数据库中——在本例中是MongoDB。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/e394b0dccb58624dbdb781026954309a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLGV5rpX8ZaDeoZ4VpqOxQ.png"/></div></div></figure><h2 id="023a" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">介绍</h2><p id="eac8" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">在构建web应用程序时，您的用户可能需要在前端上传文件。要查看这些文件，您需要在后端实现一个API和一个数据库来接收它们。使用Node.js框架<a class="ae md" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>和中间件<a class="ae md" href="https://www.npmjs.com/package/multer" rel="noopener ugc nofollow" target="_blank"> Multer </a>，您可以在一个设置中建立文件和图像上传。</p><p id="fecb" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在本文中，您将学习如何使用Multer和Express将文件上传到具有Node.js后端和Vue.js前端的S3 bucket，并将图像名称保存到数据库——在本例中是MongoDB。</p><h2 id="94c6" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">要求</h2><ul class=""><li id="3ad2" class="mj mk in lm b ln lo lq lr kx ml lb mm lf mn mc mo mp mq mr bi translated">创建一个AWS帐户。</li><li id="9f2d" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">创建IAM组并附加策略。</li><li id="d06f" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">将IAM用户添加到创建的组中。</li><li id="5256" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">在AWS S3中创建一个存储桶来存储我的静态文件。</li><li id="c2db" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">设置MongoDB。</li><li id="0a99" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">使用Node.js和Express设置后端API或端点，它们将通过SDK访问AWS S3桶。</li><li id="225a" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">创建我们的Vue.js应用程序。</li></ul><h2 id="b55d" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">AWS IAM</h2><p id="4d9d" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated"><strong class="lm io">我是什么？</strong></p><p id="1bdd" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">AWS身份和访问管理(IAM)是一个web服务，可帮助您安全地控制对AWS资源的访问。您使用IAM来控制谁被验证(登录)和授权(有权限)使用资源。</p><p id="eaaa" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">当您第一次创建AWS帐户时，您从单一登录身份开始，该身份拥有对帐户中所有AWS服务和资源的完全访问权限。这个身份被称为AWS帐户<em class="mx"> root用户</em>，通过使用您创建帐户时使用的电子邮件地址和密码登录即可访问。</p><p id="a733" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">AWS强烈建议您不要在日常工作中使用root用户，即使是管理工作。相反，坚持使用root用户创建您的第一个IAM用户的<a class="ae md" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#create-iam-users" rel="noopener ugc nofollow" target="_blank">最佳实践。然后安全地锁定根用户凭据，并使用它们来执行少量的帐户和服务管理任务。</a></p><p id="25ac" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><strong class="lm io">什么是IAM组？</strong></p><p id="2068" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">IAM组是IAM用户的集合。组允许您为多个用户指定权限，这使得管理这些用户的权限更加容易。例如，您可以有一个名为<em class="mx"> Admins </em>的组，并授予该组管理员通常需要的权限类型。该组中的任何用户都自动拥有分配给该组的权限。如果新用户加入您的组织并需要管理员权限，您可以通过将该用户添加到该组来分配适当的权限。</p><p id="cc70" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">同样，如果一个人在您的组织中更改了职务，您可以将他或她从旧组中删除，并将其添加到适当的新组中，而不是编辑该用户的权限。</p><p id="63ba" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在基于资源的策略中，不能将组标识为主体。组是一种一次将策略附加到多个用户的方式。当您将基于身份的策略附加到某个组时，该组中的所有用户都将从该组获得权限。有关这些策略类型的更多信息，请参见<a class="ae md" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_identity-vs-resource.html" rel="noopener ugc nofollow" target="_blank">基于身份的策略和基于资源的策略</a>。</p><p id="eae2" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">以下是组的一些重要特征:</p><ul class=""><li id="6528" class="mj mk in lm b ln me lq mf kx my lb mz lf na mc mo mp mq mr bi translated">一个组可以包含许多用户，一个用户可以属于多个组。</li><li id="b1ef" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">组不能嵌套；它们只能包含用户，不能包含其他组。</li><li id="0458" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">没有默认群组会自动包含AWS帐户中的所有用户。如果您希望有一个这样的组，您需要创建它并为其分配每个新用户。</li><li id="84a8" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc mo mp mq mr bi translated">AWS帐户中IAM资源的数量和大小是有限的。有关更多信息，请参见<a class="ae md" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html" rel="noopener ugc nofollow" target="_blank"> IAM和STS配额</a>。</li></ul><h2 id="1a10" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">在Aws上创建帐户</h2><p id="aa06" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">使用此<a class="ae md" href="https://portal.aws.amazon.com/billing/signup#/start" rel="noopener ugc nofollow" target="_blank">链接</a>在AWS上创建一个帐户，并按照此<a class="ae md" href="https://aws.amazon.com/premiumsupport/knowledge-center/create-and-activate-aws-account/" rel="noopener ugc nofollow" target="_blank">指南</a>激活您的帐户。</p><h2 id="e15c" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建管理员IAM用户和组(控制台)</h2><p id="f126" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">此过程描述了如何使用AWS管理控制台为您自己创建IAM用户，并将该用户添加到对附加的受管策略拥有管理权限的组中。</p><p id="585d" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><strong class="lm io">按照以下步骤为您自己创建一个管理员用户，并将该用户添加到管理员组(控制台)。</strong></p><ol class=""><li id="c3df" class="mj mk in lm b ln me lq mf kx my lb mz lf na mc nb mp mq mr bi translated">通过选择<strong class="lm io">根用户</strong>并输入您的AWS帐户电子邮件地址，作为帐户所有者登录到<a class="ae md" href="https://console.aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> IAM控制台</a>。在下一页上，输入您的密码。</li><li id="7b4e" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">为您将创建的IAM管理员用户启用对计费数据的访问权限，如下所示:</li><li id="246f" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在导航栏上，选择您的帐户名称，然后选择<strong class="lm io">我的帐户</strong>。</li><li id="c625" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在<strong class="lm io"> IAM用户和角色访问计费信息</strong>旁边，选择<strong class="lm io">编辑</strong>。您必须以root用户身份登录，此部分才会显示在帐户页面上。</li><li id="fcf6" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择复选框<strong class="lm io">激活IAM访问</strong>并选择<strong class="lm io">更新</strong>。</li><li id="c47c" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在导航栏上选择<strong class="lm io">服务</strong>，然后选择<strong class="lm io"> IAM </strong>返回IAM仪表盘。</li><li id="8929" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在导航窗格中，选择<strong class="lm io">用户</strong>，然后选择<strong class="lm io">添加用户</strong>。</li><li id="befb" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在<strong class="lm io">详细信息</strong>页面上，执行以下操作:</li><li id="e97f" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">对于<strong class="lm io">用户名</strong>，输入<strong class="lm io">管理员</strong>。或者<strong class="lm io">或者任何你想给</strong>起的名字</li><li id="cb0d" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选中<strong class="lm io"> AWS管理控制台访问</strong>的复选框，选择<strong class="lm io">自定义密码</strong>，然后在文本框中输入新密码。</li><li id="8c2b" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">默认情况下，AWS会强制新用户在首次登录时创建新密码。您可以选择清除<strong class="lm io">旁边的复选框“用户必须在下次登录</strong>时创建新密码”，以允许新用户在登录后重置密码。</li><li id="43b2" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">下一步:权限</strong>。</li><li id="518f" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在<strong class="lm io">权限</strong>页面，执行以下操作:</li><li id="52c7" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">将用户添加到组</strong>。</li><li id="4d25" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">创建组</strong>。</li><li id="5978" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">在<strong class="lm io">创建组</strong>对话框中，为<strong class="lm io">组名</strong>键入<strong class="lm io">管理员</strong>。</li><li id="5683" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选中<strong class="lm io">管理员访问</strong>策略的复选框。</li><li id="1a72" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">创建组</strong>。</li><li id="1b35" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">返回到包含组列表的页面，选中新组的复选框。如果在列表中未看到新组，请选择<strong class="lm io">刷新</strong>。</li><li id="c453" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">下一个:标签</strong>。</li><li id="73d6" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">(可选)在<strong class="lm io">标记</strong>页面上，通过将标记作为键值对附加给用户来添加元数据。有关详细信息，请参阅<a class="ae md" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/id_tags.html" rel="noopener ugc nofollow" target="_blank">标记IAM资源</a>。</li><li id="4b0e" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">选择<strong class="lm io">下一步:查看</strong>。验证要添加到新用户的组成员身份。准备继续时，选择<strong class="lm io">创建用户</strong>。</li><li id="3ed5" class="mj mk in lm b ln ms lq mt kx mu lb mv lf mw mc nb mp mq mr bi translated">(可选)在<strong class="lm io">完成</strong>页面，可以下载带有用户登录信息的. csv文件，也可以发送带有登录说明的电子邮件给用户。</li></ol><h2 id="4ef4" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">在AWS S3创建一个存储我的静态文件的存储桶</h2><p id="9bad" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">使用新创建的用户登录到AWS控制台。在导航栏的顶部，单击服务，如下图所示。将出现一个下拉列表，其中包含AWS服务的列表。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/80131f00fc874db82c0ba6f2d9da3c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqrEjNPYSJ8Ngr5u2EQ7sQ.png"/></div></div></figure><p id="3e70" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在下拉列表中，单击S3。这将引导您进入一个页面，您可以在其中创建一个新的存储桶。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/bbbcf026a10843cb3cbca77af146381f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srx3zUlzoFqZm_BFBcKupw.png"/></div></div></figure><p id="a6ce" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">如果你注意到了，我们还没有桶。这是因为我们的帐户刚刚创建。</p><p id="b0ee" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要开始，点击<strong class="lm io">创建存储桶</strong>，并填写所需信息。现在，记住我们希望任何人都可以访问我们的bucket中的内容，所以我们必须取消选中<strong class="lm io"><em class="mx">block public access</em></strong>复选框。应该是这样的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/f4945c482ec6e69db367c0fe0aa4107e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9QGHDTZRtdfOz6LO2SQGg.png"/></div></div></figure><p id="4bc1" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">点击页面底部的<strong class="lm io">创建存储桶</strong>。</p><h2 id="a331" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">设置MongoDB</h2><p id="fa79" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">Mongo DB可以有不同的使用方式。我们可以决定将它安装在我们的本地开发机器上，或者我们使用或云服务器，或者我们可以决定使用数据库即服务(Atlas)，由MongoDB提供。</p><p id="caba" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要在您的服务器或本地机器上安装MongoDB，请遵循<a class="ae md" href="https://docs.mongodb.com/manual/installation/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> MongoDB文档</strong> </a> <strong class="lm io">中的说明。</strong>如果你决定使用数据库作为服务，比如<a class="ae md" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"><strong class="lm io">MongoDB atlas</strong></a><strong class="lm io">，</strong>你可以按照<a class="ae md" href="https://docs.atlas.mongodb.com/getting-started/" rel="noopener ugc nofollow" target="_blank"> MongoDB docs </a> <a class="ae md" href="https://docs.mongodb.com/manual/installation/" rel="noopener ugc nofollow" target="_blank"> </a>中的说明开始。</p><h2 id="a3ec" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建Node.js应用程序</h2><p id="e30a" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">既然我们已经创建了S3桶和数据库，那么是时候创建Node.js应用程序了。</p><p id="7017" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">第一个要求是在我们的计算机上安装Node.js。</p><p id="8c3b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> Node.js </strong> </a>是一个开源、跨平台、后端的JavaScript运行时环境，运行在V8引擎上，在web浏览器之外执行JavaScript代码。你可以在这里阅读更多关于它的<a class="ae md" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5630" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要在你的电脑上安装Node，请按照这个<a class="ae md" href="https://www.freecodecamp.org/news/how-to-install-node-js-and-npm-on-windows/" rel="noopener ugc nofollow" target="_blank">链接</a>操作Windows，这个<a class="ae md" href="https://treehouse.github.io/installation-guides/mac/node-mac.html" rel="noopener ugc nofollow" target="_blank">链接</a>操作Mac，这个<a class="ae md" href="https://linuxconfig.org/install-npm-on-linux" rel="noopener ugc nofollow" target="_blank">链接</a>操作Linux。</p><p id="b10b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要检查Node.js安装是否成功，请在终端中运行以下命令:</p><p id="560a" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">node -v</code></p><p id="e7cc" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要验证节点程序包管理器(npm)是否已成功安装，请在终端中键入<code class="fe nf ng nh ni b">npm -v</code>。</p><p id="d50a" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">这应该会打印版本号。你会看到这样的东西<code class="fe nf ng nh ni b">6.4.</code></p><h2 id="c4c8" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建项目</h2><p id="5de5" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">要开始一个新项目，请打开终端，将cd放入工作区文件夹。用您的后端项目名创建一个新目录。对于本教程，我们的项目名称是<code class="fe nf ng nh ni b">vue-multers3-backend</code>。现在，我们进入新创建的项目目录。然后，我们通过键入以下命令来初始化我们的项目:</p><p id="af6b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">npm init</code></p><p id="8786" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">填写完必要的信息后，应该会为您创建一个<strong class="lm io"> package.json </strong>文件。然后用下面的命令安装下面的<code class="fe nf ng nh ni b">npm</code>包:</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="d221" class="ko kp in ni b gy nn no l np nq">npm install --save express multer dotenv cors body-parser mongodb multer-s3 aws-sdk</span></pre><p id="cef1" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">Express</em></strong></a><strong class="lm io"><em class="mx">——</em></strong>快速、无人化、极简的web框架为<a class="ae md" href="http://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io">节点</strong> </a> <strong class="lm io">。js </strong>。</p><p id="3298" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/multer" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">Multer</em></strong></a><strong class="lm io"><em class="mx"/>——</strong>Multer是一个处理多部分/表单数据的Node.js中间件，主要用于上传文件。它写在<a class="ae md" href="https://github.com/mscdex/busboy" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io">之上，以获得最大效率。</strong></a></p><p id="a424" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">Dotenv</em></strong></a>—Dotenv是一个零依赖模块，将环境变量从. env文件加载到<a class="ae md" href="https://nodejs.org/docs/latest/api/process.html#process_process_env" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> process.env </strong> </a>中。</p><p id="66f0" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/cors" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">【CORS】</em></strong></a><strong class="lm io"><em class="mx">—</em></strong>CORS是一个Node.js包，用于提供一个<a class="ae md" href="http://www.senchalabs.org/connect/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io">Connect</strong></a>/<a class="ae md" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lm io">Express</strong></a>中间件，该中间件可用于启用跨源资源共享(<a class="ae md" href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"/></a><strong class="lm io">)</strong>。</p><p id="3916" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/body-parser" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">body-parser</em></strong></a>—node . js body解析中间件。</p><p id="52bf" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/mongodb" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">MongoDBg</em></strong></a><strong class="lm io"><em class="mx">—</em></strong>node . js的官方<a class="ae md" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> MongoDB </strong> </a>驱动程序在<a class="ae md" href="https://www.npmjs.com/package/mongodb-core" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> mongodb-core </strong> </a>的基础上提供了一个面向最终用户的高级API。</p><p id="c13b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/multer-s3" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">multer-S3</em></strong></a><strong class="lm io"><em class="mx">—</em></strong>适用于AWS S3的流式multer存储引擎。</p><p id="43ba" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><a class="ae md" href="https://www.npmjs.com/package/aws-sdk" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="mx">aws-SDK</em></strong></a><strong class="lm io"><em class="mx">—</em></strong>AWS-SDK通过提供一组一致且熟悉的库，让JavaScript开发人员可以轻松使用AWS服务。</p><h2 id="1e13" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建我们的Express服务器</h2><p id="42ae" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">首先，我们创建一个名为<code class="fe nf ng nh ni b">index.js</code>的文件，并输入以下代码。这将是我们应用程序的起点。</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="b3d4" class="ko kp in ni b gy nn no l np nq">const express = require('express')<br/>const bodyParser = require('body-parser')<br/>const cors = require('cors')<br/>const dotenv = require('dotenv')<br/>dotenv.config()<br/>const app = express()<br/>//middleWare<br/>app.use(bodyParser.json())<br/>app.use(bodyParser.urlencoded({ extended: true }))<br/>app.use(cors())<br/>    <br/>app.get('/', async (req, res) =&gt; {<br/>  res.status(200).send('S3 Upload Backend')<br/>})<br/>    <br/>const port = process.env.PORT || 5000<br/>app.listen(port, () =&gt; {<br/>  console.log(`server started on port ${port}`)<br/>});</span></pre><p id="ffc0" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在根文件夹中，创建一个<strong class="lm io">。gitignore </strong>和<strong class="lm io">。env </strong>文件。你的<strong class="lm io">。gitignore </strong>文件应该是这样的:</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="f19f" class="ko kp in ni b gy nn no l np nq">.DS_Store<br/>node_modules<br/>/dist<br/>    <br/>#local env files<br/>.env.local<br/>.env.*.local<br/>    <br/>#Log files<br/>npm-debug.log*<br/>yarn-debug.log*<br/>yarn-error.log*<br/>pnpm-debug.log*<br/>    <br/>#Editor directories and files<br/>.idea<br/>.vscode<br/>*.suo<br/>*.ntvs*<br/>*.njsproj<br/>*.sln<br/>*.sw?</span></pre><p id="7eed" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">然后，在我们的<strong class="lm io">里。env </strong>文件，我们设置我们的环境变量。</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="6723" class="ko kp in ni b gy nn no l np nq">DATABASE=mongodb://127.0.0.1:27017/<br/>PORT=5005<br/>AWSAccessKeyId=your_aws_accesskey<br/>AWSSecretKey=your_aws_secret_key<br/>AWSRegion=your_aws_region<br/>AWSBucket=your_aws_bucket</span></pre><p id="5d5b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">如果您记得清楚，当我们在AWS帐户上创建用户时，我们下载了一些凭证。在下载的凭证中是您的秘密密钥和访问密钥。如果您放错了地方，您可以随时从您的仪表板创建另一个。</p><p id="7efe" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">为了启动我们的服务器，我们运行下面的命令。</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="fc2e" class="ko kp in ni b gy nn no l np nq">node index.js</span></pre><p id="365c" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">我们应该在终端上看到这个。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/5bb2161e7f6256f3efe4637928ffac6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*DxPaIPmYFSCuOJW4bfB8Aw.png"/></div></figure><p id="e32b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">当我们在浏览器中访问localhost:5005时，我们会看到这个页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/307507b1ac06751cb2a9ff66eedc3bb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*ig2GND8zRS3zC6iis6X7ww.png"/></div></figure><h2 id="6f26" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">我们的上传中间件</h2><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="0dc9" class="ko kp in ni b gy nn no l np nq">const aws = require('aws-sdk')<br/>const multer = require('multer')<br/>const multerS3 = require('multer-s3')<br/>    <br/>aws.config.update({<br/>  apiVersion: "2006-03-01",<br/>  accessKeyId: process.env.AWSAccessKeyId,<br/>  secretAccessKey: process.env.AWSSecretKey,<br/>  region: process.env.AWSRegion<br/>})</span><span id="b137" class="ko kp in ni b gy nt no l np nq">const s3 = new aws.S3()<br/>    <br/>const upload = multer({<br/>  storage: multerS3({<br/>    s3: s3,<br/>    bucket: process.env.AWSBucket,<br/>    acl: "public-read",<br/>    contentType: multerS3.AUTO_CONTENT_TYPE,<br/>    metadata: (req, file, cb) =&gt; {<br/>      cb(null, { fieldName: file.fieldname})<br/>    },<br/>    key: (req, file, cb) =&gt; {<br/>      cb(null, Date.now().toString() + file.originalname)<br/>    }<br/>  })<br/>})</span></pre><h2 id="5cb9" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">路线</h2><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="a2f6" class="ko kp in ni b gy nn no l np nq">const mongodb = require('mongodb')</span><span id="bccb" class="ko kp in ni b gy nt no l np nq">app.post('/', upload.single('photo'), async (req, res) =&gt; {<br/>  try {<br/>    const users = await loadUsersCollection();<br/>    await users.insertOne({<br/>      first_name: req.body.first_name,<br/>      last_name: req.body.last_name,<br/>      phone: req.body.phone,<br/>      email: req.body.email,<br/>      gender: req.body.gender,<br/>      photo: req.file.location,<br/>    })<br/>    res.status(201).send('success')<br/>    }<br/>    catch (err) {<br/>      res.status(500).send({<br/>        error: 'error occured creating user'<br/>      })<br/>    }<br/>  })<br/>    <br/>    <br/>    <br/>async function loadUsersCollection () {<br/>  const client = await mongodb.MongoClient.connect(process.env.DATABASE, {<br/>   useNewUrlParser: true,<br/>   useUnifiedTopology: true<br/>  })<br/>  return client.db('vue-multers3').collection('users')<br/>}</span></pre><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h2 id="fc43" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建我们的前端应用</h2><p id="2685" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">对于本教程，我们将使用Vuetify作为我们的UI框架。点击<a class="ae md" href="https://vuetifyjs.com/en/getting-started/installation/" rel="noopener ugc nofollow" target="_blank">这里的链接</a>开始学习如何在你的Vue.js项目中使用Vue化。</p><p id="ee15" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">首先，我们需要在全球范围内安装Vue-cli。</p><p id="1cf4" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">npm install -g @vue/cli</code></p><p id="5869" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">安装后，我们用下面的命令在工作区中创建一个空白的前端项目。</p><p id="72f5" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">vue create vue-multers3-frontend</code></p><p id="0c55" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">其中<code class="fe nf ng nh ni b">vue-multers3-frontend</code>是我们的应用程序名称。</p><p id="d46b" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要将<code class="fe nf ng nh ni b">vuetify</code>添加到我们的项目中，我们必须将<code class="fe nf ng nh ni b">cd</code>添加到我们的项目目录中:</p><p id="6c03" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">cd vue-multers3-frontend</code></p><p id="bc1a" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">然后运行以下命令:</p><p id="d058" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">vue add vuetify</code></p><p id="2a55" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">一旦Vuetify安装成功，我们就可以运行:</p><p id="deab" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><code class="fe nf ng nh ni b">npm run serve</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/d138a6709ca58029d8c11760e1b1217a.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*P-ibxejrquejqdvc6ugFWQ.png"/></div></figure><p id="a4a8" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">如果我们在浏览器中访问本地的<code class="fe nf ng nh ni b">url</code>,我们应该会看到这个页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nx"><img src="../Images/fd59a0862835d155c2a371c3b088e58e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlHJTMJgi8AwG3rVglBKBw.png"/></div></div></figure><h2 id="4e25" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建注册组件</h2><p id="e70c" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">让我们在组件文件夹中创建我们的<code class="fe nf ng nh ni b">Register.vue</code>组件，并添加这个代码片段。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="6d35" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">然后我们将这个组件导入到<code class="fe nf ng nh ni b">App.vue</code>中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="d016" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">在保存时，如果我们刷新浏览器，我们应该会看到显示我们的注册组件。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/3a9403466f18b7200aa82d83712a6193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9raGeNlCyA1KnhNVv9J8dQ.png"/></div></div></figure><p id="6a85" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">要通过API请求将我们的数据发送到后端，我们需要安装<strong class="lm io"> axios。</strong> <br/> <strong class="lm io"> Axios </strong>是一个基于Promise的HTTP客户端，用于浏览器和Node.js. <br/>运行下面的命令来安装Axios。请确保您在前端文件夹中。</p><pre class="kd ke kf kg gt nj ni nk nl aw nm bi"><span id="3b5b" class="ko kp in ni b gy nn no l np nq">npm install axios</span></pre><p id="3ba2" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">现在让我们将提交功能添加到注册组件中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="01c5" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">当我们提交表单时，我们应该在控制台中看到一条成功消息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nz"><img src="../Images/87a5ddca8a6a7f6378418e47f90ebbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQadiRrLxe9LV4gygJQAfQ.png"/></div></div></figure><p id="a20a" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">如果我们检查我们的数据库，我们可以看到我们在S3桶文件的url已被保存。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oa"><img src="../Images/bb1522e22380c1a49a541e98fc60832c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pP9JvqgQBz68lJzuDdGQ7w.png"/></div></div></figure><p id="c683" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">感谢您的阅读。我希望你已经发现这是有用的。你可以在这里找到后端代码<a class="ae md" href="https://github.com/faithfulojebiyi/vue-multers3-backend" rel="noopener ugc nofollow" target="_blank">的链接，在这里</a>找到前端代码<a class="ae md" href="https://github.com/faithfulojebiyi/vue-multers3-backend" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1678" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated">编码快乐！</p><p id="2065" class="pw-post-body-paragraph lk ll in lm b ln me jo lp lq mf jr ls kx mg lu lv lb mh lx ly lf mi ma mb mc ig bi translated"><em class="mx">更多内容请看</em><a class="ae md" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mx">plain English . io</em></a></p></div></div>    
</body>
</html>