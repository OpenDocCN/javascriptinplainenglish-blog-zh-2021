<html>
<head>
<title>Create A â€˜Control Roomâ€™ for Client-Side Rendered Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä¸ºå®¢æˆ·ç«¯å‘ˆç°çš„åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªâ€œæ§åˆ¶å®¤â€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/a-control-room-for-client-side-rendered-apps-31047e011a37?source=collection_archive---------10-----------------------#2021-02-15">https://javascript.plainenglish.io/a-control-room-for-client-side-rendered-apps-31047e011a37?source=collection_archive---------10-----------------------#2021-02-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/c39d1aea36f9360b05cac71871cf1053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*juz4GiIRp2awqV0jVVUG6g.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@hectorfarahani?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Hector Farahani</a> on <a class="ae ja" href="https://unsplash.com/s/photos/yazd?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="17f7" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘ä¸ç¡®å®šè¿™ä¸ªå¸–å­çš„æ ‡é¢˜ï¼Œæˆ‘æƒ³äº†24ä¸ªå°æ—¶ï¼Œæ²¡æœ‰æ‰¾åˆ°æ›´å¥½çš„ï¼Œæ‰€ä»¥å°±å«å®ƒ<em class="ky">â€œä¸ºå®¢æˆ·ç«¯æ¸²æŸ“çš„å‰ç«¯åº”ç”¨ç¨‹åºåˆ›å»ºæ§åˆ¶å®¤ï¼â€</em> \_(ãƒ„)_/ã€‚<br/>å¦‚æœä½ éœ€è¦ä¸ä½ çš„å‰ç«¯åº”ç”¨ç¨‹åºè¿›è¡Œä¸€äº›<code class="fe kz la lb lc b">States</code>äº¤æµï¼Œè¿™ç§æ¨¡å¼æ˜¯æœ‰ç›Šçš„ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€çŸ¥ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¸²æŸ“åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œå­˜åœ¨ä¸€äº›æŒ‘æˆ˜ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªä¾‹å­ç»™ä½ ä¸€ä¸ªå…¨é¢çš„æè¿°ã€‚</p><h2 id="d1c2" class="ld le jd bd lf lg lh dn li lj lk dp ll kl lm ln lo kp lp lq lr kt ls lt lu lv bi translated"><strong class="ak">å®¢æˆ·ç«¯æ¸²æŸ“åº”ç”¨</strong></h2><p id="8dd0" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">éƒ¨ç½²å‰ç«¯åº”ç”¨ç¨‹åºæœ€ç®€å•çš„æ–¹æ³•æ˜¯æ„å»ºå®ƒï¼Œå¹¶å°†èµ„äº§(Javascriptã€CSSã€HTMLç­‰)æ¨é€åˆ°æ‚¨çš„æœåŠ¡å™¨(æˆ–æ— æœåŠ¡å™¨)ï¼Œå¹¶è®©åº”ç”¨ç¨‹åºåœ¨å®¢æˆ·ç«¯å‘ˆç°(è€Œä¸æ˜¯æœåŠ¡å™¨ç«¯å‘ˆç°)ã€‚ä¸€ä¸ªéå¸¸å¸¸è§çš„ä¾‹å­æ˜¯æ„å»ºä¸€ä¸ªReactåº”ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶æ¨é€åˆ°AWS S3ï¼Œç„¶åå°±è¿™æ ·äº†ï¼ä½†è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå³åœ¨å®¢æˆ·ç«¯æ¸²æŸ“åï¼Œä½ æ— æ³•æ§åˆ¶åº”ç”¨ç¨‹åºçš„<strong class="kc je">çŠ¶æ€</strong>ï¼Œå¦‚æœä½ æ­£åœ¨å¤„ç†ä¸€ä¸ªæ¯å¤©æœ‰å¾ˆå¤šç”¨æˆ·çš„ä¼ä¸šåº”ç”¨ç¨‹åºï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ã€‚</p><p id="8abd" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¾‹å¦‚ï¼Œå¦‚æœç”±äºä¸€äº›APIè¿ç§»æˆ–APIæœåŠ¡ä¸Šçš„ä¸€äº›åŸºç¡€è®¾æ–½ä»»åŠ¡ï¼Œæ‚¨éœ€è¦å°†åº”ç”¨ç¨‹åºç½®äºç»´æŠ¤çª—å£ä¸­ï¼Œæ‚¨å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µï¼Ÿä½ å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬æ¥æ›´æ–°ä½ çš„åº”ç”¨ç¨‹åº<strong class="kc je">çŠ¶æ€</strong>å—ï¼Ÿ</p><p id="e82d" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œæ¯å½“ä½ å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬æ—¶ï¼Œä½¿ç”¨ä½ çš„åº”ç”¨ç¨‹åºçš„ç”¨æˆ·åœ¨åˆ·æ–°ä»–ä»¬çš„é¡µé¢ä¹‹å‰ä¸çŸ¥é“æ–°ç‰ˆæœ¬ï¼Œå› æ­¤ï¼Œå¦‚æœä½ éƒ¨ç½²äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬çš„APIæœåŠ¡ï¼Œéœ€è¦åœ¨å‰ç«¯è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œä½ å¦‚ä½•è®©ç”¨æˆ·çŸ¥é“ä»–ä»¬éœ€è¦åˆ·æ–°ä»–ä»¬çš„é¡µé¢ä»¥è·å¾—æœ€æ–°ç‰ˆæœ¬ï¼Ÿ</p><h2 id="bce9" class="ld le jd bd lf lg lh dn li lj lk dp ll kl lm ln lo kp lp lq lr kt ls lt lu lv bi translated"><strong class="ak">é€‚ç”¨äºæ‰€æœ‰åœºæ™¯çš„é€šç”¨è§£å†³æ–¹æ¡ˆ</strong></h2><p id="82fc" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">åº•çº¿æ˜¯æˆ‘ä»¬æƒ³ä¸ºæˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªæ§åˆ¶å®¤ã€‚æˆ‘æƒ³åœ¨è¿™é‡Œè°ˆè®ºçš„è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè§£å†³æ–¹æ¡ˆä¸­çš„ä¸€ä¸ªï¼Œå®ƒä¸ä¸€å®šæ˜¯æœ€å¥½çš„ï¼Œä½†å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªéœ€è¦è¿™ç§çº§åˆ«æ§åˆ¶çš„åº”ç”¨ç¨‹åºï¼Œä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹ã€‚</p><p id="f979" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘åœ¨è¿™é‡Œçš„æ–¹æ³•æ˜¯è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå¯ä»¥å‘é€<code class="fe kz la lb lc b">messages</code>åˆ°æˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åºçš„<code class="fe kz la lb lc b">Web Socket Server</code>ï¼Œç„¶åå‰ç«¯åº”ç”¨ç¨‹åºå¯ä»¥å¤„ç†è¿™äº›æ¶ˆæ¯ã€‚åœ¨æˆ‘ä»¬è¿›å…¥ç»†èŠ‚ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æˆ‘çš„æ¼”ç¤ºåº”ç”¨ã€‚</p><h2 id="7a5d" class="ld le jd bd lf lg lh dn li lj lk dp ll kl lm ln lo kp lp lq lr kt ls lt lu lv bi translated"><strong class="ak">æ–°ç‰ˆæœ¬å¯ç”¨</strong></h2><p id="755b" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">ä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªè¶…çº§ç®€å•çš„Reactåº”ç”¨ç¨‹åº(å‡ ä¹æ˜¯ç©ºçš„)ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°éƒ¨ç½²çš„ç‰ˆæœ¬<a class="ae ja" href="http://websocket-app.s3-website-us-east-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"/>å¹¶æŸ¥çœ‹ä»£ç ï¼Œä½ å¯ä»¥æ£€æŸ¥è¿™ä¸ª<a class="ae ja" href="https://github.com/mostafa-drz/better-client-side-react" rel="noopener ugc nofollow" target="_blank">åº“</a>ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹éƒ¨ç½²è„šæœ¬:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="48fd" class="ld le jd lc b gy mj mk l ml mm">"prepush":"yarn build",<br/>"push": "aws s3 sync --delete build s3://websocket-app --profile websocket",<br/>"postpush": "node postPush.js"</span></pre><p id="55c1" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">éƒ¨ç½²è„šæœ¬åŒ…æ‹¬æ„å»ºèµ„äº§ï¼Œç„¶åå°†å…¶æ¨é€åˆ°S3ã€‚æˆ‘ä»¬ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è®¨è®ºReactçš„åº”ç”¨éƒ¨ç½²ï¼Œä½†å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡<a class="ae ja" href="https://www.newline.co/fullstack-react/articles/deploying-a-react-app-to-s3/" rel="noopener ugc nofollow" target="_blank">æ–‡ç« </a>ã€‚æˆ‘ä»¬çš„é‡ç‚¹æ˜¯<code class="fe kz la lb lc b">postpush</code>ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å‘æˆ‘ä»¬çš„å‰ç«¯åº”ç”¨ç¨‹åºå‘é€ä¸€æ¡<strong class="kc je">æ¶ˆæ¯</strong>ï¼Œè®©ç”¨æˆ·çŸ¥é“æœ‰ä¸€ä¸ªæ–°ç‰ˆæœ¬å¯ç”¨ï¼Œä»–ä»¬éœ€è¦åˆ·æ–°ä»–ä»¬çš„é¡µé¢æ‰èƒ½è·å¾—å®ƒã€‚</p><figure class="mb mc md me gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mn"><img src="../Images/e8eb67fc2b1b63f8145b36ffb63ef8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Zs-ac9FhpRXvFzETCMatrQ.gif"/></div></div></figure><h2 id="9069" class="ld le jd bd lf lg lh dn li lj lk dp ll kl lm ln lo kp lp lq lr kt ls lt lu lv bi translated"><strong class="ak">å¦‚ä½•ï¼Ÿ</strong></h2><p id="186a" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">åœ¨æˆ‘æµè§ˆä»£ç ä¹‹å‰ï¼Œæˆ‘åº”è¯¥æåˆ°ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸æƒ³æµè§ˆä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå› ä¸åŒçš„äº¤ä»˜è§£å†³æ–¹æ¡ˆå’Œç®¡é“è€Œæœ‰æ‰€ä¸åŒï¼Œæˆ‘åªæƒ³è®©æ‚¨å¯¹è¿™ç§æ–¹æ³•æœ‰ä¸€ä¸ªæ€»ä½“çš„äº†è§£ã€‚</p><p id="34fc" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä¸ºäº†å®ç°è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä½¿ç”¨äº†<code class="fe kz la lb lc b">Web Sockets</code>ã€‚å¦‚æœä½ ä»æœªä¸<code class="fe kz la lb lc b">Web Sockets</code>åˆä½œè¿‡ï¼Œä½ æ‰€éœ€è¦çŸ¥é“çš„å°±æ˜¯ä¸HTTPåè®®ç›¸æ¯”ï¼Œæ²¡æœ‰ä»»ä½•è¯·æ±‚ã€‚<code class="fe kz la lb lc b">Clients</code>æ‰“å¼€ä¸<code class="fe kz la lb lc b">server</code>çš„è¿æ¥ï¼Œç„¶åä»–ä»¬ç­‰å¾…æ¥è‡ªæœåŠ¡å™¨çš„æ¶ˆæ¯(è¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼)å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºweb socketsçš„çŸ¥è¯†ï¼Œä½ å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚</p><p id="b820" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¯¹äºå‰ç«¯ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª<code class="fe kz la lb lc b">Context</code>ï¼Œå®ƒåœ¨é¡¶å±‚åŒ…è£…äº†æ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå¹¶å°†è´Ÿè´£æ‰“å¼€ä¸æˆ‘ä»¬çš„<code class="fe kz la lb lc b">Web Socket Server</code>çš„è¿æ¥ï¼Œæ¯å½“å®ƒæ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå°±æ ¹æ®<code class="fe kz la lb lc b">messageId</code>å’Œæ¶ˆæ¯æä¾›çš„æ›´å¤šæ•°æ®é‡‡å–è¡ŒåŠ¨ã€‚å½“æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåŠ è½½æ—¶ï¼Œåœ¨<code class="fe kz la lb lc b">useEffect</code>ä¸­ï¼Œæˆ‘ä»¬è¿æ¥åˆ°æˆ‘ä»¬çš„Web SocketæœåŠ¡å™¨ï¼Œç„¶åæˆ‘ä»¬ç›‘å¬æ‰€æœ‰ä¼ å…¥çš„æ¶ˆæ¯:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="781d" class="ld le jd lc b gy mj mk l ml mm">useEffect(() =&gt; {<br/>    socket.current.onopen = function (e) {<br/>      console.info("[open] Connection established");<br/>    };<br/>    socket.current.onerror = function (error) {<br/>      console.error(`[error] ${error}`);<br/>    };</span><span id="6be3" class="ld le jd lc b gy mo mk l ml mm">socket.current.onmessage = function (event) {<br/>      const data = JSON.parse(event.data);<br/>      switch (data.messageId) {<br/>        case "new-version":<br/>          notify.show(<br/>            &lt;div&gt;<br/>              &lt;h2&gt;Sorry to intrupt you ğŸ™ˆ&lt;/h2&gt;<br/>              &lt;p&gt;<br/>                A new version of our App is available and to get the latest<br/>                features you should refresh your page<br/>              &lt;/p&gt;<br/>              &lt;button onClick={() =&gt; window.location.reload()}&gt;Reload&lt;/button&gt;<br/>            &lt;/div&gt;,<br/>            "warning",<br/>            -1<br/>          );</span><span id="c21c" class="ld le jd lc b gy mo mk l ml mm">break;<br/>        case "maintenance":<br/>          if (data.status === "on") {<br/>            notify.show(<br/>              &lt;div&gt;<br/>                &lt;h2&gt;Sorry to intrupt you ğŸ™ˆ&lt;/h2&gt;<br/>                &lt;p&gt;{data.message}&lt;/p&gt;<br/>                &lt;button onClick={() =&gt; notify.hide()}&gt;Ok&lt;/button&gt;<br/>              &lt;/div&gt;,<br/>              "warning",<br/>              -1<br/>            );<br/>            setMaintWindow(true); <br/>          } else {<br/>            setMaintWindow(false);<br/>          }<br/>          break;<br/>        default:<br/>          break;<br/>      }<br/>    };<br/>  }, []);</span></pre><p id="0875" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹åˆ°å‰ç«¯åº”ç”¨<a class="ae ja" href="https://github.com/mostafa-drz/better-client-side-react" rel="noopener ugc nofollow" target="_blank">çš„å®Œæ•´ä»£ç ã€‚</a></p><p id="0881" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ç°åœ¨åœ¨åç«¯ï¼Œä¸ºäº†æ¼”ç¤ºçš„ç›®çš„ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„HTTPå’ŒWeb SocketæœåŠ¡å™¨ã€‚HTTPæœåŠ¡å™¨æ˜¯ä¸ºäº†èƒ½å¤Ÿå‘æ§åˆ¶å®¤æœåŠ¡å‘é€ä¸€äº›äº‹ä»¶(æˆ‘å–œæ¬¢ï¼Œå¾ˆèŠ±å“¨çš„åå­—ï¼Œæ§åˆ¶å®¤ï¼ğŸ˜…)ç„¶åæ§åˆ¶å®¤å°†æ¶ˆæ¯æœåŠ¡<code class="fe kz la lb lc b"><strong class="kc je">Broadcasts</strong></code>ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹æœåŠ¡å™¨ä»£ç ï¼Œå®ƒéå¸¸ç®€å•:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="b01b" class="ld le jd lc b gy mj mk l ml mm">const WebSocket = require("ws");<br/>const express = require("express");<br/>const app = express();<br/>const http = require("http");<br/>const server = http.createServer(app);<br/>const PORT = process.env.PORT || 8080;<br/>const path = require("path");</span><span id="1df9" class="ld le jd lc b gy mo mk l ml mm">app.use(express.json());<br/>let wss;</span><span id="82fe" class="ld le jd lc b gy mo mk l ml mm">app.post("/api/message", function (req, res) {<br/>  const { messageId, messageBody } = req.body;<br/>  switch (messageId) {<br/>    case "new-version":<br/>      broadCastToAllClients(<br/>        wss,<br/>        JSON.stringify({<br/>          messageId,<br/>          newVersion: messageBody.version,<br/>        })<br/>      );<br/>      return res.send("ok");<br/>    case "maintenance":<br/>      broadCastToAllClients(<br/>        wss,<br/>        JSON.stringify({<br/>          messageId,<br/>          message: messageBody.message,<br/>          status: messageBody.status,<br/>        })<br/>      );<br/>      return res.send("ok");<br/>    default:<br/>      return res.status(400).send("what do you mean?");<br/>  }<br/>});</span><span id="8483" class="ld le jd lc b gy mo mk l ml mm">app.get("/", (req, res) =&gt; {<br/>  res.sendFile(path.resolve(__dirname, "index.html"));<br/>});</span><span id="ee0b" class="ld le jd lc b gy mo mk l ml mm">app.get("/api/ping", (req, res) =&gt; {<br/>  res.send("PONG");<br/>});</span><span id="0616" class="ld le jd lc b gy mo mk l ml mm">server.listen(PORT, (error) =&gt; {<br/>  if (error) {<br/>    console.error(`Something went wrong on Express Server ğŸ’”`);<br/>  } else {<br/>    console.log(`Express server is running on port ${PORT}`);<br/>    wss = new WebSocket.Server({ server });<br/>  }<br/>});</span><span id="9187" class="ld le jd lc b gy mo mk l ml mm">function broadCastToAllClients(wsServer, message) {<br/>  wsServer.clients.forEach(function each(client) {<br/>    if (client.readyState === WebSocket.OPEN) {<br/>      client.send(message);<br/>    }<br/>  });<br/>}</span></pre><p id="7659" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å¦‚æœä½ å–œæ¬¢å°è¯•ï¼Œä½ å¯ä»¥åœ¨ä¸¤ä¸ªä¸åŒçš„æ ‡ç­¾ä¸Šæ‰“å¼€å‰ç«¯åº”ç”¨ç¨‹åºå’ŒWeb SocketæœåŠ¡ï¼Œç„¶åå°è¯•ä¸€ä¸‹:</p><p id="c055" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">å‰ç«¯åº”ç”¨:<a class="ae ja" href="http://websocket-app.s3-website-us-east-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">http://websocket-app.s3-website-us-east-1.amazonaws.com/</a><br/>Web SocketæœåŠ¡:<a class="ae ja" href="https://thawing-depths-04303.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://thawing-depths-04303.herokuapp.com/</a><br/>ä½ å¯ä»¥åœ¨å‰ç«¯åº”ç”¨ä¸Šå°è¯•é‚£äº›ç®€å•çš„å‘½ä»¤ï¼Œçœ‹çœ‹ç»“æœã€‚<br/>æ—¢ç„¶æ‚¨å·²ç»å°è¯•äº†æ¼”ç¤ºåº”ç”¨ï¼Œè®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„<code class="fe kz la lb lc b">publish</code>è„šæœ¬ï¼Œçœ‹çœ‹<code class="fe kz la lb lc b">postpush</code>åšäº†ä»€ä¹ˆ:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="c494" class="ld le jd lc b gy mj mk l ml mm">"postpush": "node postPush.js"</span></pre><p id="120f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">è€Œ<code class="fe kz la lb lc b">postPush.js</code>:</p><pre class="mb mc md me gt mf lc mg mh aw mi bi"><span id="f55f" class="ld le jd lc b gy mj mk l ml mm">const fetch = require("node-fetch");</span><span id="cb9a" class="ld le jd lc b gy mo mk l ml mm">const body = {<br/>  messageId: "new-version",<br/>  messageBody: {<br/>    version: "1.1.1",<br/>  },<br/>};</span><span id="7b1f" class="ld le jd lc b gy mo mk l ml mm">fetch("<a class="ae ja" href="https://thawing-depths-04303.herokuapp.com/api/message" rel="noopener ugc nofollow" target="_blank">https://thawing-depths-04303.herokuapp.com/api/message</a>", {<br/>  method: "POST",<br/>  headers: { "Content-Type": "application/json" },<br/>  body: JSON.stringify(body),<br/>})<br/>  .then((resp) =&gt; resp.text())<br/>  .then((data) =&gt; console.log(data))<br/>  .catch((error) =&gt; console.log("Ooops", error));</span></pre><p id="0116" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ­£å¦‚æ‚¨åœ¨è¿™ä¸ªè„šæœ¬ä¸­çœ‹åˆ°çš„ï¼Œæˆ‘ä»¬æ‰€åšçš„å°±æ˜¯å‘æˆ‘ä»¬çš„<code class="fe kz la lb lc b">Control Room Service</code>å‘é€ä¸€ä¸ª<code class="fe kz la lb lc b">POST</code>è¯·æ±‚ï¼Œè®©å®ƒçŸ¥é“æœ‰ä¸€ä¸ªæ–°çš„å‰ç«¯ç‰ˆæœ¬ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å¹¿æ’­æ¶ˆæ¯ã€‚</p><h2 id="c96d" class="ld le jd bd lf lg lh dn li lj lk dp ll kl lm ln lo kp lp lq lr kt ls lt lu lv bi translated"><strong class="ak">ç»“è®º</strong></h2><p id="36a1" class="pw-post-body-paragraph ka kb jd kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">å®¢æˆ·ç«¯æ¸²æŸ“åº”ç”¨å¸¦æ¥äº†ä¸€äº›æŒ‘æˆ˜ï¼Œåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è¯•å›¾å‘ä½ å±•ç¤ºä¸€ç§æ–¹æ³•ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥æ›´å¥½åœ°æ§åˆ¶å®ƒä»¬ã€‚åŸºäºæ‚¨çš„ç®¡é“ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿä»¥ä¸åŒçš„æ–¹å¼å®ç°å®ƒã€‚</p><p id="a4c4" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æˆ‘å¸Œæœ›ä½ å–œæ¬¢æˆ‘çš„<em class="ky">æ§åˆ¶å®¤æœåŠ¡</em>ğŸ˜‰</p><p id="e01f" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">æ³¨æ„å®‰å…¨ï¼ŒğŸ¤¿</p><p id="6d49" class="pw-post-body-paragraph ka kb jd kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ja" href="https://www.linkedin.com/in/mostafa-darehzereshki/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc je"> <em class="ky">ç©†æ–¯å¡”æ³•</em> </strong> </a></p></div></div>    
</body>
</html>