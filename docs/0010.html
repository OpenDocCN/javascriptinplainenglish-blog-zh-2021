<html>
<head>
<title>Visualizing the Coronavirus Impact on the Stock Market Using D3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用D3可视化冠状病毒对股票市场的影响</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/visualizing-the-stock-market-using-d3-c99e349506e7?source=collection_archive---------8-----------------------#2021-01-01">https://javascript.plainenglish.io/visualizing-the-stock-market-using-d3-c99e349506e7?source=collection_archive---------8-----------------------#2021-01-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a0f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Zoom与波音公司交换位置。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/b3c380ed989152efd2850673805d5ea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UF-IHcEVXeAaRWlregdqkg.png"/></div></div></figure><p id="f0bf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这史无前例的一年里，我们从办公室工作转向远程工作，从旅行转向家庭娱乐，股票市场引起了注意。这个数据集为用D3构建可视化提供了一个很好的机会，所以我想分享我在这个过程中采取的步骤。</p><ol class=""><li id="3dac" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated"><strong class="kt ir">收集和格式化数据</strong></li></ol><p id="1a46" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建任何类型的可视化的第一步是找到它的数据源，以及构建它所必需的工具。在网上搜索了一番后，我在ycharts.com每个月的第一个交易日使用了市值，并把它保存到了我的Airtable数据库中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi lx"><img src="../Images/a0508db1e7f28723e65a0166d2ec0fea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-tzkdnpubMtfeUv2-YiAg.png"/></div></div></figure><p id="253b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> 2。创建标题</strong></p><p id="4bf2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我通过向h1元素添加初始文本来创建d3选择。</p><pre class="kg kh ki kj gt ly lz ma mb aw mc bi"><span id="5d82" class="md me iq lz b gy mf mg l mh mi">const title = d3.select("#data-viz").append("h1");</span><span id="5cf1" class="md me iq lz b gy mj mg l mh mi">title.text("Stock Market Cap 2020 - Jan")</span></pre><p id="f50a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这应该会使一个静态元素出现在DOM上，就像您要将它添加到html文件中一样。然而，有趣的部分是使用d3的<code class="fe mk ml mm lz b">textTween</code>函数使它随时间而变化。</p><pre class="kg kh ki kj gt ly lz ma mb aw mc bi"><span id="09c9" class="md me iq lz b gy mf mg l mh mi">const months = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];</span><span id="ccde" class="md me iq lz b gy mj mg l mh mi">function updateTitle(selection) {<br/>  selection<br/>    .transition()<br/>    .duration(5000)<br/>    .textTween(() =&gt; (t) =&gt; {<br/>        const index = d3.interpolateNumber(0, 11)(t).toFixed(0);           <br/>        return `Stock Market Cap 2020 - ${months[index]}`;<br/>    });<br/>}</span><span id="104b" class="md me iq lz b gy mj mg l mh mi">title.text("Stock Market Cap 2020 - Jan").call(updateTitle);</span></pre><p id="c13d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mk ml mm lz b">.transition()</code>链方法现在将创建一个持续时间为5秒的过渡。在随后的<code class="fe mk ml mm lz b">.textTween</code>函数中，回调现在将传递一个参数<em class="ln"> t </em>，其中开始时t = 0，结束时t = 1。D3还提供了漂亮的插值助手，这样我们可以用时间来索引月份。</p><p id="3163" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> 2。为每个公司追加SVG并绑定数据</strong></p><p id="2bff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在，对于可视化的实质，我做了一个新的选择，并使用步骤1中的数据通过<code class="fe mk ml mm lz b">.data()</code>方法将它们绑定到选择。</p><pre class="kg kh ki kj gt ly lz ma mb aw mc bi"><span id="1f82" class="md me iq lz b gy mf mg l mh mi">const data = [{name: 'Boeing', fill: 'crimson', ...}, ...];</span><span id="ce6c" class="md me iq lz b gy mj mg l mh mi">const selection = d3.select("#data-viz").selectAll("rect");</span><span id="0478" class="md me iq lz b gy mj mg l mh mi">selection<br/>  .data(data)<br/>  .enter()<br/>  .append("div") // label<br/>  .append("svg") <br/>  .append("rect") // bar<br/>  .attr("fill", (d) =&gt; d.fill)</span></pre><p id="670d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">代码片段应该生成与数据数组中提供的项目数量相等的<code class="fe mk ml mm lz b">div</code>和<code class="fe mk ml mm lz b">svg</code>元素。将为这些元素中的每一个调用<code class="fe mk ml mm lz b">.attr</code>方法，其中颜色将通过数据数组中提供的对象的<code class="fe mk ml mm lz b">fill</code>键的值来确定。这样就更容易区分在2020年获利的公司和亏损的公司。</p><p id="620a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> 3。最后一步！添加过渡以显示随时间的变化。</strong></p><p id="8548" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">类似于我在标题中使月份随时间变化的方式，我通过链接更多的转换函数使每个公司的宽度和标签的值动态变化。</p><pre class="kg kh ki kj gt ly lz ma mb aw mc bi"><span id="7fde" class="md me iq lz b gy mf mg l mh mi">const timing = 5000;</span><span id="2e0b" class="md me iq lz b gy mj mg l mh mi">function updateLabel(selection) {<br/>   selection<br/>     .append("text")<br/>     .attr("class", "label")<br/>     .transition()<br/>     .duration(timing)<br/><strong class="lz ir">     .textTween((d) =&gt; (t) =&gt; {<br/>         const index = d3.interpolateNumber(0, 11)(t).toFixed(0);<br/>         return `${d.name}\n\n${d[index]}B`;<br/>     });</strong></span><span id="b9dc" class="md me iq lz b gy mj mg l mh mi">function updateWidth(selection) {<br/>   selection<br/>     .transition()<br/>     .duration(timing)<br/><strong class="lz ir">     .attrTween((d) =&gt; (t) =&gt; {<br/>         const index = d3.interpolateNumber(0, 11)(t).toFixed(0);<br/>         return `${d[i] * 7}px`;<br/>     });</strong></span><span id="33d6" class="md me iq lz b gy mj mg l mh mi">selection<br/>  .data(data)<br/>  .enter()<br/>  .append("div") // label<br/><strong class="lz ir">  .call(updateText)<br/></strong>  .append("svg") <br/>  .append("rect") // bar<br/>  .attr("fill", (d) =&gt; d.fill)<br/><strong class="lz ir">  .call(updateWidth)</strong></span></pre><p id="f598" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">请注意，两个更新函数之间的唯一区别是，一个函数的目标是文本，另一个函数的目标是属性以及它们的调用顺序。否则，它们都依赖于绑定到元素的数据和插值时间。</p><p id="2b5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是最终产品，用<a class="ae mn" href="https://8k5rt.csb.app/" rel="noopener ugc nofollow" target="_blank">代码沙箱</a>制作而成。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/73078784c720895b21d47c5bb0940cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rlFoNHfTBCXPhJ2ohDX_2A.gif"/></div></div></figure></div></div>    
</body>
</html>