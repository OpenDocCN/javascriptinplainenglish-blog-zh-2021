<html>
<head>
<title>A TypeScript Runtime Data Validators Comparison</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TypeScript运行时数据验证器比较</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-c422e431926a?source=collection_archive---------9-----------------------#2021-03-15">https://javascript.plainenglish.io/a-typescript-runtime-data-validators-comparison-c422e431926a?source=collection_archive---------9-----------------------#2021-03-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c7c0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">第三部分:joi</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/0dd2eca95bfa3be86856b2ad3a5132ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQt7yrMH3Pushbiz6hZAtQ.png"/></div></div></figure><p id="9418" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是基于我的实践经验的运行时数据验证器比较系列报告的第3篇。在继续本系列的其余部分之前，您应该阅读第一篇文章中的介绍，以理解制作该报告所涉及的目标和测试方法。</p><ol class=""><li id="b685" class="lk ll in kq b kr ks ku kv kx lm lb ln lf lo lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-50a6abf3c559">简介</a></li><li id="effe" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-eeedc6b0583a"> io-ts </a></li><li id="c4bd" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated">约伊</li><li id="dda3" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-15f0ea2e3265">没错</a></li><li id="0f65" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-cdbb532f0b89"> ajv </a></li><li id="436f" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-92887e22ee65">佐德</a></li><li id="442e" class="lk ll in kq b kr lu ku lv kx lw lb lx lf ly lj lp lq lr ls bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/a-typescript-runtime-data-validators-comparison-67cb9abb599b">超级结构</a></li></ol><h1 id="9383" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">介绍</h1><p id="e831" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi是最早创建的(2012年9月),也是测试过的验证器中第二受欢迎的验证器(根据下载量)。它以定义数据的“简单、直观、可读的语言”而自豪，并在实现这一目标方面做得很好。</p><h1 id="0428" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">设计目标的实现</h1><h2 id="8d81" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">1.一个定义，多种用途—可实现</h2><p id="6554" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi不是用TypeScript编写的，但是它提供了自己的类型定义，并且可以很好地使用TypeScript代码。下面显示了“Person”模式是如何定义的。请注意流畅的API(方法链接)和现成的丰富特性，以及它如何使完成工作变得容易和愉快。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/67d73e0c40c3894195aaa3d8e9644753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Fpm8kbHbgFhwB7i2EslJw.png"/></div></div></figure><p id="6a62" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Joi不提供从其模式到现成的TypeScript类型的类型推断。但是，您可以使用第三方库<a class="ae lt" href="https://www.npmjs.com/package/joi-to-typescript" rel="noopener ugc nofollow" target="_blank"> joi-to-typescript </a>，将joi模式转换为typescript接口。下面是joi-to-typescript为Person模式生成的接口。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/7863360004eadb36c30a66f87018ef3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*dar1iva0n9Deoj4zvxJ1pw.png"/></div></figure><p id="8155" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">生成的接口与运行时模式非常匹配。“性别”属性被正确地类型化为文字类型的联合，并且是可选的。然而，代码生成方法意味着您确实需要在构建过程中添加一个步骤。</p><h2 id="e236" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">2.可组合和可扩展的模式—已实现</h2><p id="53be" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">“驱动程序”模式是通过扩展“人”模式来定义的，而无需重新定义“人”模式的属性。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/72ffcfe31f90b19a2fb95f5543326d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*AqWnUiBqWk79Y25qDe-QMw.png"/></div></figure><p id="3944" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">“车队”模式是通过组装“驾驶员”和“车辆”模式来定义的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/5d3369c879ce443e20fbba5478778a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*Asd5bYPGkjUy_hSQptd3fg.png"/></div></figure><p id="953d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">joi-to-typescript为“Driver”和“Fleet”模式生成的接口看起来也非常好。</p><h2 id="60fb" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">3.丰富的功能集—已实现</h2><p id="36cc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi提供了丰富的开箱即用的特性。</p><h2 id="42dd" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">4.完成和中止-早期验证-已实现</h2><p id="9cd7" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">通过提供一个<code class="fe nm nn no np b">abortEarly</code>选项，Joi可以被配置为执行完整的和提前中止的验证。完整验证的结果提供了数据中发现的所有故障的详细信息。下面是无效车队对象的验证结果的一部分。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/87534415925ead48ce6a87c808d89026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUX80TY0Lxy-xUFS-_HpBA.png"/></div></div></figure><h2 id="c0e7" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">5.可组合和可定制—存档</h2><p id="3836" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi的流畅API使得组合验证关键字变得非常容易。添加自定义验证函数也很容易。</p><p id="2548" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是PersonForm模式定义，带有一个自定义函数来验证重复密码是否与密码相同。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/a9f2312d538f53693c18733e426b79b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Yw5V8gmilDfqEN70SibOg.png"/></div></div></figure><h2 id="19bc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">6.类型强制和默认—已实现</h2><p id="a403" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi默认提供类型强制。如果不需要，可以通过在模式中链接一个选项<code class="fe nm nn no np b">.options({convert: false})</code>或链接一个<code class="fe nm nn no np b">.raw()</code>来关闭它。有关示例，请参见上面的Person模式中定义的“dob”属性。</p><p id="7e2d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了提供默认值，在模式中链接一个<code class="fe nm nn no np b">default()</code>调用。请参见上面Person模式中定义的“性别”属性作为示例。</p><h2 id="09cc" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">7.可遍历模式—已实现</h2><p id="4ecc" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">模式的内部配置可以通过调用它的<code class="fe nm nn no np b">describe()</code>方法来公开。joi模式的探索演示可以在项目的<code class="fe nm nn no np b">/solutions/joi</code>目录下的<code class="fe nm nn no np b">traversable.test.ts</code>测试用例中找到。</p><h2 id="419a" class="mw ma in bd mb mx my dn mf mz na dp mj kx nb nc ml lb nd ne mn lf nf ng mp nh bi translated">8.标准—否</h2><h1 id="71c4" class="lz ma in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">摘要</h1><p id="761c" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">Joi成熟、受欢迎，在提供流畅的开发人员体验方面做得很好。</p><p id="b232" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然而，joi包是测试过的验证器中最大的。并且它不为TypeScript提供现成的类型推断。此外，还有一个<a class="ae lt" href="https://www.npmjs.com/package/joi-browser" rel="noopener ugc nofollow" target="_blank">声明</a>称“为浏览器打包一个合理版本的joi有些困难”，这导致了“joi-browser”包的出现。</p><p id="063c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">joi的成功启发了其他一些验证器，包括yup，这将在本系列的下一篇文章中讨论。</p></div></div>    
</body>
</html>