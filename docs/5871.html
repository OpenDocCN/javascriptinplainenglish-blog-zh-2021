<html>
<head>
<title>How do you clean RxJS Subjects?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你是怎么清理RxJS科目的？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-do-you-clean-the-subjects-in-rxjs-298bf129d3bb?source=collection_archive---------1-----------------------#2021-12-16">https://javascript.plainenglish.io/how-do-you-clean-the-subjects-in-rxjs-298bf129d3bb?source=collection_archive---------1-----------------------#2021-12-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/c30e7dc3e16572d6835f5c1513abcea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bn-B0yXC9QMavyr8N7sVvA.png"/></div></div></figure><h2 id="f5b4" class="iw ix iy bd b dl iz ja jb jc jd je dk jf translated" aria-label="kicker paragraph">使用RxJS发现更好的代码模式</h2><div class=""/><div class=""><h2 id="ef22" class="pw-subtitle-paragraph ke jh iy bd b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dk translated">使用可重置主题重置缓存</h2></div><p id="53bd" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">在所有的bug中，缓存问题占据首位。如果出于某种原因，你没有修复与缓存相关的错误，那么你是幸运的。这经常发生在你使用RxJS主语的时候，尤其是<code class="fe ls lt lu lv b">BehaviorSubject</code>或者<code class="fe ls lt lu lv b">ReplaySubject</code>。</p><p id="c2b6" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">在本文中，我们将尝试解决这类问题。此外，我们将为这样的需求开发一个新的主题。所以如果你感兴趣，请继续关注！</p><h1 id="a024" class="lw lx iy bd ly lz ma mb mc md me mf mg kn mh ko mi kq mj kr mk kt ml ku mm mn bi translated">#我们要解决什么问题？</h1><p id="d37d" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">假设我们将RxJS与Angular一起使用。首先，从路由中读取参数，并将它们存储在主题中。其次，用户离开了URL，Angular破坏了组件。不考虑组件的析构，服务还没有像父组件中提供的那样被析构。因此，先前存储的值保留在其中。除非你用最初的那个清理过。最后，一旦用户用不同的路由参数打开同一个组件，从主题发出的第一个值将是一个缓存值。此外，如果没有<code class="fe ls lt lu lv b">switchMap</code>操作符，您可能会因为竞争条件而得到错误的数据。</p><p id="c4d1" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">这个问题在现实世界中是这样的:</p><figure class="mu mv mw mx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mt"><img src="../Images/60d108c8e490af0dbff39c1e2b2fa850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*srjYUfRf-i1BstqD-fGtZw.gif"/></div></div></figure><p id="6663" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">您可能会注意到，从第二个请求开始，有两个请求。两个请求中的第一个请求中的用户id来自缓存。</p><h2 id="17c3" class="my lx iy bd ly mz na dn mc nb nc dp mg lf nd ne mi lj nf ng mk ln nh ni mm je bi translated">我们从这段代码开始</h2><p id="2c7c" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">在组件中，我们从<code class="fe ls lt lu lv b">paramsMap</code>中读取<code class="fe ls lt lu lv b">userId</code>，并将其存储在服务中。就在我们用它加载用户信息之后。</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a1d4" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">服务负责存储<code class="fe ls lt lu lv b">userId</code>并提供可观察值，职责是加载用户详细信息。</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="354b" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated"><code class="fe ls lt lu lv b">UserModel</code>简单表示用户详细信息。</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="5a2f" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">现在，让我们试着解决这个问题。</p><h1 id="fde9" class="lw lx iy bd ly lz ma mb mc md me mf mg kn mh ko mi kq mj kr mk kt ml ku mm mn bi translated">#解决方案是什么:</h1><p id="de1c" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">首先，让我们用一个<code class="fe ls lt lu lv b">ResettableSubject</code>来看看它的运行情况:</p><figure class="mu mv mw mx gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mt"><img src="../Images/ab7abfeee4c12eadeab2e1de7cde6b94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Za1khgC2UwYAIrFJGi5zJg.gif"/></div></div></figure><p id="3121" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">按预期工作。</p><p id="8c6e" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">在服务中，我们进行了以下更新:</p><ul class=""><li id="573d" class="nl nm iy ky b kz la lc ld lf nn lj no ln np lr nq nr ns nt bi translated">我们把<code class="fe ls lt lu lv b">mergeMap</code>改成了<code class="fe ls lt lu lv b">switchMap</code></li><li id="4340" class="nl nm iy ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">我们使用自定义主题— <code class="fe ls lt lu lv b">ResettableSubject</code>而不是<code class="fe ls lt lu lv b">ReplaySubject</code></li><li id="394b" class="nl nm iy ky b kz nu lc nv lf nw lj nx ln ny lr nq nr ns nt bi translated">我们添加了一个<code class="fe ls lt lu lv b">resetUserId</code>方法来清理服务中的<code class="fe ls lt lu lv b">userId</code></li></ul><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="84b1" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">在组件中，我们只添加了一行来重置<code class="fe ls lt lu lv b">userId</code>:</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="4c0f" class="lw lx iy bd ly lz ma mb mc md me mf mg kn mh ko mi kq mj kr mk kt ml ku mm mn bi translated">#可重置主题</h1><p id="ae97" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">最后一段代码是我们的<code class="fe ls lt lu lv b">ResettableSubject</code>:</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="476f" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">它增加了将主题值回滚到初始状态的能力。因此，我们不再需要跟踪缓存的值。</p><h1 id="e885" class="lw lx iy bd ly lz ma mb mc md me mf mg kn mh ko mi kq mj kr mk kt ml ku mm mn bi translated">#其他可能性</h1><p id="6aa9" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">还有其他选项来实现缓存清理模式。例如，我们可以使用工厂函数来代替使用<code class="fe ls lt lu lv b">ResettableSubject</code>。</p><p id="7d3e" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated">这里有一个简单的概述:</p><figure class="mu mv mw mx gt ip"><div class="bz fp l di"><div class="nj nk l"/></div></figure><h1 id="bfd2" class="lw lx iy bd ly lz ma mb mc md me mf mg kn mh ko mi kq mj kr mk kt ml ku mm mn bi translated">进一步阅读</h1><p id="8b0f" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">如果你对RxJS感兴趣，这里还有几篇文章，你可以从中找到自己感兴趣的东西:</p><div class="im in gp gr io nz"><a href="https://obaranovskyi.medium.com/the-ultimate-guide-to-observables-and-vs-promises-rxjs7-296877376668" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ji gy z fp oe fr fs of fu fw jh bi translated">可观察和/或相对承诺的最终指南(+RxJS7)</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">在这篇文章中，你将全面了解承诺与可观察到的东西有什么不同。我们将尝试覆盖…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">obaranovskyi.medium.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on iu nz"/></div></div></a></div><div class="im in gp gr io nz"><a href="https://obaranovskyi.medium.com/rxjs-data-reload-pattern-with-custom-operators-factory-functions-b929a2103dd8" rel="noopener follow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd ji gy z fp oe fr fs of fu fw jh bi translated">这是使用RxJS重新加载数据的最简单的方法</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">大多数时候，我们必须从服务器加载数据。为了执行操作，客户端通常会发送请求以及…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">obaranovskyi.medium.com</p></div></div><div class="oi l"><div class="oo l ok ol om oi on iu nz"/></div></div></a></div></div><div class="ab cl op oq hr or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ig ih ii ij ik"><h1 id="596c" class="lw lx iy bd ly lz ow mb mc md ox mf mg kn oy ko mi kq oz kr mk kt pa ku mm mn bi translated">结论</h1><p id="a223" class="pw-post-body-paragraph kw kx iy ky b kz mo ki lb lc mp kl le lf mq lh li lj mr ll lm ln ms lp lq lr ig bi translated">我希望你和我一样喜欢它。如果你喜欢这篇文章，或者你学到了新的东西，请点赞并订阅。</p><figure class="mu mv mw mx gt ip gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/00d3697c12da647bd81bd38eb48f82fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*FQNTEeOTUcjTaiZa2aclAA.gif"/></div></figure><p id="cf06" class="pw-post-body-paragraph kw kx iy ky b kz la ki lb lc ld kl le lf lg lh li lj lk ll lm ln lo lp lq lr ig bi translated"><em class="pc">更多内容看</em> <a class="ae pd" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ji"> <em class="pc">说白了. io </em> </strong> </a> <strong class="ky ji"> <em class="pc">。</em> </strong> <em class="pc">报名参加我们的</em> <a class="ae pd" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ji"> <em class="pc">免费每周简讯这里</em> </strong> </a> <strong class="ky ji"> <em class="pc">。</em>T24】</strong></p></div></div>    
</body>
</html>