<html>
<head>
<title>Angular Reactive Form Manager — Easy Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度反应式表单管理器—简易指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/angular-reactive-form-manager-easy-guide-6b6f8ddf8201?source=collection_archive---------8-----------------------#2021-02-24">https://javascript.plainenglish.io/angular-reactive-form-manager-easy-guide-6b6f8ddf8201?source=collection_archive---------8-----------------------#2021-02-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c0ca" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用表单管理器服务将大表单拆分成小的可重用表单组组件的简单解决方案。</h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/c83609460a229fdfb52bc45138066fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pZ2TeTFNsv4WkIiZ"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk">Photo by <a class="ae kt" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luca Bravo</a> on <a class="ae kt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4dfd" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">最近我在做一个大的Angular项目，它需要实现两个反应式表单，其中一个需要被分成单独的选项卡组件。所以我寻找一种解决方案，将表单分成更小的表单组，并在所有表单中重用它们。此外，我需要找到一种方法从不同的选项卡组件收集表单组值，并将它们合并成一个值。</p><p id="dd22" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">所以，我想到了一个主意！我们需要实现一个表单管理器服务，来处理不同的表单组，并在一个大表单中管理它们的验证和值。这个想法很简单，创建带有表单组的组件(可以在表单之间重用)，并在表单管理器中注册每个表单组(每个表单有一个唯一的名称)。这样，您可以从应用程序中的任何地方访问这些表单组，并将多个表单组视为一个大表单。</p><p id="4504" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">一开始听起来可能很难，但实际上，这很容易实现。让我们看看我们是怎么做的。</p><p id="131e" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">首先，我们来做两个更小的表单组。为了简单起见，我不会展示模板代码。</p><p id="a697" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">因此，第一个表单组将包含客户姓名、姓氏和电话号码字段。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="9a3c" class="lv lw in lr b gy lx ly l lz ma">@Component({<br/>  selector: 'app-client-form-group',<br/>  templateUrl: './client-form-group.component.html',<br/>  styleUrls: ['./client-form-group.component.less'],<br/>})<br/>export class ClientFormGroupComponent implements OnInit, OnDestroy {<br/>  @Input() formName: string;</span><span id="63a7" class="lv lw in lr b gy mb ly l lz ma">  formGroup: ForumGroup;</span><span id="96b0" class="lv lw in lr b gy mb ly l lz ma">constructor(formManager: FormManagerService, formBuilder: FormBuilder) {<br/>    this.formGroup = this.buildForm(formBuilder );<br/>  }</span><span id="3774" class="lv lw in lr b gy mb ly l lz ma">  ngOnInit(): void {<br/>    this.formManager.register(this.formName, this.formGroup);<br/>  }<br/><br/>  ngOnDestroy(): void {<br/>    this.formManager.unregister(this.formName);<br/>  }</span><span id="00e2" class="lv lw in lr b gy mb ly l lz ma">  buildFormGroup(formBuilder: FormBuilder): FormGroup {<br/>    return formBuilder.group({<br/>      name: [],<br/>      surname: [],<br/>      phone: [],<br/>    });<br/>  }<br/>}</span></pre><p id="37f6" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">第二个表单组将有两个字段:地址和邮政编码。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="3654" class="lv lw in lr b gy lx ly l lz ma">@Component({<br/>  selector: 'app-address-form-group',<br/>  templateUrl: './address-form-group.component.html',<br/>  styleUrls: ['./address-form-group.component.less'],<br/>})<br/>export class AddressFormGroupComponent implements OnInit, OnDestroy {<br/>  @Input() formName: string;</span><span id="fbef" class="lv lw in lr b gy mb ly l lz ma">  formGroup: ForumGroup;</span><span id="36dc" class="lv lw in lr b gy mb ly l lz ma">constructor(formManager: FormManagerService, formBuilder:  FormBuilder) {<br/>    this.formGroup = this.buildFormGroup(formBuilder);<br/>  }</span><span id="c8e4" class="lv lw in lr b gy mb ly l lz ma">  ngOnInit(): void {<br/>    this.formManager.register(this.formName, this.formGroup);<br/>  }<br/><br/>  ngOnDestroy(): void {<br/>    this.formManager.unregister(this.formName);<br/>  }</span><span id="79b2" class="lv lw in lr b gy mb ly l lz ma">  buildFormGroup(formBuilder: FormBuilder): FormGroup {<br/>    return formBuilder.group({<br/>      address: [],<br/>      postCode: [],<br/>    });<br/>  }<br/>}</span></pre><p id="2e14" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">让我们更深入地研究一下这段代码将会做什么。所以首先我们需要输入表单组名。表单组将在我们的表单管理器服务中以该名称注册。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="aac1" class="lv lw in lr b gy lx ly l lz ma">@Input() name: string;</span></pre><p id="0e8d" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">接下来，我们注入表单管理器(稍后解释)和Angular表单生成器。我们调用buildFormGroup方法来构建表单，并将结果保存为FormGroup类属性。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="85db" class="lv lw in lr b gy lx ly l lz ma">constructor(formManager: FormManagerService, formBuilder:  FormBuilder) {<br/>  this.formGroup = this.buildFormGroup(formBuilder);<br/>}</span></pre><p id="7e1f" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们的方法buildFormGroup只是简单地使用Angular form builder构建反应式表单。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="1d96" class="lv lw in lr b gy lx ly l lz ma">buildFormGroup(formBuilder: FormBuilder): FormGroup {<br/>  return formBuilder.group({<br/>    address: [],<br/>    postCode: [],<br/>  });<br/>}</span></pre><p id="daa2" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">我们使用角度生命周期方法在初始化时将表单组注册到某个表单下的表单管理器服务，并在组件销毁时取消注册。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="2e0f" class="lv lw in lr b gy lx ly l lz ma">ngOnInit(): void {<br/>  this.formManager.register(this.name, this.formGroup);<br/>}<br/><br/>ngOnDestroy(): void {<br/>  this.formManager.unregister(this.name);<br/>}</span></pre><p id="a401" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">好了，现在我们有了两个独立的表单组组件，可以很容易地在任何更大的表单中重用。让我们看看我们如何能做到这一点。为此，我们需要实现一个简单的表单管理器服务，将所有独立的组保存为一个表单。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="f316" class="lv lw in lr b gy lx ly l lz ma">@Injectable()<br/>export class FormManagerService {<br/>  private formGroup = new FormGroup({});</span><span id="4d03" class="lv lw in lr b gy mb ly l lz ma">  get(): FormGroup {<br/>    return this.formGroup;<br/>  }  </span><span id="6740" class="lv lw in lr b gy mb ly l lz ma">  register(name: string, formGroup: FormGroup): void {<br/>    this.formGroup.addControl(name, formGroup);<br/>  }</span><span id="4514" class="lv lw in lr b gy mb ly l lz ma">  unregister(name: string): void {<br/>    this.formGroup.removeControl(name);<br/>  }<br/>}</span></pre><p id="2db9" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">现在，我们可以简单地将客户端和地址表单组组件插入到应用程序的不同位置，并提供唯一的名称，这样它们就可以在表单管理器服务中注册。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="1896" class="lv lw in lr b gy lx ly l lz ma">...</span><span id="3670" class="lv lw in lr b gy mb ly l lz ma">&lt;app-client-form-group name="clientFormGroup"&gt;&lt;app-client-form-group/&gt;</span><span id="33cf" class="lv lw in lr b gy mb ly l lz ma">...</span><span id="c458" class="lv lw in lr b gy mb ly l lz ma">&lt;app-address-form-group name="addressFormGroup"&gt;&lt;app-address-form-group/&gt;</span><span id="219c" class="lv lw in lr b gy mb ly l lz ma">...</span></pre><p id="dd81" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">在需要访问完整表单数据或其控件的地方，我们可以从表单管理器中获取表单。</p><pre class="ke kf kg kh gt lq lr ls lt aw lu bi"><span id="25a0" class="lv lw in lr b gy lx ly l lz ma">...</span><span id="67ed" class="lv lw in lr b gy mb ly l lz ma">constructor(private formManager: FormManagerService) {}</span><span id="e8da" class="lv lw in lr b gy mb ly l lz ma">...</span><span id="cec3" class="lv lw in lr b gy mb ly l lz ma">submit(): void {<br/>  const form = this.formManager.get();<br/>  <br/>  if(form.valid) {<br/>    form.value; // Get value and do something with it<br/>  }<br/>}</span><span id="da6a" class="lv lw in lr b gy mb ly l lz ma">...</span></pre></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h2 id="b0e5" class="lv lw in bd mj mk ml dn mm mn mo dp mp ld mq mr ms lh mt mu mv ll mw mx my mz bi translated">结论</h2><p id="8fcb" class="pw-post-body-paragraph ku kv in kw b kx na jo kz la nb jr lc ld nc lf lg lh nd lj lk ll ne ln lo lp ig bi translated">这是一个非常简单的例子，只是为了展示表单管理器的概念，您还可以为存储在表单管理器中的表单结构添加类型，为表单组组件添加额外的逻辑和验证器，使用异步方法来跟踪表单管理器中的表单更改，等等。</p><p id="3cd3" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">但是，通过这种简单而优雅的方式，您可以轻松地将大表单分成更小的可重用组件，并使用表单管理器服务将这些小组件组合成一个大表单。</p><p id="c845" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">这使您可以轻松地管理组件、统一的表单验证、统一的表单值，并且可以在应用程序的任何地方轻松访问表单。</p></div></div>    
</body>
</html>