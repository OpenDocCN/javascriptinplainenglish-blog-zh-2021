<html>
<head>
<title>Build a MySQL Node.js CRUD App #2: MySQL Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建MySQL Node.js CRUD应用#2: MySQL集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-mysql-node-js-crud-app-2-mysql-integration-7f3c337a21d1?source=collection_archive---------13-----------------------#2021-01-17">https://javascript.plainenglish.io/build-a-mysql-node-js-crud-app-2-mysql-integration-7f3c337a21d1?source=collection_archive---------13-----------------------#2021-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f2f666786248fc0b505698f9bd65668c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WTgFmcChnTaH86L9cxaHtA.png"/></div></div></figure><p id="9797" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，欢迎来到<a class="ae kw" href="https://hashnode.com/series/lets-build-a-mysql-nodejs-crud-app-ckhzrl98g022j99s11xymfqkn" rel="noopener ugc nofollow" target="_blank">让我们构建一个MySQL Node.js CRUD应用系列</a>的第二篇文章！在上一篇文章中，我们已经将书评应用程序初始化为一个React项目，并在MySQL上设置了一个简单的数据库。</p><blockquote class="kx ky kz"><p id="f62d" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">如果你没看过上一篇文章，请在这里找到<a class="ae kw" href="https://lo-victoria.com/build-mysql-nodejs-crud-app-1-setting-up" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="23ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这一部分，我们将把我们的数据库和路线整合到我们的应用程序中。</p><h1 id="863b" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤1:创建Express服务器</h1><p id="e0a6" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在我们项目的根目录下为后端创建一个<code class="fe mh mi mj mk b">server.js</code>文件。我们可以创建一个包含以下内容的快速应用程序:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="71a5" class="mt lf iq mk b gy mu mv l mw mx">const express = require("express");<br/>const mysql = require("mysql");<br/>require("dotenv").config();</span><span id="293f" class="mt lf iq mk b gy my mv l mw mx">const app = express();<br/>app.use(express.json()); <br/>// parses incoming requests with JSON payloads</span></pre><h1 id="fc48" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤2:创建到数据库的连接</h1><p id="7aef" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">用形式为<code class="fe mh mi mj mk b">NAME=VALUE</code>的变量创建一个<code class="fe mh mi mj mk b">.env</code>文件，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3dd3" class="mt lf iq mk b gy mu mv l mw mx">DB_HOST=localhost<br/>DB_USER=root<br/>DB_PASSWORD=password<br/>DB=ravenbooks</span></pre><p id="777f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，我们创建一个到数据库的池连接。我们可以使用环境变量来保护我们的配置不被看到。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c28c" class="mt lf iq mk b gy mu mv l mw mx">//create connection to database<br/>const db = mysql.createPool({<br/>  host: process.env.DB_HOST, //localhost<br/>  user: process.env.DB_USER, //root<br/>  password: process.env.DB_PASSWORD, //password<br/>  database: process.env.DB, //ravenbooks<br/>});</span></pre><h1 id="be81" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤3:创建监听器</h1><p id="b393" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">然后，在它下面，我们请求我们的服务器监听一个请求。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="7b0b" class="mt lf iq mk b gy mu mv l mw mx">const listener = app.listen(process.env.PORT || 3000, () =&gt; {<br/>    console.log('App is listening on port ' + listener.address().port)<br/>})</span></pre><p id="9283" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">默认情况下，我们将应用程序设置为监听端口3000。然而，在端口号由环境变量指定的情况下，应用程序将监听<code class="fe mh mi mj mk b">process.env.PORT</code>。</p><p id="42ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在运行命令<code class="fe mh mi mj mk b">nodemon server.js</code>，控制台应该打印出应用程序正在监听端口3000。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d0c62787a8a8ff01db95f189afa8b949.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/0*tB8d0dCH1U85PNF3"/></div></figure><h1 id="4e74" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建路线</h1><p id="eb2a" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在我们已经设置好了一切，我们需要做的就是创建GET、POST、PUT和DELETE路径，以允许我们的应用程序在我们的数据库上创建CRUD函数。</p><p id="aa05" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们将使用<a class="ae kw" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank"> POSTman </a>，一个超级方便的工具来测试我们的后端路由，而不必构建前端。</p><p id="091f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本系列的后面部分，我将为这个应用程序实现React前端。</p><h1 id="bbcc" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">1.得到</h1><p id="de92" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们的应用程序应该能够获得并返回MySQL数据库中的所有书评。让我们创建一条GET路线<code class="fe mh mi mj mk b">/reviews</code>来实现这一点。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="d96e" class="mt lf iq mk b gy mu mv l mw mx">app.get("/reviews", (req, res) =&gt; {<br/>  db.query("SELECT * FROM book_reviews", (err, result) =&gt; {<br/>    if (err) {<br/>      console.log(err);<br/>    } else {<br/>      res.send(result);<br/>    }<br/>  });<br/>});</span></pre><h1 id="f005" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">测试路线</h1><p id="90e6" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们可以使用MySQL工作台直接插入一些虚拟数据，如下所示:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/57aa9ba592ace41fe4e0ce761456af81.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/0*YK4CioCbjGDi50H-"/></div></figure><p id="ef40" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，在服务器还在运行并监听3000端口的同时，打开POSTman并键入:<code class="fe mh mi mj mk b">http://localhost:3000/reviews</code>。确保HTTP方法设置为GET，如下图所示。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/141622088ef94f9200499aa6da95526a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dZfcrIv96uLDRB3C"/></div></div></figure><h1 id="bc49" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">2.邮政</h1><p id="101e" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">接下来，让我们创建我们的POST route，这将允许应用程序向我们的数据库添加新数据。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="da23" class="mt lf iq mk b gy mu mv l mw mx">app.post("/reviews", (req, res) =&gt; {<br/>  const insertQuery = "INSERT INTO book_reviews SET ?";<br/>  db.query(insertQuery, req.body, (err, result) =&gt; {<br/>    if (err) {<br/>      console.log(err);<br/>    } else {<br/>      res.send("Review Added to Database");<br/>    }<br/>  });<br/>});</span></pre><h1 id="e163" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">测试路线</h1><p id="676f" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在POSTman上，配置如下图所示的设置，将一个样本数据发布到我们的数据库。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/5b8e9e9404a801a2eace1975cacd4565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rz-W6TeXKlW313GX"/></div></div></figure><p id="feff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们的请求成功，我们的样本数据将添加到我们的数据库中，如下所示:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7bce755d873e58a7ea1af3761c66337d.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/0*Q_ZsY6adv3HeMYtc"/></div></figure><h1 id="7b32" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">3.放</h1><p id="19d1" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">PUT route将负责向我们的数据库更新任何数据。允许用户更新<code class="fe mh mi mj mk b">book_rating</code>和<code class="fe mh mi mj mk b">book_review</code>列。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="267d" class="mt lf iq mk b gy mu mv l mw mx">app.put("/reviews", (req, res) =&gt; {<br/>  const updateQuery =<br/>    "UPDATE book_reviews SET book_review = ?, book_rating = ? WHERE id = ?";<br/>  db.query(<br/>    updateQuery,<br/>    [req.body.book_review, req.body.book_rating, req.body.id],<br/>    (err, result) =&gt; {<br/>      if (err) {<br/>        console.log(err);<br/>      } else {<br/>        res.send(result);<br/>      }<br/>    }<br/>  );<br/>});</span></pre><h1 id="9023" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">测试路线</h1><p id="6d1b" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在POSTman上配置以下设置。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/fbda07642c653648c924b9a25ea2f016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*828eH3tAtb1kDWcV"/></div></div></figure><p id="14ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果请求成功，我们的数据库应该显示新更新的数据，如下所示:</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/43b17b9d073531d23391964f90b4049f.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/0*lmAQXN42sSIg29ch"/></div></figure><h1 id="e2dd" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">4.删除</h1><p id="2e93" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">最后但同样重要的是，我们有删除路径，它将根据参数中提供的<code class="fe mh mi mj mk b">id</code>值从表中删除特定的行。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="4489" class="mt lf iq mk b gy mu mv l mw mx">app.delete("/reviews/:id", (req, res) =&gt; {<br/>  db.query(<br/>    "DELETE FROM book_reviews WHERE id = ?",<br/>    req.params.id,<br/>    (err, result) =&gt; {<br/>      if (err) {<br/>        console.log(err);<br/>      } else {<br/>        res.send(result);<br/>      }<br/>    }<br/>  );<br/>});</span></pre><h1 id="b7ba" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">测试路线</h1><p id="85af" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">要在POSTman上测试我们的路线，请确保在URL中添加id参数。对于这个例子，我们想要删除我们之前使用POST路由添加的样本数据。</p><p id="b576" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因此，让我们将想要删除的行的id设置为4。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/352b9bebdfb7ccdb52693216aa574aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2x81oNiVMu6d52pR"/></div></div></figure><p id="a1d2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果成功，我们将看到我们的样本数据已经从我们的数据库中删除。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/bf068d97bd3a8c03a8a8759ebabd756b.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/0*VKrd2Ie86pJwvx-i"/></div></figure><h1 id="87c9" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">敬请期待</h1><p id="6ac1" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">暂时就这些了！在这一部分，我们已经成功地创建了我们的Express服务器，我们需要的GET POST PUT DELETE routes，甚至用POSTman测试了它们。</p><p id="2daf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的后端已经完成，请继续关注<a class="ae kw" rel="noopener ugc nofollow" target="_blank" href="/build-a-mysql-node-js-crud-app-3-the-client-side-with-react-ff6a7e0c2431">下一部分</a>，我们将转移重点，用React实现前端。感谢阅读这篇文章。如果有帮助，一定要给个赞，分享一下。也可以在下面的评论中随意提问。干杯！</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/20df82efd0eac5e00a07129fce1a945a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgxA8M8dbS01y3RRby-jBQ.png"/></div></div></figure><ul class=""><li id="46e0" class="nj nk iq ka b kb kc kf kg kj nl kn nm kr nn kv no np nq nr bi translated"><a class="ae kw" href="https://bit.ly/3Tw34nC" rel="noopener ugc nofollow" target="_blank">高级JavaScript </a>课程</li><li id="4957" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv no np nq nr bi translated"><a class="ae kw" href="https://bit.ly/3AZ6NCM" rel="noopener ugc nofollow" target="_blank">通用编程</a>课程</li><li id="00c1" class="nj nk iq ka b kb ns kf nt kj nu kn nv kr nw kv no np nq nr bi translated"><a class="ae kw" href="https://bit.ly/3KziWkX" rel="noopener ugc nofollow" target="_blank">数据结构&amp;算法</a>课程</li></ul></div><div class="ab cl nx ny hu nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="ij ik il im in"><p id="f5a6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">原载于</em><a class="ae kw" href="https://lo-victoria.com/build-a-mysql-nodejs-crud-app-2-mysql-integration" rel="noopener ugc nofollow" target="_blank"><em class="la">https://lo-victoria.com</em></a><em class="la">。</em></p></div></div>    
</body>
</html>