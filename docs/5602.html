<html>
<head>
<title>Create a WhatsApp Clone with Next.js: Render Messages at Chat Box</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Next.js创建一个WhatsApp克隆:在聊天框中呈现消息</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-whatsapp-clone-with-next-js-part-29-render-messages-at-chat-box-e5e94ad1ccf7?source=collection_archive---------14-----------------------#2021-11-22">https://javascript.plainenglish.io/create-whatsapp-clone-with-next-js-part-29-render-messages-at-chat-box-e5e94ad1ccf7?source=collection_archive---------14-----------------------#2021-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4595" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第29部分:以不同的气泡样式呈现消息。</h2></div><p id="5325" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要呈现消息，请访问ChatContent.js。在useEffect中，使用<code class="fe lb lc ld le b">chat_id</code>选择chats集合，然后选择messages集合。</p><p id="a9e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加状态“消息”。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="1351" class="ln lo iq le b gy lp lq l lr ls">const [messages,setMessages] = useState([])</span></pre><p id="cf1c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">按时间戳以升序对消息进行排序。用id和时间戳设置消息。时间戳需要转换成可读的JavaScript。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="9c0d" class="ln lo iq le b gy lp lq l lr ls">useEffect(() =&gt; {</span><span id="4086" class="ln lo iq le b gy lt lq l lr ls">const messagesRef = collection(db, "chats",chat_id,"messages");</span><span id="a9c7" class="ln lo iq le b gy lt lq l lr ls">const q = query(messagesRef,orderBy("timestamp","asc"))</span><span id="a17d" class="ln lo iq le b gy lt lq l lr ls">const unsubscribe = onSnapshot(q,(querySnapshot) =&gt;{</span><span id="8c1f" class="ln lo iq le b gy lt lq l lr ls">setMessages(querySnapshot.docs.map(doc=&gt;({...doc.data(),id:doc.id,timestamp:doc.data().timestamp?.toDate().getTime()})))</span><span id="0e0f" class="ln lo iq le b gy lt lq l lr ls">})</span><span id="4681" class="ln lo iq le b gy lt lq l lr ls">return unsubscribe;</span><span id="4c96" class="ln lo iq le b gy lt lq l lr ls">}, [chat_id])</span></pre><h2 id="c11a" class="ln lo iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">呈现消息</h2><p id="9636" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">然后使用map函数呈现消息。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="eb87" class="ln lo iq le b gy lp lq l lr ls">MessagesContainer&gt;</span><span id="cd0a" class="ln lo iq le b gy lt lq l lr ls">{messages.map(message =&gt; &lt;Message</span><span id="1793" class="ln lo iq le b gy lt lq l lr ls">key={message.id}</span><span id="3da3" class="ln lo iq le b gy lt lq l lr ls">user={message.user}</span><span id="a93d" class="ln lo iq le b gy lt lq l lr ls">message={message.message}</span><span id="6a0b" class="ln lo iq le b gy lt lq l lr ls">timestamp={message.timestamp}</span><span id="ae0f" class="ln lo iq le b gy lt lq l lr ls">/&gt;)}</span><span id="9c3e" class="ln lo iq le b gy lt lq l lr ls">&lt;/MessagesContainer&gt;</span></pre><figure class="lf lg lh li gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mq"><img src="../Images/fe14b6b823ffbff4675179b95ce03032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qx7DqB4xpbrhUdH7iF-yaw.png"/></div></div></figure><h2 id="f924" class="ln lo iq bd lu lv lw dn lx ly lz dp ma ko mb mc md ks me mf mg kw mh mi mj mk bi translated">设置朋友或用户的信息风格</h2><p id="c4a2" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">回到<message>组件，将登录邮件设置为用户邮件。导入useAuth，获取currentUser并将loginMail设置为currentUser.email</message></p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="6211" class="ln lo iq le b gy lp lq l lr ls">import { useAuth } from '../Auth';</span><span id="4a6b" class="ln lo iq le b gy lt lq l lr ls">const Message = ({ user, message, timestamp }) =&gt; {</span><span id="b9a7" class="ln lo iq le b gy lt lq l lr ls">const {currentUser} = useAuth()</span><span id="5635" class="ln lo iq le b gy lt lq l lr ls">const loginMail = currentUser.email</span></pre><figure class="lf lg lh li gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi my"><img src="../Images/bdd93d1f1a65becde6ff9893339c62fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58UPRoJ28IIZiyInuaH1Ig.png"/></div></div></figure><h1 id="cb9b" class="mz lo iq bd lu na nb nc lx nd ne nf ma jw ng jx md jz nh ka mg kc ni kd mj nj bi translated">关注我们:<a class="ae nk" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae nk" href="https://ckmobile.medium.com/" rel="noopener"> Medium </a>，<a class="ae nk" href="https://www.udemy.com/user/cyruschan2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a>，<a class="ae nk" href="https://www.linkedin.com/company/ckmobi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae nk" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae nk" href="https://www.instagram.com/ckmobile8050" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae nk" href="https://app.gumroad.com/ckmobile" rel="noopener ugc nofollow" target="_blank"> Gumroad </a></h1><p id="6356" class="pw-post-body-paragraph kf kg iq kh b ki ml jr kk kl mm ju kn ko mn kq kr ks mo ku kv kw mp ky kz la ij bi translated">加入分支机构赚钱</p><div class="nl nm gp gr nn no"><a href="https://ckmobile.gumroad.com/affiliates" rel="noopener  ugc nofollow" target="_blank"><div class="np ab fo"><div class="nq ab nr cl cj ns"><h2 class="bd ir gy z fp nt fr fs nu fu fw ip bi translated">Gumroad</h2><div class="nv l"><h3 class="bd b gy z fp nt fr fs nu fu fw dk translated">申请成为会员很容易。填写下表，让Ckmobile知道您将如何推广他们的…</h3></div><div class="nw l"><p class="bd b dl z fp nt fr fs nu fu fw dk translated">ckmobile.gumroad.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc mw no"/></div></div></a></div><p id="4ecb" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="od">更多内容请看</em> <a class="ae nk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="od">说白了就是</em> </strong> </a> <em class="od">。报名参加我们的</em> <a class="ae nk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> <em class="od">免费每周简讯这里</em> </strong> </a> <em class="od">。</em></p></div></div>    
</body>
</html>