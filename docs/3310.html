<html>
<head>
<title>Using Mapbox GL JS, Mapbox Forward Geocoding with React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mapbox GL JS，Mapbox使用React进行正向地理编码</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-mapbox-gl-js-mapbox-forward-geocoding-with-reactjs-a7099f1c6033?source=collection_archive---------1-----------------------#2021-07-06">https://javascript.plainenglish.io/using-mapbox-gl-js-mapbox-forward-geocoding-with-reactjs-a7099f1c6033?source=collection_archive---------1-----------------------#2021-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/afacb1152492f011b5ac4143342f770a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsV6-3NN7XrMAKORfhDhIg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">picture: <a class="ae jz" href="https://unsplash.com/photos/yg8Cz-i5U30?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/yg8Cz-i5U30?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditShareLink</a></figcaption></figure><p id="885a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我一直是地图框的粉丝。可能因为我发现大多数开发人员都在使用它，我想我喜欢它是因为它的简单和易于设置。除此之外，Mapbox提供了一个强大的方法来定制你的地图，他们的文档也非常棒。</p><p id="6be5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本教程中，我将向您展示如何使用React、React hooks和Mapbox GL JS来构建:</p><ul class=""><li id="ff72" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">带有自定义标记的交互式地图</li><li id="4dcf" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">在地图框中正向地理编码</li></ul><h1 id="0d52" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">入门指南</h1><p id="9d10" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">首先，您需要一个API访问令牌来配置Mapbox GL JS进行路径选择和地理编码。去<a class="ae jz" href="https://www.mapbox.com/" rel="noopener ugc nofollow" target="_blank">mapbox.com</a>，创建一个账户。在您的控制面板上，创建一个令牌。请注意，本教程假设您对React有基本的了解。</p><p id="b6b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mp">设置我们的项目</em> </strong></p><p id="69d2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤1: </strong>在您的终端上，运行<code class="fe mq mr ms mt b">npx create-react-app mapbox-demo</code>来创建我们的react项目。一旦安装完成，用<code class="fe mq mr ms mt b">cd mapbox-demo</code>进入你的项目文件夹。</p><p id="2933" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第二步:</strong>我们还要安装Mapbox GL JS库和Mapbox SDK，因为我们会用到它们。</p><p id="dc25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">npm install mapbox-gl @mapbox/mapbox-sdk</code></p><p id="fe84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第三步:</strong>在你的<strong class="kc io"> src </strong>文件夹中，创建一个<strong class="kc io"> components </strong>文件夹。在你刚刚创建的文件夹中，创建一个<strong class="kc io"> GenerateMap.js </strong>文件。</p><p id="e876" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您的项目结构应该如下所示</p><pre class="mu mv mw mx gt my mt mz na aw nb bi"><span id="c601" class="nc ln in mt b gy nd ne l nf ng">...<br/>└── src<br/>    ├── components<br/>    │   └── GenerateMap.js<br/>    │<br/>    ├── App.css<br/>    ├── App.js<br/>...</span></pre><p id="4fc8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在让我们从编写一些代码开始😋</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><h1 id="2483" class="lm ln in bd lo lp no lr ls lt np lv lw lx nq lz ma mb nr md me mf ns mh mi mj bi translated">创建HTML页面</h1><p id="d8ed" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">打开<code class="fe mq mr ms mt b">public/index.html</code>文件，将下面的代码粘贴到其中。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="23ad" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这段代码创建了HTML页面的结构。这里我们有包含保存页面根的<code class="fe mq mr ms mt b">id</code>的<code class="fe mq mr ms mt b">div</code>。我们在<code class="fe mq mr ms mt b">head</code>标签处也有<code class="fe mq mr ms mt b"> mapbox-gl.css</code>链接。</p><h1 id="8372" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">创建React应用</h1><p id="7163" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">打开<code class="fe mq mr ms mt b">GenerateMap.js</code>文件。将以下代码添加到其中。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="43d0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们决定在这里进口一些东西。Mapbox SDK为我们提供了地理编码服务。而且不用担心，后面的<code class="fe mq mr ms mt b">&lt;React.Fragment/&gt;</code>会改的。</p><p id="3824" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们初始化地图。该代码将在页面装载后立即运行。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="fe28" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">需要使用<code class="fe mq mr ms mt b">mapContainerRef</code>将地图呈现为HTML元素。</p><p id="e737" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里我们在一个React <code class="fe mq mr ms mt b">useEffect </code>钩子中添加了Mapbox地图。这确保了在React尝试创建包含贴图的元素之前，贴图将被渲染。这也需要一组选项:</p><p id="79ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">container</code>:这个选项告诉Map JS在指定的DOM元素中渲染地图。在这里，地图期待着收到<code class="fe mq mr ms mt b">mapContainerRef</code>。</p><p id="a247" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">style</code>:这个选项定义了地图将要使用的样式。在这里，我们添加了<code class="fe mq mr ms mt b">mapbox://styles/mapbox/streets-v11</code></p><p id="98b7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">Zoom and Center</code>选项有助于确定地图缩放级别和中心坐标。在这里，我们将缩放级别设置为9，并将接收经度和纬度的地图中心设置为[3.361881，6.672557]。</p><p id="de13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意，我在这里添加的坐标是针对尼日利亚拉各斯<strong class="kc io">的。可以改成自己的选择。</strong></p><h1 id="b0d2" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">渲染地图</h1><p id="146f" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">现在，让我们渲染地图</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="a405" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">mapContainerRef</code>指定了地图在页面上呈现的入口点。</p><p id="7e14" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">地图也需要纠正的样式很少。将以下代码添加到您的<code class="fe mq mr ms mt b">app.css</code>文件中。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4ad4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开<code class="fe mq mr ms mt b">App.js</code>文件，粘贴以下代码。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="6019" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，我们将我们的<code class="fe mq mr ms mt b">GenerateMap.js</code>导入到<code class="fe mq mr ms mt b">App.js</code>。这是为了渲染地图。</p><p id="9cda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您很好地遵循了代码，您应该在浏览器上看到下面的内容。</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/70dc6a507f52418bf990db6131e60e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXOFDlmWiyLVOHrxPgZbTg.png"/></div></div></figure></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><h1 id="c256" class="lm ln in bd lo lp no lr ls lt np lv lw lx nq lz ma mb nr md me mf ns mh mi mj bi translated">地图框地理编码</h1><p id="be89" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">现在，让我们来谈谈地理编码以及它是如何在Mapbox中使用的。</p><p id="ff25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">地理编码</strong>是将一个位置的描述(如一对坐标、一个地址或一个地名)转换为地球表面上的一个位置的过程。</p><p id="05c0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Mapbox地理编码API 做两件事:<em class="mp">正向地理编码</em>和<em class="mp">反向地理编码</em>。</p><p id="724d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正向地理编码将位置文本转换为地理坐标，将<code class="fe mq mr ms mt b">Ikeja, Lagos</code>转换为<code class="fe mq mr ms mt b">3.33333, 6.58333</code>。</p><p id="304d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">逆向地理编码把地理坐标变成地名，把<code class="fe mq mr ms mt b">3.33333, 6.58333</code>变成<code class="fe mq mr ms mt b">Ikeja, Lagos</code>。这些位置名称的具体性可能有所不同，从单个地址到包含给定坐标的州和国家。</p><p id="53db" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，让我们回到我们的代码。T29】</p><p id="daee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将需要设置地图框地理编码，以允许它转换我们的位置。现在，将以下代码添加到<code class="fe mq mr ms mt b">GenerateMap.js</code>文件中。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="60db" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，我们将Mapbox地理编码SDK添加到React <code class="fe mq mr ms mt b">useCallback</code>挂钩中。然后我们传入了<code class="fe mq mr ms mt b">accessToken</code>选项。</p><p id="1a78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于本教程关注的是正向地理编码，我们决定使用<code class="fe mq mr ms mt b">forwardGeocode </code>方法。这也需要一组选项:</p><ul class=""><li id="080c" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">接收待转换位置的<code class="fe mq mr ms mt b">query</code>选项。当您进行查询时，您会得到一个<em class="mp">响应</em>，这是一个JSON格式的文档，包含了与您的查询最相关的结果。</li><li id="9954" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><code class="fe mq mr ms mt b">countries</code>选项接受您要查找的国家代码的字符串数组。ng是尼日利亚的互联网国家代码。</li><li id="40d4" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><code class="fe mq mr ms mt b">limit</code>选项用于限制搜索结果。这里，我们用了2。</li></ul><p id="7ce9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/mapbox/mapbox-sdk-js/blob/master/docs/services.md#geocoding" rel="noopener ugc nofollow" target="_blank">单击此处阅读有关地理编码选项和服务的更多信息。</a></p><h1 id="2c3b" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">显示新的几何坐标</h1><p id="0133" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">现在我们已经能够获取正向地理编码地址，让我们创建一个额外的<code class="fe mq mr ms mt b">useEffect </code>钩子来调用这个函数。添加以下代码:</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8bdb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们做了以下几件事:</p><ul class=""><li id="bee2" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">我们加载新的几何坐标<code class="fe mq mr ms mt b">fetchData()</code>并在有更新时进行检查。</li><li id="f170" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated"><code class="fe mq mr ms mt b"><strong class="kc io">new mapboxgl.Marker()</strong></code> <strong class="kc io"> </strong>创建一个标记并使用<code class="fe mq mr ms mt b">setLngLat()</code>方法设置一个新坐标。我们使用<code class="fe mq mr ms mt b">setPopup()</code>方法创建一个弹出窗口，每当点击标记时显示坐标描述。</li><li id="e8ac" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">我们编写了一个Mapbox GL JS <code class="fe mq mr ms mt b">map.on('load')</code>函数，帮助加载新值，并使用<code class="fe mq mr ms mt b">map.flyTo()</code>在几何中心发生变化时将地图重新居中到新值。</li></ul><p id="4b8d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可能还注意到，我们用<code class="fe mq mr ms mt b">marker </code> className创建了一个新的<code class="fe mq mr ms mt b">div</code>元素。现在，让我们给我们的标记添加样式。除了之前的样式之外，将以下代码添加到您的<code class="fe mq mr ms mt b">app.css</code>文件中。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="132c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">保存您的工作并返回浏览器页面。有一个带波纹效果的标记，指示我们新位置的位置。您可以单击标记查看描述。</p><h1 id="afac" class="lm ln in bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">终于！！！😊</h1><p id="fe37" class="pw-post-body-paragraph ka kb in kc b kd mk kf kg kh ml kj kk kl mm kn ko kp mn kr ks kt mo kv kw kx ig bi translated">您已经成功创建了使用Mapbox GL JS和Mapbox正向地理编码的React应用程序。如果您已经按照教程进行到这一步，您的最终结果应该是这样的:</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/eabb04ac1d9a05025b89bfc219a4fc34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAmXyIuwt53Rnb908_dxGA.png"/></div></div></figure><p id="406f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">相信这篇教程对你有所帮助。请使用“鼓掌”按钮给它尽可能多的掌声，并为任何贡献留下评论。</p><p id="1b37" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本教程的完整代码可以在</p><div class="nx ny gp gr nz oa"><a href="https://github.com/sadewole/Mapbox-Reactjs" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">sadewole/Mapbox-Reactjs</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo jt oa"/></div></div></a></div><p id="8609" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读。</p><p id="3498" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mp">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mp">plain English . io</em></strong></a></p></div></div>    
</body>
</html>