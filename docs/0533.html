<html>
<head>
<title>Visualize Website Usage with a React Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React仪表板可视化网站使用情况</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/visualize-website-usage-with-a-react-dashboard-fb2b206ec0cc?source=collection_archive---------10-----------------------#2021-02-01">https://javascript.plainenglish.io/visualize-website-usage-with-a-react-dashboard-fb2b206ec0cc?source=collection_archive---------10-----------------------#2021-02-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bd43" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过仪表板鸟瞰您的网站使用情况</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/b09e04e0b8d0d6ea25ee7f3d467afd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ixYNiOOsBbf-AQ2H"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@mjessier" rel="noopener ugc nofollow" target="_blank">Myriam Jessier</a> on <a class="ae ks" href="https://unsplash.com/photos/VCtI-0qlVgA" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c818" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">本文是</em> <a class="ae ks" href="https://ramapitchala.medium.com/track-website-usage-with-postgresql-and-flask-53f583249911" rel="noopener"> <em class="lp">用PostgreSQL和Flask </em> </a> <em class="lp">追踪网站使用情况的续篇。在那篇文章中，我们创建了一个记录使用数据的服务。然而，在本文中，我们将通过一个仪表板来赋予使用数据以生命。</em></p><h1 id="e72e" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">介绍</h1><p id="27ef" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">收集数据很重要，但数据中的主要洞察力是通过可视化提取的。回顾一下，在前传中，<a class="ae ks" href="https://ramapitchala.medium.com/track-website-usage-with-postgresql-and-flask-53f583249911" rel="noopener"> <em class="lp">使用PostgreSQL和Flask </em> </a> <em class="lp">，</em>跟踪网站使用情况，我们的目标是跟踪每天的浏览量、阅读量(用户在网站上停留至少10秒钟)和独立观众的数量。我们可以通过提供端点<code class="fe mn mo mp mq b">/view</code>和<code class="fe mn mo mp mq b">/read</code>来跟踪这些指标，网站可以调用。此外，我们创建了一个名为<code class="fe mn mo mp mq b">/analytics</code>的端点，它将返回提供开始和结束日期的每天的上述指标。我们将利用<code class="fe mn mo mp mq b">/analytics</code>端点创建一个仪表板来查看这些拆分。</p><h2 id="ad78" class="mr lr in bd ls ms mt dn lw mu mv dp ma lc mw mx mc lg my mz me lk na nb mg nc bi translated">议程</h2><ul class=""><li id="af2f" class="nd ne in kv b kw mi kz mj lc nf lg ng lk nh lo ni nj nk nl bi translated">概念想法</li><li id="e79e" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">设置</li><li id="174a" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">构建仪表板</li><li id="3cd7" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">结论</li></ul><h1 id="3023" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">概念想法</h1><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/6e7eba99828523f0970977b7f8a0235a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U3iPYfiSXP126uta"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@pavement_special" rel="noopener ugc nofollow" target="_blank">Riccardo Annandale</a> on <a class="ae ks" href="https://unsplash.com/photos/7e2pe9wjL9M" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f6ba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我首先提供一个使用<code class="fe mn mo mp mq b">/analytics</code>的例子。</p><p id="690f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">看看这个:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/9981e0f9181f1f519a5daad7b4cda13c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TYiqXbSssnO6oIGZdRPbw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by Author</figcaption></figure><p id="ab44" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如您所见，我们可以切换<code class="fe mn mo mp mq b">start_date</code>和<code class="fe mn mo mp mq b">end_date</code>并获取每天的数据。这将是我的仪表板的数据源。然而，如果你还没有从<a class="ae ks" href="https://ramapitchala.medium.com/track-website-usage-with-postgresql-and-flask-53f583249911" rel="noopener">前传</a>中构建出服务，这完全没问题。相反，您可以使用自己的自定义数据源来驱动仪表板。</p><p id="5a18" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们浏览一下工作流程。在我们的仪表板中，我们将首先向数据源发出请求。然后，一旦我们有了数据，我们将创建一个条形图来显示视图，阅读和独特的观众每天是如何变化的。此外，我们将有开始和结束日期切换。如果它们被更改，我们将再次请求并更新条形图。</p><p id="dd48" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是表示该过程的图表:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/24f8fb15af2d3444ccae6e40ea5dd4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*7-vbyIyvbbP0wmrwxbLnUg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by Author</figcaption></figure><p id="bcf8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是仪表板最后的样子:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nt nu l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Gif by Author</figcaption></figure><p id="313d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有了这些，让我们开始有趣的部分，编码！</p><h1 id="0d92" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">设置</h1><p id="f25c" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">让我们从创建一个新的React项目开始。我将使用打字稿。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="332c" class="mr lr in mq b gy nz oa l ob oc">npx create-react-app usage --typescript</span></pre><p id="de56" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">移动到项目目录并安装以下内容:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="181c" class="mr lr in mq b gy nz oa l ob oc">npm install react react-google-charts react-scripts react-dom react-datepicker @types/react-datepicker typescript</span></pre><h1 id="6788" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">构建仪表板</h1><p id="9ed0" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">在<code class="fe mn mo mp mq b">src/</code>文件夹中，制作<code class="fe mn mo mp mq b">Types.ts</code>。让我们定义我们将在整个应用程序中使用的常见类型。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="e20f" class="mr lr in mq b gy nz oa l ob oc">export type Day = {<br/>    day_id: string,<br/>    views: number,<br/>    reads: number,<br/>    viewers: number<br/>}</span><span id="43ea" class="mr lr in mq b gy od oa l ob oc">export type UsageData = {<br/>    days: Day[],<br/>    views: number,<br/>    reads: number,<br/>    viewers: number<br/>}</span></pre><p id="fd2a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在<code class="fe mn mo mp mq b">src/</code>文件夹中，创建另一个名为<code class="fe mn mo mp mq b">api</code>的文件夹。导航进入<code class="fe mn mo mp mq b">src/api</code>，做<code class="fe mn mo mp mq b">Usage.ts</code>。</p><p id="1f7c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">获取分析数据的代码将放在这里。如前所述，这一部分会根据您获取数据的方式而有所不同。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="0d9c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">基本上，提供一个<code class="fe mn mo mp mq b">start</code>和<code class="fe mn mo mp mq b">end</code>，我构造请求URL并向<code class="fe mn mo mp mq b">/analytics</code>端点发出GET请求。是托管我的服务的地方。请随意在<code class="fe mn mo mp mq b">getUsage</code>方法中集成您自己的数据源。</p><p id="696d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">导航回<code class="fe mn mo mp mq b">src/</code>并创建<code class="fe mn mo mp mq b">ui/</code>。进入<code class="fe mn mo mp mq b">src/ui</code>并创建<code class="fe mn mo mp mq b">Graph.tsx</code>。我们将使用<a class="ae ks" href="https://react-google-charts.com/" rel="noopener ugc nofollow" target="_blank"> react-google-charts </a>库来构建条形图。让我们制作<code class="fe mn mo mp mq b">Graph</code>组件。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="3365" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mn mo mp mq b">data</code>具有类型<code class="fe mn mo mp mq b">any[]</code>的原因是因为react-google-charts要求条形图的数据格式。查看构建条形图的文档，了解原因:</p><div class="of og gp gr oh oi"><a href="https://react-google-charts.com/bar-chart" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">条形图</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">用谷歌图表呈现任何图表并作出反应</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">react-google-charts.com</p></div></div><div class="or l"><div class="os l ot ou ov or ow km oi"/></div></div></a></div><p id="931b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了提供一个具体的例子，假设<code class="fe mn mo mp mq b">data</code>如下:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="abca" class="mr lr in mq b gy nz oa l ob oc">const data = [['day', 'views'],['Jan. 1', 8],<br/>              ['Jan. 2', 3],['Jan. 3', 18],<br/>              ['Jan. 4', 2],['Jan. 5', 38]];</span></pre><p id="32b2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果我将它传递到<code class="fe mn mo mp mq b">Graph</code>的道具中，输出如下:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/a402ff11e871eb4c76bfd73e052d5c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*mlIvleFA3NEby8hq4oBeYQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by Author</figcaption></figure><p id="1266" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将重用这个组件来呈现视图、阅读量和唯一查看者的条形图。完成图表后，让我们继续构建仪表板。</p><p id="c617" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，在同一文件夹中，创建<code class="fe mn mo mp mq b">Dashboard.css</code>。在那里，放入以下样式:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="7ea0" class="mr lr in mq b gy nz oa l ob oc">.tab{<br/>    display: inline-block;<br/>    color: grey;<br/>}</span><span id="4759" class="mr lr in mq b gy od oa l ob oc">.tab:hover{<br/>    cursor: pointer;<br/>    color: black;<br/>}</span></pre><p id="e8fe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这些样式将应用于仪表板预览中的“视图”、“阅读”和“查看者”选项卡。CSS完成后，让我们构建<code class="fe mn mo mp mq b">Dashboard</code>组件。创建<code class="fe mn mo mp mq b">Dashboard.tsx</code>。</p><p id="fbda" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个组件是这个项目中最复杂的部分。因此，我们将从imports和utility变量开始一点一点地介绍它。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="8249" class="mr lr in mq b gy nz oa l ob oc">import UsageApi from "../api/Usage";<br/>import Graph from "./Graph";<br/>import DatePicker from "react-datepicker";<br/>import { useState, useEffect } from "react";<br/>import {Day} from "../Types";<br/>import "react-datepicker/dist/react-datepicker.css";<br/>import "./Dashboard.css";</span><span id="f196" class="mr lr in mq b gy od oa l ob oc">const months = ["Jan.", "Feb.", "Mar.", "Apr.", "May.", "Jun.", "Jul.", "Aug.", "Sep.", "Oct.", "Nov.", "Dec."];</span></pre><p id="472e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们还需要创建一些实用函数。例如，我们将使用JavaScript Date类来创建和操作日期。如果有一个函数能够提供日期的深层副本，将会非常有用。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="a86e" class="mr lr in mq b gy nz oa l ob oc">const copyDate = (date:Date) =&gt; {<br/>    return new Date(date.getFullYear(), date.getMonth(),   date.getDate());<br/>}</span></pre><p id="2dd7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，我必须创建一个名为<code class="fe mn mo mp mq b">format</code>的函数，当提供一个类型为<code class="fe mn mo mp mq b">day</code>的数组、一个开始和结束日期以及用户希望在条形图中可视化的指标时，该函数应该返回一个数组，该数组可以作为<code class="fe mn mo mp mq b">data</code>属性传递给<code class="fe mn mo mp mq b">Graph</code>。同样，格式化数据所必须经历的步骤将取决于您的数据源。对于我的情况，考虑这个例子:</p><p id="384b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设我向<code class="fe mn mo mp mq b">/analytics</code>发送一个请求，开始日期为2021年1月27日，结束日期为2021年1月30日。假设这是返回的数据:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="82c8" class="mr lr in mq b gy nz oa l ob oc">[{<br/>    "day_id": "2021-01-28",<br/>    "reads": 1,<br/>    "viewers": 1,<br/>    "views": 2<br/>},<br/>{<br/>    "day_id": "2021-01-30",<br/>    "reads": 1,<br/>    "viewers": 1,<br/>    "views": 2<br/>}]</span></pre><p id="d668" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">免责声明:之所以没有2021–01–27和2021–01–29的任何数据，是因为在那几天没有人访问我的网站。</em></p><p id="1a9f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们的仪表板设计中，我们只显示用户选择的指标的细分。假设在这个场景中，用户希望看到视图的可视化。下面是<code class="fe mn mo mp mq b">format</code>应该返回的内容:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="417e" class="mr lr in mq b gy nz oa l ob oc">[["day", "views"],<br/> ["Jan. 27", 0],<br/> ["Jan. 28", 2],<br/> ["Jan. 29", 0],<br/> ["Jan. 30", 2]]</span></pre><p id="1a43" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">相反，如果他们想要查看读数的显示，将会返回以下内容:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="4c7d" class="mr lr in mq b gy nz oa l ob oc">[["day", "reads"],<br/> ["Jan. 27", 0],<br/> ["Jan. 28", 1],<br/> ["Jan. 29", 0],<br/> ["Jan. 30", 1]]</span></pre><p id="3030" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我希望这消除了关于<code class="fe mn mo mp mq b">format</code>功能的疑问。如果它的目的仍然模糊不清，一旦我们完全构建出仪表板，它将变得更加清晰。而且，如果你的数据源和我的不一样，这个函数对你来说可能也不一样。就这样，下面是我的<code class="fe mn mo mp mq b">format</code>函数:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="5bcc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了说明输出中没有记录访问的日子，我决定创建<code class="fe mn mo mp mq b">index</code>并利用它来遍历<code class="fe mn mo mp mq b">days</code>。算法不重要。我主要想表达的是，我需要转换从<code class="fe mn mo mp mq b">/analytics</code>获得的数据，以便呈现实际的条形图。</p><p id="03fb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">效用函数完成后，让我们制作<code class="fe mn mo mp mq b">Dashboard</code>组件。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="aeb2" class="mr lr in mq b gy nz oa l ob oc">const Dashboard = () =&gt; {</span><span id="6322" class="mr lr in mq b gy od oa l ob oc">}</span></pre><p id="ee58" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们从声明组件中的状态变量开始:</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="835c" class="mr lr in mq b gy nz oa l ob oc">const [data, setData] = useState&lt;Day[]&gt;([]);<br/>const [isLoading, setIsLoading] = useState&lt;boolean&gt;(true);</span><span id="5a3e" class="mr lr in mq b gy od oa l ob oc">const currentDay = new Date();<br/>const [end, setEnd] = useState&lt;Date&gt;(currentDay);<br/>    <br/>const startDay = copyDate(currentDay);<br/>startDay.setMonth(startDay.getMonth() - 1);<br/>const [start, setStart] = useState&lt;Date&gt;(startDay);</span><span id="3653" class="mr lr in mq b gy od oa l ob oc">const [metric, setMetric] = useState("views");<br/>const [metricData, setMetricData] = useState&lt;any&gt;({views: 0, reads:0, viewers:0})</span></pre><p id="21c3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mn mo mp mq b">data</code>代表我们通过调用<code class="fe mn mo mp mq b">/analytics</code>得到的<code class="fe mn mo mp mq b">day[]</code>。<code class="fe mn mo mp mq b">loading</code>只是在我们等待<code class="fe mn mo mp mq b">/analytics</code>请求完成的时候呈现一个加载组件。<code class="fe mn mo mp mq b">end</code>指结束日期，<code class="fe mn mo mp mq b">start</code>指开始日期。默认情况下，<code class="fe mn mo mp mq b">start</code>会比<code class="fe mn mo mp mq b">end</code>早一个月。<code class="fe mn mo mp mq b">metric</code>指用户希望在条形图中可视化的字段。<code class="fe mn mo mp mq b">metricData</code>是一个对象，它存储了在<code class="fe mn mo mp mq b">start </code>和<code class="fe mn mo mp mq b">end</code>之间的时间段内的总浏览量、阅读量和观看者数。</p><p id="79aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果<code class="fe mn mo mp mq b">start</code>和<code class="fe mn mo mp mq b">end</code>发生变化，我们需要用新的开始和结束日期从<code class="fe mn mo mp mq b">/analytics</code>中检索数据，并更新我们的组件状态。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="dcad" class="mr lr in mq b gy nz oa l ob oc">useEffect(() =&gt; {<br/>        UsageApi.getUsage(start, end).then(({days, views, reads, viewers}) =&gt; {<br/>            setData(days);<br/>            setMetricData({views:views, reads:reads, viewers:viewers})<br/>        }).finally(() =&gt; {<br/>            setIsLoading(false);<br/>        })<br/>    }, [start, end]);</span></pre><p id="91cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在让我们来构建选项卡，以便在不同的指标之间进行筛选。以下是我所说的标签:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="8ae9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将创建一个名为<code class="fe mn mo mp mq b">getTabs</code>的方法，它将返回选项卡的div。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="913d" class="mr lr in mq b gy nz oa l ob oc">const getTabs = () =&gt; {<br/>        const metrics = ["views", "reads", "viewers"];<br/>        return metrics.map((m) =&gt; {<br/>            let textStyle: any = {<br/>                margin: "10px"<br/>            };<br/>            if(metric === m){<br/>                textStyle.color = "black";<br/>                textStyle.textDecoration = "underline";<br/>            }<br/>            return &lt;div className="tab" style={textStyle} onClick={()=&gt;{<br/>                setMetric(m);<br/>            }}&gt;<br/>                {`${metricData[m]} ${m}`}<br/>            &lt;/div&gt;<br/>        });<br/>    }</span></pre><p id="5737" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在选项卡被点击的情况下，条形图显示的指标将不得不改变。因此，这就是为什么我们需要在对<code class="fe mn mo mp mq b">onClick</code>的回调中使用<code class="fe mn mo mp mq b">setMetric</code>。</p><p id="f3e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，剩下的就是返回组件将呈现的内容。</p><p id="345f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们单独构建主要部分，然后将它们放在一起。</p><p id="a409" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了构建日期选择器，我们将使用<a class="ae ks" href="https://reactdatepicker.com/" rel="noopener ugc nofollow" target="_blank"> react-datepicker </a>。这个日期选择器库允许我们直观地选择日期，处理日期选择，并过滤无效的日期。以下是对应于开始日期的日期选择器:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="a246" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mn mo mp mq b">onChange</code> prop用于处理用户从日历下拉列表中选择新的开始日期的情况。因为我们必须保证结束日期总是晚于开始日期，所以我们必须更新<code class="fe mn mo mp mq b">end</code>，以防用户选择晚于<code class="fe mn mo mp mq b">end</code>的日期。</p><p id="8b95" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">结束日期的日期选取器与开始日期的日期选取器非常相似。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="8bc0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于这个日期选择器，我们必须确保用户永远不能选择早于当前开始日期的结束日期。我们可以用<code class="fe mn mo mp mq b">filterDate</code>道具做到这一点。我们将只允许用户选择等于或晚于我们的开始日期的日期。</p><p id="3f66" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们需要调用<code class="fe mn mo mp mq b">getTabs</code>方法来呈现我们的指标选择选项卡，并使用<code class="fe mn mo mp mq b">Graph</code>来呈现条形图。这就是<code class="fe mn mo mp mq b">format</code>函数的用武之地。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="7127" class="mr lr in mq b gy nz oa l ob oc">&lt;div&gt;<br/>      {getTabs()}<br/>      &lt;Graph data={format(data, start, end, metric)} /&gt;<br/> &lt;/div&gt;</span></pre><p id="4291" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">以下是添加了上述内容的完整退货声明:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="d737" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该文件的最后一步是导出<code class="fe mn mo mp mq b">Dashboard</code>。在文件末尾添加以下内容。</p><pre class="kd ke kf kg gt nv mq nw nx aw ny bi"><span id="b905" class="mr lr in mq b gy nz oa l ob oc">export default Dashboard;</span></pre><p id="9596" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">官方的最后一步是在<code class="fe mn mo mp mq b">/src</code>更新<code class="fe mn mo mp mq b">App.tsx</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe nu l"/></div></figure><p id="2af6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">运行<code class="fe mn mo mp mq b">npm start</code>启动仪表板。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oy nu l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Gif on <a class="ae ks" href="https://giphy.com/gifs/nba-expression-3ohs4lEkyu8j5ZV1V6https://giphy.com/gifs/nba-expression-3ohs4lEkyu8j5ZV1V6" rel="noopener ugc nofollow" target="_blank">Giphy</a></figcaption></figure><p id="7814" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那是一个包裹！</p><p id="b373" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您想查看完整的项目，请查看以下资源库。</p><div class="of og gp gr oh oi"><a href="https://github.com/Ramko9999/Medium-React-Dashboard" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">ramko 9999/Medium-React-仪表板</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">通过在GitHub上创建一个帐户，为ramko 9999/Medium-React-Dashboard开发做出贡献。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">github.com</p></div></div><div class="or l"><div class="oz l ot ou ov or ow km oi"/></div></div></a></div><h1 id="8d25" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">结论</h1><p id="d0f2" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">随着仪表板的完成，我们现在已经构建了一个端到端的分析系统。在<a class="ae ks" href="https://ramapitchala.medium.com/track-website-usage-with-postgresql-and-flask-53f583249911" rel="noopener">前传</a>中，我们构建了API，现在，通过这个仪表板，我们有了一种可视化原始数据的方法。虽然我提出并实现的解决方案可能很简单，但我希望它能唤起您的好奇心，并作为您未来努力的蓝图。<strong class="kv io">总之，</strong> <strong class="kv io">非常感谢你的坚持！</strong></p><h1 id="751e" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">其他酷博客</h1><div class="of og gp gr oh oi"><a href="https://medium.com/javascript-in-plain-english/zero-to-hero-chrome-extensions-4060520daf59" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">从零到英雄:Chrome扩展</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">以编程方式挖掘浏览器的全部功能！</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="pa l ot ou ov or ow km oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://medium.com/swlh/build-a-dynamic-portfolio-with-the-github-api-6d74081e5164" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">使用Github API构建动态投资组合</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">简介:</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">medium.com</p></div></div><div class="or l"><div class="pb l ot ou ov or ow km oi"/></div></div></a></div><div class="of og gp gr oh oi"><a href="https://ramapitchala.medium.com/track-website-usage-with-postgresql-and-flask-53f583249911" rel="noopener follow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">使用PostgreSQL和Flask跟踪网站使用情况</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">你的网站有多少浏览量？让我们建造一个追踪器！</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">ramapitchala.medium.com</p></div></div><div class="or l"><div class="pc l ot ou ov or ow km oi"/></div></div></a></div><h1 id="135d" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">资源</h1><p id="c979" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated"><strong class="kv io"> react-google-charts: </strong></p><div class="of og gp gr oh oi"><a href="https://react-google-charts.com/bar-chart" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">条形图</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">用谷歌图表呈现任何图表并作出反应</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">react-google-charts.com</p></div></div><div class="or l"><div class="pd l ot ou ov or ow km oi"/></div></div></a></div><p id="6ba6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> react-datepicker: </strong></p><div class="of og gp gr oh oi"><a href="https://reactdatepicker.com/" rel="noopener  ugc nofollow" target="_blank"><div class="oj ab fo"><div class="ok ab ol cl cj om"><h2 class="bd io gy z fp on fr fs oo fu fw im bi translated">由HackerOne制作的React Datepicker</h2><div class="op l"><h3 class="bd b gy z fp on fr fs oo fu fw dk translated">React的一个简单且可重用的datepicker组件。</h3></div><div class="oq l"><p class="bd b dl z fp on fr fs oo fu fw dk translated">reactdatepicker.com</p></div></div></div></a></div></div></div>    
</body>
</html>