<html>
<head>
<title>How to Create a Simple Web UI to Manage Node.js Process with PM2 API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用PM2 API创建一个简单的Web UI来管理Node.js流程</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-simple-web-ui-to-manage-nodejs-process-with-pm2-api-132986fe3fed?source=collection_archive---------0-----------------------#2021-05-30">https://javascript.plainenglish.io/how-to-create-a-simple-web-ui-to-manage-nodejs-process-with-pm2-api-132986fe3fed?source=collection_archive---------0-----------------------#2021-05-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/15e89fb7b78bb34f478fa2fa0e9d6a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRnr4rWCT4vxlVC-Nasybw.png"/></div></div></figure><blockquote class="jv jw jx"><p id="760d" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><a class="ae kx" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> PM2 </a>是Node.js应用程序的生产流程管理器，内置负载均衡器。它允许您永远保持应用程序的活力，在不停机的情况下重新加载应用程序，并简化常见的系统管理任务。</p></blockquote><p id="9e12" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">使用PM2 CLI，您可以在本地服务器上管理Node.js进程。如果你有一个在线服务器(公共互联网)，你可以使用<a class="ae kx" href="https://id.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> keymetrics </a>服务来管理你的进程。</p><p id="6fcd" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">也许这些特性对于“正常”的情况已经足够了。但是有时，您的项目需要一个简单的web界面来管理本地服务器中的所有Node.js。或者项目需要将流程管理器模块作为项目的一部分。PM2提供<a class="ae kx" href="https://pm2.keymetrics.io/docs/usage/pm2-api/" rel="noopener ugc nofollow" target="_blank"> PM2 API </a>解决此类情况。</p><blockquote class="jv jw jx"><p id="4ad4" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">PM2可以以编程方式使用，这意味着您可以在代码中直接嵌入一个进程管理器，生成进程，即使退出主脚本也能让它们保持活动状态。</p></blockquote><p id="1bfc" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">在这个故事中，我将向您展示如何构建一个简单的web服务来自己管理Node.js进程。项目栈:TypeScript，Express，pm2 API，socket.io。</p><h1 id="dc64" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">初始项目</h1><p id="b520" class="pw-post-body-paragraph jy jz in kb b kc lz ke kf kg ma ki kj ky mb km kn kz mc kq kr la md ku kv kw ig bi translated">确保您已经将pm2作为全局软件包安装:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a583" class="mn lc in mj b gy mo mp l mq mr">$ npm install pm2@latest -g</span></pre><p id="76b9" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">用TypeScript开始一个简单的express项目:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6bd3" class="mn lc in mj b gy mo mp l mq mr">$ mkdir ts-pm2-ui # Create project directory<br/>$ cd ts-pm2-ui</span><span id="e893" class="mn lc in mj b gy ms mp l mq mr">$ npm init -y # Inital a nodejs project</span><span id="e35c" class="mn lc in mj b gy ms mp l mq mr">$ npm install express pm2 -S # Install dependencies<br/>$ npm install @types/express ts-node-dev typescript # Install dev dependencies</span><span id="d5f1" class="mn lc in mj b gy ms mp l mq mr">$ npx tsc --init # Create tsconfig.json file</span></pre><p id="d2ab" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">更新<code class="fe mt mu mv mj b">tsconfig.json</code>:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="55fd" class="mn lc in mj b gy mo mp l mq mr">{<br/>  "compilerOptions": {<br/>    "target": "es6",<br/>    "module": "commonjs",<br/>    "sourceMap": true,<br/>    "outDir": "./dist",<br/>    "strict": true,<br/>    "moduleResolution": "node",<br/>    "esModuleInterop": true,<br/>    "skipLibCheck": true,<br/>    "forceConsistentCasingInFileNames": true<br/>  },<br/>  "include": [<br/>    "./src"<br/>  ]<br/>}</span></pre><p id="eb03" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">将<code class="fe mt mu mv mj b">dev</code>脚本添加到<code class="fe mt mu mv mj b">package.json</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="634c" class="mn lc in mj b gy mo mp l mq mr">...<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",<br/>    "dev": "ts-node-dev --respawn --transpile-only ./src/app.ts"<br/>  },<br/>...</span></pre></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="baae" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">创建一个简单的express服务器，为某人访问<code class="fe mt mu mv mj b">GET /</code>路由器的<code class="fe mt mu mv mj b">index.html</code>文件提供服务。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="b5fb" class="mn lc in mj b gy mo mp l mq mr">// ./src/app.ts</span><span id="7da3" class="mn lc in mj b gy ms mp l mq mr">import express from 'express';</span><span id="c39a" class="mn lc in mj b gy ms mp l mq mr">const app = express();</span><span id="21b1" class="mn lc in mj b gy ms mp l mq mr">app.use(express.static('public'));</span><span id="faa9" class="mn lc in mj b gy ms mp l mq mr">app.get('/', (req, res) =&gt; {<br/>  res.redirect('/index.html');<br/>});</span><span id="6720" class="mn lc in mj b gy ms mp l mq mr">const PORT = process.env.PORT || 3000;</span><span id="858f" class="mn lc in mj b gy ms mp l mq mr">app.listen(PORT, () =&gt; {<br/>  console.log(`[Server] Listening on :${PORT}`);<br/>});</span></pre><p id="e108" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">并创建一个简单的HTML页面，该页面将显示Node.js进程列表:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/acf8b1a8ed80244eddedee3347334d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ynnKq4-WIxdKxzagQG4Psg.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Pm2 simple GUI</figcaption></figure><p id="e24e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">./public/index.html</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="15f3" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">此外，创建<code class="fe mt mu mv mj b">./public/js/main.js</code> —脚本文件将控制HTML内容。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="90b4" class="mn lc in mj b gy mo mp l mq mr">// ./public/js/main.js<br/>(function ($, window, document) {<br/>  $(async function () {<br/>    console.log('The DOM is ready!');<br/>  });<br/>}(window.jQuery, window, document));</span></pre></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="e9a2" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">启动开发服务器:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dc53" class="mn lc in mj b gy mo mp l mq mr">$ npm run dev</span></pre><p id="4f5c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">然后，让我们使用您的浏览器并访问<a class="ae kx" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank">http://localhost:3000</a>URL。</p><h1 id="cf6e" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">PM2 API</h1><p id="ff4d" class="pw-post-body-paragraph jy jz in kb b kc lz ke kf kg ma ki kj ky mb km kn kz mc kq kr la md ku kv kw ig bi translated">假设我们有一个JavaScript文件列表。我们需要做的是控制每个JavaScript文件的进程。</p><p id="2b16" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们需要的所有行动是:</p><ul class=""><li id="1cd2" class="nk nl in kb b kc kd kg kh ky nm kz nn la no kw np nq nr ns bi translated">向PM2注册流程并启动它</li><li id="d468" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw np nq nr ns bi translated">停止该过程</li><li id="46bb" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw np nq nr ns bi translated">重新开始该过程</li><li id="db8b" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw np nq nr ns bi translated">停止该过程</li><li id="23e8" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw np nq nr ns bi translated">获取所有进程状态</li></ul><p id="135b" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">创建一个包装类，通过PM2 API连接到PM2守护进程。</p><p id="b6e5" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">./src/pm2Lib.ts</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b2e7" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我用两个JavaScript脚本来演示— <code class="fe mt mu mv mj b">miner01.js</code>和<code class="fe mt mu mv mj b">miner02.js</code>。脚本存储在<code class="fe mt mu mv mj b">process.env.SCRIPT_PATH</code>中。</p><p id="3f56" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">pm2</code>包提供了一些使用PM2守护程序的方法(描述、启动、停止、重启……)。但是，它们都是回调函数，那么我们会尝试将它们转换成之前的<code class="fe mt mu mv mj b">Promise</code>风格。为此，我们可以将它们包装成一个新的Promise，或者只使用<code class="fe mt mu mv mj b">util.promisify</code>实用程序(需要Node.js版本≥ 8)。<strong class="kb io"> <em class="ka">重要提示:当你通过</em> </strong> <code class="fe mt mu mv mj b"><strong class="kb io"><em class="ka">promissify</em></strong></code> <strong class="kb io"> <em class="ka">变换pm2的方法时，记住将</em> </strong> <code class="fe mt mu mv mj b"><strong class="kb io"><em class="ka">pm2</em></strong></code> <strong class="kb io"> <em class="ka">绑定为</em> </strong> <code class="fe mt mu mv mj b"><strong class="kb io"><em class="ka">this</em></strong></code> <strong class="kb io"> <em class="ka">。</em> </strong></p><p id="50a3" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们有一个私人方法——<code class="fe mt mu mv mj b">getStartOptions</code>。当您提供一个JS文件名作为<code class="fe mt mu mv mj b">filename</code>参数时，它返回<a class="ae kx" href="https://pm2.keymetrics.io/docs/usage/pm2-api/#programmatic-api" rel="noopener ugc nofollow" target="_blank"> PM2的start选项对象</a>。确保您的文件存在于<code class="fe mt mu mv mj b">${this.SCRIPT_PATH}/${filename}</code>。我们还设置<code class="fe mt mu mv mj b">filename</code>作为流程名称，然后在另一个函数中，我们将使用<code class="fe mt mu mv mj b">filename</code>作为流程标识符。</p><p id="71e4" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">getProcesses</code>方法尝试遍历<code class="fe mt mu mv mj b">this.MINERS</code>变量中的所有JS文件名，并获取每个进程的状态。这意味着，我们只是得到我们的脚本的状态，而不是所有由PM2管理的脚本。如果JavaScript文件的流程不存在，我们返回一个状态为<code class="fe mt mu mv mj b">stopped</code>的“假”流程对象。</p><p id="518c" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">其他方法:<code class="fe mt mu mv mj b">startProcess</code>、<code class="fe mt mu mv mj b">restartProcess</code>、<code class="fe mt mu mv mj b">stopProcess</code>我们只是将参数转发给pm2的方法。</p></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><p id="8cdd" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们正在构建一个web服务，然后在下一步，我们将导出一些API，这些API可以帮助客户端与后端一起工作。</p><p id="d3b6" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们在express应用程序中注册了2个API:</p><ul class=""><li id="dfa3" class="nk nl in kb b kc kd kg kh ky nm kz nn la no kw np nq nr ns bi translated"><code class="fe mt mu mv mj b">GET /miners</code>:返回流程状态列表</li><li id="cd8a" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw np nq nr ns bi translated"><code class="fe mt mu mv mj b">PUT /miners/:filename/:action</code>:控制过程</li></ul><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="d29e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">只需调用<code class="fe mt mu mv mj b">pm2Lib</code>的相关方法。</p><p id="0d1a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">对于后端来说，这已经足够了，让我们调用客户端的API。</p><h1 id="86a5" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">更新客户端</h1><ol class=""><li id="8c5a" class="nk nl in kb b kc lz kg ma ky ny kz nz la oa kw ob nq nr ns bi translated">获取所有过程状态<br/>调用<code class="fe mt mu mv mj b">GET /miners</code> API并循环通过API响应来更新过程表内容。</li><li id="002f" class="nk nl in kb b kc nt kg nu ky nv kz nw la nx kw ob nq nr ns bi translated">处理动作按钮的事件。<br/>用正确的<code class="fe mt mu mv mj b">filename</code>和<code class="fe mt mu mv mj b">action</code>调用<code class="fe mt mu mv mj b">PUT /miners/:filename/:action</code> API，然后刷新工艺表内容。</li></ol><p id="fb97" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">./public/js/main.js</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="44bf" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们还每15秒更新一次进程表。</p><p id="dc54" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">当状态为<code class="fe mt mu mv mj b">online</code>时我们显示<code class="fe mt mu mv mj b">stop</code>动作，当状态为<code class="fe mt mu mv mj b">stopped</code>时我们显示<code class="fe mt mu mv mj b">start</code>动作。<code class="fe mt mu mv mj b">restart</code>动作按钮始终显示。</p><p id="08d0" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">现在，停止您的开发服务器(如果正在运行)，在终端中提供<code class="fe mt mu mv mj b">SCRIPT_PATH</code>，然后再次启动开发服务器:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c3c6" class="mn lc in mj b gy mo mp l mq mr">$ export SCRIPT_PATH=you/scripts/directory<br/>$ npm run dev</span><span id="1829" class="mn lc in mj b gy ms mp l mq mr">&gt; ts-pm2-ui@1.0.0 dev<br/>&gt; ts-node-dev --respawn --transpile-only ./src/app.ts</span><span id="f9ec" class="mn lc in mj b gy ms mp l mq mr">[INFO] 16:47:15 ts-node-dev ver. 1.1.6 (using ts-node ver. 9.1.1, typescript ver. 4.2.4)<br/>[Server] Listening on :3000</span></pre><p id="1078" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">对我来说，<code class="fe mt mu mv mj b">miner01.js</code>和<code class="fe mt mu mv mj b">miner02.js</code>都是简单的脚本:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="fe20" class="mn lc in mj b gy mo mp l mq mr">// miner01.js<br/>setInterval(() =&gt; {<br/>  console.log('I am miner001!');<br/>}, 1000);</span><span id="c040" class="mn lc in mj b gy ms mp l mq mr">// miner02.js<br/>setInterval(function () {<br/>  console.log("I am miner002!");<br/>  for (var i = 0; i &lt; 9999; i++) {<br/>    Math.random();<br/>  }<br/>  console.log("Detect a block on chanel: " + Math.random());<br/>}, 2000);</span></pre><p id="2a9f" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">访问<a class="ae kx" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，在正常情况下，您会看到如下内容:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/0a6223eefa8f9043fde3e6257b999f37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q47RzIoaXzL2O43rvX_dmw.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Process status table</figcaption></figure><p id="0241" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">试着“开始”一个过程:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/1e1672f68ed8a87ca5229f9294de68fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEDpdyK2c7vWm3S4TI7Hyg.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Process started</figcaption></figure><p id="a19b" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">查看PM2国家气候中心</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5643" class="mn lc in mj b gy mo mp l mq mr">$ pm2 ls</span></pre><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/05babad2450e70ab353f7459a4f59c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p5sUJUb1hb6UwrJQweuNYw.png"/></div></div></figure><p id="a13f" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">这就是全部！</p><p id="4570" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">如果你需要一个更方便的特性，我们来看下一部分。</p><h1 id="7906" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用套接字显示进程日志。超正析象管(Image Orthicon)</h1><p id="0842" class="pw-post-body-paragraph jy jz in kb b kc lz ke kf kg ma ki kj ky mb km kn kz mc kq kr la md ku kv kw ig bi translated">在这一部分中，我们将尝试将一个进程stdout日志流发送到客户端。</p><p id="0a13" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">我们将使用<code class="fe mt mu mv mj b">socket.io</code>将日志实时发送到客户端。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6af2" class="mn lc in mj b gy mo mp l mq mr">$ npm install socket.io -S<br/>$ npm install @types/socket.io -D</span></pre><p id="e5b6" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">使用PM2的launchBus获取进程stdout日志:更新<code class="fe mt mu mv mj b">./src/pm2Lib.ts</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1262" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">创建<code class="fe mt mu mv mj b">./src/socketIO.ts</code>创建socket.io服务器:</p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5192" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">从<code class="fe mt mu mv mj b">pm2Lib.onLogOut</code>获取任何日志事件时始终发出<code class="fe mt mu mv mj b">process_name:out_log</code>事件。</p><p id="ff34" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">用express服务器启动socket.io服务器:更新<code class="fe mt mu mv mj b">./src/app.ts</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="a3a0" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">然后，更新客户端以连接到套接字服务器:</p><p id="2fad" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">./public/index.html</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="5f69" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><code class="fe mt mu mv mj b">./public/js/main.js</code></p><figure class="me mf mg mh gt jo"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="792a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">重新加载浏览器，并尝试跟踪进程日志:</p><figure class="me mf mg mh gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/97ab818a6ecca663b40eb42330fd62fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01bNGiy5Pj8B2Ehv7g5VLA.png"/></div></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Show process logs</figcaption></figure><h1 id="b86e" class="lb lc in bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">摘要</h1><p id="c65f" class="pw-post-body-paragraph jy jz in kb b kc lz ke kf kg ma ki kj ky mb km kn kz mc kq kr la md ku kv kw ig bi translated">我们完成了一个使用PM2 API构建过程管理器web应用程序的示例。我希望我的文章能为你提出一些“关键词”，你能更好地在你的系统中实现这些东西。</p><p id="fb31" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">本项目已完成的规范已在<a class="ae kx" href="https://github.com/codetheworld-io/ts-pm2-ui" rel="noopener ugc nofollow" target="_blank"> Github </a>上发布。</p><p id="b96a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated">感谢阅读！</p><p id="fc66" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj ky kl km kn kz kp kq kr la kt ku kv kw ig bi translated"><em class="ka">更多内容参见</em> <a class="ae kx" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ka">通俗易懂</em> </a></p></div></div>    
</body>
</html>