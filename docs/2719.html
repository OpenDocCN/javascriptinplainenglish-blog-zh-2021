<html>
<head>
<title>Advanced Angular Structural Directive to Render Long Lists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">呈现长列表的高级角度结构指令</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/advanced-angular-structural-directive-to-render-long-lists-db1575d761ce?source=collection_archive---------2-----------------------#2021-06-04">https://javascript.plainenglish.io/advanced-angular-structural-directive-to-render-long-lists-db1575d761ce?source=collection_archive---------2-----------------------#2021-06-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1df5" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">本文向您展示了如何创建一个类似于Angular自己的ngFor的高级结构指令，并使用渐进式渲染概念来渲染一个长列表。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/9b0354044f51748c93416140665b9833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aGM6iSsFUR8YFKmyv8e9eQ.jpeg"/></div></div></figure><h2 id="5c29" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">先决条件</h2><p id="fa63" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">对JavaScript和Angular有基本的了解。</p><h2 id="cc10" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">设置和简要结构指令复习。</h2><p id="b8ec" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我们计划在我们的组件中使用这样的指令。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="7ad6" class="ko kp in me b gy mi mj l mk ml">&lt;ul&gt;<br/>  &lt;li *ngxtFor="<br/>      let item of longList; <br/>      itemsAtOnce: 500;<br/>      intervalLength: 50"&gt;<br/>   Item - {{item.id}}<br/>  &lt;/li&gt;<br/>&lt;/ul&gt;</span></pre><p id="dfe5" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">指令中的“*”语法基本上是告诉angular将元素包装在ngTemplate中，而不是立即呈现它。然后，我们可以通过注入<code class="fe mr ms mt me b">TemplateRef</code>和<code class="fe mr ms mt me b">ViewContainer</code>服务来访问指令中的模板，并使用我们的定制逻辑来呈现模板。</p><p id="9f04" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated"><code class="fe mr ms mt me b">itemsAtOnce</code>和<code class="fe mr ms mt me b">intervalLength</code>将是输入，指定一次应该渲染多少个项目，以及在渲染之前应该等待多长时间。</p><p id="5b98" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">接下来，在我们的应用程序组件中，我们创建一个包含50000个项目的列表。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="9a99" class="ko kp in me b gy mi mj l mk ml">ngOnInit() {<br/>   const longList = [];<br/>   for (let i = 0; i &lt; 50000; i++) {<br/>     longList.push({ id: i });<br/>   }<br/>   this.longList = longList;<br/>}</span></pre><p id="0ea3" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">这就是我们应用组件的全部内容。接下来让我们开始创建我们的指令。我们将首先从没有任何逻辑的基本结构开始。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c668" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated"><code class="fe mr ms mt me b">ngxtForOf</code>输入中的<code class="fe mr ms mt me b">of</code>让我们可以在指令中使用<code class="fe mr ms mt me b">let items of items</code>语法。其他输入也必须以指令的选择器为前缀，以便在第一个代码片段中显示的语法中使用。</p><p id="10f7" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">如果你对结构指令完全陌生，你可以在这里参考<a class="ae mw" href="https://angular.io/guide/structural-directives" rel="noopener ugc nofollow" target="_blank">关于结构指令的角度指南</a></p><h1 id="9df9" class="mx kp in bd kq my mz na kt nb nc nd kw jt ne ju la jw nf jx le jz ng ka li nh bi translated">介绍iterable differents<code class="fe mr ms mt me b"> angular service.</code></h1><p id="ce04" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">此时，我们可以使用<code class="fe mr ms mt me b">ngOnInit</code>处理程序中的<code class="fe mr ms mt me b">viewContainer.createEmbeddedView</code>方法来获取项目并呈现它们，但是如果项目被添加到列表中或者被从列表中移除，这将不起作用。这就是<code class="fe mr ms mt me b"><a class="ae mw" href="https://angular.io/api/core/IterableDiffers" rel="noopener ugc nofollow" target="_blank">IterableDiffers</a></code>出现的原因。它为我们提供了一种不同的策略，使用这种策略，我们可以在列表中添加或删除项目时处理场景，而不必自己编写逻辑。让我们把它加到我们的指令里。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c79f" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">如上所述，当我们接收到条目时，我们正在创建一个<code class="fe mr ms mt me b">IterableDiffer.</code>的实例，这是我们在列表中添加/删除条目时将使用的。</p><p id="cd3c" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated"><code class="fe mr ms mt me b">IterableDiffers.find(items)</code>将检查Angular是否有一个为传递给它的项目提供不同策略的<code class="fe mr ms mt me b">IterableFactory</code>。在我们的例子中，<code class="fe mr ms mt me b">items</code>是可迭代的，Angular有一个工厂。所以会被退回。然后我们调用工厂上<code class="fe mr ms mt me b">create</code>来获得<code class="fe mr ms mt me b">IterableDiffer</code>的实例，它可以用来区分列表。</p><p id="c344" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">需要注意的重要一点是<code class="fe mr ms mt me b">forEachAddedItem</code>和<code class="fe mr ms mt me b">forEachRemovedItem</code>在<code class="fe mr ms mt me b"><a class="ae mw" href="https://angular.io/api/core/IterableChangeRecord" rel="noopener ugc nofollow" target="_blank">IterableRecord</a></code>对象上迭代。除了列表项本身之外，它们还包含许多附加信息。我们将使用<code class="fe mr ms mt me b">currentIndex</code>属性来确保从正确的索引中添加/删除模板引用。</p><p id="d5cb" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">想了解更多关于Angular中<code class="fe mr ms mt me b">IterableDiffers</code>的信息，请参考这篇<a class="ae mw" href="https://netbasal.com/getting-to-know-angular-differs-60cd68f4bd8f" rel="noopener ugc nofollow" target="_blank">精彩文章</a></p><h1 id="e7fd" class="mx kp in bd kq my mz na kt nb nc nd kw jt ne ju la jw nf jx le jz ng ka li nh bi translated">最后一步:添加逐步呈现列表的逻辑。</h1><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="d6e5" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">现在我们已经把所有的部分都整合在一起了。<code class="fe mr ms mt me b">progressiveRender</code>方法获取<code class="fe mr ms mt me b">IterableChangeRecord</code>对象的数组，并根据输入将它传递给<code class="fe mr ms mt me b">renderItems</code>方法，每次传递固定数量的项。该方法使用<code class="fe mr ms mt me b">createEmbeddedView</code>方法在DOM上创建它们，您可能已经在简单的结构化指令中见过这种方法。</p><p id="257a" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">注意<code class="fe mr ms mt me b">createEmbeddedView</code>的第三个参数。这个<code class="fe mr ms mt me b">index</code>参数确保当列表项被移除或替换时，项目被呈现在正确的位置。</p><p id="f78c" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated"><code class="fe mr ms mt me b">viewRefsMap</code>是一个私有映射，指令使用它来存储对嵌入式视图对象的引用。当处理列表项时，它会被填充。当视图项目从我们的应用程序组件的列表中删除时，这个映射在<code class="fe mr ms mt me b">ngDoCheck</code>中被用来删除视图项目</p><h1 id="1403" class="mx kp in bd kq my mz na kt nb nc nd kw jt ne ju la jw nf jx le jz ng ka li nh bi translated">请参见stackblitz上的这条指令。</h1><p id="9310" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">当使用我们的自定义指令和内置的<code class="fe mr ms mt me b">ngFor</code>指令呈现一个大的列表时，您可以看到性能上的差异。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ni mv l"/></div></figure><h1 id="478c" class="mx kp in bd kq my mz na kt nb nc nd kw jt ne ju la jw nf jx le jz ng ka li nh bi translated">参考</h1><p id="0c12" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我从这篇由<a class="ae mw" href="https://medium.com/@.gc?source=post_page-----9f4dcb9b65--------------------------------" rel="noopener">詹卡洛·布姆普利斯科</a>写的文章中得到了渐进渲染的想法</p><div class="nj nk gp gr nl nm"><a href="https://blog.bitsrc.io/3-ways-to-render-large-lists-in-angular-9f4dcb9b65" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd io gy z fp nr fr fs ns fu fw im bi translated">在Angular中呈现大列表的3种方法</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">使用角度呈现大型项目列表的可用技术概述</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">blog.bitsrc.io</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa km nm"/></div></div></a></div><p id="e37e" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated">感谢Yoni Amishav 撰写了关于如何构建我自己的ngFor指令的精彩文章。</p><div class="nj nk gp gr nl nm"><a href="https://www.talkinghightech.com/en/create-ngfor-directive/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd io gy z fp nr fr fs ns fu fw im bi translated">如何创建自己的NgFor指令？说话的高科技</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">学习Angular框架的内部有时会经历一些基本概念，有时会经历大部分…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">www.talkinghightech.com</p></div></div><div class="nv l"><div class="ob l nx ny nz nv oa km nm"/></div></div></a></div><h1 id="cb19" class="mx kp in bd kq my mz na kt nb nc nd kw jt ne ju la jw nf jx le jz ng ka li nh bi translated">结论</h1><p id="94c6" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">在本文中，我们已经讨论了许多高级主题。我希望阅读这篇文章的每个人都觉得它很有用，并能从中受益。这是我写的第一篇关于媒体的文章，我写得很开心。如果你喜欢，那么请在<a class="ae mw" href="https://medium.com/@sanjaylbhavnani" rel="noopener"> Medium </a>上关注我，因为我计划继续写更多关于Angular、TypeScript和JavaScript的文章。</p><p id="b078" class="pw-post-body-paragraph lk ll in lm b ln mm jo lp lq mn jr ls kx mo lu lv lb mp lx ly lf mq ma mb mc ig bi translated"><em class="oc">更多内容尽在</em><a class="ae mw" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="oc">plain English . io</em></strong></a></p></div></div>    
</body>
</html>