<html>
<head>
<title>Firebase Remote Config with React Navigation 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带React导航5的Firebase远程配置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/firebase-remote-config-with-react-navigation-5-b430e0d7f39?source=collection_archive---------5-----------------------#2021-02-25">https://javascript.plainenglish.io/firebase-remote-config-with-react-navigation-5-b430e0d7f39?source=collection_archive---------5-----------------------#2021-02-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="912b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">改变你的应用程序的行为和外观，无需发布应用程序更新，对无限的每日活跃用户免费。</em>这种技术被称为远程配置<strong class="jm io"> Firebase </strong>也提供了<strong class="jm io">远程配置</strong>功能。</p><p id="1f48" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您不熟悉<strong class="jm io"> Firebase远程配置用例</strong>以及它如何帮助您节省数周/数月的工作量，您可以考虑阅读<a class="ae kj" href="https://medium.com/trendyol-tech/exploring-firebase-remote-config-3d3bcd26494a" rel="noopener">探索Firebase远程配置</a>。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/14471773ee6e63cda7993003f230bfc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oM9b1dzY330bNDNdY4Zb2g.png"/></div></div></figure><p id="3964" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将探索Firebase远程配置的最简单而复杂的用例:<strong class="jm io"> <em class="ki">危机时刻的开关— </em> </strong>众所周知，危机会在最意想不到的时刻爆发，利用远程配置作为一个<strong class="jm io"> <em class="ki">终止开关</em> </strong>或者至少是一个<strong class="jm io"> <em class="ki">关闭开关</em> </strong>让您喘口气😅。</p><p id="8fcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，让我们继续使用React Navigation 5实现Firebase远程配置，以便在危机时刻通过单击来<em class="ki">控制应用程序的行为。</em></p><h2 id="e4cd" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">先决条件</h2><ol class=""><li id="f651" class="lp lq in jm b jn lr jr ls jv lt jz lu kd lv kh lw lx ly lz bi translated"><strong class="jm io">反应原生</strong></li></ol><p id="6e52" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您已经熟悉React Native，那么您将能够快速使用React导航和React Native Firebase！如果没有，你可能想先阅读第1到第4部分(包括第1和第4部分),然后在完成后回到这里。</p><p id="4ce7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">2.<strong class="jm io">反应导航</strong></p><p id="ac4a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">要在React原生应用中进行路由和导航，请跟随并尝试使用<a class="ae kj" href="https://betterprogramming.pub/react-navigation-5-stack-tab-drawer-all-in-one-ead723188056" rel="noopener ugc nofollow" target="_blank"> React导航5 </a>。它应该足以让您知道如何构建典型的小型移动应用程序，并为您提供深入研究React导航的更高级部分所需的背景知识。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><h2 id="7b7f" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">反应本机Firebase-服务器端或在Firebase控制台中</h2><p id="a953" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">如果您完成了上述要求，那么打开Firebase项目控制台并导航到远程配置页面。(在接合下的左侧抽屉中)</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mk"><img src="../Images/3b2fcad7e5dac36bd42e1b6b949dc009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A56Oj7qjD7O4C0GlAUcu3A.png"/></div></div></figure><p id="f827" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，您将看到一个名为添加参数的窗口，其中包含两个主字段<code class="fe ml mm mn mo b">Parameter Key</code>和<code class="fe ml mm mn mo b">Default value</code></p><p id="d1f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在命名<strong class="jm io">参数键</strong>时要小心，因为我们的应用程序将使用相同的键来获取数据。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mp"><img src="../Images/da62f8d8b2ff19b32fb127eb8037d369.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDNSuEBTQutXb7aiQ85ddw.png"/></div></div></figure><p id="fe2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于我们的<strong class="jm io"> <em class="ki"> kill switch </em> </strong>用例，我们将创建1个名为<code class="fe ml mm mn mo b">IS_APPLICATION_ON</code>的布尔<strong class="jm io">参数<em class="ki"> </em> </strong>，并将其值指定为true。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mq"><img src="../Images/75c9f811e3fd3cbeafe1021c03df9fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CWegbV4Wq9NbFsAFAR1F7g.png"/></div></div></figure><p id="231a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建所需参数后，点击<strong class="jm io">发布变更</strong>，您将得到一个确认提示<em class="ki">“一旦发布，变更将</em> <strong class="jm io"> <em class="ki">立即对您的应用和用户可用</em></strong><em class="ki">”</em>——但我们尚未连接应用，因此只需按OK即可。已发布的更改将如下所示:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mr"><img src="../Images/349fc0d2e62c2ef00d76ba3a5136953b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26Y2vl98_m_GotflWFaAng.png"/></div></div></figure><p id="ce00" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经完成了服务器端的配置。让我们转到客户端——React原生代码库。</p></div><div class="ab cl ma mb hr mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ig ih ii ij ik"><p id="3881" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们检查一下React本地应用程序代码库，下面是目录结构:</p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="33d1" class="kw kx in mo b gy mw mx l my mz">todo-app<br/>--&gt; android<br/>--&gt; ios<br/>--&gt; index.js<br/>--&gt; src<br/>-- --&gt; App.container.js<br/>-- --&gt; routes<br/>-- -- --&gt; home.route.js<br/>-- -- --&gt; index.route.js<br/>-- ...</span></pre><p id="cb10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> index.js </strong></p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="54a9" class="kw kx in mo b gy mw mx l my mz">import React, { Component } from 'react';<br/>import { AppRegistry } from 'react-native';<br/>import { Provider } from 'react-redux';<br/>import { store } from './src/stores';<br/>import App from './src/App.container';<br/>import { name as appName } from './app.json';</span><span id="0668" class="kw kx in mo b gy na mx l my mz">export default class todoApp extends Component {<br/>    render() {<br/>        return (<br/>            &lt;Provider store={store}&gt;<br/>            &lt;App /&gt;<br/>            &lt;/Provider&gt;<br/>        );<br/>    }<br/>}</span><span id="c1ed" class="kw kx in mo b gy na mx l my mz">AppRegistry.registerComponent(appName, () =&gt; todoApp);</span></pre><p id="9993" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">应用程序.容器. js </strong></p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="5956" class="kw kx in mo b gy mw mx l my mz">import 'react-native-gesture-handler';<br/>import React from 'react';<br/>import { StatusBar, View } from 'react-native';<br/>import Proptypes from 'prop-types';<br/>import { connect } from 'react-redux';<br/>import { Route } from './routes/index.route';<br/>import { enableScreens } from 'react-native-screens';<br/>import { result } from 'lodash';<br/>import { OverlaySpinner } from './components';<br/>import { appContainerStyle, statusBarStyle } from './themes/application.styles';</span><span id="e6cc" class="kw kx in mo b gy na mx l my mz">enableScreens();</span><span id="fd55" class="kw kx in mo b gy na mx l my mz">const App = ({ showSpinner }) =&gt; {<br/>    return (<br/>        &lt;View style={appContainerStyle}&gt;<br/>            &lt;StatusBar translucent {...statusBarStyle} /&gt;<br/>            &lt;Route /&gt;<br/>            &lt;OverlaySpinner showSpinner={showSpinner} /&gt;<br/>        &lt;/View&gt;<br/>    );<br/>};</span><span id="af5f" class="kw kx in mo b gy na mx l my mz">App.defaultProps = {<br/>    showSpinner: 0<br/>};</span><span id="2eb6" class="kw kx in mo b gy na mx l my mz">App.propTypes = {<br/>    showSpinner: Proptypes.number.isRequired<br/>};</span><span id="6d12" class="kw kx in mo b gy na mx l my mz">export const mapStateToProps = ({ spinner }) =&gt; ({<br/>    showSpinner: result(spinner, 'count', 0)<br/>});</span><span id="fb5d" class="kw kx in mo b gy na mx l my mz">export default connect(mapStateToProps, null)(App);</span></pre><p id="5418" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> index.route.js </strong></p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="e900" class="kw kx in mo b gy mw mx l my mz">import React from 'react';<br/>import { NavigationContainer } from '@react-navigation/native';<br/>import HomeScreens from './home.route';</span><span id="239d" class="kw kx in mo b gy na mx l my mz">export const Route = () =&gt; {<br/>    return (<br/>        &lt;NavigationContainer&gt;<br/>            &lt;HomeScreens options={{ animationEnabled: false }} /&gt;<br/>        &lt;/NavigationContainer&gt;<br/>    );<br/>};</span></pre><p id="5842" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> home.route.js </strong></p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="40b4" class="kw kx in mo b gy mw mx l my mz">import React from 'react';<br/>import { createStackNavigator } from '@react-navigation/stack';<br/>import Announcements from '../screens/Announcements/Announcements.screen';<br/>import Home from '../screens/Home/Home.screen';<br/>import { colors, fonts } from '../themes/constants.styles';</span><span id="ac44" class="kw kx in mo b gy na mx l my mz">const Stack = createStackNavigator();<br/>const HomeStack = createStackNavigator();</span><span id="a08f" class="kw kx in mo b gy na mx l my mz">const HomeScreens = () =&gt; (<br/>    &lt;HomeStack.Navigator<br/>        screenOptions={() =&gt; ({<br/>            headerStyle: {<br/>            backgroundColor: colors.PRIMARY_HEADER_BG<br/>        },<br/>        headerTitleStyle: {<br/>            color: colors.PRIMARY_APP_BG,<br/>            fontSize: fonts.FONT_SIZE_XL,<br/>            fontFamily: fonts.FONT_FAMILY_BOLD<br/>        }<br/>        })}&gt;<br/>        &lt;Stack.Screen<br/>            name='Home'<br/>            component={Home}<br/>            options={{<br/>                title: "Let's Todo"<br/>            }}<br/>        /&gt;       <br/>        &lt;Stack.Screen<br/>            name='Announcements'<br/>            component={Announcements}<br/>            options={{<br/>                title: "What's New?"<br/>            }} <br/>        /&gt;<br/>    &lt;/HomeStack.Navigator&gt;<br/>);</span><span id="4659" class="kw kx in mo b gy na mx l my mz">export default HomeScreens;</span></pre><p id="38b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们的todoApp使用React Navigation 5设置了基本路线。让我们从React Native Firebase开始。</p><h2 id="e739" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">React Native Firebase —客户端或应用程序中</h2><p id="3ad3" class="pw-post-body-paragraph jk jl in jm b jn lr jp jq jr ls jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">请按照React Native Firebase <a class="ae kj" href="https://rnfirebase.io/" rel="noopener ugc nofollow" target="_blank">入门指南</a>添加所需的包和附加条件:</p><ul class=""><li id="78ea" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated"><a class="ae kj" href="https://rnfirebase.io/#1-install-via-npm" rel="noopener ugc nofollow" target="_blank">安装核心包</a> — <code class="fe ml mm mn mo b">@react-native-firebase/app</code></li><li id="fda2" class="lp lq in jm b jn nf jr ng jv nh jz ni kd nj kh ne lx ly lz bi translated"><a class="ae kj" href="https://rnfirebase.io/analytics/usage" rel="noopener ugc nofollow" target="_blank">安装分析包</a>——<code class="fe ml mm mn mo b">@react-native-firebase/analytics</code></li><li id="183c" class="lp lq in jm b jn nf jr ng jv nh jz ni kd nj kh ne lx ly lz bi translated"><a class="ae kj" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">创建新的Firebase项目</a></li><li id="9311" class="lp lq in jm b jn nf jr ng jv nh jz ni kd nj kh ne lx ly lz bi translated"><a class="ae kj" href="https://rnfirebase.io/#2-android-setup" rel="noopener ugc nofollow" target="_blank">安卓设置</a></li><li id="37c3" class="lp lq in jm b jn nf jr ng jv nh jz ni kd nj kh ne lx ly lz bi translated"><a class="ae kj" href="https://rnfirebase.io/#3-ios-setup" rel="noopener ugc nofollow" target="_blank"> iOS设置</a></li><li id="5a27" class="lp lq in jm b jn nf jr ng jv nh jz ni kd nj kh ne lx ly lz bi translated"><a class="ae kj" href="https://rnfirebase.io/#4-autolinking--rebuilding" rel="noopener ugc nofollow" target="_blank">自动链接&amp;重建</a></li></ul><p id="f96e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在通常的Firebase设置(将todoApp添加到Firebase项目并粘贴<code class="fe ml mm mn mo b">google-services.json</code>文件)之后，添加<a class="ae kj" href="https://rnfirebase.io/remote-config/usage#installation" rel="noopener ugc nofollow" target="_blank">远程配置包</a>:</p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="9b17" class="kw kx in mo b gy mw mx l my mz"><em class="ki"># Install the remote-config module</em><br/>npm install --save @react-native-firebase/remote-config<br/><br/><em class="ki"># If you're developing your app using iOS, run this command</em><br/>cd ios/ &amp;&amp; pod install</span></pre><p id="d32c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您已经准备好在代码库中使用firebase远程配置模块了！！😎</p><ul class=""><li id="54c8" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">在<em class="ki"> todoApp/src/configs/: </em>中创建<code class="fe ml mm mn mo b">firebaseRemoteConfig.config.js</code></li></ul><blockquote class="nk nl nm"><p id="f833" class="jk jl ki jm b jn jo jp jq jr js jt ju nn jw jx jy no ka kb kc np ke kf kg kh ig bi translated"><a class="ae kj" href="https://rnfirebase.io/remote-config/usage#caching" rel="noopener ugc nofollow" target="_blank">使用</a> <code class="fe ml mm mn mo b"><a class="ae kj" href="https://rnfirebase.io/remote-config/usage#caching" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">FETCH_INTERVAL</strong></a></code> <a class="ae kj" href="https://rnfirebase.io/remote-config/usage#caching" rel="noopener ugc nofollow" target="_blank">定义缓存远程配置的持续时间:</a></p><p id="f59d" class="jk jl ki jm b jn jo jp jq jr js jt ju nn jw jx jy no ka kb kc np ke kf kg kh ig bi translated">在应用程序开发期间，您可能希望非常频繁地刷新缓存(每小时多次),以便在开发和测试应用程序时快速迭代</p><p id="41c3" class="jk jl ki jm b jn jo jp jq jr js jt ju nn jw jx jy no ka kb kc np ke kf kg kh ig bi translated"><strong class="jm io">远程配置的默认和推荐生产获取间隔是12小时，</strong>这意味着在12小时的窗口内，配置不会从后端获取超过一次，无论实际进行了多少次获取调用。</p></blockquote><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="3c03" class="kw kx in mo b gy mw mx l my mz">// data is locally cached for FETCH_INTERVAL in seconds<br/>export const FETCH_INTERVAL = 43200;</span><span id="302e" class="kw kx in mo b gy na mx l my mz">// Feature names constants, use them to reference to a feature<br/>export const IS_APPLICATION_ON = 'IS_APPLICATION_ON';</span><span id="34b3" class="kw kx in mo b gy na mx l my mz">const config = {};<br/>config[IS_APPLICATION_ON] = false;</span><span id="080b" class="kw kx in mo b gy na mx l my mz">export default config;</span></pre><ul class=""><li id="1854" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">在<em class="ki"> todoApp/src/utils/: </em>中创建<code class="fe ml mm mn mo b">firebase.util.js</code></li></ul><blockquote class="nk nl nm"><p id="3799" class="jk jl ki jm b jn jo jp jq jr js jt ju nn jw jx jy no ka kb kc np ke kf kg kh ig bi translated">检查<a class="ae kj" href="https://rnfirebase.io/reference/remote-config" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Firebase RemoteConfig服务接口</strong> </a>了解可用的方法、语法和用法，例如:<code class="fe ml mm mn mo b">setDefaults()</code>、<code class="fe ml mm mn mo b">fetch()</code>、<code class="fe ml mm mn mo b">activate()</code>、<code class="fe ml mm mn mo b">getAll()</code>、<code class="fe ml mm mn mo b">asBoolean()</code>等。</p></blockquote><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="adc3" class="kw kx in mo b gy mw mx l my mz">import remoteConfig from '@react-native-firebase/remote-config';<br/>import firebaseRemoteConfig, {<br/>    FETCH_INTERVAL<br/>} from '../config/firebaseRemoteConfig.config';</span><span id="06ea" class="kw kx in mo b gy na mx l my mz">// set defaults<br/>remoteConfig().setDefaults(firebaseRemoteConfig);</span><span id="1f19" class="kw kx in mo b gy na mx l my mz">// fetch remote config<br/>export const fetchRemoteConfig = () =&gt; {</span><span id="8f2a" class="kw kx in mo b gy na mx l my mz">    // data is locally cached for FETCH_INTERVAL<br/>    const fetch = remoteConfig().fetch(FETCH_INTERVAL);<br/>    return fetch<br/>        .then(() =&gt; remoteConfig().activate())<br/>        .then(() =&gt; {<br/>            return remoteConfig().getAll();<br/>        })<br/>        .then(snapshot =&gt; {<br/>            return {<br/>                IS_APPLICATION_ON: snapshot<br/>                    .IS_APPLICATION_ON<br/>                    .asBoolean()<br/>            };<br/>        })<br/>        .catch(() =&gt; firebaseRemoteConfig);<br/>};</span><span id="2e4e" class="kw kx in mo b gy na mx l my mz">export default fetchRemoteConfig;</span></pre><ul class=""><li id="154c" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">在<em class="ki">to doapp/src/stores/actions:</em>内创建<code class="fe ml mm mn mo b">firebase.action.js</code></li></ul><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="3b7e" class="kw kx in mo b gy mw mx l my mz">import { createAction } from 'redux-actions';<br/>import { fetchRemoteConfig } from '../../utils/firebase.util';<br/>import { showSpinner, hideSpinner } from './spinner.action';<br/>export const SET_FIREBASE_REMOTE_CONFIG = 'SET_FIREBASE_REMOTE_CONFIG';<br/>export const setFirebaseRemoteConfig = createAction(SET_FIREBASE_REMOTE_CONFIG);</span><span id="f5fd" class="kw kx in mo b gy na mx l my mz">export const initializeFirebase = () =&gt; async dispatch =&gt; {<br/>    try {<br/>        dispatch(showSpinner());<br/>        const firebaseRemoteConfigData = await fetchRemoteConfig();<br/>        dispatch(setFirebaseRemoteConfig(firebaseRemoteConfigData));<br/>        dispatch(hideSpinner());<br/>    } catch (error) {<br/>        console.log('Firebase init error', error);<br/>    }<br/>};</span></pre><ul class=""><li id="4ac3" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">在<em class="ki">中创建<code class="fe ml mm mn mo b">firebase.reducer.js</code>todo app/src/stores/reducers:</em></li></ul><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="9b1e" class="kw kx in mo b gy mw mx l my mz">import RemoteConfigDefault from '../../config/firebaseRemoteConfig.config';</span><span id="a260" class="kw kx in mo b gy na mx l my mz">const initialState = { ...RemoteConfigDefault };</span><span id="92c8" class="kw kx in mo b gy na mx l my mz">export const firebase = (state = initialState, action) =&gt; {<br/>    const { payload } = action;<br/>    switch (action.type) {<br/>        case 'SET_FIREBASE_REMOTE_CONFIG':<br/>            return { ...payload };<br/>        default:<br/>            return state;<br/>    }<br/>};</span><span id="7bbf" class="kw kx in mo b gy na mx l my mz">export default firebase;</span></pre><ul class=""><li id="f78f" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">现在在<code class="fe ml mm mn mo b">App.container.js</code>中，获取远程配置，如下所示:</li></ul><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="9670" class="kw kx in mo b gy mw mx l my mz">import 'react-native-gesture-handler';<br/>import React, <strong class="mo io">{ useEffect }</strong> from 'react';<br/>import { StatusBar, View } from 'react-native';<br/>import Proptypes from 'prop-types';<br/>import { connect } from 'react-redux';<br/>import { Route } from './routes/index.route';<br/>import { enableScreens } from 'react-native-screens';<br/>import { noop, result } from 'lodash';<br/>import { OverlaySpinner } from './components';<br/><strong class="mo io">import { initializeFirebase } from './stores/actions/firebase.action';</strong><br/>import { appContainerStyle, statusBarStyle } from './themes/application.styles';</span><span id="48d7" class="kw kx in mo b gy na mx l my mz">enableScreens();</span><span id="e0f9" class="kw kx in mo b gy na mx l my mz">const App = ({ showSpinner, fetchFirebaseConfig }) =&gt; {</span><span id="1ee7" class="kw kx in mo b gy na mx l my mz"><strong class="mo io">    useEffect(() =&gt; {<br/>        fetchFirebaseConfig();<br/>    }, [fetchFirebaseConfig]);</strong></span><span id="35af" class="kw kx in mo b gy na mx l my mz">    return (<br/>        &lt;View style={appContainerStyle}&gt;<br/>            &lt;StatusBar translucent {...statusBarStyle} /&gt;<br/>            &lt;Route /&gt;<br/>            &lt;OverlaySpinner showSpinner={showSpinner} /&gt;<br/>        &lt;/View&gt;<br/>    );<br/>};</span><span id="fa49" class="kw kx in mo b gy na mx l my mz">App.defaultProps = {<br/>    showSpinner: 0,<br/>    <strong class="mo io">fetchFirebaseConfig: noop</strong><br/>};</span><span id="9e76" class="kw kx in mo b gy na mx l my mz">App.propTypes = {<br/>    showSpinner: Proptypes.number.isRequired,<br/>    <strong class="mo io">fetchFirebaseConfig: Proptypes.func.isRequired</strong><br/>};</span><span id="439f" class="kw kx in mo b gy na mx l my mz">export const mapStateToProps = ({ spinner }) =&gt; ({<br/>    showSpinner: result(spinner, 'count', 0)<br/>});</span><span id="0508" class="kw kx in mo b gy na mx l my mz"><strong class="mo io">export const mapDispatchToProps = dispatch =&gt; ({<br/>    fetchFirebaseConfig: () =&gt; dispatch(initializeFirebase())<br/>});</strong></span><span id="57b3" class="kw kx in mo b gy na mx l my mz">export default connect(mapStateToProps, <strong class="mo io">mapDispatchToProps</strong>)(App);</span></pre><p id="e8a5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">远程配置现在在redux store中可用。让我们用它来实现<strong class="jm io"> kill switch </strong>搭配React导航5。</p><p id="050f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<code class="fe ml mm mn mo b">react-redux</code>包中可用的<code class="fe ml mm mn mo b">useSelector</code>模块从redux存储中读取<code class="fe ml mm mn mo b">IS_APPLICATION_ON</code>的值。</p><p id="0e3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将根据远程配置参数<code class="fe ml mm mn mo b">isApplicationOn</code>添加条件，仅在<code class="fe ml mm mn mo b">NavigationContainer</code>内注入<code class="fe ml mm mn mo b">MaintenanceScreens</code>堆栈。</p><ul class=""><li id="1f16" class="lp lq in jm b jn jo jr js jv nb jz nc kd nd kh ne lx ly lz bi translated">修改<code class="fe ml mm mn mo b">index.route.js</code>如下图所示:</li></ul><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="6679" class="kw kx in mo b gy mw mx l my mz">import React from 'react';<br/>import { NavigationContainer } from '@react-navigation/native';<br/><strong class="mo io">import { useSelector } from 'react-redux';</strong><br/>import HomeScreens from './home.route';<br/><strong class="mo io">import MaintenanceScreens from './appMaintenance.route';</strong></span><span id="390c" class="kw kx in mo b gy na mx l my mz">export const Route = () =&gt; {</span><span id="5838" class="kw kx in mo b gy na mx l my mz"><strong class="mo io">    const isApplicationOn = useSelector(<br/>        state =&gt; state.firebase[IS_APPLICATION_ON]<br/>    );</strong></span><span id="0dd1" class="kw kx in mo b gy na mx l my mz">return (<br/>        &lt;NavigationContainer&gt;<br/>            <strong class="mo io">{isApplicationOn ? (</strong><br/>                &lt;HomeScreens <br/>                    options={{ animationEnabled: false }} /&gt; <br/>            ): ( <br/>                <strong class="mo io">&lt;MaintenanceScreens <br/>                    options={{ animationEnabled: false }} /&gt;</strong><br/>            <strong class="mo io">)}</strong><br/>        &lt;/NavigationContainer&gt;<br/>    );<br/>};</span></pre><p id="e3c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其中<code class="fe ml mm mn mo b">MaintenanceScreens</code>栈相当简单，定义如下:</p><p id="fa4b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">appMaintenance.route.js</p><pre class="kl km kn ko gt ms mo mt mu aw mv bi"><span id="2f97" class="kw kx in mo b gy mw mx l my mz">import React from 'react';<br/>import { createStackNavigator } from '@react-navigation/stack';<br/>import AppMaintenance from '../screens/AppMaintenance/AppMaintenance.screen';</span><span id="752b" class="kw kx in mo b gy na mx l my mz">const Stack = createStackNavigator();<br/>const MaintenanceStack = createStackNavigator();</span><span id="640d" class="kw kx in mo b gy na mx l my mz">const MaintenanceScreens = () =&gt; (<br/>    &lt;MaintenanceStack.Navigator&gt;<br/>        &lt;Stack.Screen<br/>            name='AppMaintenance'<br/>            component={AppMaintenance}<br/>            options={{ headerShown: false }}<br/>        /&gt;<br/>    &lt;/MaintenanceStack.Navigator&gt;<br/>);</span><span id="47f5" class="kw kx in mo b gy na mx l my mz">export default MaintenanceScreens;</span></pre><p id="963a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Tada！现在，您可以在危机时刻控制您的应用程序可用性。</p><p id="dbef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，在Firebase控制台中，远程配置参数<code class="fe ml mm mn mo b">IS_APPLICATION_ON</code>被设置为<code class="fe ml mm mn mo b">true</code>，因此您应该能够看到如下所示的<code class="fe ml mm mn mo b">AppScreens</code>:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/3341ee19286dcbbecde8bf7dc13ded35.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*IRjXNKzFiY8DeYZTje6d2g.png"/></div></figure><p id="fc68" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们试着从Firebase控制台关闭应用程序:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi mq"><img src="../Images/38af35dd02a04df296ebb255462afa78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhgCZweECXmhSoIKJN4KNg.png"/></div></div></figure><p id="aad2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦您发布这些更改，下次应用程序获取远程配置**时，它将重定向到维护堆栈，用户将无法导航到任何其他屏幕或使用应用程序中的任何功能—“<strong class="jm io">应用程序正在维护中！”</strong></p><p id="1f89" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">* *这取决于应用程序中设置的<code class="fe ml mm mn mo b">FETCH_INTERVAL</code>的值，例如，如果该值设置为720秒，则应用程序将在发出下一个请求之前缓存远程配置720秒。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/249c9dd7d9f7604af5e40032fa5f334b.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*_HANHrjOJbuZ9fU6MS2P5g.png"/></div></figure><p id="829e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="ki"> Firebase远程配置是一个强大的功能；</em> </strong> <em class="ki">从基本字符串到定制功能，你几乎可以配置任何你想要的东西。此外，您可以针对特定的受众，这是很棒的(将在我接下来的文章中介绍)</em></p><h2 id="9f66" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">GitHub中的项目</h2><div class="nr ns gp gr nt nu"><a href="https://github.com/apurvajain/todo-app" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">apurvajain/todo-app</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">包括:react-native ":" 0 . 63 . 4 " react-navigation及其依赖项redux、redux persist和redux thunk react…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ku nu"/></div></div></a></div><h2 id="90ce" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">参考</h2><div class="nr ns gp gr nt nu"><a href="https://firebase.google.com/docs/remote-config/" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">Firebase远程配置</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">无需发布应用程序更新，即可免费更改应用程序的行为和外观，每日活跃次数不限…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">firebase.google.com</p></div></div><div class="od l"><div class="oj l of og oh od oi ku nu"/></div></div></a></div><div class="nr ns gp gr nt nu"><a href="https://rnfirebase.io/remote-config/usage#installation" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">远程配置|反应本机Firebase</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">远程配置的安装和入门。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">rnfirebase.io</p></div></div><div class="od l"><div class="ok l of og oh od oi ku nu"/></div></div></a></div><p id="191f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望我的教程足够清楚明白，对你有帮助🙌</p></div></div>    
</body>
</html>