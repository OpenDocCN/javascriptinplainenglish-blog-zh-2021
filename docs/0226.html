<html>
<head>
<title>Visual Testing with Storybook and reg-suit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用故事书和服装进行视觉测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/visual-testing-with-storybook-and-reg-suit-82219101afb?source=collection_archive---------8-----------------------#2021-01-13">https://javascript.plainenglish.io/visual-testing-with-storybook-and-reg-suit-82219101afb?source=collection_archive---------8-----------------------#2021-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a5fd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为你的用户界面引入自动视觉测试</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/772435f2fa0c3c52527f7ab9be9f8101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mTz5HhILyP_94DaDIAPteg.png"/></div></div></figure><p id="919f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我将向你展示如何使用reg-suit进行视觉测试。</p><p id="d3a0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你的应用程序在组件和布局上可能有无数不同的状态。那么就很难找到每一个用户界面的变化，你会忘记它们应该是什么样子。</p><p id="a91e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了避免这种情况，自动UI测试对于您的工作流是必要的。</p><p id="2cd6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/reg-viz/reg-suit" rel="noopener ugc nofollow" target="_blank"> reg-suit </a>是一款视觉测试工具，允许您:</p><ul class=""><li id="d2d4" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">将用户界面更改与前一次进行比较</li><li id="b2d1" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">检查由HTML生成的报告</li><li id="1cef" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">如果用户界面发生变化，在CI服务期间获得PR通知</li></ul><h1 id="00c5" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">回购示例</h1><p id="9734" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">以下是最终代码库的参考:</p><div class="mz na gp gr nb nc"><a href="https://github.com/manakuro/reg-suit-example" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">mana kuro/reg-suit-示例</h2><div class="nj l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np kp nc"/></div></div></a></div><h1 id="7667" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">内容</h1><ul class=""><li id="b44d" class="lo lp iq kt b ku mu kx mv la nq le nr li ns lm lt lu lv lw bi translated">设置React应用程序</li><li id="5bbf" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">设置故事书</li><li id="5bc0" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">设置storycap</li><li id="9f91" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">设置注册套装</li><li id="45dd" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">建立CircleCI</li></ul></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="927b" class="mc md iq bd me mf oa mh mi mj ob ml mm jw oc jx mo jz od ka mq kc oe kd ms mt bi translated">设置React应用程序</h1><p id="0c9a" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">为了快速启动，我们使用<code class="fe of og oh oi b"><a class="ae ln" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">create-react-app</a></code>来设置React应用程序:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="4ab6" class="on md iq oi b gy oo op l oq or">npx create-react-app reg-suit-app --template typescript</span></pre><p id="d690" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装后，通过运行以下命令运行开发服务器:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="1530" class="on md iq oi b gy oo op l oq or">yarn start</span></pre><p id="a6ce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您将看到欢迎页面:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/0266d609b1dbc1817ce3793d117554a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lddDrFV5ExIfppyt.png"/></div></div><figcaption class="ot ou gj gh gi ov ow bd b be z dk">Welcome page</figcaption></figure></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><h1 id="83cc" class="mc md iq bd me mf oa mh mi mj ob ml mm jw oc jx mo jz od ka mq kc oe kd ms mt bi translated">设置故事书</h1><p id="5110" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">接下来，我们将设置故事书。</p><p id="6999" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要安装故事书，请在项目根目录下运行CLI:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="cee4" class="on md iq oi b gy oo op l oq or">npx sb init</span></pre><p id="f326" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装后，运行服务器:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="4499" class="on md iq oi b gy oo op l oq or">yarn storybook</span></pre><p id="9901" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你会看到有一些例子的页面，像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/54e2e8993be92eeab4ed04bde94a91cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAoWODzjFDb8tCYyyCuUpg.png"/></div></div></figure><h1 id="0b9d" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">设置storycap</h1><p id="180f" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">storycap是一个抓取你的故事书文件并截图的工具。使用reg-suit，需要截图来比较UI的快照。</p><p id="4882" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装它:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="7341" class="on md iq oi b gy oo op l oq or">yarn add -D storycap</span></pre><p id="a9c5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并运行故事书服务器:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="9cdb" class="on md iq oi b gy oo op l oq or">yarn storybook</span></pre><p id="96dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">另一个终端，运行storycap:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="cb41" class="on md iq oi b gy oo op l oq or">npx storycap http://localhost:6006</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/5246d7216939d9503f86a6f815dbc8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-xFUtojAEvZL18FeJO0Liw.png"/></div></div></figure><p id="7de3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">完成后，故事书组件的图像在<code class="fe of og oh oi b">__screenshots__</code>文件夹中生成。</p><p id="a2dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以用<code class="fe of og oh oi b">--serverCmd</code>选项来执行这个过程，就像这样:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="91c8" class="on md iq oi b gy oo op l oq or">npx storycap http://localhost:6006 --serverCmd "start-storybook -p 6006"</span></pre><p id="00b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是现在，上面的故事书@6.1.0出现了一些问题。</p><p id="d2d8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，我们将分离任务，并通过一个命令来运行它。</p><p id="5bce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，安装一些依赖项:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="654e" class="on md iq oi b gy oo op l oq or">yarn add -D cross-spawn</span></pre><p id="03e9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们制作脚本文件，<code class="fe of og oh oi b">scripts/storycap.js</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="ffa7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">将脚本添加到package.json:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="d020" class="on md iq oi b gy oo op l oq or">"scripts": {<br/>  ...<br/>  "screenshot": "node ./scripts/storycap.js"<br/>},</span></pre><p id="66a8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">然后运行这个:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="7da3" class="on md iq oi b gy oo op l oq or">yarn screenshot</span></pre><p id="0045" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以看到图像是以同样的方式生成的。</p><h1 id="47ae" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">设置注册套装</h1><p id="50bb" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">既然我们已经准备好了截图，那么接下来我们将设置注册套装。</p><p id="97b6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">reg-suit需要您准备:</p><ul class=""><li id="4742" class="lo lp iq kt b ku kv kx ky la lq le lr li ls lm lt lu lv lw bi translated">云存储帐户(S3或GCS)</li><li id="621b" class="lo lp iq kt b ku lx kx ly la lz le ma li mb lm lt lu lv lw bi translated">GitHub应用程序的客户端ID</li></ul><p id="12d4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我们将使用GCS作为存储服务，并在GitHub应用程序中安装reg-suit应用程序，以在您的PR上通知结果。</p><h2 id="569f" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">设置云SDK</h2><p id="f55f" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">如果您已经有一个帐户并安装了SDK，请跳过这一部分。</p><p id="f5db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了快速启动GCS，我们使用Google中提供的SDK。</p><p id="ea8d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">按照说明进行设置:</p><div class="mz na gp gr nb nc"><a href="https://cloud.google.com/sdk/docs/quickstart?hl=en" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">快速入门:云SDK入门|云SDK文档</h2><div class="nj l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">cloud.google.com</p></div></div><div class="nk l"><div class="pm l nm nn no nk np kp nc"/></div></div></a></div><p id="1191" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">或者只运行这个:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="0baf" class="on md iq oi b gy oo op l oq or">curl <a class="ae ln" href="https://sdk.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://sdk.cloud.google.com</a> | zsh</span></pre><p id="2c23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装后，初始化gcloud帐户:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="1a21" class="on md iq oi b gy oo op l oq or">gcloud init</span></pre><p id="c669" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，您可以看到配置列表:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="5ba9" class="on md iq oi b gy oo op l oq or">$ gcloud config list</span><span id="f676" class="on md iq oi b gy pn op l oq or">[core]<br/>account = xxx@gmail.com<br/>disable_usage_reporting = TrueYour active configuration is: [default]</span></pre><p id="dca7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保您的帐户已激活:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="065c" class="on md iq oi b gy oo op l oq or">$ gcloud auth list<br/>                                                <br/>Credentialed Accounts<br/>ACTIVE  ACCOUNT<br/>*       xxx@gmail.comTo set the active account, run:<br/>$ gcloud config set account `ACCOUNT`</span></pre><h2 id="6088" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">创建项目</h2><p id="e93e" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">接下来，创建一个项目。在这篇文章中，我们创建了一个名为<code class="fe of og oh oi b">my-reg-suit</code>的项目，但是你可以随意命名。</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="202e" class="on md iq oi b gy oo op l oq or">gcloud projects create my-reg-suit</span></pre><p id="97f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要使用一些Google API，我们需要启用计费设置。</p><p id="4ad3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您还没有付费帐户，请先设置它:</p><div class="mz na gp gr nb nc"><a href="https://cloud.google.com/billing/docs/how-to/manage-billing-account" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">创建、修改或关闭您的云付费帐户| Google Cloud</h2><div class="po l"><h3 class="bd b gy z fp nh fr fs ni fu fw dk translated">本文中描述的以下主题仅适用于Google Workspace帐户云计费帐户支付…</h3></div><div class="nj l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">cloud.google.com</p></div></div><div class="nk l"><div class="pp l nm nn no nk np kp nc"/></div></div></a></div><p id="0d51" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保您的账单账户:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="5faf" class="on md iq oi b gy oo op l oq or">$ gcloud beta billing accounts list</span><span id="268e" class="on md iq oi b gy pn op l oq or">ACCOUNT_ID            NAME              OPEN  MASTER_ACCOUNT_ID<br/>xxxxx-xxxxx-xxxxx  xxxx  True</span></pre><h2 id="31ec" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">启用计费帐户</h2><p id="8725" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">接下来，将您的项目与您的账单账户挂钩:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="1ae9" class="on md iq oi b gy oo op l oq or">gcloud beta billing projects link my-reg-suit --billing-account {ACCOUNT_ID}</span></pre><p id="ac14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe of og oh oi b">ACCOUNT_ID</code>应该是你在上面得到的账单账户。</p><h2 id="3bf1" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">创建服务帐户</h2><p id="dae6" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">要访问GCS，我们将创建一个将在CI工作流中使用的服务帐户。</p><p id="f36a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建一个名为<code class="fe of og oh oi b">reg-suit</code>的服务帐户:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="f32c" class="on md iq oi b gy oo op l oq or">gcloud iam service-accounts create <!-- -->reg-suit<!-- --> --display-name <!-- -->reg-suit</span></pre><p id="70b2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">确保帐户已创建:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="3c83" class="on md iq oi b gy oo op l oq or">gcloud iam service-accounts list</span></pre><p id="ae8b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，我们将帐户设置为访问GCS的角色<code class="fe of og oh oi b">roles/storage.admin</code>:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="a9b3" class="on md iq oi b gy oo op l oq or">gcloud projects add-iam-policy-binding \<br/>my-reg-suit \<br/>--member serviceAccount:reg-suit@my-reg-suit.iam.gserviceaccount.com \<br/>--role roles/storage.admin</span></pre><h2 id="b897" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">下载凭据密钥</h2><p id="1a65" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">接下来，我们将下载一个凭证密钥，以允许reg-suit创建GCS存储桶。</p><p id="a701" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们导出凭据密钥:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="57f5" class="on md iq oi b gy oo op l oq or">gcloud iam service-accounts keys create \<br/>--iam-account reg-suit@my-reg-suit.iam.gserviceaccount.com \<br/>~/.keys/reg-suit-key.json</span></pre><p id="39c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在你可以在<code class="fe of og oh oi b">~/.keys/reg-suit-key.json</code>看到证书json文件。</p><h2 id="bb4b" class="on md iq bd me pb pc dn mi pd pe dp mm la pf pg mo le ph pi mq li pj pk ms pl bi translated">初始化注册套装</h2><p id="115e" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">现在我们已经准备好设置注册诉讼。</p><p id="abaa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们用这个命令初始化它:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="34cb" class="on md iq oi b gy oo op l oq or">GOOGLE_APPLICATION_CREDENTIALS=~/.keys/reg-suit-key.json \<br/>npx reg-suit init \<br/>--use-yarn</span></pre><p id="d03f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">运行后，提示会出现，并选择这些插件。</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="b360" class="on md iq oi b gy oo op l oq or"><strong class="oi ir">reg-keygen-git-hash-plugin</strong><br/><strong class="oi ir">reg-publish-gcs-plugin</strong><br/><strong class="oi ir">reg-notify-github-plugin</strong></span></pre><p id="7a94" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并填写信息:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="d41a" class="on md iq oi b gy oo op l oq or">? <strong class="oi ir">Working directory of reg-suit.</strong> .reg</span><span id="b0a7" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">Append ".reg" entry to your .gitignore file.</strong> Yes</span><span id="c8cb" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">Directory contains actual images.</strong> __screenshots__</span><span id="dda2" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">Threshold, ranges from 0 to 1. Smaller value makes the comparison more sensitive.</strong> 0</span><span id="bec8" class="on md iq oi b gy pn op l oq or">[reg-suit] info Set up reg-notify-github-plugin:</span><span id="58c5" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">notify-github plugin requires a client ID of reg-suit GitHub app. Open installation window in your browser</strong> Yes</span></pre><p id="d218" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe of og oh oi b">notify-github plugin</code>的问题之后，你会被重定向到GitHub中reg-suit app的安装页面，像这样:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pq"><img src="../Images/a7a0bbc2964640a7602000f77df97a7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QJrcviheqcituOkq_CHINA.png"/></div></div></figure><p id="b847" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并配置您的存储库。</p><p id="2a23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，您可以在<a class="ae ln" href="https://reg-viz.github.io/gh-app/index.html" rel="noopener ugc nofollow" target="_blank">https://reg-viz.github.io/gh-app/index.html</a>获得客户ID，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pr"><img src="../Images/b822551edd56733253b1ebb86dc6fbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4E5CRA6iRh3j0M_-UErqoQ.png"/></div></div></figure><p id="1902" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">复制id并粘贴到提示符下。</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="0fba" class="on md iq oi b gy oo op l oq or">? <strong class="oi ir">This repositoriy's client ID of reg-suit GitHub app</strong> {client id}</span></pre><p id="4c0b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并继续提示:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="a200" class="on md iq oi b gy oo op l oq or">? <strong class="oi ir">Create a new GCS bucket</strong> Yes</span><span id="3a84" class="on md iq oi b gy pn op l oq or">...</span><span id="063b" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">Update configuration file</strong> Yes</span><span id="7475" class="on md iq oi b gy pn op l oq or">? <strong class="oi ir">Copy sample images to working dir</strong> No</span></pre><p id="9edd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">之后，<code class="fe of og oh oi b">regconfig.json</code>将在根文件夹下生成:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="3403" class="on md iq oi b gy oo op l oq or">{<br/>  "core": {<br/>    "workingDir": ".reg",<br/>    "actualDir": "__screenshots__",<br/>    "thresholdRate": 0,<br/>    "addIgnore": true,<br/>    "ximgdiff": {<br/>      "invocationType": "client"<br/>    }<br/>  },<br/>  "plugins": {<br/>    "reg-keygen-git-hash-plugin": true,<br/>    "reg-notify-github-plugin": {<br/>      "clientId": "xxxx"<br/>    },<br/>    "reg-publish-gcs-plugin": {<br/>      "bucketName": "xxx"<br/>    }<br/>  }<br/>}</span></pre><p id="3cc1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在您可以通过以下方式运行reg-suit:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="5b7f" class="on md iq oi b gy oo op l oq or">GOOGLE_APPLICATION_CREDENTIALS=~/.keys/reg-suit-key.json npx reg-suit run</span></pre><h1 id="ad13" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">建立CircleCI</h1><p id="61b3" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">接下来，让我们在CI流程中设置并运行它。</p><p id="1cd2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，我们将在CircleCI中将凭证密钥注册为环境变量。</p><p id="c0dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">转到您的项目，<code class="fe of og oh oi b">Environment Variables</code>和<code class="fe of og oh oi b">Add Environment Variable</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ps"><img src="../Images/fd88750760aefafba9da47e8ffb4bc7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GYoSp4kRbY1o1FoL.png"/></div></div></figure><p id="2843" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">复制json:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="09e2" class="on md iq oi b gy oo op l oq or">cat ~/.keys/reg-suit-key.json | pbcopy</span></pre><p id="e552" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并创建<code class="fe of og oh oi b">GCP_CREDENTIALS</code>并粘贴值:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pt"><img src="../Images/890b48c412420d616f5d4f48f28ef121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gT6CzDCnFV0AgqhFRnrxzA.png"/></div></div></figure><p id="382e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来，创建<code class="fe of og oh oi b">.circleci/config.yml</code>:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oz pa l"/></div></figure><p id="2340" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并将脚本添加到package.json:</p><pre class="kg kh ki kj gt oj oi ok ol aw om bi"><span id="1f0c" class="on md iq oi b gy oo op l oq or">"scripts": {<br/>  ...<br/><strong class="oi ir">  "visual-testing": "reg-suit run"</strong><br/>},</span></pre><h1 id="16e6" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">做视觉测试</h1><p id="9309" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">既然我们已经准备好了所有的设置。</p><p id="4b8e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们试一试，看看效果如何。</p><p id="99b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">对按钮组件进行一些修改，如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pu"><img src="../Images/4de9695f19ab9adaf9fa2fca6900d486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GssC3hldLSPJ8MD57zekMA.png"/></div></div></figure><p id="2669" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们在样式中添加了<code class="fe of og oh oi b">width: 200</code>。</p><p id="f5cb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您按下它时，reg-suit会自动将快照与以前的组件版本进行比较，以查找更改。</p><p id="0802" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果发现一些变化，你会在你的PR中得到通知，就像这样。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pt"><img src="../Images/ae13ed5bd5e15c5a99efb644c1f9892a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpHKLlit6RU5xH5caFVFwQ.png"/></div></div></figure><p id="3bfd" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里可以看到PR <a class="ae ln" href="https://github.com/manakuro/reg-suit-example/pull/2" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c917" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并点击链接，可以看到报告:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pv"><img src="../Images/039f1bdae892ee091c07e2d4b775008f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FYTJ5j7920nRML5gsTqooQ.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pw"><img src="../Images/6fa33f028372ea05322e1c6e4a10a6d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_KEGtQOQXo2ptq5fApB9A.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi px"><img src="../Images/db6ab769efab86e6c41483db3c4435b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxUr9mJOqNbf-eDgRgJ92g.png"/></div></div></figure><p id="9062" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如您所见，按钮组件扩展了宽度。</p><p id="3b33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您对更改感到满意时，就可以合并代码了。</p><p id="7787" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这使得查看UI更改变得简单，并且一眼就能快速确认。</p><h1 id="9ab4" class="mc md iq bd me mf mg mh mi mj mk ml mm jw mn jx mo jz mp ka mq kc mr kd ms mt bi translated">结论</h1><p id="fb86" class="pw-post-body-paragraph kr ks iq kt b ku mu jr kw kx mv ju kz la mw lc ld le mx lg lh li my lk ll lm ij bi translated">如今组件驱动开发已经成为前端开发的主流。</p><p id="c1a9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">自动UI检查使您能够专注于构建功能，并为您的用户带来一致的UI。</p><p id="8582" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你负担得起，<a class="ae ln" href="https://www.chromatic.com/" rel="noopener ugc nofollow" target="_blank"> Chromatic </a>将是另一个选择，但reg-suit是一个免费的开源项目。如果你想尝试视觉测试，reg-suit是个不错的选择。</p><div class="mz na gp gr nb nc"><a href="https://github.com/manakuro/reg-suit-example" rel="noopener  ugc nofollow" target="_blank"><div class="nd ab fo"><div class="ne ab nf cl cj ng"><h2 class="bd ir gy z fp nh fr fs ni fu fw ip bi translated">mana kuro/reg-suit-示例</h2><div class="nj l"><p class="bd b dl z fp nh fr fs ni fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np kp nc"/></div></div></a></div></div></div>    
</body>
</html>