<html>
<head>
<title>Learn How to Write End to End Automation Using Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解如何使用Cypress编写端到端自动化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/learn-how-to-write-end-to-end-automation-using-cypress-ed2f6bcbdba1?source=collection_archive---------11-----------------------#2021-02-27">https://javascript.plainenglish.io/learn-how-to-write-end-to-end-automation-using-cypress-ed2f6bcbdba1?source=collection_archive---------11-----------------------#2021-02-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5b25c65dc0acebb8188c5f4d63542694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gq-MZ2FwPPccoaxt"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@plhnk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paul Hanaoka</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="ee4d" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">问题是</h2><p id="0f6f" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">自动化测试是高质量软件开发的关键部分。每一级别的自动化测试都有一些该做和不该做的事情，以及优缺点。</p><p id="6a3f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您不熟悉自动化的不同层次，您可以从测试一个代码单元(例如一个类)，来测试这些单元的集成(例如多个类)，到整个系统。测试是关于风险和选择正确的妥协。考虑到这一点，您应该尝试拥有一个相当平衡的测试套件，这样您就不会以连续几天运行自动化而告终，并且您可以拥有一个快速可靠的反馈循环。</p><p id="1227" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在这篇文章中，我将重点介绍一个测试框架，该框架目前有助于从web浏览器测试整个系统。这些类型的测试通常被称为UI测试、端到端测试或系统测试。虽然系统测试很棒，因为它们是从用户的角度来测试系统的，但是也有一些问题。</p><ul class=""><li id="cc05" class="lz ma iq lb b lc lu lg lv km mb kq mc ku md lt me mf mg mh bi translated">可靠性:这些类型的测试往往会失败很多，因为你需要启动整个系统，而且非常脆弱。任何轻微的停顿，没有正确的重试级别，都可能导致测试失败。</li><li id="2652" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated"><strong class="lb ir">排除故障成本高昂</strong>:如果没有适当的日志记录和监控，这些类型的测试可能很难排除故障。举个例子，一个登录页面不起作用。确切的问题是什么？会不会是前端问题？网络问题？或者，后端问题？</li><li id="5702" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated"><strong class="lb ir">持续时间</strong>:因为他们需要一个UI和后端工作，可能会有复杂的设置和长时间运行的任务。在许多情况下，这可能导致每次测试需要几分钟。</li><li id="0e07" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt me mf mg mh bi translated">可维护性:对于这些类型的测试，你倾向于使用CSS选择器。选择错误类型的选择器可能会导致测试失败，即使功能上没有任何问题。</li></ul><p id="228d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在这篇文章中，我将介绍一个叫做Cypress的UI测试框架。Cypress是一个非常易用的端到端测试框架。如果你以前用过基于Selenium的测试框架，Cypress不使用Selenium。他们还声称它“与应用程序运行在同一个运行循环中”</p><p id="3468" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">根据我到目前为止的经验，使用Cypress编写我的端到端自动化已经产生了易于编写、易于调试、快速和更可靠的测试。最后，没有一个UI测试框架是防弹的，在选择自动化什么、测试的前提条件是什么以及应该多长时间运行一次这些测试时，你应该真正尝试做出负责任的选择。</p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="03c7" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">设置项目</h2><p id="6a6e" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">让我们从运行这些测试所需的设置开始。在这篇文章中，我们将创建一个全新的项目，只包含这些测试。</p><p id="a2a8" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">你要做的第一件事是创建一个全新的npm项目并安装Cypress。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="43f2" class="kd ke iq mz b gy nd ne l nf ng">npm init<br/>npm install --save-dev cypress@latest</span></pre><p id="78bf" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">现在，你的项目结构应该有一个<code class="fe nh ni nj mz b">package.json</code>文件、一个<code class="fe nh ni nj mz b">package-lock.json</code>文件和一个<code class="fe nh ni nj mz b">node_modules</code>文件夹。</p><p id="1e12" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">下一步是创建cypress配置文件。在项目的根目录下，添加一个名为<code class="fe nh ni nj mz b">cypress.json</code>的文件，其内容如下。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2705" class="kd ke iq mz b gy nd ne l nf ng">{<br/>  "integrationFolder": "tests",<br/>  "defaultCommandTimeout": 15000,<br/>  "pageLoadTimeout": 30000,<br/>  "video": true<br/>}</span></pre><p id="585d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">让我们先来看看这些值分别代表什么。</p><ol class=""><li id="5ba3" class="lz ma iq lb b lc lu lg lv km mb kq mc ku md lt nk mf mg mh bi translated"><code class="fe nh ni nj mz b">integrationFolder</code>:这是你所有测试的文件夹。在这里，我们希望所有的测试都在项目根目录下的<code class="fe nh ni nj mz b">tests</code>文件夹中。您可以输入任何值，只要确保该文件夹存在并且包含您的测试。</li><li id="0050" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nk mf mg mh bi translated"><code class="fe nh ni nj mz b">defaultCommandTimeout</code>:这是特定命令失败所需的时间(毫秒)。例如，如果你点击一个元素，如果这个元素没有出现在屏幕上，它会在这段时间内不断重试。</li><li id="a79f" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nk mf mg mh bi translated"><code class="fe nh ni nj mz b">pageLoadTimeout</code>:这是测试框架等待页面成功加载所需的时间(毫秒)。</li><li id="e8b4" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nk mf mg mh bi translated"><code class="fe nh ni nj mz b">video</code>:将此项设置为true将启用所有测试的视频记录。</li></ol><p id="fb3e" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">寻找更多的配置标志？你可以在这里找到更多信息<a class="ae kc" href="https://docs.cypress.io/guides/references/configuration.html" rel="noopener ugc nofollow" target="_blank">https://docs . cypress . io/guides/references/configuration . html</a></p></div><div class="ab cl mn mo hu mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ij ik il im in"><h2 id="d613" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">编写您的第一个测试</h2><figure class="mu mv mw mx gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/317bf1e410817199303316b88763ac4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZgbaeZyG2mFFb913"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@jamesponddotco?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">James Pond</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bae3" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">使用Cypress编写测试非常容易。首先，在<code class="fe nh ni nj mz b">tests</code>文件夹中创建一个新的JavaScript文件(或者在<code class="fe nh ni nj mz b">integrationFolder</code>文件夹中设置的任何文件夹)。</p><p id="29aa" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">每个测试都由一个<code class="fe nh ni nj mz b">describe</code>块包装，这些块中的测试由<code class="fe nh ni nj mz b">it</code>块包装。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2ea4" class="kd ke iq mz b gy nd ne l nf ng">describe('my first test suite`, () =&gt; {<br/>    it('my first test', () =&gt; {<br/>    <br/>    });<br/>});</span></pre><p id="747e" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">现在，在编写我们的第一个测试之前，让我们复习一下最基本的命令。这些Cypress命令将帮助您完成编写UI测试自动化时需要完成的大部分任务。</p><h2 id="bc67" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">访问特定的URL</h2><p id="8f8d" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">几乎所有测试的第一步都是访问一个特定的URL。这将负责打开浏览器并导航到您提供的URL。为此，您将使用<code class="fe nh ni nj mz b">visit</code>命令，并将要访问的URL作为参数传递。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="bebc" class="kd ke iq mz b gy nd ne l nf ng">cy.visit('url to visit...');</span></pre><h2 id="5c54" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">检索元素</h2><p id="d024" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">如果您想对DOM中的元素执行操作，您总是需要首先从DOM中检索元素。例如，如果您的HTML页面如下所示:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="8829" class="kd ke iq mz b gy nd ne l nf ng">&lt;div id="the-item"&gt;Text goes here&lt;/div&gt;</span></pre><p id="d4cf" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">您将需要通过ID进行选择。这将产生一个选择器<code class="fe nh ni nj mz b">#the-item</code>。</p><p id="4b72" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">Cypress提供了一种从DOM中检索元素的方法。这个方法叫做<code class="fe nh ni nj mz b">.get</code>,你提供一个CSS选择器作为参数来惟一地标识这个元素。</p><p id="2b7a" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">在本例中，您将使用下面的代码来检索元素并在测试中对其执行操作。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="56fe" class="kd ke iq mz b gy nd ne l nf ng">cy.get('#the-item')</span></pre><h2 id="60ad" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">对DOM元素的操作</h2><p id="cc74" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">如果您想要验证一个元素是否可见，您将想要使用<code class="fe nh ni nj mz b">should</code>命令并传入以下参数之一:</p><ol class=""><li id="8db6" class="lz ma iq lb b lc lu lg lv km mb kq mc ku md lt nk mf mg mh bi translated">当你想验证一个元素对用户是否可见时的<code class="fe nh ni nj mz b">'be.visible'</code>参数。</li><li id="7a4e" class="lz ma iq lb b lc mi lg mj km mk kq ml ku mm lt nk mf mg mh bi translated"><code class="fe nh ni nj mz b">'not.be.visible'</code>参数，用于验证一个元素是否对用户不可见。</li></ol><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="eb98" class="kd ke iq mz b gy nd ne l nf ng">cy.get(selector).should('be.visible');<br/>cy.get(selector).should('not.be.visible);</span></pre><p id="36d1" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">您还可以使用Cypress执行其他基本任务。这些是在输入元素上键入、验证元素是否包含特定的文本或点击元素。</p><p id="4e16" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果你想在一个输入元素上打字，你将需要首先得到这个元素，然后使用<code class="fe nh ni nj mz b">type</code>函数。作为<code class="fe nh ni nj mz b">type</code>函数的一个参数，您需要传递想要在元素上输入的文本。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="94cb" class="kd ke iq mz b gy nd ne l nf ng">cy.get(selector).type(text);</span></pre><p id="456f" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">为了验证一个元素是否包含文本，您需要使用<code class="fe nh ni nj mz b">contains</code>方法。您需要将想要验证元素包含的文本作为参数传递。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="5c70" class="kd ke iq mz b gy nd ne l nf ng">cy.get(selector).contains(text);</span></pre><p id="b47d" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">最后，如果你想点击一个元素，你需要调用<code class="fe nh ni nj mz b">click</code>方法，它不需要你为这个动作传递任何参数。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="0112" class="kd ke iq mz b gy nd ne l nf ng">cy.get(selector).click();</span></pre><h2 id="a90b" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">将一切联系在一起</h2><p id="319a" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">到目前为止，您可能已经意识到，您的测试自动化将由命令的组合组成，而不是单一的命令。</p><p id="1c2e" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">例如，您可能希望访问一个页面，在表单上键入一些内容，单击submit按钮，并验证屏幕上元素的文本。这个简单的场景将按以下方式编写:</p><figure class="mu mv mw mx gt jr"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h2 id="ec06" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">运行测试</h2><p id="40b7" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">我们将讨论的最后一个主题是，如何运行您的测试？作为package.json文件的一部分，向<code class="fe nh ni nj mz b">scripts</code>对象添加以下脚本。值<code class="fe nh ni nj mz b">cypress.json</code>是您之前创建的配置文件。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="bb2d" class="kd ke iq mz b gy nd ne l nf ng">"test" : "cypress run --config-file=cypress.json"</span></pre><p id="5723" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">如果您想要利用Cypress的用户界面，并且能够运行特定的测试并查看测试运行的细节，那么添加这个脚本。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="f5e3" class="kd ke iq mz b gy nd ne l nf ng">"test:open”: “cypress open -C cypress.json”</span></pre><p id="3fa9" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated">希望您已经对这个伟大的测试自动化框架有了更好的理解。尽情享受吧！</p><p id="a3c2" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><strong class="lb ir">资源</strong></p><div class="no np gp gr nq nr"><a href="https://www.cypress.io/how-it-works/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">端到端测试框架</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">我们觉得是时候解决它了。选择一个框架，选择一个断言库…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">www.cypress.io</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jw nr"/></div></div></a></div><p id="717a" class="pw-post-body-paragraph kz la iq lb b lc lu le lf lg lv li lj km lw ll lm kq lx lo lp ku ly lr ls lt ij bi translated"><em class="og">在</em> <a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb ir"> <em class="og">获取更多内容</em></strong></a></p></div></div>    
</body>
</html>