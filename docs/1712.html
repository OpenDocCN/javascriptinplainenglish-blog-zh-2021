<html>
<head>
<title>How to Run ‘npm run build’ on a Low Spec Server?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在低规格服务器上运行“npm运行构建”?</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-execute-nuxt-npm-run-build-on-low-spec-server-ef7442b5c03d?source=collection_archive---------2-----------------------#2021-04-12">https://javascript.plainenglish.io/how-to-execute-nuxt-npm-run-build-on-low-spec-server-ef7442b5c03d?source=collection_archive---------2-----------------------#2021-04-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b2138a0b474833dbdb885d4c30f90566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJ6nc3GMusPRg6eA3kNGDA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@flowforfrank?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae kc" href="https://unsplash.com/s/photos/javascript-node?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7466" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我相信在NPM的世界里，你会遇到难以解决的问题。尝试在您的服务器或本地环境中执行<code class="fe lb lc ld le b">npm run build</code>时，您是否感到头晕？例如，得到下面的错误信息。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="b3e3" class="ln lo iq le b gy lp lq l lr ls">Killed<br/>npm ERR! code ELIFECYCLE<br/>npm ERR! errno 137<br/>npm ERR! project-nuxt@1.0.0 build: `nuxt build`<br/>npm ERR! <strong class="le ir">Exit status 137</strong><br/>npm ERR! <br/>npm ERR! Failed at the project-nuxt@1.0.0 build script.<br/>npm ERR! This is probably not a problem with npm. There is likely additional logging output above.</span><span id="dcff" class="ln lo iq le b gy lt lq l lr ls">npm ERR! A complete log of this run can be found in:<br/>npm ERR!     /home/administrator/.npm/_logs/2021-04-11T08_48_48_675Z-debug.log</span></pre><p id="8d69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果是，你并不孤单。错误消息“<strong class="kf ir">退出状态137 </strong>”指的是NPM没有足够的内存在你的土豆服务器上编译你的代码的情况。<code class="fe lb lc ld le b">npm run build</code>所做的是运行package.json中的脚本“build ”,它通常是编译或构建或运行应用程序的脚本。所以基本上，这是一个吃公羊的家庭😅。</p><p id="cfe8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这篇文章中，我将根据我的经验分享解决方案。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="4f23" class="mb lo iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">解决方法是什么？</h1><p id="f1b3" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">有一种方法可以解决这个问题，那就是限制构建package.json所需的最大内存。</p><p id="d1ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">去<code class="fe lb lc ld le b">package.json</code>看剧本</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="32b7" class="ln lo iq le b gy lp lq l lr ls">....<br/>"scripts": {<br/>    "dev": "nuxt",<br/>    <strong class="le ir">"build": "nuxt build",</strong><br/>    "start": "nuxt start",<br/>    "generate": "nuxt generate"<br/>},<br/>....</span></pre><p id="6b50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您所需要的只是在构建阶段指定限制内存。为了避免错误137，使用参数<code class="fe lb lc ld le b">—-max-old-space-size</code>增加内存限制量。这将有助于避免内存限制问题。举个例子，</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="d67e" class="ln lo iq le b gy lp lq l lr ls">node --max-old-space-size=800 <!-- -->node_modules/nuxt/bin/nuxt.js build<br/>node --max-old-space-size=1000 <!-- -->node_modules/nuxt/bin/nuxt.js build<br/>node --max-old-space-size=<strong class="le ir">VALUE</strong> <!-- -->node_modules/nuxt/bin/nuxt.js build<br/>....<br/>....</span></pre><p id="34e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">您可以选择任何想要的值(以MB为单位)并替换它。复制并将其放入package . JSON“build”脚本中。</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="96d6" class="ln lo iq le b gy lp lq l lr ls">....<br/>"scripts": {<br/>    "dev": "nuxt",<br/>    <strong class="le ir">"build": "PASTE HERE",</strong><br/>    "start": "nuxt start",<br/>    "generate": "nuxt generate"<br/>},<br/>....</span></pre><p id="3c59" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那之后，就又拯救了<code class="fe lb lc ld le b">npm run build</code>🍻。</p><p id="4cd1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一切都会顺利的。但是您会注意到脚本运行缓慢，因为您为NPM编译代码分配了较低的内存限制。</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><h1 id="a807" class="mb lo iq bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">如果不起作用呢？</h1><p id="9778" class="pw-post-body-paragraph kd ke iq kf b kg my ki kj kk mz km kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">如果上述解决方案对您不起作用，请检查是否有可用的交换内存。如果没有，您需要按照以下步骤创建一个交换文件:</p><ol class=""><li id="273a" class="nd ne iq kf b kg kh kk kl ko nf ks ng kw nh la ni nj nk nl bi translated">通过运行以下命令检查系统交换信息</li></ol><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="74aa" class="ln lo iq le b gy lp lq l lr ls"># sudo swapon --show<br/><strong class="le ir">NAME      TYPE  SIZE USED PRIO</strong><br/> <br/># free -h<br/>              total    used    free   shared  buff/cache   available<br/>Mem:          1987     555     991      36         440        1279<br/><strong class="le ir">Swap:          0        0        0</strong></span></pre><p id="d98a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您没有得到任何输出，这意味着您的系统当前没有可用的交换空间。如果你已经有了，可能会有一些其他的问题，很可能是你的代码的问题。</p><p id="34ac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">2.在创建交换内存之前，您应该检查当前的磁盘使用情况</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="6a3c" class="ln lo iq le b gy lp lq l lr ls"># dh -f<br/>...<br/>/dev/vda1        49G  6.0G   43G  13% /<br/>...</span></pre><p id="1e11" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">3.所以，根据上面的例子，有足够的空间可用。继续创建交换文件</p><pre class="lf lg lh li gt lj le lk ll aw lm bi"><span id="8afb" class="ln lo iq le b gy lp lq l lr ls"># sudo fallocate -l 1G /swapfile<br/># sudo chmod 600 /swapfile# sudo mkswap /swapfile<br/># sudo swapon /swapfile<br/># sudo swapon --show<br/># free -h</span></pre><p id="ed7a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">至此，您的交换文件就创建好了。尝试重新运行“npm运行构建”。现在应该可以正常工作了。😁</p></div><div class="ab cl lu lv hu lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ij ik il im in"><p id="f4a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">太好了！现在你可以面带微笑愉快地跑你的NPM了。希望这个解决方案能够帮助您减轻与JavaScript相关的压力。感谢阅读。编码快乐，工作快乐！</p><h1 id="5aaa" class="mb lo iq bd mc md nm mf mg mh nn mj mk ml no mn mo mp np mr ms mt nq mv mw mx bi translated">参考</h1><div class="nr ns gp gr nt nu"><a href="https://medium.com/@vuongtran/how-to-solve-process-out-of-memory-in-node-js-5f0de8f8464c" rel="noopener follow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd ir gy z fp nz fr fs oa fu fw ip bi translated">如何解决Node.js中进程内存不足的问题</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">我将在Node.js中展示如何解决内存不足的问题。</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">medium.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jw nu"/></div></div></a></div><p id="3264" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="oj">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="oj">plain English . io</em></a></p></div></div>    
</body>
</html>