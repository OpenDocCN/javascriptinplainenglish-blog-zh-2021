<html>
<head>
<title>Integrate Google ReCaptcha v2 with React and Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Google ReCaptcha v2与React和Node.js集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integrate-google-recaptcha-v2-invisible-with-react-and-nodejs-9d119c94433b?source=collection_archive---------1-----------------------#2021-10-18">https://javascript.plainenglish.io/integrate-google-recaptcha-v2-invisible-with-react-and-nodejs-9d119c94433b?source=collection_archive---------1-----------------------#2021-10-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b8f0e6eb349efaf198f82a2150e923a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r2-0JWHyzyPdeY_H1hZ0vg.png"/></div></div></figure><p id="988f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我们将使用npm包<a class="ae kt" href="https://www.npmjs.com/package/react-google-recaptcha" rel="noopener ugc nofollow" target="_blank"> react-google-recaptcha </a>完成reCAPTCHA v2(不可见)与React和Node.js的集成过程。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="8ed9" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">第一步。为google recaptcha生成密钥</h2><p id="91fd" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">要使用Google reCAPTCHA服务，首先我们需要注册我们的应用程序并获得一个站点密钥和私有密钥对。</p><p id="05ac" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我们做了以下工作:</p><ol class=""><li id="5b9c" class="lz ma in jx b jy jz kc kd kg mb kk mc ko md ks me mf mg mh bi translated">访问Google reCAPTCHA <a class="ae kt" href="https://www.google.com/recaptcha/admin/" rel="noopener ugc nofollow" target="_blank">管理控制台</a>。</li><li id="d797" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">单击“+”图标注册新的站点/应用程序。</li><li id="d1ba" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">选择验证码版本为reCAPTCHA v2，并输入为不可见。</li><li id="eb23" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">复制您的站点和私钥以备将来使用。</li><li id="6b30" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">在允许的域列表中添加应用程序的域。出于开发目的，将<em class="mn"> Localhost(区分大小写)添加到</em>列表中。</li></ol><figure class="mp mq mr ms gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/e73e2dc9017eea0f6ffced75b41b653e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9Au0b0KS4VMW1K2ii6J5Q.png"/></div></div></figure></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><h2 id="40d1" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">第二步。设置客户端</h2><p id="338c" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">使用npm或yarn安装<a class="ae kt" href="https://www.npmjs.com/package/react-google-recaptcha" rel="noopener ugc nofollow" target="_blank"> react-google-recaptcha </a>包。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="53b7" class="lb lc in mu b gy my mz l na nb">npm install react-google-captcha<br/>OR<br/>yarn add react-google-captcha</span></pre><ol class=""><li id="d553" class="lz ma in jx b jy jz kc kd kg mb kk mc ko md ks me mf mg mh bi translated">导入<code class="fe nc nd ne mu b">&lt;ReCaptcha/&gt;</code>组件</li><li id="4323" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">将它包含在返回方法中。</li><li id="cc28" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">你还需要一个<em class="mn"> </em> <code class="fe nc nd ne mu b"><em class="mn">ref</em></code>给这个组件。</li><li id="8928" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">使用<code class="fe nc nd ne mu b"><em class="mn">ref</em></code>和<code class="fe nc nd ne mu b">executeAsync()</code>函数获得recaptcha令牌(在向后端提交数据之前)</li><li id="0d64" class="lz ma in jx b jy mi kc mj kg mk kk ml ko mm ks me mf mg mh bi translated">最后，重置验证码。这是imp，用于在需要时使recaptcha为后续检查做好准备(例如:-如果用户名或密码在登录captcha时无效，应在重试前重置)</li></ol><p id="c7c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是一些示例React代码:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a278" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于<em class="mn">我不是机器人复选框</em>验证码，只需移除尺寸道具(第33行)并用<code class="fe nc nd ne mu b">recaptchaRef.current.getValue()</code>替换第9行</p><p id="167e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="mn">注意:</em> </strong> <em class="mn">如果谷歌检测到一些可疑的用户活动，recaptcha挑战将被隐式调用。你不能明确地调用挑战或改变它的概率。为了增加挑战被调用的概率(可能是为了测试目的),请尝试在匿名模式下通过VPN连接启动应用程序。</em></p><p id="5537" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该软件包还提供了可选的道具，如主题、徽章的位置等。查看<a class="ae kt" href="https://www.npmjs.com/package/react-google-recaptcha" rel="noopener ugc nofollow" target="_blank">和</a>的包装文件。</p><h2 id="f919" class="lb lc in bd ld le lf dn lg lh li dp lj kg lk ll lm kk ln lo lp ko lq lr ls lt bi translated">第三步。在后端验证令牌</h2><p id="a866" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks ig bi translated">从请求体中提取令牌，并将这个令牌和在步骤1中获得的私钥一起发送到Google的API，以获得用户分数。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="4b5c" class="lb lc in mu b gy my mz l na nb">https://www.google.com/recaptcha/api/siteverify?secret=${YOUR_PRIVATE_KEY}&amp;response=${token}</span></pre><p id="fb35" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将收到一个带有成功密钥的JSON对象。此密钥可用于确定请求是来自真实用户还是可疑机器人。成功真意味着一个真正的用户。</p><pre class="mp mq mr ms gt mt mu mv mw aw mx bi"><span id="5ab6" class="lb lc in mu b gy my mz l na nb">data: {<br/> success: true,<br/> challenge_ts: ‘2021–10–18T04:33:00Z’,<br/> hostname: ‘localhost’<br/>}</span></pre><p id="6e65" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是后端的示例代码片段:</p><figure class="mp mq mr ms gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a549" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> <em class="mn">注意:</em> </strong> <em class="mn">在将你的代码推送到公共存储库之前，记得从代码中移除你的私钥。您可以将它存储在环境变量中，并使用process.env对象或配置变量(如果使用heroku部署)来访问它。并添加您的。env文件到. gitignore. </em></p><p id="734c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样！我希望你已经发现这是有用的。如果有，一定要在评论里让我知道。</p><p id="41dd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mn">更多内容请看</em><a class="ae kt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mn">plain English . io</em></strong></a></p></div></div>    
</body>
</html>