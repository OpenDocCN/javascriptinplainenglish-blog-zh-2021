<html>
<head>
<title>How to Automatically Convert TypeScript Types to Runtime Validators</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何自动将TypeScript类型转换为运行时验证器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-automatically-convert-typescript-types-to-runtime-validators-5b06ee269b13?source=collection_archive---------7-----------------------#2021-08-23">https://javascript.plainenglish.io/how-to-automatically-convert-typescript-types-to-runtime-validators-5b06ee269b13?source=collection_archive---------7-----------------------#2021-08-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="43e2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">本文将展示如何从TypeScript文件中生成运行时验证器。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/35cd25942e00ef4558ff1210cf5d653c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nRU66YQEmjfLtr9D"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@baciutudor?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Tudor Baciu</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7c4b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为一个开发者，偷懒可能是件好事。如果某些代码已经编写过一次(比如TypeScript定义)，为什么还要编写类似的代码来做同样的事情呢？这很容易出错，而且耗费大量时间。如果有一种方法可以将这些类型、枚举和接口转换成某种运行时代码呢？嗯，有。</p><p id="e472" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">本文展示了包<code class="fe lp lq lr ls b">runtime-typescript-checker</code>，可以在https://www.npmjs.com/package/runtime-typescript-checker<a class="ae ks" href="https://www.npmjs.com/package/runtime-typescript-checker" rel="noopener ugc nofollow" target="_blank"/>找到。</p><h1 id="94bf" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="726a" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">这篇文章解释了如何从下面的代码中自动生成函数<code class="fe lp lq lr ls b">IsUserTypeGuard()</code>和<code class="fe lp lq lr ls b">ValidateUser()</code>:</p><pre class="kd ke kf kg gt mq ls mr ms aw mt bi"><span id="a1b9" class="mu lu in ls b gy mv mw l mx my">export interface User {<br/>  Name: string;<br/>  HasPaid: "Yes" | "No",<br/>  Notes?: string<br/>}</span></pre><h1 id="a928" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">建设</h1><p id="0e3c" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">首先，<code class="fe lp lq lr ls b">runtime-typescript-checker</code>将解析源代码(包含导出类型、枚举和接口的类型脚本文件)。</p><p id="10d5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">解析结束时，将创建(或更新)可以使用的新文件。</p><h2 id="749a" class="mu lu in bd lv mz na dn lz nb nc dp md lc nd ne mf lg nf ng mh lk nh ni mj nj bi translated">例子</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/4c402952c6e20d863cd79073228886a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*8IC-6EoO197VyqLnRxDf3w.png"/></div></figure><p id="c348" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将为每个导出的类型生成一个包含两个函数的文件。一个TypeGuard和一个验证器函数。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/f91e717684e5a9c26ab4dbcc59c129ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iR9fzGwOwy22MnVk6qBPGw.png"/></div></div></figure><h1 id="9d6d" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">在运行时使用测试(TypeGuard)</h1><p id="f980" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">初始化运行时检查器需要几行代码，但是完成之后，只需使用:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/cf9d808b3956cd161eb2227366fa0426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*BOU2zktbsPguqtZ4vondMQ.png"/></div></figure><h1 id="58e6" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">在运行时使用测试(验证)</h1><p id="eb32" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi translated">类型保护很好，但是经常需要关于错误的细节。如前所述，还有一个验证器函数，它可以清楚地显示在有效负载中发现的错误:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/d31b6ec4eb6f7aacb3bd16616e30a666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NARFf5yLUySIxDj8AWF4Pg.png"/></div></div></figure><p id="5df8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">给定上面的接口，这个有效负载:</p><pre class="kd ke kf kg gt mq ls mr ms aw mt bi"><span id="afa0" class="mu lu in ls b gy mv mw l mx my">{<br/>   Name: "Tomas",<br/>   HasPaid: "Maybe",<br/>   Role: dances.eRole.Leader,<br/>   DanceClass: {<br/>       ID: "7",<br/>       Name: "Lindy Hop Autumn",<br/>       Level: "?",<br/>   },<br/>   Notes: undefined,<br/>   MemberShip: true<br/>}</span></pre><p id="b6ea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">会呈现以下错误:</p><pre class="kd ke kf kg gt mq ls mr ms aw mt bi"><span id="eea9" class="mu lu in ls b gy mv mw l mx my">[<br/>    {<br/>        "instancePath": "/HasPaid",<br/>        "schemaPath": "#/properties/HasPaid/enum",<br/>        "keyword": "enum",<br/>        "params": {<br/>            "allowedValues": [<br/>                "No",<br/>                "Yes"<br/>            ]<br/>        },<br/>        "message": "must be equal to one of the allowed values"<br/>    },<br/>    {<br/>        "instancePath": "/DanceClass/Level",<br/>        "schemaPath": "#/properties/DanceClass/properties/Level/enum",<br/>        "keyword": "enum",<br/>        "params": {<br/>            "allowedValues": [<br/>                "A",<br/>                "B",<br/>                "C",<br/>                "D",<br/>                "E"<br/>            ]<br/>        },<br/>        "message": "must be equal to one of the allowed values"<br/>    }<br/>]</span></pre><h1 id="cbcb" class="lt lu in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">演示？</h1><pre class="kd ke kf kg gt mq ls mr ms aw mt bi"><span id="d8bf" class="mu lu in ls b gy mv mw l mx my">git clone <a class="ae ks" href="https://github.com/tomnil/runtime-typescript-checker-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/tomnil/runtime-typescript-checker-demo</a><br/>cd runtime-typescript-checker-demo<br/>npm install</span><span id="bdb5" class="mu lu in ls b gy no mw l mx my"># And then one of the following:</span><span id="a83e" class="mu lu in ls b gy no mw l mx my">npm run build-example1<br/>npm run build-example1-force</span><span id="32c4" class="mu lu in ls b gy no mw l mx my">npm run test-example1</span></pre><p id="f75a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在<a class="ae ks" href="https://github.com/tomnil/runtime-typescript-checker-demo" rel="noopener ugc nofollow" target="_blank">演示项目页面</a>上有更多信息。</p><h2 id="e274" class="mu lu in bd lv mz na dn lz nb nc dp md lc nd ne mf lg nf ng mh lk nh ni mj nj bi translated">享受</h2><p id="b0a8" class="pw-post-body-paragraph kt ku in kv b kw ml jo ky kz mm jr lb lc mn le lf lg mo li lj lk mp lm ln lo ig bi">:)</p><p id="4441" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="np">更多内容请看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="np">plain English . io</em></strong></a></p></div></div>    
</body>
</html>