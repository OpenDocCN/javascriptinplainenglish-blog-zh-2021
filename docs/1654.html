<html>
<head>
<title>Web Scraping 101: Introduction to Puppeteer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络搜集101:木偶师简介</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/web-scraping-101-intro-to-puppeteer-790ead85dd2?source=collection_archive---------10-----------------------#2021-04-09">https://javascript.plainenglish.io/web-scraping-101-intro-to-puppeteer-790ead85dd2?source=collection_archive---------10-----------------------#2021-04-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/08dc29b4ab2402864ebaf13f391c9eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DxceCIcubX7TEmy_xY-Nlg.png"/></div></div></figure><p id="8544" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">这篇文章使用Node.js和Puppeteer进入了网络抓取的水深火热之中。首先，我们将在VS代码中介绍</em> <strong class="jx io"> <em class="kt">设置木偶项目</em> </strong> <em class="kt">的基础知识。然后，我们将编写一些代码来执行</em> <strong class="jx io"> <em class="kt">登录，数据抓取，以及用</em><a class="ae ku" href="http://quotes.toscrape.com/" rel="noopener ugc nofollow" target="_blank"><em class="kt">【http://quotes.toscrape.com】</em></a><em class="kt">上的傀儡师进行</em> </strong> <em class="kt">。</em></p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><p id="bd1e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你已经找到了这篇文章，你可能知道什么是木偶师。但是对于那些刚刚入门的人来说，木偶师是全新的— <em class="kt">木偶师是一个节点库，它为用户提供了一个简单易用的API来控制Chrome，或者它不太为人所知的孪生兄弟Chrome，没有真正的浏览器窗口(无头)</em>。对于黑客和开发人员来说，无头浏览器功能有各种各样的使用案例。但是，在这个入门演示中没有任何用处！相反，我们将使用完整的浏览器配置。</p><p id="f08e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于这个演示，您需要在您的计算机上安装<a class="ae ku" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>以及<a class="ae ku" href="https://code.visualstudio.com/download" rel="noopener ugc nofollow" target="_blank"> VS Code </a>，或者您喜欢的IDE。(需要下载？单击该链接。)另外，打开<a class="ae ku" href="https://devdocs.io/puppeteer/" rel="noopener ugc nofollow" target="_blank">木偶师文档</a>参考。</p><p id="6b8e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们还是直接说代码吧。</p><h2 id="5eba" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated">首要任务:项目设置</h2><p id="be9e" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated"><strong class="jx io">创建您的项目文件夹</strong></p><blockquote class="ma mb mc"><p id="dd9f" class="jv jw kt jx b jy jz ka kb kc kd ke kf md kh ki kj me kl km kn mf kp kq kr ks ig bi translated">只有在使用终端时，才需要以下命令；您当然可以使用VS代码GUI来代替。</p></blockquote><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="e279" class="lc ld in ml b gy mp mq l mr ms">$ mkdir i-love-webscraping<br/>$ cd i-love-webscraping</span></pre><p id="385c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">初始化项目</strong></p><p id="7385" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在刚刚创建的项目文件夹中运行这行代码。您可以在所有初始化提示中按“Enter”键。该命令将在项目的根目录下生成一个“package.json”文件。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="c9c7" class="lc ld in ml b gy mp mq l mr ms">$ npm init</span></pre><p id="7342" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">安装木偶师</strong></p><p id="3c5a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该命令从节点安装puppeter包，在项目的根目录下生成一个“node_modules”文件夹，并更新“package.json”中的依赖项以包含最新版本的puppeter。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="fb11" class="lc ld in ml b gy mp mq l mr ms">$ npm install puppeteer</span></pre><p id="916c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">创建javascript文件</strong></p><p id="12f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个文件将保存你所有的代码。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="2471" class="lc ld in ml b gy mp mq l mr ms">$ touch iLoveToScrape.js</span></pre></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h2 id="5187" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated">第二件事第二:木偶表演时间</h2><p id="1532" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">让我们了解一下木偶师的基本情况。</p><p id="8961" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">继续将这段代码添加到JS文件中:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="b11d" class="lc ld in ml b gy mp mq l mr ms"><em class="kt">const</em> puppeteer = require("puppeteer");<br/>(async () <em class="kt">=&gt;</em> {<em class="kt"><br/>  const</em> browser = await puppeteer.launch({<br/>    headless: false, <br/>    slowMo: 250,<br/>  });<em class="kt"><br/>  const</em> page = await browser.newPage();<br/>  //<br/>  //add code here<br/>  //<br/>  await browser.close();<br/>})();</span></pre><p id="d308" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后使用以下命令运行它:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="1448" class="lc ld in ml b gy mp mq l mr ms">$ node iLoveToScrape </span></pre><p id="7ab6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果运行该文件时一切正常，您应该看到Chromium打开一个新的浏览器窗口，然后大约半秒钟后自动关闭它。</p><p id="ef76" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这段代码在做什么？ </p><p id="f7dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们要求在木偶师，并分配给一个变量。接下来，我们创建一个异步函数来包含我们所有的逻辑。由于许多Puppeteer方法异步运行，我们将需要使用await——将我们的代码包装在异步函数中允许我们使用await关键字。在我们的异步函数中，使用await和launch()方法创建一个浏览器实例。为了在程序运行时查看浏览器窗口，我们将headless选项设置为“false”。我们还将slowMo选项设置为250，这将使操纵木偶者的操作慢250毫秒。(一旦有更多的代码要处理，尝试删除或调整sloMo和/或headless，看看会发生什么！)然后，我们在browser实例上调用newPage()方法来获得一个新的Page对象，我们将在整个代码中使用它。最后，在异步函数的最后，我们调用浏览器实例上的close()方法来关闭浏览器。</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h2 id="56fc" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated">好的。现在让我们给这些骨头添加一些肉:</h2><p id="7fb2" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">在调用<code class="fe mt mu mv ml b">newPage()</code>之后，在异步函数中添加以下代码</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="b257" class="lc ld in ml b gy mp mq l mr ms">await page.goto("http://quotes.toscrape.com", {<br/>waitUntil: "networkidle2",<br/>});</span><span id="d3af" class="lc ld in ml b gy mw mq l mr ms">await page.click(".col-md-4 a");</span><span id="7e5d" class="lc ld in ml b gy mw mq l mr ms">await page.focus("#username");<br/>await page.keyboard.type("rei.ayanami@hotmail.com");</span><span id="2d66" class="lc ld in ml b gy mw mq l mr ms">await page.focus("#password");<br/>await page.keyboard.type("123");<br/>await page.keyboard.press("Enter");</span></pre><p id="b771" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请尝试再次运行您的代码。如果它仍然正常运行，您应该会看到Puppeteer打开浏览器，重定向到网页，单击登录按钮，使用用户名和密码登录，重定向到主页，最后关闭浏览器。(顺便说一句，现在是使用sloMo选项的好时机。)</p><p id="2069" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">该解剖肉了。有关更多信息，请查阅木偶师文档。</strong></p><p id="4be0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">goto()</code> —获取您要转到的网站的url。<em class="kt"> </em>传递给第二个参数的实参告诉程序等待500毫秒，直到没有超过两个网络连接，换句话说，它说“等到页面完全加载。”</p><p id="e366" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">click() </code> —接受一个选择器并模拟元素上的点击。</p><p id="8dee" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">focus() </code> —取一个选择器并聚焦于它。焦点意味着任何键盘输入都将被聚焦的元素接收。(即。输入字段)</p><p id="e5e6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">keyboard.type() </code> —接受文本以键入焦点元素。</p><p id="8adc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">keyboard.press() </code> —接受一个带有按键名称的字符串(即。输入'，'向下箭头')</p><p id="c902" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">很酷的方法，但是它们对我们的例子有什么作用呢？</strong></p><p id="41b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我们导航到站点，等待页面加载<code class="fe mt mu mv ml b">goto()</code>。一旦页面完全加载，我们使用<code class="fe mt mu mv ml b">click()</code>获取登录页面的链接并点击它。在重定向到登录页面后，我们在用户名输入字段上<code class="fe mt mu mv ml b">focus()</code>，并进入字段。然后，我们重复<code class="fe mt mu mv ml b">focus()</code>，并在密码字段中键入()。最后，我们使用<code class="fe mt mu mv ml b">keyboard.press()</code>点击“Enter ”,提交表单，让我们登录，并重定向到主页。</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h2 id="f05f" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated"><strong class="ak">该给这顿饭加点料了:</strong></h2><p id="cbb5" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">在我们按下“Enter”并重定向到主页后添加此代码…</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="3091" class="lc ld in ml b gy mp mq l mr ms">//you may or may not need to include this first line depending on the sloMo value you have chosen<br/>//await page.waitForNavigation("networkidle2");<br/><em class="kt">let</em> data = await page.evaluate(() <em class="kt">=&gt;</em> {<br/>  <em class="kt">let</em> quoteDivs = document.querySelectorAll(".quote");<br/><em class="kt">  let</em> quotes = [];<br/>  quoteDivs.forEach((<em class="kt">quote</em>) <em class="kt">=&gt;</em> {<br/><em class="kt">    let</em> text = <em class="kt">quote</em>.querySelector(".text").innerHTML;<br/><em class="kt">    let</em> author = <em class="kt">quote</em>.querySelector(".author").innerHTML;<br/>    quotes.push({ text, author });<br/>  });<br/>  return quotes;<br/>});<br/>console.log(data);</span></pre><p id="bdd2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您用这些添加的代码运行程序时，您不会在浏览器中看到任何变化。然而，你<em class="kt">将</em> <em class="kt">看到</em>所有从控制台登录的第一页刮下的报价。</p><p id="0638" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">这里没什么疯狂的… </strong></p><p id="72f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">尽管这是我们实际抓取逻辑的主要部分，但我们只使用了两个新的操纵方法。</p><p id="190f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">waitForNavigation()</code> —当页面重定向到不同的URL或重新加载时使用。<em class="kt">有必要</em>包括<em class="kt">未</em>使用sloMo时，以等待新内容加载。</p><p id="34f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe mt mu mv ml b">evaluate()</code> —接受一个函数作为参数，让我们在浏览器中执行JS。</p><p id="35e6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，我们如何收集数据呢？在我们的evaluate函数中，我们首先用class '获取页面上的所有div。引用。接下来，我们使用forEach遍历HTML集合中的所有元素。对于每个报价，我们选择文本和作者<em class="kt">元素。我们使用innerHTML属性获取这些元素中的字符串，然后保存到文本和作者变量中。我们将这些变量作为对象属性推送到引号数组中，并返回该数组。您会注意到<code class="fe mt mu mv ml b">page.evaluate()</code>被设置为变量‘data’，我们在最后一行对其进行了console.log。这是因为evaluate()方法返回自变量函数</em>的<em class="kt">返回值。因为我们返回一个引号数组，所以该数组被设置为数据变量。最后，我们在最后一行console.log包含引号数组的数据变量。瞧啊。网页抓取。</em></p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h2 id="a291" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated"><strong class="ak">加个装饰怎么样，只是为了好玩:</strong></h2><p id="7dbf" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">假设您想要分页以获取前三页的所有引用，并且您想要将数据保存在一个文本文件中，而不仅仅是记录在控制台中。</p><p id="cac0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一步是去掉<code class="fe mt mu mv ml b">console.log()</code>并用下面的代码替换它…</p><p id="06b0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将遍历对象的数据数组，并将数据作为字符串添加到一个新文件中。这将在项目文件夹中生成一个新的文本文件，其中包含所有引文和作者姓名，用空行隔开。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="1bc8" class="lc ld in ml b gy mp mq l mr ms"><em class="kt">let</em> dataAsText = "";<br/>data.forEach((<em class="kt">quote</em>) <em class="kt">=&gt;</em> {<br/>  dataAsText += `${<em class="kt">quote</em>.text} \n ${<em class="kt">quote</em>.author} \n\n`;<br/>});<br/>fs.appendFileSync("TopQuotes.txt", dataAsText);</span></pre><p id="3329" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还需要在文件的最顶部安装fs模块:</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="fb67" class="lc ld in ml b gy mp mq l mr ms"><em class="kt">const</em> fs = require("fs");</span></pre><p id="4305" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在要分页…在浏览器上方添加以下代码。close()调用:</p><p id="8ae2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在页面上滚动，直到“下一页”链接出现，然后我们点击它。</p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="7645" class="lc ld in ml b gy mp mq l mr ms">await page.evaluate(() <em class="kt">=&gt;</em> {<br/>  window.scrollBy(0, window.innerHeight);<br/>});<br/>await page.waitForSelector(".pager");<br/>await page.click(".next a");</span></pre><p id="c01e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将从page.evaluate()到browser.close()之前的所有内容放在for循环中，以遍历您想要抓取的任意多个页面的代码。</p><p id="884b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在运行之前，请确保清除文本文件或提供一个新的路径，否则，它将追加到已经存在的内容。</p></div><div class="ab cl kv kw hr kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ig ih ii ij ik"><h2 id="f0f7" class="lc ld in bd le lf lg dn lh li lj dp lk kg ll lm ln kk lo lp lq ko lr ls lt lu bi translated">总之+ TLDR</h2><p id="0cd2" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">本文向您展示了如何建立一个简单的木偶项目。包括:导航到页面、自动登录、从多个页面抓取数据以及将数据保存到文本文件。</p><p id="4682" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你，因为你成功了，所以我在下面附上了完整的代码。如果你通过跳过阅读来节省时间，不要忘记做这些最初的几个准备步骤！</p><p id="e0f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">设置:</strong></p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="5c7b" class="lc ld in ml b gy mp mq l mr ms">$ mkdir scraping-is-cool<br/>$ cd scraping-is-cool<br/>$ npm init<br/>$ npm install puppeteer</span></pre><p id="fc96" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">完整代码:</strong></p><pre class="mg mh mi mj gt mk ml mm mn aw mo bi"><span id="190e" class="lc ld in ml b gy mp mq l mr ms"><em class="kt">const</em> puppeteer = require("puppeteer");<br/><em class="kt">const</em> fs = require("fs");</span><span id="bc20" class="lc ld in ml b gy mw mq l mr ms">(async () <em class="kt">=&gt;</em> {</span><span id="ee67" class="lc ld in ml b gy mw mq l mr ms"><em class="kt">//initialize browser <br/>  const</em> browser = await puppeteer.launch({<br/>    headless: false,<br/>    slowMo: 250,<br/>  });</span><span id="0668" class="lc ld in ml b gy mw mq l mr ms"><em class="kt">  const</em> page = await browser.newPage();</span><span id="e970" class="lc ld in ml b gy mw mq l mr ms">//goes to url, waits until no more network requests being made<br/>  await page.goto("http://quotes.toscrape.com/", {<br/>    waitUntil: "networkidle2",<br/>  });</span><span id="acca" class="lc ld in ml b gy mw mq l mr ms">//click login link to navigate to login page<br/>  await page.click(".col-md-4 a");</span><span id="50a5" class="lc ld in ml b gy mw mq l mr ms">//complete login form<br/>  await page.focus("#username");<br/>  await page.keyboard.type("shinji.ikari@email.com");</span><span id="1252" class="lc ld in ml b gy mw mq l mr ms">  await page.focus("#password");<br/>  await page.keyboard.type("123");<br/>  await page.keyboard.press("Enter");</span><span id="552b" class="lc ld in ml b gy mw mq l mr ms">//uncomment following line if you remove slowMo option<br/>  //await page.waitForNavigation("networkidle2");</span><span id="8fa5" class="lc ld in ml b gy mw mq l mr ms">//loop for number of pages you want to scrape<br/>  for (<em class="kt">let</em> i = 0; i &lt; 3; i++) {</span><span id="8d84" class="lc ld in ml b gy mw mq l mr ms"><em class="kt">    let</em> data = await page.evaluate(() <em class="kt">=&gt;</em> {<br/>//get all quote divs from page<br/><em class="kt">      let</em> quoteDivs = document.querySelectorAll(".quote");<br/><em class="kt">      let</em> quotes = [];</span><span id="2bdb" class="lc ld in ml b gy mw mq l mr ms">      quoteDivs.forEach((<em class="kt">quote</em>) <em class="kt">=&gt;</em> {<br/>//get quote text and author for each quote<br/><em class="kt">        let</em> text = <em class="kt">quote</em>.querySelector(".text").innerHTML;<br/><em class="kt">        let</em> author = <em class="kt">quote</em>.querySelector(".author").innerHTML;<br/>        quotes.push({ text, author });<br/>      });</span><span id="db64" class="lc ld in ml b gy mw mq l mr ms">      return quotes;<br/>    });</span><span id="9e21" class="lc ld in ml b gy mw mq l mr ms">//Outputting scraped data</span><span id="89f4" class="lc ld in ml b gy mw mq l mr ms">// console.log(data);<br/><em class="kt">  let</em> dataAsText = "";<br/>  data.forEach((<em class="kt">quote</em>) <em class="kt">=&gt;</em> {<br/>    dataAsText += `${<em class="kt">quote</em>.text} \n ${<em class="kt">quote</em>.author} \n\n`;<br/>  });<br/>  console.log(dataAsText);<br/>  fs.appendFileSync("TopQuotes.txt", dataAsText);</span><span id="3c72" class="lc ld in ml b gy mw mq l mr ms">//scroll to the bottom of the page and go to next page<br/>  await page.evaluate(() <em class="kt">=&gt;</em> {<br/>    window.scrollBy(0, window.innerHeight);<br/>  });<br/>  await page.waitForSelector(".pager");<br/>  await page.click(".next a");<br/>}</span><span id="3463" class="lc ld in ml b gy mw mq l mr ms">await browser.close();<br/>})();</span></pre><p id="c058" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢您的阅读！</p><p id="593c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">更多内容尽在</em><a class="ae ku" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="kt">plain English . io</em></a></p></div></div>    
</body>
</html>