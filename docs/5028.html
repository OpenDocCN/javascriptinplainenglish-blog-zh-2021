<html>
<head>
<title>How to Handle Different Environments in a Next.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Next.js应用程序中处理不同的环境</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-handle-different-environments-in-a-next-js-application-8dc4aef6ad9b?source=collection_archive---------1-----------------------#2021-10-12">https://javascript.plainenglish.io/how-to-handle-different-environments-in-a-next-js-application-8dc4aef6ad9b?source=collection_archive---------1-----------------------#2021-10-12</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="3921" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">关于Next.js中的环境变量，您需要知道的一切</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/3452972c87d6a22f6d3258832493be67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_X0W0DWFqeML0xcWspyQA.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Credit: Pixabay Free Photos</figcaption></figure><p id="0a65" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">处理多种环境是任何现代应用程序必不可少的一部分。我们不想在开发和生产过程中混淆我们的秘密。</p><p id="8a96" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">今天，我们将看到一个如何通过环境变量在Next.js应用程序中管理多个环境的实际例子。</p><p id="02c1" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">我们开始吧。</p><h1 id="9df9" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">步骤1:创建一个项目</h1><p id="94b8" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">如果您已经有一个正在运行的Next.js应用程序，请转到步骤2。否则，从终端运行以下命令</p><pre class="kh ki kj kk gu mp mq mr ms aw mt bi"><span id="300b" class="mu lt ir mq b gz mv mw l mx my">yarn create next-app next-environment-demo</span></pre><p id="dd0e" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这将为您创建一个新的Next.js应用程序。</p><h1 id="ce6a" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">步骤2:了解变量类型</h1><p id="b85d" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">转到项目根文件夹，创建一个名为<code class="fe mz na nb mq b">.env.local</code>的新文件。这将是我们的第一个环境文件。随着我们的前进，我们将创造其他人。</p><p id="eabc" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">有两种类型的环境变量。一些变量向浏览器公开，而其他变量则不公开。让我们将下面一行写入我们的环境文件。</p><pre class="kh ki kj kk gu mp mq mr ms aw mt bi"><span id="5fd3" class="mu lt ir mq b gz mv mw l mx my">SOME_SECRET = this_is_a_secret</span></pre><p id="8ed9" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">现在，变量SOME_SECRET只能从服务器环境中访问。例如在<code class="fe mz na nb mq b">getStaticProps</code>中，我们可以像下面这样访问变量。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="8f15" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是如果你试图在浏览器中访问它们(这意味着在你的可视组件的代码中)，它会返回<code class="fe mz na nb mq b">undefined</code></p><p id="b1d9" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">所以只有当你想在前端存储一些不需要的秘密时才使用它。(例如不同支付集成的密钥)</p><p id="a6c6" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是如果你想让一些变量暴露给浏览器，你需要在秘密前面加上前缀<code class="fe mz na nb mq b">NEXT_PUBLIC_</code></p><pre class="kh ki kj kk gu mp mq mr ms aw mt bi"><span id="e835" class="mu lt ir mq b gz mv mw l mx my">NEXT_PUBLIC_SOME_SECRET = this_is_a_browser_exposed_secret</span></pre><p id="9565" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">现在在你的组件内部，你可以得到这样的值。</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="nc nd l"/></div></figure><p id="82ad" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这将正确地打印值。</p><h1 id="cc37" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">不同的环境</h1><p id="86c2" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">现在，环境变量的主要用途是能够为不同的环境更改值。例如，如果您正在使用条带，那么您就不希望在开发时使用活动密钥。</p><p id="f6e0" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">那么我们如何做到这一点呢？一种方法是在开发时更改密钥，并在上线时再次更改。</p><p id="5fb4" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是它可扩展吗？显然不是。让我们看看如何处理这个问题。</p><p id="dc73" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">创建两个新文件，分别命名为<code class="fe mz na nb mq b">.env.development</code>、<code class="fe mz na nb mq b">.env.production</code>。所以现在你应该有3个环境文件。</p><ol class=""><li id="c1d0" class="ne nf ir ky b kz la lc ld lf ng lj nh ln ni lr nj nk nl nm bi translated"><code class="fe mz na nb mq b">.env.local</code> - &gt;该文件可用于任何值</li></ol><p id="fa04" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这意味着该文件中的值将在任何环境中加载。</p><p id="5305" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">2.<code class="fe mz na nb mq b">.env.development</code> - &gt;仅开发所需的值</p><p id="061e" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这意味着这些值将在运行<code class="fe mz na nb mq b">next dev</code>命令时生成。所以把开发秘密留在这里</p><p id="6fa4" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">3.<code class="fe mz na nb mq b">.env.production</code> - &gt;将仅是生产所需的值</p><p id="7a64" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">这意味着运行<code class="fe mz na nb mq b">next start</code>命令时将要加载的值。在这里保守生产秘密。</p><blockquote class="nn no np"><p id="258d" class="kw kx nq ky b kz la js lb lc ld jv le nr lg lh li ns lk ll lm nt lo lp lq lr ik bi translated">请记住，<code class="fe mz na nb mq b">.env.local</code>将覆盖<code class="fe mz na nb mq b">.development</code>或<code class="fe mz na nb mq b">.production</code>文件上的任何内容。</p></blockquote><p id="1e34" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">仅此而已。你不需要担心其他任何事情。如果您定义了一个名为</p><pre class="kh ki kj kk gu mp mq mr ms aw mt bi"><span id="0109" class="mu lt ir mq b gz mv mw l mx my">NEXT_PUBLIC_SECRET = a   // inside .env.development</span><span id="57e5" class="mu lt ir mq b gz nu mw l mx my">NEXT_PUBLIC_SECRET = b   // inside .env.production</span></pre><p id="4054" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">然后当你访问<code class="fe mz na nb mq b">process.env.NEXT_PUBLIC_SECRET</code>时，当你正在开发时，它会给出<code class="fe mz na nb mq b">a</code>，如果你正在生产，它会产生<code class="fe mz na nb mq b">b</code>。</p><p id="5947" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">就这么简单！</p><h1 id="588c" class="ls lt ir bd lu lv lw lx ly lz ma mb mc jx md jy me ka mf kb mg kd mh ke mi mj bi translated">在Vercel上定义:最佳实践</h1><p id="cf16" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated">你永远不应该在GitHub这样的源代码控制系统中包含你的环境变量。</p><p id="71f1" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">那么，当您准备部署应用程序时，应该做些什么呢？</p><p id="dbe3" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">一种选择是在部署之前手动添加文件(如果您自己管理您的部署)</p><p id="9a4e" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">但是如果您在下一个js应用程序部署中使用<code class="fe mz na nb mq b">vercel</code>(您应该这样做),那么请转到<code class="fe mz na nb mq b">Project Settings</code></p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nv"><img src="../Images/3c43613a7d00e4c6122925cfbbb959a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eUi_Yu0OLi8tbtvYNMBSfg.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Project Settings Tab on Vercel</figcaption></figure><p id="49f6" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">在这里你可以选择<code class="fe mz na nb mq b">Environment Variables</code>并在那里定义你的秘密。</p><p id="043a" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">像下面这样</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nv"><img src="../Images/60ce0c1c72abfaae12740e840fe98387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fq-0TMrsL-8rLDjVhRgs2g.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Vercel Dashboard</figcaption></figure><p id="5f06" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">所以你走吧。现在您知道了如何在下一个js应用程序中管理环境变量。</p><p id="1843" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated">祝您愉快！</p><p id="a181" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><strong class="ky is">通过</strong><a class="ae nw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="ky is">LinkedIn</strong></a><strong class="ky is">或我的</strong> <a class="ae nw" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky is">个人网站</strong> </a> <strong class="ky is">与我取得联系。</strong></p><h2 id="32cf" class="mu lt ir bd lu nx ny dn ly nz oa dp mc lf ob oc me lj od oe mg ln of og mi oh bi translated">资源:</h2><p id="dd79" class="pw-post-body-paragraph kw kx ir ky b kz mk js lb lc ml jv le lf mm lh li lj mn ll lm ln mo lp lq lr ik bi translated"><a class="ae nw" href="https://nextjs.org/docs/basic-features/environment-variables" rel="noopener ugc nofollow" target="_blank">https://nextjs . org/docs/basic-features/environment-variables</a></p><p id="de79" class="pw-post-body-paragraph kw kx ir ky b kz la js lb lc ld jv le lf lg lh li lj lk ll lm ln lo lp lq lr ik bi translated"><em class="nq">更多内容请看</em><a class="ae nw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky is"><em class="nq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>