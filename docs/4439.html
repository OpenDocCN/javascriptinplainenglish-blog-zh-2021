<html>
<head>
<title>Pre-render Dynamic Routes with Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Next.js预渲染动态路线</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/pre-rendering-dynamic-routes-with-nextjs-9bca622c6677?source=collection_archive---------6-----------------------#2021-09-04">https://javascript.plainenglish.io/pre-rendering-dynamic-routes-with-nextjs-9bca622c6677?source=collection_archive---------6-----------------------#2021-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bb8d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在这篇博文中，你将学习如何使用NextJS结合MongoDB来预渲染带有动态路径的站点</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9e70005f230bf985718e1cc5ca3f5196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6h8toYY7v_HfN--WXkMKJA.png"/></div></div></figure><p id="1f3d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在我以前的文章中，我描述了如何<a class="ae ln" href="https://medium.com/@kevintomas1994/integrating-mongodb-to-nextjs-f7038f90051a" rel="noopener">将MongoDB集成到Next.js </a>，以及如何<a class="ae ln" href="https://medium.com/@kevintomas1994/storing-data-to-mongodb-with-nextjs-6372319d498b" rel="noopener">用Next.js </a>将数据存储到MongoDB。如果您需要更新关于NextJs的知识，请随时查看这些故事。</p><p id="ea5a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我们将讨论如何使用Next.js预渲染动态路线。一个典型的用例可以是个人博客，其中有几篇文章，它们都有自己的URL:<a class="ae ln" href="https://mypersonalblog/[dynamicRoute" rel="noopener ugc nofollow" target="_blank">https://mypersonalblog/[dynamic route</a>。我将引入一个名为<code class="fe lo lp lq lr b">getStaticPaths</code>的新概念，需要它来定义将被预渲染的路径列表。</p><h2 id="21b2" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">定义要预渲染的路线</h2><p id="54f3" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">一般目录结构可能如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/32e6e4f7a731bca5e32706c1117f9c14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*W1Zc7KAFO843wb53vdWCJg.jpeg"/></div></figure><p id="f8f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您会注意到blogId目录写在<strong class="kt ir">方括号中，</strong>表示这将是一个<strong class="kt ir">动态路由</strong>！blogId只是博客文章的实际Id的占位符，它将被呈现。下面您可以找到<strong class="kt ir"> getStaticPaths() </strong>函数，它将位于<strong class="kt ir">【blogId】</strong>目录中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="2b91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个函数有趣的部分确实发生在return语句中。在此之前，我们连接到我们的数据库，并将我们博客帖子的所有id存储在常量数据中。</p><p id="4764" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在return语句中，我们定义的第一件事是<strong class="kt ir"> fallback键。这定义了NextJs将如何处理路径(在我们的例子中是blogIds ),这些路径并不存在。后退可以设置为“真”、“假”和“阻止”。</strong></p><p id="a389" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果fallback为<strong class="kt ir">假</strong>，那么在上面的函数中没有定义的任何路径将导致一个<strong class="kt ir"> 404页面</strong>。如果fallback被设置为<strong class="kt ir"> true，</strong> NextJs将呈现你的站点的一个回退页面。最后，如果fallback是<strong class="kt ir">阻塞</strong>并且输入了一个不存在的路径，NextJs将在第一次请求时进行SSR并返回生成的HTML(但是在这种情况下没有任何博客数据),这个路径将被添加到预呈现页面的列表中。</p><p id="b95d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们的<code class="fe lo lp lq lr b">getStaticPaths</code>函数的返回语句中的第二个键是<code class="fe lo lp lq lr b">paths.</code>,它决定哪些路径将被预渲染。在这种情况下，我们迭代我们的常量<code class="fe lo lp lq lr b">data</code>中的所有数据点，并且我们只存储<strong class="kt ir"> blogId </strong>，因为这是这里唯一感兴趣的东西。你会注意到，我不得不将带有<code class="fe lo lp lq lr b">datapoint._id.toString()</code>的实际ID<strong class="kt ir">转换成一个字符串。这是因为MongoDB没有将自动生成的ID存储为字符串，而是存储为一个特殊的对象。</strong></p><h2 id="2920" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">定义要预呈现的内容</h2><p id="309e" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">在下面的<code class="fe lo lp lq lr b">getStaticProps</code>函数中，我们为某篇博客文章定义了要预先呈现的实际内容。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="95aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">引入了一个新概念，这在我以前的文章中还没有涉及到。这是<strong class="kt ir">上下文</strong>参数，我们将其传递给<code class="fe lo lp lq lr b">getStaticProps</code>函数。该参数包含几个键，如参数、预览等。在本帖中，我们将只仔细看看<strong class="kt ir"> params </strong>键。</p><p id="5d71" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Params为使用动态路由的页面携带路由参数，这实际上是我们之前在<code class="fe lo lp lq lr b">getStaticPaths</code>函数中定义的！所以通过<code class="fe lo lp lq lr b">context.params.blogId</code>，我们可以访问当前的<strong class="kt ir"> blogId。</strong></p><p id="e119" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是我们为什么需要blogId，”，你可能会问。如果你看一下上面代码的第11行，你会发现我们再次重用了blogId。在<code class="fe lo lp lq lr b">yourCollection.findOne({_id: ObjectId(blogId),})</code>中，我们使用blogId在我们所有的博客文章中搜索这个blogId。然后，这个数据将在<code class="fe lo lp lq lr b">return</code>语句中使用，将其存储在params键中，该键将由实际的页面组件接收。</p><p id="d1af" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个例子中，我们希望收到一个id、一个标题、一个描述、一个图像和一个内容，这些内容稍后可以在实际的页面组件中使用。代码中最后一个有趣的键是<strong class="kt ir">revidate。</strong>通过<strong class="kt ir"> </strong>默认它的值被设置为false但是在这里我们把它设置为1。这意味着NextJs将在每次收到请求时尝试重新生成页面，并且每1秒钟再生成<strong class="kt ir">和</strong>！所以说实话，在个人博客的情况下，把revalidate设置为一秒没有太大意义，因为你博客上的数据不会更新那么频繁。它放在这里是为了演示。</p><p id="25dc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是关于定义NextJs要预渲染的路线和内容的大部分内容！</p><h2 id="e5d5" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated">在页面组件中使用预先呈现的数据</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="115e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个简短的例子，说明了如何使用通过<strong class="kt ir"> props </strong>参数传递的组件中的数据。你可以注意到我们在<strong class="kt ir"> Head </strong>组件中动态添加了元数据，这对SEO优化你的页面内容非常有用。在此之下，我们在一个定制的BlogDetail组件中使用其余的数据。</p><h2 id="4ce7" class="ls lt iq bd lu lv lw dn lx ly lz dp ma la mb mc md le me mf mg li mh mi mj mk bi translated"><strong class="ak">结论</strong></h2><p id="2dde" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">因此，在这篇博文中，你有望了解到如何结合使用Next.js和MongoDB来预渲染带有动态路由的站点。如果你喜欢这个内容，请在评论中告诉我，并随时关注我的medium.com！</p><p id="4578" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在下一篇博文中，我将讲述如何用Next.js实现一个全功能的认证流程！感谢您的关注，再见！</p><p id="f1f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="mt">更多内容请看</em><a class="ae ln" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="mt">plain English . io</em></strong></a></p></div></div>    
</body>
</html>