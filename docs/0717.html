<html>
<head>
<title>Writing Server-Side Apps with Deno</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Deno编写服务器端应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/getting-started-with-writing-server-side-apps-for-the-deno-runtime-environment-f2a02955c4db?source=collection_archive---------17-----------------------#2021-02-13">https://javascript.plainenglish.io/getting-started-with-writing-server-side-apps-for-the-deno-runtime-environment-f2a02955c4db?source=collection_archive---------17-----------------------#2021-02-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/38656b091ded7d22ea5e575446236ac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qcj6N06urxHZ0r8D"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@katanassov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kamen Atanassov</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b6c9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deno是一个新的服务器端运行时环境，用于运行JavaScript和TypeScript应用程序。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始为Deno开发应用程序。</p><h1 id="a7d5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="d236" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Deno作为一个单独的可执行文件发布，没有依赖性。</p><p id="3620" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以很容易地安装它们。</p><p id="e50d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它可以在多个平台上使用。</p><p id="3485" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以运行以下命令来安装它们:</p><p id="7255" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Shell (Mac、Linux):</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="99d2" class="mn lc iq mj b gy mo mp l mq mr">$ curl -fsSL https://deno.land/x/install/install.sh | sh</span></pre><p id="44ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PowerShell (Windows):</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="3505" class="mn lc iq mj b gy mo mp l mq mr">$ iwr https://deno.land/x/install/install.ps1 -useb | iex</span></pre><p id="c4c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">自制软件(Mac):</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="319b" class="mn lc iq mj b gy mo mp l mq mr">$ brew install deno</span></pre><p id="bfa2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://chocolatey.org/packages/deno" rel="noopener ugc nofollow" target="_blank">巧克力</a> (Windows):</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8e6d" class="mn lc iq mj b gy mo mp l mq mr">$ choco install deno</span></pre><p id="3e50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae kc" href="https://scoop.sh/" rel="noopener ugc nofollow" target="_blank">勺</a> (Windows):</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f0eb" class="mn lc iq mj b gy mo mp l mq mr">$ scoop install deno</span></pre><p id="a6e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用货物从源头构建和安装</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="ac20" class="mn lc iq mj b gy mo mp l mq mr">$ cargo install deno</span></pre><h1 id="7d4f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">入门指南</h1><p id="354f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要创建hello world应用程序，我们可以编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5611" class="mn lc iq mj b gy mo mp l mq mr">console.log("hello world");</span></pre><p id="717c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">console</code>在Deno运行时可用。</p><p id="c61b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过编写以下代码创建一个简单的服务器应用程序:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="20d7" class="mn lc iq mj b gy mo mp l mq mr">import { serve } from "https://deno.land/std@0.75.0/http/server.ts";<br/>const s = serve({ port: 8000 });<br/>console.log("http://localhost:8000/");<br/>for await (const req of s) {<br/>  req.respond({ body: "Hello World\n" });<br/>}</span></pre><p id="59fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们直接从URL导入<code class="fe ms mt mu mj b">server</code>模块。</p><p id="b520" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe ms mt mu mj b">serve</code>来创建我们的服务器。</p><p id="b636" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过循环遍历<code class="fe ms mt mu mj b">s</code>数组来监听请求，并用<code class="fe ms mt mu mj b">req.respond</code>发送我们的响应。</p><p id="2ce7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们应该在浏览器屏幕上看到“Hello world”。</p><h1 id="3520" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">发出HTTP请求</h1><p id="b7b2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下内容来发出HTTP请求:</p><p id="cf98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.ts</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a1bb" class="mn lc iq mj b gy mo mp l mq mr">const [url] = Deno.args;<br/>const res = await fetch(url);<br/>const body = new Uint8Array(await res.arrayBuffer());<br/>await Deno.stdout.write(body);</span></pre><p id="f174" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们进入项目，通过运行以下命令来运行它:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="4215" class="mn lc iq mj b gy mo mp l mq mr">deno run --allow-net index.ts https://yesno.wtf/api</span></pre><p id="ca79" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">访问网络需要<code class="fe ms mt mu mj b">--allow-net</code>选项。</p><p id="00db" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">Deno.args</code>让我们获得命令行参数。</p><p id="a35e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">fetch</code>让我们用给定的<code class="fe ms mt mu mj b">url</code>发出HTTP请求。</p><p id="08dc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过调用<code class="fe ms mt mu mj b">res.arrayBuffer</code>解析主体来获得请求。</p><p id="d610" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe ms mt mu mj b">Deno.stdout.write</code>将响应写到屏幕上。</p><h1 id="caee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">读取文件</h1><p id="7486" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Deno提供了开箱即用读取文件的方法。</p><p id="e5e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="d582" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">index.ts</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="03a7" class="mn lc iq mj b gy mo mp l mq mr">const filenames = Deno.args;<br/>for (const filename of filenames) {<br/>  const file = await Deno.open(filename);<br/>  await Deno.copy(file, Deno.stdout);<br/>  file.close();<br/>}</span></pre><p id="2298" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe ms mt mu mj b">Deno.args</code>获取文件路径。</p><p id="5bdc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们循环通过<code class="fe ms mt mu mj b">filenames</code>并调用<code class="fe ms mt mu mj b">Deno.open</code>来打开文件。</p><p id="46ab" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe ms mt mu mj b">Deno.copy</code>将文件内容复制到<code class="fe ms mt mu mj b">stdout</code>来显示在屏幕上。</p><p id="47a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们完成时，我们调用<code class="fe ms mt mu mj b">file.close</code>来关闭文件句柄。</p><p id="9328" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们奔跑的时候。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dbfd" class="mn lc iq mj b gy mo mp l mq mr">deno run --allow-read index.ts files/bar.txt files/foo.txt</span></pre><p id="6cee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且假设<code class="fe ms mt mu mj b">files/bar.txt</code>和<code class="fe ms mt mu mj b">files/foo.txt</code>存在，那么我们应该看到显示的每个文件的内容。</p><p id="2b39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">--allow-read</code>标志让我们允许从文件系统中读取文件。</p><h1 id="68bc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="68d9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以创建简单的服务器端JavaScript或TypeScript应用程序，并用Deno运行时运行它们。</p></div></div>    
</body>
</html>