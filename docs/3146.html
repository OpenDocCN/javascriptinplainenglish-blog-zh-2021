<html>
<head>
<title>A Look Under The Proverbial Hood Of A JavaScript Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">看看众所周知的JavaScript引擎</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-look-under-the-proverbial-hood-of-a-javascript-engine-3f10f6bb4a66?source=collection_archive---------19-----------------------#2021-06-25">https://javascript.plainenglish.io/a-look-under-the-proverbial-hood-of-a-javascript-engine-3f10f6bb4a66?source=collection_archive---------19-----------------------#2021-06-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fec4d8da941f887c3f71a51b531ebd07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsymsIPXDsepujNDZhkL9w.jpeg"/></div></div></figure><p id="7610" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JavaScript引擎是<a class="ae kt" href="https://www.codecademy.com/articles/introduction-to-javascript-runtime-environments" rel="noopener ugc nofollow" target="_blank"> JavaScript运行时环境</a>的一部分。运行时环境是一个容器，包含了运行JavaScript代码所需的所有部分。它使Javascript能够在浏览器和节点中运行。</p><p id="8316" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除了引擎之外，运行时环境还包含API、事件循环和回调队列(根据所使用的运行时环境，可能还有一些其他部分)。</p><p id="6cd9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">JavaScript引擎是运行时环境的核心，负责ECMAScript源代码的解析、编译和执行。</strong></p><h2 id="68cf" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">不同的JavaScript引擎</h2><p id="02f0" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">有许多不同的JavaScript引擎。最值得注意的是，你可能听说过<a class="ae kt" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank">谷歌的V8引擎</a>，它被用来驱动Chrome浏览器和Node.js中的JavaSript环境</p><p id="bd9f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一个流行的引擎是SpiderMonkey，它支持Mozilla Firefox浏览器中的运行时环境——每个主流浏览器都有自己的引擎。</p><p id="7ee4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">点击查看发动机<a class="ae kt" href="https://en.wikipedia.org/wiki/List_of_ECMAScript_engines" rel="noopener ugc nofollow" target="_blank">的详细列表。</a></p><h2 id="1666" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">不同的JavaScript运行时环境</h2><p id="3db2" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">虽然浏览器和Node.js可以共享相同的JavaScript引擎，但它们永远不会有相同的运行时环境。这两种环境需要满足非常不同的需求。</p><p id="cbc5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，浏览器中的运行时环境允许您访问API，如<em class="ls"> fetch </em>、<em class="ls"> localStorage </em>，以及与窗口和DOM对象交互的能力。</p><p id="3843" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在节点环境中，没有窗口或DOM对象，所以没有理由与它们交互，相反，您可以访问不同的API，如模块，它们允许通过文件系统访问来实现功能。它们还共享一些API，比如<em class="ls"> setTimeout </em>和<em class="ls">控制台</em> API。</p><p id="ebce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不同的环境可以容纳许多不同的API来满足应用程序的需求，但是不同的JavaScript引擎通常以非常相似的方式工作。</p><h1 id="548a" class="lt kv in bd kw lu lv lw kz lx ly lz lc ma mb mc lf md me mf li mg mh mi ll mj bi translated">更深入地了解JavaScript引擎</h1><p id="346a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">所有的JavaScript引擎都有三个主要职责:源代码的<strong class="jx io">解析</strong>、<strong class="jx io">编译</strong>和<strong class="jx io">执行</strong>。</p><h2 id="6f64" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">从语法上分析</h2><p id="018b" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">首先，必须下载源代码。然后对其进行扫描并转换成代币。然后，<a class="ae kt" href="https://v8.dev/blog/preparser" rel="noopener ugc nofollow" target="_blank">语法解析器</a>会“消费”这些标记，并创建一棵<a class="ae kt" href="https://itnext.io/ast-for-javascript-developers-3e79aeb08343" rel="noopener ugc nofollow" target="_blank">抽象语法树</a>(或AST)。AST是用编程语言编写的语法源代码结构的分层树表示，每个AST节点对应于源代码中的一个构造。</p><p id="88c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用<a class="ae kt" href="https://astexplorer.net/" rel="noopener ugc nofollow" target="_blank">astexplorer.net</a>我们可以看到我们输入的任何代码的AST是什么样子:</p><pre class="mk ml mm mn gt mo mp mq mr aw ms bi"><span id="407a" class="ku kv in mp b gy mt mu l mv mw">let stringExample = “this is a string example”;</span></pre><p id="0a8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上面变量声明的AST如下所示:</p><figure class="mk ml mm mn gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/50d6c9d57274a2bbe62da9684b9da7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*k8s3D7LNDRbRcLN0Bz9tjg.png"/></div></figure><p id="a7ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ls">可以想象，这些树会生成大量代码……</em></p><h2 id="e135" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">汇编</h2><p id="1a4f" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">JavaScript引擎利用编译器和解释器的最佳部分，被称为<strong class="jx io">实时(或JIT)编译</strong>。但是什么是编译器和解释器呢？</p><p id="080d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在使用<strong class="jx io">编译器</strong>的编程语言中，代码在运行时之前被编译。编译后形成代码的优化版本，然后执行该版本。与使用解释器的语言相比，这种优化的代码提供了性能增强。</p><p id="c87c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，编译代码比编译解释器要花更长的时间。Java等语言使用这种方法。</p><p id="76ba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<strong class="jx io">解释的</strong>编程语言中，代码是在运行时编译的，这意味着它在读取代码时开始逐行执行代码。这使得代码执行非常快，因为代码在运行之前不必编译和优化。但是，性能不会像在运行之前用编译器编译的代码那样高效。</p><p id="7e32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在JavaScript的初期，浏览器中的引擎只能使用解释器，因为浏览器无法在运行时之前编译代码。如今，随着浏览器的发展，所有JavaScript浏览器引擎都使用解释器和编译器的组合，称为<strong class="jx io">实时(或JIT)编译</strong>。</p><h2 id="8dfe" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">执行</h2><p id="ac60" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">在代码被解析成AST之后，它被发送给解释器。解释器开始逐行编译代码，并发送<a class="ae kt" href="https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775" rel="noopener">字节码</a>来执行。当代码运行时，引擎收集反馈。反馈和字节码被发送到编译器，然后编译器产生优化的机器码。根据使用的JavaScript引擎，这个过程在本质上有所不同。</p><p id="0465" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编译代码的变量、对象、函数等。然后被分配到<a class="ae kt" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">内存堆</strong> </a>中的内存，后者也驻留在引擎中。</p><p id="2ac4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://www.javascripttutorial.net/javascript-call-stack/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">调用栈</strong> </a>也是引擎的一部分，也在执行阶段使用。每次从内存堆中调用一个函数时，它都被发送到调用堆栈中执行，然后在完成时被移除。</p><p id="e528" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://javascript.info/garbage-collection" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">垃圾收集</strong> </a>也发生在这个阶段，确保任何不再“可及”的值或对象不会占用内存堆中的宝贵空间。</p><h2 id="2499" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated">结论</h2><p id="8279" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">JavaScript引擎在短时间内取得了长足的进步。其独特的编译和执行有助于使JavaScript成为一种适应性很强的通用语言，随着时间的推移，它继续吸引着越来越多的程序员。</p><p id="b4a5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ls">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ls">plain English . io</em></strong></a></p></div></div>    
</body>
</html>