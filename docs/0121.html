<html>
<head>
<title>Send SMS and Responsive Emails with Node.js + Twilio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js + Twilio发送短信和回复邮件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-twilio-send-sms-and-responsive-emails-759214dfa7a0?source=collection_archive---------6-----------------------#2021-01-07">https://javascript.plainenglish.io/node-js-twilio-send-sms-and-responsive-emails-759214dfa7a0?source=collection_archive---------6-----------------------#2021-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/da68da9a78f32d2d467cd06029a1993c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5m8JOTrbWb7j1oYZp_nlA.png"/></div></div></figure><p id="e945" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过这篇文章，您将了解如何设置Twilio SMS API来发送SMS，以及如何设置Twilio SendGrid API和MJML来发送响应邮件。在此之后，您可以设置紧急短信提醒用户，并发送响应营销或其他类型的电子邮件。</p><p id="1d8f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用Node.js作为服务器。让我们开始吧。</p><h1 id="1e85" class="kt ku in bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">发送短信</h1><ul class=""><li id="f2ce" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">对于Twilio SMS API，您可以在这里设置您的账户<a class="ae mc" href="https://www.twilio.com" rel="noopener ugc nofollow" target="_blank">。记下你的Twilio <strong class="jx io">账号SID </strong>(用户名)和你的<strong class="jx io">认证令牌</strong>，可以在这里</a><a class="ae mc" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank">查看</a>。此外，在Twilio控制台上启用您的用户可能居住的国家，您可能需要发送短信。</li><li id="1032" class="lr ls in jx b jy md kc me kg mf kk mg ko mh ks ly lz ma mb bi translated">安装Twilio节点库</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="2377" class="mr ku in mn b gy ms mt l mu mv">npm install --save twilio</span><span id="ca73" class="mr ku in mn b gy mw mt l mu mv">// OR</span><span id="a194" class="mr ku in mn b gy mw mt l mu mv">yarn add twilio</span></pre><ul class=""><li id="5a5e" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">发送短信</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="efff" class="mr ku in mn b gy ms mt l mu mv">import parsePhoneNumber <em class="na">from</em> "libphonenumber-js/min";<br/>const accountSid = process.env.TWILIO_ACCOUNT_SID;<br/>const authToken = process.env.TWILIO_AUTH_TOKEN;<br/>const twilioClient = require("twilio")(accountSid, authToken);</span><span id="f852" class="mr ku in mn b gy mw mt l mu mv">twilioClient.messages.create({<br/>  from: "<!-- -->+15017122661<!-- -->",<br/>  to: "<!-- -->+15558675310<!-- -->",<br/>  body: `<!-- -->This is the ship that made the Kessel Run in fourteen parsecs?<!-- -->`,<br/>});</span></pre><p id="bf69" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">提示:</strong>将电话号码解析为正确的格式。Twilio建议将电话号码解析为<code class="fe nb nc nd mn b">E.164</code>格式。我们可以使用像<a class="ae mc" href="https://www.npmjs.com/package/libphonenumber-js" rel="noopener ugc nofollow" target="_blank"> libphonenumber-js </a>这样的库将电话号码解析为正确的格式。</p><ul class=""><li id="d56b" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">安装库</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="47b2" class="mr ku in mn b gy ms mt l mu mv">npm install --save libphonenumber-js</span><span id="dfb3" class="mr ku in mn b gy mw mt l mu mv">// OR</span><span id="4a7b" class="mr ku in mn b gy mw mt l mu mv">yarn add libphonenumber-js</span></pre><ul class=""><li id="f416" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">用它来解析电话号码。</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="36d8" class="mr ku in mn b gy ms mt l mu mv">import parsePhoneNumber <em class="na">from</em> "libphonenumber-js/min";<br/>const accountSid = process.env.TWILIO_ACCOUNT_SID;<br/>const authToken = process.env.TWILIO_AUTH_TOKEN;<br/>const twilioClient = require("twilio")(accountSid, authToken);</span><span id="c8d2" class="mr ku in mn b gy mw mt l mu mv">twilioClient.messages.create({<br/>  from: "<!-- -->+15017122661<!-- -->",<br/>  to: parsePhoneNumber(user.phoneNo).format("E.164"),<br/>  body: `<!-- -->This is the ship that made the Kessel Run in fourteen parsecs?<!-- -->`,<br/>});</span></pre></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><h1 id="5945" class="kt ku in bd kv kw nl ky kz la nm lc ld le nn lg lh li no lk ll lm np lo lp lq bi translated">发送回复邮件</h1><ul class=""><li id="68a9" class="lr ls in jx b jy lt kc lu kg lv kk lw ko lx ks ly lz ma mb bi translated">我们将使用Twilio SendGrid发送电子邮件。您可以在这里设置您的账户<a class="ae mc" href="https://sendgrid.com" rel="noopener ugc nofollow" target="_blank">。记下SendGrid API密钥，可在此处查看</a><a class="ae mc" href="https://app.sendgrid.com/settings/api_keys" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="4bd5" class="lr ls in jx b jy md kc me kg mf kk mg ko mh ks ly lz ma mb bi translated">安装SendGrid节点电子邮件库</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="782d" class="mr ku in mn b gy ms mt l mu mv">npm install --save @sendgrid/mail</span><span id="74b3" class="mr ku in mn b gy mw mt l mu mv">// OR</span><span id="677a" class="mr ku in mn b gy mw mt l mu mv">yarn add @sendgrid/mail</span></pre><ul class=""><li id="6648" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">验证发件人身份</li></ul><p id="22e3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<a class="ae mc" href="https://app.sendgrid.com/settings/sender_auth/senders" rel="noopener ugc nofollow" target="_blank">发件人验证选项卡</a>中验证电子邮件地址或域。如果没有这个，当您试图发送邮件时，将会收到一个<code class="fe nb nc nd mn b">403 Forbidden</code>响应。</p><ul class=""><li id="3bb9" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">发送电子邮件</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="198a" class="mr ku in mn b gy ms mt l mu mv">import sgMail <em class="na">from</em> "@sendgrid/mail";<br/>sgMail.setApiKey(process.env.SENDGRID_API_KEY); // Add API key</span><span id="74a7" class="mr ku in mn b gy mw mt l mu mv">const msg = {<br/>  to: 'test@example.com',<br/>  from: 'test@example.com', // Use the email address or domain you verified above<br/>  subject: 'Sending with Twilio SendGrid is Fun',<br/>  text: 'and easy to do anywhere, even with Node.js',<br/>  html: '&lt;strong&gt;and easy to do anywhere, even with Node.js&lt;/strong&gt;',<br/>};<br/><br/>sgMail<br/>  .send(msg)<br/>  .then(() =&gt; {<br/>    // mail sent  <br/>  }, error =&gt; {<br/>    console.error(error);<br/><br/>    if (error.response) {<br/>      console.error(error.response.body)<br/>    }<br/>  });</span></pre><p id="7450" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您想发送简单的文本或HTML电子邮件，上面的实现是很好的，但是对于复杂的情况，您想发送一封在所有电子邮件客户端和设备上都运行良好的电子邮件。</p><p id="7ced" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将使用<a class="ae mc" href="https://mjml.io" rel="noopener ugc nofollow" target="_blank"> MJML </a>来创建在所有电子邮件客户端和设备上都能很好工作的响应电子邮件。</p><ul class=""><li id="e21d" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">安装MJML节点库</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="5ceb" class="mr ku in mn b gy ms mt l mu mv">npm install --save <!-- -->mjml</span><span id="efb6" class="mr ku in mn b gy mw mt l mu mv">// OR</span><span id="1f1c" class="mr ku in mn b gy mw mt l mu mv">yarn add <!-- -->mjml</span></pre><ul class=""><li id="865d" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated">现在我们可以使用任何<a class="ae mc" href="https://documentation.mjml.io/#components" rel="noopener ugc nofollow" target="_blank"> MJML组件</a>来创建我们的电子邮件模板，使用它们的节点库生成HTML，并使用SendGrid将HTML发送给用户。</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e605" class="mr ku in mn b gy ms mt l mu mv">import mjml2html <em class="na">from</em> "mjml";</span><span id="5ba4" class="mr ku in mn b gy mw mt l mu mv">const mjmlToHtml = mjml2html(`<br/>  &lt;mjml&gt;<br/>    &lt;mj-body&gt;<br/>      &lt;mj-section&gt;<br/>        &lt;mj-column&gt;<br/>          &lt;mj-image width="100px" src="/assets/img/logo-small.png"&gt;&lt;/mj-image&gt;<br/>          &lt;mj-divider border-color="#F45E43"&gt;&lt;/mj-divider&gt;<br/>          &lt;mj-text font-size="20px" color="#F45E43" font-family="helvetica"&gt;Hello ${user.name}&lt;/mj-text&gt;<br/>        &lt;/mj-column&gt;<br/>      &lt;/mj-section&gt;<br/>    &lt;/mj-body&gt;<br/>  &lt;/mjml&gt;<br/>`, { minify: true });</span><span id="d978" class="mr ku in mn b gy mw mt l mu mv"><em class="na">if</em> (MPTmjmlToHtml.errors.length &gt; 0) {<br/> // Some error while generating HTML<br/>}<br/>else {<br/> // HTML generated, access using mjmlToHtml.html<br/>}</span></pre><ul class=""><li id="4842" class="lr ls in jx b jy jz kc kd kg mx kk my ko mz ks ly lz ma mb bi translated"><strong class="jx io">提示:</strong>使用MJML <a class="ae mc" href="https://mjml.io/try-it-live" rel="noopener ugc nofollow" target="_blank">试用页面</a>创建你的模板。一旦创建了模板，就使用JS模板文字来传递动态数据，比如用户名。</li><li id="79e9" class="lr ls in jx b jy md kc me kg mf kk mg ko mh ks ly lz ma mb bi translated">把所有的放在一起</li></ul><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="20a5" class="mr ku in mn b gy ms mt l mu mv">import mjml2html <em class="na">from</em> "mjml";<br/>import sgMail <em class="na">from</em> "@sendgrid/mail";<br/>sgMail.setApiKey(process.env.SENDGRID_API_KEY); // Add API key</span><span id="a1c4" class="mr ku in mn b gy mw mt l mu mv">const mjmlToHtml = mjml2html(`<br/>  &lt;mjml&gt;<br/>    &lt;mj-body&gt;<br/>      &lt;mj-section&gt;<br/>        &lt;mj-column&gt;<br/>          &lt;mj-image width="100px" src="/assets/img/logo-small.png"&gt;&lt;/mj-image&gt;<br/>          &lt;mj-divider border-color="#F45E43"&gt;&lt;/mj-divider&gt;<br/>          &lt;mj-text font-size="20px" color="#F45E43" font-family="helvetica"&gt;Hello ${user.name}&lt;/mj-text&gt;<br/>        &lt;/mj-column&gt;<br/>      &lt;/mj-section&gt;<br/>    &lt;/mj-body&gt;<br/>  &lt;/mjml&gt;<br/>`, { minify: true });</span><span id="88ce" class="mr ku in mn b gy mw mt l mu mv"><em class="na">if</em> (MPTmjmlToHtml.errors.length &gt; 0) {<br/> // Some error while generating HTML<br/>}<br/>else {<br/>  const msg = {<br/>    to: 'test@example.com',<br/>    from: { email: "email", name: "Name" },<br/>    subject: 'Sending with Twilio SendGrid is Fun',<br/>    text: 'and easy to do anywhere, even with Node.js',<br/>    html: mjmlToHtml.html,<br/>  };<br/><br/>  sgMail<br/>    .send(msg)<br/>    .then(() =&gt; {<br/>      // mail sent  <br/>    }, error =&gt; {<br/>      console.error(error);<br/><br/>      if (error.response) {<br/>        console.error(error.response.body)<br/>      }<br/>    });<br/>}</span></pre></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><h2 id="8a24" class="mr ku in bd kv nq nr dn kz ns nt dp ld kg nu nv lh kk nw nx ll ko ny nz lp oa bi translated">结论</h2><p id="319e" class="pw-post-body-paragraph jv jw in jx b jy lt ka kb kc lu ke kf kg ob ki kj kk oc km kn ko od kq kr ks ig bi translated">本教程到此为止。希望对你集成Twilio SMS和SendGrid API有所帮助。在<a class="ae mc" href="https://www.instagram.com/imchetanyadav/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>和<a class="ae mc" href="https://twitter.com/im_chetanyadav/" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，获取更多信息。</p></div></div>    
</body>
</html>