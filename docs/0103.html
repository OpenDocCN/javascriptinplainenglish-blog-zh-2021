<html>
<head>
<title>Ionic Framework with Vue 3 and Firebase — Photo Sharing App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有Vue 3和Firebase的Ionic框架——照片分享应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/ionic-framework-with-vue-3-and-firebase-photo-sharing-app-4ddda0c992a3?source=collection_archive---------6-----------------------#2021-01-06">https://javascript.plainenglish.io/ionic-framework-with-vue-3-and-firebase-photo-sharing-app-4ddda0c992a3?source=collection_archive---------6-----------------------#2021-01-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="7fe6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第2部分—相机和保存照片</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2b74513d6265a4aaf6c605192311fb97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ir2v7jWWe5nuzfpMpD8jVQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image by <a class="ae kv" href="https://pixabay.com/photos/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=801891" rel="noopener ugc nofollow" target="_blank">Free-Photos</a> from <a class="ae kv" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=801891" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><p id="f139" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://diligentdev.medium.com/ionic-framework-with-vue-3-and-firebase-photo-sharing-app-9aad3df14908" rel="noopener">第一部分</a>中，我们复习了如何用<a class="ae kv" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank"> VueJs </a>建立一个<a class="ae kv" href="https://ionicframework.com/" rel="noopener ugc nofollow" target="_blank"> Ionic Framework </a>移动应用。我们还配置了我们的<a class="ae kv" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>特性，包括认证、Firestore和存储。在本文中，我们将介绍如何利用本机设备功能，如摄像头和GPS。</p><h1 id="42ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">电容器</h1><h2 id="21ee" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">装置</h2><p id="7cae" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">为了给我们的应用添加本地特性，我们将使用<a class="ae kv" href="https://capacitorjs.com/" rel="noopener ugc nofollow" target="_blank">电容器</a>。要在我们的应用程序中启用capacitor，请在应用程序的根目录中打开一个终端，并运行以下命令:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="b462" class="mk lt iq nc b gy ng nh l ni nj">ionic integrations enable capacitor</span></pre><h2 id="b6ce" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">初始化</h2><p id="34b0" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">然后，我们需要在应用程序中初始化电容器。为此，您需要命名您的应用程序，并拥有一个应用程序id。你的应用id应该是唯一的。最佳做法是使用应用程序的名称和网站的域名。com . diligent dev . photosharingapp就是一个例子。</p><p id="a6c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确定应用程序名称和应用程序id后，在项目根目录下打开终端并运行以下命令:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="d649" class="mk lt iq nc b gy ng nh l ni nj">npx cap init [appName] [appId]</span></pre><h2 id="17c8" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">建筑物</h2><p id="442a" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">接下来，我们需要构建我们的应用程序。为此，请运行以下命令:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="5037" class="mk lt iq nc b gy ng nh l ni nj">ionic build</span></pre><h2 id="0745" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">添加平台</h2><p id="78f7" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">现在，我们需要添加我们的平台。如果你想开发iOS，你需要一台Mac。对于Android，你可以在Windows或Mac上构建。根据您想要构建的版本，您需要在终端中运行以下程序:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="6bfd" class="mk lt iq nc b gy ng nh l ni nj">// Adding iOS (mac only)<br/>npx cap add ios</span><span id="8a6a" class="mk lt iq nc b gy nk nh l ni nj">// Adding Android<br/>npx cap add android</span></pre><h2 id="befa" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">实时重装</h2><p id="ac48" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">为了在模拟器上立即看到我们的变化，我们需要安装<a class="ae kv" href="https://capacitorjs.com/docs/guides/live-reload" rel="noopener ugc nofollow" target="_blank"> Ionic的实时重新加载</a>。为此，您需要Ionic CLI(安装在第1部分)和它们的本地运行插件。打开终端并运行以下命令:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="9be0" class="mk lt iq nc b gy ng nh l ni nj">npm install -g native-run</span></pre><p id="7bd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装后，您可以执行以下命令来运行您的应用程序:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="b878" class="mk lt iq nc b gy ng nh l ni nj">// Run iOS<br/>ionic cap run ios -l --external</span><span id="1d3f" class="mk lt iq nc b gy nk nh l ni nj">// Run Android<br/>ionic cap run ios -l --external</span></pre><p id="0d7b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个<strong class="ky ir"> <em class="nl">应该</em> </strong>启动Andriod Studio或者XCode。如果它没有启动它们，请打开。启动后，你可以在各自的ide中打开ios或android文件夹。然后，通过单击IDE顶部的播放(运行)按钮运行您的应用程序。</p><h1 id="7e2f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">选项卡图标和名称</h1><p id="c497" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">我们将使用第一个选项卡启动相机并保存照片。为了让用户明白这一点，我们将选项卡的图标和名称改为camera。为此，我们可以删除三角形图标，导入cameraOutline图标，并将其返回到模板。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="50ed" class="mk lt iq nc b gy ng nh l ni nj"><em class="nl">// top of script tag<br/>import</em> { ellipse, square, <strong class="nc ir">cameraOutline</strong> } <em class="nl">from</em> 'ionicons/icons';</span><span id="4f15" class="mk lt iq nc b gy nk nh l ni nj">// in export default<br/><em class="nl">setup</em>() {</span><span id="8f2b" class="mk lt iq nc b gy nk nh l ni nj"><em class="nl">return</em> {<br/> ellipse,<br/> square,<br/> <strong class="nc ir">cameraOutline</strong>,<br/> }<br/>}</span></pre><p id="1de5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将更改模板中选项卡上的图标和标题。您的文件应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Tabs.vue</figcaption></figure><h1 id="9c51" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">燃料库</h1><p id="f93c" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">回到src/main.ts，我们需要导入Firebase存储，这样我们就可以用它来保存我们的映像。在文件的顶部，将存储模块导入到其他firebase导入项下:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="3a9a" class="mk lt iq nc b gy ng nh l ni nj"><em class="nl">import</em> firebase <em class="nl">from</em> 'firebase/app';<br/><em class="nl">import</em> 'firebase/auth';<br/><em class="nl">import</em> 'firebase/firestore';<br/><strong class="nc ir"><em class="nl">import</em> 'firebase/storage'</strong></span></pre><p id="999c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，在其他Firebase导出下面，导出一个存储实例:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="58ee" class="mk lt iq nc b gy ng nh l ni nj"><em class="nl">export </em>const<em class="nl"> auth </em>=<em class="nl"> firebase.auth</em>();<br/><em class="nl">export </em>const<em class="nl"> db </em>=<em class="nl"> firebase.firestore</em>();<br/><strong class="nc ir"><em class="nl">export </em>const<em class="nl"> storage </em>=<em class="nl"> firebase.storage</em>();</strong></span></pre><h1 id="1968" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">摄像头和GPS</h1><p id="5e0a" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">既然我们的应用程序已经在仿真器上运行，我们就可以访问本地设备特性了。我们将针对的第一个本机功能是拍照并保存到firebase。为此，导航到src/views/Tab1.vue。</p><p id="1cd5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">删除ion-content标签中的所有内容，并将ion-title重命名为Camera。我们将该选项卡布局为在屏幕中间有一个按钮来启动相机。我们也会给这个按钮一个图标。</p><p id="eaa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，请从@ionic/vue导入IonButton和IonIcon。我们还需要导入相机图标。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="4369" class="mk lt iq nc b gy ng nh l ni nj"><em class="nl">import</em> {<br/> IonPage,<br/> IonHeader,<br/> IonToolbar,<br/> IonTitle,<br/> IonContent,<br/> <strong class="nc ir">IonButton</strong>,<br/> <strong class="nc ir">IonIcon</strong>,<br/>} <em class="nl">from</em> "@ionic/vue";</span><span id="b817" class="mk lt iq nc b gy nk nh l ni nj"><strong class="nc ir"><em class="nl">import</em> { camera } <em class="nl">from</em> "ionicons/icons";</strong></span></pre><p id="3fd6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们需要导入我们的Firebase存储实例Firestore，auth。我们还需要从电容器本地相机和地理定位插件。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="2fc7" class="mk lt iq nc b gy ng nh l ni nj">import {storage, auth, db} from '../main';<br/>import { Plugins, CameraResultType } from '@capacitor/core';  </span><span id="2ec2" class="mk lt iq nc b gy nk nh l ni nj">const { Camera, Geolocation } = Plugins;</span></pre><p id="c1ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们准备创建保存图像的方法。我们要做的第一件事是创建一个方法来生成一个可以用作文件名的GUID。这将使得几乎不可能得到冲突的文件名:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="5b7c" class="mk lt iq nc b gy ng nh l ni nj">function <em class="nl">uuidv4</em>() {<br/> <em class="nl">return</em> "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx"<br/>  <em class="nl">.replace</em>(/[xy]/g, function (c) {<br/>   const<em class="nl"> r </em>=<em class="nl"> </em>(<em class="nl">Math.random</em>()<em class="nl"> </em>*<em class="nl"> </em>16)<em class="nl"> </em>|<em class="nl"> </em>0,<br/>   <em class="nl">v </em>=<em class="nl"> c </em>==<em class="nl"> </em>"x"<em class="nl"> </em>?<em class="nl"> r </em>:<em class="nl"> </em>(<em class="nl">r </em>&amp;<em class="nl"> </em>0x3)<em class="nl"> </em>|<em class="nl"> </em>0x8;<br/>   <em class="nl">return</em> v<em class="nl">.toString</em>(16);<br/> });</span><span id="08d2" class="mk lt iq nc b gy nk nh l ni nj">}</span></pre><p id="b45b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，在导出默认值中，创建一个设置方法。在其中，我们将创建一个方法来拍摄图像并保存它和Firestore中的位置。最后，我们将返回模板所需的所有内容。</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="42cb" class="mk lt iq nc b gy ng nh l ni nj"><em class="nl">setup</em>() {<br/> const<em class="nl"> takePicture </em>=<em class="nl"> async </em>()<em class="nl"> </em>=&gt;<em class="nl"> </em>{<br/> const<em class="nl"> image </em>=<em class="nl"> await Camera.getPhoto</em>({<br/>  <em class="nl">quality</em>:<em class="nl"> </em>90,<br/>  <em class="nl">allowEditing</em>:<em class="nl"> false</em>,<br/>  <em class="nl">resultType</em>:<em class="nl"> CameraResultType.Base64</em>,<br/> });<br/> <br/> if<em class="nl"> </em>(<em class="nl">image?.base64String</em>)<em class="nl"> </em>{<br/>  //<em class="nl">get user<br/>  </em>const<em class="nl"> user </em>=<em class="nl"> auth.currentUser</em>;<br/>  <br/>  //<em class="nl">create guid<br/>  </em>const<em class="nl"> guid </em>=<em class="nl"> uuidv4</em>();<br/>  <br/>  //<em class="nl">create file path<br/>  </em>const<em class="nl"> filePath </em>=<em class="nl"> </em>`${<em class="nl">user?.uid</em>}<em class="nl">/images/</em>${<em class="nl">guid</em>}<em class="nl">.</em>${<em class="nl">image.format</em>}`;</span><span id="e6ff" class="mk lt iq nc b gy nk nh l ni nj">  //<em class="nl">save to storage<br/>  </em>const<em class="nl"> storageRef </em>=<em class="nl"> storage.ref</em>();<br/>  <br/>  <em class="nl">await storageRef.child</em>(<em class="nl">filePath</em>)<br/>   <em class="nl">.putString</em>(<em class="nl">image.base64String</em>,<em class="nl"> </em>'base64');</span><span id="ed4f" class="mk lt iq nc b gy nk nh l ni nj">  //<em class="nl">get download url to save in firestore<br/>  </em>const<em class="nl"> url </em>=<em class="nl"> await storageRef.child</em>(<em class="nl">filePath</em>)<em class="nl">.getDownloadURL</em>();</span><span id="36c1" class="mk lt iq nc b gy nk nh l ni nj">  //<em class="nl">get location<br/>  </em>const<em class="nl"> loc </em>=<em class="nl"> await Geolocation.getCurrentPosition</em>();</span><span id="482b" class="mk lt iq nc b gy nk nh l ni nj">  //<em class="nl">save in firestore<br/>  await db<br/>   .collection</em>("users")<br/>   <em class="nl">.doc</em>(<em class="nl">user?.uid</em>)<br/>   <em class="nl">.collection</em>("images")<br/>   <em class="nl">.add</em>({<br/>    <em class="nl">image</em>:<em class="nl"> url</em>,<br/>    <em class="nl">location</em>:<em class="nl"> </em>{<em class="nl"> lat</em>:<em class="nl"> loc.coords.latitude</em>,<em class="nl"> lon</em>:<em class="nl"> loc.coords.longitude<br/>    </em>},<br/>   });<br/>  }<br/> };</span><span id="a755" class="mk lt iq nc b gy nk nh l ni nj"><em class="nl"> return</em> {<br/>  camera,<br/>  takePicture,<br/> };<br/>}</span></pre><p id="9a3a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们需要做的最后一件事是编辑模板，以便用户可以与应用程序进行交互。我们只是在屏幕中间有一个按钮供用户拍照。您的最终文件应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Tab1.vue</figcaption></figure><h1 id="1d6f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">视频教程</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="no nn l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Video Tutorial</figcaption></figure><h1 id="394d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="3195" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">在第2部分中，我们设法拍摄了一张照片，获得了用户的位置，并使用最少的代码将其保存在Firestore中。在第3部分中，我们将重点关注在应用程序中显示图像。所以，如果你还没有的话，一定要关注我，让我通知你。下次再见，祝编码愉快！</p></div></div>    
</body>
</html>