<html>
<head>
<title>How to Reuse Promises in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在JavaScript中重用承诺</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/reusing-promises-in-javascript-392bd505f346?source=collection_archive---------6-----------------------#2021-12-01">https://javascript.plainenglish.io/reusing-promises-in-javascript-392bd505f346?source=collection_archive---------6-----------------------#2021-12-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/1be883f15027eeb05a858e87f1de123a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*zRp4attILsR7CdYd"/></div></figure><p id="0132" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">最近，我们开始了一个项目，以提高我们的主要应用程序的性能。我们发现了一些我们经常调用的API调用。这些调用的结果可能会改变，但不会经常改变，所以缓存一分钟左右的结果不成问题。</p><p id="f0ff" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">所以我实现了一个非常简单的缓存，它将重用活动的承诺，并在初始解决后返回已经解决的结果。</p><p id="d891" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">本文将详细讨论这些代码。让我们从模拟参数化的API调用开始。</p><figure class="kp kq kr ks gt jo"><div class="bz fp l di"><div class="kt ku l"/></div></figure><p id="f356" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">很简单。</p><p id="80d1" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在我们需要一些变量来存储我们的承诺、结果和解决时间。我们还将创建一个新函数，我们将调用该函数来获取缓存的结果。</p><figure class="kp kq kr ks gt jo"><div class="bz fp l di"><div class="kt ku l"/></div></figure><p id="7768" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">_cacheValues将保存已经解析的值，_cachePromises将保存正在进行的承诺，而_cacheResolvedTime将保存上次解析键承诺的时间。</p><p id="9ddb" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在我们将添加一个简单的if语句，它将成为我们缓存的基石。</p><figure class="kp kq kr ks gt jo"><div class="bz fp l di"><div class="kt ku l"/></div></figure><p id="685f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果我们已经有一个键的值，让我们返回它。如果我们有一个正在进行的承诺，返回它。如果我们没有那个键的数据，我们将触发原来的方法。这个触发器将包装它的承诺，以便我们在resolve上填充我们的缓存。</p><p id="e470" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在，我们将向实时功能添加时间。在我们新方法的开始，我们将添加。</p><figure class="kp kq kr ks gt jo"><div class="bz fp l di"><div class="kt ku l"/></div></figure><p id="7796" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果我们解决了它，并且解决时间超过60秒，我们将从缓存中删除它，并继续切换我们的其余逻辑。</p><p id="9d69" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在我们完成了，我们可以测试我们的代码。</p><figure class="kp kq kr ks gt jo"><div class="bz fp l di"><div class="kt ku l"/></div></figure><p id="a11e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">你可以在这个<a class="ae kv" href="https://jsfiddle.net/61pfqg43/1/" rel="noopener ugc nofollow" target="_blank">拨弄</a>中看到控制台结果和整个代码。</p></div><div class="ab cl kw kx hr ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ig ih ii ij ik"><p id="8c54" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">如果你喜欢这篇文章，你可以在<a class="ae kv" href="https://twitter.com/pavel_polivka" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我。</p></div><div class="ab cl kw kx hr ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ig ih ii ij ik"><p id="2811" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">【https://ppolivka.com】最初发表于<a class="ae kv" href="https://ppolivka.com/posts/reusing-promises-in-javascript" rel="noopener ugc nofollow" target="_blank"><em class="ld"/></a><em class="ld">。</em></p><p id="69ea" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><em class="ld">更多内容请看</em><strong class="jt io"><em class="ld"/></strong><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jt io"><em class="ld">说白了. io </em> </strong> </a> <strong class="jt io"> <em class="ld">。</em> </strong> <em class="ld">报名参加我们的</em><strong class="jt io"><em class="ld"/></strong><a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jt io"><em class="ld">免费每周简讯这里</em> </strong> </a> <strong class="jt io"> <em class="ld">。</em> </strong></p></div></div>    
</body>
</html>