<html>
<head>
<title>JavaScript: How Line Breaks and Missing Semicolons Can Break Your Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript:换行符和缺少分号是如何破坏代码的</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-how-line-breaks-and-missing-semicolons-can-break-your-code-58e031e7f235?source=collection_archive---------4-----------------------#2021-03-20">https://javascript.plainenglish.io/javascript-how-line-breaks-and-missing-semicolons-can-break-your-code-58e031e7f235?source=collection_archive---------4-----------------------#2021-03-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bf1a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">JavaScript中自动插入分号的规则和例外</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/54c2c4a7b4b4a680330b6407e71c6d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gejLRrIDogZFOxap5qJLUA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Image Courtesy —<a class="ae ks" href="https://www.merriam-webster.com/words-at-play/a-guide-to-using-semicolons" rel="noopener ugc nofollow" target="_blank"> Merriam-Webster</a></figcaption></figure><p id="10f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在许多编程语言中，使用分号来结束语句是必须的，但是在JavaScript中，它是可选的。如果语句写在单独的行中，可以省略分号。在这种情况下，JavaScript会隐式添加分号。但是在理解何时在源代码中显式添加分号时应该非常小心，以免破坏代码并导致意外结果。</p><p id="9d6e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本文中，我们将通过例子看到分号自动插入的各种规则和例外。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="adba" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">自动分号插入</h1><p id="9621" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">大多数ECMAScript语句和声明必须以分号结束。这样的分号可能总是明确地出现在源文本中。然而，为了方便起见，在某些情况下，这样的分号可以从源文本中省略。描述这些情况的方法是，在这些情况下，分号会自动插入源代码标记流。- ECMAScript语言规范。</p><p id="2a7a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">简而言之，JavaScript编译器会在语句末尾的源代码中添加一个缺少的分号。然而，这个规则也有例外。每当有换行符时，JavaScript并不总是添加分号。</p><p id="d23c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们看一些例子。</p><h2 id="e39c" class="mu lx in bd ly mv mw dn mc mx my dp mg lc mz na mi lg nb nc mk lk nd ne mm nf bi translated">示例1</h2><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="26f0" class="mu lx in nh b gy nl nm l nn no">let a = 4<br/>[1,2,3].map((arr) =&gt; {return arr*3})</span></pre><p id="0f10" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你认为会有什么结果？它实际上会抛出一个错误。<code class="fe np nq nr nh b">Uncaught TypeError: Cannot read property ‘map’ of undefined</code></p><p id="f547" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这种情况下，JavaScript实际上将代码解释为</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="912e" class="mu lx in nh b gy nl nm l nn no">let a = 4[1,2,3].map((arr) =&gt; {return arr*3})</span></pre><p id="199f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当代码从左到右被解析而没有分号，并且遇到<code class="fe np nq nr nh b">[</code>时，它被解释为前面语句的延续。</p><p id="0f0d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了得到正确的结果，</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="7fae" class="mu lx in nh b gy nl nm l nn no">let a = 4;//use a semicolon <br/>[1,2,3].map((arr) =&gt; {return arr*3}) //[3,6,9]</span></pre><p id="4cf6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">令人惊讶的是，下面的作品！</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="0d4d" class="mu lx in nh b gy nl nm l nn no">let a<br/>[1,2,3].map((arr) =&gt; {return arr*3}) //[3,6,9]</span></pre><p id="ef17" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是因为变量声明(带有<code class="fe np nq nr nh b">let, var, const</code>)本身是完整的语句，JavaScript编译器总是终止它们。</p><h2 id="be42" class="mu lx in bd ly mv mw dn mc mx my dp mg lc mz na mi lg nb nc mk lk nd ne mm nf bi translated">示例2</h2><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="c531" class="mu lx in nh b gy nl nm l nn no">let a = 4<br/>(3+4).toString()</span></pre><p id="26ee" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的代码也抛出了一个错误。<code class="fe np nq nr nh b">Uncaught TypeError: 4 is not a function</code></p><p id="b7ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">解释与<code class="fe np nq nr nh b">[</code>相同。JavaScript编译器将代码解释为</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="c016" class="mu lx in nh b gy nl nm l nn no">let a = 4(3+4).toString()</span></pre><p id="c95c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">终止第一条语句会给出正确的结果。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="9a69" class="mu lx in nh b gy nl nm l nn no">let a = 4; //use a semicolon<br/>(3+4).toString() //"7"</span></pre><p id="00d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">任何以<code class="fe np nq nr nh b">(</code>开头的语句，比如命题、表达式(逻辑、算术等等。，)属于这种例外。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="7fba" class="mu lx in nh b gy nl nm l nn no">var s = 23<br/>(function add(a,b){return a + b})(2,3) //Uncaught TypeError: 23 is not a function</span><span id="fdbd" class="mu lx in nh b gy ns nm l nn no">var a,b<br/>a = 4, b = 7<br/>( a &gt; b ) ? alert(a) : alert(b) //Uncaught TypeError: 7 is not a function</span></pre><p id="fbbd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在语句给出正确结果之前终止该行。</p><h2 id="7208" class="mu lx in bd ly mv mw dn mc mx my dp mg lc mz na mi lg nb nc mk lk nd ne mm nf bi translated">示例3</h2><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="58f1" class="mu lx in nh b gy nl nm l nn no">var a = 1+1<br/>+"3" * 5<br/>alert(a) //17</span></pre><p id="17c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在上面的代码中，第二行被解释为第一行的延续。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="11e3" class="mu lx in nh b gy nl nm l nn no">var a = 1+1+"3"*5</span></pre><p id="8384" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">添加分号会得到预期的结果。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="8245" class="mu lx in nh b gy nl nm l nn no">var a = 1+1;<br/>+"3" * 5<br/>alert(a) //2</span></pre><p id="11f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">与<code class="fe np nq nr nh b">[</code>、<code class="fe np nq nr nh b">(</code>相同的例外适用于<code class="fe np nq nr nh b">+</code>、<code class="fe np nq nr nh b"> —</code>、<code class="fe np nq nr nh b">/</code>、<code class="fe np nq nr nh b">`</code></p><p id="79d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">尽管很少出现以<code class="fe np nq nr nh b">+</code>、<code class="fe np nq nr nh b">-</code>、<code class="fe np nq nr nh b">/</code>开头的语句。但是对于以<code class="fe np nq nr nh b">[</code>、<code class="fe np nq nr nh b">(</code>开头的语句来说，这种情况并不少见，最好是正确处理终止。</p><p id="e263" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">甚至可以接受以一个<code class="fe np nq nr nh b">;</code>开始语句，以确保该语句被解释为一个新语句，而不是前一个语句的延续。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="83ab" class="mu lx in nh b gy nl nm l nn no">var s = 23<br/>;(function add(a,b){return a + b})(2,3) //5</span></pre><h2 id="7c9b" class="mu lx in bd ly mv mw dn mc mx my dp mg lc mz na mi lg nb nc mk lk nd ne mm nf bi translated">实例4</h2><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="2356" class="mu lx in nh b gy nl nm l nn no">function a(){<br/>  var x = 5<br/>  return<br/>  {<br/>     x<br/>  }<br/>}</span><span id="d99e" class="mu lx in nh b gy ns nm l nn no">a(); //undefined</span></pre><p id="0867" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为什么<code class="fe np nq nr nh b">return</code>值没有正确返回？</p><p id="473c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是因为，每当JavaScript遇到<code class="fe np nq nr nh b">return</code>语句，并且它后面有一个换行符，JavaScript会自动插入一个分号。</p><p id="f8cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着，无论何时使用<code class="fe np nq nr nh b">return</code>语句，<code class="fe np nq nr nh b">return</code>关键字之后的标识符必须在同一行。举个例子，</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="a7a6" class="mu lx in nh b gy nl nm l nn no">return <br/>true</span></pre><p id="a9bc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这实际上被解释为，</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="523a" class="mu lx in nh b gy nl nm l nn no">return; true;</span></pre><p id="aced" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此不返回值。</p><p id="cd17" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，在前面的例子中，<code class="fe np nq nr nh b">{</code>应该在同一行的<code class="fe np nq nr nh b">return</code>关键字之后开始。</p><pre class="kd ke kf kg gt ng nh ni nj aw nk bi"><span id="a5a0" class="mu lx in nh b gy nl nm l nn no">function a(){<br/>  var x = 5<br/>  return{<br/>     x<br/>  }<br/>}</span><span id="780e" class="mu lx in nh b gy ns nm l nn no">a(); //{x:5}</span></pre><p id="2712" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">“无行终止符”规则适用于:</p><ul class=""><li id="541b" class="nt nu in kv b kw kx kz la lc nv lg nw lk nx lo ny nz oa ob bi translated">后缀表达式(<code class="fe np nq nr nh b">++</code>和<code class="fe np nq nr nh b">--</code>)</li><li id="dcca" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">continue</code></li><li id="c786" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">break</code></li><li id="b618" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">return</code></li><li id="c61f" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">yield</code>，<code class="fe np nq nr nh b">yield*</code></li><li id="489c" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">module</code></li><li id="338a" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><code class="fe np nq nr nh b">throw</code></li></ul><p id="76c7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由此给ECMAScript程序员的实用建议是:</p><p id="84de" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">后缀<code class="fe np nq nr nh b"><strong class="kv io">++</strong></code>或<code class="fe np nq nr nh b"><strong class="kv io">--</strong></code>操作符应该与其操作数出现在同一行。</p><p id="7cb5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe np nq nr nh b"><strong class="kv io">return</strong></code>或<code class="fe np nq nr nh b"><strong class="kv io">throw</strong></code>语句中的<a class="ae ks" href="https://tc39.es/ecma262/#prod-Expression" rel="noopener ugc nofollow" target="_blank">表达式</a>或<code class="fe np nq nr nh b"><strong class="kv io">yield</strong></code>表达式中的<a class="ae ks" href="https://tc39.es/ecma262/#prod-AssignmentExpression" rel="noopener ugc nofollow" target="_blank">赋值表达式</a>应该与<code class="fe np nq nr nh b"><strong class="kv io">return</strong></code>、<code class="fe np nq nr nh b"><strong class="kv io">throw</strong></code>或<code class="fe np nq nr nh b"><strong class="kv io">yield</strong></code>标记在同一行开始。</p><p id="483f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe np nq nr nh b"><strong class="kv io">break</strong></code>或<code class="fe np nq nr nh b"><strong class="kv io">continue</strong></code>语句中的<a class="ae ks" href="https://tc39.es/ecma262/#prod-LabelIdentifier" rel="noopener ugc nofollow" target="_blank">标签标识符</a>应与<code class="fe np nq nr nh b"><strong class="kv io">break</strong></code>或<code class="fe np nq nr nh b"><strong class="kv io">continue</strong></code>标记在同一行。</p><p id="7e50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">- ECMAScript语言规范</p><h1 id="46a8" class="lw lx in bd ly lz oh mb mc md oi mf mg jt oj ju mi jw ok jx mk jz ol ka mm mn bi translated">结论</h1><p id="bcb9" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">我们已经看到了自动分号插入的规则和例外的各种例子。总结一下，</p><ul class=""><li id="6e47" class="nt nu in kv b kw kx kz la lc nv lg nw lk nx lo ny nz oa ob bi translated">如果您的语句以<code class="fe np nq nr nh b">[</code>、<code class="fe np nq nr nh b">(</code>、<code class="fe np nq nr nh b">+</code>、<code class="fe np nq nr nh b">-</code>、<code class="fe np nq nr nh b">/</code>、<code class="fe np nq nr nh b">`</code>开头，请确保语句前面有分号，以免出错。</li><li id="32a6" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated">同时使用<code class="fe np nq nr nh b">return</code>、<code class="fe np nq nr nh b">continue</code>、<code class="fe np nq nr nh b">break</code>等。，确保关键字后的标识符在同一行。</li></ul><p id="75fd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">就是这样。希望这篇文章有用！</p><h2 id="121f" class="mu lx in bd ly mv mw dn mc mx my dp mg lc mz na mi lg nb nc mk lk nd ne mm nf bi translated">参考资料:</h2><ul class=""><li id="58bf" class="nt nu in kv b kw mo kz mp lc om lg on lk oo lo ny nz oa ob bi translated"><a class="ae ks" href="https://tc39.es/ecma262/#sec-rules-of-automatic-semicolon-insertion" rel="noopener ugc nofollow" target="_blank">https://tc39 . es/ECMA 262/# sec-rules-of-automatic-分号插入</a></li><li id="4d7c" class="nt nu in kv b kw oc kz od lc oe lg of lk og lo ny nz oa ob bi translated"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Lexical_grammar#automatic_semicolon_insertion" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Lexical _ grammar # automatic _分号_insertion </a></li></ul></div></div>    
</body>
</html>