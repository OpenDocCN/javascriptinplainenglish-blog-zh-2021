<html>
<head>
<title>Find the Nearest Location in a React Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以反应的方式找到最近的位置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/find-the-nearest-location-in-a-react-way-9ed51a999807?source=collection_archive---------3-----------------------#2021-05-29">https://javascript.plainenglish.io/find-the-nearest-location-in-a-react-way-9ed51a999807?source=collection_archive---------3-----------------------#2021-05-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="2ac4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">—️地理定位API</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/0e83a9597e7dcccea1ccdd5e1b3c24d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_0qEE2ai-EW_6S0Tsw7Kw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Long way to go, keep learning — 路漫漫其修道远，吾将上下而求索</figcaption></figure><p id="c0e3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我最近的一个React项目中，我需要从世界各地的医学研究机构(<strong class="jm io">试验</strong>)中找到离用户最近的位置，并显示其内容。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="43dd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这听起来很复杂。起初感觉很混乱，但仔细考虑后，我注意到这里实际上有4点:</p><ul class=""><li id="b296" class="lf lg in jm b jn jo jr js jv lh jz li kd lj kh lk ll lm ln bi translated"><em class="lo">当前用户位置</em> <em class="lo">📍</em></li><li id="1905" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh lk ll lm ln bi translated"><em class="lo">全球试验📍</em></li><li id="d0bc" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh lk ll lm ln bi translated"><em class="lo">各试验点📍</em></li><li id="38d5" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh lk ll lm ln bi translated"><em class="lo">距离这些位置最近的位置📍</em></li></ul><p id="8081" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">🤯</p><p id="931f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是让我们一步一步地简化这件事:</p><p id="bf5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">首先</strong>用<strong class="jm io">地理定位API </strong>获取我们用户的当前位置，以便以后可以和所有的试航地点进行比较:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lu"><img src="../Images/37f4e639dfcc3b99d616da142cb98bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eZuPCwU_ojhQRUXfkWTgzg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">🌐 <em class="lv">The Geolocation API returns </em>geographical position of a user, since this can compromise privacy, the position is not available unless the user approves it</figcaption></figure><p id="8de8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lo">在我的项目中，有一个Api返回关于一个</em> <strong class="jm io"> <em class="lo">单个</em> </strong> <em class="lo"> </em> <strong class="jm io"> <em class="lo">试验、</em> </strong> <em class="lo">的信息。首先，我提取了如下数据:</em></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/7df7d33fed56ec4d52d5d9e6a5e6d4fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*1GRLSlMjv0zDC4rfo3ojNg.png"/></div></figure><p id="8af1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">📝但是对于这篇文章，我将使用模拟数据进行试验</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lx"><img src="../Images/b9511f6eab603069466206f6c8bfc585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AstThmwcpSscGxLcwjusXQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">single trial mock data, “location” refers to the trial name, “locations” refers to all the available locations within this trial</figcaption></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="6b96" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">其次</strong>创建一个<strong class="jm io">自定义钩子</strong>的功能，计算<strong class="jm io">用户</strong>和<strong class="jm io">试验</strong>位置之间的距离，使用<strong class="jm io"> lat </strong>和<strong class="jm io"> lon </strong>作为<strong class="jm io">纬度</strong>和<strong class="jm io">经度</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/5f34d2e7f6e2866c09d44d2ca58f6a6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZ3XR6tOLp1J1RwXx4m0QQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">🎲 Calculate distance based on latitude and longitude</figcaption></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="7911" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">接下来</strong>，用以下命令在反应组件中导入该自定义钩子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/054cd8fb4230077e5a1bfc101d78e48a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*1E45m8t6b7zZeN9makib3w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">import hook within react component</figcaption></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="89c3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">然后</strong>创建一个<strong class="jm io">getfinallytrial()</strong>函数，该函数使用这个自定义钩子并返回最近的试验位置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ma"><img src="../Images/f2b73292272b3895d5a8c7055ff8e2d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z4uyBFcGSB1NJFRMJCifwA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">find closest location between user and trial locations using custom hook</figcaption></figure><p id="4d51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在上面做的是:</p><ol class=""><li id="7768" class="lf lg in jm b jn jo jr js jv lh jz li kd lj kh mb ll lm ln bi translated">检查是否有从后端返回的trialDetail及其位置(在从API获取的真实项目中，对于本文，模拟数据来自第一步<strong class="jm io"/>“<strong class="jm io">trial detail”</strong>)</li><li id="8b55" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh mb ll lm ln bi translated">如果是，将<strong class="jm io">试验细节位置映射到</strong>上，得到<strong class="jm io">试验纬度</strong>和<strong class="jm io">试验经度</strong>阵列(💥<strong class="jm io">键</strong>在本例中省略，但在现实世界中应该明确使用<strong class="jm io"/>，例如可以是<strong class="jm io">id</strong></li><li id="baef" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh mb ll lm ln bi translated">取<strong class="jm io">三纬度</strong>，“映射”它，得到一个包含每个试验纬度的数组，我使用每个纬度项的<strong class="jm io">索引</strong>，<strong class="jm io">将它们对应到<strong class="jm io">三经度</strong>数组中的每个<strong class="jm io">经度</strong></strong></li><li id="7be2" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh mb ll lm ln bi translated">用这些<strong class="jm io">参数调用从<strong class="jm io"> useLocationDistance </strong> <strong class="jm io">自定义钩子</strong>导入的<strong class="jm io"> distance() </strong>函数，</strong> this <strong class="jm io"> </strong>返回一个数组，包含用户与每个试验位置之间的所有比较距离</li><li id="bd50" class="lf lg in jm b jn lp jr lq jv lr jz ls kd lt kh mb ll lm ln bi translated">从该数组中找出距离<strong class="jm io">最短距离</strong>的最小数字，将其定义为距离<strong class="jm io">最近的</strong>，并使用其<strong class="jm io">索引</strong>，以便从所有试验位置中找到相应的位置</li></ol></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="9312" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">最后一步:</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/c8550d84a0f2e5fc8051de5f76ebc946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqkOaoXsfRqpZENLFs-rRw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">call getFinalTrial() within useEffect and set the final info state</figcaption></figure><p id="8fd0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lo">如果我们“console.log”了finalLocationInfo，我们就得到这个最近的位置(在这个例子中是第一个来自</em> <strong class="jm io"> <em class="lo">模拟审判</em> </strong> <em class="lo">的位置)</em>👇</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi md"><img src="../Images/aacd2e06ccf1cc0fd13ccf57f21fb536.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*7A2_QylBLGe0_tfRN-72zw.png"/></div></figure></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="b223" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用<strong class="jm io"> useEffect </strong>我们可以更新<strong class="jm io"> finalInfo </strong> <em class="lo">(在上面的代码示例中省略了状态)</em> <strong class="jm io"> </strong>和<strong class="jm io"> </strong>显示我们想要的任何内容，例如使用"<strong class="jm io">final info . recruitmentstatus "</strong>等。在我们的<strong class="jm io">返回</strong>体内以一种<strong class="jm io">的方式对</strong>做出反应。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="2039" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">就是这样！</p><p id="e814" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我觉得这个例子挺有意思的，但是基于我的编码经验不足，可能会有一些不足。我将非常感谢你的建议，谢谢你！</p><p id="5f58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lo">更多内容请看</em><a class="ae me" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="lo">plain English . io</em></a></p></div></div>    
</body>
</html>