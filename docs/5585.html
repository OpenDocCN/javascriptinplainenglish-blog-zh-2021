<html>
<head>
<title>How To Use JavaScript Closures in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在5分钟内使用JavaScript闭包</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-javascript-closures-in-5-minutes-a28deddd3920?source=collection_archive---------1-----------------------#2021-11-21">https://javascript.plainenglish.io/how-to-use-javascript-closures-in-5-minutes-a28deddd3920?source=collection_archive---------1-----------------------#2021-11-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3bec" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在下次面试前掌握JavaScript闭包！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/58d9a06d3f271cbbda1475ab10b545ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FAVYaMF5FykhWhX9"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://paulisaweso.me/" rel="noopener ugc nofollow" target="_blank">Paul Esch-Laurent</a></figcaption></figure><p id="8a1e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你在网上搜索JavaScript面试问题，闭包几乎每次都会出现——而且理由充分。闭包可以用作数据封装的工具。如果开发人员想创建只能由函数访问的变量，闭包是一个不错的选择。</p><p id="7a11" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是闭包还不止于此。闭包如此常见，你很可能已经尝试过了。接下来的五分钟我们来讨论一下。</p><h1 id="1083" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">首先，让我们定义什么是闭包。</h1><h2 id="ee81" class="mh lq in bd lr mi mj dn lv mk ml dp lz lc mm mn mb lg mo mp md lk mq mr mf ms bi translated">领域</h2><p id="dc16" class="pw-post-body-paragraph kt ku in kv b kw mt jo ky kz mu jr lb lc mv le lf lg mw li lj lk mx lm ln lo ig bi translated">要理解闭包，您需要理解JavaScript中的作用域。(如果你已经理解了作用域，可以跳过这一小节。)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/20442c09204cb121acbcc119a39f6e23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLorPqXueZn3ttTkqfqxTg.png"/></div></div></figure><p id="a8e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在JavaScript中，我们有三个作用域:全局作用域、函数作用域和块作用域。全局范围是第一级、祖先到所有范围。整个脚本中只有一个全局范围。函数作用域是每次创建函数时创建的作用域。块作用域是为条件和循环创建的作用域。更多信息，请查看<a class="ae ks" href="https://www.w3schools.com/js/js_scope.asp" rel="noopener ugc nofollow" target="_blank"> W3学校</a>。</p><p id="1919" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您曾经尝试过JavaScript，您会记得嵌套函数、嵌套循环和嵌套条件是存在的。这意味着您可以将作用域嵌套在作用域中，从而创建父作用域和子作用域。</p><p id="3a21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于作用域，最重要的经验是理解变量的可访问性。在JavaScript中，子作用域不仅可以访问自己的局部作用域，还可以访问属于父作用域的变量。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/3eecdd79ab602fcc60ca107d755cce3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vaI75T0L5tTxuiTc09D4g.png"/></div></div></figure><p id="31f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">例如，在这个示例代码中，函数作用域是全局作用域的子作用域。在函数中，它使用在父作用域中定义的变量“a”。这是JavaScript允许的。子作用域可以访问外部作用域中声明/初始化的变量。</p><p id="ce16" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然而，如最后一行所示，父作用域不能访问子作用域中的可用数据。最后一行，b在全局范围内不存在。</p><p id="4e24" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">同样，要了解更多关于示波器的信息，请查看<a class="ae ks" href="https://www.w3schools.com/js/js_scope.asp" rel="noopener ugc nofollow" target="_blank"> W3学校</a>。</p><h2 id="d4c8" class="mh lq in bd lr mi mj dn lv mk ml dp lz lc mm mn mb lg mo mp md lk mq mr mf ms bi translated">关闭</h2><p id="0f05" class="pw-post-body-paragraph kt ku in kv b kw mt jo ky kz mu jr lb lc mv le lf lg mw li lj lk mx lm ln lo ig bi translated">现在，我们可以讨论闭包了。</p><p id="efcb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的示例代码是闭包的一个非常基本的例子。任何时候，当一个函数访问在函数作用域之外声明或初始化的变量时，就会发生闭包。换句话说，就是当它们访问在父作用域、父作用域等等中找到的变量时。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/b57626b435feb4fa29a4d3746ca0be52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjprFLAh-wbAmXhQE0ROiA.png"/></div></div></figure><p id="dd82" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本例中，该函数将两个变量相加并返回总和。该函数在其局部范围内已经有了变量“a”。但是，变量“b”不在局部范围内。当函数实现它时，它将在外部范围内搜索b。幸运的是，b存在于父作用域中，因此函数将使用该值。如果在外部作用域中找不到b，它将简单地返回一条错误消息，说明b不存在。</p><p id="5300" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们来看一个更复杂的闭包例子——这可能是大多数人想到闭包时想到的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/d55ba8a73823cfec2988defe2f91af63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeQZFvKdkThyUzFAmK1SQg.png"/></div></div></figure><p id="ade3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当大多数人想到闭包时，他们可能会想到嵌套在函数中的函数。我们来分解一下。</p><p id="1456" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们从外部函数<strong class="kv io"> getWelcomeMessage()开始。</strong>这个外部函数包含一个变量和一个返回语句——这是闭包的通用模板。闭包通常包含数据(变量)并返回一个函数。</p><p id="8c70" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意变量<strong class="kv io">字符串</strong>总是包含在外部函数中。任何在<strong class="kv io"> getWelcomeMessage() </strong>范围之外的JavaScript代码都不能访问这个变量。这是数据封装的一个例子。这种想法认为，对敏感数据的访问应该仅限于真正需要使用它的关键人物。因此，如果在<strong class="kv io"> getWelcomeMessage() </strong>范围之外的另一个函数或代码行想要访问这些敏感数据，它将无法访问。它应该不能够。</p><p id="beeb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">还要注意函数<strong class="kv io"> getWelcomeMessage()的返回语句。return语句返回一个函数，并定义该函数(以及参数和指令)。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/85ae0c0eca1561c947fbe5c9f6891662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qSy1NSp6eFr1ixGquKA79A.png"/></div></div></figure><p id="a2c7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是前面代码示例的后半部分。我们来分解一下。在第一行中，我们创建了一个名为welcome的变量。我们在这个变量中存储了什么？我们正在存储将从函数调用<strong class="kv io"> getWelcomeMessage()返回的值。</strong>从前面我们知道，这将返回一个函数。</p><p id="ddc3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，请确保您理解以下内容之间的区别:</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="b24c" class="mh lq in nb b gy nf ng l nh ni">let welcome = getWelcomeMessage();<br/>let welcome = getWelcomeMessage;</span></pre><p id="36c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个是函数调用，意味着函数将实际执行并返回值。第二个基本上是将welcome转换成与函数<strong class="kv io"> getWelcomeMessage相同的函数。</strong>名称不同，功能相同。我们想要第一个。我们希望函数执行并返回一个函数。</p><p id="c5d9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以现在，在第一行代码之后，welcome是一个函数。它是从外部函数<strong class="kv io"> getWelcomeMessage()返回的函数。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/d55ba8a73823cfec2988defe2f91af63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeQZFvKdkThyUzFAmK1SQg.png"/></div></div></figure><p id="ca4c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们分解返回的函数(第3行)。所以返回的函数只有一个参数，就是一个名字。返回的函数返回“Hello there”加上参数中提供的输入。注意变量<strong class="kv io">字符串</strong>是如何从未命名函数的父函数中取出的。这再次说明了数据封装。只有<strong class="kv io"> getWelcomeMessage </strong>的子作用域可以访问该字符串。</p><p id="58bc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我们调用这个函数时:</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="719b" class="mh lq in nb b gy nf ng l nh ni">welcome('Kyle'); </span></pre><p id="c98f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">…它将返回“你好，凯尔”。这一点很重要，因为welcome()显然在<strong class="kv io"> getWelcomeMessage() </strong>的范围之外，它仍然可以访问该字符串。这就是为什么闭包是特殊的，知道它是非常重要的。</p><p id="c9d5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你想玩代码，这里是:</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="f1bf" class="mh lq in nb b gy nf ng l nh ni">function getWelcomeMessage(){<br/>  let string = "Hello there, ";<br/>  return function(name){<br/>    return string + name;<br/>  }<br/>}</span><span id="2127" class="mh lq in nb b gy nj ng l nh ni">let welcome = getWelcomeMessage();<br/>console.log(welcome('Kyle'));</span></pre><p id="c6ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我还将提供其他例子，你可以玩。感谢您的阅读！</p><p id="c419" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">样本1</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="9138" class="mh lq in nb b gy nf ng l nh ni">function plusFive(){<br/>  let x=5;<br/>  return function(y){<br/>    return x + y;<br/>  }<br/>}</span><span id="c10d" class="mh lq in nb b gy nj ng l nh ni">let addFive = plusFive();<br/>console.log(addFive(4));<br/>console.log(addFive(9));</span></pre><p id="c513" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">样本2</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="0f03" class="mh lq in nb b gy nf ng l nh ni">let x = 200;</span><span id="ca7b" class="mh lq in nb b gy nj ng l nh ni">function foo(y){<br/>  return function(z){<br/>    return x + y + z;<br/>  }<br/>}</span><span id="47b4" class="mh lq in nb b gy nj ng l nh ni">let bar = foo(51);<br/>console.log(bar(945));</span></pre><p id="5f68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">样本3</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="bd7c" class="mh lq in nb b gy nf ng l nh ni">function foo(y){<br/>  let x =  420;<br/>  return (z) =&gt; {return x+y+z};<br/>}</span><span id="9482" class="mh lq in nb b gy nj ng l nh ni">let bar = foo(320);<br/>console.log(bar(2));</span></pre><p id="8032" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">样本4</p><pre class="kd ke kf kg gt na nb nc nd aw ne bi"><span id="7163" class="mh lq in nb b gy nf ng l nh ni">function foo(){<br/>  let lastName = "Smith";<br/>  return (firstName) =&gt; {return firstName + " " + lastName};<br/>}</span><span id="acbb" class="mh lq in nb b gy nj ng l nh ni">let bar = foo();<br/>console.log(bar("Will"));<br/>console.log(bar("Jada-Pinkett"));<br/>console.log(bar("Jaden"));<br/>console.log(bar("Willow"));<br/>console.log(bar("Trey"));</span></pre><p id="3935" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="my">更多内容请看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="my">plain English . io</em></a><em class="my">。在这里注册我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="my">免费周报</em> </a> <em class="my">。</em></p></div></div>    
</body>
</html>