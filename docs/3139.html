<html>
<head>
<title>Automating Twilio Function Deployments using the Twilio CLI and Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Twilio CLI和Github操作自动部署Twilio功能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/automating-twilio-function-deployments-using-the-twilio-cli-and-github-actions-cfbfa9bd2898?source=collection_archive---------12-----------------------#2021-06-25">https://javascript.plainenglish.io/automating-twilio-function-deployments-using-the-twilio-cli-and-github-actions-cfbfa9bd2898?source=collection_archive---------12-----------------------#2021-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3645" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何跳过没完没了的谷歌搜索，直接进入有趣的部分</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d8edc554a9b5e89ea96c9efe36bdfced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qwSssKWsupBsf4s-"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@martinadams?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Martin Adams</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ca21" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很容易被一个伟大的黑客新闻或媒体报道所吸引，并相信前端开发是在公园里散步。事实上，这更像是一场雷雨中的马拉松:迎着风，不停地跑，让人精疲力尽——但最终还是令人满意的。使用CLI和Github简化Twilio函数是这种体验的一个很好的例子，我已经记录了我的学习，以帮助其他人完成这一旅程。</p><p id="8801" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但首先，做个小小的介绍。</p><h2 id="8649" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">部署Twilio函数</h2><p id="a747" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">我最近<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/still-using-twilio-functions-classic-here-are-8-reasons-why-you-should-migrate-to-the-cli-8dcbec8b46a">写了一篇文章</a>讲述从Twilio Functions Classic迁移到CLI的旅程，但是即使你使用最新版本的命令行界面，部署仍然可能不是最佳的。</p><p id="fac6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">配置完成后，部署到环境中就像<code class="fe mq mr ms mt b">npm run deploy</code>一样简单。真的很简单。出现的问题——尤其是在团队中工作时——是知道谁最后部署了什么以及部署到哪里。</p><pre class="kg kh ki kj gt mu mt mv mw aw mx bi"><span id="0d72" class="ls lt iq mt b gy my mz l na nb">twilio serverless:deploy --env=./build/.constants.staging --environment=staging --profile=ta-env-staging --override-existing-project</span></pre><p id="80e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当使用非常标准的Git工作流时，通常很容易看到发生了什么变化，利用版本控制使我们在TripActions的开发过程显著地更加透明。能够发出拉取请求并拥有分支是非常有用的。</p><p id="a25c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是就其本身而言，Git不会告诉您每个环境部署了什么。</p><h2 id="378b" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">输入GitHub操作</h2><p id="52fa" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>在CI/CD领域有些新，于2019年底推出。现在，你可以利用丰富的应用环境，提供各种各样的功能，从林挺和<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/making-sonarcloud-play-nicely-with-jest-fa271f559024">测试代码</a>、<a class="ae kv" href="https://github.com/marketplace/actions/slack-notify" rel="noopener ugc nofollow" target="_blank">松弛通知</a>到<a class="ae kv" href="https://medium.davidendersby.me/micro-projects-a-fun-alternative-to-soul-sapping-side-projects-4112732caa8" rel="noopener ugc nofollow" target="_blank">去重复本地键值对</a>。</p><p id="4f15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，GitHub操作对所有人都是开放的，易于理解，并且有固有的版本控制(在repo中，与它们处理的代码在一起)。它们可以根据您的需要而简单或复杂，自动处理需要在评审时发生的平凡任务(尽管我建议保持事情简单，将功能模块化到多个动作中)。利用<a class="ae kv" href="https://docs.github.com/en/actions/reference/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank"> Githubs事件触发器</a>，动作可以配置为在许多不同的时间运行。最常见的实例是在推送、合并或发布创建时。但如果需要，也可以按计划运行。</p><h2 id="2c4a" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">让Twilio CLI与GitHub操作一起工作</h2><p id="81de" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">将所有这些整合在一起并使部署有效是一个棘手的问题。</p><p id="c849" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们遇到的最大错误与Twilio授权和配置文件有关。</p><pre class="kg kh ki kj gt mu mt mv mw aw mx bi"><span id="efb9" class="ls lt iq mt b gy my mz l na nb">» Secure credential storage failed to load. Alternatively, twilio-cli can use credentials stored in environment variables:</span><span id="dce6" class="ls lt iq mt b gy nc mz l na nb"># OPTION 1 (recommended)<br/>export TWILIO_ACCOUNT_SID=your Account SID from twil.io/console<br/>export TWILIO_API_KEY=an API Key created at twil.io/get-api-key<br/>export TWILIO_API_SECRET=the secret for the API Key</span><span id="9a8a" class="ls lt iq mt b gy nc mz l na nb"># OPTION 2<br/>export TWILIO_ACCOUNT_SID=your Account SID from twil.io/console<br/>export TWILIO_AUTH_TOKEN=your Auth Token from twil.io/consoleOnce these environment variables are set, a twilio-cli profile is not required and you may skip the "login" step.</span><span id="0c06" class="ls lt iq mt b gy nc mz l na nb"> » The profile "ta-env-staging" does not exist. Run "twilio profiles:list" to see the list of configured profiles.</span></pre><p id="678a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是因为我们试图模拟本地部署，这需要使用<code class="fe mq mr ms mt b">twilio login</code>和<code class="fe mq mr ms mt b">twilio profiles</code>命令(<code class="fe mq mr ms mt b">create</code>、<code class="fe mq mr ms mt b">list</code>、<code class="fe mq mr ms mt b">use</code>)登录。等等)。我们花了太长时间才意识到我们不需要这样做——你可以使用环境变量来处理凭证(见下文)。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c7dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码片段显示了我们的3步发布过程。首先，当一个分支与主/主合并时，我们将它部署到开发环境中。当我们准备好部署到生产时，我们在Github中创建一个发布，它触发部署到staging。现在我们有机会运行集成和API测试——我们将<a class="ae kv" href="https://docs.github.com/en/actions/reference/environments" rel="noopener ugc nofollow" target="_blank"> Github环境</a>配置为在部署到生产之前暂停等待批准。一旦获得批准，发布就被部署到生产中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/3871eecfaaf28a12dc1f9dbfd4293202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yoO4AEvDcDSaYS_X_aESIg@2x.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">The deploy pipeline in action. It deploys to staging then waits for permission to deploy to Production. Here we also added a 5 minute cooldown timer.</figcaption></figure><p id="7d49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，释放过程非常简单，可以由任何访问回购的开发人员触发。我们保留了对发布到产品中的内容的控制，我们现在在Github中有日志，向我们显示谁触发了部署、何时触发的以及部署了什么。</p><p id="cad3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你觉得这很有用</p><p id="269a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读</p><p id="f85e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大卫</p><p id="44d0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">高级前端开发者@ <a class="ae kv" href="https://tripactions.com/" rel="noopener ugc nofollow" target="_blank"> TripActions </a>(通常是<a class="ae kv" href="https://grnh.se/cbeb241d1" rel="noopener ugc nofollow" target="_blank">招聘</a>！)</p><p id="e48b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ng">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ng">plain English . io</em></strong></a></p></div></div>    
</body>
</html>