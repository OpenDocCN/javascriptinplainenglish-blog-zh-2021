<html>
<head>
<title>Role-Based Access Like a Pro</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专家一样基于角色的访问</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/role-based-access-like-a-pro-eb8f1207ca29?source=collection_archive---------9-----------------------#2021-02-14">https://javascript.plainenglish.io/role-based-access-like-a-pro-eb8f1207ca29?source=collection_archive---------9-----------------------#2021-02-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e037a89f98ef470568f3a0bb8d05ce94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7i4UVwVNhq8hvoc2"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@huntersrace?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hunters Race</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e0cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你有没有想过开发一个应用程序，让不同类型的用户使用它？</p><p id="1eb2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你心里一定有几个问题。您将如何限制用户执行特定的操作？在这种情况下，您如何管理系统的安全性？你到底应该如何为他们生成一个令牌。</p><p id="546f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">今天，我们将讨论如何创建一个能够为任何角色生成令牌并像专家一样验证令牌的应用程序。</p><h2 id="835a" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">先决条件</h2><p id="5110" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">我们将使用Node Js和Express创建一个API，然后向它添加基于角色的访问。当然，我们会添加一些库来帮助我们。</p><h2 id="45c2" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">目标</h2><p id="6442" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">我们将创建一个银行应用程序后端，将有3种用户</p><ul class=""><li id="ae32" class="lw lx in kc b kd ke kh ki kl ly kp lz kt ma kx mb mc md me bi translated">顾客</li><li id="4de6" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated">代理人</li><li id="a506" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated">管理</li></ul><p id="45fa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将为他们每个人生成不同的令牌，并根据角色添加限制。例如，客户可以获得他们的信息，代理可以添加/更新帐户，管理员可以批准该用户。但是现在，我们将避免注册/添加/更新/批准帐户的核心逻辑。我们将编写愚蠢的代码，只关注基于角色的访问。</p><h2 id="3d6c" class="ky kz in bd la lb lc dn ld le lf dp lg kl lh li lj kp lk ll lm kt ln lo lp lq bi translated">开始</h2><p id="7f6c" class="pw-post-body-paragraph ka kb in kc b kd lr kf kg kh ls kj kk kl lt kn ko kp lu kr ks kt lv kv kw kx ig bi translated">我们将克隆<a class="ae jz" href="https://github.com/Piyush-Use-Personal/Role-Based-Access.git" rel="noopener ugc nofollow" target="_blank"> <em class="mk">回购</em> </a>的入门或如果想要完整的代码，那么你可以随时切换分支。它只是一个文件夹，有一个express应用程序准备好并运行在端口8080，你只需要拉然后运行<code class="fe ml mm mn mo b">npm install</code>和<code class="fe ml mm mn mo b">npm run dev</code>。代码很简单，你有一堆路由和相应的控制器，用空的中间件调用回调。</p><p id="4f3a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将从发送所有路由的成功消息开始。就像下图一样。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/37da1f0d2fe1f51e03d13bbab6e32097.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*miV-d72wQDBhlT5WafAXyA.png"/></div></figure><p id="a1c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如我提到的，我们不会创建任何控制逻辑，所以只是放一些垃圾代码来生成随机的用户类型(这将帮助我们获得不同的令牌值)。</p><p id="7c92" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更新后的代码将如下所示，</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/203a4556b71169e00b11c15c3f4ed2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*CSyOy_QThzhEZyCcq5tRUQ.png"/></div></figure><p id="debb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们创建一些文件来帮助我们。首先，添加一个文件夹/lib，并在该文件夹下创建一个文件<strong class="kc io"> Authentication.js </strong>并安装一个名为<a class="ae jz" href="https://www.npmjs.com/package/jsonwebtoken" rel="noopener ugc nofollow" target="_blank"> <em class="mk"> jsonwebtoken </em> </a>的包。一旦这个包被安装，它会给我们很多方法来使用，但我们主要集中在创建一个令牌和验证它。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="9e2a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们在middleware文件夹中添加一个名为AuthenticateRoles.js的中间件。</p><p id="b8f7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，这是至关重要的一步。首先，我们需要定义我们想要验证哪些角色，并基于此创建一个子函数，最后，创建一个主函数来处理实际验证，最后，我们可以将用户身份附加到req.user参数。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="8e2b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您还可以根据收到的错误创建多个状态代码，如果需要多个相同级别的身份验证，则可以将一组角色传递给控制器，并通过循环函数使其工作。</p><p id="eae8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是时候看看所有的活动了。继续在路由和登录API中进行更改。</p><p id="a626" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是来自routes文件的代码，我们可以根据之前创建的中间件和在Login API中生成令牌的控制器文件来应用我们必须赋予用户的任何角色。</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Routes file</figcaption></figure><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Controller file</figcaption></figure><p id="f2cf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是最后一步，</p><p id="c295" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你去的路线:<em class="mk">http://localhost:8080/API/log in</em></p><p id="2e67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用这些路线中的任何一条来检查令牌是否正常工作。</p><ul class=""><li id="4ce4" class="lw lx in kc b kd ke kh ki kl ly kp lz kt ma kx mb mc md me bi translated"><em class="mk">http://localhost:8080/API/account【放】</em></li><li id="5491" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated"><em class="mk">http://localhost:8080/API/</em>账号</li><li id="e44b" class="lw lx in kc b kd mf kh mg kl mh kp mi kt mj kx mb mc md me bi translated"><em class="mk">http://localhost:8080/API/</em>批准</li></ul><p id="f550" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将能够随机创建一个令牌，因为我们没有适当的控制逻辑，但我敢打赌，您现在已经对我们如何管理多角色身份验证有了相当的了解，如果您想查看整个项目的运行情况，请转到分支<em class="mk">基于角色的访问</em>到上述回购，或单击<a class="ae jz" href="https://github.com/Piyush-Use-Personal/Role-Based-Access/tree/role-based-access" rel="noopener ugc nofollow" target="_blank"> <em class="mk">此处</em> </a>。</p><p id="65ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读:)</p></div></div>    
</body>
</html>