<html>
<head>
<title>Get rid of callback hell with async/await</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用async/await解决回调问题</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/get-rid-of-callback-hell-with-async-await-f21f1b5e3364?source=collection_archive---------12-----------------------#2021-08-17">https://javascript.plainenglish.io/get-rid-of-callback-hell-with-async-await-f21f1b5e3364?source=collection_archive---------12-----------------------#2021-08-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8892" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Promise改变了我们对JavaScript中回调的看法。它还改变了我们编写回调的方式，并为回调地狱提供了一个很好的解决方案🤯</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/96a9bc9fe8cddc3a7019e68197a96b2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GFBXHkYkhma0PFYhxSSJ5g.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jeremybishop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jeremy Bishop</a> on <a class="ae kv" href="https://unsplash.com/s/photos/waves?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6523" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将解释如何使用async/await编写更易于阅读和理解的代码。</p><p id="82e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">用例—从一个API端点按书名搜索一本书，这个API端点有该书的ISBN、书名和价格，另一个API端点检查该书是否有库存，然后点击另一个API端点检查其价格，连接所有响应，然后将其发送到前端。</p><p id="9fa4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先，让我们假设一个API，当按书名搜索时，它返回一本书。在这个例子中，我正在搜索一本名为《孙子兵法》的书。这个API响应返回具有名称、作者和ISBN的book对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="056d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后使用<code class="fe lu lv lw lx b">getBookByName</code>承诺调用getBookByName方法</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="07b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦找到书的详细信息，让我们通过调用另一个承诺来检查这本书是否有货。在这个承诺中，我将返回股票&amp; ISBN详细信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="694f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后通过传递从响应中收到的ISBN来调用<code class="fe lu lv lw lx b">getBookByName</code>方法中的<code class="fe lu lv lw lx b">checkIfBookExists</code>方法。<code class="fe lu lv lw lx b">checkIfBookExists</code>将图书ISBN作为参数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="561b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果图书库存存在，<code class="fe lu lv lw lx b">checkIfBookExists</code> API返回库存数量和ISBN。之后，让我们通过使用<code class="fe lu lv lw lx b">BooksRun API</code>来检查图书的定价，BooksRun API通过ISBN返回图书的价格。该响应包含任何书籍的新价格、旧价格和租金🤘</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="1a93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果图书的库存大于0，则调用<code class="fe lu lv lw lx b">getTheBookPrice</code>。让我们查一下那本书的价格</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="9a0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在真实的场景中，会有空检查和API调用🤭在上面的代码示例中，有很多回调，<code class="fe lu lv lw lx b">then</code>并且我试图避免编写catch😂。现在用<code class="fe lu lv lw lx b">async/await</code>重写整个例子👇</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="62c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用async/await使代码看起来更干净，可读性更好，调试也更容易👍</p></div><div class="ab cl ly lz hu ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ij ik il im in"><p id="028c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完整的代码片段供参考👇</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="b84a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您花时间阅读这篇文章！🙏</p><p id="db61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mf">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="mf">plain English . io</em></strong></a></p></div></div>    
</body>
</html>