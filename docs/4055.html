<html>
<head>
<title>Struggling With Promises in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">纠结于JavaScript中的承诺？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/struggling-with-promises-in-javascript-7808ec1303cc?source=collection_archive---------2-----------------------#2021-08-13">https://javascript.plainenglish.io/struggling-with-promises-in-javascript-7808ec1303cc?source=collection_archive---------2-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="463d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">结束你的痛苦。了解如何在现有代码库中使用承诺。帮助你把握承诺的真实例子。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/33fa174d6b1aeaa506542950a9d0c997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mj9OlkMvRvvw6sBVintbgw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae kv" href="https://www.pexels.com/@mhmd-sedky-1725307?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">📷</a></figcaption></figure><p id="930a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我见过人们在承诺中挣扎。这篇文章旨在帮助个人理解这个令人惊奇的话题。我们将努力通过现实生活中的例子来获得一个合适的关于承诺的心智模型。</p><blockquote class="ls"><p id="1474" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">你越是努力去理解，越是不理解任何问题。要理解，头脑必须安静。</p><p id="b1ba" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">—吉杜·克里希那穆提</p></blockquote><p id="75b9" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">你喜欢做饭吗？我不知道你怎么样，但是我喜欢烹饪。我通常自己做饭，尽管我不反对有人帮忙。</p><p id="9c7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很多时候，你会发现自己在做饭的时候需要一些东西，而那该死的东西不在你的房子里，你不得不在做饭的时候让别人帮你拿。同时，你继续做你的工作！</p><p id="3d1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能熟悉这种做事方式——在编程语言中——我们称之为<strong class="ky ir"> <em class="mh">异步。</em>T3】</strong></p><p id="74c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在编程中我们经常异步地做事情。也就是说，我们启动了某件事，甚至在它完成之前，我们启动了另一项任务。</p><p id="df3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在JavaScript中，我们很大程度上依赖于异步操作——其结果我们现在还不知道，但以后会知道。</p><p id="7f07" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JavaScript本身不是异步的，但是它支持异步编程。</p><p id="98fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ES6引入了一个让处理异步任务更容易的想法:<strong class="ky ir"> <em class="mh">承诺</em> </strong>。</p><p id="9c14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">承诺是一个对象——最终结果的占位符。</p><p id="07e4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以前并不是我们不能做异步操作。我们做到了。</p><p id="e806" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们所要做的就是以某种方式利用回调！当我们的行动失败时，当我们需要完成一项任务时，这样做是一种折磨。</p><p id="88a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">承诺规范了处理<strong class="ky ir"> <em class="mh">异步事件</em> </strong>和<strong class="ky ir"> <em class="mh">回调</em> </strong>的方式。</p><h1 id="4bfc" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">让我们用这个小故事来理解承诺</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/158a5ba7b325f7371a1bea50e40458ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhZJwK8xvjdDGnsnlAESKg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/93e28f52fc2484f8b85bd8eb7ad58d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*co3JdR-Qq5BB1ds7CaQtog.png"/></div></div></figure><p id="ea1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我还不是一个讲故事的大师！然而，前面的场景包含了帮助您理解承诺概念的所有必要信息。</p><h2 id="103b" class="nb mj iq bd mk nc nd dn mo ne nf dp ms lf ng nh mu lj ni nj mw ln nk nl my nm bi translated">让我们从中提取要点，并将其应用于JavaScript世界。</h2><p id="c7e6" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">我们需要一个关于承诺的标准描述——没有比MDN更好的了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/8e73c685668837b7051c599223847e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oJVZUT9eDxjcmmxTr7tORg.png"/></div></div></figure><p id="537a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看看，这个定义和我们的故事有什么关系。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/32e6f156b9da3966274092a44417bd48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FtNMSdpZsKwT1nIDEgSx7Q.png"/></div></div></figure><p id="dd02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个定义现在更有意义了！</p><p id="aebd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在JavaScript中，一个<strong class="ky ir"> <em class="mh">承诺</em> </strong>只是一个对象。它是一个<strong class="ky ir"> <em class="mh">占位符</em> </strong>，代表一个我们现在没有但以后会有的值。它确保我们最终会知道异步操作的结果。</p><h1 id="4d93" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">环境并不重要——重要的是你的存在状态——你选择了什么样的存在状态？</h1><p id="5662" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">承诺只不过是一个对象，对象通常会保持一种状态。通过修改状态，我们在编程中完成许多复杂的任务。</p><p id="014f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">承诺总是处于三种状态之一:</p><ul class=""><li id="21ca" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><strong class="ky ir">未决:</strong>这是初始状态——既不被满足也不被拒绝。</li><li id="de92" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><strong class="ky ir">完成:</strong>表示操作成功完成。</li><li id="ebc7" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><strong class="ky ir">拒绝:</strong>表示操作失败。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/d182555ffde639e8d72ad5286e668947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7pNnd_1UDwypRvzeYg9LKw.png"/></div></div></figure><p id="dd76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在深入研究代码之前，通过将潜在的<em class="mh">原则与我们的故事</em>联系起来，建立一个强大的心智模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/f57e89988b1fb4af35a2782d56c57aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JHbrtdV0UnagP1QaV1m36w.png"/></div></div></figure><h1 id="3556" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">如何兑现承诺？</h1><p id="e3bc" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">如果我们想在代码中使用promise，那么我们必须首先理解这三个基本概念。</p><ul class=""><li id="f5e4" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><strong class="ky ir">如何创造承诺？</strong></li><li id="a6e4" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><strong class="ky ir">如何履行或拒绝承诺？</strong></li><li id="352b" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><strong class="ky ir">如何运行回叫功能—取决于承诺是<em class="mh">解决</em>还是<em class="mh">拒绝。</em> </strong></li></ul><blockquote class="ls"><p id="c969" class="lt lu iq bd lv lw oi oj ok ol om lr dk translated">“启发我们的不是答案，而是问题。”</p><p id="88d1" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">—欧仁·尤内斯库</p></blockquote><p id="16a5" class="pw-post-body-paragraph kw kx iq ky b kz mc jr lb lc md ju le lf me lh li lj mf ll lm ln mg lp lq lr ij bi translated">如果你明白了这三点，处理承诺就会轻而易举。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/7adf6e2548ba6863e736a4d70373088c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9HAhA9ehDB7D14dFAuWzg.png"/></div></div></figure><p id="b317" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们分别来看看每一个。</p><h2 id="dbdd" class="nb mj iq bd mk nc nd dn mo ne nf dp ms lf ng nh mu lj ni nj mw ln nk nl my nm bi translated"><strong class="ak">如何打造</strong>承诺<strong class="ak">？</strong></h2><p id="38f1" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">我们使用带有promise构造函数的<a class="ae kv" href="https://miro.medium.com/max/1210/1*0wJYjMQ9uwVEYzBj89oL4A.gif" rel="noopener"> <strong class="ky ir"> <em class="mh"> new </em> </strong>关键字</a>创建一个promise的实例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/a03edd1e5d2eb2227f787fb260d404ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tMeVXaUM_CHpZ3sXGlFzuA.png"/></div></div></figure><h2 id="9726" class="nb mj iq bd mk nc nd dn mo ne nf dp ms lf ng nh mu lj ni nj mw ln nk nl my nm bi translated">如何履行或拒绝承诺？</h2><p id="f4e6" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">promise构造函数接受一个函数作为它的参数——让我们传入一个箭头函数(但是我们也可以很容易地使用函数表达式)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/250957327eef83db7f7f70fdbedc7d6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CC3LeEpSGKhndrshT50t8w.png"/></div></div></figure><p id="e56c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个函数被称为executor函数，它自动接收两个参数<code class="fe oq or os ot b">resolve</code>和<code class="fe oq or os ot b">reject</code>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/0e31b1d4a7807951d5f657f8581372bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4oUtqmnkQltn1XWPe0Atw.png"/></div></div></figure><p id="8a50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住— <strong class="ky ir"> <em class="mh">解决</em> </strong>和<strong class="ky ir"> <em class="mh">拒绝</em> </strong>都是函数。</p><ul class=""><li id="23a0" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><code class="fe oq or os ot b">resolve</code>是一个函数，当被调用时，将承诺的状态从待定更改为已履行。</li><li id="a302" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><code class="fe oq or os ot b">reject</code>是一个函数，当被调用时，将承诺的状态从待定更改为拒绝</li></ul><p id="1686" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请记住，您不能直接改变承诺的状态—您可以调用<strong class="ky ir"> <em class="mh"> resolve </em> </strong>函数来履行承诺，或者调用<strong class="ky ir"> <em class="mh"> reject </em> </strong>函数来拒绝承诺。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/c3b89792c9c9a77af362705a90858060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOOd5xCR_LgcMIiuBPgSrw.png"/></div></div></figure><p id="7f94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个函数通常在异步操作后调用。</p><p id="5b82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了简单起见，让我们用<code class="fe oq or os ot b">setTimeout()</code>来模拟搜索豆腐所需的时间。我们假设你的朋友花了五分钟出去给你回短信。</p><div class="kg kh ki kj gt ab cb"><figure class="ow kk ox oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/44d7d660d303a52620ad80cc39658279.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*qf1pLyDTJvlhTqgJqoPx-g.png"/></div></figure><figure class="ow kk pc oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3c1d879d03ed1ccfdea78f8896589659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*hcCPqO_opLOi3o0dGLJMBA.png"/></div></figure></div><p id="1c60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们重构了代码，加入了<code class="fe oq or os ot b">setTimeout</code>函数。</p><p id="4ac5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们得到豆腐——我们会在五分钟后呼叫<code class="fe oq or os ot b">resolve</code>,如果我们没有得到豆腐——我们会在五分钟后呼叫<code class="fe oq or os ot b">reject</code>。</p><p id="ef18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这差不多就是你履行或拒绝承诺的方式。</p><h2 id="7e1f" class="nb mj iq bd mk nc nd dn mo ne nf dp ms lf ng nh mu lj ni nj mw ln nk nl my nm bi translated"><strong class="ak">如何运行回叫功能—取决于承诺是<em class="on">解决</em>还是<em class="on">拒绝</em>。</strong></h2><p id="1a1e" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">最后一步是理解如何根据承诺的状态变化执行回调函数。记住回调函数是作为参数提供给另一个函数的函数。</p><p id="64a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回调函数意味着我们将使用那个函数作为另一个函数的参数。</p><p id="225c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们定义两个回调函数— <code class="fe oq or os ot b">onFulfilled</code>和<code class="fe oq or os ot b">onFailure</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/cceca92369b61410a85250a02c809e13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sWxMGiP9K-fxqAdKdX4IA.png"/></div></div></figure><p id="549f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe oq or os ot b">onFulfilled()</code>是异步操作后调用<strong class="ky ir"> <em class="mh"> resolve </em> </strong>时要调用的函数</p><p id="81ce" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe oq or os ot b">onFailure()</code>是异步运行后调用<strong class="ky ir"> <em class="mh"> reject </em> </strong>时要调用的函数。</p><p id="5aa0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">理想情况下，回调函数中会有更多的代码，但是我们只需登录到控制台，它就能达到目的。</p><p id="8348" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回到我们的类比，如果我们找到了豆腐，那么我们的承诺就实现了——我们想摆桌子吃饭。如果他们找不到豆腐，那么我们的承诺就被拒绝了——我们必须开始煮意大利面。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/96062e23c5112a28748b0aff7942f5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zAiwSKlhwltUZeP5xZvAGA.png"/></div></div></figure><p id="9221" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可能想知道如何利用这两个回调函数？</p><p id="fc5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我们使用promise构造函数创建一个新的promise时，promise对象为我们提供了两个方法— <code class="fe oq or os ot b">then()</code>和<code class="fe oq or os ot b">catch()</code></p><p id="8667" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以用<code class="fe oq or os ot b">promise.then()</code>和<code class="fe oq or os ot b"> promise.catch()</code>来称呼它。</p><p id="9753" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里重要的一点是:</p><ul class=""><li id="ef2c" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated">如果通过调用<code class="fe oq or os ot b">resolve</code>函数，承诺的状态从待定变为已履行——传递给<code class="fe oq or os ot b">then()</code>函数的函数将被自动调用</li><li id="a14c" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">如果通过调用<code class="fe oq or os ot b">reject</code>函数，承诺的状态从待定变为拒绝，则传递给<code class="fe oq or os ot b">catch()</code>函数的函数将被自动调用</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/96d798d4d920879c79cc9e57048de32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8KP6GnrNBaeq1bZpJLW2jw.png"/></div></div></figure><p id="4e0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的情况下，我们需要通过</p><ul class=""><li id="cdd7" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated"><code class="fe oq or os ot b">onFulfilled</code>功能至<code class="fe oq or os ot b">then()</code></li><li id="99f6" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated"><code class="fe oq or os ot b">onFailure</code>功能至<code class="fe oq or os ot b">catch()</code></li></ul><p id="e06d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个函数都是回调函数，因为它们是作为参数提供给其他函数的。我反复提醒你这一点，因为我看到许多人害怕“回调”这个词——没什么好害怕的——它们只是常规函数。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/e0579da38716a61bb03e70d4a81d803a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wusFSG_8gbm0dxNUYUTy8g.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/ab8ec82ed0d567cba9c5b6243ad7a65c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXY1VLoLsNwaRqfXsIsVpA.png"/></div></div></figure><p id="a8f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的promise代码按预期工作。但是还有提升的空间！</p><p id="0b6d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们在<strong class="ky ir"> <em class="mh">解析</em> </strong>或者<strong class="ky ir"> <em class="mh">拒绝</em> </strong>一个承诺的时候想要发出一些数据怎么办？</p><p id="279b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样，在我们的回调函数中，我们可以利用这个值做其他的事情。</p><p id="fa92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">事实证明，我们可以通过传递一个参数给<strong class="ky ir"> <em class="mh"> resolve </em> </strong>或<strong class="ky ir"> <em class="mh"> reject </em> </strong>来做到这一点，</p><ul class=""><li id="8f5b" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated">对于<strong class="ky ir"> <em class="mh">解析</em> </strong>函数，我们将传入一个表示<code class="fe oq or os ot b">Got the Tofu</code>的字符串</li><li id="c9ea" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">对于<strong class="ky ir"> <em class="mh">拒绝</em> </strong>函数，我们将传入一个表示<code class="fe oq or os ot b"> Can’t get Tofu</code>的字符串</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/83e3d89e4cf6b6628e467b485c4b3ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYWSjSOSmiy4XuXfkeFHHA.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pi"><img src="../Images/588a5fc308588235d5323531c201069e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RorBrRM7TdjsBEcZTP9rw.png"/></div></div></figure><p id="0a47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是我们如何在回调函数中访问这些字符串呢？</p><p id="1f8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好吧，承诺的伟大之处在于，它会自动将传递给<em class="mh"> resolve </em>的参数作为<code class="fe oq or os ot b">onFulfilled</code>回调的参数，将传递给<strong class="ky ir"> <em class="mh"> reject </em> </strong>的参数作为<code class="fe oq or os ot b">onFailure</code>回调的参数。</p><div class="kg kh ki kj gt ab cb"><figure class="ow kk pj oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/256d25e184face8b0d4288b87d5a4ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*ihtxdnipaHUONsLsjc0gyg.png"/></div></figure><figure class="ow kk pk oy oz pa pb paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b828014c98ed5779c100e5057e8d40a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*-s9oryvwxOitqLr-pl3lCA.png"/></div></figure></div><p id="6ea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以看到，我在这两个回调中都包含了参数，并简单地将它们记录到控制台中。</p><p id="bbca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，当承诺实现时，我们将看到输出<code class="fe oq or os ot b">Got the Tofu Set up the table</code>,或者如果出现错误并因此被拒绝，我们将看到<code class="fe oq or os ot b">Can't get Tofu Cook pasta.</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/831737f84132b0555c6460d5e228e817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hiCMDWkdyM8C12p_YvVJhw.png"/></div></div></figure><p id="8396" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用承诺的一个很好的例子是从服务器获取数据；我们承诺我们最终会得到数据，但总有可能会出现问题。</p><p id="2fe5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在实际场景中，事情会有所不同。</p><p id="bf5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您的结果将是:</p><ul class=""><li id="42cf" class="nt nu iq ky b kz la lc ld lf nv lj nw ln nx lr ny nz oa ob bi translated">一个对象(JSON)</li><li id="4d6b" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">一个数组，</li><li id="1109" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">或者异步操作返回的任何其他数据类型。</li></ul><p id="f023" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这基本上是JavaScript中承诺的基础。我们将在下一篇文章中了解更多的细节。</p><blockquote class="ls"><p id="1946" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">承诺意味着一切，但一旦违背，道歉就毫无意义</p><p id="b717" class="lt lu iq bd lv lw lx ly lz ma mb lr dk translated">—匿名</p></blockquote><h1 id="0e9c" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw pl jx mu jz pm ka mw kc pn kd my mz bi translated">摘要</h1><ul class=""><li id="2190" class="nt nu iq ky b kz nn lc no lf po lj pp ln pq lr ny nz oa ob bi translated">承诺是一个对象——最终结果的占位符。</li><li id="6932" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">过去，我们使用回调来执行异步操作</li><li id="ee06" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">使用回调是一件痛苦的事情，尤其是当你需要处理错误的时候。</li><li id="3c4b" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">Promises规范了处理异步事件和回调的方式。</li><li id="7b8e" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">承诺总是处于三种状态之一:待定(第一种)、履行或拒绝。</li><li id="61f5" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">操作已完成，并被标记为已完成。操作被拒绝，这意味着它失败了。</li><li id="fed2" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">我们使用带有承诺构造函数的<a class="ae kv" href="https://miro.medium.com/max/1210/1*0wJYjMQ9uwVEYzBj89oL4A.gif" rel="noopener"> <strong class="ky ir"> <em class="mh"> new </em> </strong>关键字</a>创建一个承诺。</li><li id="e43a" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">您不能直接改变承诺的状态—您可以调用<strong class="ky ir"> <em class="mh"> resolve </em> </strong>函数来履行承诺，或者调用<strong class="ky ir"> <em class="mh"> reject </em> </strong>函数来拒绝承诺。</li><li id="d5ef" class="nt nu iq ky b kz oc lc od lf oe lj of ln og lr ny nz oa ob bi translated">我们学习了如何创建承诺，如何履行或拒绝承诺，如何运行回调函数——取决于承诺是被解决还是被拒绝。</li></ul><h1 id="5e14" class="mi mj iq bd mk ml mm mn mo mp mq mr ms jw mt jx mu jz mv ka mw kc mx kd my mz bi translated">感谢信</h1><p id="e1c6" class="pw-post-body-paragraph kw kx iq ky b kz nn jr lb lc no ju le lf np lh li lj nq ll lm ln nr lp lq lr ij bi translated">我想利用这最后的机会说声谢谢。</p><p id="d0c0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您的光临！如果没有像你这样的人，我不可能做我现在做的事情。</p><p id="bce9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望你能<a class="ae kv" href="https://polymathsomnath.medium.com/subscribe" rel="noopener"> <strong class="ky ir">加入我</strong> </a>的<a class="ae kv" href="https://polymathsomnath.medium.com/subscribe" rel="noopener"> <strong class="ky ir">我未来的博客文章</strong> </a>并留下来，因为我认为我们这里有一些伟大的东西。我希望在未来的许多年里，我能在你的职业生涯中帮助你！</p><p id="cd57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下次见。再见！</p><p id="0cc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mh">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mh">plain English . io</em></a></p></div></div>    
</body>
</html>