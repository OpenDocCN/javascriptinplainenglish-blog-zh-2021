<html>
<head>
<title>How to Recursively Call APIs to Get All Results in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何递归调用API以获取JavaScript中的所有结果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-recursively-call-apis-to-get-all-results-in-javascript-58be97b035b1?source=collection_archive---------2-----------------------#2021-11-15">https://javascript.plainenglish.io/how-to-recursively-call-apis-to-get-all-results-in-javascript-58be97b035b1?source=collection_archive---------2-----------------------#2021-11-15</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><h2 id="4c2e" class="ip iq ir bd b dl is it iu iv iw ix dk iy translated" aria-label="kicker paragraph">提示和技巧</h2><div class=""/><div class=""><h2 id="d3cd" class="pw-subtitle-paragraph jx ja ir bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">如何递归地获取每页的结果，并最终将它们返回到一个结果集中。</h2></div><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/650a4755a98b6073bec998191de9c36e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qZk0Zee2kLp0fis1eoF_Hg.jpeg"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk">Photo by <a class="ae lf" href="https://unsplash.com/@gamell?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Joan Gamell</a> on <a class="ae lf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="bc52" class="lg lh ir bd li lj lk ll lm ln lo lp lq kg lr kh ls kj lt kk lu km lv kn lw lx bi translated">挑战</h1><p id="5818" class="pw-post-body-paragraph ly lz ir ma b mb mc kb md me mf ke mg mh mi mj mk ml mm mn mo mp mq mr ms mt ik bi translated">在从事JavaScript项目的大部分时间里，我会编写一些代码来调用<strong class="ma jb">REST API</strong>。这很正常。</p><p id="8cbe" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">然而，有时REST API可能会对每个请求返回的项数有所限制。换句话说，当调用API来获取一些项目时，这些项目将被分成索引页面/组，并且您必须提供页面/组索引。这将仅返回此页面/组中的项目。要获得其余的，您需要重复相同的API调用，但是现在使用不同的索引，等等…</p></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><div class="kq kr ks kt gu ng"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="nh ab fp"><div class="ni ab nj cl cj nk"><h2 class="bd jb gz z fq nl fs ft nm fv fx ja bi translated">订阅艾哈迈德的时事通讯？</h2><div class="nn l"><h3 class="bd b gz z fq nl fs ft nm fv fx dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="no l"><p class="bd b dl z fq nl fs ft nm fv fx dk translated">medium.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu kz ng"/></div></div></a></div></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj nv"><img src="../Images/ae5e9d94cffdf159967b7a8f1545f6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kewz0xLvwocuc8INzphzmA.jpeg"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk">Photo by <a class="ae lf" href="https://unsplash.com/@emilymorter?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Emily Morter</a> on <a class="ae lf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0bc8" class="lg lh ir bd li lj lk ll lm ln lo lp lq kg lr kh ls kj lt kk lu km lv kn lw lx bi translated">怎么做？</h1><p id="b576" class="pw-post-body-paragraph ly lz ir ma b mb mc kb md me mf ke mg mh mi mj mk ml mm mn mo mp mq mr ms mt ik bi translated">这就是我将在本文中向您展示的内容。我们将使用一个简单的API示例，它将项目返回到页面中，并了解如何使用该API并获取所有项目。</p><p id="462c" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">我们将用一个返回承诺和超时调用的函数来模拟API调用。这些条目将从我们定义的静态条目数组中获取。</p><p id="4659" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">此外，需要注意的是，将静态数组的项拆分成页面的逻辑是基于文章<a class="ae lf" href="https://levelup.gitconnected.com/paging-partitioning-main-equations-to-make-it-easy-44fe89d5290b?sk=f65265d7b4c203ac219e7dec1208c0f2" rel="noopener ugc nofollow" target="_blank"> <strong class="ma jb">“分页/分区”中提供的分析、等式和代码——学习主要等式以使其变得简单</strong> </a>。</p><p id="792c" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">在本文中，为了简洁起见，我将只包含代码。</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj nw"><img src="../Images/0ac0fb583440824dae78ebd4eb66ffe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ogNUg1KbGDWry3Fkk-lgg.jpeg"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk">Photo by <a class="ae lf" href="https://unsplash.com/@nublson?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Nubelson Fernandes</a> on <a class="ae lf" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="4c84" class="lg lh ir bd li lj lk ll lm ln lo lp lq kg lr kh ls kj lt kk lu km lv kn lw lx bi translated">让我们写一些代码</h1><h2 id="3242" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">数组页面功能</h2><p id="477b" class="pw-post-body-paragraph ly lz ir ma b mb mc kb md me mf ke mg mh mi mj mk ml mm mn mo mp mq mr ms mt ik bi translated"><em class="oi">详见</em> <a class="ae lf" href="https://levelup.gitconnected.com/paging-partitioning-main-equations-to-make-it-easy-44fe89d5290b?sk=f65265d7b4c203ac219e7dec1208c0f2" rel="noopener ugc nofollow" target="_blank"> <em class="oi">本文</em> </a> <em class="oi">。</em></p><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="139a" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">静态项目数组和默认页面大小</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="be2c" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">执行API调用函数</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="279b" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">我们在这里可以注意到:</p><ol class=""><li id="629c" class="ol om ir ma b mb mu me mv mh on ml oo mp op mt oq or os ot bi translated">这是模拟API调用的函数。</li><li id="2d4d" class="ol om ir ma b mb ou me ov mh ow ml ox mp oy mt oq or os ot bi translated">首先，它使用静态<code class="fe oz pa pb pc b">pageSize</code>变量将静态<code class="fe oz pa pb pc b">items</code>数组分成页面。根据传入的<code class="fe oz pa pb pc b">pageZeroIndex</code>参数，它设置<code class="fe oz pa pb pc b">itemsToReturn</code>内部数组。</li><li id="039d" class="ol om ir ma b mb ou me ov mh ow ml ox mp oy mt oq or os ot bi translated">然后它将这个包装成一个最终的对象，这个对象有一个<code class="fe oz pa pb pc b">paging.pageZeroIndex</code>和<code class="fe oz pa pb pc b">page.totalPagesCount</code>成员。API调用者应该使用这些来知道是否有其他页面。</li><li id="19a9" class="ol om ir ma b mb ou me ov mh ow ml ox mp oy mt oq or os ot bi translated">最后，这个最后的对象在一秒钟后的承诺中被解决。</li></ol></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="6e78" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">用老式的承诺来获得结果</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="9179" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">我们在这里可以注意到:</p><ol class=""><li id="15b0" class="ol om ir ma b mb mu me mv mh on ml oo mp op mt oq or os ot bi translated">我们以递归的方式调用API，但是只在项目的末尾进行解析。</li><li id="9422" class="ol om ir ma b mb ou me ov mh ow ml ox mp oy mt oq or os ot bi translated">我们使用<code class="fe oz pa pb pc b">page.totalPagesCount</code>来决定是否可以有另一页。</li></ol></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="1c05" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">测试调用老式代码</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="a2d3" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">结果将如下所示:</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj pd"><img src="../Images/c33b00d52c176ddfbf6f638d6957cf70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C8GdJgBjrO2fGNGg4RdYA.png"/></div></div></figure></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="329f" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">使用异步/等待获取结果</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="688b" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">我们可以注意到，这里我们做的和老式代码一样，但是这里更简单。</p></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h2 id="e1fb" class="nx lh ir bd li ny nz dn lm oa ob dp lq mh oc od ls ml oe of lu mp og oh lw ix bi translated">测试调用异步/等待代码</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="oj ok l"/></div></figure><p id="3959" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">结果将如下所示:</p><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj pd"><img src="../Images/c33b00d52c176ddfbf6f638d6957cf70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2C8GdJgBjrO2fGNGg4RdYA.png"/></div></div></figure></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h1 id="f536" class="lg lh ir bd li lj pe ll lm ln pf lp lq kg pg kh ls kj ph kk lu km pi kn lw lx bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="4289" class="pw-post-body-paragraph ly lz ir ma b mb mc kb md me mf ke mg mh mi mj mk ml mm mn mo mp mq mr ms mt ik bi translated">如果你还不是<strong class="ma jb">中</strong>的会员，你可以使用<a class="ae lf" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="ma jb">我的推荐链接</strong> </a>，这样我可以从<strong class="ma jb">中</strong>得到你的一部分费用，你不需要额外付费。订阅<a class="ae lf" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"> <strong class="ma jb">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他有趣的东西直接发送到您的收件箱。</p></div><div class="ab cl mz na hv nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ik il im in io"><h1 id="3c95" class="lg lh ir bd li lj pe ll lm ln pf lp lq kg pg kh ls kj ph kk lu km pi kn lw lx bi translated">其他资源</h1><p id="0061" class="pw-post-body-paragraph ly lz ir ma b mb mc kb md me mf ke mg mh mi mj mk ml mm mn mo mp mq mr ms mt ik bi translated">这些是你可能会发现有用的其他资源。</p><div class="pj pk gq gs pl ng"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-set-javascript-promise-timeout-7d51c87bc38e"><div class="nh ab fp"><div class="ni ab nj cl cj nk"><h2 class="bd jb gz z fq nl fs ft nm fv fx ja bi translated">如何设置JavaScript承诺超时</h2><div class="nn l"><h3 class="bd b gz z fq nl fs ft nm fv fx dk translated">只是不要永远等待承诺的实现，你需要设定自己的条件。</h3></div><div class="no l"><p class="bd b dl z fq nl fs ft nm fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="np l"><div class="pm l nr ns nt np nu kz ng"/></div></div></a></div><div class="pj pk gq gs pl ng"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-observables-with-vanilla-javascript-aca40a7590ff"><div class="nh ab fp"><div class="ni ab nj cl cj nk"><h2 class="bd jb gz z fq nl fs ft nm fv fx ja bi translated">如何在普通JavaScript中使用Observables</h2><div class="nn l"><h3 class="bd b gz z fq nl fs ft nm fv fx dk translated">没有使用框架，只是纯香草JavaScript。</h3></div><div class="no l"><p class="bd b dl z fq nl fs ft nm fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="np l"><div class="pn l nr ns nt np nu kz ng"/></div></div></a></div><p id="24ec" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated">就这样，希望你觉得读这个故事和我写它一样有趣。</p><p id="4bfc" class="pw-post-body-paragraph ly lz ir ma b mb mu kb md me mv ke mg mh mw mj mk ml mx mn mo mp my mr ms mt ik bi translated"><em class="oi">更多内容看</em> <a class="ae lf" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ma jb"> <em class="oi">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>