<html>
<head>
<title>How to Dynamically Integrate Angular in React and Share Data Between Both</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何动态集成Angular in React并在两者之间共享数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-dynamically-integrate-angular-in-react-and-share-data-between-both-c507e90b1f09?source=collection_archive---------2-----------------------#2021-05-03">https://javascript.plainenglish.io/how-to-dynamically-integrate-angular-in-react-and-share-data-between-both-c507e90b1f09?source=collection_archive---------2-----------------------#2021-05-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/652ebdbf297adfd27fcc00a209470338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*ZFeEs8HFMHCOg2ZmN552hg.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Original photo by <a class="ae jv" href="https://unsplash.com/@hrustall?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Дмитрий Хрусталев-Григорьев</a> on <a class="ae jv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3919" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">用例:</strong>最近我不得不想办法在一个React app内部集成一个角度模块。两者需要共享数据，React应用程序将数据向下传递到Angular模块以触发一个动作，然后一些数据向上传递回React应用程序。集成的模块必须动态呈现，这意味着如果模块代码被更新，那么整个React应用不需要重启。理想情况下，两者应该在不同的URL上独立运行，而不需要在同一个repo甚至服务器上协同工作。</p><p id="0167" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">解决方案:</strong> Web组件！经过大量的研究和反复试验，Web组件化险为夷。有相当多的文章解释了如何将Web组件与Angular和React一起使用，但是共享数据和动态呈现的好例子很少。所以我决定写这篇文章，介绍从头开始创建动态多应用程序所需的所有步骤。完整的代码可以在<a class="ae jv" href="https://github.com/MachineLlama/multi-app" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="4452" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">注意:</strong>我还尝试了使用Webpack 5模块联合，这可能是一个潜在的解决方案，但是需要很多复杂的开销。这里的最终解决方案不需要Webpack 5，我们创建的Angular Web组件可以以简单、与框架无关的方式动态加载到任何JavaScript应用程序中。</p><h1 id="b6ab" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用Web组件的Angular应用程序设置</h1><p id="1132" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">首先，我们将开始创建一个名为“angular-app”的新Angular应用程序，它将把一个简单的模块转换成一个Web组件，并使用<code class="fe lx ly lz ma b">@angular/elements</code>构建一些静态脚本(您需要安装<code class="fe lx ly lz ma b"><a class="ae jv" href="https://angular.io/guide/setup-local" rel="noopener ugc nofollow" target="_blank">ng</a></code><a class="ae jv" href="https://angular.io/guide/setup-local" rel="noopener ugc nofollow" target="_blank"/>并准备好使用)</p><ol class=""><li id="9d1f" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">创建一个新的角度项目:<code class="fe lx ly lz ma b">ng new angular-app</code></li><li id="2cc8" class="mb mc in jy b jz mk kd ml kh mm kl mn kp mo kt mg mh mi mj bi translated">安装依赖项:<code class="fe lx ly lz ma b">ng add @angular/elements</code></li><li id="a440" class="mb mc in jy b jz mk kd ml kh mm kl mn kp mo kt mg mh mi mj bi translated">修改<em class="mp">angular-app/src/app/app . component . html</em>，将所有内容替换为简单文本:</li></ol><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7e47" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">4.修改<em class="mp">angular-app/src/app/app . module . ts</em>在其构造函数中创建Angular模块的Web组件；全部替换为:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="fe91" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">5.在<em class="mp"> angular-app </em>中，运行<code class="fe lx ly lz ma b">ng build</code>来构建静态Web组件文件，我们稍后将在我们的主机React应用程序中使用这些文件</p><h1 id="346f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">React应用程序设置</h1><p id="87af" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">接下来，我们将创建一个简单、最小的React应用程序，名为“react-app”(您需要安装<a class="ae jv" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank"> npm </a>和<a class="ae jv" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点</a>并准备好使用)</p><ol class=""><li id="db06" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">使用<a class="ae jv" href="https://github.com/MachineLlama/react-setup" rel="noopener ugc nofollow" target="_blank">https://github.com/MachineLlama/react-setup</a>创建一个新的React应用。运行方式:<code class="fe lx ly lz ma b">node start react-app</code></li></ol><ul class=""><li id="7924" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mw mh mi mj bi translated">或者，您可以使用<a class="ae jv" href="https://create-react-app.dev/docs/getting-started/" rel="noopener ugc nofollow" target="_blank"> React Create App </a></li></ul><h1 id="2823" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">在React中构建、复制和运行角度模块</h1><p id="6058" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">现在，我们可以将Angular应用程序中构建的所需脚本复制到React应用程序中，并将其导入到组件中</p><ol class=""><li id="f52b" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">新建一个文件夹:<em class="mp">react-app/src/angular-files</em></li><li id="c77e" class="mb mc in jy b jz mk kd ml kh mm kl mn kp mo kt mg mh mi mj bi translated">将这些文件从<em class="mp">angular-app/dist/angular-app</em>复制到<em class="mp">react-app/src/angular-files</em>:<em class="mp">main . js</em>、<em class="mp"> polyfills.js </em>、<em class="mp"> runtime.js </em>、<em class="mp"> styles.css </em>、<em class="mp"> styles.js </em>(如果存在)和<em class="mp"> vendor.js </em></li><li id="1838" class="mb mc in jy b jz mk kd ml kh mm kl mn kp mo kt mg mh mi mj bi translated">修改<em class="mp"> react-app/src/App.js </em>以导入Angular Web组件静态文件并呈现新的定制元素</li></ol><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="cbff" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">4.在<em class="mp"> react-app </em>中，运行<code class="fe lx ly lz ma b">npm run start</code></p><ul class=""><li id="8c75" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mw mh mi mj bi translated">你应该会在正在运行的应用程序上看到“骆驼”，它来自Angular Web组件(耶！)</li></ul><h1 id="fd18" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">将数据从React向下传递到Angular Web组件</h1><p id="080c" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">在大多数情况下，我们希望应用程序的React和Angular部分能够相互通信。因此，让我们看看如何使用属性值将数据传递给Angular Web组件</p><ol class=""><li id="60e9" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">向<em class="mp">Angular-app/src/app/app . component . ts</em>中的角度模块添加一个输入变量</li></ol><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3d92" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">2.在<em class="mp">angular-app/src/app/app . component . html</em>中显示<strong class="jy io"> reactValue </strong>。全部替换为:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="08d9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">3.在<em class="mp"> react-app/src/App.js </em>中添加一个输入，我们将把它的值从react应用程序传递到Angular Web组件(重要:注意Web组件中的属性是<code class="fe lx ly lz ma b">react-value</code>以匹配角度变量<code class="fe lx ly lz ma b">reactValue</code>)</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="5398" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">4.在<em class="mp"> angular-app </em>中，运行<code class="fe lx ly lz ma b">ng build</code>并将文件从<em class="mp">angular-app/dist/angular-app</em>复制到<em class="mp">react-app/src/angular-files</em></p><p id="1b03" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">5.在<em class="mp"> react-app </em>中，运行<code class="fe lx ly lz ma b">npm run start</code></p><ul class=""><li id="eb05" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mw mh mi mj bi translated">您应该在React应用程序中看到一个输入，它将更新Angular Web组件(nifty)中的文本</li></ul><h1 id="def5" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">将数据从Angular Web组件向上传递到React应用程序</h1><p id="6590" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">在Angular Web组件中执行一个动作之后，我们可能希望将数据传递回React应用程序，或者在Web组件之外触发另一个动作。为此，我们将利用自定义事件，这是一种观察您想要从Web组件发出的任何数据的简单方法</p><ol class=""><li id="dcb6" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">在<em class="mp">angular-app/src/app/app . component . html</em>中添加一个输入，将所有内容替换为:</li></ol><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="f9c5" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">2.可选:在<em class="mp">angular-app/src/app/app . component/scss中为angular-app-container添加一些样式</em></p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="1210" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">3.向<em class="mp">Angular-app/src/app . app . component . ts</em>添加一个<strong class="jy io"> onKey </strong>函数，每当角度输入改变时，该函数发出一个自定义事件:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e472" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">4.在<em class="mp"> react-app/src/App.js </em>中，添加一个监听器来获取并显示从Web组件发出的角度输入值:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="fefe" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">5.在<em class="mp"> angular-app </em>中，运行<code class="fe lx ly lz ma b">ng build</code>，将<em class="mp">angular-app/dist/angular-app</em>中的文件复制到<em class="mp">react-app/src/angular-files</em></p><p id="5168" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">6.在<em class="mp"> react-app </em>中，运行<code class="fe lx ly lz ma b">npm run start</code></p><ul class=""><li id="df8e" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mw mh mi mj bi translated">现在我们有了一个React应用程序，它呈现了一个包装在Web组件中的Angular模块，数据可以在两者之间双向传输(很好)</li></ul><p id="1b07" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">最终产品:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/dcf71a9db94d48b7095ace9a845cd240.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*NFVSKOYcUXf5pZY8ihb5DQ.png"/></div></figure><h1 id="f83a" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">动态加载脚本(不再需要复制)</h1><p id="8000" class="pw-post-body-paragraph jw jx in jy b jz ls kb kc kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt ig bi translated">这对于大规模生产应用程序至关重要，因为这意味着我们可以对应用程序的小部分(可以在不同的端口或服务器上独立运行)进行更新，而无需更新或重启主应用程序。用户只需刷新浏览器就能看到新内容，应用程序不会停机</p><ol class=""><li id="20ef" class="mb mc in jy b jz ka kd ke kh md kl me kp mf kt mg mh mi mj bi translated">在<em class="mp"> react-app </em>中，运行<code class="fe lx ly lz ma b">npm i web-component-load</code></li><li id="94bf" class="mb mc in jy b jz mk kd ml kh mm kl mn kp mo kt mg mh mi mj bi translated">更新<em class="mp"> react-app/src/App.js </em>移除静态导入；您可以使用给定的URL从<em class="mp"> web-component-load </em>调用load函数，所有的Angular chunk文件将作为脚本(或styles.css文件的链接)附加到正在运行的应用程序的document head部分，如果该特定脚本/链接还不存在的话</li></ol><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="c4d0" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">3.用<code class="fe lx ly lz ma b">ng serve</code>运行<em class="mp">角度app </em>。这将在给定的端口(本例中为4200)上运行应用程序，我们可以从那里访问必要的Web组件脚本(通过<em class="mp"> web组件加载</em>中的加载函数)</p><p id="6d02" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">4.用<code class="fe lx ly lz ma b">npm run start</code>运行<em class="mp"> react-app </em>，一切应该和以前一样工作</p><p id="d7a6" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">5.现在尝试更新<em class="mp">angular-app/src/app/app . component . html</em>并用<code class="fe lx ly lz ma b">ng serve</code>重启<em class="mp"> angular-app </em>。如果您在浏览器中刷新React应用程序，您将看到Angular Web组件的更新，而无需复制静态构建文件，也无需重启React应用程序(太酷了)</p></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><p id="81d4" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这样，我们就可以创建一个Angular Web组件(它可以做普通Angular模块能做的任何事情),并在任何其他应用程序中动态地呈现它。</p><p id="6ee9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">感谢您的阅读。</p><p id="086a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><a class="ae jv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mp">更多内容看plainenglish.io </em> </a></p></div></div>    
</body>
</html>