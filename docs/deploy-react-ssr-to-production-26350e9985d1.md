# å°† React SSR éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/deploy-react-ssr-to-production-26350e9985d1?source=collection_archive---------2----------------------->

## å¦‚ä½•åœ¨è°·æ­Œäº‘å¹³å°ä¸Šéƒ¨ç½² React SSR åº”ç”¨

![](img/1fa920b96b802cda85b992a4d70024f0.png)

è¿™æ˜¯[ä»‹ç» React æœåŠ¡å™¨ç«¯æ¸²æŸ“](https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering)çš„ç»­é›†ï¼Œæ‰€ä»¥å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹çš„è¯ï¼Œå¯ä»¥çœ‹çœ‹ã€‚

è®©æˆ‘ä»¬åœ¨è°·æ­Œäº‘å¹³å°(GCP)ä¸Šéƒ¨ç½²ä¸€ä¸ªåŸºæœ¬çš„ React SSR åº”ç”¨ç¨‹åºã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†éƒ¨ç½²ä¸€ä¸ª *Web åº”ç”¨æœåŠ¡å™¨*ï¼Œå°† webpack åŒ…ä¸Šä¼ åˆ°*äº‘å­˜å‚¨*ï¼Œå¹¶é€šè¿‡ *CDN æä¾›è¿™äº›åŒ…ã€‚*æˆ‘ä½¿ç”¨çš„æ–œä½“æœ¯è¯­æ˜¯ä¹”çº³æ£®Â·å¯Œå°”é¡¿(Jonathan Fulton)åœ¨è¿™ç¯‡å‡ºè‰²çš„æ–‡ç«  [Web Architecture 101](https://engineering.videoblocks.com/web-architecture-101-a3224e126947) ä¸­å®šä¹‰çš„ã€‚

è®©æˆ‘ä»¬åˆ†ä¸¤éƒ¨åˆ†æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚

*ç¬¬ 1 éƒ¨åˆ†:åœ¨æœ¬åœ°æ„å»ºå¹¶å¯åŠ¨åº”ç”¨ç¨‹åºã€‚*

*ç¬¬ 2 éƒ¨åˆ†:éƒ¨ç½²åˆ°äº‘ã€‚*

# ç¬¬ 1 éƒ¨åˆ†:åœ¨æœ¬åœ°æ„å»ºå¹¶å¯åŠ¨åº”ç”¨ç¨‹åº

è¿™æ˜¯å¤§å›¾:

1.  é€šè¿‡ webpack ä¼ è¾“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ†ç»‘åŒ…ã€‚
2.  å¯åŠ¨ä¸€ä¸ªé™æ€æœåŠ¡å™¨æ¥æœåŠ¡å®¢æˆ·ç«¯åŒ…ã€‚
3.  ä½œä¸º Web åº”ç”¨æœåŠ¡å™¨å¯åŠ¨æœåŠ¡å™¨ç«¯åŒ…ã€‚

ä½œä¸ºå‚è€ƒï¼Œè¿™é‡Œæ˜¯æœ¬èŠ‚ä½¿ç”¨çš„ä»£ç çš„ [Github repo](https://github.com/suhanw/blog-react-ssr/tree/local-build) ã€‚

## ååº”ç»„åˆ†

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ React ç»„ä»¶`App`ï¼Œå®ƒç”¨ä¸€äº›åŸºæœ¬æ ·å¼å‘ˆç°æˆ‘ä»¬æœ€å–œæ¬¢çš„é—®å€™è¯­ï¼Œä»¥åŠä¸€ä¸ªå•å‡»æ—¶æ˜¾ç¤ºè­¦å‘Šå¯¹è¯æ¡†çš„æŒ‰é’®ã€‚æˆ‘ä»¬å°†åœ¨æœåŠ¡å™¨ç«¯å‘ˆç°è¿™ä¸ªç»„ä»¶ï¼Œå¹¶åœ¨å®¢æˆ·ç«¯åˆæˆå®ƒã€‚

## webpack é…ç½®

æˆ‘ä»¬ä¸æ˜¯ä½¿ç”¨`webpack-dev-server`åœ¨å†…å­˜ä¸­æ„å»ºå®¢æˆ·ç«¯åŒ…(å°±åƒ[Intro to React Server Side Rendering](https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering)ä¸­ä¸€æ ·)ï¼Œè€Œæ˜¯å°†åŒ…è¾“å‡ºå†™å…¥æ–‡ä»¶ï¼Œå¹¶å¯åŠ¨ä¸€ä¸ªæœ¬åœ°é™æ€æœåŠ¡å™¨æ¥æœåŠ¡è¿™äº›æ–‡ä»¶ã€‚è¯·æ³¨æ„ä¸‹é¢çš„æ³¨é‡Šè¡Œã€‚

ä¸Šé¢ä»£ç æ³¨é‡Šçš„æ³¨é‡Š:

**ã€Aã€‘**ä¿å­˜å®¢æˆ·ç«¯æ†ç»‘è¾“å‡ºåˆ°`./build/client`

**ã€Bã€‘**å°† JavaScript ä»£ç å†™å…¥`./scripts/bundle.js`

**ã€Cã€‘**å°† CSS ä»£ç å†™å…¥`./styles/bundle.css`

å…¶ä»–è®¾ç½®ä¸æˆ‘ä»¬åœ¨è¿™é‡Œè¦å®Œæˆçš„ä»»åŠ¡æ²¡æœ‰å¤ªå¤§å…³ç³»ï¼Œä½†æ˜¯æ›´å¤šç»†èŠ‚å¯ä»¥åœ¨[React æœåŠ¡å™¨ç«¯æ¸²æŸ“ç®€ä»‹](https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering)ä¸­æ‰¾åˆ°ã€‚

## HTML å“åº”

è™½ç„¶ HTML æ ‡è®°å°†åœ¨æœåŠ¡å™¨ç«¯å‘ˆç°ï¼Œä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿æ†ç»‘çš„ JS å’Œ CSS æ–‡ä»¶è¢«ä¸‹è½½åˆ°å®¢æˆ·ç«¯ï¼Œä»¥â€œæ°´åˆâ€æ ‡è®°ã€‚

ä¸Šé¢ä»£ç æ³¨é‡Šçš„æ³¨é‡Š:

**ã€Aã€‘**è¿™å°† React ç»„ä»¶`App`è½¬æ¢æˆä¸€ä¸ª HTML å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬å°†å®ƒæ’å…¥åˆ° ID ä¸º**â€œSSR-appâ€**çš„`div`ä¸­ã€‚å³ SSR æ ‡è®°ã€‚

è¿™å°†åŠ è½½ CSS ä»£ç æ¥æ ·å¼åŒ–æˆ‘ä»¬çš„ SSR æ ‡è®°ä¸­çš„ DOM å…ƒç´ ã€‚

**ã€Cã€‘**è¿™ä¼šåŠ è½½ JS ä»£ç æ¥â€œæ°´åˆâ€å…·æœ‰äº¤äº’æ€§çš„æ ‡è®°ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå®ƒå°† click å¤„ç†ç¨‹åºé™„åŠ åˆ°æŒ‰é’®ä¸Šã€‚

**ã€Dã€‘**è¿™æ˜¯æœåŠ¡äºå®¢æˆ·ç«¯æ†ç»‘åŒ…çš„æœ¬åœ°é™æ€æœåŠ¡å™¨ã€‚

é…·æ¯™äº†ã€‚

## æ„å»ºå’Œå¯åŠ¨è„šæœ¬

è®©æˆ‘ä»¬å®šä¹‰å‡ ä¸ª`npm`è„šæœ¬æ¥æœ¬åœ°æ„å»ºå’Œå¯åŠ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚è¯·å°†è¿™äº›è§†ä¸ºå¯åŠ¨å’Œè¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçš„æ­¥éª¤ã€‚

*   `build:client` â€”è¿™å‘Šè¯‰ webpack æ„å»ºå®¢æˆ·ç«¯ä»£ç å¹¶å°†åŒ…è¾“å‡ºä¿å­˜åœ¨`./build/client`ä¸­ã€‚
*   `build:server` â€”è¿™å‘Šè¯‰ webpack æ„å»ºæœåŠ¡å™¨ç«¯ä»£ç å¹¶å°†åŒ…è¾“å‡ºä¿å­˜åˆ°`./build/server/bundle.js`ã€‚
*   `prebuild` â€”ä½¿ç”¨ [rimraf](https://github.com/isaacs/rimraf) åˆ é™¤`./build`æ–‡ä»¶å¤¹ã€‚
*   `build` â€”å¹¶è¡Œè¿è¡Œ`build:client`å’Œ`build:server`ã€‚
*   `start:client` â€”è¿™å°†`./build/client`ä½œä¸º`[http://localhost:5000](http://localhost:5000.)`ä¸Šçš„é™æ€æ–‡ä»¶ï¼Œä½¿ç”¨æ°å½“å‘½åçš„åº“[æœåŠ¡](https://github.com/vercel/serve)ã€‚æ³¨æ„ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢çš„ HTML å“åº”ä¸­æ’å…¥çš„`cdnHost`ã€‚
*   `start:server` â€”è¿™å°†åœ¨`http://localhost:3000`å¯åŠ¨å¿«é€ŸæœåŠ¡å™¨ã€‚
*   `start:local` â€”å¹¶è¡Œè¿è¡Œ`start:client`å’Œ`start:server`ã€‚

## æŠŠæ‰€æœ‰çš„æ”¾åœ¨ä¸€èµ·

åœ¨ç»ˆç«¯ä¸­ï¼Œè®©æˆ‘ä»¬æŒ‰ä»¥ä¸‹é¡ºåºè¿è¡Œ npm è„šæœ¬:

1.  `npm run build`
2.  `npm run start:local`

æˆ‘ä»¬çš„ SSR åº”ç”¨ç¨‹åºç°å·²åœ¨`http://localhost:3000`ä¸Šçº¿è¿è¡Œï¼ğŸ‰

![](img/e1a31c2824d0432c3129b97060a7583d.png)

ç‚¹å‡»æŒ‰é’®åº”è¯¥ä¼šè§¦å‘è­¦å‘Šå¯¹è¯æ¡†ï¼ğŸ™Œ

![](img/1a79c5cbd29d07881a9b3c46ef78bf26.png)

# ç¬¬ 2 éƒ¨åˆ†:éƒ¨ç½²åˆ°äº‘

æˆ‘ä»¬ç°åœ¨å°†åœ¨äº‘ä¸­å¤åˆ¶æˆ‘ä»¬åˆšåˆšåœ¨æœ¬åœ°åšçš„äº‹æƒ…ï¼Œ**ï¼**

![](img/0920d2a913c469abe4113a0a42da5a2a.png)

Source: [Reddit](https://www.reddit.com/r/ProgrammerHumor/comments/6cer5t/what_are_clouds_made_of/)

å†è¯´ä¸€éï¼Œè¿™æ˜¯å¤§å›¾:

1.  ä½¿ç”¨ GCP äº‘æ„å»ºæ¥æ‰§è¡Œä»¥ä¸‹æ„å»ºæ­¥éª¤ã€‚
2.  é€šè¿‡ webpack ä¼ è¾“å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ†ç»‘åŒ…ã€‚
3.  å°†å®¢æˆ·ç«¯æ†ç»‘åŒ…ä¸Šä¼ åˆ° GCP äº‘å­˜å‚¨ï¼Œè¿™äº›æ†ç»‘åŒ…å°†ä½œä¸º CDN ä¸Šçš„é™æ€æ–‡ä»¶ã€‚
4.  å°†æœåŠ¡å™¨ç«¯æ†ç»‘åŒ…ä½œä¸º Web åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²åˆ° GCP åº”ç”¨å¼•æ“ã€‚

ä½œä¸ºå‚è€ƒï¼Œè¿™é‡Œæ˜¯æœ¬èŠ‚ä½¿ç”¨çš„ä»£ç çš„ [Github repo](https://github.com/suhanw/blog-react-ssr/tree/deploy) ã€‚

å¯¹äºæœ¬èŠ‚ï¼Œæˆ‘å‡è®¾æ‚¨å¯¹ GCP æœ‰ä¸€å®šç¨‹åº¦çš„äº†è§£ï¼ŒåŒ…æ‹¬æ‚¨å·²ç»æ³¨å†Œäº†ä¸€ä¸ªå¸æˆ·ã€‚

**è¯·æ³¨æ„ï¼Œå½“æ‚¨ä½¿ç”¨ GCP äº§å“/æœåŠ¡æ—¶ï¼Œå¯èƒ½ä¼šæ”¶å–è´¦å•è´¹ç”¨ï¼**

æ·±å‘¼å¸ï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼

## åˆ›å»ºæ–°çš„ GCP é¡¹ç›®

è½¬åˆ° [IAM & Admin >ç®¡ç†èµ„æº](https://console.cloud.google.com/cloud-resource-manager)å¹¶åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªé¡¹ç›®å‘½åä¸º`react-ssr`ã€‚

![](img/72cf8daff455ddbec0dbabeed5ed1db0.png)

ç¡®ä¿æ–°åˆ›å»ºçš„é¡¹ç›®`react-ssr`è¢«é€‰ä¸­ã€‚

![](img/544b1d5014b087fa6d18ef2fd57771b1.png)

## äº‘å­˜å‚¨

åˆ›å»ºä¸€ä¸ªå­˜å‚¨æ¡¶æ¥ä¸Šä¼ å®¢æˆ·ç«¯åŒ…ã€‚è¿™äº›å°†ä½œä¸ºé™æ€æ–‡ä»¶é€šè¿‡ä¸€ä¸ªç”± GCP æ”¯æŒçš„çœŸå® CDN æä¾›ã€‚

è¿›å…¥[äº‘å­˜å‚¨>æµè§ˆå™¨](https://console.cloud.google.com/storage/browser)æ–°å»ºä¸€ä¸ªæ¡¶ã€‚ä¸ºäº†ä¸€è‡´ï¼Œè¿˜æ˜¯å–å`react-ssr`å§ã€‚å…¶ä½™é€‰é¡¹ä½¿ç”¨é»˜è®¤è®¾ç½®ã€‚

![](img/45721a949fba0c87cd3d272ad902137f.png)

ä¸€æ—¦åˆ›å»ºäº† bucketï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚

![](img/f95513ffcbc86250cfb8556d3d343a9b.png)

é’»å…¥`react-ssr`æ¡¶ï¼Œç‚¹å‡»`Configuration`é€‰é¡¹å¡ï¼Œç¼–è¾‘`Permissions > Access Control`ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º`Fine-grained`ã€‚

![](img/667eebb43ce02cc6b429299d73e96eac.png)

ç‚¹å‡»`Permissions`é€‰é¡¹å¡ï¼Œç‚¹å‡»`Permissions > ADD`ï¼Œæ·»åŠ è§’è‰²ä¸º`Storage Legacy Object Reader`çš„ç”¨æˆ·`allUsers`ï¼Œä½¿è¯¥å­˜å‚¨æ¡¶ä¸­çš„æ–‡ä»¶å…¬å¼€å¯è¯»ã€‚

![](img/4737a1844d539d0be01db9cd7e24e3a7.png)

## åº”ç”¨å¼•æ“

è¿™é¡¹æœåŠ¡å°†ç®¡ç†é›†è£…ç®±åŒ–å’Œæ‰©å±•ã€‚ä¸ºäº†è¯´æ˜çš„ç›®çš„ï¼Œè¿™ä»…ä»…æ„å‘³ç€æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°†é€šè¿‡ URL åœ¨äº’è”ç½‘ä¸Šå¯ç”¨ã€‚

è½¬åˆ°[åº”ç”¨å¼•æ“>ä»ªè¡¨æ¿](https://console.cloud.google.com/appengine)å¹¶åˆ›å»ºä¸€ä¸ªæ–°åº”ç”¨ã€‚ç›¸åº”åœ°é€‰æ‹©ä½ çš„åœ°åŒºã€‚

![](img/814baa9fdc1ee61aacea5a771a1f30d6.png)

æˆåŠŸåˆ›å»ºåº”ç”¨ç¨‹åºåï¼Œæ‚¨åº”è¯¥ä¼šåœ¨ä»ªè¡¨æ¿ä¸Šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚

![](img/e81bc9746ee64e8c7822263174cde2e5.png)

æ¥ä¸‹æ¥ï¼Œå¯ç”¨[åº”ç”¨å¼•æ“ç®¡ç† API](https://console.cloud.google.com/marketplace/product/google/appengine.googleapis.com) ã€‚

![](img/ae0fb9cc7edb2865ba3b3dfc4f42e0c3.png)

ä¸€æ—¦å¯ç”¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚

![](img/1520db79ecbfbaa8c79030b97422033d.png)

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä»£ç åº“ä¸­çš„`app.yaml`æ–‡ä»¶å®šä¹‰[è¿è¡Œæ—¶è®¾ç½®](https://cloud.google.com/appengine/docs/standard/nodejs/configuring-your-app-with-app-yaml)ï¼Œä»¥ä¾¿æˆ‘ä»¬çš„ Node.js åº”ç”¨ç¨‹åºæ‰˜ç®¡åœ¨ App Engine ä¸Šã€‚

ä¸Šé¢ä»£ç æ³¨é‡Šçš„æ³¨é‡Š:

**ã€Aã€‘**è¿™å‘Šè¯‰ App Engine ä½ è¦ä¸ºä½ çš„ App ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ã€‚

**ã€Bã€‘**è¿™å°†è¿è¡Œæ—¶ç¯å¢ƒå˜é‡`NODE_ENV`è®¾ç½®ä¸ºå€¼â€œproductionâ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`process.env.NODE_ENV`åœ¨ä»£ç ä¸­è®¿é—®å®ƒã€‚

æœ€åï¼ŒApp Engine é€šè¿‡è¿è¡Œ`npm start`æ¥å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°†é‚£ä¸ª`npm`è„šæœ¬æ·»åŠ åˆ°æˆ‘ä»¬çš„`package.json`ä¸­ã€‚

## äº‘æ„å»º

æˆ‘ä»¬å°†åœ¨æ¯æ¬¡æäº¤æºä»£ç æ—¶ä½¿ç”¨äº‘æ„å»ºæ¥è‡ªåŠ¨åŒ–åº”ç”¨éƒ¨ç½²ã€‚

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å¯ç”¨[äº‘æ„å»º API](https://console.cloud.google.com/marketplace/product/google/cloudbuild.googleapis.com) ã€‚

![](img/5a4975d9a63d9996634afb9f0732b57e.png)

ä¸€æ—¦å¯ç”¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚

![](img/e5ab0ba7382b28909480bfee35acfd70.png)

æ¥ä¸‹æ¥ï¼Œè¿›å…¥[äº‘æ„å»º>è®¾ç½®](https://console.cloud.google.com/cloud-build/settings/)ï¼Œå°† **App Engine Admin** è§’è‰²å’Œ **Service Account User** è§’è‰²çš„çŠ¶æ€è®¾ç½®ä¸º **Enabled** ã€‚

![](img/dbe52d9feb6c4a80f94330baa28e42b4.png)

å‡ºäºè¿™ä¸ªç¤ºä¾‹çš„ç›®çš„ï¼Œåªéœ€å°†[äº‘æ„å»ºæœåŠ¡å¸æˆ·](https://cloud.google.com/build/docs/securing-builds/configure-access-for-cloud-build-service-account)æƒ³è±¡æˆè‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬çš„æ„å»ºæ­¥éª¤ã€å°†æ–‡ä»¶ä¸Šä¼ åˆ°äº‘å­˜å‚¨å¹¶éƒ¨ç½²åˆ° App Engine çš„æœºå™¨äººã€‚

æœ€åï¼Œæˆ‘ä»¬åœ¨ä»£ç åº“ä¸­çš„`cloudbuild.yaml`æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—æ„å»ºæ­¥éª¤ï¼Œä»¥å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°äº‘ä¸­ã€‚äº‘æ„å»ºå°†è¿ç»­æ‰§è¡Œè¿™äº›æ­¥éª¤ã€‚

ä¸Šé¢ä»£ç æ³¨é‡Šçš„æ³¨é‡Š:

**ã€Aã€‘**è¿™ä¼šè¿è¡Œ`npm install`åœ¨äº‘ä¸­å®‰è£…æˆ‘ä»¬æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå°±åƒæˆ‘ä»¬åœ¨æœ¬åœ°å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®ä¸€æ ·ã€‚

**ã€Bã€‘**è¿™è¿è¡Œ`npm run build`é€šè¿‡ webpack ä¼ è¾“æˆ‘ä»¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯åŒ…ï¼Œå¹¶å°†è¾“å‡ºä¿å­˜åˆ°`./build`ï¼Œå°†æ„å»ºæ—¶ç¯å¢ƒå˜é‡`NODE_ENV`è®¾ç½®ä¸ºâ€œç”Ÿäº§â€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡`process.env.NODE_ENV`åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­è®¿é—®å®ƒã€‚

**ã€Cã€‘**è¿™å°†`./build`ç›®å½•ä¸­çš„æ–‡ä»¶ä¸Šä¼ åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„äº‘å­˜å‚¨æ¡¶`react-ssr/build`ä¸­ã€‚

**ã€Dã€‘**è¿™ä¼šå°†äº‘æ„å»º[è¶…æ—¶è®¾ç½®ä¸º 1600 ç§’](https://cloud.google.com/build/docs/deploying-builds/deploy-appengine#configuring_the_deployment)ï¼Œå¹¶å°†åº”ç”¨éƒ¨ç½²åˆ°åº”ç”¨å¼•æ“ã€‚

æœ€åï¼Œè®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªæ„å»ºè§¦å‘å™¨ï¼Œåœ¨æ¯æ¬¡å‘æº repo æ¨é€ä¸€ä¸ªæ–°çš„ git commit æ—¶å¼€å§‹è‡ªåŠ¨åŒ–æ„å»ºã€‚è½¬åˆ°[äº‘æ„å»º>è§¦å‘å™¨](https://console.cloud.google.com/cloud-build/triggers)ï¼Œåˆ›å»ºä¸€ä¸ªè§¦å‘å™¨ã€‚æˆ‘ä»¬å°†å…¶å‘½åä¸º`deploy-react-ssr`ï¼Œå¹¶é€‰æ‹©`Push to a branch`ä½œä¸º repo äº‹ä»¶æ¥å¯åŠ¨è‡ªåŠ¨åŒ–æ„å»ºã€‚

![](img/25eb24d0bfa87b3a52db9a9431211119.png)

é€‰æ‹©åŒ…å«æ„å»ºé…ç½®æ–‡ä»¶`cloudbuild.yaml`çš„æºä»£ç æŠ¥å‘Šã€‚ä¸ºå°†å¯åŠ¨è§¦å‘å™¨çš„åˆ†æ”¯æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼ã€‚åœ¨æˆ‘çš„ä¾‹å­ä¸­ï¼Œæˆ‘æƒ³åœ¨æ¯æ¬¡æäº¤åˆ°`deploy`åˆ†æ”¯æ—¶è§¦å‘è‡ªåŠ¨æ„å»ºã€‚

![](img/42e9de6d21f2f115557d4c00641a7815.png)

ä¸€æ—¦è§¦å‘å™¨æˆåŠŸåˆ›å»ºï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹ã€‚

![](img/6df019029fdb660e9edfe525aa311913.png)

## HTML å“åº”

ä¸ä¸Šé¢çš„ç¬¬ 1 éƒ¨åˆ†ç±»ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ†ç»‘çš„ JS å’Œ CSS æ–‡ä»¶è¢«ä¸‹è½½åˆ°å®¢æˆ·ç«¯ï¼Œä»¥â€œæ°´åˆâ€SSR-ed æ ‡è®°ã€‚ä¸‹é¢çš„æ³¨é‡Šè¡Œä¸ç¬¬ 1 éƒ¨åˆ†ä¸­çš„ç•¥æœ‰ä¸åŒã€‚

ä¸Šé¢ä»£ç æ³¨é‡Šçš„æ³¨é‡Š:

**ã€Aã€‘**åœ¨ç”Ÿäº§ä¸­ï¼ŒApp Engine ä¼šå°†`process.env.PORT`ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºé€šè¿‡äº’è”ç½‘æ¥æ”¶ HTTP è¯·æ±‚çš„ç«¯å£ã€‚

**ã€Bã€‘**åœ¨ç”Ÿäº§ä¸­ï¼Œè¿™æ˜¯ä¸ºä¸Šä¼ åˆ°äº‘å­˜å‚¨çš„å®¢æˆ·ç«¯æ†ç»‘åŒ…æä¾›æœåŠ¡çš„é™æ€æœåŠ¡å™¨ã€‚æ³¨æ„:å®é™…å¯ç”¨äº‘ CDN æœåŠ¡è¿˜æœ‰ä¸€äº›é¢å¤–çš„æ­¥éª¤ï¼Œä½†ä¸æ­¤å›¾æ²¡æœ‰å¤ªå¤§å…³ç³»ã€‚

## æŠŠæ‰€æœ‰çš„æ”¾åœ¨ä¸€èµ·

ä½ è¿˜åœ¨è¿™é‡Œï¼Ÿå‰å®³ï¼

ä»¥ä¸‹æ˜¯å°†ä¸Šè¿°æ‰€æœ‰å†…å®¹æ•´åˆåœ¨ä¸€èµ·çš„å·¥ä½œæµç¨‹:

1.å°†æäº¤æ¨é€åˆ°æºä»£ç ä»“åº“ä¸­çš„`deploy`åˆ†æ”¯ã€‚

2.æäº¤ä¼šè§¦å‘äº‘æ„å»ºæ¥å¯åŠ¨è‡ªåŠ¨åŒ–æ„å»ºã€‚è½¬åˆ°[äº‘æ„å»º>å†å²](https://console.cloud.google.com/cloud-build/builds)äº†è§£æ„å»ºå’Œç›¸å…³æäº¤çš„å†å²ã€‚

![](img/d04bd1984b9cc81aa9859343c8922306.png)

3.åœ¨ç»™å®šçš„æ„å»ºä¸­ï¼Œæ‰§è¡Œ`cloudbuild.yaml`ä¸­å®šä¹‰çš„æ­¥éª¤ã€‚

![](img/bd43981184abc83378147c19691838f1.png)

4.å®¢æˆ·ç«¯æ†ç»‘åŒ…è¢«ä¸Šä¼ åˆ°äº‘å­˜å‚¨ã€‚

![](img/be22435b9a71d9a8a0dcaa55a6e882c6.png)

5.Web åº”ç”¨æœåŠ¡å™¨éƒ¨ç½²åˆ° App Engineã€‚

![](img/3acc58a22ee90201c097915ffb769e7e.png)

6.SSR åº”ç”¨ç¨‹åºç°åœ¨å·²ç»åœ¨äº‘ä¸­è¿è¡Œäº†ï¼ğŸ˜

![](img/eb579ce60c7418de5ad5d416b0dc9dd9.png)

# èµ„æº

*   [äº‘æ„å»º:æ„å»º Node.js åº”ç”¨](https://cloud.google.com/build/docs/building/build-nodejs?hl=en)
*   [äº‘æ„å»º:ä½¿ç”¨äº‘æ„å»ºçš„è‡ªåŠ¨åŒ–é™æ€ç½‘ç«™å‘å¸ƒ](https://cloud.google.com/community/tutorials/automated-publishing-cloud-build)
*   [åº”ç”¨å¼•æ“:åœ¨åº”ç”¨å¼•æ“ä¸Šæ„å»º Node.js åº”ç”¨](https://cloud.google.com/appengine/docs/standard/nodejs/building-app)
*   [App å¼•æ“:ä½¿ç”¨äº‘å­˜å‚¨](https://cloud.google.com/appengine/docs/standard/nodejs/using-cloud-storage)
*   [äº‘å­˜å‚¨:è®¿é—®å…¬å…±æ•°æ®](https://cloud.google.com/storage/docs/access-public-data#api-link)

# é˜…è¯»æ›´å¤š

[](/intro-to-react-server-side-rendering-3c2af3782d08) [## React æœåŠ¡å™¨ç«¯æ¸²æŸ“ç®€ä»‹

### å¦‚ä½•åœ¨æ²¡æœ‰ä»»ä½•å·¥å…·æˆ–æ¡†æ¶çš„æƒ…å†µä¸‹æ„å»ºä¸€ä¸ª React SSR appï¼Ÿ

javascript.plainenglish.io](/intro-to-react-server-side-rendering-3c2af3782d08) [](/decouple-data-from-ui-with-react-hooks-6f7fe968c3e3) [## ç”¨ React é’©å­å°†æ•°æ®ä» UI è§£è€¦

### ä»¥åŠæˆ‘å¦‚ä½•ç”¨ JavaScript å‡½æ•°â€œç¼–ç¨‹åˆ°ä¸€ä¸ªæ¥å£â€

javascript.plainenglish.io](/decouple-data-from-ui-with-react-hooks-6f7fe968c3e3) [](/how-to-decouple-data-from-ui-in-react-d6b1516f4f0b) [## å¦‚ä½•åœ¨ React ç¬¬ 2 éƒ¨åˆ†ä¸­å°†æ•°æ®ä¸ UI è§£è€¦

### å¯¹é’©å­ã€æ¸²æŸ“é“å…·å’Œç‰¹è®¾æ¨¡å¼çš„è¿›ä¸€æ­¥æ¢ç´¢

javascript.plainenglish.io](/how-to-decouple-data-from-ui-in-react-d6b1516f4f0b) 

ğŸ“«*æˆ‘ä»¬æ¥è¿çº¿ä¸Š*[*LinkedIn*](https://www.linkedin.com/in/suhanwijaya/)*æˆ–è€…*[*Twitter*](https://twitter.com/suhanw)*ï¼*

*æ›´å¤šå†…å®¹è¯·çœ‹*[*plain English . io*](http://plainenglish.io/)