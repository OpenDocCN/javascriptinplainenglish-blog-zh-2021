<html>
<head>
<title>Migrating Class Base Components to Functional Components Using React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React挂钩将基类组件迁移到功能组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/authentication-using-react-react-hooks-4215529b08f4?source=collection_archive---------12-----------------------#2021-07-05">https://javascript.plainenglish.io/authentication-using-react-react-hooks-4215529b08f4?source=collection_archive---------12-----------------------#2021-07-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/6362b545392d064b2abdf497bac51547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zl8qErIg6eXFyBTH5F7hzg.png"/></div></div></figure><p id="7e0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React是目前可用的最著名的库之一。目前有数百家公司在使用React，数百家公司选择React作为他们下一个产品和服务的下一个平台。</p><p id="a590" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">React提出了两种类型的组件，即无状态组件和有状态组件。无状态组件通常是没有本地状态和不能访问生命周期方法的功能组件。有状态组件具有本地状态，可以访问生命周期方法。</p><p id="af5e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在React 16.8之前，我们编写有状态组件的唯一选择是使用JavaScript基类组件。然而，React 16.8引入了钩子概念，允许我们将功能组件编写为有状态组件。</p><p id="5201" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将在这篇博文中使用的钩子如下所列。</p><ol class=""><li id="cfe8" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated"><strong class="ka ir">使用状态</strong></li><li id="1076" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用效果</li><li id="e119" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用显示器</li><li id="86f7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用选择器</li></ol><p id="f5fe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">useState钩子允许我们在函数组件中有一个本地状态。我们在组件中声明useState的方式如下。</p><pre class="lk ll lm ln gt lo lp lq lr aw ls bi"><span id="adc4" class="lt lu iq lp b gy lv lw l lx ly">const [stateVariable, setStateVariable] = useState('');</span></pre><p id="0654" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">useState使用<a class="ae lz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank">数组析构</a>概念。useState函数返回一个这样的数组<code class="fe ma mb mc lp b">['', function]</code>。这个数组中的第一项是我们传递给useState的参数，它被赋值给<code class="fe ma mb mc lp b">stateVariable</code>。而第二项是一个函数，它被分配给<code class="fe ma mb mc lp b">setStateVariable</code>，我们稍后将在代码中调用它来设置、更新或更改组件的状态。</p><ol class=""><li id="28cd" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">使用状态</li><li id="6fb1" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">使用效果</strong></li><li id="da55" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用显示器</li><li id="9a02" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用选择器</li></ol><p id="ae4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">useEffect是一个生命周期方法，在组件挂载时、状态或属性更改时以及组件卸载时或之前调用。要完全理解什么是useEffect以及它是如何工作的，请点击这个博客<a class="ae lz" href="https://daveceddia.com/useeffect-hook-examples/" rel="noopener ugc nofollow" target="_blank">帖子</a>了解更多细节。</p><ol class=""><li id="80ba" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">使用状态</li><li id="d310" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用效果</li><li id="96b6" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">使用Dispatch </strong></li><li id="5368" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用选择器</li></ol><p id="a4c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它相当于将调度映射到基类组件中的道具。要使用useDispatch钩子，我们将触发useDispatch函数并将其存储在一个变量中。当我们调用这个变量时，我们传递一个动作，这个动作是一个函数，它返回一个带有类型和有效负载属性的对象，作为一个带有数据的参数。Dispatch将获取该对象，并搜索reducer以匹配其类型，并基于该类型执行操作。</p><ol class=""><li id="c292" class="kw kx iq ka b kb kc kf kg kj ky kn kz kr la kv lb lc ld le bi translated">使用状态</li><li id="08e6" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用效果</li><li id="1710" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated">使用显示器</li><li id="dabc" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><strong class="ka ir">使用选择器</strong></li></ol><p id="249c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">useSelector相当于将状态映射到基类组件中的props。它接受一个函数参数并返回所需的状态部分。</p><p id="2bf4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是我们要用的钩子。在这篇博文中，我将把我的一篇<a class="ae lz" href="https://medium.com/free-code-camp/login-using-react-redux-redux-saga-86b26c8180e" rel="noopener">博文</a>从类库组件迁移到功能组件，以便使用react进行用户认证和注册。这篇博文的代码可以在这里找到<a class="ae lz" href="https://github.com/zafar-saleem/react-login-hooks" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="1432" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇博文中，我将只迁移我以前博文中的组件，即页面，其余的redux和redux saga概念，如<code class="fe ma mb mc lp b">store</code>、<code class="fe ma mb mc lp b">actions</code>、<code class="fe ma mb mc lp b">reducers</code>和<code class="fe ma mb mc lp b">sagas</code>将保持原样，不需要更改。请到博客上继续关注，让这个项目成功。</p><p id="e04e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">说到这里，让我们来看看我们的第一个组件/页面<code class="fe ma mb mc lp b">src/components/loginPage.js</code>。下面是这个组件/页面的代码。</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="cd08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个组件中，我从React导入了<code class="fe ma mb mc lp b">useState</code>和<code class="fe ma mb mc lp b">useEffect</code>钩子。我也从<code class="fe ma mb mc lp b">react-redux</code>进口<code class="fe ma mb mc lp b">useDispatch</code>和<code class="fe ma mb mc lp b">useSelector</code>挂钩。然后在<code class="fe ma mb mc lp b">loginPage</code>函数内部，我调用<code class="fe ma mb mc lp b">useDispatch</code>函数并将其赋给<code class="fe ma mb mc lp b">dispatch</code>变量。我们稍后将使用这个变量来调度一个动作。</p><p id="fb27" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我声明两个状态变量，即<code class="fe ma mb mc lp b">notification</code>和<code class="fe ma mb mc lp b">success</code>及其各自的状态方法，即<code class="fe ma mb mc lp b">setNotification</code>和<code class="fe ma mb mc lp b">setSuccess</code>，它们是方法，用于设置其各自变量的值。我们正在分配<code class="fe ma mb mc lp b">useState</code>钩子来为它们设置默认值，即<code class="fe ma mb mc lp b">empty string</code>和<code class="fe ma mb mc lp b">false</code>被分配给各自的变量。</p><p id="31ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们调用<code class="fe ma mb mc lp b">useSelector</code> hook，它返回这个组件所需的部分状态。</p><p id="09b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们调用<code class="fe ma mb mc lp b">useEffect</code>方法，我们传递一个回调函数作为第一个参数，传递一个带有<code class="fe ma mb mc lp b">login</code>的数组，这个数组有这个组件的必要状态信息，我们通过调用上面的<code class="fe ma mb mc lp b">useSelector</code>钩子来获得。这意味着每当login中的属性被更新时，这个<code class="fe ma mb mc lp b">useEffect</code>钩子将被调用。<code class="fe ma mb mc lp b">useEffect</code>中的第二个论点可以被视为依赖关系。</p><p id="7a34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我们基于从<code class="fe ma mb mc lp b">useSelector</code>接收的值设置<code class="fe ma mb mc lp b">notification</code>和<code class="fe ma mb mc lp b">success</code>，如果<code class="fe ma mb mc lp b">success</code>为真，我们用令牌设置cookie。如果<code class="fe ma mb mc lp b">login</code>不是未定义的，所有这些都会发生。</p><p id="4927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来是一个方法<code class="fe ma mb mc lp b">onHandleLogin</code>,它基本上从登录表单获取电子邮件和密码，并以电子邮件和密码作为有效载荷发送一个<code class="fe ma mb mc lp b">loginUserAction(email, password)</code>。</p><p id="36e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我们再次调用<code class="fe ma mb mc lp b">useEffect</code>将<code class="fe ma mb mc lp b">notification</code>和<code class="fe ma mb mc lp b">success</code>重置回其初始值。这种效应称为卸载阶段。</p><p id="2d36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们在JSX有一个登录表单，其中有电子邮件和密码作为输入字段和一个按钮来触发登录过程。</p><p id="33fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下一个组件是<code class="fe ma mb mc lp b">src/components/registerPage.js</code>。下面是这个组件的代码。</p><figure class="lk ll lm ln gt jr"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="2c7a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个组件中，我们正在做与在<code class="fe ma mb mc lp b">loginPage.js</code>中完全相同的事情。我们正在从各自的包中导入<code class="fe ma mb mc lp b">useState, useEffect, useDispatch and useSelector</code>钩子。</p><p id="20ab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在<code class="fe ma mb mc lp b">registerPage</code>中，我们用状态方法声明了两个状态变量<code class="fe ma mb mc lp b">notification</code>和<code class="fe ma mb mc lp b">success</code>，用状态钩子声明了<code class="fe ma mb mc lp b">setNotification</code>和<code class="fe ma mb mc lp b">setSuccess</code>。</p><p id="0e71" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来我们通过分别调用<code class="fe ma mb mc lp b">useDispatch</code>和<code class="fe ma mb mc lp b">useSelector</code>钩子来声明<code class="fe ma mb mc lp b">dispatch</code>和<code class="fe ma mb mc lp b">register</code>变量。</p><p id="1329" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们调用<code class="fe ma mb mc lp b">useEffect</code> hook，每当<code class="fe ma mb mc lp b">register</code>更新时就会被调用。在这里面，我们设置了<code class="fe ma mb mc lp b">success</code>和<code class="fe ma mb mc lp b">notification</code>。</p><p id="ed24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还在处理注册表，在注册表中我们获得所有详细信息，即用户的<code class="fe ma mb mc lp b">email</code>、<code class="fe ma mb mc lp b">password</code>和<code class="fe ma mb mc lp b">name</code>以及派遣<code class="fe ma mb mc lp b">registerUserAction(name, email, password)</code>。</p><p id="4c29" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有第二个<code class="fe ma mb mc lp b">useEffect</code>钩子，我们在其中重新设置<code class="fe ma mb mc lp b">notification</code>。</p><p id="61e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们有JSX格式的登记表。</p><p id="2270" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这就是这篇博文的基本内容。要做到这一点，你需要实现redux和redux saga。请阅读<a class="ae lz" href="https://medium.com/free-code-camp/login-using-react-redux-redux-saga-86b26c8180e" rel="noopener">这篇博客</a>来实现这些概念。顺便说一句，你仍然需要为这个项目运行后端。这个项目的后端解释<a class="ae lz" href="https://medium.com/free-code-camp/writing-scalable-architecture-for-node-js-2b58e0523d7f" rel="noopener">在这里</a>。</p><div class="mf mg gp gr mh mi"><a href="https://github.com/zafar-saleem/react-login-hooks" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab fo"><div class="mk ab ml cl cj mm"><h2 class="bd ir gy z fp mn fr fs mo fu fw ip bi translated">扎法尔-萨利姆/react-登录-挂钩</h2><div class="mp l"><h3 class="bd b gy z fp mn fr fs mo fu fw dk translated">在使用这个项目之前，请确保你的服务器端运行，可以在这里找到克隆这个…</h3></div><div class="mq l"><p class="bd b dl z fp mn fr fs mo fu fw dk translated">github.com</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw jw mi"/></div></div></a></div><h2 id="c694" class="lt lu iq bd mx my mz dn na nb nc dp nd kj ne nf ng kn nh ni nj kr nk nl nm nn bi translated">来自<a class="ae lz" href="https://zafarsaleem.medium.com" rel="noopener"> Zafar </a>的更多文章</h2><ol class=""><li id="38de" class="kw kx iq ka b kb no kf np kj nq kn nr kr ns kv lb lc ld le bi translated"><a class="ae lz" href="https://www.webwinx.com/2023/01/28/building-real-world-app-by-combining-aws-dynamodb-nextjs/" rel="noopener ugc nofollow" target="_blank"> AWS DynamoDB &amp; Nextjs建筑现实世界App </a></li><li id="d37c" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><a class="ae lz" href="https://www.webwinx.com/2023/02/03/how-to-hack-algolia-search-to-enhance-react/" rel="noopener ugc nofollow" target="_blank">如何破解Algolia搜索增强React </a></li><li id="f3d7" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><a class="ae lz" href="https://www.webwinx.com/2023/01/30/go-serverless-for-graphql-backend-with-grafbase/" rel="noopener ugc nofollow" target="_blank">使用Grafbase实现GraphQL后端的无服务器化</a></li><li id="c5cc" class="kw kx iq ka b kb lf kf lg kj lh kn li kr lj kv lb lc ld le bi translated"><a class="ae lz" href="https://www.webwinx.com/2023/01/29/event-based-architecture-using-react/" rel="noopener ugc nofollow" target="_blank">使用React的基于事件的架构</a></li></ol><p id="282b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nt">更多内容请看</em> <a class="ae lz" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nt">说白了就是</em> </strong> </a> <em class="nt">。</em></p><p id="be5a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nt">报名参加我们的</em> <a class="ae lz" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nt">免费周报</em> </strong> </a> <em class="nt">。关注我们上</em> <a class="ae lz" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nt">推特</em> </strong> </a>，<a class="ae lz" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nt">领英</em> </strong> </a> <strong class="ka ir"> <em class="nt">，</em></strong><a class="ae lz" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nt">YouTube</em></strong></a><strong class="ka ir"><em class="nt">，以及</em></strong><em class="nt"/><a class="ae lz" href="https://discord.com/invite/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="nt">不和</em> </strong> </a>T47】</p><p id="33bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> <em class="nt">用</em> </strong> <a class="ae lz" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="nt">电路</em> </strong> </a> <em class="nt">为你的科技创业建立认知和采用。</em></p></div></div>    
</body>
</html>