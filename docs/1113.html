<html>
<head>
<title>Building A Chrome Extension: A Conceptual Understanding</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Chrome扩展:概念上的理解</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-chrome-extension-a-conceptual-understanding-of-its-parts-641ba1f8d431?source=collection_archive---------10-----------------------#2021-03-08">https://javascript.plainenglish.io/the-chrome-extension-a-conceptual-understanding-of-its-parts-641ba1f8d431?source=collection_archive---------10-----------------------#2021-03-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="31a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Chrome扩展制作起来很有趣，也不是很难；事实上，如果你愿意，你甚至可以在React 中建造一个<a class="ae ki" href="https://gilfink.medium.com/building-a-chrome-extension-using-react-c5bfe45aaf36" rel="noopener">。我最新的(也是唯一的)扩展是</a><a class="ae ki" href="https://chrome.google.com/webstore/detail/chaucerizer/ogdlidnaifjeppnphdnknddmnglbnaph?hl=en" rel="noopener ugc nofollow" target="_blank"> Chaucerizer </a>，这是一个简单的扩展，可以改善哈佛的<a class="ae ki" href="https://chaucer.fas.harvard.edu/" rel="noopener ugc nofollow" target="_blank"> Chaucer网站</a>上<em class="kj"> Canterbury Tales </em>的阅读体验。一些扩展只不过是将脚本注入网站，比如隐藏<code class="fe kk kl km kn b">&lt;img&gt;</code>标签或类似的东西；其他人拥有完善的web应用质量特性，可以补充Chromium环境，比如<a class="ae ki" href="https://chrome.google.com/webstore/detail/wappalyzer/gppongmhjkpfnbhagpmjfkannfbllamg?hl=en" rel="noopener ugc nofollow" target="_blank"> Wappalyzer扩展</a>试图告诉你你当前所在的网站采用了哪些技术。我的使用了扩展的大部分基本原则，包括脚本注入和弹出窗口。</p><p id="f471" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我写这篇文章既是对我未来的参考，也是对任何对chrome扩展如何在我认为正确的抽象层次上工作感兴趣的人的参考。我不认为<a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv3/" rel="noopener ugc nofollow" target="_blank">文档</a>有助于正确理解扩展开发的概念，所以我的目标是做一些更有机的东西，更恰当地回答扩展创建中的相关问题。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/fdc2981e28a8100636dbd39a82f8207e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DiQBtZZxnOQOhhpoNVzxlw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">The Chrome extension I made using the architectural principles outlined below.</figcaption></figure><p id="d5f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><a class="ae ki" href="http://extensionizr.com/!#%7B%22modules%22:%5B%22hidden-mode%22,%22with-bg%22,%22with-persistent-bg%22,%22no-options%22,%22no-override%22%5D,%22boolean_perms%22:%5B%5D,%22match_ptrns%22:%5B%5D%7D" rel="noopener ugc nofollow" target="_blank"> Extensionizr </a>是一个非常有用的网站，可以为您创建总体的扩展文件结构。通过浏览这个网站，我们可以开始了解一个扩展的不同组件，以及你的应用是否需要它们中的每一个。然而，令人失望的是，网站选项上Chrome文档的澄清链接会导致错误页面，所以我们必须做一些挖掘来进一步探索。前进！</p><p id="1dbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">其他有用的链接:</p><ul class=""><li id="32dd" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated"><a class="ae ki" href="https://chrome-apps-doc2.appspot.com/extensions/overview.html#arch" rel="noopener ugc nofollow" target="_blank"> Chrome扩展架构概述</a></li></ul><h1 id="4d0c" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">结构分析</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/e153df4796b7e353c942cc5b6f047670.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*FoTW0ThwWgxsDZAsEn4RWQ.jpeg"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk"><a class="ae ki" href="https://en.wikipedia.org/wiki/Geoffrey_Chaucer" rel="noopener ugc nofollow" target="_blank">Geoffrey Chaucer</a>. There is a strong case that he would endorse this Medium article if it was written in Middle English, or with elements of fabliau.</figcaption></figure><h2 id="7c34" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">扩展类型</h2><p id="cdbc" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">这将是您希望扩展的整体“格式”。最好通过理解扩展的目的来选择它:不管它是做一般的任务还是不提供UI(但可能不是)；是否只与特定页面相关；或者它是否应该总是以某种形式存在。</p><ul class=""><li id="a555" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated"><strong class="jm io">隐藏扩展:</strong>大概是一个没有出现在地址栏或者弹出窗口的扩展。非常适合脚本注入这样的简单操作，尽管我个人不会使用这个选项，因为当用户想要隐藏您的扩展的用户界面时，他们可以简单地将其隐藏在地址栏中。想想看，我从来没有使用过真正隐藏的扩展，所以我想知道这是否是一个合法的选择。我可能会避免这个。</li><li id="1cb0" class="le lf in jm b jn nd jr ne jv nf jz ng kd nh kh lj lk ll lm bi translated"><strong class="jm io">页面操作:</strong>只有当用户在相关页面时才会出现的正常扩展。例如，只有当用户在Pinterest网站上时，您才可以显示Pinterest扩展。</li><li id="83b4" class="le lf in jm b jn nd jr ne jv nf jz ng kd nh kh lj lk ll lm bi translated"><strong class="jm io">浏览器操作:</strong>最常用格式；一个典型的扩展，在地址栏中显示图标，就像我们习惯的那样。</li></ul><p id="0f75" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">(请记住,“扩展类型”是Extensionizr为了更清楚地说明应用程序的目的/结构而做的一种形式，但在谷歌看来并不算什么。)</p><h2 id="7e09" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">背景页面</h2><p id="f967" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">关于这一点，请理解“对<strong class="jm io">扩展</strong>的一个共同需求是拥有一个长时间运行的脚本来管理某个任务或状态……”(<a class="ae ki" href="https://chrome-apps-doc2.appspot.com/extensions/background_pages.html#:~:text=A%20common%20need%20for%20extensions,manage%20some%20task%20or%20state.&amp;text=As%20the%20architecture%20overview%20explains,at%20a%20time%20is%20active." rel="noopener ugc nofollow" target="_blank">参考</a>)。把背景页面想象成“信使”,在你的扩展和用户Chrome体验的更广阔世界之间进行交流。</p><ul class=""><li id="0a97" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated"><strong class="jm io">Background.html</strong>是“一个在扩展过程中运行的HTML页面”；据我所知，它不是超级重要的，因为它不是用来展示用户界面的。</li><li id="9630" class="le lf in jm b jn nd jr ne jv nf jz ng kd nh kh lj lk ll lm bi translated"><strong class="jm io"> Background.js </strong>可以通过消息传递与更复杂的chrome APIs交互。这个文件(或这些文件的集合)可能是您存储消息传递相关处理程序的地方，这些处理程序可以在弹出窗口和用户的网站/交互之间进行通信。</li></ul><p id="7d21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">背景页面的一个重要替代是<a class="ae ki" href="https://chrome-apps-doc2.appspot.com/extensions/event_pages.html" rel="noopener ugc nofollow" target="_blank">事件页面</a>，与背景页面不同，它可以根据需要打开和关闭。</p><h2 id="ad6f" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">内容脚本</h2><p id="7e82" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">这是令人兴奋的事情:允许你的扩展在允许交互的网站上插入和使用Javascript。<strong class="jm io"> Inject.js </strong>将允许你将Javascript注入网站，而<strong class="jm io"> Inject.css </strong>将简单地直接向网站提供一些样式(比如，如果你正在进行一个相当简单的黑暗模式，并且你知道目标应用的对象标识符)。请记住，内容脚本和背景页面/弹出窗口之间的通信需要大量使用<a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv2/messaging/" rel="noopener ugc nofollow" target="_blank">消息传递</a>！(这个真的不难，一旦学会了基础。)</p><h2 id="aaa2" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">许可</h2><p id="0618" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">权限对于chrome扩展非常重要，因为它们是a)你如何获得Chrome能够提供的独特功能和API的途径，以及b)定义良好和计算准确的权限可以简化对<a class="ae ki" href="https://chrome.google.com/webstore/category/extensions?hl=en" rel="noopener ugc nofollow" target="_blank">扩展库</a>的批准过程。</p><ul class=""><li id="96c7" class="le lf in jm b jn jo jr js jv lg jz lh kd li kh lj lk ll lm bi translated"><strong class="jm io"> URL权限</strong>既可以帮助您只锁定相关网站来获取信息，也可以帮助您的扩展在扩展商店中获得更容易的批准(如果它们看起来合适的话)。如果你的app需要所有网站的权限，可以使用<code class="fe kk kl km kn b">&lt;all_urls&gt;</code>；然而，这是一种黑幕，它困扰着我人们滥用这种特权的程度。如果您想要创建一个扩展，在被点击时向用户显示界面，但不需要与用户访问的网站进行任何交互(比如，一个跟踪IOT设备的信息并向用户显示的扩展)，那么这个字段可以是空的。</li><li id="0c14" class="le lf in jm b jn nd jr ne jv nf jz ng kd nh kh lj lk ll lm bi translated"><strong class="jm io">其他权限:</strong>如果你在清单中指定，你可以访问书签、用户剪贴板、cookies、历史、通知、标签(当你想通过你的扩展打开或关闭标签时)，等等。这在清单<code class="fe kk kl km kn b">permissions</code>中有所表述，文档可以在这里找到<a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv3/declare_permissions/" rel="noopener ugc nofollow" target="_blank">。通常，您使用权限的方式是，它将为您提供对一个易于访问的对象的访问——就像标签权限的<code class="fe kk kl km kn b">chrome.tabs</code>——您可以在通过清单获得权限后使用它。</a></li></ul><h2 id="7f8d" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">选择</h2><ul class=""><li id="4f0c" class="le lf in jm b jn my jr mz jv ni jz nj kd nk kh lj lk ll lm bi translated"><strong class="jm io"> Options.html: </strong>很多扩展都有一整页进行设置，比如(我相信)Honey和1Password。如果您认为您的扩展将证明整个页面适合设置/用户定制，请选择此选项。</li><li id="3ee8" class="le lf in jm b jn nd jr ne jv nf jz ng kd nh kh lj lk ll lm bi translated"><a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv2/options/#embedded_options" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">嵌入式选项:</strong> </a>这将在Chrome本身的扩展链接上显示定制选项，如果你的应用程序的定制选项/需求较少，这可能是一个更好的选择。</li></ul><p id="d696" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者，您可以只允许用户直接在扩展接口本身上更改选项。创建这些选项解决方案是为了避免混乱，但是您的扩展可能太简单了，以至于不需要一个完全独立的选项页面，或者甚至是嵌入式选项(尽管在这种情况下，这将是一个优雅的解决方案！).</p><h2 id="6c8f" class="mm lo in bd lp mn mo dn lt mp mq dp lx jv mr ms mb jz mt mu mf kd mv mw mj mx bi translated">无视</h2><p id="620a" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">我不太熟悉<a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv2/override/" rel="noopener ugc nofollow" target="_blank">覆盖</a>的概念，但是对文档的快速分析告诉我们，我们可以覆盖书签管理器页面、Chrome历史页面或新标签页面。此外，扩展只能覆盖这些页面中的一个；因此，你不能有一个既操作书签管理器又操作浏览器历史页面的扩展。我对这个特性的非显而易见的用例一无所知，但这是手边的好知识。</p><h1 id="d16c" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">清单v3的更改</h1><p id="2399" class="pw-post-body-paragraph jk jl in jm b jn my jp jq jr mz jt ju jv na jx jy jz nb kb kc kd nc kf kg kh ig bi translated">点击<a class="ae ki" href="https://developer.chrome.com/docs/extensions/mv3/intro/mv3-overview/" rel="noopener ugc nofollow" target="_blank">此处</a>查看Chrome第三个扩展清单版本带来的变化，以及由此产生的开发范式的改变。上述信息主要与v2有关，因为可以预见该版本会有更多的在线资源。但是Manifest v3提供了许多改进，包括防止远程代码执行(想想看，大量可疑的扩展最终会向最终用户释放恶意软件！)，并为一堆重要的扩展函数添加了<code class="fe kk kl km kn b">async/await</code>支持(这将极大地帮助我的开发人员在使用这个清单进行扩展时保持理智；在以前的清单中，您几乎无法避免回调问题)。然而，“服务人员”取代了背景页面，这可能会干扰按照上述原则和StackOverflow进行开发的便利性，所以一旦我对这个新清单有了体验，我会考虑撰写一篇更新的文章。</p><h1 id="4a30" class="ln lo in bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">结论</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nl"><img src="../Images/7f47589111beb20faecb8f399f36afdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOiX77bFW6YQdDbMsuIt3Q.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">The <a class="ae ki" href="https://en.wikipedia.org/wiki/Battle_of_Hastings" rel="noopener ugc nofollow" target="_blank">Battle of Hastings</a>, which solidified the end of Anglo-Saxon rule of England</figcaption></figure><p id="ae60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的发展理论是，我们为应用程序开发开发不同于文档结构的心智模型，最有效的应用程序开发人员能够以对他们有帮助的方式映射信息及其关系，但可能不容易通过文本表达。希望通过查看上面的信息，你可以了解一些chrome扩展在内部是如何工作的，以及它们在外部是如何表现的。</p></div></div>    
</body>
</html>