<html>
<head>
<title>A Detailed Guide to Using Axios in Your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React应用中使用Axios的详细指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-detailed-guide-to-using-axios-in-your-react-app-7396f79fb4c2?source=collection_archive---------3-----------------------#2021-05-23">https://javascript.plainenglish.io/a-detailed-guide-to-using-axios-in-your-react-app-7396f79fb4c2?source=collection_archive---------3-----------------------#2021-05-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/907ff1f460d4847d0e2f468c2231ddf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uu1eCopfZ5grgzVuIesQVw.png"/></div></div></figure><h2 id="597f" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">简介</strong></h2><p id="1f05" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">React不是一个成熟的框架，所以它不太关心路由、网络调用等事情。</p><p id="55dd" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在React环境中，我们对几乎所有事情都有很多选择。对于网络，我们也有很多选项，如<code class="fe lr ls lt lu b">fetch</code>、<code class="fe lr ls lt lu b">axios</code>、<code class="fe lr ls lt lu b">react-http-client</code>等。</p><p id="70a0" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">除此之外，Axios还提供了许多功能，如<code class="fe lr ls lt lu b">global-config</code>、<code class="fe lr ls lt lu b">Interceptors</code>，更好的错误处理程序等等。</p><h2 id="f52c" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Axios</h2><p id="5467" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">Axios是用于浏览器和Node.js的基于promise的HTTP客户端。Axios提供了许多特性来为React应用程序进行HTTP网络调用。</p><h2 id="03b3" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">浏览器支持</h2><p id="d15d" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">Axios拥有出色的浏览器支持，包括IE11。因此，它将解决许多基于浏览器网络问题。</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/b2454becb1a7998ca21242e174d7f37f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*P_PVf9gm1jH81LCFQbbFog.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk"><a class="ae me" href="https://saucelabs.com/open_sauce/build_matrix/axios.svg" rel="noopener ugc nofollow" target="_blank">https://saucelabs.com/open_sauce/build_matrix/axios.svg</a></figcaption></figure><p id="30c4" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">看酱上的报道:<a class="ae me" href="https://saucelabs.com/u/axios" rel="noopener ugc nofollow" target="_blank">https://saucelabs.com/u/axios</a></p><h2 id="da87" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装:</h2><p id="3f98" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">使用npm安装Axios】</p><p id="3029" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">地点:<a class="ae me" href="https://axios-http.com/" rel="noopener ugc nofollow" target="_blank">https://axios-http.com/</a></p><h2 id="469d" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建一个空项目</h2><p id="19eb" class="pw-post-body-paragraph kr ks in kt b ku kv kw kx ky kz la lb ke lc ld le ki lf lg lh km li lj lk ll ig bi translated">我们将创建use <a class="ae me" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> Create-React-App </a>并进行您想要的必要更改:<code class="fe lr ls lt lu b">npx create-react-app <strong class="kt io">react-simple-http</strong></code>。</p><p id="82bf" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">现在你会看到这个页面:</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/84e2c3f989808c7884ea82aac3b3fca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*slRBf5d5DWmOXBSd.png"/></div></div></figure><p id="6b1c" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">我们将对JSON占位符服务器进行API调用。</p><p id="6ea9" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在<code class="fe lr ls lt lu b">App.jsx</code>中:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="78ad" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在这段代码中，您可能会注意到我们通过<code class="fe lr ls lt lu b">res.data</code>访问响应数据，但是在响应中，它是一个数组。</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/2acc60052ec4b3dc4eae5c63885b3071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uae3lgZd-u_42B26kSThWQ.png"/></div></div></figure><p id="c81d" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">因为Axios会自动解析响应并在数据键中分配数据。它还会在响应对象中提供大量信息。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="33b5" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">上面的例子非常简单，现在我们来看看实际应用中的具体问题，比如:</p><ol class=""><li id="f94d" class="mj mk in kt b ku lm ky ln ke ml ki mm km mn ll mo mp mq mr bi translated"><strong class="kt io">如何在每个请求的头中添加auth token？</strong></li><li id="33e5" class="mj mk in kt b ku ms ky mt ke mu ki mv km mw ll mo mp mq mr bi translated"><strong class="kt io">在退出页面/组件时，如何停止待定请求？</strong></li><li id="eb75" class="mj mk in kt b ku ms ky mt ke mu ki mv km mw ll mo mp mq mr bi translated"><strong class="kt io">如何用Axios处理react js中的错误？</strong></li><li id="23c5" class="mj mk in kt b ku ms ky mt ke mu ki mv km mw ll mo mp mq mr bi translated">如何处理Axios中的CSRF？</li></ol><h2 id="c829" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">批准</h2><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/ccc66731d865e66dab44f6a6264fd617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oAJLwdLZsfQheCaO"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk"><a class="ae me" href="https://unsplash.com/photos/Vp3oWLsPOss" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/Vp3oWLsPOss</a></figcaption></figure><p id="0826" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在真实的应用程序中，每个请求都必须包含用于授权的auth-token。在Axios中，我们可以使用<a class="ae me" href="https://axios-http.com/docs/interceptors" rel="noopener ugc nofollow" target="_blank"> Axios拦截器</a>为每个请求添加auth头。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="61ea" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果令牌可用，这段代码将为每个请求添加<code class="fe lr ls lt lu b">Authorization</code>头。在登录/注册页面中，我们不需要将它们发送到服务器。在这些页面上，删除本地存储令牌(如果可用)。</p><h2 id="cd3a" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">中止/取消请求</h2><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/62883e3789dc96c0156d7fb68de1a963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xCIg0g9Mj65ymXpb"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk"><a class="ae me" href="https://unsplash.com/photos/IqB5MPcQp6k" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/IqB5MPcQp6k</a></figcaption></figure><p id="9cc5" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果组件被破坏，我们应该取消该特定组件发出的所有未决网络调用。在Axios中，我们可以通过使用<a class="ae me" href="https://axios-http.com/docs/cancellation" rel="noopener ugc nofollow" target="_blank"> Axios取消</a>来中止/取消。</p><p id="c250" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">通过使用Axios取消令牌，我们可以取消挂起的请求。</p><pre class="lw lx ly lz gt my lu mz na aw nb bi"><span id="f2d8" class="jv jw in lu b gy nc nd l ne nf">const cancelTokenSource = axios.CancelToken.source();<br/><br/>axios.get('/user/12345', {<br/>  cancelToken: cancelTokenSource.token<br/>});<br/><br/>// Cancel request<br/>cancelTokenSource.cancel();</span></pre><p id="3395" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">上面的例子是Axios消除的最简单的应用。</p><p id="1769" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">我们可以通过3个简单的步骤实现Axios消除。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="5d10" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">我已经为这三个简单的步骤添加了注释。</p><h2 id="b0c0" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">错误处理</strong></h2><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/741a983ab2e7371ff4511a959cd9ca88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k6xEt80u_Xj3-YmK"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk"><a class="ae me" href="https://unsplash.com/photos/bMvuh0YQQ68" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/bMvuh0YQQ68</a></figcaption></figure><p id="0f03" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">在现实世界中，每个应用程序都使用一些共同的规则，如“如果响应头包含401，则重定向到登录页面，等等”。为此，我们需要处理应用层。</p><pre class="lw lx ly lz gt my lu mz na aw nb bi"><span id="eb9d" class="jv jw in lu b gy nc nd l ne nf">axios.interceptors.response.use(undefined, function (error) {</span><span id="2c6b" class="jv jw in lu b gy ng nd l ne nf"><em class="nh"> // Handle you error</em></span><span id="6b47" class="jv jw in lu b gy ng nd l ne nf"> return Promise.reject(error);</span><span id="829a" class="jv jw in lu b gy ng nd l ne nf">});</span></pre><p id="aae1" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">上面的代码是Axios拦截器在全局错误处理程序中最简单的用法，但是在现实世界中，应用程序需要在生产和开发模式下处理大量的错误。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="dd1f" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果响应状态代码为401，此代码将重定向到登录页面，并且仅在开发模式下显示控制台错误，在生产和开发模式下都显示警报。</p><h2 id="99ec" class="jv jw in bd jx jy jz dn ka kb kc dp kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">CSRF代币</h2><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mx"><img src="../Images/5b89ad7f8576dc4e242ddf38753fd953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yvvWIIlbqnuz2SHY"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk"><a class="ae me" href="https://unsplash.com/photos/QozzJpFZ2lg" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/QozzJpFZ2lg</a></figcaption></figure><p id="714f" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果你使用一个高级的网络框架，比如Laravel，Django等等。我们可能需要将CSRF令牌和请求数据一起发送。Axios默认支持CSRF令牌。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="53fd" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated">如果您对在react应用程序中使用Axios有任何疑问，请在评论中留下。</p><p id="99c6" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><strong class="kt io">感谢您的阅读！</strong>如果你喜欢这篇文章，可以考虑<a class="ae me" href="https://twitter.com/NaveenDA_" rel="noopener ugc nofollow" target="_blank">在Twitter上关注我</a>，并与你的开发者朋友分享这篇文章。🐋</p><p id="af49" class="pw-post-body-paragraph kr ks in kt b ku lm kw kx ky ln la lb ke lo ld le ki lp lg lh km lq lj lk ll ig bi translated"><em class="nh">更多内容请看</em><a class="ae me" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt io"><em class="nh">plain English . io</em></strong></a></p></div></div>    
</body>
</html>