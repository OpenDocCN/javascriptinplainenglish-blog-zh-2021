<html>
<head>
<title>How to Create a Gatsby Source Plugin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建一个Gatsby源代码插件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-gatsby-source-plugin-5e6728c3e7af?source=collection_archive---------15-----------------------#2021-06-05">https://javascript.plainenglish.io/how-to-create-a-gatsby-source-plugin-5e6728c3e7af?source=collection_archive---------15-----------------------#2021-06-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d21b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Gatsby使得通过GraphQL和自定义插件向您的站点添加数据变得非常容易！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d57b1e8ae3c7d9335cd35aaebaf7da7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RLslnkG38gpsUzm0.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo Illustration by David Fekke</figcaption></figure><p id="9bf8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gatsby的一个强大之处在于，你可以将来自完全不同领域的多种来源的内容放入你的网站。盖茨比通过插件做到了这一点。</p><p id="4df2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">盖茨比有两种主要形式的插件，“源”和“转换器”。Source插件允许您将Gatsby站点外部的数据引入Gatsby，Transformer插件允许您将来自源的数据传递和转换为站点中需要的特定内容。</p><p id="1fc0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦数据被配置为通过一个源插件进入您的站点，您将能够使用GraphQL查询来查询您需要添加到您的站点的特定内容。</p><p id="ced1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您还可以使用Gatsby的内置查询编辑器，在运行<code class="fe lr ls lt lu b">gatsby develop</code>之后，可以通过GraphiQL <code class="fe lr ls lt lu b">http://localhost:8000/___graphql</code> url访问该编辑器。</p><h1 id="6f75" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">来源</h1><p id="4bd8" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">Gatsby有无限多的来源，包括API、内容引擎、静态文件甚至数据库。在这篇文章中，我将创建一个从外部API获取内容的插件。</p><h1 id="1041" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">创建插件</h1><p id="1e6d" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">为了创建我的Gatsby插件，我将使用Gatsby CLI创建一个新的Gatsby站点和一个Gatsby插件模块。让我们首先使用“Hello World”启动器创建网站。</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="323d" class="mw lw iq lu b gy mx my l mz na">gatsby new playground-site<!-- --> <a class="ae nb" href="https://github.com/gatsbyjs/gatsby-starter-plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/gatsbyjs/</a>gatsby-starter-hello-world</span></pre><p id="7d24" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们在创建操场站点的同一个目录下创建一个源码插件。</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="c920" class="mw lw iq lu b gy mx my l mz na">gatsby new source-plugin <a class="ae nb" href="https://github.com/gatsbyjs/gatsby-starter-plugin" rel="noopener ugc nofollow" target="_blank">https://github.com/gatsbyjs/gatsby-starter-plugin</a></span></pre><p id="2d23" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你愿意，你也可以把插件创建到你的playground-site文件夹的‘plugins’文件夹中。对于这个例子，我们将把站点和插件放在不同的文件夹中。</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="cb9e" class="mw lw iq lu b gy mx my l mz na">/playground-site <br/>/source-plugin <br/>├── .gitignore <br/>├── gatsby-browser.js <br/>├── gatsby-node.js <br/>├── gatsby-ssr.js <br/>├── index.js <br/>├── package.json <br/>└── README.md</span></pre><h1 id="e51f" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">配置您的插件</h1><p id="20d2" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">现在，让我们通过编辑“游乐场-站点”文件夹根目录下的<strong class="kx ir"> gatsby-config.json </strong>文件来配置are“游乐场-站点”使用插件。</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="1603" class="mw lw iq lu b gy mx my l mz na">module.exports = {<br/>  plugins: [require.resolve(`../source-plugin`)],<br/>}</span></pre><p id="5aee" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以通过在我们的操场上运行<code class="fe lr ls lt lu b">gatsby develop</code>来测试这个配置是否正确。当你运行游乐场网站时，你应该在终端上看到“加载的盖茨比启动器插件”。</p><h1 id="9657" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">向我们的插件添加数据</h1><p id="5f6a" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">现在我们已经有了我们的示例插件，让我们修改它，这样它就可以从一个API拉进一个源代码。对于这个例子，我将使用星球大战API。我希望能够使用GraphQL从星球大战API中查询船舶数据。</p><p id="c52a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Gatsby提供了一个API，您可以通过一个名为<code class="fe lr ls lt lu b">createNode</code>的函数来创建GraphQL节点。我们可以在导出名为<code class="fe lr ls lt lu b">sourceNodes</code>的异步函数的<strong class="kx ir"> gatsby-node.js </strong>文件中的函数内部使用它。</p><p id="cd8e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于这个例子，我将使用<code class="fe lr ls lt lu b">axios</code>模块从星球大战API获取数据。在您的插件模块中，您可以使用以下npm命令添加它；</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="4ee4" class="mw lw iq lu b gy mx my l mz na">source-plugin&gt; npm i axios --save</span></pre><p id="1112" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这将把<code class="fe lr ls lt lu b">axios</code>添加到project.json依赖项中。现在我们已经添加了<code class="fe lr ls lt lu b">axios</code>，我们可以修改<strong class="kx ir"> gatsby-node.js </strong>文件，这样sourceNodes函数看起来像下面这样；</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="5243" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们修改了插件中的<strong class="kx ir"> gatsby-node.js </strong>文件，这样它就可以查询星球大战API中的所有飞船，并为每艘飞船添加节点。我们现在通过运行<code class="fe lr ls lt lu b">gatsby develop</code>命令并查询位于<a class="ae nb" href="http://localhost:8000/___graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/_ _ _ GraphQL</a>的Graph QL<em class="ne">I</em>QL工具来测试插件是否正在使用Graph QL添加节点。</p><p id="65f0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尝试在graphiql中执行以下查询；</p><pre class="kg kh ki kj gt ms lu mt mu aw mv bi"><span id="c0af" class="mw lw iq lu b gy mx my l mz na">query MyQuery {<br/>  allShip {<br/>    edges {<br/>      node {<br/>        id<br/>        name<br/>        model<br/>      }<br/>    }<br/>  }<br/>}</span></pre><h1 id="1109" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">在我们的网站上使用这些数据</h1><p id="5c3c" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">现在我们有了查询数据的插件，我们可以用它来查询数据并显示在我们的主页上。让我们修改<strong class="kx ir"> index.js </strong>文件，以便它使用GraphQL从我们的插件中查询数据；</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="80c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">正如你在上面的例子中看到的，我们在<code class="fe lr ls lt lu b">graphql</code>中导入，创建一个查询来获取我们的船数据，然后通过主页函数中的“数据”解构造器输出。</p><h1 id="054f" class="lv lw iq bd lx ly lz ma mb mc md me mf jw mg jx mh jz mi ka mj kc mk kd ml mm bi translated">结论</h1><p id="9959" class="pw-post-body-paragraph kv kw iq kx b ky mn jr la lb mo ju ld le mp lg lh li mq lk ll lm mr lo lp lq ij bi translated">Gatsby使得通过使用源代码插件来扩展内置功能以导入数据变得非常容易。结合GraphQL的强大功能，我们现在可以轻松地向Gatsby站点添加新的数据源。</p><p id="9756" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ne">原发布于</em><a class="ae nb" href="https://fek.io/blog/how-to-create-a-gatsby-source-plugin/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://fek . io</em></a><em class="ne">。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf nd l"/></div></figure></div></div>    
</body>
</html>