<html>
<head>
<title>Functional JavaScript: Writing a Simple Command-line Game (Part 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">函数式JavaScript:编写简单的命令行游戏(第5部分)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/functional-javascript-writing-a-simple-command-line-game-part-5-ac9b298d7ecd?source=collection_archive---------12-----------------------#2021-05-02">https://javascript.plainenglish.io/functional-javascript-writing-a-simple-command-line-game-part-5-ac9b298d7ecd?source=collection_archive---------12-----------------------#2021-05-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1272a4d65e141b240b8ced108aea3bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QgSCY1WnBf6525H4"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@danasaki?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dan Asaki</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8c0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">目前，我们已经到了旅程的终点。在这最后一部分，我们将快速查看迷宫代码。这里的计划不是深入细节，而是关注一些基本方面。首先，我们创建一个房间类型。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="51d6" class="lh li in ld b gy lj lk l ll lm">// room.js<br/>const room = function( attrib ){<br/><br/>    attrib = attrib || {};<br/>    const dv = (value,def ) =&gt; (typeof value === "undefined")?def:value;<br/>    const _name = dv( attrib.name, "&lt;lost&gt;");<br/>    const _msg = dv( attrib.msg, "");<br/>    const _doors = dv( attrib.doors, {} );<br/>    let _monster = dv( attrib.monster, null );<br/>    let _item = dv( attrib.item, null );<br/><br/>    function name() {<br/>        return _name;<br/>    }<br/>    function monster() {<br/>        const m = _monster;<br/>        _monster = null;<br/>        return m;<br/>    }<br/>    function doors() {<br/>        return _doors;<br/>    }<br/>    function message() {<br/>        return _msg;<br/>    }<br/>    function item() {<br/>        const i = _item;<br/>        _item = null;<br/>        return i;<br/>    }<br/>    return { name, monster, doors, item, message, isRoom : true };<br/>}<br/><br/>module.exports = room;</span></pre><p id="7243" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到这个时候，图案应该感觉非常自然；我们已经创建了一个封装房间私有数据的对象，并且实现了一组助手方法。我们只希望冒险者和房间里的怪物战斗一次，所以怪物方法‘清空’了怪物。房间里的物品也是如此。</p><p id="9a0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们看看动作处理程序。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="6c2b" class="lh li in ld b gy lj lk l ll lm">const actions = function( maze ) {<br/>    const hits = [ "head", "arm", "leg" ]<br/>    function hit() {<br/>        const i = <strong class="ld io"><em class="ln">Math</em></strong>.floor(<strong class="ld io"><em class="ln">Math</em></strong>.random() * hits.length);<br/>        return hits[i];<br/>    }<br/><br/>    function move(direction) {<br/>        return function (room, player) {<br/>            return _move(room, direction, player)<br/>        }<br/>    }<br/><br/>    function _move(room, direction, player) {<br/>        const door = room.doors()[direction];<br/>        if (!door) {<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log("You walk and hit your " + hit() + " ouch!");<br/>        } else if (typeof door == "object") {<br/>            const itm = player.use( door.item);<br/>            if ( itm ) {<br/>                return maze[door.room];<br/>            } else<br/>            {<br/>                player.stash( itm );<br/>            }<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log("You need the " + door.item + " to go that way");<br/>        } else {<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log( "you walk towards the " + maze[door].name())<br/>            return maze[door];<br/>        }<br/>        return room;<br/>    }<br/><br/>    function list(room, player) {<br/>        const bag = player.getBag();<br/>        if (bag.items().length) {<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log("Your bag contains " + bag.items());<br/>        } else {<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log("You have nothing in your bag");<br/>        }<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("You have a " + player.getWeapon().name() + " to defend with");<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("You have " + player.getHP() + " health left");<br/>        return room;<br/>    }<br/><br/>    function help(room) {<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("Type n,s,e,w,u,d,l");<br/>        return room;<br/>    }<br/><br/>    function quit(room, player) {<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("Goodbye...");<br/>        <strong class="ld io"><em class="ln">process</em></strong>.exit(0);<br/>    }<br/><br/>    const command = {<br/>        list: list,<br/>        l: list,<br/>        east: move("e"),<br/>        e: move("e"),<br/>        west: move("w"),<br/>        w: move("w"),<br/>        north: move("n"),<br/>        n: move("n"),<br/>        south: move("s"),<br/>        s: move("s"),<br/>        up: move("u"),<br/>        u: move("u"),<br/>        down: move("d"),<br/>        d: move("d"),<br/>        o: move("o"),<br/>        open: move("open"),<br/>        c: move("c"),<br/>        close: move("close"),<br/>        q: quit,<br/>        quit: quit,<br/>        "?": help,<br/>        "help": help<br/>    };<br/>    function action( name ) {<br/>        return command[name]<br/>    }<br/>    return { action };<br/>}<br/>module.exports = actions;</span></pre><p id="0a1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">动作定义了冒险者可以发出的一组动词。现在，我们将动词限制为移动、列出、退出和帮助。移动是基于标准的北、南、东、西运动方式发生的。所以当我们在一个房间里时，我们可以在一面或多面墙上看到“门”。我们也用动作来让自己向上或向下。也许令人惊讶的是，我们也可以用一个动作来代表打开或关闭胸腔。从游戏代码来看，当你打开一个箱子时，你在箱子里；当你合上胸腔，你就离开了胸腔。</p><p id="2f2e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">值得看一下move函数，因为这是一个闭包；调用move( "e ")会返回一个关闭" e "的函数，并接受两个参数" room "和" player "。所有动作共享相同的函数签名。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="bf77" class="lh li in ld b gy lj lk l ll lm">function move(direction) {<br/>    return function (room, player) {<br/>        return _move(room, direction, player)<br/>    }<br/>}</span></pre><p id="57f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">位于maze.js中的是迷宫遍历逻辑的核心。我们还在这个文件中设置了迷宫和小怪。有很多机会可以重构这些代码。让我们看看迷宫中的第一个房间。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="cafb" class="lh li in ld b gy lj lk l ll lm">const maze = {<br/>    1: room({ name: "The Entrance Room",<br/>        msg: "There is an old rusty chest in the corner",<br/>        doors: {<br/>            n: 2,<br/>            e: 3,<br/>            w: 4,<br/>            u: { item: "ladder", room: 6 },<br/>            o: "chest1"<br/>        }<br/>    })<br/>}</span></pre><p id="a784" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在地图/物体中定义迷宫。键1代表“房间1”的数据。从门厅的“1号房间”开始，你可以向东到3号房间，向北到3号房间，等等。如果你有物品“梯子”，那么你可以去6号房间。也可以开胸。我们还为房间提供了第二行描述。这个描述可以详细到你想要的程度；在这种情况下，它告诉我们，在角落里有一个生锈的箱子。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="e21a" class="lh li in ld b gy lj lk l ll lm">"chest1": room( {<br/>    name: "Rusty chest",<br/>    msg:"",<br/>    item: <strong class="ld io"><em class="ln">weapons</em></strong>.short_sword,<br/>    doors: {<br/>        c: 1<br/>    }<br/>}),</span></pre><p id="a708" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">迷宫对象中的以下关键点描述了箱子内部的内容。只有一个出口，关闭箱子。这个出口让我们回到“1号房间”如果我们想，我们可以让这个箱子有一个传送点！</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="fbfb" class="lh li in ld b gy lj lk l ll lm">"chest1": room( {<br/>    name: "Rusty chest",<br/>    msg:"",<br/>    item: <strong class="ld io"><em class="ln">weapons</em></strong>.short_sword,<br/>    doors: {<br/>        c: 1, d: 6<br/>    }<br/>}),</span></pre><p id="38b7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过添加向下移动选项，我们可以跳到房间6。这取决于迷宫的设计者。另一个值得注意的是这个箱子里有一把短剑。这个武器是至关重要的，因为在这个迷宫中的怪物没有任何挑衅的攻击。你不会想不带武器四处游荡的。当角色进入箱子时，剑被藏在他们的包里并装备好。我们总是装备冒险者拥有的最强大的武器。</p><p id="bc6d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们关注的代码的最后一部分是主循环。我们使用Node.js readline模块作为我们的循环。该模块允许我们从控制台读取并显示提示，用户可以与该提示进行交互。每次用户键入命令时，我们都会将它传递给会话结束。正是这种封闭跟踪了迷宫中的位置。我们从迷宫中的第一个房间，1号房间开始定位。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="5e0e" class="lh li in ld b gy lj lk l ll lm">let where = maze[1];<br/>let session = ( command ) =&gt; where = _run( where, player, command );<br/>session( "l");</span></pre><p id="99a6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每次我们向会话传递命令时，我们都会更新“在哪里”。有时我们会呆在同一个地方，例如，如果我们给“l”列表。</p><p id="238f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从会话中调用的_run例程主要负责向用户打印出一条好消息，并处理房间的独特功能，比如物品和怪物。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9f46" class="lh li in ld b gy lj lk l ll lm">function _run( room, player, command ) {<br/>    const action = actions.action(command);<br/>    if (!action) {<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("I do not know how to '" + command + "' type ? or help for help");<br/>        return room;<br/>    }<br/>    room = action(room, player);<br/>    <strong class="ld io"><em class="ln">console</em></strong>.log("You are in " + room.name());<br/>    <strong class="ld io"><em class="ln">console</em></strong>.log(room.message());<br/>    // Empty doors mark the end<br/>    const doors = <strong class="ld io"><em class="ln">Object</em></strong>.keys(room.doors());<br/>    if (doors.length === 0) {<em class="ln"><br/>        </em><strong class="ld io"><em class="ln">process</em></strong>.exit(0);<br/>    }<br/>    <strong class="ld io"><em class="ln">console</em></strong>.log("You see doors to the " + doors );<br/>    let mob = room.monster();<br/>    if (mob) {<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("There is a " + mob.name() + " in here!!!");<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("it starts to attack you");<br/>        <strong class="ld io"><em class="ln">console</em></strong>.log("you use your " + player.getWeapon().name() + " to attack it");<br/>        // fight returns true if the first listed dies<br/>        if (fight(player, mob)) {<br/>            <strong class="ld io"><em class="ln">console</em></strong>.log("you lost, goodbye!");<br/>            <strong class="ld io"><em class="ln">process</em></strong>.exit(0);<br/>        }<br/>    }<br/>    const i = room.item()<br/>    if (i != null) {<br/>        player.stash(i);<em class="ln"><br/>        </em>if (i.isWeapon &amp;&amp; i.strength() &gt; player.getWeapon().strength()) {<br/>            player.use(i.name());<br/>        }<br/>    }<br/>    player.levelUp();<br/>    return room;<br/>}</span></pre><p id="53bf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就结束了。我已经把完整的工作代码推给了GitHub。</p><p id="e185" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://github.com/mdcfrancis/adventurejs" rel="noopener ugc nofollow" target="_blank">https://github.com/mdcfrancis/adventurejs</a></p><p id="156b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请随意提交修复；很可能有一些角落的情况错过了。缺少一些测试，并且有可能重构代码。</p><p id="e678" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我希望您喜欢这个系列，并感受一下在不使用大量第三方库的情况下，您可以在JavaScript中实现什么。我强烈鼓励使用功能风格作为封装行为的一种方式。您可以阅读我对此的介绍:</p><div class="lo lp gp gr lq lr"><a rel="noopener  ugc nofollow" target="_blank" href="/functional-javascript-classes-without-the-class-keyword-6e2de50a3698"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">函数式JavaScript:没有“class”关键字的类</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">了解如何使用函数式JavaScript来定义类，而不使用class关键字。基于…中使用的风格</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mb l mc md me ma mf jt lr"/></div></div></a></div><p id="cdfc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我知道你的想法，如果这是人们会发现有帮助的事情，我很乐意将这段代码分解得更详细。</p></div><div class="ab cl mg mh hr mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ig ih ii ij ik"><div class="ky kz la lb gt lr"><a rel="noopener  ugc nofollow" target="_blank" href="/functional-javascript-writing-a-simple-command-line-game-335ab9fcc005"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd io gy z fp lw fr fs lx fu fw im bi translated">函数式JavaScript:编写一个简单的命令行游戏(1)</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">使用JavaScript和功能对象模型，我们为Node.js创建了一个简单的命令行游戏的第一部分。</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mn l mc md me ma mf jt lr"/></div></div></a></div><p id="bdb1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ln">更多内容参见</em> </a></p></div></div>    
</body>
</html>