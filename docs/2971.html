<html>
<head>
<title>The Fetch() API Explained in 3 Simple Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fetch() API用3个简单的步骤解释</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/fetch-api-in-three-simple-steps-explanation-276979dc8798?source=collection_archive---------7-----------------------#2021-06-16">https://javascript.plainenglish.io/fetch-api-in-three-simple-steps-explanation-276979dc8798?source=collection_archive---------7-----------------------#2021-06-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c3ea" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">JavaScript中获取API的初学者指南</h2></div><p id="7cc7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个简短的指南中，我将向您介绍fetch()方法。虽然互联网上有很多关于如何使用API和从API中获取数据的有用和可靠的信息，但我编写了这本初学者指南，以演示当fetch方法的特定部分被执行时会发生什么，并弥合在script.js文件中编写的内容和在任何浏览器的开发人员控制台中显示的内容之间的差距。</p><p id="d3e7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们把手弄脏吧！</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/70ef986a970d5220c9d09d1bb89c0c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U-beO7dd95qaNhm5"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@jeremybishop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jeremy Bishop</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b16c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">和往常一样，让我们看看官方的<a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch" rel="noopener ugc nofollow" target="_blank"> MDN Web文档</a>并通读一遍:</p><blockquote class="lp lq lr"><p id="a17a" class="kc kd ls ke b kf kg jo kh ki kj jr kk lt km kn ko lu kq kr ks lv ku kv kw kx ig bi translated"><a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope" rel="noopener ugc nofollow" target="_blank">WindowOrWorkerGlobalScope</a>mixin的fetch()方法启动从网络获取资源的过程，返回一个承诺，一旦响应可用，该承诺就会实现。承诺解析为代表对您的请求的响应的<a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Web/API/Response" rel="noopener ugc nofollow" target="_blank">响应</a>对象。promise不拒绝HTTP错误——它只拒绝网络错误。您必须使用then处理程序来检查HTTP错误。</p></blockquote><p id="5a3e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">虽然这个定义可能看起来有点复杂，但它概述了我们应该熟悉的关键术语，到本文结束时，您将能够理解所有这些术语。以下是这些关键术语:</p><ul class=""><li id="b8f8" class="lw lx in ke b kf kg ki kj kl ly kp lz kt ma kx mb mc md me bi translated">资源</li><li id="4846" class="lw lx in ke b kf mf ki mg kl mh kp mi kt mj kx mb mc md me bi translated">反应</li><li id="66cd" class="lw lx in ke b kf mf ki mg kl mh kp mi kt mj kx mb mc md me bi translated">承诺</li><li id="1e82" class="lw lx in ke b kf mf ki mg kl mh kp mi kt mj kx mb mc md me bi translated">满足或拒绝</li></ul><p id="eb18" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是fetch()方法语法:</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="67b0" class="mp mq in ml b gy mr ms l mt mu">const fetchResponsePromise = fetch(resource [,init])</span></pre><p id="c573" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Resource —它定义了您想要获取的资源/大多数情况下，它只是一个到远程资源的链接。</p><p id="3380" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Init(可选)—包含要应用于请求的任何自定义设置的对象。默认情况下，fetch方法发送一个GET请求。</p><h1 id="1054" class="mv mq in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated"><strong class="ak">准备就绪！</strong></h1><p id="2b80" class="pw-post-body-paragraph kc kd in ke b kf nm jo kh ki nn jr kk kl no kn ko kp np kr ks kt nq kv kw kx ig bi translated">出于学习的目的，我们将使用一个名为<a class="ae lo" href="https://icanhazdadjoke.com/api" rel="noopener ugc nofollow" target="_blank">icanhazdadjocke</a>的公共API。这个API可以用作获取随机笑话、特定笑话或搜索各种格式的笑话的API。</p><p id="e79b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个简单的标准HTML文档，并在script.js文件中编写以下代码，为我们打算按照API文档的指示获取的所有请求设置一个自定义用户代理头:</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="a4a0" class="mp mq in ml b gy mr ms l mt mu">// API path/ link to search for random jokes<br/>const resource = 'https://icanhazdadjoke.com'<br/>// this is a config var to fetch data per API instructions/needs to go to header<br/>const init = {<br/>headers: {<br/>Accept: 'application/json',<br/>}}</span></pre><p id="5d5e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">常见的提取请求如下所示:</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="4839" class="mp mq in ml b gy mr ms l mt mu">fetch("a string to a URL to get data")<br/>.then(function(response) {return response.json();})<br/>.then(function(json){ <br/>// Use the data inside of "json" to do some magic manipulation!})</span></pre><p id="a73e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，让我们把这个获取请求分解成三个简单的步骤，就像我之前承诺的那样！</p><h1 id="5905" class="mv mq in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated"><strong class="ak">第一步。答应回应。</strong></h1><p id="93ac" class="pw-post-body-paragraph kc kd in ke b kf nm jo kh ki nn jr kk kl no kn ko kp np kr ks kt nq kv kw kx ig bi translated">在您的JavaScript文件中编写以下代码，在浏览器控制台中运行该代码，并在控制台中查看输出。</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="9507" class="mp mq in ml b gy mr ms l mt mu">const result = fetch(resource, init)<br/>console.log(result);</span></pre><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/506653131f501f6e83a3539a1463b7dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*BC-XVIOCOV4sUirIAfQIvw.png"/></div></figure><p id="ffe1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们调用“fetch()”并传递一个指向数据源的URL和init config data作为从API获取数据的参数。令人惊讶的是，如果您一直向下展开这个响应，这个响应没有任何内容！？没有笑话，没有JSON格式的数据，什么都没有，这看起来不像我们基于API文档所期望的。发生这种情况是因为这个函数调用返回了一个对象，这个对象表示数据源返回给我们的内容，而不是实际的内容。这个对象叫做Promise—<em class="ls">Promise {&lt;pending&gt;}</em>，有以下参数:<em class="ls">[[Promise result]]:Response</em>和<em class="ls">[[Promise estate]]:"已履行"</em>；“已完成”表示响应成功。当出现问题时，会弹出一个<em class="ls">【拒绝】</em>状态来对抗<em class="ls">[[promise estate]]</em>，我稍后会演示。</p><h1 id="0af2" class="mv mq in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated"><strong class="ak">第二步。转换数据。</strong></h1><p id="b972" class="pw-post-body-paragraph kc kd in ke b kf nm jo kh ki nn jr kk kl no kn ko kp np kr ks kt nq kv kw kx ig bi translated">好吧，如果我们对这些数据无能为力，那还有什么意义呢？合理的解决方案是将这些数据转换成对我们有用的东西。在浏览器控制台中键入并运行以下代码:</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="ec4e" class="mp mq in ml b gy mr ms l mt mu">const init = {<br/>headers: {<br/>Accept: 'application/json',<br/>}}</span><span id="33d6" class="mp mq in ml b gy ns ms l mt mu">const result = fetch(resource, init)<br/>.then(function (res) {return console.log(res.json());})</span></pre><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nt"><img src="../Images/b6fb80b6b143847874eed1edffa8ce82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3y7KiVSg7VSTbTm4MN7_Qg.png"/></div></div></figure><p id="b1fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一旦我们从“fetch()”接收到这个响应对象，我们就对该对象调用“then()”方法，并将该对象作为参数传递给回调函数。在回调函数中，我们对对象做任何我们需要的事情，但是大多数时候我们使用内置的“json()”方法将它转换成JSON。然后我们返回JSON响应。我们还需要返回从响应中获取并转换成JSON的内容，以便在第二个“then()”方法中使用这些数据。总的来说，第一个“then()”方法的目的是在将内容转换成我需要的格式(在本例中是JSON格式)后，从原始响应中返回内容。</p><p id="1b3d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">看看这个返回的<em class="ls">Promise {&lt;pending&gt;}</em>对象，它有一个<em class="ls">[[Promise result]]:Object</em>，而不是一个<em class="ls"> "Response" </em>，就像在<strong class="ke io">步骤1 </strong>，<em class="ls">[[Promise estate]]:" fulfilled "</em>表示没有问题，更重要的是，它实际上显示了一个ID和一个笑话本身，取决于您从API得到的一个随机笑话，您的输出可能如下所示:</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="801b" class="mp mq in ml b gy mr ms l mt mu">id: “nOfNJY89EBd”<br/>joke: “Without geometry life is pointless.”<br/>status: 200</span></pre><p id="b9a8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">恭喜你。最初的响应被转换成JSON类型的对象，该对象具有API文档指出的属性，我们很好！</p><p id="dd46" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就像我之前承诺的，我们能模仿被拒绝的反应吗？编写下面的代码(-1代替init var头中的JSON或者任何你想刹车的东西)。如果这样做，它返回<em class="ls">【拒绝】</em>状态。</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="128f" class="mp mq in ml b gy mr ms l mt mu">const init = {<br/>headers: {<br/>Accept: 'application/-1',}}</span><span id="0b3c" class="mp mq in ml b gy ns ms l mt mu">const result = fetch(resource, init)<br/>.then(function (res) {return console.log(res.json());})</span></pre><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nu"><img src="../Images/4425afb9a06d823ba606c5220cbb1bd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ON1RpIx1HRmZgaPfrUWiNw.png"/></div></div></figure><h1 id="2132" class="mv mq in bd mw mx my mz na nb nc nd ne jt nf ju ng jw nh jx ni jz nj ka nk nl bi translated"><strong class="ak">第三步。做实际的事情。</strong></h1><p id="aa56" class="pw-post-body-paragraph kc kd in ke b kf nm jo kh ki nn jr kk kl no kn ko kp np kr ks kt nq kv kw kx ig bi translated">我们已经知道，第一个“then()”方法将response转换成JSON类型的对象，这应该允许我们进行一些操作。我们如何做到这一点？我们用第二种“then()”方法！我们接受参数中的JSON类型对象，并将其传递给第二个回调函数，在那里我们可以编写任何想要的东西来操作从API接收的数据。为了简单起见，让我们打印一个我们从这个公共API收到的随机笑话——为此，在第二个“then()”方法中编写console.log(data)。</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="5eb8" class="mp mq in ml b gy mr ms l mt mu">const result = fetch(resource, init)<br/>.then(function (res) {return res.json();})<br/>.then (function(data) {return console.log(data)})</span></pre><p id="6689" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据您收到的笑话，您的输出可能如下所示。有用！</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nv"><img src="../Images/230c644f71befbc6733db0e81d71d69c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRYjNs86EmfucFCDtrXUVA.png"/></div></div></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nw"><img src="../Images/e2210cd125e154f4e0f773d4a69df4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pQniCQSIuvCtm9nR"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@fightmorefilms?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Anthony Duran</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="563d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了使输出更具可读性，我们可以添加一个字符串“这是一个来自公共API的随机玩笑:“(这里是一个随机玩笑)。</p><pre class="kz la lb lc gt mk ml mm mn aw mo bi"><span id="ad36" class="mp mq in ml b gy mr ms l mt mu">const result = fetch(resource, init)<br/>.then(function (res) {return res.json();})<br/>.then (function(data) {return console.log("This is a random joke from public API: " + data.joke)})</span></pre><p id="9130" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你觉得这些信息有用，请随时关注我。希望你喜欢这个关于JavaScript中Fetch的简短指南，请保持关注！</p><p id="8851" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ls">更多内容尽在</em><a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ls">plain English . io</em></strong></a></p></div></div>    
</body>
</html>