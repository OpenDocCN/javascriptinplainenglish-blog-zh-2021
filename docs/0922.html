<html>
<head>
<title>Become a Better Tester using Cypress Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cypress请求成为更好的测试人员</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/become-a-better-tester-using-cypress-requests-80d104dd59d9?source=collection_archive---------4-----------------------#2021-02-26">https://javascript.plainenglish.io/become-a-better-tester-using-cypress-requests-80d104dd59d9?source=collection_archive---------4-----------------------#2021-02-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="7184" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用Cypress请求库进行API调用和API测试？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/b72726ff7b37cbb3892504aac93335f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*w7ctTfYwAJ35Jjgi"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@ptrikutam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pavan Trikutam</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d481" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您是否厌倦了在自动化框架之外维护一个用于API测试的Postman集合？</p><p id="36fe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我工作的公司使用Postman/Newman进行API测试，使用Cypress进行端到端测试。我们将手动导出Postman集合，然后将导出内容登记到项目存储库中。整个过程相当脆弱和麻烦，因为我们有两个API文档的位置:</p><ol class=""><li id="9b5e" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">邮递员赛跑者</li><li id="1c4c" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">项目存储库</li></ol><p id="2575" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为什么不整合工具并使用Cypress作为我们的端到端和API测试运行程序呢？</p><p id="0160" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">本教程将演示如何使用Cypress的内置请求库进行API调用，因此它可以作为传统API测试框架的替代品。不用维护两个独立的工具(如果算上Postman的Newman工具，就是三个)，您可以简单地维护您的Cypress实现。</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="18ba" class="mk ml in bd mm mn mo mp mq mr ms mt mu jt mv ju mw jw mx jx my jz mz ka na nb bi translated">入门指南</h1><p id="5996" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">对于任何新的JavaScript项目，我们必须使用NPM进行初始化。</p><pre class="kd ke kf kg gt nh ni nj nk aw nl bi"><span id="4cb7" class="nm ml in ni b gy nn no l np nq">npm init</span></pre><p id="8eb4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦我们有了一个<code class="fe nr ns nt ni b">package.json</code>文件，我们就可以开始加载Cypress。</p><pre class="kd ke kf kg gt nh ni nj nk aw nl bi"><span id="1640" class="nm ml in ni b gy nn no l np nq">npm install --save-dev cypress</span></pre><p id="43b5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一旦安装了Cypress，用NPM运行它，这样它就可以完成安装。</p><pre class="kd ke kf kg gt nh ni nj nk aw nl bi"><span id="4a87" class="nm ml in ni b gy nn no l np nq">npx cypress open</span></pre><p id="ab8e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当一个<code class="fe nr ns nt ni b">cypress</code>目录被创建后，Cypress就完成了安装。您还可以通过运行<code class="fe nr ns nt ni b">npx cypress --version</code>来验证安装是否正确。</p><h1 id="a363" class="mk ml in bd mm mn nu mp mq mr nv mt mu jt nw ju mw jw nx jx my jz ny ka na nb bi translated">进行API调用</h1><p id="855a" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">Cypress使用内置的请求库使API请求变得简单。<code class="fe nr ns nt ni b">request</code>方法采用以下参数的组合:</p><ul class=""><li id="ecae" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo nz lv lw lx bi translated">统一资源定位器</li><li id="043c" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">身体</li><li id="3305" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">方法</li><li id="62b7" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">附加选项</li></ul><p id="44aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这可以用下面的例子来说明:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">An API request for a DemoQA access token.</figcaption></figure><p id="5fb0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的函数使用方法、URL和主体对DemoQA授权令牌端点发出请求。请注意，我们没有对<code class="fe nr ns nt ni b">response</code>执行任何操作。</p><p id="287d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">默认情况下，<code class="fe nr ns nt ni b">cy.request</code>将返回一个<code class="fe nr ns nt ni b">response</code>对象，不管请求是否成功。响应对象可以包含以下元素:</p><ul class=""><li id="1d51" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo nz lv lw lx bi translated">身体</li><li id="446f" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">状态</li><li id="eb48" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">头球</li><li id="aa99" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo nz lv lw lx bi translated">持续时间</li></ul><p id="9831" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了对请求响应采取行动，我们必须包含一个回调函数来捕获响应，然后对对象做一些事情。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">An API request with a log for response status.</figcaption></figure><p id="ce7d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们现在已经实现了响应状态日志。这将在执行时显示在Cypress测试运行程序中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2103d7da6fe48111e6e71c46a2004b48.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*mPZuhPZuqsoKAWEad7tQVg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">A passing API request with logged response status.</figcaption></figure><h1 id="f23c" class="mk ml in bd mm mn nu mp mq mr nv mt mu jt nw ju mw jw nx jx my jz ny ka na nb bi translated">编写测试</h1><p id="0658" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">我们可以采用上面的请求方法，开始编写API测试。首先，我们将添加一个简单的检查，检查响应状态是否等于200 OK。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Sample API test with an expected response.</figcaption></figure><p id="49ae" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们现在向授权令牌端点发出请求，并捕获响应。然后在<code class="fe nr ns nt ni b">expect</code>块中使用该响应来声明响应对象的状态为200 OK。</p><p id="9973" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">断言反对响应状态是一个好的开始，但是，我们可以通过确保响应体返回我们所期望的来强化我们的测试。我们可以通过添加<code class="fe nr ns nt ni b">console.log($response.body);</code>并在运行时检查开发工具控制台来检查响应体是什么样子的。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi od"><img src="../Images/9f493f6b2b9d8d0743b7fb1342a4964f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pNNYOKtW2xsxU3wlPK7ZkQ.png"/></div></div></figure><p id="a2ea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以看到响应对象包含令牌、状态、结果和过期密钥。我们可以使用这些来做出额外的断言，从而强化我们的测试用例。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Our finished test after assertion hardening.</figcaption></figure><p id="4a1b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您还可以从响应对象中创建别名，例如<code class="fe nr ns nt ni b">response.body.token</code>的别名，在其他API测试中用作授权头。这最好在before块中完成，因为别名在每次测试后都会被垃圾收集，以避免冲突。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">API test using an alias for authorization header.</figcaption></figure><p id="7f78" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面演示了如何使用身份验证命令作为别名。我们的<code class="fe nr ns nt ni b">authenticate</code>命令返回一个响应令牌，该令牌作为别名保存在赛普拉斯的事件循环中。我们在测试中获取别名的值，然后提供别名作为授权头。这允许我们对像上面这样从DemoQA书店应用程序中获取书籍的受保护端点采取行动。</p><h1 id="a4a4" class="mk ml in bd mm mn nu mp mq mr nv mt mu jt nw ju mw jw nx jx my jz ny ka na nb bi translated">摘要</h1><p id="f107" class="pw-post-body-paragraph kt ku in kv b kw nc jo ky kz nd jr lb lc ne le lf lg nf li lj lk ng lm ln lo ig bi translated">使用Cypress作为API测试运行程序既快速又高效。赛普拉斯不仅仅是一个端到端的解决方案，它还可以取代传统的API测试工具，比如邮差/Newman。这使得您的团队花在维护独立工具上的时间更少，花在最重要的事情上的时间更多:应用程序质量。</p><h1 id="02de" class="mk ml in bd mm mn nu mp mq mr nv mt mu jt nw ju mw jw nx jx my jz ny ka na nb bi translated">资源</h1><ol class=""><li id="e526" class="lp lq in kv b kw nc kz nd lc oe lg of lk og lo lu lv lw lx bi translated">“请求。”<em class="oh">柏树文档</em>，2021年2月25日，<a class="ae ks" href="http://docs.cypress.io/api/commands/request.html#Syntax" rel="noopener ugc nofollow" target="_blank">docs.cypress.io/api/commands/request.html#Syntax</a>。</li><li id="50dc" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">"变量和别名."<em class="oh"> Cypress Documentation </em>，2021年2月25日，<a class="ae ks" href="http://docs.cypress.io/guides/core-concepts/variables-and-aliases.html#Return-Values" rel="noopener ugc nofollow" target="_blank">docs . Cypress . io/guides/core-concepts/variables-and-alias . html # Return-Values</a>。</li></ol></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><p id="8ff9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> Jonathan Thompson </strong>是Pendo.io的高级质量工程师，专注于测试自动化。他目前居住在北卡罗来纳州的罗利，与他的妻子和一个名叫温斯顿的戈德多德尔(Goldendoodle)住在一起。您可以通过<a class="ae ks" href="https://www.linkedin.com/in/jonathanmnthompson/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>与他联系，也可以通过<a class="ae ks" href="https://twitter.com/jacks_elsewhere" rel="noopener ugc nofollow" target="_blank"> Twitter </a>或<a class="ae ks" href="http://github.com/ThompsonJonM" rel="noopener ugc nofollow" target="_blank"> Github </a>关注他。</p></div></div>    
</body>
</html>