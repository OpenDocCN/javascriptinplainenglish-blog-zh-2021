<html>
<head>
<title>My First Integration Test in a Redux Hooked App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我在Redux Hooked应用中的第一次集成测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/my-first-integration-test-in-a-redux-hooked-app-3b189addd46e?source=collection_archive---------19-----------------------#2021-07-20">https://javascript.plainenglish.io/my-first-integration-test-in-a-redux-hooked-app-3b189addd46e?source=collection_archive---------19-----------------------#2021-07-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c24d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">因为我不喜欢嘲笑，所以我用了这个应用的真实商店</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/c162f83a80c2334390d1d6029816ef10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ki2LBKlOdlVdi2mWCWqWA.jpeg"/></div></div></figure><p id="a60b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi ln translated">各位，你们今天过得怎么样？这是我关于轻松测试React应用<a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/testing-a-local-react-npm-package-with-ease-7d0668676ddb">和愉悦测试</a><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/looking-forward-to-testing-react-components-with-joy-5bb3f86c21d7">系列的另一篇文章。记住，轻松愉快地编写代码的秘诀是一步一步来。</a></p><p id="3cfb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在安装和设置Enzyme与Jest在<code class="fe lx ly lz ma b"><a class="ae lw" href="https://github.com/programarivm/redux-chess" rel="noopener ugc nofollow" target="_blank">redux-chess</a></code>一起工作后，接下来要做的是对应用程序的真实商店进行一些首次集成测试，而不是模仿它。</p><p id="93db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目标是模拟和自动化用户如何与UI交互，因此这篇文章的标题是关于集成测试的。</p><blockquote class="mb"><p id="f847" class="mc md iq bd me mf mg mh mi mj mk lm dk translated">使用Redux，应用程序的整个状态都保存在商店中，商店与应用程序的其他部分保持分离。</p></blockquote><p id="4380" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">由于我有一些为真实数据库编写集成测试的经验，我认为测试真实的Redux存储也是有意义的。我能想到的最简单的用例包括一个常规的同步动作，如下图所示，符合<a class="ae lw" href="https://redux.js.org/tutorials/fundamentals/part-2-concepts-data-flow#redux-application-data-flow" rel="noopener ugc nofollow" target="_blank"> Redux docs </a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/c6f4365f00f922faf01d74202c302e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yYkitaR24SuFNXYyTxL1xA.gif"/></div></div></figure><p id="2ce8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">翻转棋盘是一个很好的例子，展示了同步应用程序数据流如何在Redux中工作。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/f48a9a11138a9426084747ad47538530.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4JMhzijRuAFMopXVIWzCNQ.gif"/></div></div></figure><p id="00b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从上面的GIF中可以看到，当用户从<strong class="kt ir">邀请好友</strong>菜单中选择<strong class="kt ir">翻板</strong>选项时，<code class="fe lx ly lz ma b">flip</code>在<code class="fe lx ly lz ma b">board</code>减速器中从<code class="fe lx ly lz ma b">w</code>设置为<code class="fe lx ly lz ma b">b</code>。然后棋盘(React术语中的UI组件)检查状态中是否有任何变化，并相应地进行渲染。</p></div><div class="ab cl ms mt hu mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ij ik il im in"><p id="96aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">事情是这样的，我想出了一个基于<a class="ae lw" href="https://github.com/testing-library/react-hooks-testing-library" rel="noopener ugc nofollow" target="_blank">testing-library/React-Hooks-testing-library</a>的变通办法，以克服用Jest测试<a class="ae lw" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React Hooks </a>的恼人问题。</p><blockquote class="mb"><p id="dca4" class="mc md iq bd me mf mg mh mi mj mk lm dk translated">不变违例:钩子只能在函数组件的主体内部被调用。</p></blockquote><p id="1ee1" class="pw-post-body-paragraph kr ks iq kt b ku ml jr kw kx mm ju kz la mn lc ld le mo lg lh li mp lk ll lm ij bi translated">解决方法是编写一个<code class="fe lx ly lz ma b">SyncDispatcher</code>钩子，允许在Jest测试中将sync Redux动作分派给真实的商店。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="6386" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">说到这里，翻板的用例用Jest和Enzyme翻译成下面的测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8eaf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">重要的是要注意，这个定制钩子必须被呈现，以便按预期工作。</p><pre class="kg kh ki kj gt nb ma nc nd aw ne bi"><span id="a77f" class="nf ng iq ma b gy nh ni l nj nk">const action = { type: boardActionTypes.FLIP };</span><span id="6881" class="nf ng iq ma b gy nl ni l nj nk">const { result } = renderHook(() =&gt; SyncDispatcher(action), { wrapper });</span></pre><p id="c7cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这样，就很容易自动化多个简单的基于浏览器的任务，比如打开<strong class="kt ir">邀请朋友</strong>对话框，如下图所示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/c0a5ed7c14c14c2df7a7ba35c0b18958.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HERNkjJpJ8BhBBSdFyrIig.gif"/></div></div></figure><p id="607b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将<code class="fe lx ly lz ma b">createInvitationDialog</code>减速器中的<code class="fe lx ly lz ma b">open</code>设置为<code class="fe lx ly lz ma b">true</code>，并转化为以下测试。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8299" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">下面是整个<code class="fe lx ly lz ma b"><a class="ae lw" href="https://github.com/programarivm/redux-chess/blob/master/src/__tests__/components/Chess.test.js" rel="noopener ugc nofollow" target="_blank">src/__tests__/components/Chess.test.js</a></code>文件目前的样子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="8d39" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">简而言之，这种测试方案允许在Jest测试中向真实存储分派同步操作，而不是模仿，同时在Enzyme的帮助下检查React组件中的相应变化。</p><div class="nm nn gp gr no np"><a rel="noopener  ugc nofollow" target="_blank" href="/looking-forward-to-testing-react-components-with-joy-5bb3f86c21d7"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ir gy z fp nu fr fs nv fu fw ip bi translated">愉快地测试反应元件</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">快乐来自于意识到我正在放松</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od kp np"/></div></div></a></div><h2 id="ce8c" class="nf ng iq bd oe of og dn oh oi oj dp ok la ol om on le oo op oq li or os ot ou bi translated">您可能还对以下内容感兴趣:</h2><ul class=""><li id="9bf3" class="ov ow iq kt b ku ox kx oy la oz le pa li pb lm pc pd pe pf bi translated"><a class="ae lw" href="https://medium.com/geekculture/adding-classes-to-a-solid-codebase-without-breaking-anything-else-99e6c5a5f3e4" rel="noopener">在不破坏其他任何东西的情况下，将类添加到坚实的代码库中</a></li><li id="004b" class="ov ow iq kt b ku pg kx ph la pi le pj li pk lm pc pd pe pf bi translated"><a class="ae lw" href="https://medium.com/geekculture/a-react-chessboard-with-redux-and-hooks-in-few-lines-6009cb724bb" rel="noopener">一个反作用棋盘，棋盘上有几行圈圈和钩子</a></li><li id="ea0e" class="ov ow iq kt b ku pg kx ph la pi le pj li pk lm pc pd pe pf bi translated"><a class="ae lw" href="https://programarivm.medium.com/testing-a-local-react-npm-package-with-ease-7d0668676ddb" rel="noopener">轻松测试本地React Npm包</a></li><li id="e90d" class="ov ow iq kt b ku pg kx ph la pi le pj li pk lm pc pd pe pf bi translated"><a class="ae lw" href="https://medium.com/geekculture/tdding-a-react-app-with-jest-the-easy-way-8ddb64aeaba6" rel="noopener">t用Jest最简单的方式添加React应用</a></li></ul><p id="735a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="pl">更多内容看</em> <a class="ae lw" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> <em class="pl">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>