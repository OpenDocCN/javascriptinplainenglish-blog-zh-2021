<html>
<head>
<title>How to Dockerize a Node.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何停靠Node.js应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/dockerize-a-node-js-application-fdc8e2994e16?source=collection_archive---------4-----------------------#2021-03-29">https://javascript.plainenglish.io/dockerize-a-node-js-application-fdc8e2994e16?source=collection_archive---------4-----------------------#2021-03-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/0e9ae0831b6ae86cfaf6f12c64c2de34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*4KhmpXFJ_Etczs6awRnAbg.png"/></div></figure><p id="f01a" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">Docker使我们能够避免“它在我的机器上工作”的漏洞。它将我们的应用程序打包成一个盒子，或者换句话说，一个容器。您可以很容易地在任何机器上运行这个容器，其中的内容，即环境保持不变。</p><p id="0d10" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">本初学者指南旨在帮助您构建和部署一个简单的Node.js应用程序映像。本指南还假设您对node和express框架有一些基本的了解。你还需要在你的机器上安装docker。</p></div><div class="ab cl kp kq hr kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ig ih ii ij ik"><h1 id="0958" class="kw kx in bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">使用Express创建节点应用程序</h1><p id="ed09" class="pw-post-body-paragraph jr js in jt b ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko ig bi translated">要创建节点应用程序，请运行以下命令</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a74d" class="mi kx in me b gy mj mk l ml mm">npm init</span></pre><p id="6d68" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">上面的命令将指导您设置节点应用程序。对于初学者，你可以选择每次选择后按回车键进行默认设置。您也可以选择将入口点设为index.js或app.js。入口点是您的应用程序将开始的地方。</p><p id="3e29" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">一旦一切都完成了，您的package.json应该看起来像这样。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0030" class="mi kx in me b gy mj mk l ml mm">{<br/>  "name": "my-app",<br/>  "version": "1.0.0",<br/>  "description": "",<br/>  "main": "app.js",<br/>  "scripts": {<br/>    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1"<br/>  },<br/>  "author": "",<br/>  "license": "ISC"<br/>}</span></pre><p id="1878" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">通过运行以下命令安装Express:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8483" class="mi kx in me b gy mj mk l ml mm">npm install express --save</span></pre><p id="2ac5" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在根目录中创建您的app.js或index.js文件，然后粘贴下面的代码。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="c889" class="mi kx in me b gy mj mk l ml mm">const <strong class="me io"><em class="mn">express </em></strong>= require('express')<br/>const app = <strong class="me io"><em class="mn">express</em></strong>()<br/>const port = 3000<br/><br/>app.get('/', (req, res) =&gt; {<br/>    res.send('Hello World!')<br/>})<br/><br/>app.listen(port, () =&gt; {<br/>    <strong class="me io"><em class="mn">console</em></strong>.log(`Example app listening at http://localhost:${port}`)<br/>})</span></pre><p id="4ec2" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">第一部分声明了一个包含express模块的常量变量。该应用程序将在端口3000上运行。还定义了一条基本路由，该路由将以“Hello World”作为响应。最后，最后一部分将在端口3000启动服务器。</p><p id="6d69" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">您可以通过运行以下命令来测试您的应用程序:</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="d448" class="mi kx in me b gy mj mk l ml mm">node app.js</span></pre><h1 id="23fb" class="kw kx in bd ky kz mo lb lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt bi translated">创建docker图像</h1><p id="0257" class="pw-post-body-paragraph jr js in jt b ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko ig bi translated">要创建docker图像，您需要一个docker文件。docker文件将包含关于如何设置您的图像的信息，以及您的应用程序的细节和它将如何运行。这包括您的应用程序本身、环境以及配置细节等</p><p id="03e8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在根目录下创建一个名为Dockerfile的文件。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3b2b" class="mi kx in me b gy mj mk l ml mm">touch Dockerfile</span></pre><p id="74dc" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">用你最喜欢的文本编辑器打开文件。添加下面的代码。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="43ca" class="mi kx in me b gy mj mk l ml mm">FROM node:14<br/><br/>RUN mkdir -p /app<br/><br/>WORKDIR /app<br/><br/>COPY package*.json ./<br/><br/>RUN npm install<br/><br/>COPY app.js .<br/><br/>EXPOSE 8080<br/><br/>CMD [ "node", "app.js" ]</span></pre><ol class=""><li id="fdf0" class="mt mu in jt b ju jv jy jz kc mv kg mw kk mx ko my mz na nb bi translated">来自:我们将要构建的图像。</li><li id="e504" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">运行mkdir:创建一个目录来保存我们的应用程序代码。</li><li id="e2c9" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">工作目录:设置工作目录</li><li id="2750" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">复制:将我们的package.json和package-lock.json文件复制到我们的目录中。</li><li id="1f73" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">运行:安装我们的应用程序依赖项</li><li id="35d7" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">复制:复制应用程序文件。</li><li id="cbdd" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">EXPOSE:您的应用程序绑定到这里初始化的端口。</li><li id="da45" class="mt mu in jt b ju nc jy nd kc ne kg nf kk ng ko my mz na nb bi translated">CMD:用于启动应用程序的命令。</li></ol><h1 id="f902" class="kw kx in bd ky kz mo lb lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt bi translated">建立形象</h1><p id="0f42" class="pw-post-body-paragraph jr js in jt b ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko ig bi translated">下面的命令将构建我们的docker映像。额外的-t标志用于标记您的图像，有点像命名您的图像。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="6177" class="mi kx in me b gy mj mk l ml mm">docker build -t node-docker-app .</span></pre><p id="ac25" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">确保您位于包含docker文件的目录中。您将看到一堆命令在您的cli上运行。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="0f7a" class="mi kx in me b gy mj mk l ml mm">Sending build context to Docker daemon  2.006MB<br/>Step 1/8 : FROM node:14<br/> ---&gt; 67f79f1b32a3<br/>Step 2/8 : COPY package*.json ./<br/> ---&gt; Using cache<br/> ---&gt; de0f1d3680b9<br/>Step 3/8 : RUN mkdir -p /app</span><span id="d835" class="mi kx in me b gy nh mk l ml mm"><br/>....</span><span id="14a0" class="mi kx in me b gy nh mk l ml mm">Step 7/8 : EXPOSE 8080<br/> ---&gt; Using cache<br/> ---&gt; 0b0a873879d0<br/>Step 8/8 : CMD [ "node", "app.js" ]<br/> ---&gt; Running in dc153dd3b2d5<br/>Removing intermediate container dc153dd3b2d5<br/> ---&gt; a4bf20c4bb2d<br/>Successfully built a4bf20c4bb2d<br/>Successfully tagged node-docker-app:latest<br/></span></pre><p id="f68d" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">检查您的映像是否构建成功。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="a0ca" class="mi kx in me b gy mj mk l ml mm">docker images</span></pre><p id="fd0e" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">你应该看看你的形象</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="2df3" class="mi kx in me b gy mj mk l ml mm">REPOSITORY                        TAG                 IMAGE ID            CREATED             SIZE<br/>node-docker-app                          latest              0b700b0d0fc7        4 minutes ago       945MB</span></pre><p id="3b01" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">现在用下面的命令运行您的映像。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="df0b" class="mi kx in me b gy mj mk l ml mm">docker run -p 8081:8080 node-docker-app:latest</span><span id="16bb" class="mi kx in me b gy nh mk l ml mm">Example app listening at http://localhost:8080</span></pre><p id="c92c" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">p标志告诉我们的映像在端口8081上公开运行(在我们的映像之外),它类似于内部端口8080。</p><p id="8ca8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">在您的浏览器中，导航到可公开访问的端口8081。您应该会看到页面上印着“Hello World”。</p><p id="8a5f" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">就是这样！</p></div></div>    
</body>
</html>