# 当用户用 React 滚动离开时隐藏弹出窗口

> 原文：<https://javascript.plainenglish.io/hide-popups-when-the-user-scrolls-away-with-react-69c043a412fb?source=collection_archive---------1----------------------->

如何编写一个自定义钩子来确保粘性弹出窗口不会破坏 React 应用程序中的 UX。

![](img/662411a1e7ed75bed0bb8041cfa49b94.png)

Photo by [Paul Esch-Laurent](https://unsplash.com/@pinjasaur?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

首先，困扰我们的场景是:

比方说，在你的应用程序中，当你点击一个用户时，会有一个弹出窗口打开。在弹出窗口中，您可以显示该用户的一些基本信息。除了这个配置文件预览弹出窗口，您可能有一些下拉菜单，用户可以从中编辑或删除一些项目。可能性是无限的，我们在应用程序的许多用例中使用弹出窗口。

然而，当弹出窗口打开时，用户点击离开或开始滚动会发生什么呢？我们希望弹出窗口消失——否则，他们最终会看到一个幽灵弹出窗口，不会从应用程序的视窗中消失(除非他们专门点击了弹出窗口的 X 按钮)。你加了个 X 按钮吧？).

解决这个问题需要 3 个步骤。

1.  我们希望识别发生滚动的元素(简单地说，就是当你在应用程序中的页面上滚动时滚动条移动的元素的 ID)。
2.  我们希望向该元素添加一个侦听器，它将依次调用我们定义的函数——当然，在这个函数中，我们将隐藏任何需要隐藏的内容。
3.  我们还想为 clicking away 动作添加一个侦听器——如果用户在弹出窗口之外单击，它应该会关闭。

## 在父元素的滚动事件上设置动作

在下面的代码片段中，我将向您展示如何实现用可滚动元素的 ID 调用的钩子，以及每当检测到滚动事件时应该调用的函数。

当然，您可以使用这个钩子来收听您感兴趣的任何其他事件。

在`useEffect` cleanup 函数中，我们删除了事件监听器，这样它的幽灵就不会再纠缠我们了。

现在，让我们假设根组件——在我们的例子中是可滚动容器——位于组件树的根，看起来像这样:

因此，每当屏幕上出现一个弹出窗口时，我们又对在 id 为`INFINITE_SCROLL_ID`的元素上设置一个监听器感兴趣。当然，这个弹出窗口必须能够自行关闭。

## 使用弹出式菜单中的挂钩

在`Popup`组件中，我们将根据需要使用钩子:

当`isPopupOpen`属性被检测为真时，`handleScroll`回调将被重新创建。我们需要将属性传递给依赖数组的原因是，否则回调就不会被正确创建。尽管已经将一个真值传递给了这个子组件，但是它将被创建并把`isPopupOpen`设置为假。

按照同样的逻辑，你可以回到`useOnScrollEffect`钩子，你会注意到`fun`变量也被传递到依赖数组中——这是因为`handleScroll`回调发生了变化，所以它检测到了`isPopupOpen`属性的正确值。

为什么我们需要传入这些依赖数组？从纯粹的“它工作，离开它”的角度来看，没有依赖数组也很好。然而，您会注意到，如果没有`if (props.isPopupOpen)`检查，那么`closePopup`调用将会被无用地调用数百次。您可以通过在`handleScroll`回调函数体中传递一个`console.log(“onscroll")`来验证这一点。我向下滚动了 2 到 3 次，日志被触发了 400 多次。想象一下，我们是如何徒劳地将一个真值设置为 true 几百次。

## 在弹出窗口外单击

为了处理“click away”事件，我们将使用 MaterialUI 中的一个组件: [ClickAwayListener](https://mui.com/api/click-away-listener/) 。

我们将修改我们的弹出窗口，使其内容包装在这个组件中。

因此，当在我们的弹出窗口之外检测到任何点击时，它将表现良好，并会自动关闭。我们还可以调整`ClickAwayListener`,让它识别其他事件，而不仅仅是点击弹出窗口之外。组件上有一个`mouseEffect` prop，它根据您的需要接受以下值:

```
‘onClick’
‘onMouseDown’
‘onMouseUp’
```

但是，对于当前的目的，默认行为就足够了。您会注意到，当您开始滚动页面或在页面外单击时，弹出窗口会关闭。

希望文章对你有所帮助。我们都希望我们的应用程序中的 UX 尽可能好，所以我们也需要考虑这样的边缘情况。

非常感谢你的阅读！

*更多内容请看*[***plain English . io***](http://plainenglish.io)