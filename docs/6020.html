<html>
<head>
<title>Create Industry-Standard Logger for Node.js Using Pino</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pino为Node.js创建行业标准记录器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-industry-standard-logger-for-node-js-using-pino-4819d6b22bc3?source=collection_archive---------1-----------------------#2021-12-25">https://javascript.plainenglish.io/create-industry-standard-logger-for-node-js-using-pino-4819d6b22bc3?source=collection_archive---------1-----------------------#2021-12-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6ba2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Pino为Node.js创建行业标准记录器的指南。</h2></div><p id="cbe6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将介绍Pino库的使用。Pino是一个行业标准的日志库，可以帮助您以更有意义的格式打印日志。这些日志可以包含与您的单个日志相关联的多个其他选项。这些信息包括但不限于:</p><ul class=""><li id="036b" class="ky kz in ke b kf kg ki kj kl la kp lb kt lc kx ld le lf lg bi translated">HTTP请求信息包括方法类型和查询参数</li><li id="6be3" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">当前登录的用户</li><li id="7013" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">数据库错误和服务器时间戳</li><li id="1958" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">原始错误消息类型和附加信息</li><li id="eb71" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">日志严重性</li></ul><p id="f268" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">遵循这些步骤并实现这个库可以删除不太强大的<code class="fe lm ln lo lp b">console.log()</code>(但不是无能为力的)。通过这种设置，可以更容易地调试包含更多附加信息的日志，还可以与Prometheus和Grafana一起使用，它们都是服务器监控工具。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/b1cd2e58bb6572d82b6b625ae596da59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YXl58A27Gvs3gZ7b"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Photo by <a class="ae mg" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fotis Fotopoulos</a> on <a class="ae mg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2d51" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们通过Pino提供的最简单的日志来看看它的效用。日志属于以下类型:</p><ul class=""><li id="748f" class="ky kz in ke b kf kg ki kj kl la kp lb kt lc kx ld le lf lg bi translated">找到；查出</li><li id="956b" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">调试</li><li id="e59e" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">信息</li><li id="7ece" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">警告</li><li id="36da" class="ky kz in ke b kf lh ki li kl lj kp lk kt ll kx ld le lf lg bi translated">错误</li></ul><p id="946c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">执行以下步骤的代码片段:</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="acce" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述代码将导致:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/8ebdb8e1256630b46c16032812127907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*tMp-V3zWpguQVOqrQxsAag.png"/></div></figure><p id="4b96" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">深入研究Pino，让我们假设我们需要一个控制台日志语句，详细信息如下:</p><blockquote class="mk ml mm"><p id="3f99" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">JSON格式</p><p id="5510" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">Http请求方法、主体、查询、参数</p><p id="f995" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">当前登录的用户详细信息</p><p id="c4ca" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">服务器时间戳和IP地址</p><p id="abfa" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">产生错误的函数名</p><p id="7690" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">行号</p><p id="7c8c" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">日志级别</p><p id="a2b1" class="kc kd mn ke b kf kg jo kh ki kj jr kk mo km kn ko mp kq kr ks mq ku kv kw kx ig bi translated">错误详细信息</p></blockquote><p id="0667" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了构建该功能，我们需要通过使用Pino来扩展其用途并创建一个定制的记录器。创造一个”。js "文件logger.js，内容如下:</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="06da" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我广泛地使用了文件中的注释，所以我将把它留给您个人使用、理解和实现。上面的注释提供了从代码角度来看你需要的所有信息。我构建的要打印的json并不局限于上面的实现。您可以删除您个人不需要的不必要的值。</p><p id="4a1a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了使用上面的日志记录器，让我们更新我们的主文件，从这里我们可以看到实际的日志记录。</p><figure class="lr ls lt lu gt lv"><div class="bz fp l di"><div class="mh mi l"/></div></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mr"><img src="../Images/649a5cb5db03d23ff06dc0b6caf3733d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cJUI4bUxJAyy1bVXVKoUsQ.png"/></div></div></figure><p id="539a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打印的日志是JSON格式的，可以在任何JSON查看器上在线查看(暂时)。在观看时，它给出以下视觉效果:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/f28fe0279e46d32100ef86f08ca17bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*BA1f4ocnzwwCHWybTmbbuA.png"/></div></figure><p id="edb3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为我没有使用全局变量，所以req对象是空的，它没有打印HTTP、服务器和用户信息。这可以根据项目需要进行更新。为了美化日志，你可以使用pino-pretty库。但是这种方法的缺点是它停止以JSON格式打印日志。设置pino-pretty只需用以下配置初始化日志:</p><pre class="lr ls lt lu gt mt lp mu mv aw mw bi"><span id="6cbd" class="mx my in lp b gy mz na l nb nc">const log = pino({</span><span id="7a26" class="mx my in lp b gy nd na l nb nc">    transport: {</span><span id="be5f" class="mx my in lp b gy nd na l nb nc">      target: 'pino-pretty',</span><span id="8f69" class="mx my in lp b gy nd na l nb nc">      options: {</span><span id="61e8" class="mx my in lp b gy nd na l nb nc">        colorize: true,</span><span id="14bb" class="mx my in lp b gy nd na l nb nc">      },</span><span id="d189" class="mx my in lp b gy nd na l nb nc">   },</span><span id="574d" class="mx my in lp b gy nd na l nb nc">});</span></pre><p id="7e36" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一个设置基本日志机制的示例，可以根据您的项目需求进行修改。要了解实际生产应用程序日志的外观，请参见下图:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ne"><img src="../Images/cb1389f9802ded2d2b5a401d41a39e63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDq22Lf0eQFUR331SQ-xnw.png"/></div></div></figure><p id="2d0c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">重要的是您对Pino初始化对象使用的配置。当您在多个环境中运行应用程序时，比如开发/登台/生产，您还可以有一个场景，您希望在开发中使用pino-pretty，在生产中使用JSON日志。这也取决于配置对象，在配置对象中可以有一个测试子句来检查节点环境，然后应用适当的过滤器。为了使这篇文章简明扼要，我就讲到这里。此外，您可以在此处找到文章代码库:</p><div class="nf ng gp gr nh ni"><a href="https://github.com/akshay271703/node-pino-logger" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">GitHub-akshay 271703/node-Pino-logger</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw ma ni"/></div></div></a></div><p id="d8e1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">其他有用的链接:</p><p id="ac82" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">皮诺</p><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/pino" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">皮诺</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">开销非常低的Node.js记录器。$ npm安装pino如果您想安装pino v6，请参阅…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw ma ni"/></div></div></a></div><p id="c9d6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">皮诺-漂亮</p><div class="nf ng gp gr nh ni"><a href="https://www.npmjs.com/package/pino-pretty" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd io gy z fp nn fr fs no fu fw im bi translated">皮诺-漂亮</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">这个模块提供了一个基本的ndjson格式化程序。如果传入的行看起来像是来自ndjson的日志行…</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">www.npmjs.com</p></div></div><div class="nr l"><div class="ny l nt nu nv nr nw ma ni"/></div></div></a></div><p id="ebef" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你知道了。感谢您的阅读。</p><p id="ccd4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mn">更多内容看</em> <a class="ae mg" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">说白了。报名参加我们的</em> </a><a class="ae mg" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mn">免费每周简讯</em> </a> <em class="mn">。在我们的</em> <a class="ae mg" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mn">社区</em> </a> <em class="mn">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>