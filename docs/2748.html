<html>
<head>
<title>Implement Your Own User Authentication System in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中实现您自己的用户认证系统</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/implement-your-own-user-authentication-system-in-nodejs-866078a08584?source=collection_archive---------8-----------------------#2021-06-05">https://javascript.plainenglish.io/implement-your-own-user-authentication-system-in-nodejs-866078a08584?source=collection_archive---------8-----------------------#2021-06-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="12b6" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">简单易懂的教程</h2><div class=""/><div class=""><h2 id="3539" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">包括—用户注册、登录、激活、身份验证、注销、忘记密码和重置密码服务</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/7307905b9a04241b6cb0996da094371e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eBhvMUDys8mYWNUf"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Franck</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="32d2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以…有人在Awais的YouTube视频中给我加了标签，这促使我写了这篇用户认证教程(见下文)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/02c327c817d84384abfe7e0de5a99ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*zFwQz4c3UlSiO_IX-rKWlg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Screenshot by Author</figcaption></figure><p id="e3b3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当我试图为我自己的全栈MERN应用程序设置认证系统时，我引用了Awais的这个YouTube视频，我强烈推荐观看他的视频<a class="ae le" href="https://www.youtube.com/watch?v=CEim3tZsp1Y" rel="noopener ugc nofollow" target="_blank">这里</a>:)但是如果你真的没有时间，请随意浏览这个教程并使用<a class="ae le" href="https://github.com/Reine0017/NodeAuthentication" rel="noopener ugc nofollow" target="_blank">这个</a>公共GitHub repo。ʕ•́ᴥ•̀ʔっ♡</p><p id="6006" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我自己实现整个用户认证流程的原因主要是因为我想更好地了解幕后发生的事情。如果你不确定是应该自己实现还是使用第三方服务(比如<a class="ae le" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank"> Auth0 </a>或<a class="ae le" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase </a>，你可能想看看Ben Awad的<a class="ae le" href="https://www.youtube.com/watch?v=Hh_kiZTTBr0" rel="noopener ugc nofollow" target="_blank"> YouTube视频</a>。</p><p id="3b73" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> <em class="mc">注:</em> </strong> <em class="mc">我从Awais那里了解并参考了以下内容——请查看他的</em> <a class="ae le" href="https://www.youtube.com/c/AwaisMirza1/videos" rel="noopener ugc nofollow" target="_blank"> <em class="mc">视频</em> </a> <em class="mc">:)此外，我对他的版本做了一些修改，所以这里的代码和他的视频看起来可能有点不同。</em></p><p id="9a1c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我使用MongoDB Atlas作为我的云数据库，使用Sendgrid作为我的电子邮件发送服务。在Awais的YouTube教程中，他使用了其他东西，所以你可以选择你更喜欢的东西。</p><p id="5086" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">事不宜迟，我们开始吧~</p><h1 id="2439" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">总体想法是:</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mv"><img src="../Images/1958376dcab4f738041bbb113054c042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rlonPPwP-LGaCc1ryHJfhQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Diagram made by Author</figcaption></figure><p id="5c9b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将建设的路线有:</p><ul class=""><li id="57b7" class="mw mx iq lh b li lj ll lm lo my ls mz lw na ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/register</code></li><li id="fd2f" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/activate</code></li><li id="5bed" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/login</code></li><li id="73c0" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/authenticate</code></li><li id="bc6a" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/logout</code></li><li id="2e89" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/forgotpassword</code></li><li id="adff" class="mw mx iq lh b li nj ll nk lo nl ls nm lw nn ma nb nc nd ne bi translated"><code class="fe nf ng nh ni b">/resetpassword</code></li></ul><h1 id="964a" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">该设置</h1><p id="3166" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">前往<a class="ae le" href="https://sendgrid.com/" rel="noopener ugc nofollow" target="_blank"> SendGrid </a>和<a class="ae le" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>创建你的账户，并按照他们的指导进行设置。但是基本上你想要的只是API密匙。一旦你有了这些，把它们放在一个(秘密的)文件中——我把我的命名为<a class="ae le" href="https://github.com/Reine0017/NodeAuthentication/commit/b02599195f0787eaecf30ff0f6a0d184d99e2f23" rel="noopener ugc nofollow" target="_blank"> config.js </a>。</p><p id="da07" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们要安装相关的npm包。您可以阅读这篇文章，了解更多关于设置NodeJS环境的信息。运行<code class="fe nf ng nh ni b">npm init</code>和<code class="fe nf ng nh ni b">npm install express</code>之后，我们将需要<a class="ae le" href="https://github.com/Reine0017/mini-tutorials/commit/be640ecdc89bf749f60fed7707d38fad95b96704" rel="noopener ugc nofollow" target="_blank">安装其他相关的包</a>。</p><h1 id="a489" class="md me iq bd mf mg mh mi mj mk ml mm mn kf mo kg mp ki mq kj mr kl ms km mt mu bi translated">写文件</h1><p id="2c50" class="pw-post-body-paragraph lf lg iq lh b li no ka lk ll np kd ln lo nq lq lr ls nr lu lv lw ns ly lz ma ij bi translated">接下来，我们将编写我们的<a class="ae le" href="https://github.com/Reine0017/NodeAuthentication/commit/71e21ebce01235868957d6dbd1dc2b4b7dcb8aca" rel="noopener ugc nofollow" target="_blank"> server.js </a>文件。这个文件有点像“主文件”，在这里你可以编写不同的服务(例如，在这种情况下是userService)，然后指定你必须调用什么API端点路由来“到达”服务(userService)。在这种情况下，如第22行所示，我们必须调用“&lt; URL &gt; /api/users”来“到达”我们的用户服务。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="3754" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">除了我们的server.js和/routes/userService文件，我们仍然必须声明用户模式(<a class="ae le" href="https://mongoosejs.com/docs/schematypes.html" rel="noopener ugc nofollow" target="_blank">mongose。模式</a>)。这概括了用户模型在我们的数据库中的样子——例如，它有什么属性等等(基本上是Mongoose模型的配置对象)。接下来让我们创建该文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="f598" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">请注意，这只是整个文件的一部分(如果我包含所有代码，本教程会太长)。除了这个模式之外，还有一些帮助函数——查看user.js中的所有代码</p><p id="fe85" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">很好，现在还记得我们如何指定userService.js文件在routes中(server.js的第8行)吗？我们现在将创建routes文件夹，并在其中创建我们的<a class="ae le" href="https://github.com/Reine0017/NodeAuthentication/commit/5ba29ba55b89f97e218c46350cc421c40dd04bc3" rel="noopener ugc nofollow" target="_blank"> userService.js文件</a>。这个文件太长了，无法添加到本教程中，所以我想我应该简单解释一下<code class="fe nf ng nh ni b">/register</code>和<code class="fe nf ng nh ni b">/auth</code>路线的作用，如果你有任何问题，欢迎在下面评论或者联系我。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="a9a1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在上面的要点中，在我们的用户输入他们的电子邮件、用户名和密码之后，我们检查用户名和电子邮件之前是否已经注册过。如果是，我们通过返回状态400和一条消息来拒绝注册。否则，我们向用户发送一封带有签名令牌(这是activationToken)的电子邮件，当用户点击激活链接时，我们将从前端触发<code class="fe nf ng nh ni b">/activateUser</code> API端点，并将用户详细信息保存在我们的数据库中。我们不在首次注册时直接写入我们的数据库的原因是，我们不想将假电子邮件写入我们的数据库。</p><p id="db8a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在对于<code class="fe nf ng nh ni b">/auth</code>端点:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="cfbc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个<code class="fe nf ng nh ni b">/auth</code>无需用户点击或输入就能被触发。在您的React应用程序中，创建一个当某些页面被访问时触发调用此端点的操作的特设。如果您在浏览器中设置了身份验证cookie，authenticateToken中间件(第1行)将发回用户数据。如果不是，authenticateToken中间件拒绝认证尝试。</p><p id="72e2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，我们将添加authenticateToken中间件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nt nu l"/></div></figure></div><div class="ab cl nv nw hu nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="ij ik il im in"><p id="3292" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这里有最终的代码库:<a class="ae le" href="https://github.com/Reine0017/NodeAuthentication" rel="noopener ugc nofollow" target="_blank">https://github.com/Reine0017/NodeAuthentication</a></p><p id="829e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">好的，谢谢你读到这里:)我希望你喜欢它，如果有任何问题，请在这里留言或给我发信息！</p><p id="4d8e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Node.js-ing快乐！ʕ•́ᴥ•̀ʔっ♡</p><p id="fb50" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="mc">更多内容请看</em><a class="ae le" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mc">plain English . io</em></a></p></div></div>    
</body>
</html>