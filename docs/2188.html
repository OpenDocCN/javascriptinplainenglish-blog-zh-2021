<html>
<head>
<title>Understanding Hooks Part 2— useEffect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解钩子第2部分——使用效果</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/hooks-part-2-useeffect-2fa1a377c124?source=collection_archive---------25-----------------------#2021-05-07">https://javascript.plainenglish.io/hooks-part-2-useeffect-2fa1a377c124?source=collection_archive---------25-----------------------#2021-05-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="1676" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">React里传说中的钩子背后有什么？有时候，我会想。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e42cee1f7d92219ceebab9b4725eb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLKP6AXotB79tG2MHWeheA.jpeg"/></div></div></figure><p id="42a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在第1部分的<a class="ae ku" href="https://windmaomao.medium.com/hook-myth-from-react-9495aa8ad7af" rel="noopener">中，我们通过<code class="fe kv kw kx ky b">Element</code>解释了钩子的一般概念。在第2部分中，我们想深入了解一下<code class="fe kv kw kx ky b">useEffect</code>，看看它是如何支持回调、拆卸和依赖的。</a></p><p id="df77" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了连接到<code class="fe kv kw kx ky b">element</code>，需要注册<code class="fe kv kw kx ky b">callback</code>。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="8409" class="ld le in ky b gy lf lg l lh li">function Component() {<br/>  <strong class="ky io">useEffect</strong>(() =&gt; { window.title = "ABC" })<br/>}</span></pre><h2 id="4982" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">永远在线</h2><p id="e601" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">默认情况下，<code class="fe kv kw kx ky b">effects</code>总是打开的，并且在每次更新时被调用。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="b08d" class="ld le in ky b gy lf lg l lh li"><strong class="ky io">useEffect</strong>(() =&gt; {<br/>  ...<br/>  <strong class="ky io">return</strong> () =&gt; {<br/>    ...<br/>  }<br/>})</span></pre><p id="a256" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">通常情况下，<code class="fe kv kw kx ky b">callback</code>不需要<code class="fe kv kw kx ky b">return</code>，但是如果<code class="fe kv kw kx ky b">teardown</code>功能由<code class="fe kv kw kx ky b">return</code>提供，它可以用于每次运行前的清洁工作，包括拆卸。</p><h2 id="ba3d" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">具有依赖性</h2><p id="9eeb" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">为每个<code class="fe kv kw kx ky b">update</code>运行<code class="fe kv kw kx ky b">effect</code>，这可能有点贵。为了避免这种情况，我们可以将依赖关系<code class="fe kv kw kx ky b">values</code>作为第二个输入。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="3382" class="ld le in ky b gy lf lg l lh li"><strong class="ky io">useEffect</strong>(() =&gt; {<br/>  ...<br/>}, [<strong class="ky io">var1</strong>, <strong class="ky io">var2</strong>, ...])</span></pre><p id="a626" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">只有当<code class="fe kv kw kx ky b">var</code>内部发生变化时，<code class="fe kv kw kx ky b">effects</code>才会被触发。因此对于空数组，挂载后会跳过<code class="fe kv kw kx ky b">effect</code>。</p><h2 id="2685" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">笔记</h2><p id="3843" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">钩子在每个渲染中都运行，对于<code class="fe kv kw kx ky b">useEffect</code>也不例外。在每次渲染过程中，依赖关系会与以前的版本进行比较。如果检测到变化，新的依赖关系<code class="fe kv kw kx ky b">array</code>以及<code class="fe kv kw kx ky b">callback</code>功能将被替换。</p><p id="8788" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">依赖数组和回调可以是新的实例。如果dependencies数组为空，则设置回调并调用一次。</strong></p><h2 id="b2d8" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="191e" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated"><code class="fe kv kw kx ky b">useEffect</code>主要有三种用法。</p><ul class=""><li id="f031" class="mf mg in jm b jn jo jr js jv mh jz mi kd mj kh mk ml mm mn bi translated">始终开启，为安装和每次更新运行。</li><li id="4e94" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">空依赖项，仅为装载运行。</li><li id="0542" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">对于依赖项，为装载运行，每次更改都会更新。</li></ul><p id="26b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">如果给出了teardown，它将在每次运行和卸载之前调用。</strong></p><h1 id="9be8" class="mt le in bd lj mu mv mw lm mx my mz lp na nb nc ls nd ne nf lv ng nh ni ly nj bi translated">索引</h1><ul class=""><li id="ea2d" class="mf mg in jm b jn ma jr mb jv nk jz nl kd nm kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/hook-myth-from-react-9495aa8ad7af" rel="noopener">第1部分，要素</a></li><li id="b432" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated">第二部分，使用效果你在这里</li><li id="29a3" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/hooks-part-3-usestate-26a622bbe462" rel="noopener">第3部分，使用状态</a></li><li id="9db9" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-4-hook-c7a8c7185f4e" rel="noopener">第四部分，挂钩</a></li><li id="d976" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-5-custom-hook-985b83c8bfea" rel="noopener">第5部分，自定义挂钩</a></li><li id="f461" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-6-usecontext-7ece0c0818e3" rel="noopener">第六部分，使用上下文</a></li><li id="6b9e" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-7-state-management-84ff636834a7" rel="noopener">第七部，国家管理</a></li><li id="6370" class="mf mg in jm b jn mo jr mp jv mq jz mr kd ms kh mk ml mm mn bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-8-four-body-problem-8f70b212356d" rel="noopener">第八部，四体问题</a></li></ul><p id="02c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nn">更多内容请看</em><a class="ae ku" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nn">plain English . io</em></a></p></div></div>    
</body>
</html>