<html>
<head>
<title>Using Binance API to get the user’s trading history</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用币安API获取用户的交易历史</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-binance-api-to-get-the-users-trading-history-e459c643878b?source=collection_archive---------17-----------------------#2021-04-09">https://javascript.plainenglish.io/using-binance-api-to-get-the-users-trading-history-e459c643878b?source=collection_archive---------17-----------------------#2021-04-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="5996" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个项目中，我们感兴趣的是与用户以前的交易相关的用户记录。为什么需要获取用户的交易记录？例如，帮助会计或分析。请记住，这不是一个完整的数据处理示例，而是一个起点。</p><h1 id="68ea" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">币安API和“my trades”rest端点简介</h1><p id="1d48" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">我们的目标是获得用户的私人数据，交易历史。由于这是私人信息，它将取决于初始认证步骤。请记住，这些步骤取决于与币安API的交互(<a class="ae ll" href="https://github.com/binance/binance-spot-api-docs" rel="noopener ugc nofollow" target="_blank">检查币安API文档，以检查API版本</a>)。</p><p id="c333" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">暂时将必要的认证过程放在一边。假设通过了身份验证，访问该端点的最直接方式是使用GET方法进行HTTP调用:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="2aaf" class="lv kj in lr b gy lw lx l ly lz">GET <a class="ae ll" href="https://github.com/binance/binance-spot-api-docs/blob/master/rest-api.md#account-trade-list-user_data" rel="noopener ugc nofollow" target="_blank">/api/v3/myTrades</a></span></pre><p id="9257" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">开发人员通常在这些基本方法之上创建抽象。一个例子是下面的方法，<a class="ae ll" href="https://github.com/jaggedsoft/node-binance-api#get-your-trade-history" rel="noopener ugc nofollow" target="_blank"> binance.trades </a>，可从节点-币安-API NPM模块获得:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="e1ac" class="lv kj in lr b gy lw lx l ly lz"><a class="ae ll" href="https://github.com/jaggedsoft/node-binance-api#get-your-trade-history" rel="noopener ugc nofollow" target="_blank">binance.trades</a>("SNMBTC", (error, trades, symbol) =&gt; {<br/>  console.info(symbol+" trade history", trades);<br/>});</span></pre><p id="5459" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以查看<em class="ma"> trades </em>方法的<a class="ae ll" href="https://github.com/jaggedsoft/node-binance-api/blob/master/node-binance-api.js#L3571" rel="noopener ugc nofollow" target="_blank">源代码</a>——看到它使用了“api/v3/myTrades”端点:</p><figure class="lm ln lo lp gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mb"><img src="../Images/8a0531fc10c3a65ca4adf6a716b0bcb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7GztSB776Ki_qh6w6Y7EA.png"/></div></div></figure><h1 id="8139" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">使用节点币安API获取“我的交易”</h1><p id="96c4" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">您可能想要获取以下源代码:一个非常简单的NodeJS获取示例，它使用Node-币安-API提取两个交易事件。下面的源代码是在币安用一个名为“spot account”的用户帐户测试的。</p><div class="mj mk gp gr ml mm"><a href="https://github.com/taboca/binance-mytrades-accounting" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab fo"><div class="mo ab mp cl cj mq"><h2 class="bd io gy z fp mr fr fs ms fu fw im bi translated">塔博卡/币安-我的贸易-会计</h2><div class="mt l"><h3 class="bd b gy z fp mr fr fs ms fu fw dk translated">从币安-塔博卡/币安-我的交易-会计中检索现货和保证金账户的交易历史</h3></div><div class="mu l"><p class="bd b dl z fp mr fr fs ms fu fw dk translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na mh mm"/></div></div></a></div><p id="366b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们看一下非常简单明了的代码:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="8157" class="lv kj in lr b gy lw lx l ly lz">const Binance = require('node-binance-api');<br/>const Keys    = require('./config.js');</span><span id="47c8" class="lv kj in lr b gy nb lx l ly lz">const binance = new Binance().options(Keys);</span><span id="7b8f" class="lv kj in lr b gy nb lx l ly lz">// This example shows how to pass options</span><span id="ac21" class="lv kj in lr b gy nb lx l ly lz">let options = { <br/>  limit: 2 // Limit results to two entries<br/>};</span><span id="4f75" class="lv kj in lr b gy nb lx l ly lz">binance.trades("BTCBRL", (error, trades, symbol) =&gt; {<br/>  console.info(symbol+" trade history", trades);<br/>}, options);</span></pre><p id="4df9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">根据<a class="ae ll" href="https://github.com/binance/binance-spot-api-docs/blob/master/rest-api.md#account-trade-list-user_data" rel="noopener ugc nofollow" target="_blank">币安API myTrades文档</a>，也可提供其他选项。让我们看看这个例子做了什么:</p><ul class=""><li id="39e2" class="nc nd in jm b jn jo jr js jv ne jz nf kd ng kh nh ni nj nk bi translated">它使用“节点-币安-api”来创建一个抽象，以帮助验证和REST协议细节。</li><li id="948a" class="nc nd in jm b jn nl jr nm jv nn jz no kd np kh nh ni nj nk bi translated">它传递带有用户APIKEY和用户APISECRET的Keys对象。您将需要使用您的币安帐户来设置这些元素。参见这篇关于如何创建API<a class="ae ll" href="https://www.binance.com/en/support/faq/360002502072" rel="noopener ugc nofollow" target="_blank">密匙的支持文章。</a></li><li id="8140" class="nc nd in jm b jn nl jr nm jv nn jz no kd np kh nh ni nj nk bi translated">它传递符号，在本例中使用“BTCBRL”。因此，如果你希望从上面的例子中得到数据，你需要使用BTCBRL对完成2笔交易，至少使用你的币安现货账户。</li><li id="db3e" class="nc nd in jm b jn nl jr nm jv nn jz no kd np kh nh ni nj nk bi translated">它超过了限制:2 —这意味着如果有2笔交易，它将只返回2个元素。</li></ul><h1 id="b551" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">API响应的示例</h1><p id="ca09" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">您还可以在myTrades端点的<a class="ae ll" href="https://github.com/binance/binance-spot-api-docs/blob/master/rest-api.md#account-trade-list-user_data" rel="noopener ugc nofollow" target="_blank">币安API文档中查看返回示例和附加选项参数。</a></p><figure class="lm ln lo lp gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nq"><img src="../Images/f7b9544a41d1dabbed5c9c180b80032e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EMxdr5L2ily_6rmHascVOg.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk">Photo by <a class="ae ll" href="https://unsplash.com/@brucaraujo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Bruna Araujo</a> on <a class="ae ll" href="https://unsplash.com/s/photos/old-monitor-crt-code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a> — screenshot adapted by Marcio</figcaption></figure><h2 id="1f5b" class="lv kj in bd kk nv nw dn ko nx ny dp ks jv nz oa kw jz ob oc la kd od oe le of bi translated">显示有两笔交易的阵列的响应:</h2><figure class="lm ln lo lp gt mc gh gi paragraph-image"><div class="gh gi og"><img src="../Images/d0eb364d3a46822b13d420f7e15a45ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*8uPaz7Tz7puB8rmRXQa1eA.png"/></div></figure><h1 id="644f" class="ki kj in bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">改善贸易结果</h1><p id="5e56" class="pw-post-body-paragraph jk jl in jm b jn lg jp jq jr lh jt ju jv li jx jy jz lj kb kc kd lk kf kg kh ig bi translated">根据币安API文档，“所有时间和时间戳相关的字段都以毫秒为单位。”因此，这里的主要挑战是将时间属性转换成可读性更好的东西。在这种情况下，JavaScript中日期函数的使用非常简单。其他属性不会被修改:</p><pre class="lm ln lo lp gt lq lr ls lt aw lu bi"><span id="4193" class="lv kj in lr b gy lw lx l ly lz">binance.trades("BTCBRL", (error, trades, symbol) =&gt; {  <br/>  for(let k in trades) { <br/>    let trade = trades[k];<br/>    let tradeDateTime = new Date(trade.time);<br/>    console.log(`Trade event --------------------------------`);<br/>    console.log(`time             : ${tradeDateTime}`);<br/>    console.log(`symbol           : ${trade.symbol}`);<br/>    console.log(`price            : ${trade.price}`);<br/>    console.log(`quantity         : ${trade.qty}`);<br/>    console.log(`commission fee   : ${trade.commission}`);<br/>    console.log(`commission asset : ${trade.commissionAsset}`);<br/>//    console.log(trade);<br/>  }<br/>}, options);</span></pre><p id="9a5b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">可能结果之一的示例:</p><figure class="lm ln lo lp gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi oh"><img src="../Images/e01f9d995c674045f0cd58d9bf0753d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gXaRR-2oRKqBuF_ai-qIPw.png"/></div></div></figure><p id="8b2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">参考文献</strong></p><ul class=""><li id="133c" class="nc nd in jm b jn jo jr js jv ne jz nf kd ng kh nh ni nj nk bi translated">来自币安API — <a class="ae ll" href="https://github.com/binance/binance-spot-api-docs/blob/master/rest-api.md#account-trade-list-user_data" rel="noopener ugc nofollow" target="_blank">账户交易列表用户数据API </a></li><li id="eba1" class="nc nd in jm b jn nl jr nm jv nn jz no kd np kh nh ni nj nk bi translated">从Node-币安-API — <a class="ae ll" href="https://github.com/jaggedsoft/node-binance-api#get-your-trade-history" rel="noopener ugc nofollow" target="_blank">获取您的交易历史</a></li></ul><p id="a7a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ma">更多内容请看</em><a class="ae ll" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="ma">plain English . io</em></strong></a></p></div><div class="ab cl oi oj hr ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ig ih ii ij ik"><figure class="lm ln lo lp gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi nq"><img src="../Images/f64287e6bc89e6a4ac3328b6ad3b3095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-iO0NYS7JhUVZHOlkinrKQ.jpeg"/></div></div></figure><p id="3b59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ma">免责声明—这是从我自己的会议id 0421981 a-d179–4a 27-a0d 1-Fe 1280 b5 e1e 5中摘录的公开文档。我用这种方法来改进我自己的文档，因为我正在学习使用与交易系统相关的API。请理解这篇文章是一篇教育性文章——它是以所谓的“原样”形式提供的，没有任何形式的保证。当然，这些内容不会包含任何财务建议。</em></p></div></div>    
</body>
</html>