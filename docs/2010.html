<html>
<head>
<title>Jest: Clearing Module Mocks Effortlessly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jest:轻松清除模块模仿</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/jest-clearing-module-mocks-effortlessly-6656d104cab?source=collection_archive---------3-----------------------#2021-04-27">https://javascript.plainenglish.io/jest-clearing-module-mocks-effortlessly-6656d104cab?source=collection_archive---------3-----------------------#2021-04-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7e98635eec232b735788c9c9b68a3f70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xNY4slUXbfx6Zzu9"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@oskaryil?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Oskar Yildiz</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="805f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我有一个在整个应用程序中使用的查询模块。因此，这个模块在我的测试中经常被嘲笑。为了节省时间，我通过每次Jest运行时加载的设置文件对它进行了全局模拟。它的工作几乎完美无缺，我的规格更清晰，我可以准确地测试我想要的。</p><p id="5446" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，我意识到不管我对模块做了什么，查询模块的测试都通过了。我无意中通过全局嘲笑破坏了模块的测试。</p><p id="38e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我尝试以各种形式和组合使用:<code class="fe ky kz la lb b">jest.restoreAllMocks</code>、<code class="fe ky kz la lb b">jest.clearAllMocks</code>和<code class="fe ky kz la lb b">jest.resetAllMocks</code>来移除模拟，但没有任何效果。然后我发现了<code class="fe ky kz la lb b">jest.unmock</code>。这个函数让你传递模块名或路径，它将确保模块永远不会被模仿。这很简单，它可以让你在其他测试套件中模拟这个文件。太完美了。这是你如何使用它。</p><h1 id="1942" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">嘲笑</h1><p id="0b10" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">这里我使用<code class="fe ky kz la lb b">jest.mock</code>模拟查询模块，特别是<code class="fe ky kz la lb b">active_bank_request</code>对象。模拟监听<code class="fe ky kz la lb b">active_bank_request</code>上的<code class="fe ky kz la lb b">query</code>方法，并返回模拟响应。</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="c27b" class="mn ld in lb b gy mo mp l mq mr">jest.mock('@/queries/accounts_query', () =&gt; {</span><span id="5233" class="mn ld in lb b gy ms mp l mq mr">  return {</span><span id="3d2b" class="mn ld in lb b gy ms mp l mq mr">    active_bank_request: {</span><span id="8c35" class="mn ld in lb b gy ms mp l mq mr">      query: () =&gt; new Promise(resolve =&gt; resolve(mock_accounts))</span><span id="e8a6" class="mn ld in lb b gy ms mp l mq mr">    }</span><span id="1e09" class="mn ld in lb b gy ms mp l mq mr">  }</span><span id="9fca" class="mn ld in lb b gy ms mp l mq mr">})</span></pre><p id="eb56" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意我在<code class="fe ky kz la lb b">jest.mock</code>调用中使用的模块的路径。这需要与您传递给<code class="fe ky kz la lb b">jest.unmock</code>的路径相同。</p><p id="8bcf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">@</code>是<code class="fe ky kz la lb b">src</code>文件夹的快捷方式，所以我不必为每个路径都写<code class="fe ky kz la lb b">../../</code>。</p><h1 id="92d3" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">清除模拟</h1><p id="c2e5" class="pw-post-body-paragraph ka kb in kc b kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx ig bi translated">在<code class="fe ky kz la lb b">accounts_query</code>的规范中，我卸载了调用<code class="fe ky kz la lb b">jest.unmock</code>的模块，并将路径传递给它。</p><pre class="mf mg mh mi gt mj lb mk ml aw mm bi"><span id="00f0" class="mn ld in lb b gy mo mp l mq mr">describe('Accounts Query', () =&gt; {</span><span id="9ffc" class="mn ld in lb b gy ms mp l mq mr">  beforeAll(() =&gt; {</span><span id="edc5" class="mn ld in lb b gy ms mp l mq mr">    jest.unmock('@/queries/accounts_query')</span><span id="e75a" class="mn ld in lb b gy ms mp l mq mr">  })<br/></span><span id="e885" class="mn ld in lb b gy ms mp l mq mr">  describe('Active Accounts', () =&gt; {</span><span id="9a05" class="mn ld in lb b gy ms mp l mq mr">    // tests</span><span id="a844" class="mn ld in lb b gy ms mp l mq mr">  })</span><span id="9f4e" class="mn ld in lb b gy ms mp l mq mr">})</span></pre><p id="5921" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就是这样，测试愉快！</p><h1 id="e133" class="lc ld in bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">来源</h1><div class="mt mu gp gr mv mw"><a href="https://jestjs.io/docs/jest-object#jestunmockmodulename" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd io gy z fp nb fr fs nc fu fw im bi translated">笑话对象笑话</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">jest对象自动在每个测试文件的范围内。jest对象中的方法有助于创建模拟和…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">jet js . io</p></div></div><div class="nf l"><div class="ng l nh ni nj nf nk jt mw"/></div></div></a></div><div class="mt mu gp gr mv mw"><a href="https://jestjs.io/docs/jest-object#jestmockmodulename-factory-options" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab fo"><div class="my ab mz cl cj na"><h2 class="bd io gy z fp nb fr fs nc fu fw im bi translated">笑话对象笑话</h2><div class="nd l"><h3 class="bd b gy z fp nb fr fs nc fu fw dk translated">jest对象自动在每个测试文件的范围内。jest对象中的方法有助于创建模拟和…</h3></div><div class="ne l"><p class="bd b dl z fp nb fr fs nc fu fw dk translated">jet js . io</p></div></div><div class="nf l"><div class="nl l nh ni nj nf nk jt mw"/></div></div></a></div><p id="6d5f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">更多内容尽在plainenglish.io </em> </a></p></div></div>    
</body>
</html>