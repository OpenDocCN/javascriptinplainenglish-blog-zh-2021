<html>
<head>
<title>How to Drag and Drop using JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用JavaScript拖放</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-drag-and-drop-using-javascript-46e3772b535e?source=collection_archive---------3-----------------------#2021-03-08">https://javascript.plainenglish.io/how-to-drag-and-drop-using-javascript-46e3772b535e?source=collection_archive---------3-----------------------#2021-03-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b928" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">JavaScript拖放与数据库持久性</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8529c82ed0d90d0a440c2670ecd5dbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0n_5p66rWjuzI3uPQ_I-Q.jpeg"/></div></div></figure><p id="d7f9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">想象一下，如果没有拖放，web应用程序会是什么样子。在Google Drive或Dropbox中移动项目会更加繁琐。您需要单独打开文件夹，然后手动将文件添加到该文件夹中。多痛苦啊！幸运的是，HTML、CSS和JavaScript的强大组合使得拖放操作变得轻而易举，从而使日常功能对用户来说更加实用。</p><p id="2832" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本文中，我将介绍如何使用普通的JavaScript以及基本的HTML和CSS来实现拖放。我还将解释如何确保对DOM所做的更改在数据库中持久化——有人说过全栈开发吗？</p><p id="5875" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您想测试应用程序，<a class="ae lk" href="https://github.com/gabriel-demes/drag-drop-prac" rel="noopener ugc nofollow" target="_blank">这里是存储库</a>。</p><h1 id="82d2" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">概观</h1><p id="8932" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在我们开始编写代码之前，最好对我们将要构建的内容有一个大致的了解。我们的网站将是一个简单的，没有装饰的页面，将显示两个列表:一个好的列表，和一个淘气的列表。这些列表将用我们数据库中的名字填充——为了简单起见，我将使用一个<em class="mi"> db.json </em>文件，但是您也可以使用Rails API、Node或任何其他您想要的后端技术。到本文结束时，我们将能够将一个学生从一个列表拖到另一个列表，并且即使在我们重新加载页面后，这些更改仍然存在。下图演示了使用拖放功能后我们的页面会是什么样子。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/87f2139027439c53771782438b102231.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*FcAH4sc8U1SRMngF8ikqCg.gif"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Demonstration of Final Product</figcaption></figure><h1 id="b79e" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">设置HTML和CSS</h1><p id="6f94" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我们的第一步是建立一个基本的HTML文件。在HTML的头部，我们需要链接CSS样式表和JavaScript文件。当链接JavaScript文件时，一定要给脚本标签一个defer属性。这是一个经常被忽略的重要步骤，并且经常会导致网页出现故障。在HTML文件的主体中，我们将设置两个<em class="mi">div</em>，它们将成为我们列表的容器。每个<em class="mi"> div </em>都有一个名为“container”的<em class="mi">类</em>，一个<em class="mi"> div </em>有一个“nice”的<em class="mi"> id </em>，而另一个有一个“naughty”的<em class="mi"> id </em>。为了清楚起见，每个<em class="mi"> div </em>都将包含一个<em class="mi">标题</em>，标题中包含该<em class="mi"> div中的列表名称。</em>使用所附代码作为如何设置HTML文件的参考。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="d8a8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们的样式表也将非常简单。首先我们要去掉我们<em class="mi">身体</em>的<em class="mi">页边空白</em>；然而，这是完全可选的。接下来，我们将设置列表容器的<em class="mi">背景色</em>为灰色。我们还需要给容器添加一个<em class="mi">1边缘填充</em>以及一个<em class="mi">2边缘顶部</em>。我们要做的最后一件事是给我们最终的学生添加样式。我们需要确保他们的<em class="mi">背景色</em>是白色；这将更容易看到我们的列表和可拖动项目之间的对比。我们还想给它们添加一个<em class="mi">1红色填充</em>。最后，我们应该将光标设置为'<em class="mi"> move '，</em>这只是增加了用户体验，并有助于进一步显示这些项目可以被拖放。请参考下面的样式表代码。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="bc1e" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">设置数据库</h1><p id="1d8b" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">如前所述，我们将为数据库使用一个简单的<em class="mi"> db.json </em>文件。我们的数据库由一个students对象组成，它的值是student-objects的列表。每个学生都有一个id，一个名字，以及他们当前的名单，无论是淘气的还是乖的。使用下面附加的代码来帮助你建立你的数据库。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="1f08" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">注意:如果使用一个<em class="mi"> db.json </em>文件，确保在您的终端中，在您的项目所在的同一个目录下运行以下命令:</strong></p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="0e13" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">npm install json-server<br/>json-server --watch db.json</strong></span></pre><h1 id="3c94" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">用数据库中的名称填充列表</h1><p id="dc3a" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在我们已经有了HTML、CSS和数据库设置，是时候使用JavaScript来发出获取请求以及操作我们的DOM了。在页面加载时，我们要做的第一件事是发出一个<em class="mi"> GET </em>请求，然后用我们学生的名字填充我们的列表。我们将创建一个加载函数，该函数将使用<em class="mi">获取</em>来创建<em class="mi">获取</em>请求。然后，我们需要将的响应传递给另一个函数，该函数将根据学生的列表属性将每个学生的名字添加到适当的列表中。</p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="877b" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">const</strong> load = () =&gt;{<br/>     dropEvent() <em class="mi">//I'll talk about this line later</em><br/>     <strong class="mr io">fetch</strong>('http://localhost:3000/students') //makes our get request<br/>          <strong class="mr io">.then</strong>(resp =&gt; resp.json())<br/>          <strong class="mr io">.then</strong>(students =&gt; {<br/>               students<strong class="mr io">.forEach</strong>(studentObj =&gt;{<br/>                    <strong class="mr io">addStudentToList</strong>(studentObj) <br/>               })<br/>          })<br/>}<br/>// <strong class="mr io"><em class="mi">be sure to call load() at the bottom of this JS file!</em></strong></span></pre><p id="74eb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了将每个学生添加到列表中，我们的addStudentToList函数接受一个student对象的参数。然后，我们需要根据student对象的list属性选择正确的列表。然后，我们需要创建一个保存学生姓名的p标签。p标签将有一个“draggable”类，这是我们如何在CSS中为每个名字添加样式的。接下来，我们需要将draggable属性设置为<em class="mi"> "true" </em>，以便让<em class="mi"> p-tag </em>真正成为一个可拖动的元素。现在，我们将<em class="mi">数据id </em>设置为学生的id，并将<em class="mi">数据列表</em>设置为学生应该出现的列表。最后，我们将<em class="mi"> p-tag </em>元素添加到我们选择的列表中。</p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="c9e5" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">const</strong> addStudentToList = (studentObj) =&gt; {<br/>   <strong class="mr io">const</strong> correctList = document<strong class="mr io">.querySelector</strong>(`#${studentObj.list}`)<br/>   <strong class="mr io">const</strong> nameP = document<strong class="mr io">.createElement</strong>('p')<br/>   nameP<strong class="mr io">.textContent</strong> = studentObj.name<br/>   nameP<strong class="mr io">.classList.add</strong>('draggable')<br/>   nameP<strong class="mr io">.draggable</strong> = "true" //makes element draggable <br/>   nameP<strong class="mr io">.dataset.id</strong> = studentObj.id //sets data-id<br/>   nameP<strong class="mr io">.dataset.list</strong> = studentObj.list //sets data-list<br/>   correctList<strong class="mr io">.append</strong>(nameP) //adds student to the list                      <br/>   <strong class="mr io">dragEvent</strong>(nameP) //<em class="mi">I'll talk about this line later</em><br/>}</span></pre><h1 id="5b17" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">在列表之间拖放名称</h1><p id="0910" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在，我们已经将数据库中的名字添加到适当的列表中，并赋予每个名字被拖动的能力，我们需要某种方法来将被拖动的条目放到另一个列表中。这就是<em class="mi"> EventListeners </em>发挥作用的地方。在我们创建<em class="mi"> p标签</em>元素的最后一行代码中，我们将该元素传递给了<em class="mi"> dragEvent </em>函数。该函数将向每个<em class="mi"> p-tag </em>元素添加两个<em class="mi">event listener</em>。</p><p id="b304" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">第一个<em class="mi"> EventListener </em>将在元素被拖动的开始发生。在此事件中，元素将获得一个名为“拖动”的<em class="mi">类</em>。这将帮助我们跟踪哪个元素正在被拖动。第二个<em class="mi"> EventListener </em>将在元素被放下或拖动结束时发生。当元素被放下时,“拖动”类将从name元素中删除。因此，一次只有一个元素具有“drawing”<em class="mi">类</em>——这是有意义的，因为一次只能拖动一个元素。</p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="9da5" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">const</strong> dragEvent = p =&gt;{<br/>     p<strong class="mr io">.addEventListener</strong>('dragstart', ()=&gt;{<br/>          p<strong class="mr io">.classList.add</strong>('dragging')<br/>     })<br/>     p<strong class="mr io">.addEventListener</strong>('dragend', ()=&gt;{<br/>          p<strong class="mr io">.classList.remove</strong>('dragging')<br/>          <strong class="mr io">handleMovement</strong>(p) // I'll talk about this later<br/>     })<br/>}</span></pre><p id="21e2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们的<em class="mi"> dragEvent </em>函数只负责被拖动的元素。然而，目前我们没有办法将元素放到一个新的列表中。在我们之前的代码中，当我们加载页面时，我们调用了一个名为<em class="mi"> dropEvent()的函数。</em><em class="mi">drop event</em>函数将一个<em class="mi"> EventListener </em>添加到保存列表的容器(<em class="mi"> div </em>)中。当一个元素被拖动到容器上并放下时，我们选择带有“拖动”类的项目(被拖动的项目)，并将该元素添加到容器中。一定要包含一个<em class="mi"> preventDefault </em>，因为这是允许div能够将元素放到它上面的。</p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="57cd" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">const</strong> droptEvent = () =&gt; {<br/>     containers<strong class="mr io">.forEach</strong>(container =&gt; {<br/>          container<strong class="mr io">.addEventListener</strong>("dragover", (event)=&gt;{<br/>               event<strong class="mr io">.preventDefault</strong>()<br/>               const item = document<strong class="mr io">.querySelector</strong>(".dragging")<br/>               container<strong class="mr io">.append</strong>(item)<br/>          })<br/>     })<br/>}</span></pre><h1 id="fd26" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">数据库中的持久性</h1><p id="48b8" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">使用我们目前拥有的代码，我们可以成功地将名字从一个列表拖放到另一个列表。然而，一旦我们重新加载页面，列表将返回到它们的原始状态。为了让列表在我们重新加载页面时反映它们的新状态，我们需要将更改保存到数据库中。这就是当我们在<em class="mi"> dragEvent </em>函数中放下元素时<em class="mi"> handleMovement </em>函数发挥作用的地方。</p><p id="f42f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们的<em class="mi"> handleMovement </em>函数将name元素作为其参数。我们声明一个名为currentList的变量，它存储元素的原始<em class="mi">数据列表</em>属性。然后，我们检查原始的<em class="mi">数据列表</em>是否与删除元素的列表相同——这将是<em class="mi"> p标签</em>的父元素。如果它们是相同的，这意味着这个名字实际上没有被移动，我们什么也不做。如果它们不同，我们将currentList设置为新列表。然后，我们必须使用fetch发出一个<em class="mi"> PATCH </em>请求，用学生所在的列表更新学生列表。一旦更新完成，我们也可以用新列表更新数据列表<em class="mi">。</em></p><pre class="kd ke kf kg gt mq mr ms mt aw mu bi"><span id="c132" class="mv lm in mr b gy mw mx l my mz"><strong class="mr io">const</strong> containers = document<strong class="mr io">.querySelectorAll</strong>('.container')<strong class="mr io"><br/>const</strong> handleMovement = p =&gt;{<br/>     <strong class="mr io">let</strong> currList = p<strong class="mr io">.dataset.list</strong><br/>     <strong class="mr io">if</strong> (currList != p.<strong class="mr io">parentElement.id</strong>){<br/>          <strong class="mr io">if</strong> (currList === 'naughty'){currList = 'nice'}<br/>          <strong class="mr io">else</strong>{currList = 'naughty'}<br/>          <strong class="mr io">fetch</strong>(`http://localhost:3000/students/${p.dataset.id}`, {<br/>               <strong class="mr io">method</strong>: "PATCH",<br/>               <strong class="mr io">headers</strong>: {"Content-Type": "application/json"},<br/>               <strong class="mr io">body</strong>: JSON.<strong class="mr io">stringify</strong>({list: currList})<br/>          })<br/>               .<strong class="mr io">then</strong>(resp =&gt; resp.json())<br/>               .<strong class="mr io">then</strong>(student =&gt; {p.dataset.list = student.list})<br/>     }<br/>}</span></pre><h1 id="f57d" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">结论</h1><p id="beac" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我们最终实现了一个拖放功能，它也可以与后端数据库交互。这只是一个功能非常少的准系统网页。唯一的目的是作为一个教程，让您开始在项目中实现拖放功能。请注意，JavaScript和各种框架有许多可用的库，它们也处理拖放特性——有些具有不同程度的功能。和往常一样，JavaScript的可能性是无限的，可用的资源也在不断增加。我鼓励你尝试一下你在这里学到的东西，并且看看你可以使用的许多图书馆。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="392b" class="ll lm in bd ln lo nh lq lr ls ni lu lv jt nj ju lx jw nk jx lz jz nl ka mb mc bi translated">有用的资源</h1><ul class=""><li id="0364" class="nm nn in kq b kr md ku me kx no lb np lf nq lj nr ns nt nu bi translated"><a class="ae lk" href="https://developer.mozilla.org/en-US/docs/Web/API/Document/drag_event" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/Document/drag _ event</a></li><li id="a48a" class="nm nn in kq b kr nv ku nw kx nx lb ny lf nz lj nr ns nt nu bi translated"><a class="ae lk" href="https://www.cssscript.com/lightweight-js-sorting-library-with-native-html5-drag-and-drop-sortable/" rel="noopener ugc nofollow" target="_blank">https://www . CSS script . com/lightweight-js-sorting-library-with-native-html 5-drag-and-drop-sortable/</a></li><li id="16f8" class="nm nn in kq b kr nv ku nw kx nx lb ny lf nz lj nr ns nt nu bi translated"><a class="ae lk" href="https://www.cssscript.com/best-drag-drop-javascript-libraries/" rel="noopener ugc nofollow" target="_blank">https://www . CSS script . com/best-drag-drop-JavaScript-libraries/</a></li><li id="7139" class="nm nn in kq b kr nv ku nw kx nx lb ny lf nz lj nr ns nt nu bi translated"><a class="ae lk" href="https://blog.usejournal.com/a-quick-guide-to-regex-in-ruby-8540885057d6" rel="noopener ugc nofollow" target="_blank">https://blog . use journal . com/a-quick-guide-to-regex-in-ruby-8540885057 D6</a></li></ul><p id="754b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mi">更多内容请看</em><a class="ae lk" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="mi">plain English . io</em></strong></a></p></div></div>    
</body>
</html>