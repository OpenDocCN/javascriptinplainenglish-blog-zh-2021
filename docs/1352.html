<html>
<head>
<title>How to Integrate Apple Music with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Apple Music与JavaScript整合</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-integrate-apple-music-with-javascript-9336d6cf95f6?source=collection_archive---------18-----------------------#2021-03-21">https://javascript.plainenglish.io/how-to-integrate-apple-music-with-javascript-9336d6cf95f6?source=collection_archive---------18-----------------------#2021-03-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4128c16dde72c2fc92df701b5ca94532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZmInOw6mbjWh-RDbnzWdQ.jpeg"/></div></div></figure><p id="952e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们都知道现在音乐流媒体正在蓬勃发展。因为纯粹的方便和易用，用户已经爱上了这种现代的听音乐方式。</p><p id="5c8b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但这对web开发者来说意味着什么呢？嗯，除非你是Spotify、苹果、亚马逊或类似的公司，否则你在<em class="kt">【流媒体战争】</em>中竞争的机会相对较低。但是如果你的目标不同呢？如果你想做一个<strong class="jx io">音乐播放器</strong>、<strong class="jx io">附加服务</strong>或类似的东西，而不是流媒体平台本身，那会怎样？既然如此，为什么不让<em class="kt">【大玩家】</em>帮帮你呢？</p><p id="b6ce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在今天的帖子中，我想带你了解一下用苹果的<strong class="jx io"> MusicKit JS </strong>将<strong class="jx io">苹果音乐</strong>集成到你的网络应用程序中的过程。听起来很有趣？</p><h1 id="0f5b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么选择Apple Music？</h1><p id="8a1d" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在我们开始之前，我想先回答一个可能的问题:</p><blockquote class="lx ly lz"><p id="df3a" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">我为什么选择Apple Music？</p></blockquote><p id="6185" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可能已经知道<strong class="jx io"> Spotify </strong>是<strong class="jx io">市场的领导者</strong>。它拥有最大的用户群，同时也拥有最多的付费用户(尽管后者要小得多)。Apple Music在这两个类别中都落后于Spotify，排名第二。</p><p id="c904" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，如果我们选择基于用户群，我们应该选择Spotify。然而，还有一些事情你必须记住。那是服务的<strong class="jx io">公共API </strong>。</p><p id="4a41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这方面，苹果凭借其<strong class="jx io"> MusicKit </strong>绝对处于领先地位。它允许你通过易于使用的库直接从你的iOS、Android或web应用程序集成Apple Music。</p><p id="ccdc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你感兴趣，Spotify确实通过其<a class="ae md" href="https://developer.spotify.com/documentation/web-playback-sdk/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">网络播放SDK </strong> </a>提供了类似的功能。尽管如此，它目前仍处于测试阶段，支持有限，仅适用于付费用户，并且在用于商业产品之前需要Spotify的书面批准。这与苹果的产品相差甚远，但考虑到大多数(如果不是全部)其他流媒体服务根本不提供这样的选择，这仍然是很好的。</p><h1 id="de9a" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">准备</h1><p id="ca8c" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在开始使用MusicKit JS之前，我们必须做一些准备工作。也就是给自己弄个<strong class="jx io"> Apple Music API令牌</strong>。</p><p id="5e81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">令人惊讶的是，这可能是一个有点令人生畏的任务，尤其是苹果的<a class="ae md" href="https://developer.apple.com/documentation/applemusicapi/getting_keys_and_creating_tokens" rel="noopener ugc nofollow" target="_blank">相当复杂的文档</a>。</p><p id="a18c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，你需要成为苹果开发者计划<a class="ae md" href="https://developer.apple.com/programs/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"/></a><strong class="jx io">的成员。</strong>这需要精心注册并支付<strong class="jx io"> 100美元/年</strong>的费用。</p><p id="ca96" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">完成后，我们需要进入Apple Developer dashboard并收集一些详细信息:</p><ol class=""><li id="7992" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks mj mk ml mm bi translated">从<em class="kt">成员资格</em>选项卡中，获取您的<strong class="jx io">团队ID </strong>。</li><li id="72c2" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated">接下来，我们需要一个<strong class="jx io"> MusicKit标识符</strong>(每个应用一个):</li></ol><ul class=""><li id="c41d" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks ms mk ml mm bi translated">转到<em class="kt">证书、标识符&amp;配置文件</em>选项卡。</li><li id="82b6" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">在那里，进入<em class="kt">标识符</em>选项卡。</li><li id="78f3" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">点击标题旁边的<em class="kt">“+”</em>按钮(如果你在团队中，需要<em class="kt">管理员</em>或<em class="kt">账户持有人</em>权限才能显示)。</li><li id="f088" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">输入你的应用名称和标识符的“反向域名”名称，点击<em class="kt">“继续”</em>，然后<em class="kt">“注册”</em>。</li></ul><p id="631e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.设置好适当的标识符后，我们现在可以创建一个<strong class="jx io">私钥</strong>来访问MusicKit服务:</p><ul class=""><li id="b193" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks ms mk ml mm bi translated">从<em class="kt">证书、标识符&amp;配置文件</em>，转到<em class="kt">密钥</em>选项卡(仅对管理员或帐户持有人可见)</li><li id="78ff" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">点击<em class="kt">“+”</em>按钮，输入所需的详细信息，并勾选<em class="kt"> MusicKit复选框</em>(如果您有多个MusicKit标识符，您需要选择其中一个)</li><li id="22fd" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks ms mk ml mm bi translated">点击<em class="kt">“确认”</em>，下载<strong class="jx io"> .p8密钥文件</strong>(只能下载一次，注意安全！)</li></ul><p id="5083" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">4.文件的内容是您的私钥，而文件名应该包含<strong class="jx io">密钥ID </strong>作为文件名的最后十个字符(就在下划线后面)。如果您更改了文件名，密钥ID也应该出现在开发人员仪表板中。</p><p id="ec41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有很多东西，但是我们还没有完成。</p><p id="6857" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，有了所有的细节，我们终于可以生成访问服务所需的<strong class="jx io"> JSON Web令牌</strong> (JWT)。</p><p id="7ce1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，我们将使用一些JS。<strong class="jx io"> NodeJS </strong>具体为<a class="ae md" href="https://www.npmjs.com/package/jsonwebtoken" rel="noopener ugc nofollow" target="_blank"> jsonwebtoken模块</a>，代码如下:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="7096" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用上面的代码，我们生成并向控制台输出所需的JWT令牌。</p><p id="2e3d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另外，如何管理你的JWT代币取决于你自己。在我们的例子中，出于演示目的，我们只需要一个令牌，这就是为什么它被设置为在<strong class="jx io"> 180天</strong>(最大值)内有效。</p><h1 id="ca46" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">综合</h1><p id="5cc7" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">好吧，所以得到代币是相当多的工作，但从这里开始只会变得更容易。最后来做点编码吧！</p><h2 id="2a9e" class="mz kv in bd kw na nb dn la nc nd dp le kg ne nf li kk ng nh lm ko ni nj lq nk bi translated">装置</h2><p id="ffbc" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">首先，我们必须“安装”MusicKit JS库。唯一的官方途径是通过一个指向苹果CDN的标签:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="652f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，对于一些web开发者(包括我)来说，这可能有点过时了。为了简化开发过程，您可能会寻找一些第三方的基于NPM模块的集成，但是我更愿意让它保持原样，在上面添加一些<strong class="jx io">类型脚本类型</strong>。</p><p id="3e59" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你是一个TypeScript用户，打字可以帮助你更容易地浏览任何图书馆。有时候比官方文档还要好！</p><p id="6270" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">至于MusicKit JS，有一些类型<a class="ae md" href="https://github.com/wsmd/musickit-typescript" rel="noopener ugc nofollow" target="_blank">公开可用</a>。它们并不完美，也有点过时，但还是有帮助的。</p><h2 id="922c" class="mz kv in bd kw na nb dn la nc nd dp le kg ne nf li kk ng nh lm ko ni nj lq nk bi translated">初始化</h2><p id="f5d0" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">安装了库之后，我们现在应该初始化它。有两种方法可以做到这一点——让我们称之为“HTML”和“JS方法”。</p><p id="a13f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> HTML方式</strong></p><p id="942f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在第一个例子中，通过几个<strong class="jx io"> HTML标签</strong>让库知道该做什么，你给了它更多的控制权。对于设置，只需在<code class="fe nl nm nn no b">&lt;head&gt;</code>中添加一些<code class="fe nl nm nn no b">&lt;meta&gt;</code>标签:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="f7e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">之后，用户将需要<strong class="jx io">授权</strong>使用Apple Music，如果你简单地通过不同的<code class="fe nl nm nn no b">id</code>向它显示它应该附加哪些元素，库也可以为你处理这个问题:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="c3e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> JS方式</strong></p><p id="61bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">虽然HTML设置很方便，但我更喜欢更详细的方式，这样我能更好地控制发生的事情。这就是为什么，从现在开始，我将专门讨论JS，但是你可以在<a class="ae md" href="https://developer.apple.com/documentation/musickitjs/adding_musickit_features_using_html" rel="noopener ugc nofollow" target="_blank">官方文档</a>中找到更多关于HTML的内容。</p><p id="5448" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，你需要听一下<code class="fe nl nm nn no b">document</code>元素上的<code class="fe nl nm nn no b">musickitloaded</code>，知道什么时候库<strong class="jx io">可以使用</strong>。就我个人而言，我更喜欢将它包装在一个<strong class="jx io">承诺</strong>中，以限制<em class="kt">“回调地狱”</em>的潜力，并实现更干净的代码:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="0239" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们知道库已经加载时，我们使用全局MusicKit对象的<code class="fe nl nm nn no b">configure()</code>方法来创建和配置一个实际的MusicKit实例，我们稍后将使用它(类似于HTML设置中的<code class="fe nl nm nn no b">&lt;meta&gt;</code>标记)。</p><p id="18a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在上面的代码中，我从承诺中解决了这个实例。我还从MusicKit对象中清除了全局作用域，因为不再需要它了。</p><p id="6558" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了授权用户，我们可以使用<code class="fe nl nm nn no b">authorize()</code>方法，该方法返回流程完成时的承诺。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><h2 id="5c94" class="mz kv in bd kw na nb dn la nc nd dp le kg ne nf li kk ng nh lm ko ni nj lq nk bi translated">使用</h2><p id="3304" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">此时，文档和可选类型应该是您的指南。MusicKit JS让你几乎可以使用<strong class="jx io">从<strong class="jx io"> Apple Music app </strong>本身获得的所有功能</strong>——控制音乐播放、搜索Apple Music的目录、操作用户的个人图书馆&amp;等等！</p><p id="9895" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">说了这么多，让我们来看几个MusicKit JS可能性的用例。</p><p id="be15" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">播放用户的一个播放列表</strong></p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="514d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">控制音乐播放</strong></p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="2560" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">值得注意的是，在移动到上一首歌曲(<code class="fe nl nm nn no b">skipToPreviousItem()</code>)时，MusicKit库似乎出现了一个<strong class="jx io">错误</strong>。它导致抛出一个错误，以及一个带有如下消息的<strong class="jx io">错误对话框</strong>:</p><blockquote class="lx ly lz"><p id="3109" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">调用了play stop()方法，但没有先前的play()描述符</p></blockquote><p id="0560" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除了错误的警告，一切都应该工作正常。所以，由于这是一个库错误，你最好的选择是用一些CSS隐藏对话框:</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3ebb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">搜索苹果音乐的目录</strong></p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="d930" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当使用<code class="fe nl nm nn no b">search()</code>和其他查询方法时，需要知道它们接受一个名为<code class="fe nl nm nn no b">queryParameters</code>的参数。它是一个传递给底层API调用的参数对象，符合<a class="ae md" href="https://developer.apple.com/documentation/applemusicapi" rel="noopener ugc nofollow" target="_blank">苹果音乐API文档</a>(与MusicKit JS文档分开)。再说一遍，苹果的文档相当复杂，所以你需要找到自己的方法。</p><h1 id="73b9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="6344" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">所以，这些只是你可以用MusicKit JS做的一些常见的例子。它让你能够广泛接触到Apple Music的潜力，而我们只是触及了它的表面。现在你可以去探索更多，并建立自己的苹果音乐集成！</p><p id="b045" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你有任何问题或者在文档中遇到困难——欢迎在下面留下评论，我会尽力帮助你。</p><p id="740f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">想了解更多web开发的好处，请在<a class="ae md" href="https://twitter.com/areknawo" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae md" href="https://www.facebook.com/areknawoblog" rel="noopener ugc nofollow" target="_blank">脸书</a>或通过<a class="ae md" href="https://areknawo.com#newsletter" rel="noopener ugc nofollow" target="_blank">我的简讯</a>关注我的。此外，如果你也有一个编码博客，可以考虑看看<a class="ae md" href="https://codewrite.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io">code write</strong></a>—<em class="kt">一个开发人员专用的博客工具</em>，有很好的编辑体验，一键发布到Dev.to，Hashnode &amp; <strong class="jx io"> Medium </strong>(处理代码块— GitHub Gists转换)！</p></div></div>    
</body>
</html>