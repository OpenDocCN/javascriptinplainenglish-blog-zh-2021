<html>
<head>
<title>How to Bypass CAPTCHAs with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript绕过验证码</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-bypass-captchas-with-javascript-13f6eb126f8?source=collection_archive---------4-----------------------#2021-07-22">https://javascript.plainenglish.io/how-to-bypass-captchas-with-javascript-13f6eb126f8?source=collection_archive---------4-----------------------#2021-07-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="dd92" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用JavaScript、木偶师和2Captcha绕过验证码</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a65676bd1c2d9b8dcd0d60849a3fcce2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Er5HD3TmD02QHWG4iGlrg.png"/></div></div></figure><h2 id="2bc1" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">什么是验证码？</h2><p id="6777" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">当网站想要验证用户不是机器人时，CAPTCHAs(区分计算机和人类的完全自动化的公共图灵测试)被用在各种网站上。我们看到的最常见的CAPTCHA形式之一要求用户看着部分模糊的字母图像，并键入他们看到的字母。最近，验证码变得越来越复杂，包括小游戏、图像识别等等。</p><p id="a00f" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">验证码通常用于阻止不良行为者(如垃圾邮件机器人)出于欺诈或恶意目的操纵内容。考虑到这一点，我们仍然有很多合理的理由来通过编程控制一个网站，并在这个过程中绕过验证码。</p><h2 id="d2a4" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">用木偶师建立一个简单的网络自动化工具</strong></h2><p id="7e1f" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我们可以编程控制网站的一种方法是使用木偶师。</p><p id="4bf9" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">Puppeteer是一个Node.js库，它提供了一个高级API来控制浏览器(通常是Chrome/Chromium，但是Puppeteer也支持其他浏览器，比如Firefox)。你可以在浏览器中做的大多数事情都可以用Puppeteer自动完成。木偶师网站提供了一堆例子，比如截图和生成网页的pdf，自动化表单提交，测试UI等等。</p><p id="7192" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">通常我会讲述如何使用木偶师，但我之前已经详细介绍过了。下面是我写的关于这个话题的文章:</p><div class="mi mj gp gr mk ml"><a href="https://sunilsandhu.com/posts/how-to-scrape-data-from-a-website-with-javascript" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd io gy z fp mq fr fs mr fu fw im bi translated">如何用JavaScript从网站上抓取数据</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">从一个网站(或多个网站)收集信息的过程通常被称为网络搜集或网络…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">sunilsandhu.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz km ml"/></div></div></a></div><p id="d634" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">所以，假设你有使用木偶剧的经验，或者已经花时间通读了上面的链接文章，让我们继续，看看我们如何用2Captcha绕过验证码。</p><h2 id="e2c4" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">什么是2Captcha？</strong></h2><p id="6447" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated"><a class="ae na" href="https://2captcha.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lm io"> 2Captcha </strong> </a>是一个图像和验证码识别服务。2Captcha的主要目的是由人类员工以快速准确的方式解决验证码。</p><p id="5200" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">2Captcha解决了许多不同的Captcha样式，所有这些样式都具有几乎相同的两个API端点。第一个请求传递验证码解析所必需的数据，并返回请求ID(或者在图像验证码的情况下返回base64-ed图像)。一旦您有了请求ID，那么您将需要向结果端点提交请求，我们经常查询结果端点，直到解决方案准备好。</p><p id="e6a5" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">您得到的响应是一个令牌，需要与表单一起提交，并且需要输入到一个隐藏的文本字段中。</p><h2 id="552c" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">注册2 cap cha</strong></h2><p id="87ab" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">2Captcha需要一个API密钥，您可以在注册时获得。为了使用这项服务，你还需要存入一些资金。幸运的是，你只需要几美元就可以启动并运行。</p><h1 id="fa8e" class="nb kp in bd kq nc nd ne kt nf ng nh kw jt ni ju la jw nj jx le jz nk ka li nl bi translated"><strong class="ak">如何绕过网站注册</strong></h1><p id="bd65" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">好了，现在2Captcha可以用来处理各种各样的ReCAPTCHAs。为了简单起见，我们将自动创建一个新的Reddit帐户，这样我们就可以绕过常见的“我不是机器人”验证码。</p><p id="2bd6" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">让我们回顾一下我们为解决这个问题而设置的流程。</p><h2 id="6617" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">第一步。为我们的项目创建一个文件夹</h2><p id="8299" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我把我的文件夹命名为<strong class="lm io"> reddit-bypasser </strong>，但是你可以随便叫你的文件夹。</p><h2 id="2f29" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">第二步。将潦草的回购克隆到我们的项目文件夹中</h2><p id="754c" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我们可以通过克隆GitHub的回购协议来做到这一点:<a class="ae na" href="https://github.com/sunil-sandhu/scrawly" rel="noopener ugc nofollow" target="_blank">https://github.com/sunil-sandhu/scrawly</a></p><h2 id="01a4" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">第三步。创建附加文件</h2><p id="ce42" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">创建一个名为<strong class="lm io"> 2captcha的文件夹。</strong>在这里，我们将有三个文件:<strong class="lm io"> apiKey.js </strong>、<strong class="lm io"> initiateRequest.js </strong>和<strong class="lm io"> getRequestResults.js </strong>。正如你所想象的，<strong class="lm io"> apiKey.js </strong>仅仅包含了我们的2Captcha API键，我们可以在2Captcha仪表板上找到它。<em class="nm">见下图:</em></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/ba9b7a3ad3b62fc8adc133eed01ef8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p1P0aVm2v59Lj744oRbeSg.png"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk"><a class="ae na" href="https://2captcha.com/enterpage" rel="noopener ugc nofollow" target="_blank">https://2captcha.com/enterpage</a> — the API can be found where the blurred red box would usually be.</figcaption></figure><p id="f9dc" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">用仪表板中的API键替换<strong class="lm io"> apiKey.js </strong>中的空字符串。</p><p id="e69a" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><strong class="lm io"> initiateRequest.js </strong>文件用于向2Captcha发出API请求。您会注意到，在这个文件中，我们有一个对象，它解释了我们计划跳过的ReCAPTCHA的类型。让我们一行一行地检查这个对象:</p><pre class="kd ke kf kg gt ns nt nu nv aw nw bi"><span id="4b2d" class="ko kp in nt b gy nx ny l nz oa">const formData = {<br/>  method: "userrecaptcha",<br/>  googlekey: "6LeTnxkTAAAAAN9QEuDZRpn90WwKk_R1TRW_g-JC",<br/>  key: captchaApiKey,<br/>  pageUrl: "https://old.reddit.com/login",<br/>  json: 1,<br/>};</span></pre><p id="6c86" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><code class="fe ob oc od nt b">method</code>:指我们正在绕过的类型或ReCAPTCHA。有多种类型可供选择，因此如果您不确定要绕过哪种类型，请参考2章节文档。这种情况下是<code class="fe ob oc od nt b">userrecaptcha</code>。</p><p id="0181" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><code class="fe ob oc od nt b">googlekey</code>:这是一个可以在页面上的ReCAPTCHA DOM元素中找到的键。您通常可以通过定位DOM元素并查找附加到<code class="fe ob oc od nt b">data-sitekey</code>的值来找到它。</p><p id="4613" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">这往往是一个静态值，所以一旦有了您试图绕过的特定页面的值，您就可以添加该值并继续前进。但是，如果您正在创建一个更复杂的动态bypasser，您可能希望查询这个DOM元素并在加载时获取值，而不是先获取值。</p><p id="877a" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">这个sitekey在我们的API请求期间被发送，以便2Captcha可以处理它并返回一个响应。</p><p id="4669" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><code class="fe ob oc od nt b">key</code>:这是你的API密匙。</p><p id="88c1" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><code class="fe ob oc od nt b">pageUrl</code>:绕过您正在查看的页面。</p><p id="ce36" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><code class="fe ob oc od nt b">json</code>:这是一个0或1的二进制值。这决定了您将从请求中收到的有效负载的类型。如果设置为<code class="fe ob oc od nt b">0</code>，将返回纯文本。如果设置为<code class="fe ob oc od nt b">1</code>，它将返回一个JSON对象，您随后需要用<code class="fe ob oc od nt b">JSON.parse()</code>解析该对象。</p><p id="bd52" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">这是我们整个函数的样子:</p><pre class="kd ke kf kg gt ns nt nu nv aw nw bi"><span id="2e2a" class="ko kp in nt b gy nx ny l nz oa">async function initiateRequest(captchaApiKey) {</span><span id="a974" class="ko kp in nt b gy oe ny l nz oa">  const formData = {<br/>    method: "userrecaptcha",<br/>    googlekey: "6LeTnxkTAAAAAN9QEuDZRpn90WwKk_R1TRW_g-JC",<br/>    key: captchaApiKey,<br/>    pageUrl: "https://old.reddit.com/login",<br/>    json: 1,<br/>  };</span><span id="38bd" class="ko kp in nt b gy oe ny l nz oa">  try {<br/>    const response = await request.post("http://2captcha.com/in.php", { form: formData });<br/>  <br/>    return JSON.parse(response).request;<br/>  } catch (error) {<br/>    console.log(error);<br/>  }</span><span id="d883" class="ko kp in nt b gy oe ny l nz oa">}</span></pre><p id="ea98" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">从<code class="fe ob oc od nt b">JSON.parse(response).request</code>返回的值然后作为参数传递给我们的<code class="fe ob oc od nt b">getRequestResults</code>函数。这个函数可以在<strong class="lm io"> getRequestResults.js </strong>中找到。这里我们只是每秒轮询一次API(这是一种技术上的说法，表示我们定期请求)，直到ReCAPTCHA完成。这是因为在2Captcha中，ReCAPTCHAs是由人类完成的。因此，有时可能需要10-45秒才能得到结果。</p><p id="2dc9" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><em class="nm">我不会在这里解释投票过程，但对于任何感兴趣的人，我建议回顾一下</em> <a class="ae na" href="https://jsoverson.medium.com/bypassing-captchas-with-headless-chrome-93f294518337" rel="noopener"> <em class="nm">这篇文章</em> </a> <em class="nm">作者</em><a class="of og ep" href="https://medium.com/u/a19804ea02f3?source=post_page-----13f6eb126f8--------------------------------" rel="noopener" target="_blank"><em class="nm">Jarrod Overson</em></a><em class="nm">。</em></p><p id="796a" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">ReCAPTCHAs通常在使用它们的页面上有一个隐藏的输入字段。当ReCAPTCHA完成时，隐藏的输入字段会填充一个唯一的值来表示它已经完成。</p><p id="f91e" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><strong class="lm io"> <em class="nm">注意:</em> </strong> <em class="nm">隐藏输入字段的ID通常是</em> <code class="fe ob oc od nt b"><em class="nm">g-recaptcha-response</em></code> <em class="nm">。</em></p><p id="190b" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">当2Captcha返回结果时，它实际上是返回需要添加到隐藏字段中的唯一值。因此，当值到达时，我们以编程方式将值添加到隐藏字段中，并继续注册过程。</p><p id="6143" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><strong class="lm io">main . js中的完整代码:</strong></p><pre class="kd ke kf kg gt ns nt nu nv aw nw bi"><span id="e61b" class="ko kp in nt b gy nx ny l nz oa">const interface = require("./scrawly/api/interface");<br/>const initiateRequest = require("./2captcha/initiateRequest");<br/>const getRequestResults = require("./2captcha/getgetRequestResults");<br/>const credentials = require("./credentials"); // username and password we're going to use when registering on Reddit<br/>const apiKey = require("./2captcha/apiKey");</span><span id="0880" class="ko kp in nt b gy oe ny l nz oa">(async () =&gt; {</span><span id="12ed" class="ko kp in nt b gy oe ny l nz oa">  await interface.init();<br/>  await interface.visitPage("https://old.reddit.com/login");<br/>  await interface.querySelectorInputAndType("#user_reg", credentials.username);<br/>  await interface.querySelectorInputAndType("#passwd_reg", credentials.password);<br/>  await interface.querySelectorInputAndType("#passwd2_reg", credentials.password);</span><span id="2130" class="ko kp in nt b gy oe ny l nz oa">  const requestId = await initiateRequest(apiKey);<br/>  const response = await getRequestResults(apiKey, requestId);</span><span id="7e83" class="ko kp in nt b gy oe ny l nz oa">  await interface.evaluatePage(`document.getElementById("g-recaptcha-response").innerHTML="${response}";`);<br/>  await interface.querySelectorButtonAndClick("#register-form button[type=submit]");</span><span id="0d0c" class="ko kp in nt b gy oe ny l nz oa">})();</span></pre><h2 id="f87b" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">结论</h2><p id="f7e7" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">我们做到了！我们已经自动化了注册Reddit的过程，绕过了ReCAPTCHA。在这样做的过程中，我们已经了解了Puppeteer，如何使用该工具，2Captcha是什么，如何注册2Captcha，以及如何将其集成到我们的自动化项目中。希望你现在有足够的信心在自己的项目中实现这一点。如果你有任何问题，不要犹豫，在评论中联系我们。</p></div><div class="ab cl oh oi hr oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ig ih ii ij ik"><h2 id="03e2" class="ko kp in bd kq kr ks dn kt ku kv dp kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">资源</h2><p id="9492" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls kx lt lu lv lb lw lx ly lf lz ma mb mc ig bi translated">潦草的GitHub:<a class="ae na" href="https://github.com/sunil-sandhu/scrawly" rel="noopener ugc nofollow" target="_blank">https://github.com/sunil-sandhu/scrawly</a></p><p id="9bb0" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated">完成本文的代码设置:<a class="ae na" href="https://github.com/sunil-sandhu/reddit-bypasser" rel="noopener ugc nofollow" target="_blank">https://github.com/sunil-sandhu/reddit-bypasser</a><em class="nm">(一旦克隆，您可能还需要将</em> <strong class="lm io"> <em class="nm">潦草地</em> </strong> <em class="nm"> repo克隆到该文件夹中)</em></p><p id="e20b" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><em class="nm">特别感谢</em><a class="of og ep" href="https://medium.com/u/a19804ea02f3?source=post_page-----13f6eb126f8--------------------------------" rel="noopener" target="_blank"><em class="nm">Jarrod Overson</em></a><em class="nm">，他的</em> <a class="ae na" href="https://jsoverson.medium.com/bypassing-captchas-with-headless-chrome-93f294518337" rel="noopener"> <em class="nm">原文</em> </a> <em class="nm">关于如何绕过Reddit充当了我尝试做同样事情的灵感。如果您想了解更多关于本文中使用的轮询功能的信息，我强烈推荐您阅读他的文章</em><a class="ae na" href="https://jsoverson.medium.com/bypassing-captchas-with-headless-chrome-93f294518337" rel="noopener"><em class="nm"/></a><em class="nm">，因为它涵盖了更多的细节。</em></p></div><div class="ab cl oh oi hr oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="ig ih ii ij ik"><p id="9a10" class="pw-post-body-paragraph lk ll in lm b ln md jo lp lq me jr ls kx mf lu lv lb mg lx ly lf mh ma mb mc ig bi translated"><em class="nm">更多内容请看</em><a class="ae na" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="lm io"><em class="nm">plain English . io</em></strong></a></p></div></div>    
</body>
</html>