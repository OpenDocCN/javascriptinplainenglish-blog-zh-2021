<html>
<head>
<title>When Self-Documenting Code is Not Enough</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当自文档化代码还不够时</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/when-self-documenting-code-is-not-enough-a964da7e74e?source=collection_archive---------10-----------------------#2021-04-01">https://javascript.plainenglish.io/when-self-documenting-code-is-not-enough-a964da7e74e?source=collection_archive---------10-----------------------#2021-04-01</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="cae3" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">自记录代码很好，但是什么时候不行呢？什么时候代码中有注释会让你受益？</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/aac8b8172e464e804c59cbddf8d75527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dw-p6HG9GNVqvs7Z"/></div></div></figure><p id="51f3" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我最近写了一篇关于自文档化代码的必要性以及如何实现这一点的文章。这篇文章很受欢迎，但是得到了一些关于在某些情况下如何需要代码注释的有效回应。</p><p id="d7eb" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">我从来没有打算让这篇文章意味着你不应该写注释，而是你不应该写注释来解释你的代码在做什么。</p><div class="lo lp gq gs lq lr"><a rel="noopener  ugc nofollow" target="_blank" href="/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3"><div class="ls ab fp"><div class="lt ab lu cl cj lv"><h2 class="bd is gz z fq lw fs ft lx fv fx iq bi translated">编写自文档化代码的终极指南</h2><div class="ly l"><h3 class="bd b gz z fq lw fs ft lx fv fx dk translated">厌倦了在代码中写注释吗？我们停止这样做，而是编写自文档化的代码</h3></div><div class="lz l"><p class="bd b dl z fq lw fs ft lx fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kq lr"/></div></div></a></div><p id="544d" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">相反，你在代码中写的注释应该解释<em class="mg">为什么</em>你的代码做某事，“做什么”应该是不言而喻的。</p><p id="fe99" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">有时评论可以解释你如何处理第三方工具的缺点，或者如何实现业务逻辑。例如，我最近在一个应用程序中实现了自动完成功能。它将为每一次击键启动一个API调用(显然有一个微小的超时来防止太多的调用)，但是我不能控制API调用响应的速度，也不能控制API调用返回的顺序，所以我在代码中构建了一个计数器，并忽略了任何不是来自上次搜索的结果。</p><p id="e363" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">虽然这可以从代码中理解，但最好用代码来阐明，所以我添加了一个注释来解释这一部分。我甚至不确定是否有人会去碰那段代码，因为我是唯一一个在处理这段代码的人，而且在这段代码被再次废弃之前，可能也是唯一一个在处理这段代码的人。但是谁知道呢，这些代码可能会存在10年，然后被另一个团队捡起来，我也不排除这种可能性。</p><p id="a799" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">所以，这是我的评论。</p><pre class="kh ki kj kk gu mh mi mj mk aw ml bi"><span id="083d" class="mm mn ir mi b gz mo mp l mq mr">// If we've initiated a different search since initiating this one, ignore these results, so we don't get "jumping" results or the results from not-the-last search</span></pre><p id="13e8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">有道理对吗？下面的代码行基本上是这样的。</p><pre class="kh ki kj kk gu mh mi mj mk aw ml bi"><span id="9735" class="mm mn ir mi b gz mo mp l mq mr">if (searchCounter !== currentSearchCounter) return;</span></pre><p id="8b14" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这一行代码可能解释了<em class="mg">正在做什么</em>，但是没有解释<em class="mg">为什么。对于自文档化代码，这是你必须理解的最重要的事情。它需要能够自己解释<em class="mg">它正在做什么</em>。</em></p><h2 id="6891" class="mm mn ir bd ms mt mu dn mv mw mx dp my lb mz na nb lf nc nd ne lj nf ng nh ni bi translated">业务逻辑解释</h2><p id="1461" class="pw-post-body-paragraph ks kt ir ku b kv nj js kx ky nk jv la lb nl ld le lf nm lh li lj nn ll lm ln ik bi translated">业务逻辑可能是必须用代码解释某些东西的最好理由之一。通常标签解释了为什么我们需要代码中的某个特性，并且通常有决定某个特性的有效论据，但是在实现之后这些信息就丢失了。</p><p id="08c7" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">您可以链接解释代码中所有内容的标签，但这可能不是最好的方法。我不止一次地在票务系统中看到不再使用的票，然后解释也随之消失。</p><p id="dbfb" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">当然，在这种情况下，评论可以被更新，票务系统的内容应该被保留，但是我们不是在完美的世界中，迁移到不同的票务系统的决定很可能不是你的，你没有任何时间来更新你的代码。</p><p id="6f41" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">即使你有，这些票也可能永远不会被转移到下一个系统，当它们被保存下来时，它们会被放在一个只有你的老板才能访问的Google Drive目录中。那么，您真的想去找您的老板，询问一张票的内容，这样您就可以得到一个包含所有附件的10GB的票系统zip文件，然后您必须搜索数千个JSON文件吗？或者更糟，XML！</p><p id="b634" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">所以你应该这样做。</p><ul class=""><li id="5545" class="no np ir ku b kv kw ky kz lb nq lf nr lj ns ln nt nu nv nw bi translated">确保你的代码确实需要一个解释。</li><li id="8579" class="no np ir ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated">如果是这样，尽可能用最短但最完整的方式总结票据的结论</li><li id="2a3f" class="no np ir ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated">如果你的评论有10行那么长是没问题的，真的。</li><li id="b25c" class="no np ir ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated">将该注释也添加到它所引用的部分。最好位于实现该逻辑的函数或类之上，或者位于与该功能相关的文件之上。</li></ul><p id="1e29" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">商业逻辑从局外人的角度来看并不总是有意义的，或者说需要你去思考。例如，如果你的应用程序有一个登录系统，每个电子邮件地址都被同等对待，除非地址以<code class="fe oc od oe mi b">@whatevercompany.com</code>结尾，因为在这种情况下，你有一个特殊的API来处理他们的请求。记住，他们是你的SaaS的一个好的付费客户，所以他们得到需要特殊对待的定制集成。</p><p id="3728" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">所以在你的代码中的某个地方，你已经添加了一个决定使用什么API端点的函数，并且<code class="fe oc od oe mi b">whatevercompany.com</code>被硬编码在你的代码中。也许这不是最理想的情况，但时间紧迫，必须这样做。</p><p id="743a" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">一年后，你转到了下一份工作，有人接替了你的位置，并问你要不要把所有东西都移植到一个新的API上。如果代码中没有解释为什么<code class="fe oc od oe mi b">whatevercompany</code>得到特殊待遇，他们可能会忽略这个逻辑，为API端点定义一个全局配置，修改几行处理API请求的代码，这样你就因为阻止访问定制功能而惹恼了你最大的客户。</p><p id="620a" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">是的，这是一个虚构的情况，很容易修补，客户会没事的。但是如果它打破了更大的东西呢？如果这段代码运行在移动应用程序上，而你需要等待苹果批准你的更新，而你的客户为此愤怒了一个星期，那该怎么办？</p><p id="2bc1" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这就是为什么您需要记录业务逻辑！</p><h2 id="092b" class="mm mn ir bd ms mt mu dn mv mw mx dp my lb mz na nb lf nc nd ne lj nf ng nh ni bi translated">代码流</h2><p id="53c2" class="pw-post-body-paragraph ks kt ir ku b kv nj js kx ky nk jv la lb nl ld le lf nm lh li lj nn ll lm ln ik bi translated">代码流是必须解释代码的另一个重要原因。为什么我们要按照一定的顺序调用一定的函数？</p><p id="12eb" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">有些问题不能通过正确命名函数来回答，它们有时需要适当的澄清。</p><p id="50b8" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">比如为什么修改密码后还需要做登录调用？也许API要求你在密码改变后重新认证(安全，耶！)，但为什么这是自动执行的呢？API不能在密码改变时返回一个令牌吗？</p><p id="e2da" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这类问题可能有些你已经有了答案。安全性很可能是您答案的一部分。但是<em class="mg">为什么</em>在你的代码中是这样实现的呢？</p><h2 id="9a30" class="mm mn ir bd ms mt mu dn mv mw mx dp my lb mz na nb lf nc nd ne lj nf ng nh ni bi translated">UX</h2><p id="ee01" class="pw-post-body-paragraph ks kt ir ku b kv nj js kx ky nk jv la lb nl ld le lf nm lh li lj nn ll lm ln ik bi translated">用户体验，或UX，是用户与应用程序交互的一个非常重要的部分。通常在法典中可以清楚地找到UX。</p><p id="e719" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">为什么安卓上有500ms的超时，而iOS上没有？(是的，我最近将它添加到了一个跨平台的应用程序中)。对我来说，答案是，iOS本身的行为不同，出于UX的目的，在Android上添加超时会让应用程序感觉更流畅。</p><p id="a3f9" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated">这对于代码阅读者来说并不明显，但是当你实现它的时候你就知道了。代码很可能是在您或使用该应用程序的其他人发现它有问题或不直观之后实现的。</p><h2 id="aad0" class="mm mn ir bd ms mt mu dn mv mw mx dp my lb mz na nb lf nc nd ne lj nf ng nh ni bi translated">结论</h2><p id="4094" class="pw-post-body-paragraph ks kt ir ku b kv nj js kx ky nk jv la lb nl ld le lf nm lh li lj nn ll lm ln ik bi translated">我举例说明了为什么应该在代码中添加注释，这些例子是我最近遇到的或者在写这篇文章时想到的。我相信你应该在代码中添加注释还有很多原因，但是最终，作为一名开发人员，你需要决定你添加代码注释的原因是什么。不过有一点是肯定的，确保你的理由是有效的，过多的注释会使代码更难阅读，而不是更容易。但是永远遵循黄金法则。</p><blockquote class="of"><p id="bce4" class="og oh ir bd oi oj ok ol om on oo ln dk translated">评论应该解释<em class="op">为什么</em>，而不是<em class="op">什么</em></p></blockquote><p id="cefa" class="pw-post-body-paragraph ks kt ir ku b kv oq js kx ky or jv la lb os ld le lf ot lh li lj ou ll lm ln ik bi translated">要了解更多关于自文档化代码的主题，请阅读我的相关文章。</p><div class="lo lp gq gs lq lr"><a rel="noopener  ugc nofollow" target="_blank" href="/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3"><div class="ls ab fp"><div class="lt ab lu cl cj lv"><h2 class="bd is gz z fq lw fs ft lx fv fx iq bi translated">编写自文档化代码的终极指南</h2><div class="ly l"><h3 class="bd b gz z fq lw fs ft lx fv fx dk translated">厌倦了在代码中写注释吗？我们停止这样做，而是编写自文档化的代码</h3></div><div class="lz l"><p class="bd b dl z fq lw fs ft lx fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ma l"><div class="mb l mc md me ma mf kq lr"/></div></div></a></div><p id="79aa" class="pw-post-body-paragraph ks kt ir ku b kv kw js kx ky kz jv la lb lc ld le lf lg lh li lj lk ll lm ln ik bi translated"><em class="mg">更多内容请看</em><a class="ae ov" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku is"><em class="mg">plain English . io</em></strong></a></p></div></div>    
</body>
</html>