<html>
<head>
<title>React Context — Simplified</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应上下文—简化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-context-simplified-86e1e8ce2d73?source=collection_archive---------4-----------------------#2021-02-27">https://javascript.plainenglish.io/react-context-simplified-86e1e8ce2d73?source=collection_archive---------4-----------------------#2021-02-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/7584e3620f90a6cf004392c3c405ff0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*BSZ8vrQ8OXkoclrsg_C3HA.png"/></div></figure><p id="9238" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">React组件可以存储一组被称为<strong class="jt io">状态</strong>的可观察属性。React可以根据状态值决定如何呈现自己。有时，通过在组件树中向下传递状态，在多个组件之间共享状态是很重要的。当组件树太深，应用程序变得更大时，使用props通过所有这些组件传递状态会造成混乱。</p><p id="3be4" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated"><strong class="jt io">上下文</strong>旨在解决这个问题。它将所有状态存储在一个中心位置，并在组件之间共享状态，而不必通过组件树向下传递它们。React <strong class="jt io">上下文</strong> API在一个地方管理应用程序的状态。它还使所有组件都可以访问该状态。</p><h1 id="92e1" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">问题</h1><p id="b708" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">为了总结react上下文API，我将创建一个应用程序，并向您展示如何向它添加上下文。</p><p id="c9f0" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我将只使用react创建一个todo列表应用程序。对于后端，我不会创建任何东西。我会利用<a class="ae ls" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jt io"> {JSON}占位符</strong> </a>。</p><h2 id="cfc1" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">要求</h2><p id="5329" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">本教程要求读者提供简单的反应概念。</p><h2 id="a31d" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">项目设置</h2><p id="92d9" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">使用bellow命令创建react.js应用程序。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="d7ce" class="lt kq in mk b gy mo mp l mq mr">npx create-react-app react-context-demo</span></pre><h2 id="681d" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">删除不必要的文件和代码</h2><p id="4823" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">删除<code class="fe ms mt mu mk b">src</code>文件夹中除<code class="fe ms mt mu mk b">App.js</code>和<code class="fe ms mt mu mk b">index.js</code>以外的所有文件。</p><h1 id="c2a4" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">启用反应上下文</h1><p id="cee6" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">要在react应用程序中启用上下文，我们需要遵循以下步骤:</p><ul class=""><li id="4ee9" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">创建上下文</li><li id="9973" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko na nb nc nd bi translated">使用减速器</li><li id="9ce1" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko na nb nc nd bi translated">提供背景</li><li id="642d" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko na nb nc nd bi translated">使用上下文</li></ul><h2 id="fd29" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">创建上下文</h2><p id="aece" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">React.js提供<code class="fe ms mt mu mk b">createContext()</code>钩子。这个钩子接收一个参数作为初始状态，并返回一个上下文。在我们的例子中，我们创建了一个上下文，并将包含一个空列表<code class="fe ms mt mu mk b">todos</code>的初始状态传递给它。</p><ul class=""><li id="9c4a" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">在<code class="fe ms mt mu mk b">src</code>文件夹中创建一个名为<code class="fe ms mt mu mk b">TodoContext.js</code>的文件，并添加以下代码。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5783" class="lt kq in mk b gy mo mp l mq mr">import React, { createContext } from 'react';<br/>const initialState = {<br/>   todos: []<br/>};<br/>export const TodosContext = createContext(initialState);</span></pre><h2 id="e05a" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">使用减速器</h2><p id="61b2" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">Reducer是一个接收两个参数<code class="fe ms mt mu mk b">state</code>和<code class="fe ms mt mu mk b">action</code>并返回一个普通JavaScript <code class="fe ms mt mu mk b">object</code>的函数。通常动作有两个变量<code class="fe ms mt mu mk b">type</code>和<code class="fe ms mt mu mk b">payload</code>。</p><ul class=""><li id="ffa9" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">在<code class="fe ms mt mu mk b">src</code>文件夹中创建一个名为<code class="fe ms mt mu mk b">TodoReducer.js</code>的文件。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="009f" class="lt kq in mk b gy mo mp l mq mr">import React, { useReducer }  from 'react';<br/>function todosReducer(state, action) {<br/>   switch(action.type) {<br/>      case "FETCH_TODOS":<br/>         return {<br/>            ...state,<br/>            todos: action.payload,<br/>         };<br/>      case "CREATE_TODO":<br/>         return {<br/>            ...state,<br/>            todos: [...state.todos, action.payload],<br/>         };<br/>      default:<br/>         return state;<br/>   }<br/>}</span></pre><ul class=""><li id="4e2c" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">后来我们用这个减速器用<code class="fe ms mt mu mk b">useReducer</code>挂钩。它返回具有两个值的元组:</li></ul><ol class=""><li id="5587" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko nj nb nc nd bi translated">State:它是应用程序的状态。它需要传递给提供者。</li><li id="0616" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko nj nb nc nd bi translated">调度:需要调度reducer动作。</li></ol><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="ad27" class="lt kq in mk b gy mo mp l mq mr">const [<strong class="mk io">state</strong>, <strong class="mk io">dispatch</strong>] = <strong class="mk io"><em class="nk">useReducer</em></strong>(todoReducer, initialState);</span></pre><h2 id="9edf" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">提供背景</h2><p id="3a89" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">上下文是使用<code class="fe ms mt mu mk b">createContext</code>挂钩创建的，在我们的例子<code class="fe ms mt mu mk b">TodoContext</code>中，上下文提供者<code class="fe ms mt mu mk b">TodoContext.Provider</code>提供了上下文。</p><ul class=""><li id="17fe" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">我们必须与提供商一起包装整个应用程序。因此，我们创建了一个返回带有子代的<code class="fe ms mt mu mk b">TodoContext.Provider</code>的组件。</li><li id="2864" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko na nb nc nd bi translated">在名为<code class="fe ms mt mu mk b">TodoContextProvider</code>的<code class="fe ms mt mu mk b">TodoContext.js</code>文件中创建一个reaction组件(一个JavaScript函数)。</li><li id="2ea1" class="mv mw in jt b ju ne jy nf kc ng kg nh kk ni ko na nb nc nd bi translated"><strong class="jt io">减速箱动作</strong>也在<code class="fe ms mt mu mk b">TodoContextProvider</code>部件内部定义。他们称<strong class="jt io">分派</strong>的方法来源于<code class="fe ms mt mu mk b">useReducer</code>挂钩。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="3559" class="lt kq in mk b gy mo mp l mq mr">// Create Provider<br/>export function TodoContextProvider({ children }) {<br/>  // Use reducer<br/>  const [state, dispatch] = useReducer(todoReducer, initialState);<br/>  <br/>  // Define reducer actions<br/>  function fetchTodos(todos) {<br/>    dispatch({<br/>      type: "FETCH_TODOS",<br/>      payload: todos,<br/>    });<br/>  }<br/>  <br/>  function saveTodo(todo) {<br/>    dispatch({<br/>      type: "SAVE_TODO",<br/>      payload: todo,<br/>    });<br/>  }</span><span id="d552" class="lt kq in mk b gy nl mp l mq mr">  return (<br/>    &lt;TodoContext.Provider<br/>      value={{<br/>        todos: state.todos,<br/>        fetchTodos,<br/>        saveTodo,<br/>      }}<br/>    &gt;<br/>    {children}<br/>    &lt;/TodoContext.Provider&gt;<br/>  );<br/>}</span></pre><ul class=""><li id="e6c2" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">在我们的<code class="fe ms mt mu mk b">index.js</code>文件中，用<code class="fe ms mt mu mk b">TodoContextProvider</code>包裹<code class="fe ms mt mu mk b">App</code>部件。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5c39" class="lt kq in mk b gy mo mp l mq mr">&lt;TodoContextProvider&gt;<br/>  &lt;App /&gt;<br/>&lt;/TodoContextProvider&gt;</span></pre><h2 id="c681" class="lt kq in bd kr lu lv dn kv lw lx dp kz kc ly lz ld kg ma mb lh kk mc md ll me bi translated">使用上下文</h2><p id="0b8b" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">有多种方法可以在组件内部使用上下文并获取状态或更新状态。</p><ul class=""><li id="b5af" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">获取状态的示例。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="7e5e" class="lt kq in mk b gy mo mp l mq mr">import React, { useContext, useEffect } from "react";<br/>import { TodoContext } from "../TodoContext";</span><span id="44b0" class="lt kq in mk b gy nl mp l mq mr">export default function ListTodos() {<br/>  const { todos } = useContext(TodoContext);<br/>  return (<br/>    &lt;div className="col-8"&gt;<br/>      &lt;table className="table table-hover"&gt;<br/>        &lt;thead&gt;<br/>          &lt;tr&gt;<br/>            &lt;th&gt;#&lt;/th&gt;<br/>            &lt;th&gt;Title&lt;/th&gt;<br/>            &lt;th&gt;Completed&lt;/th&gt;<br/>            &lt;th&gt;&lt;/th&gt;<br/>          &lt;/tr&gt;<br/>        &lt;/thead&gt;<br/>      &lt;tbody&gt;<br/>      {todos.map((todo, index) =&gt; (<br/>        &lt;tr key={index}&gt;<br/>          &lt;td&gt;{index + 1}&lt;/td&gt;<br/>          &lt;td&gt;{todo.title}&lt;/td&gt;<br/>          &lt;td <br/>            className={todo.completed<br/>              ? "text-primary"<br/>              : "text-warning"}<br/>          &gt;<br/>            {todo.completed ? "completed" : "uncompleted"}<br/>          &lt;/td&gt;<br/>        &lt;/tr&gt;<br/>      ))}<br/>      &lt;/tbody&gt;<br/>    &lt;/table&gt;<br/>  &lt;/div&gt;);<br/>}</span></pre><ul class=""><li id="9962" class="mv mw in jt b ju jv jy jz kc mx kg my kk mz ko na nb nc nd bi translated">更新状态的示例。</li></ul><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="e1c1" class="lt kq in mk b gy mo mp l mq mr">import React, { useContext, useState } from 'react';</span><span id="daf2" class="lt kq in mk b gy nl mp l mq mr">function CreateTodo() {<br/>   const { createTodo } = useContext(TodoContext);<br/>   const [title, setTitle] = useState('');</span><span id="3009" class="lt kq in mk b gy nl mp l mq mr">   function handleClick() {<br/>      createTodo({<br/>         title<br/>      });<br/>   }</span><span id="f75e" class="lt kq in mk b gy nl mp l mq mr">   return (<br/>      &lt;&gt;<br/>         &lt;input<br/>            type="text"<br/>            onChange={e =&gt; setTitle(e.target.name)}<br/>         /&gt;<br/>         &lt;button onClick={handleClick}&gt;Save&lt;/button&gt;<br/>      &lt;/&gt;<br/>   );<br/>}</span></pre><h1 id="6b02" class="kp kq in bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="0fb6" class="pw-post-body-paragraph jr js in jt b ju ln jw jx jy lo ka kb kc lp ke kf kg lq ki kj kk lr km kn ko ig bi translated">当在内部reactor应用程序中使用时，React Context是一个强大的工具。它简化了检索状态或更新状态，而不需要向下传递组件层次结构的支柱。更重要的是，反应上下文将UI与状态分开。</p><p id="0dd8" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">你可以找到打开这个<a class="ae ls" href="https://github.com/bewarusman/react-context" rel="noopener ugc nofollow" target="_blank">仓库</a>获得更完整的例子。</p><p id="c5e7" class="pw-post-body-paragraph jr js in jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ig bi translated">我想听听是否有任何误解或错误。</p></div></div>    
</body>
</html>