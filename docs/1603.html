<html>
<head>
<title>Promises in JavaScript Explained With Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用例子解释JavaScript中的承诺</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/promises-in-javascript-explained-with-examples-deb1bf6dfdd0?source=collection_archive---------4-----------------------#2021-04-06">https://javascript.plainenglish.io/promises-in-javascript-explained-with-examples-deb1bf6dfdd0?source=collection_archive---------4-----------------------#2021-04-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8e2c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过实例了解JavaScript中的承诺。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d3b919c8724acadcea79672a4781b43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jD1vsGOz7I4nWM1N"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">James Harrison</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e65f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">承诺是困扰许多初学者的重要JavaScript特性之一。它们看起来很难理解，但是如果你花时间去了解它们，它们会简单得多。</p><p id="6788" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JavaScript中的承诺与现实生活中的承诺非常相似，你承诺做某事，你要么完成，要么无法实现。</p><p id="dab9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将通过实际例子来学习JavaScript中的承诺。所以让我们开始吧。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c3f6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">什么是承诺，为什么我们要使用它？</h1><p id="742b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">承诺是ES6非常重要的特征之一。如我所说，把它们想象成我们在现实生活中做出的承诺。当你承诺做某事时，有两种结果:你是否完成了承诺或没有完成。</p><p id="f678" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">同样的事情也适用于JavaScript中的承诺。承诺有三种可能的结果:</p><ul class=""><li id="c51d" class="mw mx iq ky b kz la lc ld lf my lj mz ln na lr nb nc nd ne bi translated">待定:当承诺仍处于待定状态时(初始状态)。</li><li id="b361" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">履行:当承诺实现并得到解决(成功)。</li><li id="9fa2" class="mw mx iq ky b kz nf lc ng lf nh lj ni ln nj lr nb nc nd ne bi translated">拒绝:当承诺失败时(拒绝)。</li></ul><p id="312e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通常将这些承诺用于异步操作(当您有多个任务需要同时运行时)。所以我们用它们来提供未来某个时刻的结果或任务。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="884f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">创造你的第一个承诺</h1><p id="a933" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在JavaScript中，promise只是我们使用关键字<code class="fe nk nl nm nn b">new</code>和构造函数<code class="fe nk nl nm nn b">Promise</code>创建的一个对象。</p><p id="dfa6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">构造函数<code class="fe nk nl nm nn b">Promise</code>接受一个回调函数，该函数有两个参数:<code class="fe nk nl nm nn b">resolve</code>(当承诺成功时)和<code class="fe nk nl nm nn b">reject</code>(当承诺失败时)。</p><p id="7d0f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">看看下面的例子:</p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="ec63" class="ns ma iq nn b gy nt nu l nv nw">const ourPromise = <strong class="nn ir">new</strong> <strong class="nn ir">Promise</strong>((<strong class="nn ir">resolve</strong>, <strong class="nn ir">reject</strong>) =&gt; {<br/> //Your code here.<br/>});</span></pre><p id="2a3c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，我们通过向构造函数<code class="fe nk nl nm nn b">Promise</code>传递一个具有两个参数(<code class="fe nk nl nm nn b">resolve</code>和<code class="fe nk nl nm nn b">reject</code>)的函数，创建了一个承诺<code class="fe nk nl nm nn b">ourPromise</code>。我们没有兑现那个承诺。这就是它处于挂起状态的原因。</p><p id="f902" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们把它打印到控制台上，向您展示结果:</p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="51cb" class="ns ma iq nn b gy nt nu l nv nw"><strong class="nn ir">console.log(ourPromise);</strong></span></pre><p id="e51f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">输出:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/e647d8264dc1fdb0ced9bcf26a6e8479.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*bCBQtr42-e_cFJ49syTdEg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Capture from the console.</figcaption></figure><p id="4078" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如你所见，状态为pending，承诺返回<code class="fe nk nl nm nn b">undefined</code>，因为我们没有对承诺做任何事情，我们只是将回调函数传递给了构造函数。我们根本没有完成承诺。</p><h1 id="8236" class="lz ma iq bd mb mc nz me mf mg oa mi mj jw ob jx ml jz oc ka mn kc od kd mp mq bi translated">使用解决和拒绝</h1><p id="2783" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们在上一个例子中创建的承诺停留在待定状态。现在，让我们创建一个承诺，它可以根据情况解决(成功)或拒绝(失败)任务。</p><p id="06de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="a592" class="ns ma iq nn b gy nt nu l nv nw">const ourPromise = <strong class="nn ir">new Promise</strong>((<strong class="nn ir">resolve</strong>, <strong class="nn ir">reject</strong>) =&gt; {<br/>let number = 6 + 4;</span><span id="6b0f" class="ns ma iq nn b gy oe nu l nv nw">  if(number === 10) {<br/>    <strong class="nn ir">resolve</strong>("Promise was fulfilled");<br/>  } else {<br/>    <strong class="nn ir">reject</strong>("Promise was rejected");<br/>  }<br/>});</span><span id="deb3" class="ns ma iq nn b gy oe nu l nv nw"><strong class="nn ir">console.log(ourPromise);</strong> //output: Promise was fulfilled</span></pre><p id="d55e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">输出:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/33bff2694ccefac86300fd077a45a185.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*iRzloFhH5KNDiZUwaw27-A.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Capture from the console.</figcaption></figure><p id="7015" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的例子中，因为数字等于10，所以承诺实现了。因此，<code class="fe nk nl nm nn b">ourPromise</code>返回一个函数<code class="fe nk nl nm nn b">Promise</code>,该函数显示已完成的状态和我们在resolve函数中传递的消息。</p><p id="ac27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是另一个拒绝承诺的例子:</p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="991d" class="ns ma iq nn b gy nt nu l nv nw">const ourPromise = <strong class="nn ir">new Promise</strong>((<strong class="nn ir">resolve</strong>, <strong class="nn ir">reject</strong>) =&gt; {<br/>let number = null;</span><span id="988f" class="ns ma iq nn b gy oe nu l nv nw">if(number === 10) {<br/>    <strong class="nn ir">resolve</strong>("Promise was fulfilled");<br/>  } else {<br/>    <strong class="nn ir">reject</strong>("Promise was rejected");<br/>  }<br/>});</span><span id="2184" class="ns ma iq nn b gy oe nu l nv nw"><strong class="nn ir">console.log(ourPromise);</strong> //output: Promise was rejected</span></pre><p id="0321" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">输出:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/1216e717aa5f4983f262f0518d61dabd.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*bx1o-ZUgpxKCMy1RnaaukA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Capture from the console.</figcaption></figure><p id="7a62" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您在输出图像中看到的，承诺在这种情况下被拒绝，因为数字变量是<code class="fe nk nl nm nn b">null</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="1540" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">履行承诺</h1><p id="b4be" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当承诺实现或被拒绝时，你需要对结果做些什么。例如，当您从一个API请求数据时，需要时间来获得响应。但是当您获得数据时，您将需要对它做一些事情，比如在UI上显示它。</p><p id="6ac4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，我们使用方法<code class="fe nk nl nm nn b">then()</code>来处理实现的承诺。另一方面，我们使用<code class="fe nk nl nm nn b">catch()</code>方法来处理被拒绝的承诺。</p><p id="4f28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这两个方法<code class="fe nk nl nm nn b">then</code>和<code class="fe nk nl nm nn b">catch</code>以一个函数作为参数。在这个函数中，你写下你想对响应做什么。</p><p id="2002" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="021a" class="ns ma iq nn b gy nt nu l nv nw">const ourPromise = <strong class="nn ir">new Promise</strong>((<strong class="nn ir">resolve</strong>, <strong class="nn ir">reject</strong>) =&gt; {<br/>let number = 5 + 5;</span><span id="57c3" class="ns ma iq nn b gy oe nu l nv nw">if(number === 10) {<br/>    <strong class="nn ir">resolve</strong>("succeed");<br/>  } else {<br/>    <strong class="nn ir">reject</strong>("failed");<br/>  }<br/>})<strong class="nn ir">.then(response </strong>=&gt; console.log('Promise ' + <strong class="nn ir">response</strong>)<strong class="nn ir">)</strong><br/><strong class="nn ir">.catch(error </strong>=&gt; console.log(<strong class="nn ir">error</strong>)<strong class="nn ir">)</strong>;</span><span id="6df9" class="ns ma iq nn b gy oe nu l nv nw">//output: Promise succeed</span></pre><p id="5b8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">正如您所看到的，由于承诺已经实现(数字变量等于10)，方法<code class="fe nk nl nm nn b">then</code>被执行，参数<code class="fe nk nl nm nn b">response</code>被设置为我们在resolve函数中传递的值。这就是为什么我们得到<code class="fe nk nl nm nn b">Promise succeed</code>的结果。</p><p id="91c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果承诺被拒绝，方法<code class="fe nk nl nm nn b">catch</code>而不是<code class="fe nk nl nm nn b">then</code>被执行，参数<code class="fe nk nl nm nn b">error</code>被设置为我们在reject函数中传递的值。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c487" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">回电与承诺的例子</h1><p id="a3be" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">使用回调或承诺的一个常见情况是当我们想要等待超时(异步操作)时。</p><p id="9dc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">回调示例:</em></p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="c690" class="ns ma iq nn b gy nt nu l nv nw"><strong class="nn ir">setTimeout</strong>(function(){<br/> sendMessage("Displays after 3 seconds");<br/>}, 3000);<br/><br/>function sendMessage(message) {<br/>  console.log(message);<br/>}</span><span id="36f7" class="ns ma iq nn b gy oe nu l nv nw">//output: Displays after 3 seconds</span></pre><p id="fe7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">使用承诺的相同示例:</em></p><pre class="kg kh ki kj gt no nn np nq aw nr bi"><span id="eded" class="ns ma iq nn b gy nt nu l nv nw">let ourPromise = <strong class="nn ir">new Promise</strong>((resolve, reject)=&gt; {<br/> <strong class="nn ir">setTimeout</strong>(()=&gt; resolve("Displays after 3 seconds"),3000);<br/>})<br/>.<strong class="nn ir">then</strong>(response =&gt; console.log(response))<br/>.catch(error =&gt; console.log(error));</span><span id="04b0" class="ns ma iq nn b gy oe nu l nv nw">//output: Displays after 3 seconds</span></pre><p id="40a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">承诺在我看来比回调干净多了。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d6b4" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="e67b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">综上所述，我想说当你想做异步操作时，比如等待一个文件、获取数据等等，可以使用承诺。在我看来，它们比使用回调简单得多。</p><p id="e36d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢您阅读这篇文章。希望你觉得有用。</p><p id="8711" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">更多阅读</strong></p><div class="oh oi gp gr oj ok"><a rel="noopener  ugc nofollow" target="_blank" href="/5-useful-javascript-features-that-nobody-is-talking-about-b630838dedba"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">没有人谈论的5个有用的JavaScript特性</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">你应该知道的冷门JavaScript特性。</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kp ok"/></div></div></a></div><p id="5514" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nx">更多内容尽在</em> <a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir"> <em class="nx">说白了</em> </strong> </a></p></div></div>    
</body>
</html>