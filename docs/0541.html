<html>
<head>
<title>React Fast Refresh — The New React Hot Reloader</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React快速刷新—新的React热重装器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-fast-refresh-the-new-react-hot-reloader-652c6645548c?source=collection_archive---------0-----------------------#2021-02-02">https://javascript.plainenglish.io/react-fast-refresh-the-new-react-hot-reloader-652c6645548c?source=collection_archive---------0-----------------------#2021-02-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="69f8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用React快速刷新的全面指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c814797e0ba805dfaa9f8aabd600c61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0Bkbotoh5iCXjX0D"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="1eb5" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">我的旅程</h1><p id="bbcc" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在为一篇中型文章构建基于Create React应用程序的演示时，我注意到一些意想不到的事情——当我编辑源代码时，我的应用程序会更新，但我的状态会保持不变。我期待着我的状态被重置，就像我在其他项目中工作过无数次一样。我很困惑，认为我的应用程序实际上没有正确热重装。但是随着我的深入研究，我发现这是一个令人兴奋的新特性。</p><h1 id="43d0" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">快速刷新反应</h1><p id="6add" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我体验的这一新功能是反应快速刷新。它是React热重装的最新迭代。编辑React组件时，React快速刷新将有效地只更新和重新渲染该组件。这导致热重装时间明显加快。此外，React快速刷新将在重新渲染期间保留组件状态，因此您无需再次手动创建相同的场景。这些“快速”和无痛的重新渲染创造了卓越的开发人员体验，使变化和结果之间的反馈循环明显更有效。</p><h1 id="302b" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">创建React应用</h1><p id="f3b2" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">从4.x开始，Create React App默认启用React快速刷新。如果您的项目是基于Create React App构建的，您需要做的就是升级。</p><h1 id="a961" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">自定义网络包</h1><p id="233a" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">如果您的项目使用自定义Webpack配置而不是Create React App，启用React快速刷新仍然非常简单。首先，安装<code class="fe mh mi mj mk b">react-refresh</code>和<code class="fe mh mi mj mk b"><a class="ae ks" href="http://twitter.com/pmmmwh/react-refresh-webpack-plu" rel="noopener ugc nofollow" target="_blank">@pmmmwh/react-refresh-webpack-plu</a>gin</code>库。<code class="fe mh mi mj mk b">react-refresh</code>包含支持React Fast Refresh的热重装所需的基本工具，<code class="fe mh mi mj mk b">react-refresh-webpack-plugin</code>是启用<code class="fe mh mi mj mk b">react-refresh</code>所需的Webpack插件。</p><p id="cb95" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">然后，将<code class="fe mh mi mj mk b">react-refresh/babel</code> Babel插件添加到Babel配置文件中</p><pre class="kd ke kf kg gt mq mk mr ms aw mt bi"><span id="caa7" class="mu ku in mk b gy mv mw l mx my">// babel.config.js</span><span id="4468" class="mu ku in mk b gy mz mw l mx my">module.exports = function babel(api) {<br/>  const BABEL_ENV = api.env();<br/>  const presets = [...];<br/>  const plugins = [...];<br/>  if (BABEL_ENV === 'development') {<br/>    plugins.push('react-refresh/babel');<br/>  }<br/>  return {<br/>    presets,<br/>    plugins,<br/>  };<br/>};</span></pre><p id="691b" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">并将<code class="fe mh mi mj mk b">react-refresh-webpack-plugin</code>插件添加到Webpack配置文件中。</p><pre class="kd ke kf kg gt mq mk mr ms aw mt bi"><span id="73f4" class="mu ku in mk b gy mv mw l mx my">// webpack.config.js</span><span id="45db" class="mu ku in mk b gy mz mw l mx my">const ReactRefreshWebpackPlugin = require('<a class="ae ks" href="http://twitter.com/pmmmwh/react-refresh-webpack-plu" rel="noopener ugc nofollow" target="_blank">@pmmmwh/react-refresh-webpack-plu</a>gin');</span><span id="c147" class="mu ku in mk b gy mz mw l mx my">module.exports = {<br/>  ...<br/>  plugins: [<br/>    new ReactRefreshWebpackPlugin(),<br/>  ],<br/>};</span></pre><p id="45f4" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">或者，您可以直接在Webpack配置中指定babel插件，而不是Babel配置文件。</p><pre class="kd ke kf kg gt mq mk mr ms aw mt bi"><span id="17ef" class="mu ku in mk b gy mv mw l mx my">// webpack.config.js</span><span id="6449" class="mu ku in mk b gy mz mw l mx my">const ReactRefreshWebpackPlugin = require('<a class="ae ks" href="http://twitter.com/pmmmwh/react-refresh-webpack-plu" rel="noopener ugc nofollow" target="_blank">@pmmmwh/react-refresh-webpack-plu</a>gin');</span><span id="587e" class="mu ku in mk b gy mz mw l mx my">module.exports = {<br/>  ...<br/>  plugins: [<br/>    new ReactRefreshWebpackPlugin(),<br/>  ],<br/>  module: {<br/>    rules: [<br/>      {<br/>        test: /\.[jt]sx?$/,<br/>        exclude: /node_modules/,<br/>        loader: 'babel-loader',<br/>        options: {<br/>          plugins: ['react-refresh/babel'],<br/>        },<br/>      },<br/>    ],<br/>  },<br/>};</span></pre><p id="a140" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">就是这样，现在您应该拥有React为您的项目提供的最新、最棒的热重装程序了！</p><h1 id="7d02" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">使残废</h1><p id="a952" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">状态的保存是很好的，但是有时候你可能不想保存状态。React快速刷新用<code class="fe mh mi mj mk b">// @refresh reset</code>注释支持这一点。如果一个组件被编辑，并且这个注释存在于文件中的某个地方，那么React快速刷新将强制重新装载该组件，这将重置该组件的状态。</p><p id="b74c" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">如果你发现自己不断地添加这个评论或者面对下面讨论的<a class="ae ks" href="#d493" rel="noopener ugc nofollow">的一些限制，你可能想要采取激烈的方法，不要使用React Fast Refresh all。Create React App提供了<code class="fe mh mi mj mk b">FAST_REFRESH</code>标志来禁用它，并使用旧的热重装程序。这可以通过运行<code class="fe mh mi mj mk b">FAST_REFRESH=false npm start</code>或将<code class="fe mh mi mj mk b">FAST_REFRESH=false</code>添加到<code class="fe mh mi mj mk b">.env</code>文件中来完成。如果您正在使用自己的定制Webpack，只需删除上面</a>提到的<a class="ae ks" href="#a961" rel="noopener ugc nofollow">中的配置更改。</a></p><h1 id="d493" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">限制</h1><p id="71dc" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">不幸的是，React快速刷新确实有一些限制。如果React快速刷新不能确定更新哪些React组件，它将做安全的事情，并回退到进行完全重新加载。如果使用未命名/匿名和非PascalCased React组件，就会出现这种情况，因为React快速刷新无法静态确定代码是否与React相关。</p><p id="962d" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">如果您编辑最终导致root的文件，即使文件中的某些代码与React相关，也会发生完全重新加载。React快速刷新不能保证与React无关的内容可以热重新加载，因此它认为不能。</p><p id="eead" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated">此外，React Fast Refresh的状态保持对类组件不起作用——它只对函数组件和钩子起作用。以前的热重载迭代对类组件有效，但是以一种不安全的方式，可能导致不正确的意外行为。React快速刷新侧重于安全，所以它目前不支持类组件。</p><h1 id="badc" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">预发行</h1><p id="1f2e" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在撰写本文时，<code class="fe mh mi mj mk b">react-refresh</code>和<code class="fe mh mi mj mk b"><a class="ae ks" href="http://twitter.com/pmmmwh/react-refresh-webpack-plu" rel="noopener ugc nofollow" target="_blank">@pmmmwh/react-refresh-webpack-plu</a>gin </code>都是v1之前的版本，所以可能会有问题。话虽如此，脸书团队对这些库有足够的信心，在Create React App 4.x中默认启用它。对我来说，仅此一点就足以开始在我的项目中使用它。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="a268" class="kt ku in bd kv kw nh ky kz la ni lc ld jt nj ju lf jw nk jx lh jz nl ka lj lk bi translated">最后的想法</h1><p id="e747" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">了解了React Fast Refresh之后，我将它集成到了我所有的项目中。通过仅在必要时智能热重装和维护应用程序状态，它使开发效率大大提高。现在，我可以更快地在UI中反映我的更改，并且它会自动处于与以前相同的状态。虽然有一些限制，但我没有遇到任何根本性的问题，更糟糕的是，它的行为与上一代热重装程序完全一样。React快速刷新绝对是现有React热重装的优秀继承者。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="1361" class="kt ku in bd kv kw nh ky kz la ni lc ld jt nj ju lf jw nk jx lh jz nl ka lj lk bi translated">资源</h1><ul class=""><li id="5413" class="nm nn in ln b lo lp lr ls lu no ly np mc nq mg nr ns nt nu bi translated"><a class="ae ks" href="https://www.npmjs.com/package/react-refresh" rel="noopener ugc nofollow" target="_blank">官方反应刷新文档</a></li><li id="1e8a" class="nm nn in ln b lo nv lr nw lu nx ly ny mc nz mg nr ns nt nu bi translated"><a class="ae ks" href="https://www.npmjs.com/package/@pmmmwh/react-refresh-webpack-plugin/v/latest" rel="noopener ugc nofollow" target="_blank">官方React刷新Webpack插件文档</a></li></ul></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h2 id="a349" class="mu ku in bd kv oa ob dn kz oc od dp ld lu oe of lf ly og oh lh mc oi oj lj ok bi translated">进一步阅读</h2><div class="ol om gp gr on oo"><a rel="noopener  ugc nofollow" target="_blank" href="/5-tips-to-scale-up-your-react-apps-8fb68319062e"><div class="op ab fo"><div class="oq ab or cl cj os"><h2 class="bd io gy z fp ot fr fs ou fu fw im bi translated">扩展React应用的5个技巧</h2><div class="ov l"><h3 class="bd b gy z fp ot fr fs ou fu fw dk translated">1.将Bit用于可组合设计2。设计令牌3。网络请求的定制钩子4。客户端与服务器状态5。一个…</h3></div><div class="ow l"><p class="bd b dl z fp ot fr fs ou fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ox l"><div class="oy l oz pa pb ox pc km oo"/></div></div></a></div></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="9e03" class="pw-post-body-paragraph ll lm in ln b lo ml jo lq lr mm jr lt lu mn lw lx ly mo ma mb mc mp me mf mg ig bi translated"><em class="pd">更多内容看</em> <a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">说白了就是</em> </strong> </a> <em class="pd">。报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">免费周报</em> </strong> </a> <em class="pd">。关注我们关于</em> <a class="ae ks" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">推特</em> </strong> </a>，<a class="ae ks" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">领英</em> </strong> </a> <em class="pd">，</em><a class="ae ks" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="pd">YouTube</em></strong></a><em class="pd">，以及</em> <a class="ae ks" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">不和</em> </strong> </a> <em class="pd">。对增长黑客感兴趣？检查</em> <a class="ae ks" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="ln io"> <em class="pd">电路</em> </strong> </a> <em class="pd">。</em></p></div></div>    
</body>
</html>