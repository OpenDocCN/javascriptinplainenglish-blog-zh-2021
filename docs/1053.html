<html>
<head>
<title>Create a Copy &amp; Search Chrome Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建一个复制和搜索Chrome扩展</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/copy-search-chrome-extension-1a1ac95adae4?source=collection_archive---------8-----------------------#2021-03-05">https://javascript.plainenglish.io/copy-search-chrome-extension-1a1ac95adae4?source=collection_archive---------8-----------------------#2021-03-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="40a9" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">复制一些文本，搜索这些文本。简单。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8ce7703dc03eb7d53b7d2b03ba2eb26f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJKTwQrriWfrGhl3LGrr1w.jpeg"/></div></div></figure><p id="d825" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">本教程使用了一个样板谷歌浏览器扩展设置。如果你想知道如何设置，请点击这里查看我们的文章:</p><div class="ll lm gp gr ln lo"><a href="https://anobjectisa.medium.com/how-does-a-chrome-extension-work-web-development-6e85bd2bccc1" rel="noopener follow" target="_blank"><div class="lp ab fo"><div class="lq ab lr cl cj ls"><h2 class="bd io gy z fp lt fr fs lu fu fw im bi translated">Chrome扩展是如何工作的？(网络开发)</h2><div class="lv l"><h3 class="bd b gy z fp lt fr fs lu fu fw dk translated">Chrome扩展有5个部分:</h3></div><div class="lw l"><p class="bd b dl z fp lt fr fs lu fu fw dk translated">anobjectisa.medium.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc km lo"/></div></div></a></div><h1 id="7b91" class="md me in bd mf mg mh mi mj mk ml mm mn jt mo ju mp jw mq jx mr jz ms ka mt mu bi translated">《丛林奇兵》</h1><p id="65cc" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">我们将有一个简单的HTML页面，允许用户选择搜索引擎；这个页面将成为我们Chrome扩展中的<strong class="kq io">弹出窗口</strong>。</p><p id="0192" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<strong class="kq io">前台</strong>脚本中，我们将监听用户何时复制一段文本。当他们这样做时，我们将让我们的<strong class="kq io">后台</strong>脚本打开一个新的带有适当的URL和搜索参数的。</p><p id="ac8e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">我们开始吧。</strong></p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="5363" class="md me in bd mf mg nh mi mj mk ni mm mn jt nj ju mp jw nk jx mr jz nl ka mt mu bi translated">我们的清单. json</h1><p id="e63c" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">这里没什么特别的。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="9674" class="nr me in nn b gy ns nt l nu nv">{<br/> “name”: “Clipboard Search”,<br/> “manifest_version”: 2,<br/> “description”: “Testing clipboard functionality.”,<br/> “version”: “0.0.0”,<br/> “background”: {<br/> “scripts”:[“background.js”]<br/> },<br/> “browser_action”: {<br/> “default_popup”: “popup.html”<br/> },<br/> “permissions”: [<br/> “tabs”,<br/> “&lt;all_urls&gt;”<br/> ]<br/>}</span></pre><p id="1113" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们需要的唯一权限是<strong class="kq io">选项卡</strong>，这样我们就可以将<strong class="kq io">前台脚本</strong>注入到特定的选项卡中，以及<strong class="kq io"> &lt; all_urls &gt; </strong>，这样我们就可以将<strong class="kq io">前台脚本</strong>注入到特定的网页中。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="bc83" class="md me in bd mf mg nh mi mj mk ni mm mn jt nj ju mp jw nk jx mr jz nl ka mt mu bi translated">popup.html</h1><p id="e02f" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">这是一个简单的网页。这里没什么复杂的。</p><p id="c8a9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们有一个带有<strong class="kq io">选项</strong>的<strong class="kq io">选择</strong>，一个用于提交的<strong class="kq io">按钮</strong>，以及一个<strong class="kq io"> div </strong>来显示他们选择的搜索引擎。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="10a4" class="nr me in nn b gy ns nt l nu nv">&lt;div class=”container”&gt;<br/>  &lt;div class=”section1"&gt;<br/>    &lt;select name=”search_engine” id=”search_engine”&gt;<br/>      &lt;option value=”” disabled selected&gt;Choose a search engine&lt;/option&gt;<br/>     &lt;option value=”google”&gt;Google&lt;/option&gt;<br/>     &lt;option value=”startpage”&gt;Start Page&lt;/option&gt;<br/>     &lt;option value=”duckduckgo”&gt;Duck Duck Go&lt;/option&gt;<br/>     &lt;option value=”ecoasia”&gt;Ecoasia&lt;/option&gt;<br/>     &lt;option value=”bing”&gt;Bing&lt;/option&gt;<br/>   &lt;/select&gt;<br/> &lt;button&gt;Select&lt;/button&gt;<br/> &lt;/div&gt;</span><span id="4c76" class="nr me in nn b gy nw nt l nu nv"> &lt;div class=”section2"&gt;<br/>   &lt;div class=”search_engine_choice”&gt;Your Current Search Engine&lt;/div&gt;<br/> &lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="f8d8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这是我们所拥有的</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/ea75ef44058ee218f48868c2950a554f.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/0*ojcsOFW69hczwmKc.png"/></div></figure></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="d9f1" class="md me in bd mf mg nh mi mj mk ni mm mn jt nj ju mp jw nk jx mr jz nl ka mt mu bi translated">我们的前景脚本</h1><p id="20e3" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">这里没有很多代码。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="72b0" class="nr me in nn b gy ns nt l nu nv">document.addEventListener(‘copy’, () =&gt; {<br/> navigator.clipboard.readText()<br/>   .then(res =&gt; {<br/>     chrome.runtime.sendMessage({<br/>       message: ‘search’,<br/>       payload: `”${res}”`<br/>     });<br/>   })<br/> .catch(err =&gt; console.log(err));<br/>});</span></pre><p id="a8cb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们为<strong class="kq io">复制</strong>事件创建一个监听器。当被触发时，我们使用<strong class="kq io"> readText() </strong>方法从<strong class="kq io">剪贴板</strong>获取复制的素材。</p><p id="1967" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我们使用<strong class="kq io">chrome . runtime . sendmessage()</strong>方法将复制的文本发送到我们的<strong class="kq io">后台脚本</strong>。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="2926" class="md me in bd mf mg nh mi mj mk ni mm mn jt nj ju mp jw nk jx mr jz nl ka mt mu bi translated"><strong class="ak">我们的后台脚本</strong></h1><h2 id="aa34" class="nr me in bd mf ny nz dn mj oa ob dp mn kx oc od mp lb oe of mr lf og oh mt oi bi translated">这是我们大部分扩展编写的地方。</h2><p id="d44a" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">这里我们有一个保存所有搜索引擎字符串的对象。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="7356" class="nr me in nn b gy ns nt l nu nv">const search_engines = {<br/> google: ‘<a class="ae oj" href="https://www.google.com/search?q='" rel="noopener ugc nofollow" target="_blank">https://www.google.com/search?q='</a>,<br/> startpage: ‘<a class="ae oj" href="https://www.startpage.com/do/dsearch?query='" rel="noopener ugc nofollow" target="_blank">https://www.startpage.com/do/dsearch?query='</a>,<br/> duckduckgo: ‘<a class="ae oj" href="https://duckduckgo.com/?q='" rel="noopener ugc nofollow" target="_blank">https://duckduckgo.com/?q='</a>,<br/> ecoasia: ‘<a class="ae oj" href="https://www.ecosia.org/search?q='" rel="noopener ugc nofollow" target="_blank">https://www.ecosia.org/search?q='</a>,<br/> bing: ‘<a class="ae oj" href="https://www.bing.com/search?q='" rel="noopener ugc nofollow" target="_blank">https://www.bing.com/search?q='</a><br/>}</span></pre><p id="cd33" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们的Chrome扩展检测到用户打开了一个新标签页时，我们确保将我们的<strong class="kq io">前台脚本</strong>注入到该页面中。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="4c19" class="nr me in nn b gy ns nt l nu nv">chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) =&gt; {<br/>  if (/^http/.test(tab.url) &amp;&amp; changeInfo.status === ‘complete’) {<br/>    chrome.tabs.executeScript(tabId, { file: <br/>                           ‘./scripts/foreground.js’ }, () =&gt; {<br/>        console.log(‘The foreground script has been injected.’);<br/>    });<br/>  }<br/>});</span></pre><p id="adb2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<strong class="kq io">后台</strong>监听器中，我们监听来自我们<strong class="kq io">前台</strong>的消息“<strong class="kq io">搜索</strong>”。</p><p id="3326" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我们收到它时，我们为用户打开一个新标签。</p><pre class="kd ke kf kg gt nm nn no np aw nq bi"><span id="1b80" class="nr me in nn b gy ns nt l nu nv">chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt; {<br/> if (request.message === ‘save_search_engine’) {<br/>   current_search_engine = request.payload;<br/>   sendResponse({ message: ‘success’ });<br/> } else if (request.message === ‘get_current_search_engine’) {<br/>   sendResponse({ payload: current_search_engine });<br/> } else if (request.message === ‘search’) {<br/>   chrome.tabs.create({<br/>     active: true,<br/>     url:  <br/>       `${search_engines[current_search_engine]}${request.payload}`<br/>   });<br/> }<br/>});</span></pre><p id="f8ef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">请注意<strong class="kq io"> url </strong>属性的值是如何由选择的<strong class="kq io">搜索</strong> <strong class="kq io">引擎</strong>加上搜索项r <strong class="kq io"> equest.payload </strong>构成的，并被修改为字符串。</p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="2f38" class="md me in bd mf mg nh mi mj mk ni mm mn jt nj ju mp jw nk jx mr jz nl ka mt mu bi translated">就是这样！</h1><p id="94e0" class="pw-post-body-paragraph ko kp in kq b kr mv jo kt ku mw jr kw kx mx kz la lb my ld le lf mz lh li lj ig bi translated">你可以在这里得到源文件<a class="ae oj" href="https://github.com/an-object-is-a/chrome-ext-copy-paste" rel="noopener ugc nofollow" target="_blank">或者你可以看下面的视频教程。</a></p></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><p id="f9e0" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果你想要更深入的指导，请查看我在YouTube上的完整视频教程，<a class="ae oj" href="https://www.youtube.com/c/anobjectisa" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">一个物体是一个</strong> </a>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="79cd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">请务必关注我们的<a class="ae oj" href="https://www.instagram.com/an_object_is_a/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> Instagram </strong> </a>和<a class="ae oj" href="https://twitter.com/anobjectisa1" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io"> Twitter </strong> </a>以跟上我们最新的<strong class="kq io"> Web开发教程</strong>。</p></div></div>    
</body>
</html>