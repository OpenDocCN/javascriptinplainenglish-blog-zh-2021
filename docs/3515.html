<html>
<head>
<title>Authenticate Users with Auth0 in Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js中的Auth0验证用户</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-authenticate-users-with-auth0-in-next-auth-9c1160ce48a8?source=collection_archive---------4-----------------------#2021-07-15">https://javascript.plainenglish.io/how-to-authenticate-users-with-auth0-in-next-auth-9c1160ce48a8?source=collection_archive---------4-----------------------#2021-07-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="2d40" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">下一步如何使用Auth0验证用户</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f2fbfb3d7bdeae9c79787c8b18bca418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJzTEHw4DxhPMsOFcvH2rw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Next auth + Auth0</figcaption></figure><h2 id="0a5b" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">什么是Auth0？</h2><p id="4a08" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">Auth0是一个易于实现、适应性强的认证和授权平台。如果你想跟随这个教程，你可以在这里创建一个免费的Auth0账户<a class="ae mh" href="https://auth0.com/signup?utm_source=external-post&amp;utm_medium=link_placement&amp;utm_campaign=devmar-media" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="da8b" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">设置</h2><p id="336f" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我将使用create-next-app设置一个新的next应用程序。</p><pre class="kd ke kf kg gt mi mj mk ml aw mm bi"><span id="b98a" class="ks kt in mj b gy mn mo l mp mq">npx create-next-app next-auth0-demo</span></pre><h2 id="6b6e" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">清除</h2><p id="944c" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我会删除从主页面到页脚的所有内容。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="a9f6" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">安装<a class="ae mh" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank">下一个授权</a></p><pre class="kd ke kf kg gt mi mj mk ml aw mm bi"><span id="e1e6" class="ks kt in mj b gy mn mo l mp mq">npm i next-auth # npm<br/>yarn add next-auth # yarn</span></pre><h2 id="f440" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">开始使用下一次授权</h2><p id="8e36" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我们将首先在pages中的<code class="fe my mz na mj b">api</code>文件夹内创建一个名为<code class="fe my mz na mj b">auth</code>的文件夹。</p><p id="6cbb" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">在那个文件夹中创建一个名为<strong class="lq io"> <em class="nb"> […nextauth]的文件。js</em>T12】</strong></p><p id="1866" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">我们将使用auth0作为提供者，因此我们需要三个参数。所以将这段代码添加到您的<strong class="lq io"> <em class="nb"> […nextauth]中。js </em> </strong>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="a49a" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">现在我们将最终在<strong class="lq io"> <em class="nb"> _app.js </em> </strong>中配置下一个Auth如下-</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="16eb" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">在Auth0中设置应用程序</h2><p id="6165" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated"><strong class="lq io">创建应用</strong></p><ul class=""><li id="300a" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">注册到<a class="ae mh" href="https://auth0.com/signup?utm_source=external-post&amp;utm_medium=link_placement&amp;utm_campaign=devmar-media" rel="noopener ugc nofollow" target="_blank"> Auth0 </a></li><li id="a5cf" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">转到应用程序选项卡下的应用程序</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/352ec037b9dbe2d1096d674b04550ea6.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*9A3PRBevntLGWtsfLF2RkA.png"/></div></figure><ul class=""><li id="f4fe" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">创建新的应用程序</li><li id="b35d" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">选择常规Web应用程序，并为您的应用程序命名，然后单击创建。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nr"><img src="../Images/fbecaafc59bc1f7e590919d511109292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FvH_0QNGMo6lQ4YHazAt5Q.png"/></div></div></figure><p id="c480" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated"><strong class="lq io">获取凭证</strong></p><p id="9ecb" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">在settings选项卡中，复制域、<code class="fe my mz na mj b">client id</code>和<code class="fe my mz na mj b">client secret</code>，并将其添加到您的. env.local文件中。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="f4a4" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">我们还将在env中添加NEXTAUTH_URL，如下所示</p><pre class="kd ke kf kg gt mi mj mk ml aw mm bi"><span id="d425" class="ks kt in mj b gy mn mo l mp mq">NEXTAUTH_URL=http://localhost:3000</span></pre><h2 id="902c" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">创建登录按钮</h2><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="a55b" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">现在，如果我们尝试登录，我们会看到这个错误页面</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ns"><img src="../Images/2f37698da065a2beb4c31d7c8806254f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MBJDtKk6psR_fqE7yz_9KA.png"/></div></div></figure><p id="ae18" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">我们需要添加<a class="ae mh" href="http://localhost:3000/api/auth/callback/auth0" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/auth/callback/auth 0</a>作为允许的回调URL并保存它。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nt"><img src="../Images/1dd6129909e028bcf45e970409e53b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FNQqO77z4UcZ7Q3Qa96ufw.png"/></div></div></figure><p id="58e9" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">现在我们可以成功登录了！</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nu ms l"/></div></figure><h2 id="0c57" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">获取用户信息</h2><p id="dc19" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我们将使用<code class="fe my mz na mj b">getServerSideProps</code>创建一个函数，通过会话获取我们的用户详细信息。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="8247" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">如果用户已经登录，我们希望有一个注销按钮。因此，如果没有用户，我们将有一个登录按钮，如果有用户，我们将有一个退出按钮。</p><p id="4195" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">所以像这样创建一个三元运算符</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="3a96" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">然后从next-auth/client导入我们需要的所有内容。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="fa4d" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">显示用户详细信息</h2><p id="f6e6" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我们将添加此代码来获取用户的电子邮件、姓名和图像。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="89ef" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">最终的代码应该是这样的</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="1269" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">由于我们正在使用下一个图像，我们将需要在<strong class="lq io"><em class="nb">Next . config . js</em></strong>中添加域</p><p id="12f6" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">我们使用谷歌登录，所以我们将添加lh3.googleusercontent.com作为域名，如果你不知道图片的来源，你可以使用普通的img标签。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="5c8b" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">部署</h2><p id="6081" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">我将创建一个新的GitHub库，并将代码推送到那里。如果你不了解git和GitHub。查看我的<a class="ae mh" href="https://avneeshagarwal.medium.com/git-and-github-crash-course-b44f4885ff66" rel="noopener"> Git和Github速成班</a>。</p><p id="60b1" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">之后去<a class="ae mh" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank">威瑟尔</a></p><ul class=""><li id="f230" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">注册你的GitHub</li><li id="d55f" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">点击创建一个新项目</li><li id="3507" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">导入您创建的存储库</li><li id="ebfa" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">单击部署</li></ul><p id="40e0" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">您的站点现在将被部署，但身份验证将不起作用。</p><p id="1d9c" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">添加环境变量。</p><ul class=""><li id="52ef" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">网站部署后，进入当前应用程序的仪表板，点击设置，然后环境变量。</li><li id="da6f" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">添加我们的. env.local文件中的Auth0客户端id、Auth0客户端机密和Auth0域。</li><li id="0b75" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">在你添加了这两个之后，它看起来就像这样。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nv"><img src="../Images/10189fe818efbc57b5d746567bc3f2fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2iM_UFXDHpWeo_KRI8tQw.png"/></div></div></figure><ul class=""><li id="fa55" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">我们将添加另一个变量，我们的下一个Auth URL，它将是部署的URL而不是本地主机。</li><li id="4545" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated">要获取URL，单击domains，获取最短的链接，并将其添加到NEXTAUTH_URL变量中。这将类似于https://next-auth0-demo.vercel.app/的<a class="ae mh" href="https://next-auth0-demo.vercel.app/" rel="noopener ugc nofollow" target="_blank"/></li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nw"><img src="../Images/14d40286ce082c1708845827b1bfcb16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YuQGkhI6y1QSqfSON1IoHg.png"/></div></div></figure><ul class=""><li id="b76a" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">最后，转到标题中选项卡上的“部署”选项卡。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d8fbda27e4eff44a483f2e46ce11a0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/0*zTZu4MU2EkoLwFW9.png"/></div></figure><ul class=""><li id="74b6" class="nc nd in lq b lr mt lu mu lb ne lf nf lj ng mg nh ni nj nk bi translated">点击最新版本，并按下重新部署。</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/8ed0431a21deaf95bc4f16afde7cf476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXXyCAcdziRcVvhr8ewfMw.png"/></div></div></figure><h2 id="0743" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">更改Auth0中的URI</h2><p id="206a" class="pw-post-body-paragraph lo lp in lq b lr ls jo lt lu lv jr lw lb lx ly lz lf ma mb mc lj md me mf mg ig bi translated">最后，用实际的URL替换localhost:3000，并使用HTTPS代替HTTP。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/62a8b4daab48caab2e8bcfce19d07ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*bm37wxIXrN8PTxSMOcLvoA.png"/></div></figure><p id="94c7" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">我们的认证现在运行良好。恭喜你。您已经使用下一个身份验证创建了您的第一个身份验证0登录！🥳</p><p id="0f6e" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated">如果你觉得这很有用，请在评论中告诉我。如果您想查看任何其他类型的认证，也可以告诉我。</p><h2 id="57b8" class="ks kt in bd ku kv kw dn kx ky kz dp la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">更多资源</h2><ul class=""><li id="047d" class="nc nd in lq b lr ls lu lv lb oa lf ob lj oc mg nh ni nj nk bi translated"><a class="ae mh" href="https://github.com/avneesh0612/next-auth0-demo" rel="noopener ugc nofollow" target="_blank"> Github库</a></li><li id="9666" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated"><a class="ae mh" href="https://nextjs.org/docs" rel="noopener ugc nofollow" target="_blank"> NextJS文档</a></li><li id="c2de" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated"><a class="ae mh" href="https://next-auth.js.org/" rel="noopener ugc nofollow" target="_blank">下一次授权</a></li><li id="9002" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated"><a class="ae mh" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank">认证0 </a></li><li id="b0b8" class="nc nd in lq b lr nl lu nm lb nn lf no lj np mg nh ni nj nk bi translated"><a class="ae mh" href="https://avneesh-links.vercel.app/" rel="noopener ugc nofollow" target="_blank">所有社交</a></li></ul><p id="864e" class="pw-post-body-paragraph lo lp in lq b lr mt jo lt lu mu jr lw lb mv ly lz lf mw mb mc lj mx me mf mg ig bi translated"><em class="nb">更多内容请看</em><a class="ae mh" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="lq io"><em class="nb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>