# 当自文档化代码还不够时

> 原文：<https://javascript.plainenglish.io/when-self-documenting-code-is-not-enough-a964da7e74e?source=collection_archive---------10----------------------->

## 自记录代码很好，但是什么时候不行呢？什么时候代码中有注释会让你受益？

![](img/aac8b8172e464e804c59cbddf8d75527.png)

我最近写了一篇关于自文档化代码的必要性以及如何实现这一点的文章。这篇文章很受欢迎，但是得到了一些关于在某些情况下如何需要代码注释的有效回应。

我从来没有打算让这篇文章意味着你不应该写注释，而是你不应该写注释来解释你的代码在做什么。

[](/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3) [## 编写自文档化代码的终极指南

### 厌倦了在代码中写注释吗？我们停止这样做，而是编写自文档化的代码

javascript.plainenglish.io](/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3) 

相反，你在代码中写的注释应该解释*为什么*你的代码做某事，“做什么”应该是不言而喻的。

有时评论可以解释你如何处理第三方工具的缺点，或者如何实现业务逻辑。例如，我最近在一个应用程序中实现了自动完成功能。它将为每一次击键启动一个 API 调用(显然有一个微小的超时来防止太多的调用)，但是我不能控制 API 调用响应的速度，也不能控制 API 调用返回的顺序，所以我在代码中构建了一个计数器，并忽略了任何不是来自上次搜索的结果。

虽然这可以从代码中理解，但最好用代码来阐明，所以我添加了一个注释来解释这一部分。我甚至不确定是否有人会去碰那段代码，因为我是唯一一个在处理这段代码的人，而且在这段代码被再次废弃之前，可能也是唯一一个在处理这段代码的人。但是谁知道呢，这些代码可能会存在 10 年，然后被另一个团队捡起来，我也不排除这种可能性。

所以，这是我的评论。

```
// If we've initiated a different search since initiating this one, ignore these results, so we don't get "jumping" results or the results from not-the-last search
```

有道理对吗？下面的代码行基本上是这样的。

```
if (searchCounter !== currentSearchCounter) return;
```

这一行代码可能解释了*正在做什么*，但是没有解释*为什么。对于自文档化代码，这是你必须理解的最重要的事情。它需要能够自己解释*它正在做什么*。*

## 业务逻辑解释

业务逻辑可能是必须用代码解释某些东西的最好理由之一。通常标签解释了为什么我们需要代码中的某个特性，并且通常有决定某个特性的有效论据，但是在实现之后这些信息就丢失了。

您可以链接解释代码中所有内容的标签，但这可能不是最好的方法。我不止一次地在票务系统中看到不再使用的票，然后解释也随之消失。

当然，在这种情况下，评论可以被更新，票务系统的内容应该被保留，但是我们不是在完美的世界中，迁移到不同的票务系统的决定很可能不是你的，你没有任何时间来更新你的代码。

即使你有，这些票也可能永远不会被转移到下一个系统，当它们被保存下来时，它们会被放在一个只有你的老板才能访问的 Google Drive 目录中。那么，您真的想去找您的老板，询问一张票的内容，这样您就可以得到一个包含所有附件的 10GB 的票系统 zip 文件，然后您必须搜索数千个 JSON 文件吗？或者更糟，XML！

所以你应该这样做。

*   确保你的代码确实需要一个解释。
*   如果是这样，尽可能用最短但最完整的方式总结票据的结论
*   如果你的评论有 10 行那么长是没问题的，真的。
*   将该注释也添加到它所引用的部分。最好位于实现该逻辑的函数或类之上，或者位于与该功能相关的文件之上。

商业逻辑从局外人的角度来看并不总是有意义的，或者说需要你去思考。例如，如果你的应用程序有一个登录系统，每个电子邮件地址都被同等对待，除非地址以`@whatevercompany.com`结尾，因为在这种情况下，你有一个特殊的 API 来处理他们的请求。记住，他们是你的 SaaS 的一个好的付费客户，所以他们得到需要特殊对待的定制集成。

所以在你的代码中的某个地方，你已经添加了一个决定使用什么 API 端点的函数，并且`whatevercompany.com`被硬编码在你的代码中。也许这不是最理想的情况，但时间紧迫，必须这样做。

一年后，你转到了下一份工作，有人接替了你的位置，并问你要不要把所有东西都移植到一个新的 API 上。如果代码中没有解释为什么`whatevercompany`得到特殊待遇，他们可能会忽略这个逻辑，为 API 端点定义一个全局配置，修改几行处理 API 请求的代码，这样你就因为阻止访问定制功能而惹恼了你最大的客户。

是的，这是一个虚构的情况，很容易修补，客户会没事的。但是如果它打破了更大的东西呢？如果这段代码运行在移动应用程序上，而你需要等待苹果批准你的更新，而你的客户为此愤怒了一个星期，那该怎么办？

这就是为什么您需要记录业务逻辑！

## 代码流

代码流是必须解释代码的另一个重要原因。为什么我们要按照一定的顺序调用一定的函数？

有些问题不能通过正确命名函数来回答，它们有时需要适当的澄清。

比如为什么修改密码后还需要做登录调用？也许 API 要求你在密码改变后重新认证(安全，耶！)，但为什么这是自动执行的呢？API 不能在密码改变时返回一个令牌吗？

这类问题可能有些你已经有了答案。安全性很可能是您答案的一部分。但是*为什么*在你的代码中是这样实现的呢？

## UX

用户体验，或 UX，是用户与应用程序交互的一个非常重要的部分。通常在法典中可以清楚地找到 UX。

为什么安卓上有 500ms 的超时，而 iOS 上没有？(是的，我最近将它添加到了一个跨平台的应用程序中)。对我来说，答案是，iOS 本身的行为不同，出于 UX 的目的，在 Android 上添加超时会让应用程序感觉更流畅。

这对于代码阅读者来说并不明显，但是当你实现它的时候你就知道了。代码很可能是在您或使用该应用程序的其他人发现它有问题或不直观之后实现的。

## 结论

我举例说明了为什么应该在代码中添加注释，这些例子是我最近遇到的或者在写这篇文章时想到的。我相信你应该在代码中添加注释还有很多原因，但是最终，作为一名开发人员，你需要决定你添加代码注释的原因是什么。不过有一点是肯定的，确保你的理由是有效的，过多的注释会使代码更难阅读，而不是更容易。但是永远遵循黄金法则。

> 评论应该解释*为什么*，而不是*什么*

要了解更多关于自文档化代码的主题，请阅读我的相关文章。

[](/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3) [## 编写自文档化代码的终极指南

### 厌倦了在代码中写注释吗？我们停止这样做，而是编写自文档化的代码

javascript.plainenglish.io](/the-ultimate-guide-to-writing-self-documenting-code-998ea9a38bd3) 

*更多内容请看*[***plain English . io***](https://plainenglish.io/)