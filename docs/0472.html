<html>
<head>
<title>A CDN Will Not Always Make Your Site Faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CDN不会总是让你的网站更快</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cdn-performance-1a7bdf83ebc2?source=collection_archive---------4-----------------------#2021-01-28">https://javascript.plainenglish.io/cdn-performance-1a7bdf83ebc2?source=collection_archive---------4-----------------------#2021-01-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a729" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">它甚至会恶化页面的加载时间。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1834e0e8559f2ec8b7a3363af2946061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*chcfTueJ1PaTaERL"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@nasa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">NASA</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="521c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">cdn被认为是使网站更有性能的标准工具。通过CDN链接简单地包含JavaScript &amp; CSS库而不是自己托管它们是很流行的。这有它的优点——但有时它们的性能被高估了。</p><p id="6797" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">整个话题没那么简单。这就是为什么这是你应该批判性看待的东西——也是CDN毫无疑问可以帮助的地方。<br/>玩得开心！</p><p id="2904" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">您可以通过两种方式使用内容交付网络。</strong></p><ul class=""><li id="8e44" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">通过CDN提供网站的嵌入文件。<br/>图片、CSS、JavaScript等等。</li><li id="e622" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">通过CDN完成网站交付。除了上述内容，这还包括HTML文件。</li></ul><p id="3870" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一种情况，整个网站不是通过CDN交付的。对于这项技术，我们可以使用像cdnjs.com这样的免费提供者。这是典型的非静态网站，即网站上的内容是由服务器动态生成的。如果前端是通过数据库查询、服务器端呈现或模板引擎在服务器上生成的，就是这种情况。</p><p id="b213" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样的网站通常会慢一点，因为每个请求背后都有更多的计算工作。错误在于认为CDN会显著提高性能——但事实并非如此。只有当HTML在浏览器中可用时，CDN才能介入。对于许多网站来说，糟糕的性能是由于后端渲染缓慢造成的。你应该使用启发式、缓存和负载平衡，而不是CDN。</p><h2 id="5ea3" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">CDN链接会给你带来性能上的劣势。</h2><p id="f4ab" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">原因是技术性的。假设你的网站正在使用域名<em class="ne"> example.js </em>。</p><p id="91ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为你在开发过程中完全疯了，所以你的网站使用jQuery。通过CDN加载库，例如<em class="ne">cdnjs.com</em>。</p><p id="2612" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当浏览器调用您的网站时，它首先解析您的域。域名是给人类的，不是给计算机的。在后台，一切都与IP地址一起工作。所以首先，浏览器确定你的域名后面隐藏的是哪个IP。这是通过DNS(域名系统)实现的。</p><p id="2d47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，浏览器检测到CDN需要jQuery现在它解析了<em class="ne">cdnjs.com</em>的域名。如果您将库存储在web服务器上，这就没有必要了。</p><p id="ea30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">好消息是DNS解析通常很快。然而，如果你想显著地优化，你也许应该进行比较，特别是结合下一点。</p><h2 id="e418" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">CDN对你的用户有帮助吗？</h2><p id="5887" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">我是德国人。当我为德国用户发布一个网站时，一些cdn甚至都不在考虑范围之内。原因很简单:各个服务器位于完全不同的区域。</p><p id="ca2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">即使最近的CDN服务器位于伦敦，对我来说也没有意义。用户到CDN的距离比用户到web服务器的距离更远。</p><p id="47fe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，现在顶级cdn在全球都有。但不是全部。因此，如果你在德国托管一个网站，但使用美国的CDN，这将会破坏你的网站性能。</p><p id="dbc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">距离的问题也可以反过来。可能你的目标受众离CDN很远，但你不是。因此，请确保您广泛测试您的网站，即使来自不同的国家。例如，<a class="ae kv" href="https://tools.pingdom.com/" rel="noopener ugc nofollow" target="_blank">tools.pingdom.com</a>就是这样一个工具。</p><p id="5fbf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个普遍的偏见是，通过CDN提供静态文件在本质上更好。</p><p id="7d68" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这不一定是真的，尤其是从性能的角度来看。即使是CDN也只是一个web服务器，就像你的一样。无论你使用Express.js、Nginx还是其他任何网络服务器，它们都可以提供高性能的静态内容。</p><h2 id="2a84" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">你无法控制CDN。</h2><p id="862b" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">一次又一次，我发现自己越来越习惯使用CDN。当然，使用它有一定的风险——你的网站不再只需要一台服务器，这可能会失败。但是CDN服务器发生故障的概率相当低。</p><p id="4161" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你在另一个方面无能为力——关于托管的内容。这正是HTML中存在完整性属性的原因。它是一种校验和，可用于测试CDN上的代码是否被修改过——例如，被想要获取用户数据的黑客修改过。因此，强烈建议使用完整性属性。这是浏览器能够确定CDN上的资源是否已经被改变的唯一方式。</p><p id="1aca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所述，一个CDN往往让我很舒服。我只是从CDN中取出链接，对文件没有任何影响。相反，我可能会使用一个轻量级版本的库或框架。许多人认为CDN是最终的性能提升——这是一个问题。它试图用第三方代码来塞满整个网站，而不是思考&amp;也许是优化代码。</p><h1 id="e873" class="nf mh iq bd mi ng nh ni ml nj nk nl mo jw nm jx mr jz nn ka mu kc no kd mx np bi translated">当然，CDN也有优势。</h1><h2 id="e5ac" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">不是你的流量。</h2><p id="d6ef" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">无服务器主导着科技行业。越来越多的开发人员转向无服务器平台，而不是建立专用或虚拟服务器。Vercel、Firebase、Netlify都是大公司，它们不是为服务器支付固定成本，而是根据使用量付费。</p><p id="514a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，你为你的网络应用程序的输入和输出带宽付费。CSS和JavaScript库可能相当大——仅react-dom就有120kb(未压缩)。如果你通过CDN加载这样的文件，你就不用为流量付费——只要你不用为CDN付费。</p><h2 id="0676" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">自动更新</h2><p id="f6e6" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">像Google Analytics这样的库可以存储在你的网络服务器上。尽管如此，Google建议从官方CDN加载JavaScript文件。不是因为性能原因，而是因为代码在那里被一次又一次地更新。如果文件在您的web服务器上，您必须手动执行此操作。</p><h2 id="aafa" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">贮藏</h2><p id="61f5" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">回到我们在你的网站上使用jQuery的例子。这个图书馆经常被使用。很可能，您用户的浏览器已经从同一个CDN加载了jQuery。优点是另一个网站已经在浏览器中缓存了这个库——对于您的网站，jQuery现在可以简单地从浏览器的缓存中加载。</p><h2 id="f66e" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated"><a class="ae kv" href="http://eepurl.com/hacY0v" rel="noopener ugc nofollow" target="_blank">加入我的时事通讯，了解最新消息</a></h2></div></div>    
</body>
</html>