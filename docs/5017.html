<html>
<head>
<title>How to Add an Image Preview When an Image File is Selected in the File Input?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在文件输入中选中一个图像文件，如何添加图像预览？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-add-an-image-preview-when-an-image-file-is-selected-in-the-file-input-62609ac92a4f?source=collection_archive---------5-----------------------#2021-10-11">https://javascript.plainenglish.io/how-to-add-an-image-preview-when-an-image-file-is-selected-in-the-file-input-62609ac92a4f?source=collection_archive---------5-----------------------#2021-10-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/5c727b2635d4d9fe927656c55cd090af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rIl_qpNQBVjmLpZp"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@maritafox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marita Kavelashvili</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b56b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为选中的图片添加预览是我们在JavaScript web应用程序中经常要做的事情。</p><p id="8877" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何添加一个图像预览来显示用户选择的图像。</p><h1 id="900d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">为文件输入添加图像预览</h1><p id="851c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要为文件输入添加图像预览，首先，我们添加文件输入和<code class="fe me mf mg mh b">img</code>元素来显示图像预览:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="a773" class="mq lc iq mh b gy mr ms l mt mu">&lt;form&gt;<br/>  &lt;input type='file' /&gt;<br/>  &lt;img src="#" alt="selected image" /&gt;<br/>&lt;/form&gt;</span></pre><p id="86d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">type</code>设置为<code class="fe me mf mg mh b">file</code>，使<code class="fe me mf mg mh b">input</code>成为一个文件输入。</p><p id="59ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们需要添加一些JavaScript代码来将文件读入base64字符串。</p><p id="4eb8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以将<code class="fe me mf mg mh b">img</code>元素的<code class="fe me mf mg mh b">src</code>属性设置为base64字符串。</p><p id="7598" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="9783" class="mq lc iq mh b gy mr ms l mt mu">const imgInput = document.querySelector('input')<br/>const imgEl = document.querySelector('img')</span><span id="4d7b" class="mq lc iq mh b gy mv ms l mt mu">imgInput.addEventListener('change', () =&gt; {<br/>  if (imgInput.files &amp;&amp; imgInput.files[0]) {<br/>    const reader = new FileReader();<br/>    reader.onload = (e) =&gt; {<br/>      imgEl.src = e.target.result;<br/>    }<br/>    reader.readAsDataURL(imgInput.files[0]);<br/>  }<br/>})</span></pre><p id="f942" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">document.querySelector</code>得到<code class="fe me mf mg mh b">input</code>和<code class="fe me mf mg mh b">img</code>元素。</p><p id="6b27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用回调函数调用<code class="fe me mf mg mh b">imgInput</code>上的<code class="fe me mf mg mh b">addEventListener</code>，让我们观察文件选择。</p><p id="b328" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们传入<code class="fe me mf mg mh b">'change'</code>来观察当我们选择一个文件时触发的变更事件。</p><p id="ba9c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在回调中，我们检查<code class="fe me mf mg mh b">imgInput.files</code>是否存在。</p><p id="318e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">files</code>已经选中的文件。</p><p id="5d2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到索引为0的第一个文件。</p><p id="e5ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe me mf mg mh b">FileReader</code>实例来读取选择的文件。</p><p id="12f0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还设置了选择文件时运行的<code class="fe me mf mg mh b">onload</code>方法。</p><p id="372d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">e.target.result</code>来获取文件结果。</p><p id="8148" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该文件应该被读入一个base64字符串，这是一个<code class="fe me mf mg mh b">img</code>元素的<code class="fe me mf mg mh b">src</code>属性的有效值。</p><p id="3936" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，我们可以直接将<code class="fe me mf mg mh b">img.src</code>属性设置为<code class="fe me mf mg mh b">e.target.result</code>。</p><p id="69ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了触发文件的读取，我们用<code class="fe me mf mg mh b">imgInput.files[0]</code>调用<code class="fe me mf mg mh b">reader.readAsDataURL</code>方法，它有第一个选中的文件。</p><h1 id="b130" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe me mf mg mh b">The createObjectURL Method</code></h1><p id="4939" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们还可以使用<code class="fe me mf mg mh b">createObjectURL</code>方法从选定的图像文件中创建base64字符串。</p><p id="ed00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="70fa" class="mq lc iq mh b gy mr ms l mt mu">const imgInput = document.querySelector('input')<br/>const imgEl = document.querySelector('img')</span><span id="26a1" class="mq lc iq mh b gy mv ms l mt mu">imgInput.addEventListener('change', () =&gt; {<br/>  if (imgInput.files &amp;&amp; imgInput.files[0]) {<br/>    imgEl.src = URL.createObjectURL(imgInput.files[0]);<br/>    imgEl.onload = () =&gt; {<br/>      URL.revokeObjectURL(imgEl.src)<br/>    }<br/>  }<br/>})</span></pre><p id="c702" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并保持HTML代码不变。</p><p id="c091" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">imgInput.files[0]</code>调用<code class="fe me mf mg mh b">URL.createObjectURL</code>来从存储在<code class="fe me mf mg mh b">imgInput.files[0]</code>中的文件对象创建base64字符串。</p><p id="a2f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们设置<code class="fe me mf mg mh b">img</code>元素对象的<code class="fe me mf mg mh b">onload</code>方法，该方法在<code class="fe me mf mg mh b">img</code>元素的<code class="fe me mf mg mh b">src</code>属性改变时运行。</p><p id="7223" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在那里调用<code class="fe me mf mg mh b">URL.revokeObjectURL</code>来从内存中释放图像对象。</p><h1 id="d454" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="a693" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们通过将选定的图像文件读入base64字符串并将其设置为<code class="fe me mf mg mh b">img</code>元素的<code class="fe me mf mg mh b">src</code>属性的值，将图像预览添加到JavaScript应用程序中。</p><p id="41ed" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>