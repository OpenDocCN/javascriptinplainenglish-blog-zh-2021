<html>
<head>
<title>Generating React Components from JSON</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从JSON生成React组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/generating-react-components-from-json-850d25a5cd67?source=collection_archive---------5-----------------------#2021-02-17">https://javascript.plainenglish.io/generating-react-components-from-json-850d25a5cd67?source=collection_archive---------5-----------------------#2021-02-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1c71738b85048f88e046b207d3e72ae2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeUbwJ-6gLdt_oC0CAEKNA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">JSON to UI with React</figcaption></figure><p id="ef39" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">2017年，我写了一篇<a class="ae kx" href="https://harin76.medium.com/generate-vue-js-components-from-a-json-javascript-dom-structure-a76534478d15" rel="noopener">文章</a>，演示了从JSON或Javascript对象表示生成用户界面。我在VueJs (2.x)中提出了这个概念。该解决方案的核心是一个递归函数，它接受一组节点并生成HTML组件。这个想法对于实现诸如内容管理系统之类的工具很有用。我确实用这个概念为一个无代码平台合成了定制页面。</p><p id="6c2c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我喜欢VueJs，它有一点优雅。ReactJs是另一个出色的框架。ReactJs的架构(DOM diffing和patching)与VueJs非常相似。这两个框架在基于浏览器的前端开发领域都有重大贡献。</p><p id="4e35" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我想赶上反应堆的世界。最好的方法就是开着它转一圈。我想在ReactJs上重写我最初的VueJs文章。令我惊喜的是，事情最终变得简单了。</p><p id="a5cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是我们将呈现的JSON用户界面定义。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="f35e" class="lh li in ld b gy lj lk l ll lm">{<br/>  "tagName": "div",<br/>  "children": [<br/>    {<br/>      "tagName": "h1",<br/>      "textNode": "Great News",<br/>      "properties": {<br/>        "style": {<br/>          "textTransform": "uppercase"<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "tagName": "h3",<br/>      "textNode": "YOU CAN CREATE REACT COMPONENTS OUT OF JSON",<br/>      "properties": {<br/>        "style": {<br/>          "textTransform": "lowercase"<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "tagName": "img",<br/>      "properties": {<br/>        "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K",<br/>        "width": "100px",<br/>        "height": "100px"<br/>      }<br/>    },<br/>    {<br/>      "tagName": "hr"<br/>    },<br/>    {<br/>      "tagName": "a",<br/>      "properties": {<br/>        "href": "#"<br/>      },<br/>      "textNode": "react.js"<br/>    }<br/>  ]<br/>}</span></pre><p id="f45f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">递归函数</strong></p><p id="402b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在VueJs示例中,“createComponent”函数有两个参数</p><ol class=""><li id="e871" class="ln lo in kb b kc kd kg kh kk lp ko lq ks lr kw ls lt lu lv bi translated">一组节点</li><li id="b6b7" class="ln lo in kb b kc lw kg lx kk ly ko lz ks ma kw ls lt lu lv bi translated">渲染功能</li></ol><p id="3eed" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">功能没有变化。在ReactJs实现中，我们将对<a class="ae kx" href="https://reactjs.org/docs/react-api.html#createelement" rel="noopener ugc nofollow" target="_blank"> React.createElement </a>的引用作为第二个参数传递。我做了一点调整，以满足React要求，即子元素应该有唯一的键。下面是修改后的“createComponent”实现。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="a1e4" class="lh li in ld b gy lj lk l ll lm">// A helper to recursively create DOM nodes<br/>// first argument is a set of nodes<br/>// Second argument is a render function<br/>function createComponent(dNode, h) {<br/>  // Handle empty elements and return empty array in case the dNode passed in is empty<br/>  if (_.isEmpty(dNode)) {<br/>    return [];<br/>  }<br/>  // if the el is array call createComponent for all nodes<br/>  if (_.isArray(dNode)) {<br/>    return dNode.map((child) =&gt; createComponent(child, h))<br/>  }<br/>  let children = []; <br/>  <br/>  // If the node has children render them too<br/>  if (dNode.children &amp;&amp; dNode.children.length &gt; 0) {<br/>    dNode.children.forEach((c) =&gt; {<br/>      if (_.isString(c)) {<br/>        children.push(c)<br/>      } else {<br/>        children.push(createComponent(c, h))<br/>      }<br/>    });<br/>  }</span><span id="96aa" class="lh li in ld b gy mb lk l ll lm">  // Need to clone <br/>  const properties = _.cloneDeep(dNode.properties) || {}<br/>  <br/>  // To satisfy React warning that children should have a key<br/>  properties.key = Date.now() +  '.' + Math.random(1000)<br/>  return h(<br/>    dNode.tagName,<br/>    properties, <br/>    children.length &gt; 0? children : dNode.textNode<br/>  )<br/>}</span></pre><p id="9295" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">react实现非常简单。功能组件‘ui engine’返回使用<a class="ae kx" href="https://reactjs.org/docs/react-api.html#createelement" rel="noopener ugc nofollow" target="_blank"> React.createElement </a>创建的组件。“UIEngine”接受Javascript对象或数组作为属性。它使用了VueJs示例中几乎没有变化的“createComponent”函数。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="9d3a" class="lh li in ld b gy lj lk l ll lm">function UIEngine({nodes}) {<br/>   // The second parameter to the createComponent is <br/>   // the React.createElement<br/>   return createComponent(nodes, React.createElement)<br/>}</span></pre><p id="2cf4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">“UIEngine”是一个常规的react组件，可以在JSX中呈现，如完整的示例所示。</p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="2fa1" class="lh li in ld b gy lj lk l ll lm">       return (<br/>          &lt;div&gt;<br/>            &lt;UIEngine nodes={nodes} /&gt;<br/>          &lt;/div&gt;<br/>        )</span></pre><p id="20af" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里是代码的链接。</p><p id="929e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">完整代码供大家参考</strong></p><pre class="ky kz la lb gt lc ld le lf aw lg bi"><span id="50cb" class="lh li in ld b gy lj lk l ll lm">&lt;!DOCTYPE html&gt;<br/>  &lt;html lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Document&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;div id="root"&gt;&lt;/div&gt;<br/>    &lt;script src="<a class="ae kx" href="https://cdn.jsdelivr.net/lodash/4/lodash.min.js" rel="noopener ugc nofollow" target="_blank">https://cdn.jsdelivr.net/lodash/4/lodash.min.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae kx" href="https://unpkg.com/react@16.12.0/umd/react.development.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/react@16.12.0/umd/react.development.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae kx" href="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script src="<a class="ae kx" href="https://unpkg.com/@babel/standalone@7.8.3/babel.js" rel="noopener ugc nofollow" target="_blank">https://unpkg.com/@babel/standalone@7.8.3/babel.js</a>"&gt;&lt;/script&gt;<br/>    &lt;script type="text/babel"&gt;<br/>      <br/>// A helper to recursively create DOM nodes<br/>// first argument is a set of nodes<br/>// Second argument is a render function<br/>function createComponent(dNode, h) {<br/>  // Handle empty elements and return empty array in case the dNode passed in is empty<br/>  if (_.isEmpty(dNode)) {<br/>    return [];<br/>  }<br/>  // if the el is array call createComponent for all nodes<br/>  if (_.isArray(dNode)) {<br/>    return dNode.map((child) =&gt; createComponent(child, h))<br/>  }<br/>  let children = []; <br/>  <br/>  // If the node has children render them too<br/>  if (dNode.children &amp;&amp; dNode.children.length &gt; 0) {<br/>    dNode.children.forEach((c) =&gt; {<br/>      if (_.isString(c)) {<br/>        children.push(c)<br/>      } else {<br/>        children.push(createComponent(c, h))<br/>      }<br/>    });<br/>  }</span><span id="10fb" class="lh li in ld b gy mb lk l ll lm">// Need to clone <br/>  const properties = _.cloneDeep(dNode.properties) || {}<br/>  <br/>  // This is to satisfy React warning that children should have a key<br/>  properties.key = Date.now() +  '.' + Math.random(1000)<br/>  return h(dNode.tagName, properties, children.length &gt; 0? children : dNode.textNode)<br/>}      <br/>      <br/>      // The UI Engine component, takes a Javascript object/array or nodes as prop and renders it<br/>      function UIEngine({nodes}) {<br/>        return createComponent(nodes, React.createElement)<br/>      }<br/>      <br/>      // An application component consuming the UiEngine<br/>      function App() {<br/>        const nodes = {<br/>          tagName: 'div',<br/>          children: [<br/>            {<br/>              tagName: 'h1',<br/>              textNode: 'Great News',<br/>              properties: {<br/>                style: {'textTransform': 'uppercase'}<br/>              }<br/>            },<br/>            {<br/>              tagName: 'h3',<br/>              textNode: 'YOU CAN CREATE REACT COMPONENTS OUT OF JSON',<br/>              properties: {<br/>                style: {textTransform: 'lowercase'}<br/>              }<br/>            },<br/>            {<br/>              tagName: 'img',<br/>              properties: {<br/>                src: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9Ii0xMS41IC0xMC4yMzE3NCAyMyAyMC40NjM0OCI+CiAgPHRpdGxlPlJlYWN0IExvZ288L3RpdGxlPgogIDxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSIyLjA1IiBmaWxsPSIjNjFkYWZiIi8+CiAgPGcgc3Ryb2tlPSIjNjFkYWZiIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIi8+CiAgICA8ZWxsaXBzZSByeD0iMTEiIHJ5PSI0LjIiIHRyYW5zZm9ybT0icm90YXRlKDYwKSIvPgogICAgPGVsbGlwc2Ugcng9IjExIiByeT0iNC4yIiB0cmFuc2Zvcm09InJvdGF0ZSgxMjApIi8+CiAgPC9nPgo8L3N2Zz4K',<br/>                width: '100px',<br/>                height: '100px'<br/>              }<br/>            },<br/>            {<br/>              tagName: 'hr'<br/>            },<br/>            {<br/>              tagName: 'a',<br/>              properties: {<br/>                href: '#'<br/>              },<br/>              textNode: 'react.js'<br/>            }<br/>          ]<br/>        };<br/>        return (<br/>          &lt;div&gt;<br/>            &lt;UIEngine nodes={nodes} /&gt;<br/>          &lt;/div&gt;<br/>        )<br/>      }</span><span id="3651" class="lh li in ld b gy mb lk l ll lm">ReactDOM.render(&lt;App /&gt;, document.getElementById('root'))<br/>    &lt;/script&gt;<br/>  &lt;/body&gt;<br/>  &lt;/html&gt;</span></pre><p id="6acc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">本文展示了VueJs和ReactJs框架在内部工作方式上的相似之处。在不修改任何定制递归呈现函数的情况下，我们创建了一个组件，可以从ReactJS中的JSON/Javascript对象呈现UI。它还演示了如何重新合并存储在JSON中的UI组件。让我知道你对这篇文章的看法。如果你喜欢这篇文章，请分享。</p><p id="0e28" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">参考文献</strong></p><div class="mc md gp gr me mf"><a href="https://harin76.medium.com/generate-vue-js-components-from-a-json-javascript-dom-structure-a76534478d15" rel="noopener follow" target="_blank"><div class="mg ab fo"><div class="mh ab mi cl cj mj"><h2 class="bd io gy z fp mk fr fs ml fu fw im bi translated">从JSON / JavaScript DOM结构生成Vue.js组件</h2><div class="mm l"><h3 class="bd b gy z fp mk fr fs ml fu fw dk translated">有时我们需要存储文档结构并重新创建它的能力。例如，当我们创建所见即所得…</h3></div><div class="mn l"><p class="bd b dl z fp mk fr fs ml fu fw dk translated">harin76.medium.com</p></div></div></div></a></div><p id="c270" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">反应创造元素—<a class="ae kx" href="https://reactjs.org/docs/react-api.html#createelement" rel="noopener ugc nofollow" target="_blank">https://reactjs.org/docs/react-api.html#createelement</a></p></div></div>    
</body>
</html>