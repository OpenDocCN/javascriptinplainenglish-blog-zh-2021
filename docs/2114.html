<html>
<head>
<title>How to Convert from Flux to Redux in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中将Flux转换为Redux</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-convert-from-flux-to-redux-in-react-7550bd3ea1a9?source=collection_archive---------6-----------------------#2021-05-04">https://javascript.plainenglish.io/how-to-convert-from-flux-to-redux-in-react-7550bd3ea1a9?source=collection_archive---------6-----------------------#2021-05-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bc29e3dc96cccf7360cfcbd4f90bad71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rEYG5b9pxpV62VZ9h-WBmw.png"/></div></div></figure><blockquote class="jv jw jx"><p id="b8af" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这个循序渐进的指南应该可以帮助你将现有的Flux React应用程序转换为Redux。</p></blockquote><h2 id="43af" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">商店</h2><p id="d6e6" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">Flux和Redux之间最显著的区别之一是对存储的使用。</p><p id="fd9a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">Flux有多个，Redux有一个单店。</p><p id="fcce" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">在根目录下创建一个名为<strong class="kb io"> configureStore.js </strong>的新文件</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">configureStore.js to setup the Redux store and middleware</figcaption></figure><p id="5e91" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">我包含了thunk和redux不可变状态不变中间件，因为我发现它们很有用。我不会深入这个故事的细节，但是，如果你感兴趣的话，我建议你去看看。</p><blockquote class="jv jw jx"><p id="4d07" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您将需要为这个构建添加所需的包，请参考本文的包部分，了解运行这个示例所需的所有包的详细信息。</p></blockquote><p id="2feb" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">现在，您需要修改您的<strong class="kb io"> index.js </strong>来将应用程序包装在一个ReduxProvider中。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">index.js modified to use Redux</figcaption></figure><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/45926ecd1ce26a6892ec5808eb007239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*BeFsPOkpWtQUFAQNB0FzSQ.gif"/></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="3886" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">还原剂</h2><p id="e69c" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">Flux和Redux之间的下一个主要区别是引入了减速器。Reducers基于传递的操作返回一个新状态。</p><p id="8db5" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">让我们创建一个文件来合并我们生产的特定减速器。</p><p id="673f" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">在一个名为“reducers”的新目录下创建一个文件<strong class="kb io"> index.js </strong></p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">index file to import all reducers</figcaption></figure><p id="1e17" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">在Flux中，你可以把修改状态的方法放在存储中，而在Redux中，我们把它放在一个reducer文件中。</p><p id="5fb9" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">在这个例子中，我导入了一个userReducer，让我们来看看。</p><p id="494d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">您将看到我们在Flux <strong class="kb io"> userStore.js </strong>中向dispatcher注册的操作，即</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userStore using Flux</figcaption></figure><p id="5153" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">被移动到减速器:</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userReducer returning new state based on the action type</figcaption></figure><p id="435e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">缩减器接收两个属性:状态和动作。</p><p id="ac5a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">基于动作类型，返回新的状态。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/51afbc53736edf53bc11318cb2e5ba8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*9n_nQ8gSXlZ7vAblc-w_4A.gif"/></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="fc0e" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">行动</h2><p id="4baa" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">要将Flux动作转换为Redux动作，只需做一个小的改动。</p><p id="5cc0" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">而不是使用它来导入appDispatcher和dispatch操作，即</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userActions using Flux</figcaption></figure><p id="27d6" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">您使用dispatcher作为输入参数返回一个函数，并使用它来调度操作，也就是说。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userActions modified to use Redux</figcaption></figure><p id="8d27" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">移除appDispatcher的导入，更改导出的函数以返回以dispatch作为输入参数的函数，并将dispatch actionType属性重命名为Type。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/6d1a3c9508f07daa84c331f1f7f06ec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*EDqlJx4E3Ld4emJSynAZrw.gif"/></div></figure></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><h2 id="4a43" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">成分</h2><p id="f4a5" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">Redux简化了处理动作的组件实现。</p><p id="c674" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">让我们看看当前使用Flux编写的用户列表组件:</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userList component using Flux</figcaption></figure><p id="5998" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">您需要做的第一个更改是用对Redux方法connect的调用来包装您的导出。Connect需要两个道具，为了可读性，我喜欢把它们分开:</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="684e" class="kx ky in mr b gy mv mw l mx my">import { connect } from 'react-redux';<br/>...</span><span id="fd5a" class="kx ky in mr b gy mz mw l mx my">function mapStateToProps(state, ownProps) {<br/>}</span><span id="d1de" class="kx ky in mr b gy mz mw l mx my">function mapDispatchToProps(dispatch) {<br/>}</span><span id="54c7" class="kx ky in mr b gy mz mw l mx my">export default connect(mapStateToProps, mapDispatchToProps)(UserList);</span></pre><p id="a4dd" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">然后，我们修改useEffect挂钩来删除变更侦听器。</p><p id="d347" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">之前:</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="f105" class="kx ky in mr b gy mv mw l mx my">useEffect(() =&gt; {<br/>    userStore.addChangeListener(onChange);<br/>    if (!users) {<br/>         getUsers();<br/>    }<br/>    return () =&gt; {<br/>        userStore.removeChangeListener(onChange);<br/>   };<br/>}, [users]);</span></pre><p id="8c9a" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">之后:</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="d01f" class="kx ky in mr b gy mv mw l mx my">useEffect(() =&gt; {<br/>    if (users.length === 0) {<br/>         getUsers();<br/>    }<br/>}, [users, getUsers]);</span></pre><p id="86e4" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">我们移除对useState挂钩的调用，并更改传递给UserList的属性。</p><p id="76c2" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">之前:</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="dc79" class="kx ky in mr b gy mv mw l mx my">function UserList(props)</span></pre><p id="b78f" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">之后:</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="6c80" class="kx ky in mr b gy mv mw l mx my">function UserList({users, getUsers})</span></pre><p id="cdfb" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">以我们的UserList组件为例，这是最终的Redux版本:</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">userList component converted to use Redux</figcaption></figure><h2 id="b67a" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">包装</h2><p id="820a" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">您将需要以下包来运行本文中列出的示例。</p><pre class="ly lz ma mb gt mq mr ms mt aw mu bi"><span id="3419" class="kx ky in mr b gy mv mw l mx my">npm install redux<br/>npm install react-redux<br/>npm install redux-immutable-state-invariant<br/>npm install redux-thunk</span></pre><h2 id="aeff" class="kx ky in bd kz la lb dn lc ld le dp lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">源代码</h2><p id="1816" class="pw-post-body-paragraph jy jz in kb b kc lt ke kf kg lu ki kj lg lv km kn lk lw kq kr lo lx ku kv kw ig bi translated">此示例的源代码副本可以在此处找到:</p><p id="bd2e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">通量:<a class="ae na" href="https://github.com/adriver-kwiboo/flux-demo" rel="noopener ugc nofollow" target="_blank">https://github.com/adriver-kwiboo/flux-demo</a></p><p id="ed20" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">https://github.com/adriver-kwiboo/redux-demo</p></div><div class="ab cl mj mk hr ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ig ih ii ij ik"><p id="3d84" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated">我希望你觉得这个故事有用，感谢阅读。</p><p id="8819" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lg kl km kn lk kp kq kr lo kt ku kv kw ig bi translated"><a class="ae na" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ka">更多内容看plainenglish.io </em> </a></p></div></div>    
</body>
</html>