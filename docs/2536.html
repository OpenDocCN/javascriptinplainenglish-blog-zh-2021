<html>
<head>
<title>How to Create a Reusable Custom Hook with React and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React和TypeScript创建一个可重用的定制钩子</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-reusable-custom-hook-with-react-js-and-typescript-6e5ef8340e1?source=collection_archive---------2-----------------------#2021-05-25">https://javascript.plainenglish.io/how-to-create-a-reusable-custom-hook-with-react-js-and-typescript-6e5ef8340e1?source=collection_archive---------2-----------------------#2021-05-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/f03c69a4de769da609641739cd0183b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*NoNvRhxIhv3luMiGSiuu3g.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk"><a class="ae jv" href="https://unsplash.com/@jonnysplsh?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jonny Caspari</a> on <a class="ae jv" href="https://unsplash.com/s/photos/hook?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d781" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">代码可重用性是指在多个地方使用一个代码来执行相同或相似的功能。它提供了更短的开发时间、更好的最终产品等优势，并且消除了代码冗余(<a class="ae jv" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">不要重复</a>)。</p><p id="c63a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">在本教程中，我们将学习如何用TypeScript编写一个可重用的自定义钩子。</p><p id="fdd7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">对于后端服务，我们将使用<a class="ae jv" href="http://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">JSONPlaceholder</strong></a><strong class="jy io"/>相册和照片端点。<a class="ae jv" href="http://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">JSONPlaceholder</strong></a><strong class="jy io"/>是一个<strong class="jy io"> </strong>免费的在线API服务。</p><p id="6259" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">您可以通过克隆这个存储库(<strong class="jy io">main branch</strong>)<br/><a class="ae jv" href="https://github.com/Mr-Malomz/react-custom-hook" rel="noopener ugc nofollow" target="_blank">here</a><br/>)来进行编码(如果您更喜欢查看完整的代码，请查看同一个存储库的<strong class="jy io"> dev </strong>分支。)</p><p id="b258" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">在本教程中，我们将只关注实现。项目UI已经设置了<a class="ae jv" href="https://chakra-ui.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jy io">脉轮UI </strong> </a>。</p><h1 id="b4cd" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">文件夹结构</h1><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/b3fe029ff3a7c89c6aba32ba489b3407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*986zHxV0y2EE7yqQoDOI9Q.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">project folder structure</figcaption></figure><p id="a589" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">让我们看看上面的一些关键目录和文件:</p><ul class=""><li id="8acd" class="lx ly in jy b jz ka kd ke kh lz kl ma kp mb kt mc md me mf bi translated">存储我们应用程序构建模块的文件夹。</li><li id="882c" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated"><code class="fe mg mh mi mj b">pages:</code>存储我们应用程序页面的文件夹。</li><li id="0807" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated"><code class="fe mg mh mi mj b">App.tsx:</code>连接所有组件的文件。</li></ul><h1 id="64c2" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">运行项目</h1><p id="56f7" class="pw-post-body-paragraph jw jx in jy b jz mp kb kc kd mq kf kg kh mr kj kk kl ms kn ko kp mt kr ks kt ig bi translated">导航到项目位置，打开您的终端并安装项目依赖项</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">install project dependency</figcaption></figure><p id="e8b9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">然后使用下面的命令运行项目</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Start project</figcaption></figure><blockquote class="mw mx my"><p id="e541" class="jw jx mz jy b jz ka kb kc kd ke kf kg na ki kj kk nb km kn ko nc kq kr ks kt ig bi translated"><em class="in">您的项目应该在</em>上弹出<code class="fe mg mh mi mj b"><a class="ae jv" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"><em class="in">http://localhost:3000</em></a></code></p></blockquote><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/64850214152cea37393bdb774c53b9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T7Q4jc6ke3jydcrVo7mKQ.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">albums page</figcaption></figure><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="ne nf di ng bf nh"><div class="gh gi nd"><img src="../Images/32b00f600525a93312a4e511d31cae65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNNwN20FUp47byvk2QWm9g.png"/></div></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">photos page</figcaption></figure><h1 id="4333" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated"><strong class="ak">创建自定义挂钩</strong></h1><p id="0e1e" class="pw-post-body-paragraph jw jx in jy b jz mp kb kc kd mq kf kg kh mr kj kk kl ms kn ko kp mt kr ks kt ig bi translated">随着项目的启动和运行，我们可以创建一个可重用的钩子来对<a class="ae jv" href="http://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">JSONPlaceholder</strong></a>端点进行API调用。我们将使用<a class="ae jv" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> <strong class="jy io"> axios </strong> </a>在这个应用程序中进行API调用。Axios是一个基于promise的HTTP客户端，用于浏览器和node.js。</p><p id="9120" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤1 <br/> </strong>在<code class="fe mg mh mi mj b">src</code>目录下创建一个<code class="fe mg mh mi mj b">hooks</code>文件夹，并在该文件夹下创建一个<code class="fe mg mh mi mj b">useFetch.hook.ts</code>文件。</p><figure class="lt lu lv lw gt jo gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/0ab3353a823b1c11850fd3f846454a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*DYub4goI2FXLsNyVojHiQg.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Updated folder structure</figcaption></figure><p id="607f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第二步<br/> </strong>创建一个<code class="fe mg mh mi mj b">useFetch</code>函数如下图所示:</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">useFetch.hook.ts</figcaption></figure><p id="eb4b" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><code class="fe mg mh mi mj b">useFetch.hook.ts</code>文件执行以下操作:</p><ul class=""><li id="124a" class="lx ly in jy b jz ka kd ke kh lz kl ma kp mb kt mc md me mf bi translated">导入所需的依赖项。</li><li id="1164" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">创建一个<code class="fe mg mh mi mj b">useFetch</code>函数，它接受一个<a class="ae jv" href="https://www.typescriptlang.org/docs/handbook/2/generics.html" rel="noopener ugc nofollow" target="_blank">泛型</a>类型的<code class="fe mg mh mi mj b">T</code>数组和一个<code class="fe mg mh mi mj b">url</code>参数。泛型允许我们创建一个可以在以后指定的类型，并在需要时实例化。</li><li id="3ea6" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">用于存储响应、加载状态和错误的状态变量。我们也为我们的状态指定类型。</li><li id="3d88" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">使用<code class="fe mg mh mi mj b">useEffect</code>钩子进行API调用。然后，我们用响应和捕捉错误(如果有)来更新应用程序状态。</li><li id="1c90" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">将<code class="fe mg mh mi mj b">responses</code>、<code class="fe mg mh mi mj b">isLoading</code>和<code class="fe mg mh mi mj b">isError</code>作为常量断言返回。Const断言确保变量是只读的，不能被重新赋值。</li></ul><h1 id="4cc6" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用useFetch自定义挂钩</h1><p id="c1ab" class="pw-post-body-paragraph jw jx in jy b jz mp kb kc kd mq kf kg kh mr kj kk kl ms kn ko kp mt kr ks kt ig bi translated"><strong class="jy io">相册页面<br/> </strong>利用我们之前创建的TypeScript泛型。我们需要检查<a class="ae jv" href="http://jsonplaceholder.typicode.com/albums" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">JSONPlaceholder</strong></a>端点的响应类型，并创建一个接口来表示响应类型。</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">albums response type.</figcaption></figure><p id="0440" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">知道这些后，我们可以更新<code class="fe mg mh mi mj b">pages/Albums.tsx</code>文件，如下所示:</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Albums.tsx</figcaption></figure><p id="e6d7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><code class="fe mg mh mi mj b">Albums.tsx</code>文件执行以下操作:</p><ul class=""><li id="65c0" class="lx ly in jy b jz ka kd ke kh lz kl ma kp mb kt mc md me mf bi translated">导入<code class="fe mg mh mi mj b">useFetch</code></li><li id="6a13" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">创建一个<code class="fe mg mh mi mj b">IAlbum</code>接口来表示响应类型</li><li id="2836" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">析构来自定制钩子的状态，并将<code class="fe mg mh mi mj b">IAlbum</code>接口作为钩子接受的泛型进行传递</li><li id="3eb7" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">当应用程序进行API调用时显示加载</li><li id="3379" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated">设置一个错误界限，并显示一条适当的消息(如果有的话)。然后我们循环遍历<code class="fe mg mh mi mj b">responses</code>数组并显示专辑细节。</li></ul><p id="7823" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">照片页面<br/> </strong>我们可以重用我们的自定义钩子来查询照片的<a class="ae jv" href="http://jsonplaceholder.typicode.com/photos" rel="noopener ugc nofollow" target="_blank"><strong class="jy io">JSONPlaceholder</strong></a>端点。正如我们对<strong class="jy io">相册页面</strong>所做的一样，我们也需要创建一个接口来表示响应类型并发出请求:</p><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Photos response type</figcaption></figure><figure class="lt lu lv lw gt jo"><div class="bz fp l di"><div class="mu mv l"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Photos.tsx</figcaption></figure><p id="5141" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这样，您现在可以通过检查相册和照片路径来测试应用程序。</p><h1 id="9639" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="4117" class="pw-post-body-paragraph jw jx in jy b jz mp kb kc kd mq kf kg kh mr kj kk kl ms kn ko kp mt kr ks kt ig bi translated">这篇文章讨论了如何在React项目中创建一个可重用的定制钩子。我们还学习了如何将用户界面从逻辑中分离出来。</p><p id="ce35" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">您可能会发现这些资源很有用:</p><ul class=""><li id="f132" class="lx ly in jy b jz ka kd ke kh lz kl ma kp mb kt mc md me mf bi translated"><a class="ae jv" href="https://www.typescriptlang.org/docs/handbook/2/generics.html" rel="noopener ugc nofollow" target="_blank">类型脚本泛型</a></li><li id="aa82" class="lx ly in jy b jz mk kd ml kh mm kl mn kp mo kt mc md me mf bi translated"><a class="ae jv" href="https://reactjs.org/docs/hooks-overview.html" rel="noopener ugc nofollow" target="_blank">反应过来的钩子</a></li></ul><p id="bdbc" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><em class="mz">更多内容尽在</em><a class="ae jv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jy io"><em class="mz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>