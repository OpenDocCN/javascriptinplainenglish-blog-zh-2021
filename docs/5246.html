<html>
<head>
<title>Next.js Firebase v9: Add Personal To-Do</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js Firebase v9:添加个人待办事项</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nextjs-firebase-v9-part-19-add-personal-todo-bf9c9770a244?source=collection_archive---------18-----------------------#2021-10-25">https://javascript.plainenglish.io/nextjs-firebase-v9-part-19-add-personal-todo-bf9c9770a244?source=collection_archive---------18-----------------------#2021-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="dadd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第19部分:将带有电子邮件属性的文档添加到Firestore</h2></div><p id="2747" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们已经可以登录和退出，我们可以张贴用户电子邮件的待办事项。所以以后，用户可以获取他们自己的待办事项，而不是所有用户的待办事项。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi lb"><img src="../Images/22b55e34da7a6dfb9791ce4aba17b68a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nnz3riTBASM69sL7.png"/></div></figure><p id="9719" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">观看<a class="ae lj" href="https://www.youtube.com/watch?v=Sdv3bw2rIuQ&amp;list=PLC5vixW_4xSKqwpgaPEcLj7O3SvUNqC9L" rel="noopener ugc nofollow" target="_blank">视频系列</a>和<a class="ae lj" href="https://www.udemy.com/course/complete-nextjs-firebase-firestore-course/?referralCode=50C342DE4DD73B4428F4" rel="noopener ugc nofollow" target="_blank">源代码</a></p></div><div class="ab cl lk ll hu lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ij ik il im in"><p id="d85a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，回到<strong class="kh ir"> TodoForm.js </strong>，导入<code class="fe lr ls lt lu b">useAuth</code>。</p><pre class="lc ld le lf gt lv lu lw lx aw ly bi"><span id="e073" class="lz ma iq lu b gy mb mc l md me">import { useAuth } from "../Auth"</span></pre><p id="c7aa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe lr ls lt lu b">useAuth</code>得到<code class="fe lr ls lt lu b">currentUser</code>。</p><pre class="lc ld le lf gt lv lu lw lx aw ly bi"><span id="a2b0" class="lz ma iq lu b gy mb mc l md me">const {currentUser} = useAuth();</span></pre><h2 id="a5f6" class="lz ma iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">添加待办事项</h2><p id="4b06" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">向Firestore添加新文档时添加电子邮件信息。</p><pre class="lc ld le lf gt lv lu lw lx aw ly bi"><span id="8219" class="lz ma iq lu b gy mb mc l md me">const TodoForm = () =&gt; {</span><span id="08d1" class="lz ma iq lu b gy nb mc l md me">const inputAreaRef = useRef();</span><span id="10a6" class="lz ma iq lu b gy nb mc l md me">const { showAlert, todo, setTodo } = useContext(TodoContext);</span><span id="2ad2" class="lz ma iq lu b gy nb mc l md me">const {currentUser} = useAuth();</span><span id="619a" class="lz ma iq lu b gy nb mc l md me">const onSubmit = async () =&gt; {</span><span id="7f93" class="lz ma iq lu b gy nb mc l md me">if (todo?.hasOwnProperty('timestamp')) {</span><span id="5c40" class="lz ma iq lu b gy nb mc l md me">//update the todo</span><span id="9368" class="lz ma iq lu b gy nb mc l md me">const docRef = doc(db, "todos", todo.id);</span><span id="7914" class="lz ma iq lu b gy nb mc l md me">const todoUpdated = { ...todo, timestamp: serverTimestamp() }</span><span id="ad17" class="lz ma iq lu b gy nb mc l md me">updateDoc(docRef, todoUpdated)</span><span id="dd0c" class="lz ma iq lu b gy nb mc l md me">setTodo({ title: '', detail: '' });</span><span id="0447" class="lz ma iq lu b gy nb mc l md me">showAlert('info', `Todo with id ${todo.id} updated successfully`)</span><span id="c145" class="lz ma iq lu b gy nb mc l md me">} else {</span><span id="c5c8" class="lz ma iq lu b gy nb mc l md me">const collectionRef = collection(db, "todos")</span><span id="3b2d" class="lz ma iq lu b gy nb mc l md me"><strong class="lu ir">const docRef = await addDoc(collectionRef, { ...todo, timestamp: serverTimestamp(), email:currentUser.email })</strong></span><span id="f9c1" class="lz ma iq lu b gy nb mc l md me">setTodo({ title: '', detail: '' })</span><span id="a2ee" class="lz ma iq lu b gy nb mc l md me">showAlert('success', `Todo with id ${docRef.id} is added successfully`)</span><span id="962b" class="lz ma iq lu b gy nb mc l md me">}</span><span id="cf84" class="lz ma iq lu b gy nb mc l md me">}</span></pre><p id="244e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果您再次添加新的待办事项，我们可以看到电子邮件信息也附在文档中。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/5cfa2e8457248dbb4f35dfcce0ed6507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MoNmx-_FVc3jubxhMcl5sQ.png"/></div></div></figure><h2 id="e178" class="lz ma iq bd mf mg mh dn mi mj mk dp ml ko mm mn mo ks mp mq mr kw ms mt mu mv bi translated">提取待办事项</h2><p id="3e7c" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated">获取用户的待办事项。</p><pre class="lc ld le lf gt lv lu lw lx aw ly bi"><span id="0881" class="lz ma iq lu b gy mb mc l md me">useEffect(() =&gt; {</span><span id="d1fa" class="lz ma iq lu b gy nb mc l md me">const collectionRef = collection(db, "todos")</span><span id="ae0c" class="lz ma iq lu b gy nb mc l md me">const q = query(collectionRef, where("email", "==", currentUser?.email), orderBy("timestamp", "desc"));</span><span id="498d" class="lz ma iq lu b gy nb mc l md me">const unsubscribe = onSnapshot(q, (querySnapshot) =&gt; {</span><span id="527e" class="lz ma iq lu b gy nb mc l md me">setTodos(querySnapshot.docs.map(doc =&gt; ({ ...doc.data(), id: doc.id, timestamp: doc.data().timestamp?.toDate().getTime() })))</span><span id="5da8" class="lz ma iq lu b gy nb mc l md me">});</span><span id="a62d" class="lz ma iq lu b gy nb mc l md me">return unsubscribe;</span><span id="fcc0" class="lz ma iq lu b gy nb mc l md me">}, [])</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nh"><img src="../Images/66c036709257e0afaef49137f6b2b2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rgBMcpy4ZFyDbk75SUmtaQ.gif"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk">Two todo lists will not affect others</figcaption></figure><p id="ba70" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以看到这两个待办事项不会相互影响。</p><h1 id="b14b" class="nm ma iq bd mf nn no np mi nq nr ns ml jw nt jx mo jz nu ka mr kc nv kd mu nw bi translated">关注我们:<a class="ae lj" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae lj" href="https://ckmobile.medium.com/" rel="noopener"> Medium </a>，<a class="ae lj" href="https://www.udemy.com/user/cyruschan2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a>，<a class="ae lj" href="https://www.linkedin.com/company/ckmobi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae lj" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae lj" href="https://www.instagram.com/ckmobile8050" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae lj" href="https://app.gumroad.com/ckmobile" rel="noopener ugc nofollow" target="_blank"> Gumroad </a></h1><p id="22cf" class="pw-post-body-paragraph kf kg iq kh b ki mw jr kk kl mx ju kn ko my kq kr ks mz ku kv kw na ky kz la ij bi translated"><em class="nx">更多内容请看</em><a class="ae lj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nx">plain English . io</em></strong></a></p></div></div>    
</body>
</html>