<html>
<head>
<title>How to scrape twitter data with Headless Chrome and Puppeteer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用无头Chrome和木偶师抓取twitter数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-scrape-twitter-data-with-depth-first-recursion-afbd437472b5?source=collection_archive---------10-----------------------#2021-08-23">https://javascript.plainenglish.io/how-to-scrape-twitter-data-with-depth-first-recursion-afbd437472b5?source=collection_archive---------10-----------------------#2021-08-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="939a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">实时模拟用户的动作</h2></div><h1 id="d844" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">用例</h1><p id="c6e9" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">给定一个新闻推文URL，我想收集每个回复、回复的回复、回复的回复的回复等的以下数据点。</p><pre class="lq lr ls lt gt lu lv lw lx aw ly bi"><span id="94d5" class="lz kd in lv b gy ma mb l mc md"><strong class="lv io">base_url<br/>parent_url<br/>comment_url<br/>username<br/>body<br/>sentiment<br/>likes_count<br/>retweets_count<br/>replies_count<br/>published_datetime</strong></span></pre><p id="f516" class="pw-post-body-paragraph ku kv in kw b kx me jo kz la mf jr lc ld mg lf lg lh mh lj lk ll mi ln lo lp ig bi translated">数据被发送到一个任意的函数<strong class="kw io"> post({…}) </strong>，在那里它可以被保存到一个数据库或者被公开为一个服务<strong class="kw io">。</strong></p><h1 id="2096" class="kc kd in bd ke kf kg kh ki kj kk kl km jt kn ju ko jw kp jx kq jz kr ka ks kt bi translated">分析</h1><p id="3812" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">推文有能力作为对许多(通常是5+)父母的回复出现，当他们只是一个父母的直系后代时。Twitter将通过随机列出二级或三级后代来显示对话的预览，但不会没有直接后代的先前上下文。通过使用来自基本tweet的深度优先遍历，我们能够通过丢弃距离大于1级的关系来将图刮成树。每次访问一个节点时，它被存储在visitedUrls[]中，如果该节点在未来的迭代中再次出现，它将被简单地丢弃。</p><h2 id="f8e9" class="lz kd in bd ke mj mk dn ki ml mm dp km ld mn mo ko lh mp mq kq ll mr ms ks mt bi translated">递归</h2><p id="7ed9" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">基本情况是如果tweet没有回复(如果从<strong class="kw io"> getSubTweetsUrls(page) </strong>返回的数组是<strong class="kw io"> [])。基本情况将决定你是增加还是减少一层递归。无论递归进行到多深，您都希望在方法签名中传递某些参数，例如<strong class="kw io"> base_url </strong>、<strong class="kw io"> parent_url </strong>、<strong class="kw io"> comment_url </strong>和Puppeteer browser对象(page)。</strong></p><h2 id="2377" class="lz kd in bd ke mj mk dn ki ml mm dp km ld mn mo ko lh mp mq kq ll mr ms ks mt bi translated">提取数据</h2><p id="9907" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">除了字段<strong class="kw io"> base_url </strong>、<strong class="kw io"> parent_url </strong>和<strong class="kw io"> comment_url </strong>被递归函数用来导航注释层次结构之外，其余的数据点必须从DOM中提取。Puppeteer的<strong class="kw io"> $$eval </strong>函数提供了对页面DOM的访问，在这里您可以巧妙利用选择器查询来查找相关数据。有许多不同的方法可以从DOM中提取数据，从映射元素之间的关系到在HTML字符串上进行正则表达式查找。</p><h2 id="d16b" class="lz kd in bd ke mj mk dn ki ml mm dp km ld mn mo ko lh mp mq kq ll mr ms ks mt bi translated">履行</h2><p id="c188" class="pw-post-body-paragraph ku kv in kw b kx ky jo kz la lb jr lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">运行下面的脚本，查看它智能地遍历给定新闻tweet的评论层次结构，同时按顺序打印所需的数据点。请注意，为启动该过程而提供的基本tweet不会被查询数据或发布。</p><figure class="lq lr ls lt gt mu"><div class="bz fp l di"><div class="mv mw l"/></div></figure></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><p id="19bf" class="pw-post-body-paragraph ku kv in kw b kx me jo kz la mf jr lc ld mg lf lg lh mh lj lk ll mi ln lo lp ig bi translated"><em class="ne">更多内容请看</em><a class="ae nf" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kw io"><em class="ne">plain English . io</em></strong></a></p></div></div>    
</body>
</html>