<html>
<head>
<title>The Problem with Returning Values from Async Await Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从异步Await函数返回值的问题</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/problem-with-returning-values-from-async-await-function-javascript-e99c94a47ca5?source=collection_archive---------2-----------------------#2021-08-06">https://javascript.plainenglish.io/problem-with-returning-values-from-async-await-function-javascript-e99c94a47ca5?source=collection_archive---------2-----------------------#2021-08-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="33cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在JavaScript中，有时当你不知道事情是如何工作的时候，你开始挠头，但是你找不到解决的办法，这是很烦人的。在这篇文章中，我将讨论一个有趣的问题。本文基于async和await。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f78ab69daee01295e70caf52076f46b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FAxQZjUWXEL2LS6t.png"/></div></div></figure><h2 id="72a9" class="ku kv in bd kw kx ky dn kz la lb dp lc jv ld le lf jz lg lh li kd lj lk ll lm bi translated">什么是异步和等待？</h2><p id="0a33" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">简而言之，它们是承诺嵌套的语法糖。如果你没有意识到这一点，请阅读我解释异步的文章，并在这里等待<a class="ae ls" href="https://medium.com/geekculture/does-async-await-block-javascript-main-thread-c07db9c48c3e" rel="noopener"/>。</p><p id="c3cf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">假设你已经阅读了上面的文章，知道什么是异步和等待，让我们举一个简单的例子。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="1ba1" class="ku kv in lu b gy ly lz l ma mb">async function foo() {<br/>   const result1 = await new Promise((resolve) =&gt; setTimeout(() =&gt;   resolve('1')))<br/>   console.log(result1); //Output is 1<br/>}</span></pre><p id="6d93" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上述函数的输出是1，非常简单明了，await将阻塞主线程，直到promise被解析。现在让我们来看看上面代码片段的有趣版本。</p><h2 id="653e" class="ku kv in bd kw kx ky dn kz la lb dp lc jv ld le lf jz lg lh li kd lj lk ll lm bi translated"><strong class="ak">你能猜出下面代码片段的输出吗？</strong></h2><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="0d6d" class="ku kv in lu b gy ly lz l ma mb">async function foo() {<br/>   const result1 = await new Promise((resolve) =&gt; setTimeout(() =&gt; resolve('1')))<br/>   return result1;<br/>}<br/>let output = foo();<br/>console.log('Output is' + JSON.stringify(output) );</span></pre><p id="cdb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于那些认为输出为1的人，你们错了。复制代码并尝试在任何在线编译器上运行，输出是{}。</p><h2 id="f073" class="ku kv in bd kw kx ky dn kz la lb dp lc jv ld le lf jz lg lh li kd lj lk ll lm bi translated"><strong class="ak">为什么会这样？</strong></h2><p id="2169" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">因为异步函数总是返回一个承诺，而不是解析上面例子中的承诺，所以我们试图从中提取值。</p><h2 id="1331" class="ku kv in bd kw kx ky dn kz la lb dp lc jv ld le lf jz lg lh li kd lj lk ll lm bi translated"><strong class="ak">有什么解决办法？</strong></h2><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="3658" class="ku kv in lu b gy ly lz l ma mb">async function foo() {<br/>   const result1 = await new Promise((resolve) =&gt; setTimeout(() =&gt;    resolve('1')))<br/>   return result1;<br/>}<br/>let output = foo().then(data =&gt; {<br/> console.log('Result is' + JSON.stringify(data)) <br/>});</span></pre><p id="7c61" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于异步函数在上面的代码片段中返回了一个承诺，我们在<strong class="jm io">的帮助下解决了这个问题。然后使用</strong>方法并从中提取值。</p><h2 id="2a13" class="ku kv in bd kw kx ky dn kz la lb dp lc jv ld le lf jz lg lh li kd lj lk ll lm bi translated"><strong class="ak">更好的方法</strong></h2><p id="8150" class="pw-post-body-paragraph jk jl in jm b jn ln jp jq jr lo jt ju jv lp jx jy jz lq kb kc kd lr kf kg kh ig bi translated">我们使用异步和等待，因为我们想避免承诺链或。然后表达，所以相当于使用。然后我们可以使用async并等待它自己来解析承诺，下面的代码片段将代表这一点。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="3199" class="ku kv in lu b gy ly lz l ma mb">async function foo() {<br/>   const result1 = await new Promise((resolve) =&gt; setTimeout(() =&gt; resolve('1')))<br/>   return result1;<br/>}</span><span id="3203" class="ku kv in lu b gy mc lz l ma mb">async function test(){<br/> let output = await foo();<br/> console.log('Result is' + JSON.stringify(output)); // Output is 1 <br/>}</span><span id="8458" class="ku kv in lu b gy mc lz l ma mb">test()</span></pre><p id="f6c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">阅读愉快，在我的下一篇文章中再见。</p><p id="0d33" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">同一作者的更多文章:</strong></p><ol class=""><li id="a796" class="md me in jm b jn jo jr js jv mf jz mg kd mh kh mi mj mk ml bi translated"><a class="ae ls" href="https://mevasanth.medium.com/how-everything-is-object-in-javascript-a4164d7e6a2d" rel="noopener">JavaScript中的一切如何都是对象？</a></li><li id="c4dc" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated"><a class="ae ls" href="https://mevasanth.medium.com/hoisting-in-javascript-hot-topic-for-interview-43b463a6a77?source=follow_footer---------0----------------------------" rel="noopener">JavaScript中的吊装:访谈热点</a></li><li id="38a1" class="md me in jm b jn mm jr mn jv mo jz mp kd mq kh mi mj mk ml bi translated"><a class="ae ls" href="https://mevasanth.medium.com/memoization-in-javascript-hot-topic-for-interview-815475544ab0" rel="noopener">JavaScript的记忆化——采访热门话题</a></li></ol><p id="4d55" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里阅读作者<a class="ae ls" href="https://mevasanth.medium.com/" rel="noopener">的所有文章。</a></p><p id="9358" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mr">更多内容请看</em><a class="ae ls" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mr">plain English . io</em></strong></a></p></div></div>    
</body>
</html>