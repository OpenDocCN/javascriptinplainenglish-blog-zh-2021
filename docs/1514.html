<html>
<head>
<title>Storage with Angular and Supabase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带角度和支架的储物装置</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/storage-with-angular-and-supabase-32cdfe688f1b?source=collection_archive---------8-----------------------#2021-03-31">https://javascript.plainenglish.io/storage-with-angular-and-supabase-32cdfe688f1b?source=collection_archive---------8-----------------------#2021-03-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fd8bf8a3207c1e36f66f0281f880d8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZgBu9WunJoWQ0kkkG9RmAA.gif"/></div></div></figure><p id="489e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">越来越清楚的是，Supabase可以成为Firebase的替代品。</p><p id="8cfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3月30日，随着存储服务的发布，我们朝着这一目标迈出了一步。</p><p id="d785" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一个开源的对象存储服务，具有无限的可扩展性，适用于任何类型的文件。</p><p id="88a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我以一种非常简洁的方式介绍了Angular 11中的一个项目，用于上传集成了Supabase存储服务的文件。</p><h1 id="80ed" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">储存；储备</h1><p id="ece6" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在https://supabase.io/storage的<a class="ae lx" href="https://supabase.io/storage" rel="noopener ugc nofollow" target="_blank">可用的文档中，列出了诸如互操作性、与已经开发的整个生态系统的集成以及可伸缩性等特性。</a></p><p id="a30e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我发现策略和权限的问题很容易实现，非常灵活。</p><p id="f36e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过该面板，可以非常直观地浏览和探索最多样化的文件格式</p><figure class="lz ma mb mc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/ac76fc84782a4bd7aca2d16be7a276c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DxxFQxbo8hxM0eIB"/></div></div><figcaption class="md me gj gh gi mf mg bd b be z dk">Fig — Control Panel Storage</figcaption></figure><p id="4942" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还提供了其他功能，如CDN集成和媒体自动转换和优化。</p><h1 id="c0d0" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">与角度积分</h1><p id="efda" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我用ng new在angular中创建了一个项目，然后用</p><pre class="lz ma mb mc gt mh mi mj mk aw ml bi"><span id="8eb2" class="mm kv in mi b gy mn mo l mp mq">npm install @ supabase / supabase-js</span></pre><p id="a99c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">版本1.7.6已经有了处理存储的方法。</p><p id="78d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最初，我们将创建一个服务来执行创建存储桶和上传文件的方法。</p><p id="6c96" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在编辑终端，我接到通知:</p><pre class="lz ma mb mc gt mh mi mj mk aw ml bi"><span id="e7f2" class="mm kv in mi b gy mn mo l mp mq">ng generate service storage</span></pre><p id="8413" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该命令创建了一个带有注释@ Injectable的StorageService类。</p><p id="b4fb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">类的实现是这样的:</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="mr ms l"/></div></figure><ul class=""><li id="534e" class="mt mu in jx b jy jz kc kd kg mv kk mw ko mx ks my mz na nb bi translated">我们使用subabaseUrl和supabaseKey属性定义url和密钥。这些值在supabase面板中可用，<a class="ae lx" rel="noopener ugc nofollow" target="_blank" href="/a-crud-with-angular-and-supabase-c205e393c823">正如我在以前的文章</a>中提到的，这不是最合适的方式，因为它暴露了密钥。</li></ul><p id="c51f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae lx" href="https://betterprogramming.pub/how-to-secure-angular-environment-variables-for-use-in-github-actions-39c07587d590" rel="noopener ugc nofollow" target="_blank">更多详情点击此处。</a></p><ul class=""><li id="4e28" class="mt mu in jx b jy jz kc kd kg mv kk mw ko mx ks my mz na nb bi translated">在类构造函数中，我们传递这些信息来访问存储操作方法。</li><li id="1c6d" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated"><strong class="jx io"> createBucket () </strong>和<strong class="jx io"> getBucket () </strong>创建并检索存储位置。桶中可以有子文件夹；</li><li id="928f" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated"><strong class="jx io"> upload() </strong> —我们通知桶，带有名称的路径，以及将要发送到服务器的文件；</li><li id="f78e" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated"><strong class="jx io">download()</strong>——即使是上传，不同的是一个Blob返回。</li><li id="93a4" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">所有方法都返回数据和错误。</li></ul><h1 id="fc13" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">组件应用程序</h1><p id="262b" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">出于本教程的目的，我在主组件中做了所有的事情。app.component.ts的实现是这样的。</p><figure class="lz ma mb mc gt jo"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="6f70" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于实现:</p><ul class=""><li id="4fc6" class="mt mu in jx b jy jz kc kd kg mv kk mw ko mx ks my mz na nb bi translated">我们为上传声明了一些附件属性作为信息消息，上传的状态(模板中有一个div显示正在装载)，以及运输位置(bucket)；</li><li id="c9f4" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">我们将StorageService注入到组件的构造函数中；</li><li id="6471" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">我们实现了方法来检查bucket是否已经存在，否则，它会在checkBucketExists()中创建一个位置；</li><li id="c664" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">在<strong class="jx io"> selectFile </strong>中，我们首先检查是否选择了任何文件，然后检索该文件，并用replace (/ / g，'')删除文件名中的空格；</li><li id="6ccb" class="mt mu in jx b jy nc kc nd kg ne kk nf ko ng ks my mz na nb bi translated">当调用上传时，我们传递必要的字段并检查是否有错误，或者用消息更新UI界面并完成加载。</li></ul><p id="b677" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是来自<strong class="jx io"> app.component.html: </strong>的模板摘录</p><pre class="lz ma mb mc gt mh mi mj mk aw ml bi"><span id="75fb" class="mm kv in mi b gy mn mo l mp mq">&lt;! - UPLOAD -&gt;</span><span id="aef0" class="mm kv in mi b gy nh mo l mp mq">&lt;div class =" custom-file overflow-hidden rounded-pill mb-5 "&gt;</span><span id="600e" class="mm kv in mi b gy nh mo l mp mq">&lt;input id =" customFile "type = "file" (change) = "selectFile ($ event)" class = "custom-file-input rounded-pill"&gt;</span><span id="fc22" class="mm kv in mi b gy nh mo l mp mq">&lt;label for = "customFile" class = "custom-file-label rounded-pill"&gt; Choose file &lt; / label&gt;</span><span id="f19a" class="mm kv in mi b gy nh mo l mp mq">&lt;/div&gt;</span><span id="b2d9" class="mm kv in mi b gy nh mo l mp mq">&lt;! - End UPLOAD -&gt;</span><span id="de96" class="mm kv in mi b gy nh mo l mp mq">&lt;! - LOADING -&gt;</span><span id="f75e" class="mm kv in mi b gy nh mo l mp mq">&lt;div * ngIf = "status" class = "spinner" style = "font-size: 18px"&gt;</span><span id="890c" class="mm kv in mi b gy nh mo l mp mq">&lt;div class = "head"&gt; &lt;/div&gt;</span><span id="01e0" class="mm kv in mi b gy nh mo l mp mq">&lt;/div&gt;</span><span id="d199" class="mm kv in mi b gy nh mo l mp mq">&lt;! - End UPLOAD -&gt;</span><span id="5720" class="mm kv in mi b gy nh mo l mp mq">&lt;div * ngIf = "message" class = "alert alert-success" role = "alert"&gt;</span><span id="6260" class="mm kv in mi b gy nh mo l mp mq">{{message}}</span><span id="7016" class="mm kv in mi b gy nh mo l mp mq">&lt;/div&gt;</span></pre><h1 id="024c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">重要的</h1><p id="2663" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">因为我们没有经过身份验证，所以我们必须允许公众访问所讨论的桶。</p><p id="7e7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，为了让示例正常工作，在Supabse控制台中运行以下命令</p><pre class="lz ma mb mc gt mh mi mj mk aw ml bi"><span id="9367" class="mm kv in mi b gy mn mo l mp mq">create policy” Public Access “</span><span id="00ba" class="mm kv in mi b gy nh mo l mp mq">on storage.objects for all</span><span id="1e66" class="mm kv in mi b gy nh mo l mp mq">using (bucket_id = photos);</span></pre><p id="e6f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这允许未经身份验证的访问。</p><p id="8a28" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">总而言之，我在这里省略了应用内模板和样式的完整代码。</p><p id="5f16" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，你可以在下面我的Github上看到它的全文</p><p id="e090" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样。谢了。</p><div class="ni nj gp gr nk nl"><a href="https://github.com/kheronn/supabase-angular-storage" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">kher on/supabase-角度存储</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">在GitHub上创建一个帐户，为kher on/supabase-angular-storage的开发做出贡献。</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jt nl"/></div></div></a></div></div></div>    
</body>
</html>