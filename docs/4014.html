<html>
<head>
<title>How to Build API Data Pagination Using Node Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node Express构建API数据分页</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-build-api-data-pagination-using-node-express-58d31d6b9e2a?source=collection_archive---------8-----------------------#2021-08-11">https://javascript.plainenglish.io/how-to-build-api-data-pagination-using-node-express-58d31d6b9e2a?source=collection_archive---------8-----------------------#2021-08-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/bc81e370c812e9a5200b38abe9f1d0e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Wl4vESTbzJ-RLNGXw_8yA.png"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Image by<a class="ae jv" href="https://aioseo.com/pagination-seo/" rel="noopener ugc nofollow" target="_blank"> AIOSEO</a></figcaption></figure><p id="35c5" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io"> Node Express </strong>是一个JavaScript框架，可以用来开发各种web应用。它可以用于开发各种客户端应用程序(web应用程序或移动应用程序)可以使用的web API。<strong class="jy io">数据分页</strong>必须在包含长数据列表的API响应上实现。本文将逐步向您展示如何在Node Express APIs中实现数据分页。</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="70ab" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">这个例子将是一个新闻应用程序。</p><p id="3f0d" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第一步:</strong>创建一个名为<strong class="jy io"> <em class="lb"> newsapp </em> </strong>的空文件夹。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="b854" class="ll lm in lh b gy ln lo l lp lq">$ mkdir newsapp<br/>cd newsapp<br/>$ npm init</span></pre><p id="bca3" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第二步:</strong>在文件夹中设置快递。<a class="ae jv" href="https://expressjs.com/en/starter/installing.html" rel="noopener ugc nofollow" target="_blank">阅读此处获取信息</a></p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="5d88" class="ll lm in lh b gy ln lo l lp lq">$ npm install express --save</span></pre><p id="fedd" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第三步:</strong>将mongoose安装到项目中。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="5fe6" class="ll lm in lh b gy ln lo l lp lq">$ npm install mongoose --save</span></pre><p id="9ffb" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第四步:</strong>在根文件夹中创建一个名为<em class="lb"> article.js </em>的文件。使用requite函数导入<em class="lb"> article.js </em>文件中的猫鼬。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="94fe" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> mongoose = require('mongoose')</span></pre><p id="c5af" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第5步:</strong>创建一个模式，用<em class="lb">标题</em>和<em class="lb">内容</em>属性表示新闻文章。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="8cc8" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> mongoose = require('mongoose')</span><span id="e15d" class="ll lm in lh b gy lr lo l lp lq"><em class="lb">const</em> ArticleSchema = new mongoose.Schema({<br/>   title: { <br/>    type: String,<br/>    required: true<br/>   },<br/>   content: {<br/>    type: String,<br/>    required: true<br/> }</span><span id="f2ec" class="ll lm in lh b gy lr lo l lp lq">})</span></pre><p id="5dde" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">下一步是将我们的模式编译成一个模型，然后导出它。<a class="ae jv" href="https://mongoosejs.com/docs/index.html" rel="noopener ugc nofollow" target="_blank">阅读此处了解更多信息</a></p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="17af" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">module</em>.<em class="lb">exports</em> = mongoose.model('Article', ArticleSchema)</span></pre><p id="e7a3" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">最终的<strong class="jy io"> <em class="lb"> article.js </em> </strong>文件会是这样的</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="bff9" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> mongoose = require('mongoose')</span><span id="e1c3" class="ll lm in lh b gy lr lo l lp lq"><em class="lb">const</em> ArticleSchema = new mongoose.Schema({<br/>   title: { <br/>    type: String,<br/>    required: true<br/>   },<br/>   content: {<br/>    type: String,<br/>    required: true<br/> }</span><span id="3db2" class="ll lm in lh b gy lr lo l lp lq">})</span><span id="85f1" class="ll lm in lh b gy lr lo l lp lq"><em class="lb">module</em>.<em class="lb">exports</em> = mongoose.model('Article', ArticleSchema)</span></pre><p id="4362" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第七步:</strong>在index.js文件中，导入<strong class="jy io">mongose</strong>，使用<em class="lb"> require() </em>函数<strong class="jy io"> express </strong>。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="ccf7" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> express = require('express')<br/><em class="lb">const</em> newsapp = express()<br/><em class="lb">const</em> mongoosedb = require('mongoose')</span></pre><p id="6e7d" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤8: </strong>将<em class="lb"> articles.js </em>文件导入到<em class="lb"> index.js </em>文件中。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="1b0e" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> article = require('./articles')</span></pre><p id="510b" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">第九步:</strong>连接MongoDB数据库。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="c4e6" class="ll lm in lh b gy ln lo l lp lq">mongoose.connect('mongodb://localhost:27017/test', {useNewUrlParser: true, useUnifiedTopology: true});</span></pre><p id="6ad7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">步骤10: 使用一个承诺，显示一个来自数据库的新闻文章列表。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="e7da" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> db = mongoose.connection<br/>db.once('open', <em class="lb">async</em> () =&gt; {<br/>  if (await article.countDocuments().exec() &gt; 0) return</span><span id="1303" class="ll lm in lh b gy lr lo l lp lq">Promise.all([</span><span id="e8fa" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 1', <br/>                content: "News content for article 1" }),</span><span id="51b4" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 2', <br/>                content: "News content for article 2" }),</span><span id="4582" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 3', <br/>                content: "News content for article 3" }),</span><span id="f552" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 4', <br/>                content: "News content for article 4" }),</span><span id="a1e0" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 5', <br/>                content: "News content for article 5" }),</span><span id="58c8" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 6', <br/>                content: "News content for article 6" }),</span><span id="7003" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 7', <br/>                content: "News content for article 7" }),</span><span id="7b3b" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 8', <br/>                content: "News content for article 8" }),</span><span id="a65a" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 9', <br/>                content: "News content for article 9" }),</span><span id="f1fe" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 10', <br/>                 content: "News content for article 10" }),</span><span id="c79c" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 11', <br/>                content: "News content for article 11" }),</span><span id="5a2f" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 12', <br/>                content: "News content for article 12" }),</span><span id="e2d0" class="ll lm in lh b gy lr lo l lp lq">article.create({ title: 'article 13', <br/>                content: "News content for article 13" })</span><span id="33f8" class="ll lm in lh b gy lr lo l lp lq">]).then(() =&gt; console.log('Added Articles'))</span><span id="a49b" class="ll lm in lh b gy lr lo l lp lq">})</span></pre><p id="19ad" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤11: </strong>创建一个名为<strong class="jy io"><em class="lb">paginated news articles()</em></strong>的函数，该函数将接受文章模型作为参数。在return语句中，创建三个名为<em class="lb"> querypage </em>、<em class="lb"> querylimit </em>和<em class="lb"> paginatedArticlesList </em>的变量。<em class="lb"> querypage </em>和<em class="lb"> querylimit </em>将存储从每个URL查询传递的页面和限制。<em class="lb">分页文章列表</em>将存储所有分页的文章。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="e9e1" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">function</em> paginatedNewsArticles(<em class="lb">model</em>) {</span><span id="3664" class="ll lm in lh b gy lr lo l lp lq">   return <em class="lb">async</em> (<em class="lb">request</em>, <em class="lb">response</em>, <em class="lb">next</em>) =&gt; {<br/>     <em class="lb">const</em> querypage = parseInt(request.query.page)<br/>     <em class="lb">const</em> querylimit = parseInt(request.query.limit)<br/>}}</span></pre><p id="f3b2" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><strong class="jy io">步骤12: </strong>接下来添加两个if语句，将检查页码以确定上一页和下一页。该信息将在JSON响应中与<em class="lb">paginated article list</em>一起发送。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="fdbe" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> firstIndex = (page - 1) * limit<br/><em class="lb">const</em> lastIndex = page * limit</span><span id="06bf" class="ll lm in lh b gy lr lo l lp lq">if (firstIndex &gt; 0) {<br/>      paginatedArticlesList.previous = {<br/>      previouspage: page - 1,<br/>      limit: limit<br/>    }<br/>  }</span><span id="9214" class="ll lm in lh b gy lr lo l lp lq">if (lastIndex &lt; await model.countDocuments().exec()) {<br/>      paginatedArticlesList.next = {<br/>       nextpage: page + 1,<br/>       limit: limit<br/>     }</span><span id="b3c9" class="ll lm in lh b gy lr lo l lp lq">}</span></pre><p id="1c34" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">最终的<strong class="jy io"> <em class="lb"> index.js </em> </strong>文件会是这样的。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="709e" class="ll lm in lh b gy ln lo l lp lq"><em class="lb">const</em> express = require('express')<br/><em class="lb">const</em> newsapp = express()<br/><em class="lb">const</em> mongoosedb = require('mongoose')<br/><em class="lb">const</em> article = require('./articles')</span><span id="110d" class="ll lm in lh b gy lr lo l lp lq">mongoose.connect('mongodb://localhost/pagination', { useNewUrlParser: true, useUnifiedTopology: true })</span><span id="4dc8" class="ll lm in lh b gy lr lo l lp lq"><em class="lb">const</em> db = mongoose.connection</span><span id="4e0e" class="ll lm in lh b gy lr lo l lp lq">db.on('error', console.error.bind(console, 'connection error:'));<br/>db.once('open', <em class="lb">async</em> () =&gt; {<br/>  if (await article.countDocuments().exec() &gt; 0) return</span><span id="0ff4" class="ll lm in lh b gy lr lo l lp lq">Promise.all([</span><span id="c4ae" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 1', <br/>                content: "News content for article 1" }),</span><span id="8d27" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 2', <br/>                content: "News content for article 2" }),</span><span id="a7fe" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 3', <br/>                content: "News content for article 3" }),</span><span id="88e3" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 4', <br/>                content: "News content for article 4" }),</span><span id="e228" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 5', <br/>                content: "News content for article 5" }),</span><span id="461f" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 6', <br/>                content: "News content for article 6" }),</span><span id="21a1" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 7', <br/>                content: "News content for article 7" }),</span><span id="0e9e" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 8', <br/>                content: "News content for article 8" }),</span><span id="9e51" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 9', <br/>                content: "News content for article 9" }),</span><span id="e47b" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 10', <br/>                 content: "News content for article 10" }),</span><span id="0a0b" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 11', <br/>                content: "News content for article 11" }),</span><span id="e355" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 12', <br/>                content: "News content for article 12" }),</span><span id="89d8" class="ll lm in lh b gy lr lo l lp lq">   article.create({ title: 'article 13', <br/>                content: "News content for article 13" })</span><span id="376f" class="ll lm in lh b gy lr lo l lp lq">]).then(() =&gt; console.log('Added Articles'))</span><span id="ea8d" class="ll lm in lh b gy lr lo l lp lq">})</span><span id="64b6" class="ll lm in lh b gy lr lo l lp lq">newsapp.get('/article', paginatedNewsArticles(article), (<em class="lb">request</em>, <em class="lb">response</em>) =&gt; {</span><span id="ae86" class="ll lm in lh b gy lr lo l lp lq">response.json(response.paginatedResults)</span><span id="37a6" class="ll lm in lh b gy lr lo l lp lq">})</span><span id="950a" class="ll lm in lh b gy lr lo l lp lq"><em class="lb">function</em> paginatedNewsArticles(<em class="lb">model</em>) {</span><span id="c494" class="ll lm in lh b gy lr lo l lp lq">  return <em class="lb">async</em> (<em class="lb">request</em>, <em class="lb">response</em>, <em class="lb">next</em>) =&gt; {<br/>    <em class="lb">const</em> querypage = parseInt(request.query.page)<br/>    <em class="lb">const</em> querylimit = parseInt(request.query.limit)<br/>    <em class="lb">const</em> firstIndex = (page - 1) * limit<br/>    <em class="lb">const</em> lastIndex = page * limit</span><span id="d805" class="ll lm in lh b gy lr lo l lp lq">    <em class="lb">const</em> paginatedArticlesList = {}</span><span id="8fe9" class="ll lm in lh b gy lr lo l lp lq">   if (firstIndex &gt; 0) {<br/>       paginatedArticlesList.previous = {<br/>       previouspage: page - 1,<br/>       limit: limit<br/>     }<br/>   }</span><span id="22d4" class="ll lm in lh b gy lr lo l lp lq">   if (lastIndex &lt; await model.countDocuments().exec()) {<br/>       paginatedArticlesList.next = {<br/>       nextpage: page + 1,<br/>       limit: limit<br/>     }<br/>}</span><span id="e9be" class="ll lm in lh b gy lr lo l lp lq">try {<br/>   paginatedArticlesList.results = await<br/>   model.find().limit(limit).skip(firstIndex).exec()<br/>   response.paginatedArticles = paginatedArticlesList<br/>   next()<br/>} catch (e) {<br/>   response.status(500).json({ message: e.message })<br/>}<br/>}}</span><span id="6db6" class="ll lm in lh b gy lr lo l lp lq">newsapp.listen(3000)</span></pre><p id="991e" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">测试应用程序</p></div><div class="ab cl ku kv hr kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ig ih ii ij ik"><p id="69af" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">现在我们有了。我希望你已经发现这是有用的。我会带着更多有趣的文章回来。感谢您的阅读。</p><p id="2e02" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><em class="lb">更多内容请看</em><a class="ae jv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jy io"><em class="lb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>