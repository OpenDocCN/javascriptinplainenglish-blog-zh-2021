<html>
<head>
<title>Create Vue 3 Apps with the Composition API — Lifecycle Hooks and Refs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用组合API创建Vue 3应用——生命周期挂钩和引用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-vue-3-apps-with-the-composition-api-lifecycle-hooks-and-refs-2a41eee88f6a?source=collection_archive---------18-----------------------#2021-04-13">https://javascript.plainenglish.io/create-vue-3-apps-with-the-composition-api-lifecycle-hooks-and-refs-2a41eee88f6a?source=collection_archive---------18-----------------------#2021-04-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b2526f27a0c43efaa173a1fad00c5cfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-iHlVaAyx5RVY-Vs"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@derekthomson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Derek Thomson</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a7ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它让我们可以轻松地提取逻辑，而不必担心代码中<code class="fe lb lc ld le b">this</code>的值。</p><p id="77ff" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用TypeScript也能更好地工作，因为不再需要键入<code class="fe lb lc ld le b">this</code>的值。</p><p id="46b8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用复合API创建Vue 3应用程序。</p><h1 id="b27e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">生命周期挂钩</h1><p id="4cfe" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">Vue 3的composition API也提供了生命周期挂钩。</p><p id="b44a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们把它们都放在<code class="fe lb lc ld le b">setup</code>方法中。</p><p id="5ca7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="285e" class="mq lg iq le b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;&lt;/div&gt;<br/>&lt;/template&gt;</span><span id="76db" class="mq lg iq le b gy mv ms l mt mu">&lt;script&gt;<br/>import { onMounted, onUnmounted, onUpdated } from "vue";<br/>export default {<br/>  name: "App",<br/>  setup() {<br/>    onMounted(() =&gt; {<br/>      console.log("mounted!");<br/>    });<br/>    onUpdated(() =&gt; {<br/>      console.log("updated!");<br/>    });<br/>    onUnmounted(() =&gt; {<br/>      console.log("unmounted!");<br/>    });<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="0058" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将回调传递给生命周期函数。</p><p id="0f49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">beforeCreate</code>和<code class="fe lb lc ld le b">created</code>被替换为<code class="fe lb lc ld le b">setup</code>方法。</p><p id="8d9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是选项API挂钩的组合API等价物:</p><ul class=""><li id="bc2d" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated"><code class="fe lb lc ld le b">beforeMount</code>-&gt;-T7】</li><li id="bef4" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">mounted</code>-&gt;-<code class="fe lb lc ld le b">onMounted</code></li><li id="3f02" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">beforeUpdate</code>-&gt;-<code class="fe lb lc ld le b">onBeforeUpdate</code></li><li id="4a19" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">updated</code>-&gt;-<code class="fe lb lc ld le b">onUpdated</code></li><li id="e724" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">beforeDestroy</code>-&gt;-<code class="fe lb lc ld le b">onBeforeUnmount</code></li><li id="565a" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">destroyed</code>-&gt;-<code class="fe lb lc ld le b">onUnmounted</code></li><li id="e346" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">activated</code>-&gt;-<code class="fe lb lc ld le b">onActivated</code></li><li id="eb44" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">deactivated</code>-&gt;-<code class="fe lb lc ld le b">onDeactivated</code></li><li id="6b03" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">errorCaptured</code>——&gt;——T23】</li></ul><p id="9430" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">左侧是选项API挂钩，右侧是组合API等价物。</p><p id="8f08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">组合API也有两个调试挂钩:</p><ul class=""><li id="081a" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated"><code class="fe lb lc ld le b">onRenderTracked</code></li><li id="876a" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lb lc ld le b">onRenderTriggered</code></li></ul><p id="ecd6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="b55c" class="mq lg iq le b gy mr ms l mt mu">export default {<br/>  onRenderTriggered(e) {<br/>    debugger<br/>  }<br/>}</span></pre><p id="0c8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查哪个依赖项导致组件重新呈现。</p><h1 id="b89e" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">依赖注入</h1><p id="1eef" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用<code class="fe lb lc ld le b">provide</code>和<code class="fe lb lc ld le b">inject</code>函数注入依赖关系。</p><p id="52f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">provide</code>和<code class="fe lb lc ld le b">inject</code>启用依赖注入，类似于Vue 2.x中的project和inject。</p><p id="eded" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="8c6d" class="mq lg iq le b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;&lt;/div&gt;<br/>&lt;/template&gt;</span><span id="0ddc" class="mq lg iq le b gy mv ms l mt mu">&lt;script&gt;<br/>import { provide, inject } from "vue";</span><span id="19f6" class="mq lg iq le b gy mv ms l mt mu">const ThemeSymbol = Symbol();</span><span id="bc8f" class="mq lg iq le b gy mv ms l mt mu">const Ancestor = {<br/>  setup() {<br/>    provide(ThemeSymbol, "dark");<br/>  },<br/>};</span><span id="e4b3" class="mq lg iq le b gy mv ms l mt mu">export default {<br/>  name: "App",<br/>  setup() {<br/>    const theme = inject(ThemeSymbol, "light");<br/>    return {<br/>      theme,<br/>    };<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="0b06" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe lb lc ld le b">Ancestor</code>组件，它调用<code class="fe lb lc ld le b">provide</code>让我们把用<code class="fe lb lc ld le b">ThemeSymbol</code>标识的依赖关系传递给<code class="fe lb lc ld le b">App</code>组件。</p><p id="82f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lb lc ld le b">App</code>的<code class="fe lb lc ld le b">setup</code>方法中，我们用<code class="fe lb lc ld le b">ThemeSymbol</code>调用<code class="fe lb lc ld le b">inject</code>来获取从<code class="fe lb lc ld le b">provide</code>传入的数据。</p><p id="9931" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果没有提供标识符<code class="fe lb lc ld le b">ThemeSymbol</code>，则<code class="fe lb lc ld le b">'light'</code>是默认值。</p><h1 id="c946" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">模板参考</h1><p id="edb3" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">组合API允许我们访问模板引用。</p><p id="a22d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用<code class="fe lb lc ld le b">ref</code>函数来创建ref。</p><p id="e2c7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以在模板中将它分配给我们想要的元素或组件。</p><p id="3cae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="ec0f" class="mq lg iq le b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div ref="root"&gt;&lt;/div&gt;<br/>&lt;/template&gt;</span><span id="86ab" class="mq lg iq le b gy mv ms l mt mu">&lt;script&gt;<br/>import { ref, onMounted } from "vue";</span><span id="1fa4" class="mq lg iq le b gy mv ms l mt mu">export default {<br/>  name: "App",<br/>  setup() {<br/>    const root = ref(null);</span><span id="2eb5" class="mq lg iq le b gy mv ms l mt mu">    onMounted(() =&gt; {<br/>      console.log(root.value);<br/>    });</span><span id="1a8e" class="mq lg iq le b gy mv ms l mt mu">    return {<br/>      root,<br/>    };<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="f5b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe lb lc ld le b">ref</code>函数创建<code class="fe lb lc ld le b">root</code> ref。</p><p id="146b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe lb lc ld le b">ref</code>的名称设置为<code class="fe lb lc ld le b">ref</code>属性。</p><p id="7197" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那么<code class="fe lb lc ld le b">root.value</code>将是div。</p><p id="6bee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们使用一个渲染函数，我们写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="5db3" class="mq lg iq le b gy mr ms l mt mu">&lt;template&gt;<br/>  &lt;div&gt;&lt;/div&gt;<br/>&lt;/template&gt;</span><span id="c1e3" class="mq lg iq le b gy mv ms l mt mu">&lt;script&gt;<br/>import { ref, onMounted, h } from "vue";</span><span id="4232" class="mq lg iq le b gy mv ms l mt mu">export default {<br/>  name: "App",<br/>  setup() {<br/>    const root = ref(null);</span><span id="19db" class="mq lg iq le b gy mv ms l mt mu">    onMounted(() =&gt; {<br/>      console.log(root.value);<br/>    });</span><span id="cbfd" class="mq lg iq le b gy mv ms l mt mu">    return () =&gt;<br/>      h("div", {<br/>        ref: root,<br/>      });<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="65ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了将ref分配给我们在<code class="fe lb lc ld le b">h</code>函数中创建的div。</p><h1 id="2d45" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="b8fe" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以用组合API将生命周期挂钩和引用添加到我们的Vue 3应用程序中。</p><p id="7f75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nk">更多内容看</em> <a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="nk">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>