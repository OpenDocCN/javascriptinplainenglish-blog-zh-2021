<html>
<head>
<title>Build a MySQL Node.js CRUD App #4: Deploying to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个MySQL Node.js CRUD应用程序#4:部署到Heroku</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-mysql-node-js-crud-app-4-deploying-to-heroku-finale-1f69a005812b?source=collection_archive---------12-----------------------#2021-01-17">https://javascript.plainenglish.io/build-a-mysql-node-js-crud-app-4-deploying-to-heroku-finale-1f69a005812b?source=collection_archive---------12-----------------------#2021-01-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f305c52007ed4f9d3b82c8dea2929161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8EmNkE0_EWs1Msam9X7fw.png"/></div></div></figure><p id="2ff2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">大家好，欢迎来到<a class="ae kw" href="https://hashnode.com/series/lets-build-a-mysql-nodejs-crud-app-ckhzrl98g022j99s11xymfqkn" rel="noopener ugc nofollow" target="_blank">的最后一集，让我们构建一个MySQL Node.js CRUD应用程序系列</a>！在前一篇文章中，我们已经用React实现了我们的前端，并完成了我们的完整堆栈应用程序。</p><blockquote class="kx ky kz"><p id="1107" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">如果您没有读过前面的文章，请在这里找到<a class="ae kw" href="https://lo-victoria.com/build-a-mysql-nodejs-crud-app-3-the-client-side-with-react" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="2c08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们通过将反应MySQL应用程序部署到Heroku来结束本系列。Heroku是一个云平台(PaaS)，我们可以用它来免费托管我们的应用程序。</p><h1 id="8d02" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第1步:安装Heroku CLI</h1><p id="3bd8" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">如果您还没有这样做，请将Heroku CLI下载并安装到您的设备中。点击此<a class="ae kw" href="https://devcenter.heroku.com/articles/heroku-cli" rel="noopener ugc nofollow" target="_blank">链接</a>并按照他们的下载说明进行操作。</p><p id="75e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，在这里创建Heroku账户<a class="ae kw" href="https://signup.heroku.com/" rel="noopener ugc nofollow" target="_blank">。注册免费层(或任何层)即可开始。</a></p><h1 id="b991" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第二步:Package.json</h1><p id="96ca" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在，让我们对应用程序进行必要的更改，为Heroku部署做准备。</p><p id="fbc1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转至我们的<code class="fe mh mi mj mk b">package.json</code>文件。在“脚本”属性下，将默认的开始脚本更改为:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3021" class="mt lf iq mk b gy mu mv l mw mx">"start": "node server.js",</span></pre><p id="faca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后将应用程序的节点版本添加为:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="a39e" class="mt lf iq mk b gy mu mv l mw mx">"engines": {<br/>    "node": "12.14.1"<br/>  },</span></pre><h1 id="b05d" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第3步:Procfile</h1><p id="be47" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">在项目的根目录中，创建一个名为Procfile的新文件，并在其中添加以下行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="c494" class="mt lf iq mk b gy mu mv l mw mx">web:node server.js</span></pre><p id="18f7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Procfile指定了应用程序在启动时必须执行的命令。如需了解更多信息，请在此处阅读Heroku的官方文件<a class="ae kw" href="https://devcenter.heroku.com/articles/procfile" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="476e" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第4步:Server.js</h1><p id="c1b9" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">因为我们要部署一个完整的应用程序，所以我们必须让我们在<code class="fe mh mi mj mk b">server.js</code>的快速服务器能够提供来自我们的反应应用程序的静态文件。</p><p id="df9f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为此，首先在<code class="fe mh mi mj mk b">server.js</code>顶部导入一个名为path的内置模块。</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="bbc8" class="mt lf iq mk b gy mu mv l mw mx">const path = require("path");</span></pre><p id="4d4e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，添加以下行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0345" class="mt lf iq mk b gy mu mv l mw mx">// declare react files in build as static<br/>app.use(express.static(path.join(__dirname, "build")));</span><span id="1cbe" class="mt lf iq mk b gy my mv l mw mx">// serve index.html from the build folder<br/>app.get("/*", (req, res) =&gt; {<br/>  res.sendFile(path.join(__dirname, "build", "index.html"));<br/>});</span></pre><p id="c445" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们需要做的就是通过运行以下命令来创建构建文件夹:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="5472" class="mt lf iq mk b gy mu mv l mw mx">npm run build</span></pre><p id="4dbd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">名为<code class="fe mh mi mj mk b">build</code>的文件夹应该出现在根目录中。</p><h1 id="30bf" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第5步:创建Heroku应用程序</h1><p id="3ef5" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">现在，我们准备创建一个英雄库应用程序。首先，为项目创建一个git存储库。</p><p id="9bd2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后运行以下命令创建应用程序:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8a5f" class="mt lf iq mk b gy mu mv l mw mx">heroku create &lt;app-name&gt;</span></pre><p id="4240" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，使用以下工具将其部署到Heroku:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="cdd8" class="mt lf iq mk b gy mu mv l mw mx">git push heroku master</span></pre><p id="a25f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在该应用程序应该在Heroku上，但它还不会工作，因为它没有连接到任何MySQL数据库。</p><p id="a62d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们一直用来测试的只是本地的。我们需要一个名为ClearDB的服务提供商来帮助我们连接到MySQL数据库。</p><h1 id="e399" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第6步:ClearDB设置</h1><p id="d3e9" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">通过以下方式将ClearDB加载项安装到我们的Heroku应用程序中:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0714" class="mt lf iq mk b gy mu mv l mw mx">heroku addons:create cleardb:ignite</span></pre><blockquote class="kx ky kz"><p id="83de" class="jy jz la ka b kb kc kd ke kf kg kh ki lb kk kl km lc ko kp kq ld ks kt ku kv ij bi translated">注意:ignite是指ClearDB的免费版本。如果需要，请随意使用其他版本。</p></blockquote><p id="e926" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">安装ClearDB后，一个名为<code class="fe mh mi mj mk b">CLEARDB_DATABASE_URL</code>的配置变量会自动添加到我们的Heroku app中。要从我们的命令提示符中检索它，请运行:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="3cca" class="mt lf iq mk b gy mu mv l mw mx">heroku config | findstr CLEARDB_DATABASE_URL</span></pre><p id="cef3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们的命令提示符将打印URL，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="8e6b" class="mt lf iq mk b gy mu mv l mw mx">mysql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;/&lt;database&gt;?reconnect=true</span></pre><p id="0ccc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意格式，因为我们必须将我们的环境变量设置为Heroku应用程序，如下所示:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="68d7" class="mt lf iq mk b gy mu mv l mw mx">heroku config:set DB_USER=&lt;user&gt;</span><span id="57ab" class="mt lf iq mk b gy my mv l mw mx">heroku config:set DB_PASSWORD=&lt;password&gt;</span><span id="6dd4" class="mt lf iq mk b gy my mv l mw mx">heroku config:set DB_HOST=&lt;host&gt;</span><span id="fed7" class="mt lf iq mk b gy my mv l mw mx">heroku config:set DB=&lt;database&gt;</span></pre><h1 id="92ec" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤7: MySQL工作台</h1><p id="97a9" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">我们已经用ClearDB建立了MySQL数据库连接，但是缺少一样东西——表。因此，让我们像创建<code class="fe mh mi mj mk b">localhost</code>数据库一样创建它。</p><p id="ba2f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开MySQL Workbench并添加一个新的数据库连接。您可以随意命名该连接。使用CLEARDB_DATABASE_URL中的<code class="fe mh mi mj mk b">&lt;host&gt;</code>值作为主机。并使用<code class="fe mh mi mj mk b">&lt;user&gt;</code>值作为用户名。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/c92e3fbd00c969c58b1bf349b8166b07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CyVBcn6ZIDZbkW51"/></div></div></figure><p id="af82" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您忘记了它们的值，您可以随时在命令提示符下查看之前打印的URL。它将采用以下格式:</p><pre class="ml mm mn mo gt mp mk mq mr aw ms bi"><span id="0c7a" class="mt lf iq mk b gy mu mv l mw mx">mysql://&lt;user&gt;:&lt;password&gt;@&lt;host&gt;/&lt;database&gt;?reconnect=true</span></pre><p id="1b60" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，点击“存储在保险库中”输入密码，这是ClearDB <code class="fe mh mi mj mk b">&lt;password&gt;</code>。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/c2f5e842d6b6dbbcd32685d451daacdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ou0WPRbzevqJLtm4"/></div></div></figure><p id="ef61" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">之后，点击窗口底部的“测试连接”。您应该会看到一个弹出窗口，提示连接成功。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/e09530ce8e36429847dd3447c2ba04e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aRidSIQkjf9Z-rPa"/></div></div></figure><p id="04c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，您可以单击OK来完成新连接的设置，它应该会出现在我们的工作台主页上，如下所示。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/d6356a0dc8c201fd7166e6250b3fa21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-6fo6G9QDWVgvHJ4"/></div></div></figure><p id="da98" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">单击ClearDB连接，您应该看到默认情况下，我们的模式名是ClearDB <code class="fe mh mi mj mk b">&lt;database&gt;</code>。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/4cb9561dd5e6f5cae73b59177b7aa71a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/0*HfVFqm3EWt09mmgA"/></div></figure><p id="cc7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，让我们创建book_reviews表，就像我们为<code class="fe mh mi mj mk b">localhost</code>数据库创建的表一样。</p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/5b9255f49a5aabdc57b8023126e0991e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K61pK4boLpTeh2nB"/></div></div></figure><h1 id="51df" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第八步:还有一件事…</h1><p id="f7e4" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated">万岁！我们已经将React Express应用程序部署到Heroku，我们已经成功设置了ClearDB和MySQL数据库，还有什么？</p><p id="f6c6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯，如果你去Heroku app网站(在我的例子中是<a class="ae kw" href="https://ravenbooks.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">ravenbooks.herokuapp.com</a>)，你会注意到客户端不能向服务器请求任何东西。控制台发送404错误，因为如果你还记得上一篇文章，我们在React应用程序中使用的URL都是<code class="fe mh mi mj mk b">localhost:3000</code>而不是<code class="fe mh mi mj mk b"><a class="ae kw" href="https://ravenbooks.herokuapp.com/." rel="noopener ugc nofollow" target="_blank">https://ravenbooks.herokuapp.com/</a></code> <a class="ae kw" href="https://ravenbooks.herokuapp.com/." rel="noopener ugc nofollow" target="_blank">。</a></p><p id="92e3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要修复此错误，请将<code class="fe mh mi mj mk b">App.js</code>、<code class="fe mh mi mj mk b">Add.js</code>和其他组件中的所有URL从<code class="fe mh mi mj mk b">https:localhost:3000/reviews</code>更改为<code class="fe mh mi mj mk b"><a class="ae kw" href="https://ravenbooks.herokuapp.com/reviews." rel="noopener ugc nofollow" target="_blank">https://ravenbooks.herokuapp.com/reviews</a></code>、<a class="ae kw" href="https://ravenbooks.herokuapp.com/reviews." rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ca4b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们的应用程序应该可以完美工作了！</p><h1 id="2005" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">感谢阅读！</h1><p id="7916" class="pw-post-body-paragraph jy jz iq ka b kb mc kd ke kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv ij bi translated"><a class="ae kw" href="https://hashnode.com/series/lets-build-a-mysql-nodejs-crud-app-ckhzrl98g022j99s11xymfqkn" rel="noopener ugc nofollow" target="_blank">到此结束，让我们构建一个MySQL Node.js CRUD应用程序系列</a>！如果你一直在关注，感谢你阅读这个系列直到最后。我希望它能以任何方式帮助您开始在React项目中实现MySQL。如果是，请喜欢并分享给周围的人。</p><p id="bb4c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">要查看这个演示应用程序的完整代码，请随意访问<a class="ae kw" href="https://github.com/victoria-lo/raven-books" rel="noopener ugc nofollow" target="_blank"> repo </a>并在这里查看应用程序<a class="ae kw" href="https://ravenbooks.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">，但请不要发布任何奇怪的东西。感谢阅读！干杯！</a></p><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/0f278ab9137914eb02698ed2810e8a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rN10M6QSyx2Jy78h.png"/></div></div></figure><ul class=""><li id="30a2" class="ng nh iq ka b kb kc kf kg kj ni kn nj kr nk kv nl nm nn no bi translated"><a class="ae kw" href="https://bit.ly/3Tw34nC" rel="noopener ugc nofollow" target="_blank">高级JavaScript </a>课程</li><li id="271e" class="ng nh iq ka b kb np kf nq kj nr kn ns kr nt kv nl nm nn no bi translated"><a class="ae kw" href="https://bit.ly/3AZ6NCM" rel="noopener ugc nofollow" target="_blank">通用编程</a>课程</li><li id="bc9c" class="ng nh iq ka b kb np kf nq kj nr kn ns kr nt kv nl nm nn no bi translated"><a class="ae kw" href="https://bit.ly/3KziWkX" rel="noopener ugc nofollow" target="_blank">数据结构&amp;算法</a>课程</li></ul></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="8e56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="la">原载于https://lo-victoria.com</em><a class="ae kw" href="https://lo-victoria.com/build-a-mysql-nodejs-crud-app-4-deploying-to-heroku-finale" rel="noopener ugc nofollow" target="_blank"><em class="la"/></a><em class="la">。</em></p></div></div>    
</body>
</html>