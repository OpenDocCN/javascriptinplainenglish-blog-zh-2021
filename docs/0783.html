<html>
<head>
<title>How to Persist and Rehydrate Vuex State Between Page Reloads in Nuxt.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Nuxt.js中，如何在页面重新加载之间保持和恢复Vuex状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-persist-and-rehydrate-your-vuex-state-between-page-reloads-in-nuxt-js-5c99b58752bb?source=collection_archive---------2-----------------------#2021-02-18">https://javascript.plainenglish.io/how-to-persist-and-rehydrate-your-vuex-state-between-page-reloads-in-nuxt-js-5c99b58752bb?source=collection_archive---------2-----------------------#2021-02-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/89dac0089b8a3f0a00af315455d06da4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5sw4WA9vLoUQhWjW_315Q.png"/></div></div></figure><p id="e5b6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在一个新项目中，我一直在做一个用户资料页面。我希望即使在用户重新加载页面后也能保存来自Vuex商店的表单数据，并且希望在注销时随意清除这些数据。我希望用户能够填写他们的个人资料详细信息，重新加载页面，并返回找到每个表单字段仍然填充有他们填写的数据。</p><p id="c4df" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io"> Vuex-persistedstate </strong>是一个<strong class="jx io"> npm包</strong>，它让我们将我们的Vuex状态存储到<code class="fe kt ku kv kw b">localStorage</code>或<code class="fe kt ku kv kw b">cookies</code>中。</p><p id="3d55" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kx" href="https://alexkasongo.github.io/vuex-persistedstate-nuxt-ssr/" rel="noopener ugc nofollow" target="_blank">竣工工程</a>🌱</p><p id="0b1d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kx" href="https://github.com/alexkasongo/vuex-persistedstate-nuxt-ssr" rel="noopener ugc nofollow" target="_blank">回购</a>🌱</p><h1 id="1152" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">装置</h1><ol class=""><li id="6e9e" class="lw lx in jx b jy ly kc lz kg ma kk mb ko mc ks md me mf mg bi translated">将Vuex-persistedstate添加到项目中。</li></ol><pre class="mh mi mj mk gt ml kw mm mn aw mo bi"><span id="6888" class="mp kz in kw b gy mq mr l ms mt">yarn add or npm install vuex-persistedstate</span></pre><p id="3267" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">2.在单独的文件中创建一个新的插件实例。你可以随便叫它什么，我把它叫做<code class="fe kt ku kv kw b">persistedState.client.js</code>,把你的插件命名为‘XXX . client . js’会让它只在客户端执行。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/03ce562222884d58d5461269efae1a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrMDQM8dZ6GfrIw2c0cvHA.png"/></div></div></figure><p id="079d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">3.将插件添加到<code class="fe kt ku kv kw b">nuxt.config.js</code></p><pre class="mh mi mj mk gt ml kw mm mn aw mo bi"><span id="a1ca" class="mp kz in kw b gy mq mr l ms mt">// nuxt.config.js<br/><br/>...<br/>/*<br/> * Naming your plugin 'xxx.client.js' will make it execute only on   the client-side.<br/> * https://nuxtjs.org/guide/plugins/#name-conventional-plugin<br/> */<br/>plugins: [{ src: '~/plugins/persistedState.client.js' }]<br/>...</span></pre><p id="23f2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">4.在<code class="fe kt ku kv kw b">index.vue</code>创建一个简单的表单，它可以在任何地方。我用的是<a class="ae kx" href="https://buefy.org/" rel="noopener ugc nofollow" target="_blank"> Beufy </a>，它是基于<a class="ae kx" href="http://bulma.io/" rel="noopener ugc nofollow" target="_blank">布尔玛</a>的<a class="ae kx" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">vue . js</a>/<a class="ae kx" href="https://nuxtjs.org/" rel="noopener ugc nofollow" target="_blank">nuxt . js</a>的轻量级UI组件库。我绝对喜欢它🌱。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/5b4d77067eca124977f3a1205cc842a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eudNZ8s9SPgQllrvYM1ywg.png"/></div></div></figure><pre class="mh mi mj mk gt ml kw mm mn aw mo bi"><span id="3a31" class="mp kz in kw b gy mq mr l ms mt">&lt;template&gt;<br/>  &lt;div class="p-5 columns"&gt;<br/>    &lt;div class="column"&gt;<br/>      &lt;section&gt;<br/>        &lt;b-field label="Name"&gt;<br/>          &lt;b-input v-model="userName" type="text"&gt;&lt;/b-input&gt;<br/>        &lt;/b-field&gt;<br/><br/>        &lt;b-field label="Email"&gt;<br/>          &lt;b-input v-model="userEmail" type="email" maxlength="30"&gt; &lt;/b-input&gt;<br/>        &lt;/b-field&gt;<br/><br/>        &lt;b-field label="Message"&gt;<br/>          &lt;b-input v-model="message" maxlength="200" type="textarea"&gt;&lt;/b-input&gt;<br/>        &lt;/b-field&gt;<br/><br/>        &lt;b-field label="Subject" class="mb-5"&gt;<br/>          &lt;b-select v-model="selected" placeholder="Select a subject" expanded&gt;<br/>            &lt;option value="Option 1"&gt;Option 1&lt;/option&gt;<br/>            &lt;option value="Option 2"&gt;Option 2&lt;/option&gt;<br/>          &lt;/b-select&gt;<br/>        &lt;/b-field&gt;<br/>      &lt;/section&gt;<br/>    &lt;/div&gt;<br/>    &lt;div class="column"&gt;<br/>      &lt;section&gt;<br/>        &lt;b-field&gt;<br/>          &lt;b-switch @click.native="switchPersistance" v-model="isSwitch"<br/>            &gt;Start Persistance&lt;/b-switch<br/>          &gt;<br/>        &lt;/b-field&gt;<br/>      &lt;/section&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import { mapState, mapActions } from 'vuex'<br/><br/>export default {<br/>  name: 'HomePage',<br/><br/>  data: () =&gt; ({<br/>    isSwitch: false,<br/>    userName: '',<br/>    userEmail: '',<br/>    message: '',<br/>    selected: '',<br/>  }),<br/>  computed: {<br/>    ...mapState({<br/>      persistedState: 'persistedState',<br/>    }),<br/>  },<br/>  methods: {<br/>    // persist to vuex store<br/>    ...mapActions({<br/>      switchPersistanceState: 'switchPersistanceState',<br/>    }),<br/><br/>    switchPersistance() {<br/>      // when the switch is turned on do this.<br/>      if (this.isSwitch === false) {<br/>        const userInfo = {<br/>          userName: this.userName,<br/>          userEmail: this.userEmail,<br/>          message: this.message,<br/>          selected: this.selected,<br/>        }<br/><br/>        this.switchPersistanceState(userInfo)<br/>      }<br/><br/>      // When the swith is turned off, do this.<br/>      if (this.isSwitch === true) {<br/>        this.userName = ''<br/>        this.userEmail = ''<br/>        this.message = ''<br/>        this.selected = ''<br/><br/>        this.switchPersistanceState(null)<br/>      }<br/>    },<br/>  },<br/>  // Do this when the page reloads<br/>  mounted() {<br/>    // check if persisted state exists<br/>    if (this.persistedState !== null) {<br/>      this.isSwitch = true<br/>      this.userName = this.persistedState.userName<br/>      this.userEmail = this.persistedState.userEmail<br/>      this.message = this.persistedState.message<br/>      this.selected = this.persistedState.selected<br/>    } else {<br/>      this.isSwitch = false<br/>    }<br/>  },<br/>}<br/>&lt;/script&gt;</span></pre><p id="8c38" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该会看到类似这样的内容:</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/2a5b15dbd0ae0465f14860dddec8caee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADlndvJfEJenLTeqYxnrpg.png"/></div></div></figure><p id="e750" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">5.创建一个名为<code class="fe kt ku kv kw b">index.js</code>的<strong class="jx io"> vuex存储</strong>文件</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/e81f7f4ba1e2b44a817decbaffae0a10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iRHDDhgr13dg5KKILRaSfg.png"/></div></div></figure><pre class="mh mi mj mk gt ml kw mm mn aw mo bi"><span id="f34e" class="mp kz in kw b gy mq mr l ms mt">export const state = () =&gt; ({<br/>  persistedState: null,<br/>  alert: false,<br/>})<br/><br/>export const getters = {}<br/><br/>export const actions = {<br/>  switchPersistanceState({ commit }, payload) {<br/>    commit('SET_STATE', payload)<br/>    commit('SET_ALERT', true)<br/>  },<br/>}<br/><br/>export const mutations = {<br/>  SET_STATE(state, payload) {<br/>    state.persistedState = payload<br/>  },<br/>  SET_ALERT(state, payload) {<br/>    state.alert = payload<br/>  },<br/>}</span></pre><p id="dc3e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">6.现在，我们终于可以使用vuex-persistedstate将数据持久化到本地存储了。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/cd6e53a1d90c8e97a0641ed0b4a6b088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GrfKlbQa7FdtzGbWATaIvA.png"/></div></div></figure><pre class="mh mi mj mk gt ml kw mm mn aw mo bi"><span id="9bcd" class="mp kz in kw b gy mq mr l ms mt">import createPersistedState from 'vuex-persistedstate'<br/><br/>export default ({ store }) =&gt; {<br/>  createPersistedState({<br/>    key: 'vuex',<br/>    paths: ['persistedState'],<br/>  })(store)<br/>}</span></pre><p id="192a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">7.查看运行中的持久化数据。打开devtools。我用的是谷歌浏览器。转到应用程序，点击本地存储。</p><figure class="mh mi mj mk gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/e2ed2cf6fc869656b64947b368cd0f75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7Av1yC7B3OfZHWbkq2ocg.png"/></div></div></figure><h2 id="f902" class="mp kz in bd la mx my dn le mz na dp li kg nb nc lm kk nd ne lq ko nf ng lu nh bi translated">结论</h2><p id="df35" class="pw-post-body-paragraph jv jw in jx b jy ly ka kb kc lz ke kf kg ni ki kj kk nj km kn ko nk kq kr ks ig bi translated">就是这样。希望这将帮助您创建在服务器端和客户端呈现之间持久化数据的“通用”应用程序。</p><p id="c088" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">阿列科🌱</p></div></div>    
</body>
</html>