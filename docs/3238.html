<html>
<head>
<title>How to Handle Network Connection in Your React Native App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React本地应用中处理网络连接</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/network-connection-in-your-react-native-app-4b12f0c212ea?source=collection_archive---------2-----------------------#2021-07-02">https://javascript.plainenglish.io/network-connection-in-your-react-native-app-4b12f0c212ea?source=collection_archive---------2-----------------------#2021-07-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/39e64e73edaaf6d5cc4ad8e738a896bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QxMFRdk-iHCgNzrEE39gJg.jpeg"/></div></div></figure><p id="18ed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的应用程序可能需要不时检测用户的互联网连接。如果用户离线或没有像样的互联网连接，您可以在不同的路径上操作。在实践中，如果您的程序广播远程视频并需要强大的互联网连接，就会出现这种情况。如果用户无法访问互联网或可靠的连接，您可以专注于无缝地通知他们视频不能进行流式传输。这比抛出一个错误并让用户困惑要好。</p><p id="a925" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">react-native社区报告中提供的<a class="ae kt" href="https://github.com/react-native-netinfo/react-native-netinfo" rel="noopener ugc nofollow" target="_blank">React Native Network Info</a>API为我们提供了有关网络连接类型和质量的信息。</p><p id="70a1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意:React Native预装的NetInfo API已被弃用。React Native的官方文档建议我们使用React Native Network Info API，我们将在这篇博客文章中介绍它。</p><p id="3f21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们进入细节。</p><h1 id="e367" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">关键特征</h1><p id="717a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">React本地网络信息API可用于了解用户应用的互联网连接。以下是该API的一些主要特性:</p><ul class=""><li id="d131" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated">安卓、iOS、macOS、Windows都支持。</li><li id="7259" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">获取有关网络连接当前状态的信息。</li><li id="f4a6" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">找出你现在的网络连接类型(wifi、蜂窝、蓝牙等。)</li><li id="2003" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">确定当前的蜂窝连接世代(3g、4g等)。)</li><li id="cf24" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated">能够在超时的情况下执行网络可达性测试。</li></ul><h1 id="8986" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">装置</h1><p id="6f96" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">设置和使用库很简单。</p><p id="9610" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用yarn将包添加到项目中。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="2930" class="mu kv in mq b gy mv mw l mx my">yarn add @react-native-community/netinfo</span></pre><p id="c9d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用的是React Native &gt;= 0.60，就不需要费心手动链接库。</p><p id="78a1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你在iOS上链接CocoaPods，一定要使用下面的命令。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c537" class="mu kv in mq b gy mv mw l mx my">$ npx pod-install</span></pre><p id="b8bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Android上修改<em class="mz"> android/build.gradle </em>配置。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="4dd5" class="mu kv in mq b gy mv mw l mx my">buildscript {<br/>  ext {<br/>    buildToolsVersion = "28.0.3"<br/>    minSdkVersion = 16<br/>    compileSdkVersion = 28<br/>    targetSdkVersion = 28<br/>    # Only using Android Support libraries<br/>    supportLibVersion = "28.0.0"<br/>    # If using Android X<br/>    # Remove 'supportLibVersion' property and add specific versions for AndroidX libraries as <br/>    shown below<br/>    # androidXCore = "1.0.2" <br/>    // Add other AndroidX dependencies<br/>  }</span></pre><p id="2532" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">关于安装的更多细节，请参考官方<a class="ae kt" href="https://github.com/react-native-community/react-native-netinfo" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><h1 id="1aef" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用</h1><p id="d721" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">好了，现在你已经安装了React Native Network Info包，你已经准备好计算应用的互联网连接数据了。让我们来看看如何使用这个库。</p><p id="6a40" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，如下所示，从包中导入NetInfo API:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1c31" class="mu kv in mq b gy mv mw l mx my">import NetInfo from '@react-native-community/netinfo'</span></pre><h1 id="a5a2" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">useNetInfo挂钩</h1><p id="23d7" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">在函数组件中使用useNetInfo挂钩是不使用事件处理程序获取网络信息的最简单方法。这是我们正在使用的网络信息库的一部分。</p><p id="27ef" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">useNetInfo钩子返回NetInfoState类型，在下面的例子中描述了网络的当前状态。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1a18" class="mu kv in mq b gy mv mw l mx my">import {useNetInfo} from "@react-native-community/netinfo";<br/><br/>const MyComponent = () =&gt; {<br/>  // returns a hook with the NetInfoState type.<br/>  const netInfo = useNetInfo();<br/>  return (<br/>    &lt;View&gt;<br/>      &lt;Text&gt;Type: {netInfo.type}&lt;/Text&gt;<br/>      &lt;Text&gt;Is Connected? {netInfo.isConnected.toString()}&lt;/Text&gt;<br/>    &lt;/View&gt;<br/>  );<br/>};</span></pre><h1 id="860e" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">NetInfoState API</h1><p id="ab23" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">useNetInfo钩子返回当前的网络状态给我们。让我们看看NetInfoState API支持的属性。</p><ul class=""><li id="8be6" class="lx ly in jx b jy jz kc kd kg lz kk ma ko mb ks mc md me mf bi translated"><em class="mz"> type — </em>返回当前连接(蜂窝、wifi、蓝牙等)的NetInfoStateType。)</li><li id="fd9b" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><em class="mz"> isConnected — </em>布尔值，表示是否有活动的网络连接(蜂窝、wifi、蓝牙等。)</li><li id="8ecc" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><em class="mz"> isInternetReachable — </em>一个布尔值，确定是否可以使用当前连接访问互联网。</li><li id="e737" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><em class="mz"> isWifiEnabled </em>(仅限Android一个布尔值，指示wifi是否已启用。</li><li id="ad47" class="lx ly in jx b jy mg kc mh kg mi kk mj ko mk ks mc md me mf bi translated"><em class="mz">详细信息— </em>根据网络连接的类型，这可以为我们提供有关连接的更多信息。连接的成本可以由多种因素决定。在这里，您可以了解更多有关wifi和蜂窝网络的信息。</li></ul><p id="b849" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通常，我们只需要知道互联网连接的类型，用户是否连接，以及在构建移动应用程序时他们的互联网是否可达。在某些情况下，您可能需要关于用户连接的更多信息，您可以使用这个库获得这些信息。让我们在上一个例子的基础上，从netinfo钩子中获取更多的信息。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6eb3" class="mu kv in mq b gy mv mw l mx my">import {useNetInfo} from "@react-native-community/netinfo";<br/><br/>const MyComponent = () =&gt; {<br/>  // returns a hook with the NetInfoState type.<br/>  const netInfo = useNetInfo();<br/>  return (<br/>    &lt;View&gt;<br/>      &lt;Text&gt;Type: {netInfo.type}&lt;/Text&gt;<br/>      &lt;Text&gt;Is Connected? {netInfo.isConnected.toString()}&lt;/Text&gt;<br/>      &lt;Text&gt;Is Connection Expensive ? <br/>      {netInfo.isConnectionExpensive.toString()}&lt;/Text&gt;<br/>      { netInfo.type == "wifi" &amp;&amp; <br/>        &lt;&gt;<br/>        &lt;Text&gt;SSID: {netInfo.details.ssid}&lt;/Text&gt;<br/>        &lt;Text&gt;BSSID: {netInfo.details.bssid}&lt;/Text&gt;<br/>        &lt;/&gt;<br/>      }<br/>    &lt;/View&gt;<br/>  );<br/>};</span></pre><h1 id="dcae" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">addEventListener()</h1><p id="adfe" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果从类组件获取NetInfo，您需要添加事件侦听器来订阅用户网络连接的更新。useNetInfo挂钩可用于获取功能组件中的当前网络连接。钩子留意幕后的信息。</p><p id="910e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看一个例子，看看我们如何在组件中使用事件侦听器来获取网络连接信息。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="1ece" class="mu kv in mq b gy mv mw l mx my">let unsubscribe = null<br/>componentDidMount() {<br/>  // Subscribe<br/>  unsubscribe = NetInfo.addEventListener(state =&gt; {<br/>  console.log("Connection type", state.type);<br/>  console.log("Is connected?", state.isConnected);<br/> });<br/>}<br/><br/>componentWillUnmount() {<br/>  // Unsubscribe<br/>  if (unsubscribe != null) unsubscribe()<br/>}</span></pre><p id="9693" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在订阅前面代码片段中componentDidMount()生命周期方法的任何更改。订阅后，听众将获得最新的网络信息。当连接状态发生变化时，将使用NetInfoState类型的参数调用回调。</p><h1 id="a512" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">获取()</h1><p id="273a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">fetch()方法可以用于只获取一次网络连接信息，而不必订阅组件中的任何更新。它返回一个带有NetInfoState类型的承诺作为结果。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="d984" class="mu kv in mq b gy mv mw l mx my">NetInfo.fetch().then(state =&gt; {<br/>  console.log("Connection type", state.type);<br/>  console.log("Is connected?", state.isConnected);<br/>});</span></pre><h1 id="a886" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">配置()</h1><p id="22be" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">您还可以使用API通过一组设置选项来设置库。您可以通过提供想要更改的值来调整默认值。如果你要使用这个函数，确保你的应用一启动就调用它。</p><p id="d7a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如何使用configure方法的示例如下所示。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="a14b" class="mu kv in mq b gy mv mw l mx my">NetInfo.configure({<br/>  reachabilityUrl: 'https://clients3.google.com/generate_204',<br/>  reachabilityTest: async (response) =&gt; response.status === 204,<br/>  reachabilityLongTimeout: 60 * 1000, // 60s<br/>  reachabilityShortTimeout: 5 * 1000, // 5s<br/>  reachabilityRequestTimeout: 15 * 1000, // 15s<br/>});</span></pre><h1 id="920f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="cad9" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">就这样了，伙计们。如果你想建立离线应用或依赖于网络连接数据的应用，请查看<a class="ae kt" href="https://github.com/react-native-netinfo/react-native-netinfo" rel="noopener ugc nofollow" target="_blank"> React Native Net Info </a>。</p><p id="410b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你正在寻找一门课程，让你开始学习React Native并教授基础知识，请查看下面链接的Mosh课程。</p><p id="91dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://bit.ly/2UhGhS6" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mz">终极反应原生课程—代码同Mosh </em> </strong> </a></p><p id="42b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望你喜欢这篇文章。更多文章再见。如果你喜欢这篇文章，别忘了分享给你的网络。</p><p id="512b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mz">更多内容请看</em><a class="ae kt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>