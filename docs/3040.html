<html>
<head>
<title>Serverless Redis on Google Cloud Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌云功能上的无服务器Redis</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/serverless-redis-on-google-cloud-functions-3a4160731c83?source=collection_archive---------10-----------------------#2021-06-20">https://javascript.plainenglish.io/serverless-redis-on-google-cloud-functions-3a4160731c83?source=collection_archive---------10-----------------------#2021-06-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/54abc642b9d01ec49698a83cad1ea87f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGImntzAZOy3ExpvQM6OpQ.png"/></div></div></figure><p id="aa60" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Google Cloud Functions是第二受欢迎的无服务器执行平台。类似于AWS Lambda，它是无状态的，即你需要访问外部资源来读取或写入你的应用程序状态。在这篇文章中，我们将介绍Redis作为谷歌云功能的数据库。</p><p id="519d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本教程展示了如何在Google Cloud函数上用Redis构建一个无服务器API。API将简单地统计页面浏览量，并以JSON格式显示出来。</p><p id="4902" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看演示:<a class="ae kt" href="https://us-central1-functions-317005.cloudfunctions.net/helloGET" rel="noopener ugc nofollow" target="_blank">https://us-central 1-functions-317005 . cloud functions . net/hello get</a></p><p id="fea2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">见代码:<a class="ae kt" href="https://github.com/upstash/examples/tree/master/using-google-cloud-functions" rel="noopener ugc nofollow" target="_blank">https://github . com/upstash/examples/tree/master/using-Google-cloud-functions</a></p><ul class=""><li id="7ff3" class="ku kv in jx b jy jz kc kd kg kw kk kx ko ky ks kz la lb lc bi translated">无服务器计算:谷歌云功能(Node.js)</li><li id="d420" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">无服务器数据存储:通过Upstash的Redis</li><li id="ac4f" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">部署工具:gcloud</li></ul><h2 id="3a71" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">先决条件</h2><ul class=""><li id="421f" class="ku kv in jx b jy mb kc mc kg md kk me ko mf ks kz la lb lc bi translated">谷歌云功能的GCP账户。</li><li id="fb17" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">安装<a class="ae kt" href="https://cloud.google.com/sdk/docs/install" rel="noopener ugc nofollow" target="_blank">谷歌云SDK </a>。</li><li id="7be9" class="ku kv in jx b jy ld kc le kg lf kk lg ko lh ks kz la lb lc bi translated">无服务器Redis的一个新帐户。</li></ul><h2 id="a696" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">步骤1:初始化项目</h2><p id="0c23" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mg ki kj kk mh km kn ko mi kq kr ks ig bi translated">创建一个文件夹，然后在文件夹中运行<code class="fe mj mk ml mm b">npm init</code>。</p><h2 id="e7eb" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">步骤2:安装Redis客户端</h2><p id="4f42" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mg ki kj kk mh km kn ko mi kq kr ks ig bi translated">我们唯一的依赖是Redis客户端。通过<code class="fe mj mk ml mm b">npm install ioredis</code>安装go-redis</p><h2 id="bc4a" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">步骤3:创建Redis数据库</h2><p id="5e37" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mg ki kj kk mh km kn ko mi kq kr ks ig bi translated">从后台控制台创建一个Redis数据库。<strong class="jx io">选择GCP美国中部-1作为地区。</strong>自由层应该足够了。这很简单，但如果你需要帮助，请查看<a class="ae kt" href="https://docs.upstash.com/" rel="noopener ugc nofollow" target="_blank">入门指南</a>。在“数据库详细信息”页面中，单击“连接”按钮。在下一步中，您将需要端点和密码。</p><h2 id="cfff" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">第四步:功能代码</h2><p id="95dc" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mg ki kj kk mh km kn ko mi kq kr ks ig bi translated">创建<strong class="jx io"> index.js </strong>如下:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="1561" class="li lj in mm b gy mv mw l mx my">var Redis = require("ioredis");</span><span id="5e4b" class="li lj in mm b gy mz mw l mx my">if (typeof client === 'undefined') {<br/>    var client = new Redis("REPLACE_YOUR_UPSTASH_REDIS_URL");<br/>}</span><span id="c147" class="li lj in mm b gy mz mw l mx my">exports.helloGET = async(req, res) =&gt; {<br/>    let count = await client.incr("counter");<br/>    res.send('Page view:' + count);<br/>};</span></pre><p id="fb04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用数据库的ioredis url替换<code class="fe mj mk ml mm b">“REPLACE_YOUR_UPSTASH_REDIS_URL”</code>。</p><p id="db03" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这段代码只是增加Redis数据库中的一个计数器，并以json格式返回它的值。</p><h2 id="69a8" class="li lj in bd lk ll lm dn ln lo lp dp lq kg lr ls lt kk lu lv lw ko lx ly lz ma bi translated">第五步:部署</h2><p id="7be5" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg mg ki kj kk mh km kn ko mi kq kr ks ig bi translated">现在我们已经准备好部署我们的API了。通过以下方式部署:</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="7cb8" class="li lj in mm b gy mv mw l mx my">gcloud functions deploy helloGET \<br/>--runtime nodejs14 --trigger-http --allow-unauthenticated</span></pre><p id="a71d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您将看到您的云功能的URL。单击URL以检查它是否正常工作。</p><pre class="mn mo mp mq gt mr mm ms mt aw mu bi"><span id="82df" class="li lj in mm b gy mv mw l mx my">httpsTrigger:<br/>securityLevel: SECURE_OPTIONAL<br/>url: <a class="ae kt" href="https://us-central1-functions-317005.cloudfunctions.net/helloGET" rel="noopener ugc nofollow" target="_blank">https://us-central1-functions-317005.cloudfunctions.net/helloGET</a></span></pre><p id="f079" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果出现问题，您可以在GCP控制台中查看您的云功能的日志，如下所示。</p><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/bd04b9ab853a23f3a6d90cc40a032611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SwJ-U4uuBDRUXhBA.png"/></div></div></figure></div><div class="ab cl nb nc hr nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ig ih ii ij ik"><p id="f0f6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ni">原载于</em><a class="ae kt" href="https://docs.upstash.com/tutorials/using_google_cloud_functions" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://docs.upstash.com</em></a><em class="ni">。</em></p><p id="a1ba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ni">更多内容看</em><a class="ae kt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ni">plain English . io</em></strong></a></p></div></div>    
</body>
</html>