<html>
<head>
<title>Is Deno.js Worthy Competition for Node.js?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno.js值得Node.js竞争吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/is-deno-js-worthy-competition-for-node-js-2d7c962a788f?source=collection_archive---------11-----------------------#2021-07-22">https://javascript.plainenglish.io/is-deno-js-worthy-competition-for-node-js-2d7c962a788f?source=collection_archive---------11-----------------------#2021-07-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0b97" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Deno.js Vs Node.js</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/9343a082acc15bafb08b0613b1663978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KCn5byUR-VwFTEAi"/></div></div></figure><p id="c16b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就Javascript运行时环境而言，除了节点，别无其他。但Deno的创始人、Node.js的前创始人决定改变这一点。现在Deno已经发布了，是时候看看它能否成为Node.js的有力竞争对手了。</p><p id="cfbe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno项目始于2018年，当时Node.js背后的原始开发人员之一瑞安·达尔(Ryan Dahl)在一次名为“Node.js我后悔的10件事”的演讲中宣布了Deno的开发。是的，这说明了一切。那么，问题是什么？我们为什么需要Node的替代产品？</p><h1 id="9cfc" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">什么是德诺？</h1><p id="9754" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">Deno是一个安全稳定的运行时环境，支持在V8引擎上运行的JavaScript和TypeScript。这是用铁锈写的。Deno的创建者打算充分利用JavaScript语言的所有最新特性。例如，它的API支持Promise对象，并使用es模块作为默认模块系统。它们还被设计成自给自足——不需要外部依赖。安全是Deno的主要设计重点。对光盘或联机的所有访问操作必须在脚本中明确发出。</p><h1 id="5349" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Deno vs Node.js</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/ff9a2696539a660ffaf3f45e70667def.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uLtaSPrShxcZI5lpu1PTbA.jpeg"/></div></figure><p id="0db2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno的创建者们非常希望为Node.js提供一个强大的替代品。因此，毫不奇怪，尽管他们有很多共同点，但这两者之间有一些主要的差异。</p><p id="a87c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在“Deno”基本上只是Node.js的变位词，事实上，正如我们在他们的官方页面下载中看到的那样，他们知道Deno是JavaScript和Typescript的安全运行时。如果我们看一看nodejs.org，我们会发现它离我们在那里发现的并不太远。Node.js是建立在chrome的V8 JavaScript引擎上的JavaScript运行时，事实上，现在，最终，它是由Node的发明者开发的新的JavaScript运行时。</p><p id="aaf7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来看一个简单的并列比较:</p><p id="cd87" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> DENONODE </strong>使用RUST编写的V8，然后使用C++编写的TypeScript和在沙箱中运行的JavaScript，访问受限——脚本中需要显式命令发布。访问问题仅限于运行脚本的用户的特定访问权限。分散模块——从URL加载。NPM ES模块CommonJs、API和标准库充分利用了ES和Promise。API和标准库是基于回调的。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="ee8f" class="ln lo iq bd lp lq mt ls lt lu mu lw lx jw mv jx lz jz mw ka mb kc mx kd md me bi translated">我们来练习一下！</h1><p id="9ed5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">和任何技术一样，实践胜过理论。但在我们进入最精彩的部分之前，让我们先安装Deno平台，并快速浏览一下应用程序结构。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/1b1b1adfadad5cd9b083776d582372d0.png" data-original-src="https://miro.medium.com/v2/0*wGY6BIknCrUAKksj"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Photo by <a class="ae ml" href="https://unsplash.com/@bradbarmore?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brad Barmore</a> on <a class="ae ml" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="9834" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">装置</h1><p id="525d" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">你得到的只是一个没有任何额外依赖的可执行文件。你可以通过操作系统软件包管理器来完成。例如，对于自制软件，命令将是<em class="nc"> brew install deno </em>。你也可以直接从官方的Deno库获得二进制文件。</p><p id="fefa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ml" href="https://github.com/denoland/deno/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/denoland/deno/releases</a></p><h1 id="3b2f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">应用程序结构</h1><p id="670c" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">从一开始就非常突出的一点是，您可以直接用TypeScript编写应用程序。不需要自己编译成JavaScript。此外，使用Rust编译TypeScript的方法目前也在规划阶段。</p><p id="1337" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno的创建者做出了一个大胆的决定，去掉了一个集中的包管理器，比如npm或NuGet。相反，代码是直接从URL加载的。运行脚本后，会从指定位置下载包，然后进行缓存。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3e4d" class="ni lo iq ne b gy nj nk l nl nm">import { Application, Router } from “https://deno.land/x/denotrain@v0.5.0/mod.ts";</span></pre><p id="b0f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">有趣的是，您可以在一个文件中使用给定库的不同版本。你需要做的就是导入它并添加别名。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="1f72" class="ni lo iq ne b gy nj nk l nl nm">import { Application as AppOld } from “https://deno.land/x/denotrain@v0.4.0/mod.ts";</span></pre><h1 id="6ffa" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">简单的基于模块的应用和单元测试</h1><p id="683f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们编写一个以数字为参数的简单脚本。然后，我们将使用一个模块将所有整数相加。结果将输出到控制台。</p><p id="4465" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将使用内置工具为模块编写一个简单的测试。为了简化，我们可以将所有参数转换为整数。</p><p id="1104" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们做三个文件。</p><ul class=""><li id="4598" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated"><em class="nc"> index.ts - </em>应用程序的主脚本、</li><li id="e5e2" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><em class="nc"> mathService.ts - </em>一个拥有将一个数乘以2的公共方法的类，</li><li id="7ef2" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><em class="nc"> mathService.test.ts - </em>乘法类的测试。</li></ul><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="a72c" class="ni lo iq ne b gy nj nk l nl nm">export class MathService { <br/>  sum(numbers: number[]) { <br/>    return numbers.reduce((value, number) =&gt;   Number.isInteger(number) ? value + number : value, 0) <br/>  }<br/>}</span></pre><p id="95e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno有一个内置的测试运行器和现成的断言。你可以在这里看到他们:<a class="ae ml" href="https://deno.land/std/testing" rel="noopener ugc nofollow" target="_blank">https://deno.land/std/testing</a></p><p id="2510" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">目前，没有关于创建存根的信息。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="814a" class="ni lo iq ne b gy nj nk l nl nm">import { assertEquals } from "https://deno.land/std/testing/asserts.ts"; <br/>import { MathService } from './mathService.ts';</span><span id="4d5a" class="ni lo iq ne b gy ob nk l nl nm">Deno.test('MathService', () =&gt; { <br/>  // given <br/>  const sut = new MathService();</span><span id="1563" class="ni lo iq ne b gy ob nk l nl nm">// when <br/>  const result = sut.sum([1, 3, 5]);</span><span id="a216" class="ni lo iq ne b gy ob nk l nl nm">// then <br/>  assertEquals(result, 9); <br/>})</span></pre><p id="a9f6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用<em class="nc"> deno test </em>命令直接从控制台启动测试。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b027" class="ni lo iq ne b gy nj nk l nl nm">$ deno test</span><span id="1717" class="ni lo iq ne b gy ob nk l nl nm">running 1 tests<br/>test MathService ... ok (3ms)<br/>test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out (4ms)</span></pre><p id="fab9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">剩下要做的就是写主脚本了。值得注意的是，Deno让我们可以在所有脚本中直接访问Deno名称空间。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8a7c" class="ni lo iq ne b gy nj nk l nl nm">import { MathService } from './mathService.ts';</span><span id="615d" class="ni lo iq ne b gy ob nk l nl nm">const mathService = new MathService(); <br/>const numbers: number[] = [];</span><span id="5f73" class="ni lo iq ne b gy ob nk l nl nm">Deno.args.forEach(number =&gt; numbers.push(parseInt(number, 10))); <br/> <br/>console.log(`Result: ${mathService.sum(numbers)}`);</span></pre><p id="a2e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要运行脚本，我们转到控制台并运行命令:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="f6b2" class="ni lo iq ne b gy nj nk l nl nm">$ deno run index.ts 2 7 6</span></pre><h1 id="c850" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">简单API</h1><p id="760b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">简单的基于shell的脚本很难达到Deno的能力范围。自从Deno发布以来，开发者已经添加了越来越多的第三方库。即使(很像Node刚开始的情况)，其中一些还是很粗糙的。</p><p id="24f8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们使用denotrain库的功能来创建一个简单的API。这个库显然是受Node的Express.js的启发，所以代码可能看起来很熟悉。要运行一个基本的API，我们只需要一个I<em class="nc">index . ts</em>文件和8行代码。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3e45" class="ni lo iq ne b gy nj nk l nl nm">import { Application, Router } from "https://deno.land/x/denotrain@v0.5.0/mod.ts";</span><span id="0dd8" class="ni lo iq ne b gy ob nk l nl nm">const app = new Application(); <br/>const routes = new Router();</span><span id="17c9" class="ni lo iq ne b gy ob nk l nl nm">routes.get("/status",() =&gt; { <br/>  return 'ok'; <br/>});</span><span id="38af" class="ni lo iq ne b gy ob nk l nl nm">app.use("/api",routes);</span><span id="cdc6" class="ni lo iq ne b gy ob nk l nl nm">await app.run();</span></pre><p id="76bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">提到Deno支持顶级Await(上面代码的最后一行)是一个很好的时机。如果这是正确的解决方案，那就另当别论了，但是对于这个简单的例子来说已经足够了。</p><p id="60d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们现在可以使用下面的命令运行脚本(在此过程中授予网络访问权限):</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="be5f" class="ni lo iq ne b gy nj nk l nl nm">$ deno run --allow-net index.ts</span><span id="75d8" class="ni lo iq ne b gy ob nk l nl nm">Serving on <a class="ae ml" href="http://0.0.0.0:3000/" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:3000/</a></span></pre><h1 id="b3eb" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">在教程中，我们在构建什么？</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/50d044079474d216716b5cb4486ff44f.png" data-original-src="https://miro.medium.com/v2/format:webp/1*D4QZ-xnRXgjVMhScz9BIug.png"/></div></figure><p id="06b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本教程中，我们将开发<strong class="kt ir"> Newzzer </strong>:一个简单的CLI应用程序，使用Deno向我们展示最新的新闻。在此过程中，我们将学习和使用Deno的不同功能。<br/>该应用程序将具有以下两个主要功能:-</p><ol class=""><li id="6a12" class="nn no iq kt b ku kv kx ky la np le nq li nr lm oc nt nu nv bi translated">通过查询搜索新闻</li><li id="a5c4" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">按类别搜索新闻</li></ol><h1 id="5a9f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">先决条件</h1><ol class=""><li id="1627" class="nn no iq kt b ku mf kx mg la od le oe li of lm oc nt nu nv bi translated">Deno <br/>你可以参考https://deno.land/#installation的下载说明。对于所有主要平台，安装都非常简单。您可以通过运行<code class="fe og oh oi ne b"><em class="nc">deno --version</em></code> <em class="nc">来验证安装。</em>在撰写本文时，最新版本是Deno v1.0.3。您也可以运行<code class="fe og oh oi ne b">deno --help</code>来查看其他命令。</li><li id="ea8c" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">我们将使用NewsAPI的API服务来获取新闻。我们可以通过在<a class="ae ml" href="https://newsapi.org/account" rel="noopener ugc nofollow" target="_blank">https://newsapi.org/account</a>上创建一个账户来免费获得API密匙</li><li id="cbb8" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">JavaScript/ TypeScript的基础知识。</li><li id="cc32" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">Visual Studio代码(可选，如果您喜欢智能感知和自动完成)</li></ol><p id="6cf7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:- </strong>我将在整篇文章中使用TypeScript。如果您不习惯使用TypeScript，可以移除类型并继续操作。</p><h1 id="319b" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">入门指南</h1><p id="77e1" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们从官方的“欢迎”计划开始吧。在Deno中，我们可以直接从文件URL运行程序。在你的终端中运行<code class="fe og oh oi ne b">deno run https://deno.land/std/examples/welcome.ts</code>即可。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/6cdefee75b923b8a1b9c17e89e346520.png" data-original-src="https://miro.medium.com/v2/format:webp/1*6n9T--kGKE85eYvD5tWKPg.png"/></div></figure><p id="2919" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">太棒了。你刚刚运行了你的第一个Deno程序。第一次运行该命令时，会下载、编译并运行该文件。下次运行相同的文件时，既不会下载也不会编译。这是因为Deno缓存了依赖项和编译后的文件。</p><p id="30e3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们想刷新缓存并强制它使用新版本呢？</p><p id="b3f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe og oh oi ne b">--reload</code>为了挽救这一局面，您可以使用该标志运行文件来重新加载源代码缓存。</p><p id="da5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们去代码<a class="ae ml" href="https://deno.land/std/examples/welcome.ts" rel="noopener ugc nofollow" target="_blank">网址</a>偷偷看看文件里面是什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/f4b64004f3d7047f1af85b7bd420fca4.png" data-original-src="https://miro.medium.com/v2/format:webp/1*P5WeFgRXzKkgaWByYaj2zg.png"/></div></figure><p id="e44a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是一个简单的<code class="fe og oh oi ne b">console.log</code>，但是这个页面的风格是什么？Deno网站可以检测到流量来自web浏览器，并以一种风格化的方式呈现文件，但当从非浏览器环境访问时，它会返回原始文档。不相信我？让我们尝试使用<code class="fe og oh oi ne b">curl</code>下载文件并检查内容。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/2ef6f8851281627ec4401eb18a5c67a5.png" data-original-src="https://miro.medium.com/v2/format:webp/1*_PPjzN1udhTdjM8OI2k4Ew.png"/></div></figure><h1 id="c3ac" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">文件结构</h1><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="96e3" class="ni lo iq ne b gy nj nk l nl nm">newzzer<br/>├── api.ts<br/>├── deps.ts<br/>├── error.ts<br/>├── mod.ts<br/>└── types.d.ts</span></pre><p id="285e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们将创建如上所述的5个文件，每个文件服务于一个特定的目的。</p><p id="3baf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> mod.ts </strong>:这是我们app的入口。根据著名Deno程序和标准库中的约定，主文件的名称通常是mod.ts，但它可以被命名为任何名称。</p><p id="e8eb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> types.d.ts </strong>:这个文件将存放我们的自定义接口定义。</p><p id="5d40" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> deps.ts </strong>:该文件将存储我们从外部依赖项导入的所有内容，并将作为一个集中存储，从中导入所有依赖项。</p><p id="eef4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> api.ts </strong>:该文件包含与NewsAPI交互的逻辑。</p><p id="f2aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> error.ts </strong>:这个文件将包含我们应用程序中错误处理的逻辑。</p><p id="7ca5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您来自NodeJS后台，您会注意到没有<code class="fe og oh oi ne b">package.json</code>文件。</p><p id="2240" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="nc">德诺没有集中/官方包经理</em> </strong></p><p id="869d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是Deno有意的设计选择。Deno使用URL导入外部模块，就像浏览器一样。因为没有官方的软件包管理器，任何人都可以在互联网上托管他们的模块，并可以从URL下载。</p><p id="c67b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">注意:</strong>如果你正在使用VSCode，我建议你下载<a class="ae ml" href="https://marketplace.visualstudio.com/items?itemName=denoland.vscode-deno" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir"> vscode-deno </strong> </a>扩展来帮助自动完成、智能感知和格式化。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><p id="7777" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">类型定义</strong></p><p id="ac73" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">首先，让我们在<code class="fe og oh oi ne b">types.d.ts</code>中定义我们的类型定义。我们将使用其网站上提供的示例作为参考，为NewsAPI响应创建类型定义。我们还将为配置文件创建一个接口，该接口将托管访问NewsAPI所需的<code class="fe og oh oi ne b">secret-key</code>。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="d5f5" class="ni lo iq ne b gy nj nk l nl nm">// types.d.ts<br/>export interface IArticle {  <br/>source: Object;  <br/>author: string;  <br/>title: string;  <br/>description: string;  <br/>url: string;  <br/>urlToImage: string;  <br/>publishedAt: string;  <br/>content: string;<br/>}</span><span id="fbed" class="ni lo iq ne b gy ob nk l nl nm">export interface IConfigFile {  <br/>apiKey: string;<br/>}</span></pre><h1 id="9fac" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">获取依赖关系</h1><p id="76bf" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们再次明确我们的目标。该应用程序将:-</p><ol class=""><li id="f558" class="nn no iq kt b ku kv kx ky la np le nq li nr lm oc nt nu nv bi translated">允许我们在配置文件中设置我们的NewsAPI api-key(使用<code class="fe og oh oi ne b">--config</code>标志)</li><li id="3521" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">显示十大最新新闻</li><li id="f71a" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">应用类别过滤器(使用<code class="fe og oh oi ne b">--category</code>或<code class="fe og oh oi ne b">-c</code>标志)</li><li id="b1c2" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">应用查询过滤器(使用<code class="fe og oh oi ne b">--query</code>或<code class="fe og oh oi ne b">-q</code>标志)</li><li id="74c5" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">显示帮助文本(使用<code class="fe og oh oi ne b">--help</code>或<code class="fe og oh oi ne b">-h</code>标志)</li></ol><p id="af5e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们先定义所有的外部依赖，并把它们去掉:-</p><ol class=""><li id="706e" class="nn no iq kt b ku kv kx ky la np le nq li nr lm oc nt nu nv bi translated">std/flags:帮助解析命令行参数</li><li id="1c54" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">std/fs:帮助执行文件操作</li><li id="6b11" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm oc nt nu nv bi translated">STD/fmt:colored console . log(为我们的输出添加颜色)</li></ol><p id="431e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你所看到的，所有的依赖项都在形式<code class="fe og oh oi ne b">std/*</code>中，这意味着它们是Deno标准模块。Deno网站维护着<code class="fe og oh oi ne b">standard</code>库中所有模块的列表。您可以在此查看完整列表<a class="ae ml" href="https://deno.land/std/" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/a8855868bac39fffa00ec19483efe23b.png" data-original-src="https://miro.medium.com/v2/format:webp/1*hhsrDBWm_QfQzEbfc4awPw.png"/></div></figure><p id="15e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您还可以在此查看社区<a class="ae ml" href="https://deno.land/x" rel="noopener ugc nofollow" target="_blank">创建的第三方模块列表。在本教程中，我将把自己限制在标准模块。</a></p><p id="68f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们导入<code class="fe og oh oi ne b">deps.ts</code>中的模块</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="a92d" class="ni lo iq ne b gy nj nk l nl nm">// deps.ts<br/>export { parse, Args } from "https://deno.land/std/flags/mod.ts";<br/>export { readJsonSync } from "https://deno.land/std/fs/read_json.ts";<br/>export { writeJsonSync } from "https://deno.land/std/fs/write_json.ts";<br/>export { existsSync } from "https://deno.land/std/fs/exists.ts";<br/>export {  <br/>red,  <br/>green,  <br/>bold,  <br/>cyan,  <br/>yellow,  <br/>magenta,<br/>} from "https://deno.land/std/fmt/colors.ts";</span></pre><p id="a8d5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">幕后</strong></p><p id="cee6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno使用ECMAScript模块(ESM)标准。如果你来自NodeJS，你必须熟悉CommonJS模块系统。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="c43e" class="ni lo iq ne b gy nj nk l nl nm">// ESM<br/>import abc from "abc";</span><span id="ebe5" class="ni lo iq ne b gy ob nk l nl nm">// CommonJS<br/>const abc = require("abc");</span></pre><p id="74b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当NodeJS建立时，没有浏览器模块的标准，NodeJS决定采用CommonJS的方式。后来，ECMAScript将ESM模块标准化为浏览器的模块系统。对ESM模块的支持现已内置于主要的现代网络浏览器中。关于ES模块的更多信息，请查看flaviocope的文章。</p><p id="8178" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno和ECMAScript为什么偏离了CommonJS的方式？嗯，它有问题——非常复杂的模块分辨率。我会尽力解释的。考虑一个节点内部的导入，js为，<code class="fe og oh oi ne b">const abc = require("abc")</code>。<br/>在解析依赖关系abc时，Node.js必须检查:</p><ul class=""><li id="e876" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated"><code class="fe og oh oi ne b">abc</code>是标准的NodeJS模块吗(类似fs)</li><li id="8112" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe og oh oi ne b">abc</code>是外部NodeJS模块吗？(在node_modules中检查它)</li><li id="a662" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe og oh oi ne b">abc</code>是项目的文件吗？(检查项目中的文件/文件夹名称)</li><li id="10ff" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated"><code class="fe og oh oi ne b">abc</code>是指文件abc.js还是指文件<code class="fe og oh oi ne b">abc/index.js</code>？(请记住，您不必显式指定index . js。NodeJS会为您推断出来)</li></ul><p id="91f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些功能虽然有用，但却使模块解析成为一项复杂的任务。ESM标准只允许绝对和相对URL，从而降低了一些复杂性。</p></div><div class="ab cl mm mn hu mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ij ik il im in"><h1 id="8329" class="ln lo iq bd lp lq mt ls lt lu mu lw lx jw mv jx lz jz mw ka mb kc mx kd md me bi translated">基本帮助消息</h1><p id="6b97" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如果没有可通过<code class="fe og oh oi ne b">-h</code>或<code class="fe og oh oi ne b">--help</code>访问的帮助消息，或者当传递了一些无效配置时，每个CLI都是不完整的。让我们在<code class="fe og oh oi ne b">error.ts</code>中创建基本的帮助信息</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="2112" class="ni lo iq ne b gy nj nk l nl nm">//error.ts</span><span id="10a3" class="ni lo iq ne b gy ob nk l nl nm">// Importing colors<br/>import { red, bold, cyan } from "./deps.ts";</span><span id="ec77" class="ni lo iq ne b gy ob nk l nl nm">// Shows help text, error message(if present) and exits the programexport const displayHelpAndQuit = (error?: string): void =&gt; {  <br/> if (!error) {  <br/> } else if (error === "INVALID_KEY") {    <br/>  console.log(      <br/>   bold(red(`Error: Invalid API key. Use --config flag to set key`)),    <br/>);  <br/>} else console.log(bold(red(`Error: ${error}`)));  console.log(`Usage: newzzer [filters]\n`);  <br/>console.log(`Optional flags:`);  <br/>console.log(`   ${bold("-h, --help")}\t\t Shows this help message and exits`);  <br/>console.log(`   <br/>${bold("-q, --query")}\t\t Find news related to a specific keyword`,  <br/>);  <br/>console.log(    <br/>  `   ${      <br/>    bold(        <br/>      "-c, --category",      <br/>    )<br/>    }\t Find news in a valid category\n\t\t\t The valid categories are: business, entertainment, general, health, science, sports, technology`,  <br/>);  <br/>console.log(    <br/> `   ${      <br/>   bold(        <br/>    "--config &lt;API_KEY&gt;",      <br/>   )    <br/>   }\t Set API key for news API. The key can be recieved from ${           cyan(        <br/> `https://newsapi.org/register`,      <br/> )    <br/>}`,  <br/>);  <br/>// Exits the program  <br/>Deno.exit();<br/>};</span></pre><p id="029e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe og oh oi ne b">displayHelpAndQuit</code>函数接受字符串错误作为参数。如果错误被通过，它显示错误和帮助信息，否则它只显示帮助信息。帮助消息包含有关支持的标志及其用途的信息。</p><p id="5885" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">由于我们在<code class="fe og oh oi ne b">deps.ts</code>中引入的<code class="fe og oh oi ne b">std/fmt/colors</code>标准模块，给日志添加颜色非常简单直接。要创建绿色背景的红色粗体文本，代码很简单</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b0f1" class="ni lo iq ne b gy nj nk l nl nm">console.log(bgGreen(bold(red("Error"))));</span></pre><p id="0959" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<code class="fe og oh oi ne b">displayHelpAndQuit</code>结束时，我们使用<code class="fe og oh oi ne b">Deno.exit()</code>退出Deno过程</p><p id="65d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们已经完成了帮助消息部分，让我们将它与我们的入口点，即<code class="fe og oh oi ne b">mod.ts</code>集成并测试它。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="2f5d" class="ni lo iq ne b gy nj nk l nl nm">// ***************<br/>// IMPORTS<br/>// ***************<br/>import { parse, green, bold } from "./deps.ts";<br/>import { displayHelpAndQuit } from "./error.ts";<br/>// ***************<br/>// FUNCTIONS<br/>// *************** <br/>const displayBanner = (): void =&gt; {  <br/>// Clears the terminal  <br/>console.clear();  <br/>console.log(bold("---------------"));  <br/>console.log(    bold(      green(`   Newzzer`),    ),  );  console.log(bold("---------------"));  <br/>console.log(    bold(      green(        `\nFind your quick news byte at your terminal. Powered by News API\n`,      ),    ),  );}; // ***************<br/>// Main method<br/>// ***************<br/>if (import.meta.main) {  <br/> const { args } = Deno;  <br/> const parsedArgs = parse(args);  <br/> displayBanner();  <br/> if (args.length === 0 || parsedArgs.h || parsedArgs.help) {        displayHelpAndQuit();  <br/> } else displayHelpAndQuit("Invalid argument");<br/>}</span></pre><p id="84e8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe og oh oi ne b">import.meta.main</code>检查当前文件是否已经作为主输入执行，而不是导入到另一个文件中执行。与python中的<code class="fe og oh oi ne b">if __name__ == "__main__"</code>和NodeJS中的<code class="fe og oh oi ne b">require.main === module</code>颇为相似。<br/>Deno名称空间中的args返回参数向量。<code class="fe og oh oi ne b">parse</code>用于解析这些标志，并以类似Map的结构返回标志的键值对。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="afe1" class="ni lo iq ne b gy nj nk l nl nm">// test.tsimport { parse } from "https://deno.land/std/flags/mod.ts";<br/>const {args} = Deno;<br/>console.log(args);<br/>console.log(parse(args));// deno run test.ts -a --b=123[ "-a", "--b=123" ]<br/>{ _: [], a: true, b: 123 }</span></pre><p id="ce16" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们运行我们的文件并检查输出</p><p id="d697" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe og oh oi ne b">deno run mod.ts --help</code>应该显示帮助信息</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/2ca9eb5f6b38e1dd1124f27a807a9513.png" data-original-src="https://miro.medium.com/v2/format:webp/1*Qqaa5GyH7rwKyzZYfEnrlg.png"/></div></figure><p id="3edc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们尝试使用一个无效的标志<code class="fe og oh oi ne b">deno run mod.ts --blah</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/54f19a972d186bf8695aff0f54dd9423.png" data-original-src="https://miro.medium.com/v2/format:webp/1*bWHEdvwk5nqhXyIqe6yC2A.png"/></div></figure><h1 id="1384" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">配置API密钥</h1><p id="2f72" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">我们希望用户从NewsAPI配置自己的API键来获取新闻。为此，我们将API密钥保存在用户主目录的文件<code class="fe og oh oi ne b">.newzzer.json</code>中。</p><p id="8d9c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但是每个操作系统都有不同的主目录，我们如何获得主目录的路径呢？我们可以从终端内部的“HOME”环境变量中获得它。Deno提供了一个方法<code class="fe og oh oi ne b">Deno.env.get</code>来获取环境变量。</p><p id="a4f7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们编辑我们的<code class="fe og oh oi ne b">mod.ts</code>并包含逻辑</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="4cd0" class="ni lo iq ne b gy nj nk l nl nm">// ***************<br/>// IMPORTS<br/>// ***************<br/>import {  <br/>parse,  <br/>green,  <br/>bold,  <br/>Args,  <br/>existsSync,  <br/>writeJsonSync,  <br/>readJsonSync,<br/>} from "./deps.ts";<br/>import { displayHelpAndQuit } from "./error.ts";<br/>import { IArticle, IConfigFile } from "./types.d.ts";// ***************<br/>// FUNCTIONS<br/>// ***************</span><span id="fa6a" class="ni lo iq ne b gy ob nk l nl nm">const setApiKey = (parsedArgs: Args): void =&gt; {  <br/>// Get home directory address  <br/>let homeEnv: string | undefined = Deno.env.get("HOME");  <br/>let home: string = "";  <br/>if (typeof homeEnv === "string") home = homeEnv;  <br/>let configFilePath: string = `${home}/.newzzer.json`;  <br/>//   Check if api-key is provided  <br/>if (typeof parsedArgs.config === "string") {    <br/>//   If the file is not present, then create file    <br/>if (!existsSync(configFilePath)) {      Deno.createSync(configFilePath);    <br/>}    <br/>// Write apiKey in the file    <br/>writeJsonSync(configFilePath, { apiKey: parsedArgs.config });    console.log(`${green(bold("Success"))} ApiKey set Successfully`);    displayHelpAndQuit();  <br/>} <br/>//   Handling if apiKey is not present after --config  <br/>else displayHelpAndQuit("Config flag should be followed by apiKey");<br/>};</span><span id="17c2" class="ni lo iq ne b gy ob nk l nl nm">const getApiKey = (): any =&gt; {  <br/>// Get home directory address  <br/>let homeEnv: string | undefined = Deno.env.get("HOME");  <br/>let home: string = "";  <br/>if (typeof homeEnv === "string") home = homeEnv;  <br/>let configFilePath: string = `${home}/.newzzer.json`;  <br/>try {    <br/>//   try to read ~/.newzzer.json    <br/>let file = readJsonSync(configFilePath);    <br/>if (typeof file === "object" &amp;&amp; file !== null) {      <br/>let configFile = file as IConfigFile;      <br/>if (configFile.apiKey) return configFile.apiKey;      <br/>//   If apiKey not present in file show error      <br/>else displayHelpAndQuit("apiKey not found in the config file ");    <br/>}  <br/>} catch (err) {    <br/>//    if file is not present, show error message and quit    displayHelpAndQuit("Config file not present. Use --config to set apiKey");  <br/>}<br/>};</span><span id="591d" class="ni lo iq ne b gy ob nk l nl nm">const displayBanner = (): void =&gt; {  <br/>// Clears the terminal  <br/>console.clear();  <br/>console.log(bold("---------------"));  <br/>console.log(    <br/>bold(      <br/>green(`   <br/>Newzzer<br/>`),    <br/>),  <br/>);  <br/>console.log(bold("---------------"));  <br/>console.log(    <br/>bold(      <br/>green(        <br/>`\nFind your quick news byte at your terminal. Powered by News API\n`,      <br/>),    <br/>),  <br/>);<br/>}; <br/>// ***************<br/>// Main method<br/>// ***************<br/>if (import.meta.main) {  const { args } = Deno;  const parsedArgs = parse(args);  displayBanner();  <br/>//   If option to set API Key i.e. --config flag is passed  if (parsedArgs.config) setApiKey(parsedArgs);  <br/>//   otherwise Check for API key  <br/>let apiKey: string = getApiKey();  <br/>console.log(`Found API key: ${apiKey}`);  <br/>if (args.length === 0 || parsedArgs.h || parsedArgs.help) {    displayHelpAndQuit();  <br/>} else displayHelpAndQuit("Invalid argument");<br/>}</span></pre><p id="83a2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">从NewsAPI获取API密钥，并将其设置到我们的配置文件中。</p><p id="14ca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe og oh oi ne b">deno run mod.ts --config "API KEY HERE"</code></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/5dcdde4864e3f37a05218c6325dbd55e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*s0wlsr1sO7uEVqxMMFe-6A.png"/></div></figure><p id="59d7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">似乎有一个错误。我们无法访问环境变量，但是为什么呢？</p><p id="0ad1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">幕后</strong></p><p id="654c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还记得开头提到的Deno特性之一吗？</p><p id="611d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="nc">安全代码默认运行在沙箱中</em> </strong></p><p id="9655" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安全性是Deno优于NodeJS的主要USP之一。在Deno中，您的代码运行在沙箱中，您无权访问:-</p><ul class=""><li id="17bd" class="nn no iq kt b ku kv kx ky la np le nq li nr lm ns nt nu nv bi translated">文件系统</li><li id="6c60" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">环境变量</li><li id="121d" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">网络存取</li><li id="4a9c" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">高分辨率时间测量</li><li id="6c74" class="nn no iq kt b ku nw kx nx la ny le nz li oa lm ns nt nu nv bi translated">正在加载插件</li></ul><p id="714c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这些权限必须在使用标志运行代码时显式给出。您可以从<code class="fe og oh oi ne b">deno run --help</code>中找到所有的标志</p><p id="7246" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们使用<code class="fe og oh oi ne b">deno run --allow-read --allow-write --allow-env mod.ts --config "API KEY HERE"</code>给出许可并设置我们的配置密钥</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/f49e65581bbaacb46b91a29226fcf201.png" data-original-src="https://miro.medium.com/v2/format:webp/1*6ClDHxMN2csmwAVNFU4weA.png"/></div></figure><p id="7128" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用<code class="fe og oh oi ne b">deno run --allow-read --allow-write --allow-env mod.ts</code>检查是否设置了API键</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/272c5ce65de0a5181f0b68c3db21a12e.png" data-original-src="https://miro.medium.com/v2/format:webp/1*UhXZ1kWxTnNb7SZVUrWylw.png"/></div></figure><h1 id="d763" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">连接API</h1><p id="1666" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">现在让我们添加有趣的部分。从API获取新闻并显示出来。API的所有逻辑都将嵌套在<code class="fe og oh oi ne b">app.ts</code>中</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="82f2" class="ni lo iq ne b gy nj nk l nl nm">// api.ts<br/>import { IArticle } from "./types.d.ts"; <br/>class Api {  <br/>// private property  readonly #baseURL: string = "https://newsapi.org/v2/top-headlines";  <br/>#apiKey: string = "";   <br/>// set API key  <br/>constructor(apikey: string) {    <br/>this.#apiKey = apikey;  <br/>}</span><span id="0541" class="ni lo iq ne b gy ob nk l nl nm">getNews = async (    <br/>category: string | undefined,    <br/>query: string | undefined,  <br/>): Promise&lt;IArticle[] | string&gt; =&gt; {    <br/>let additional: string = "";    <br/>let country: string = "IN"; <br/>// Use US for USA , refer documentation for the complete list    <br/>if (category) additional += `&amp;category=${category}`;    <br/>if (query) additional += `&amp;q=${encodeURI(query)}`;    <br/>try {      <br/>const rawResult = await fetch(        <br/>`${this.#baseURL}?language=en&amp;pageSize=10${additional}&amp;apiKey=${this.#apiKey}&amp;sortBy=popularity&amp;country=${country}`,      <br/>);      <br/>const result = await rawResult.json();      <br/>if (result.status === "error") <br/>return "INVALID_KEY";      <br/>let news: IArticle[] = result.articles;      <br/>return news;    <br/>} catch (err) {      <br/>return "Cannot connect to server. Please check your internet conection";    <br/>}  <br/>};<br/>}</span><span id="6879" class="ni lo iq ne b gy ob nk l nl nm">export default Api;</span></pre><p id="0c05" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Deno试图尽可能地遵守W3C标准。因此，Deno支持<code class="fe og oh oi ne b">fetch</code> API与web服务器交互。</p><p id="a96c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们使用<code class="fe og oh oi ne b">mod.ts</code>中的API。这是最后的文件以及一些错误处理。</p><p id="6ecf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在让我们运行我们的应用程序，不要忘记添加<code class="fe og oh oi ne b">--allow-net</code>以允许互联网接入。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="12b3" class="ni lo iq ne b gy nj nk l nl nm">deno run --allow-net --allow-read --allow-write --allow-env run mod.ts --category technology</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/d3d21182c60faec7a974c51010296496.png" data-original-src="https://miro.medium.com/v2/format:webp/1*fBW8sbxEyhLDRvGiADKBBQ.png"/></div></figure><p id="8f18" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Yayyy！我们一起构建了第一个全功能的CLI应用程序。</p><h1 id="dc9e" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">Deno摘要</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="ab gu cl mk"><img src="../Images/73fc0864ecead71e80e4386dce7e2230.png" data-original-src="https://miro.medium.com/v2/0*1hvkOeL-4cfsUuL0"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk">Photo by <a class="ae ml" href="https://unsplash.com/@wflwong?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Warren Wong</a> on <a class="ae ml" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bb19" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随着您对Deno的了解越来越多，您可能会想到的一个问题是Deno是否可以取代Node.js，或者至少是Node . js的强大替代者。Node做得很好，我想不出放弃它的好理由。此时此刻，思考Deno的最佳方式是将其作为一个有趣的替代方案，而不是一对一的替代方案。</p><p id="6f2e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">即使1.0版本得到了适当的发布，我仍然对用Deno编写产品代码保持警惕。我只是觉得它不够成熟。另一个挑战是正确保护我们的应用程序免受外部模块的影响。我们肯定会遇到挑战，比如某个包暂时不可用。另一方面，Deno的一个非常有趣的方面是能够用TypeScript编写shell脚本。</p><p id="5c89" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">继续探索Deno绝对是值得的，因为在未来，它可能会成为目前被严重垄断的JavaScript运行时环境领域的重要参与者。尤其是Node.js开发者的准入门槛几乎不存在。</p><p id="ad9a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nc">更多内容请看</em><a class="ae ml" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="nc">plain English . io</em></strong></a></p></div></div>    
</body>
</html>