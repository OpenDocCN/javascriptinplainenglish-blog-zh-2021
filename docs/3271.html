<html>
<head>
<title>How to Convert an SVG to an Image in the Browser?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在浏览器中将SVG转换成图像？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-convert-an-svg-to-an-image-in-the-browser-eec3d6298c07?source=collection_archive---------4-----------------------#2021-07-04">https://javascript.plainenglish.io/how-to-convert-an-svg-to-an-image-in-the-browser-eec3d6298c07?source=collection_archive---------4-----------------------#2021-07-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0299f52b95a599cf193ecd49c836607f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xNXdJ1eXnoNZjf_V"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@clemono?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Clem Onojeghuo</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f2eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能想在web应用程序中将SVG图像转换成另一种图像格式，如JPEG和PNG。</p><p id="b301" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以完全从客户端完成这项工作。</p><p id="19ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何完全从客户端将SVG转换成另一种图像格式。</p><h1 id="8ab3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">将SVG转换为图像</h1><p id="765a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用客户端JavaScript代码将SVG完全转换成图像。</p><p id="e3cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="803a" class="mn lc iq mj b gy mo mp l mq mr">const svg = `<br/>&lt;svg  version="1.1" baseProfile="full" width="300" height="200"&gt;<br/>   &lt;rect width="100%" height="100%" fill="red" /&gt;<br/>   &lt;circle cx="150" cy="100" r="80" fill="green" /&gt;<br/>   &lt;text x="150" y="125" font-size="60" text-anchor="middle" fill="white"&gt;SVG&lt;/text&gt;<br/>&lt;/svg&gt;<br/>`<br/>svgToPng(svg, (imgData) =&gt; {<br/>  const pngImage = document.createElement('img');<br/>  document.body.appendChild(pngImage);<br/>  pngImage.src = imgData;<br/>});</span><span id="aab1" class="mn lc iq mj b gy ms mp l mq mr">function svgToPng(svg, callback) {<br/>  const url = getSvgUrl(svg);<br/>  svgUrlToPng(url, (imgData) =&gt; {<br/>    callback(imgData);<br/>    URL.revokeObjectURL(url);<br/>  });<br/>}</span><span id="a8c0" class="mn lc iq mj b gy ms mp l mq mr">function getSvgUrl(svg) {<br/>  return URL.createObjectURL(new Blob([svg], {<br/>    type: 'image/svg+xml'<br/>  }));<br/>}</span><span id="3eea" class="mn lc iq mj b gy ms mp l mq mr">function svgUrlToPng(svgUrl, callback) {<br/>  const svgImage = document.createElement('img');<br/>  document.body.appendChild(svgImage);<br/>  svgImage.onload = () =&gt; {<br/>    const canvas = document.createElement('canvas');<br/>    canvas.width = svgImage.clientWidth;<br/>    canvas.height = svgImage.clientHeight;<br/>    const canvasCtx = canvas.getContext('2d');<br/>    canvasCtx.drawImage(svgImage, 0, 0);<br/>    const imgData = canvas.toDataURL('image/png');<br/>    callback(imgData);<br/>    document.body.removeChild(imgPreview);<br/>  };<br/>  svgImage.src = svgUrl;<br/>}</span></pre><p id="b076" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带SVG字符串的<code class="fe mt mu mv mj b">svg</code>变量。</p><p id="4544" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们用<code class="fe mt mu mv mj b">svg</code>字符串和<code class="fe mt mu mv mj b">callback</code>调用<code class="fe mt mu mv mj b">svgToPng</code>。</p><p id="3cf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe mt mu mv mj b">document.createElement</code>创建一个<code class="fe mt mu mv mj b">img</code>元素，并把它赋给<code class="fe mt mu mv mj b">pngImage</code>。</p><p id="9175" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">document.body.appendChild</code>将<code class="fe mt mu mv mj b">img</code>元素附加到主体上。</p><p id="c321" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe mt mu mv mj b">pngImage.src</code>设置为我们将从回调<code class="fe mt mu mv mj b">imgData</code>参数中获得的URL。</p><p id="b556" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建一个<code class="fe mt mu mv mj b">svgToPng</code>函数，它接受一个<code class="fe mt mu mv mj b">svg</code>字符串和<code class="fe mt mu mv mj b">callback</code>函数。</p><p id="213d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们创建接受<code class="fe mt mu mv mj b">svg</code>和<code class="fe mt mu mv mj b">callback</code>的<code class="fe mt mu mv mj b">svgToPng</code>函数。</p><p id="2aa5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它调用<code class="fe mt mu mv mj b">getSvgUrl</code>函数从<code class="fe mt mu mv mj b">svg</code>获取base64 URL。</p><p id="a0c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">svgUrlToPng</code>函数，用<code class="fe mt mu mv mj b">url</code>和回调函数进行转换以获取图像数据。</p><p id="8e44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建<code class="fe mt mu mv mj b">getSvgUrl</code>函数，我们只需调用<code class="fe mt mu mv mj b">URL.createObjectURL</code>并将<code class="fe mt mu mv mj b">svg</code>字符串转换为<code class="fe mt mu mv mj b">Blob</code>实例，以返回base64版本的SVG。</p><p id="aa9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe mt mu mv mj b">svgUrlToPng</code>函数，将SVG放入画布。</p><p id="a3b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们这样做是为了以后可以将画布内容提取为图像二进制文件。</p><p id="1585" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">svgUrlToPng</code>函数中，我们创建了一个<code class="fe mt mu mv mj b">img</code>元素。</p><p id="c0bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe mt mu mv mj b">document.body.appendChild</code>将创建的元素附加到主体上。</p><p id="3758" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从<code class="fe mt mu mv mj b">svgImage</code>尺寸中设置画布的宽度和高度。</p><p id="b1ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用画布上下文中的<code class="fe mt mu mv mj b">drawImage</code>将SVG base64 URL绘制到画布中。</p><p id="5a08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们用要转换成的图像格式的MIME类型调用<code class="fe mt mu mv mj b">toDataURL</code>。</p><p id="7b63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">callback</code>,以便回调运行时将<code class="fe mt mu mv mj b">imgData</code>图像数据传递给它。</p><p id="edbe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">documen.body.removeChild</code>来移除预览。</p><p id="1310" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还将<code class="fe mt mu mv mj b">svgImage.src</code>设置为<code class="fe mt mu mv mj b">svgURL</code>来添加预览。</p><h1 id="63ff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="41b2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用JavaScript将SVG转换成另一种图像格式。</p><p id="14c1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>