<html>
<head>
<title>Caching in Node.js with Redis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Redis在Node.js中缓存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/caching-in-node-js-with-redis-5d367de7187a?source=collection_archive---------6-----------------------#2021-02-25">https://javascript.plainenglish.io/caching-in-node-js-with-redis-5d367de7187a?source=collection_archive---------6-----------------------#2021-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7cd0dd9e86712eee4b9c530e88d9ce7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*Z-ugNlLUe1zipt8P8JGuIA.jpeg"/></div></figure><p id="9e9c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本教程中，我将向您快速介绍Redis。我们还将使用Redis为一个节点应用程序创建一个简单的缓存，看看它如何影响其性能。</p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h1 id="b14f" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Redis是什么？</h1><p id="9965" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">Redis是一个开源的内存数据结构存储，用作数据库、缓存和消息代理。</p><p id="41f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可以把它想象成一个非SQL数据库，它将数据作为一个键值对存储在系统内存中。如果需要，Redis也支持磁盘持久数据存储。</p><p id="b26a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Redis支持存储多种数据结构和数据类型，包括字符串、列表、散列、集合和有序集合。受支持的数据结构为Redis提供了许多用例的通用性。</p><p id="0528" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">Redis最适用于需要在最少的<em class="md">时间内检索数据并交付给客户机的情况。</em></p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h1 id="abd8" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Redis用于缓存</h1><p id="3f59" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">虽然有更多的用例，但总的来说，Redis最流行的用途是用于缓存。</p><h2 id="562e" class="me la iq bd lb mf mg dn lf mh mi dp lj kf mj mk ln kj ml mm lr kn mn mo lv mp bi translated"><strong class="ak">什么是缓存？</strong></h2><p id="3d9c" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">缓存是将数据副本存储在缓存中以允许应用程序更快地访问和检索数据的过程。缓存的目标是比数据库或远程服务器更好地加速数据访问操作。对于昂贵的操作来说尤其如此，比如从外部API获取数据。</p><p id="e6e8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">作为后端开发人员，我们的任务是尽快完成客户的请求。有时，查询需要几项操作，如从数据库中检索数据、执行计算、从其他服务中检索附加数据等。，这拖累了我们的表现。</p><p id="4126" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">这正是缓存的优势所在，因为我们可以一次性处理数据，将其存储在缓存中，然后直接从缓存中检索，而无需执行所有这些昂贵的操作。然后，我们会定期更新缓存，以便用户可以看到更新的信息。</p><h2 id="a2c1" class="me la iq bd lb mf mg dn lf mh mi dp lj kf mj mk ln kj ml mm lr kn mn mo lv mp bi translated"><strong class="ak">缓存&amp; Redis </strong></h2><p id="c862" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">因为Redis是一个内存数据库，所以它的数据访问操作比任何其他磁盘数据库都要快。这使得Redis成为缓存的完美选择。它的键值数据存储是另一个优势，因为它使数据存储和检索更加简单。</p><p id="983c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在本教程中，我们将了解如何在Node.js (Express)应用程序中实现Redis。</p></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h1 id="437d" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">使用节点和Redis缓存</h1><p id="4553" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">现在，让我们从本教程的主要焦点开始:在我们的节点应用程序中使用Redis进行缓存。</p><p id="5411" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">用Redis缓存的过程真的很简单。当我们收到用户对启用了缓存的路由的请求时，我们将首先检查所请求的数据是否已经存储在缓存中。如果是，我们可以快速从Redis检索数据并发送响应。</p><h2 id="fe56" class="me la iq bd lb mf mg dn lf mh mi dp lj kf mj mk ln kj ml mm lr kn mn mo lv mp bi translated"><strong class="ak">项目设置</strong></h2><p id="4dbd" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">如果你还没有，你需要在你的机器上安装Redis。你可以用自制软件做到这一点:brew安装redis。为了确保Redis服务器运行没有问题，使用<code class="fe mq mr ms mt b">redis-cli</code>向服务器发送一个ping。您可以向Redis服务器发送ping命令，如果它用PONG响应，您就可以开始了。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi mu"><img src="../Images/90b270ec408b7916b45752ec8a272657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Ta3Z54LC96OpZk6krD6JQ.png"/></div></div></figure><p id="89c5" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一旦在你的机器上设置好redis，我们就初始化我们的项目并安装以下包:express、node-fetch(可以根据你的喜好用requests或axios代替)和Redis。然后，我们在端口6379上初始化我们的客户机Redis监听的默认端口。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nd"><img src="../Images/d1140d8ac1584f02b912386e0e60cbd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnosaTUsE0JwezTaHvjQnw.png"/></div></div></figure><h2 id="5036" class="me la iq bd lb mf mg dn lf mh mi dp lj kf mj mk ln kj ml mm lr kn mn mo lv mp bi translated"><strong class="ak">从PokeAPI获取数据</strong></h2><p id="00e7" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">在我们的应用程序中，我们将从PokeAPI中获取一些数据，将其缓存在Redis中，并测量性能改进。</p><p id="16dd" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们将首先定义一个route '/pokemon/:id '，其中用户将能够传入pokemon的pokedex id，我们将获取该特定id的姓名、身高和体重。在我们解析了来自PokeAPI的响应并构建了我们的细节字符串之后，我们只是返回一个简单的h1标记。很容易..但是这些请求中的每一个都至少需要<strong class="jw ir"><em class="md">125毫秒</em> </strong>。虽然还不算太糟，但可以用Redis大大改进。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ne"><img src="../Images/c41e6c1e64e4bd70b29620deef460c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ok1j-n1mfTuXej_DtAA78w.png"/></div></div></figure><p id="ca41" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">使用Redis非常简单，因为大部分交互都是以设置或获取数据的形式进行的。我们将对getStats方法稍作调整，首先在响应前进行缓存。之后，我们将需要构建一个额外的中间件来检查我们是否可以从Redis缓存中提取信息，而不是再次获取外部API。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nf"><img src="../Images/3206affd9e9f5d4590d08a8b0edac316.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A4XpP6khTFDV4kpNQWN8EQ.png"/></div></div></figure><p id="d327" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">随着我们的缓存中间件的建立，我们可以通过在Postman中测试来衡量改进。</p><p id="1fad" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我们最初向API请求杰尼龟的信息用了139毫秒…</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi ng"><img src="../Images/00c0b7f1028f1e4220d1f0a2fdeb13b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OG2tFzbaSf1rCG5Mc9Pyqg.png"/></div></div></figure><p id="2204" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但启用Redis后，我们可以将其缩短到5毫秒以下。对于几行代码来说还不错。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mz na di nb bf nc"><div class="gh gi nh"><img src="../Images/e46bf4efd6c25677b77707fcb386b096.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c0_yj5polhphobyHf2tO7g.png"/></div></div></figure></div><div class="ab cl ks kt hu ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="ij ik il im in"><h1 id="67ad" class="kz la iq bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">摘要</h1><p id="2e91" class="pw-post-body-paragraph ju jv iq jw b jx lx jz ka kb ly kd ke kf lz kh ki kj ma kl km kn mb kp kq kr ij bi translated">希望您可以看到在您的应用程序中实现缓存是多么简单和实用。利用Redis来缓存频繁查询的数据可以大大提高应用程序的性能！</p></div></div>    
</body>
</html>