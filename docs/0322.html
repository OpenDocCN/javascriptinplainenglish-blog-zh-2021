<html>
<head>
<title>Setting Up Jest With React Testing Library to Work With Redux Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React测试库设置Jest以使用Redux组件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/setting-up-jest-with-react-testing-library-to-work-with-redux-components-ee672ec12050?source=collection_archive---------1-----------------------#2021-01-19">https://javascript.plainenglish.io/setting-up-jest-with-react-testing-library-to-work-with-redux-components-ee672ec12050?source=collection_archive---------1-----------------------#2021-01-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cb23" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一个最近一直在学习react单元测试的人，我发现目前在react 17中使用“酶”有许多复杂之处。这让我尝试寻找另一种解决方案。我决定尝试使用react测试库和jest来测试组件。</p><p id="f033" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我将向您介绍一些步骤，这些步骤允许我在状态保存在Redux Store中时对组件进行jest测试。</p><h2 id="a833" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">第一步</strong></h2><p id="2326" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">您需要为您的环境设置正确的依赖项。运行以下命令安装依赖项:</p><ol class=""><li id="9428" class="lg lh in jm b jn jo jr js jv li jz lj kd lk kh ll lm ln lo bi translated"><code class="fe lp lq lr ls b">$ npx create-react-app app-name</code></li><li id="017a" class="lg lh in jm b jn lt jr lu jv lv jz lw kd lx kh ll lm ln lo bi translated"><code class="fe lp lq lr ls b">$ cd app-name</code></li><li id="72ec" class="lg lh in jm b jn lt jr lu jv lv jz lw kd lx kh ll lm ln lo bi translated"><code class="fe lp lq lr ls b">$ npm install @testing-library/react react-test-renderer jest-dom --save-dev</code></li><li id="80ab" class="lg lh in jm b jn lt jr lu jv lv jz lw kd lx kh ll lm ln lo bi translated"><code class="fe lp lq lr ls b">$ yarn add --dev jest-css-modules</code></li></ol><h2 id="09a7" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">第二步</strong></h2><p id="e5bf" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">您将需要设置一些组件和一些测试文件。正如你在下面的例子中看到的，我已经创建了一个包含3个组件和3个测试的应用程序。三个橙色的js文件是测试文件，黄色的是我将要测试的组件。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/1a46b4c163ca1279b977eb50d85b12c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*mAvI2bjq3coxQ1tdvVh01g.png"/></div></figure><p id="ee04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">需要注意的是，测试文件的命名约定是<code class="fe lp lq lr ls b">&lt;testFileName&gt;.test.js</code>。如果您正在为<code class="fe lp lq lr ls b">component_A.js</code>编写测试，那么测试文件名应该是<code class="fe lp lq lr ls b">component_A.test.js</code>。jest就是这样识别你的测试文件的。我还建议像我在例子中做的那样创建一个文件夹，这样所有的测试都可以放在一起。</p><h2 id="a838" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">第三步</strong></h2><p id="d617" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">这只有在使用Redux时才有必要，否则可以直接跳到第4步。React测试库的render函数不能识别组件中的Redux provider，这就是为什么我们需要为render函数打补丁，以便它能够识别存储在Redux中的状态。</p><p id="afb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，我们需要确保我们已经设置了根reducer并从reducers文件夹中导出。(注意:这不是一个redux教程，所以如果你不知道如何设置你的actions &amp; reducers，那么先学习一下，然后回到本文来设置测试)。</p><p id="234c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，在我们的测试文件夹中再创建一个名为<strong class="jm io"> test-utils.js </strong>的文件。在这个文件中，我们将更新react测试库中的“render”函数，以便它可以识别Redux存储中的状态。我们需要添加到这个文件的第一件事是我们的导入-</p><pre class="lz ma mb mc gt mg ls mh mi aw mj bi"><span id="0806" class="ki kj in ls b gy mk ml l mm mn">import React from 'react'</span><span id="bd5c" class="ki kj in ls b gy mo ml l mm mn">import { render as rtlRender } from '@testing-library/react'</span><span id="ad63" class="ki kj in ls b gy mo ml l mm mn">import { createStore } from 'redux'</span><span id="59b0" class="ki kj in ls b gy mo ml l mm mn">import { Provider } from 'react-redux'</span><span id="e515" class="ki kj in ls b gy mo ml l mm mn">// Import our reducer</span><span id="779e" class="ki kj in ls b gy mo ml l mm mn">import reducer from '../reducers' // to access rest of reducers</span></pre><p id="8777" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如你所见，我们需要从react测试库导入render，接下来从redux导入createStore，然后从react-redux导入Provider，最后从Redux reducers文件夹导入我们的根reducer。</p><p id="1444" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我们将在imports下的同一个<strong class="jm io"> test-utils.js </strong>文件中创建一个自定义渲染函数:</p><pre class="lz ma mb mc gt mg ls mh mi aw mj bi"><span id="ba51" class="ki kj in ls b gy mk ml l mm mn">//custom render that includes redux provider</span><span id="2318" class="ki kj in ls b gy mo ml l mm mn">const render = ( ui, {initialState, store = createStore(reducer, initialState), ...renderOptions} = {}) =&gt; {</span><span id="71ff" class="ki kj in ls b gy mo ml l mm mn">const Wrapper = ({ children }) =&gt; {</span><span id="1133" class="ki kj in ls b gy mo ml l mm mn">return &lt;Provider store={store}&gt;{children}&lt;/Provider&gt;</span><span id="da0a" class="ki kj in ls b gy mo ml l mm mn">}</span><span id="81b2" class="ki kj in ls b gy mo ml l mm mn">return rtlRender(ui, { wrapper: Wrapper, ...renderOptions })</span><span id="7ac5" class="ki kj in ls b gy mo ml l mm mn">}</span></pre><p id="9381" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，在自定义渲染函数下，我们需要导出新的渲染函数以及React测试库提供的所有其他函数:</p><pre class="lz ma mb mc gt mg ls mh mi aw mj bi"><span id="fdfb" class="ki kj in ls b gy mk ml l mm mn">// re-export everything</span><span id="4979" class="ki kj in ls b gy mo ml l mm mn">export * from '@testing-library/react'</span><span id="180f" class="ki kj in ls b gy mo ml l mm mn">// override render method</span><span id="147b" class="ki kj in ls b gy mo ml l mm mn">export { render }</span></pre><p id="0ae1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">test-utils.js文件应该如下所示</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mp"><img src="../Images/828ad923dc17d180dda636526c4f70bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMEUekrvgwu6TLmtpdAzGw.png"/></div></div></figure><h2 id="3343" class="ki kj in bd kk kl km dn kn ko kp dp kq jv kr ks kt jz ku kv kw kd kx ky kz la bi translated"><strong class="ak">第四步</strong></h2><p id="9a8e" class="pw-post-body-paragraph jk jl in jm b jn lb jp jq jr lc jt ju jv ld jx jy jz le kb kc kd lf kf kg kh ig bi translated">现在是开始测试组件的时候了。从test-utils.js开始导入您将要使用的内容</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mu"><img src="../Images/8ee6eb8f5772c337444f0491affbfb63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1T09KqO6x-_Rf1FowOtsHA.png"/></div></div></figure><p id="fa59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如你所见，我从我的test-utils导入了渲染、屏幕和清理，而不是从' @testing-library/react '(注意:如果你没有使用redux，你将从' @testing-library/react '导入)。我还导入了一个将要测试的登录组件。如果您正在使用Redux，请确保您正在测试的组件在redux reducer中至少有一个状态。通过这种方式，您可以验证现在一切都按预期工作，而不是在实现一系列测试后才发现问题。</p><p id="7fa2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们来设置我们的第一个测试。对于我的登录测试，我想在每次测试之前呈现组件&amp;在每次测试之后使用react测试库清理功能。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mv"><img src="../Images/ba2c84b8c46c4368759e22ee1f792bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xpaN4cMiVvDtZ-u-GscFVg.png"/></div></div></figure><p id="2cba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切都设置正确，你将已经设置并通过了你的第一次测试，祝贺你！</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="gh gi mw"><img src="../Images/90126af5aec3ca284d38b9aa71ae49e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YwrJJbqZhcfff28z"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk">Photo by <a class="ae nb" href="https://unsplash.com/@japhethmast?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Japheth Mast</a> on <a class="ae nb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>