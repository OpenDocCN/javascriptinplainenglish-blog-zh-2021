<html>
<head>
<title>Micro Optimizing Your JavaScript Probably Isn’t Worth It, But…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微优化您的JavaScript可能不值得，但是…</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/micro-optimizing-your-javascript-probably-isnt-worth-it-but-c6dd03e91f06?source=collection_archive---------8-----------------------#2021-10-12">https://javascript.plainenglish.io/micro-optimizing-your-javascript-probably-isnt-worth-it-but-c6dd03e91f06?source=collection_archive---------8-----------------------#2021-10-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="821e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如果你正在做，我会这样做</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/148173fbc2b3f1e5fdec6a83c962b097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KrPukEulrTcLrF9v"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@charlesdeluvio?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Charles Deluvio</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4ede" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您希望优化应用程序中经常调用的函数，您可能希望进行一些测量，设置基准，并从那里开始。假设您已经查看了浏览器的瀑布图，并认识到一个长时间运行的功能可能会对您的<a class="ae ks" href="https://web.dev/rail/" rel="noopener ugc nofollow" target="_blank"> RAIL </a>模型造成压力，或者更准确地说，一个长时间运行的功能会使用户与执行的操作分离(严格来说，用户界面中不必要的延迟超过100毫秒)。你可能想要达到以下目标:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lp"><img src="../Images/4b8e9ee074156740e347f743d901b826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Guybr319NyJhbJQ8wlAVxQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Image taken from <a class="ae ks" href="https://web.dev/rail/" rel="noopener ugc nofollow" target="_blank">here</a>.</figcaption></figure><p id="7ee0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们开始之前，完整的示例代码可以在<a class="ae ks" href="https://codepen.io/sinia-nimevi/pen/XWaWYZV" rel="noopener ugc nofollow" target="_blank">这里</a>看到。请随意使用该代码作为您未来测量的模板。</p><h1 id="e14d" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">性能API</h1><p id="da2f" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">为了开始测量我们函数的性能，我们需要熟悉<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance_API" rel="noopener ugc nofollow" target="_blank"> Performance API </a>，它是一个现成的javascript Web API，允许您与性能接口进行交互，这反过来使我们能够在所谓的<a class="ae ks" href="https://www.w3.org/TR/hr-time/" rel="noopener ugc nofollow" target="_blank">高分辨率时间</a>内测量我们客户端应用程序的性能。虽然有很多内容，但我们感兴趣的是设置标记，测量它们之间的时间，并在控制台中记录这些条目以供进一步检查。</p><p id="f85e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该API的使用非常简单，所以我将快速介绍一个示例场景。</p><h1 id="33e1" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">两个相互竞争的功能</h1><p id="2965" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">假设我们有一个检查两个单词是否是<a class="ae ks" href="https://en.wikipedia.org/wiki/Anagram" rel="noopener ugc nofollow" target="_blank">变位词</a>的函数。我想到了两种方法。也许我们想把两个字符串当作数组，因为我们对两个单词是否有相同的字母感兴趣，所以我们把它们转换成数组，对它们进行排序，并比较结果。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/fead7159f7c95a41d0a19aa3f106d841.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxhAaMY-ZEi4ooX44gI2gQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Treating words as character arrays allows for easy sorting.</figcaption></figure><p id="f134" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">另一种方法是，知道<code class="fe mo mp mq mr b">for</code>循环是可笑的高性能，尝试围绕它建立逻辑。我们可以直接取消不等长的单词(这本身就是一个性能奖励)，然后我们可以循环遍历一个单词中的每个字符，并使用<code class="fe mo mp mq mr b">indexOf</code>来检查它是否出现在另一个单词中。此外，我们需要逐步从第二个单词(或它的副本)中<code class="fe mo mp mq mr b">slice</code>出字母，以避免误报。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ms"><img src="../Images/bc823595eb82b80f768e2aff3d610c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fN5_mzJLj-AazlQmjfsLug.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">A clumsy but possibly more performant solution.</figcaption></figure><h1 id="d23c" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">实现性能API</h1><p id="53a5" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">设置标记非常容易，事实上，就像在代码的适当位置键入<code class="fe mo mp mq mr b">performance.mark('myCustomMarkerString');</code>一样简单。因为我们以后需要使用这个标记名，所以我实际上会把它保存为<code class="fe mo mp mq mr b">const</code>(例如<code class="fe mo mp mq mr b">const A</code>)，然后用它在函数的开始、<code class="fe mo mp mq mr b">performance.mark(A)</code>和函数的结束<code class="fe mo mp mq mr b">performance.mark(B)</code>留下一个标记。然后，我们使用带有指定标记的<code class="fe mo mp mq mr b">performance.measure("my measurement #1", A, B)</code>来获取A点和B点之间的时间(例如)。我相信下面的示例代码非常清楚。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Setting and measuring marks in practice.</figcaption></figure><p id="3195" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里值得注意的是，一个接一个地运行两个函数一次很少会给出结论性的结果。最好将这两个函数运行100次、1000次或更多次，以了解如果连续多次调用该函数，性能差距会有多大。</p><p id="5608" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这将创建两个条目，稍后可以使用<code class="fe mo mp mq mr b">performance.getEntriesByType(“measure”)</code>检索它们。这样做的结果将是一个由<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry" rel="noopener ugc nofollow" target="_blank"> PerformanceEntry </a>对象组成的数组。我发现我对条目的<code class="fe mo mp mq mr b">duration</code>值最感兴趣，所以我倾向于使用过滤了duration列的<code class="fe mo mp mq mr b"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/console/table" rel="noopener ugc nofollow" target="_blank">console.table</a></code>来显示它们。这将大致转化为:</p><p id="20f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe mo mp mq mr b">console.table(performance.getEntriesByType('measure'), ['duration']);</code></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/2f320bc560e0dacf69164294fe12d731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*rKd_p-xO5jsvtipHEa-t8w.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The resulting log in our browser console.</figcaption></figure><p id="04df" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完整的代码可以在这个<a class="ae ks" href="https://codepen.io/sinia-nimevi/pen/XWaWYZV" rel="noopener ugc nofollow" target="_blank">代码栏</a>中看到。</p><h1 id="3d65" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">结论</h1><p id="de73" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">显然，这里的例子缺少一些东西。虽然它显示了两个函数的粗略比较，但真实世界的函数需要用不止一组参数一起测试，因为真实世界的应用程序可能会在各种场景中调用一个函数。您还可以通过划分结果来获得平均值，并自动重新运行测试几次来使逻辑变得复杂…但总而言之，这实际上取决于您的用例。如果您已经决定对代码进行微优化，我希望这足以让您入门。</p><p id="e423" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，如果你认为你有一些我可能遗漏或误解的见解，请在评论中自由讨论——这个主题很广泛，可以用无数种方式来处理。如果你想拓展人脉或者只是扩大人脉——你可以在 <a class="ae ks" href="https://twitter.com/SNimcevic" rel="noopener ugc nofollow" target="_blank"> <em class="mw"> Twitter </em> </a> <em class="mw">和</em><a class="ae ks" href="https://www.linkedin.com/in/sini%C5%A1a-nim%C4%8Devi%C4%87-5b438996/" rel="noopener ugc nofollow" target="_blank"><em class="mw">LinkedIn</em></a><em class="mw">上找到我。</em></p><h1 id="e22d" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">来源</h1><ul class=""><li id="13b2" class="mx my in kv b kw mi kz mj lc mz lg na lk nb lo nc nd ne nf bi translated"><a class="ae ks" href="https://codepen.io/sinia-nimevi/pen/XWaWYZV" rel="noopener ugc nofollow" target="_blank">https://codepen.io/sinia-nimevi/pen/XWaWYZV</a></li><li id="4f30" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><a class="ae ks" href="https://web.dev/rail/" rel="noopener ugc nofollow" target="_blank">https://web.dev/rail/</a></li><li id="d137" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/Performance_API" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/Performance _ API</a></li><li id="032b" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceEntry" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/performance entry</a></li><li id="4a6c" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><a class="ae ks" href="https://www.w3.org/TR/hr-time/" rel="noopener ugc nofollow" target="_blank">https://www.w3.org/TR/hr-time/</a></li><li id="2cae" class="mx my in kv b kw ng kz nh lc ni lg nj lk nk lo nc nd ne nf bi translated"><a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Web/API/console/table" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/API/console/table</a></li></ul><p id="5052" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mw">更多内容请看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>