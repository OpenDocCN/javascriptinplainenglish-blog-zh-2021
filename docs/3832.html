<html>
<head>
<title>How to Include Spotify Authorization in Your React App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React应用中加入Spotify授权</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-include-spotify-authorization-in-your-react-app-577b63138fd7?source=collection_archive---------2-----------------------#2021-08-02">https://javascript.plainenglish.io/how-to-include-spotify-authorization-in-your-react-app-577b63138fd7?source=collection_archive---------2-----------------------#2021-08-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bab73e1a77497e76e642851ddc0e852a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G1GpZXracKTIJP--"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@alexbemore?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Shatov</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b419" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，你需要来自Spotify的数据，无论是来自特定用户的数据还是Spotify获得的播放列表。在你做这些之前，你必须去<a class="ae jz" href="https://developer.spotify.com/" rel="noopener ugc nofollow" target="_blank">https://developer.spotify.com/</a>注册成为你的应用程序的用户。</p><p id="2cb8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的例子中，我们只是要有一个到Spotify的给定认证过程的链接，它将只是重定向回你给的任何链接。设置中的该选项如下所示:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/9962c5b483a77f7cd4dd66cfdf0f7ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*hNVEn3zahJfuFAbH4zzzlg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Found in “Edit Settings”</figcaption></figure><p id="c994" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您想要添加的重定向URI将是您想要在用户登录后转到的URI。在这种情况下，它是前端所在的位置，但是在部署之后，它将是您选择的任何域。</p><p id="6a1c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在那里，您应该看到一个客户端ID和一个显示您的客户端密码的选项。现在记下它们在哪里，你以后会需要它们的。</p><p id="6572" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，回到我们的应用程序，我们可以添加一个按钮/链接，将我们带到Spotify的端点。对我们来说，它只是https://accounts.spotify.com/authorize的T2。我将这个链接放在我的项目中一个名为spotify.js的文件中。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ld"><img src="../Images/ec312a69b5d5e4f5285a88a93850c446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*iGEkZ1WDN31I_Qjs40H5iw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">src/spotify.js</figcaption></figure><p id="81c1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来我们需要一个范围列表。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi le"><img src="../Images/4e186a879d3196d43526843c70bd1a3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*KVAhy37kikFViYVooZo4sw.png"/></div></figure><p id="49bb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这基本上告诉我们的应用程序用户可以通过Spotify API做什么。因此，如果我们不包含删除功能，用户将无法删除任何内容。<a class="ae jz" href="https://developer.spotify.com/documentation/general/guides/scopes/" rel="noopener ugc nofollow" target="_blank">这是可用的示波器列表。</a></p><p id="ed97" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，有了我们所有的部分，我们可以构造当用户按下登录按钮时我们想要发送给他们的URL。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lf"><img src="../Images/3e2cdfa430881a2502e76056a3898e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fSSSfHRB1X1YhBgvH0XytQ.png"/></div></div></figure><p id="a72d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/27ab4bb8876cf7aeeb33c4ae84abb5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*QTRKKy_9_y4TuAfV87svfg.png"/></div></figure><p id="1531" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它从authEndpoint开始，在问号之后添加所有必要的信息，在&amp;符号之后的所有内容都是另一个新的部分。</p><p id="0064" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，现在如果我们把这个加到一个<a>标签上，</a></p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/9afe12777abc248ecf27e4b925c96563.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*nDr7AQjW9H5WyXjKfI0x1w.png"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi li"><img src="../Images/ed421cb6e1ad6ff596b7dd640ec19e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*MmVOatnn8vtJnFe877c4DQ.png"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/452de6166a520aaafdf099566489d026.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*SpfywMh03752rXIth4W9lA.png"/></div></figure><p id="f3e7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们点击我设计的看起来像按钮的<a>标签，它会把我们带到一个看起来像这样的登录页面:</a></p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/d1ffe5face24d9907554d1427b4c38e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/1*FiLZiXjE5GGXOM3ENj4Q2g.png"/></div></figure><p id="0e01" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者，如果您已经从另一个选项卡登录:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/df65720f08c1b1b4fe895e676716f8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*BwEyrGg7cr3xdG20NOGpeg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">bingo was made for this demonstration btw</figcaption></figure><p id="63e9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，很好，那么当有人登录时，具体是做什么的？</p><p id="d207" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当我们返回到我们的重定向URL时，我们应该看到一个长字符串，其中包含我们的accessToken，即“access token = whateveryouraccesstokenis”。</p><p id="0200" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了从我们得到的URL中提取数据，我们可以使用这个函数:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/70cbcbf44861fe073c81cc6a9bc1c493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*9GMC8FgkfRdE87xSqHBWhA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk"><a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/API/Location/hash" rel="noopener ugc nofollow" target="_blank">window.location.hash,</a> <a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/substring" rel="noopener ugc nofollow" target="_blank">substring</a>, <a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/split" rel="noopener ugc nofollow" target="_blank">split</a>, <a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" rel="noopener ugc nofollow" target="_blank">reduce</a>, and <a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent" rel="noopener ugc nofollow" target="_blank">decodeURIComponent</a></figcaption></figure><p id="2a0f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个函数的返回值将是一个填充了从我们登录后他们返回给我们的URL中提取的数据的对象。</p><p id="0ef2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要实际使用来自对象的数据从Spotify获取东西，首先，我们必须:</p><pre class="kz la lb lc gt ln lo lp lq aw lr bi"><span id="b09b" class="ls lt in lo b gy lu lv l lw lx">npm install spotify-web-api-js</span></pre><p id="b3f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是用于React的Spotify <a class="ae jz" href="https://github.com/JMPerez/spotify-web-api-js" rel="noopener ugc nofollow" target="_blank">包装器</a>。这使我们能够在给定正确令牌的情况下轻松地与Spotify的数据进行交互。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/2a4a335fe6ea21a3f3a4ac1ff7caceef.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*YodcsB0hZ4KWY-ybmL4udA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">in App.js</figcaption></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/c912f1e9525e1979efa9518e6b608331.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*CWauIynMr6dLgmkddoD8Yw.png"/></div></figure><p id="7187" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，为了实际展示我们可以使用用户信息从Spotify获得一些东西，我们可以将控制台日志放在useEffect挂钩中:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/b23e4d60a78f6f1c53edcf2fe9473fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*-jg_7BjZ16ORm49PZqbMEQ.png"/></div></figure><p id="cd81" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">登录后，在我们的浏览器控制台中，我们可以看到:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/075d25ae38b0fcb8c9b367b9052318c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*xAWitEup7SyskRVQwkAlTg.png"/></div></figure><p id="f45f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了检查登录的是否真的是您，您可以检查images属性，看看发回的是否真的是您的个人资料图片。</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/e67212f2528ef40861c527c47ac70594.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*jHEA8bsdxmqCKxj448it4w.png"/></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div class="gh gi md"><img src="../Images/2f31b9fd933d11a000d5a54df66ab437.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/0*OADq44cIlNERt3wJ"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">perfect</figcaption></figure><p id="c9ac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">spotify-web-api-js包中还包含其他东西，有助于与spotify的交互更加顺畅。</p><p id="ca84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="me">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="me">plain English . io</em></strong></a></p></div></div>    
</body>
</html>