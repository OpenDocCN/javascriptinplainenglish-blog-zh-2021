<html>
<head>
<title>How to Integrate Instagram Basic Display API with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Instagram基本显示API与Node.js集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/instagram-basic-display-api-integration-with-nodejs-45e4338dff17?source=collection_archive---------0-----------------------#2021-07-29">https://javascript.plainenglish.io/instagram-basic-display-api-integration-with-nodejs-45e4338dff17?source=collection_archive---------0-----------------------#2021-07-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/eebcf726aaaecd077279d3562d5c1a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gs0GEdGBdSSoLVNMpCIUXA.png"/></div></div></figure><p id="d337" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文将展示Instagram如何与您的系统集成。具体来说，它探索了一种机制来显示<strong class="jx io">用户在你的应用/网站</strong>上的Instagram帖子。</p><blockquote class="kt ku kv"><p id="c449" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><em class="in">在撰写本文时，</em><a class="ae la" href="https://instafeedjs.com/#/" rel="noopener ugc nofollow" target="_blank"><em class="in">insta feed . js</em></a><em class="in">提供了类似的功能。不过要靠Heroku的免费服务来刷新代币。Heroku更新了定价政策后，它变得有点贵了。这种方法可以作为自托管的替代方法。</em></p></blockquote><p id="7a14" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在继续之前，请前往<a class="ae la" href="https://developers.facebook.com/docs/instagram-basic-display-api/overview" rel="noopener ugc nofollow" target="_blank">脸书开发者</a>页面并浏览<strong class="jx io">概述。</strong>进一步掌握概念会更容易。</p><p id="e191" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">整个过程可归结为4个步骤:</p><ol class=""><li id="5af1" class="lb lc in jx b jy jz kc kd kg ld kk le ko lf ks lg lh li lj bi translated">创建脸书应用程序</li><li id="6602" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">获取访问令牌</li><li id="9729" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">设置令牌刷新服务</li><li id="be0c" class="lb lc in jx b jy lk kc ll kg lm kk ln ko lo ks lg lh li lj bi translated">取数据</li></ol><h1 id="c90b" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">1.创建脸书应用程序</h1><p id="d6f7" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">遵循此链接中的步骤1至3。</p><p id="1170" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae la" href="https://developers.facebook.com/docs/instagram-basic-display-api/getting-started" rel="noopener ugc nofollow" target="_blank">https://developers . Facebook . com/docs/insta gram-basic-display-API/getting-started</a></p><h1 id="a3d8" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">2.获取访问令牌</h1><p id="0aef" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">继续下一步需要应用程序特定的密钥和秘密，可以在这里找到。</p><p id="c4f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">应用仪表板我的产品Instagram基本显示设置</em></p><p id="1888" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">仅在前端需要应用ID；后端需要ID和secret。由于App secret不能向用户显示，所以它作为环境变量保存在服务器上。</p><figure class="mt mu mv mw gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/e122c833633c2b32fe279e194871bd2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAs5NfA91Yg_aeBcfGjAeA.png"/></div></div><figcaption class="mx my gj gh gi mz na bd b be z dk">App ID, secret &amp; Redirect URIs</figcaption></figure><p id="f45f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，将您的前端应用程序的URL添加到<strong class="jx io">有效OAuth重定向URIs。带https的l <a class="ae la" href="http://Localhost" rel="noopener ugc nofollow" target="_blank"> ocalhost </a>就可以了。在<a class="ae la" href="https://pages.github.com/" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>上托管静态应用也可以，而且是更好的选择。</strong></p><h1 id="72cd" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">前端</h1><p id="bad0" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">在静态前端站点上使用这段代码获得一个短期访问令牌。短期访问令牌的有效期为1小时，但可以交换为长期令牌(稍后将在服务器端进行)。</p><p id="a062" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">由于我们的目标是获取用户相关信息和他们的Instagram照片，因此范围被设置为<code class="fe nb nc nd ne b">user_profile</code> &amp; <code class="fe nb nc nd ne b">user_media</code>。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="5466" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它将在一个新的选项卡上打开授权窗口。在被授权后，它将重定向到带有包含<code class="fe nb nc nd ne b">code</code>的查询参数的<code class="fe nb nc nd ne b">/insta</code>页面(如上面的代码所配置的)。该代码将用于在后端获取短期访问令牌。</p><p id="b392" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，<code class="fe nb nc nd ne b">code</code> &amp; <code class="fe nb nc nd ne b">redirect URI</code>被发送到服务器进行进一步处理。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="4de0" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">后端</h1><p id="7f29" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">假设后端有一个通过任何HTTP方法接收<code class="fe nb nc nd ne b">code</code> &amp; <code class="fe nb nc nd ne b">redirect URI</code>的端点。</p><p id="e431" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，下一步是获得短期访问令牌。代码是不言自明的。</p><blockquote class="kt ku kv"><p id="94ec" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><em class="in">基于JSON的POST无法工作。所以基于表单的请求是通过</em> <strong class="jx io"> <em class="in">请求</em> </strong> <em class="in">发送的。</em></p></blockquote><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="ada9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">获得<strong class="jx io">短期访问令牌</strong>后，需要与<strong class="jx io">长期访问令牌进行交换。</strong></p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="a4b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于进一步的API调用，仅使用<strong class="jx io">长期访问令牌</strong>。如前所述，短期令牌有1小时的有效期。类似地，长期令牌有60天的有效期。即刚刚存储在DB上的令牌需要在其到期之前被刷新。</p><h1 id="b027" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">3.设置令牌刷新服务</h1><p id="2389" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">要每60天刷新一次令牌，cron作业似乎是合适的。node-cron 最适合这个目的。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="289c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在<code class="fe nb nc nd ne b">instaRefresh.cron</code>文件中，它从数据库中获取旧令牌并用新令牌替换它。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="fc74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，这个cron作业将自动刷新访问令牌。</p><h1 id="32f6" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">4.取数据</h1><p id="6c0a" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">最后，是时候从Instagram获取数据了。我们将使用存储在DB上的<code class="fe nb nc nd ne b">accessToken</code>。要了解更多可以获取的数据类型，请访问此<a class="ae la" href="https://developers.facebook.com/docs/instagram-basic-display-api/guides" rel="noopener ugc nofollow" target="_blank">页面</a>。</p><blockquote class="kt ku kv"><p id="fab0" class="jv jw kw jx b jy jz ka kb kc kd ke kf kx kh ki kj ky kl km kn kz kp kq kr ks ig bi translated"><em class="in">访问令牌是应用范围的(对于应用和用户对是唯一的)</em></p></blockquote><p id="95e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我们将获取用户上传的媒体。然后对其进行过滤，仅获得图像。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="3aed" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">平台费率限制</h1><p id="354f" class="pw-post-body-paragraph jv jw in jx b jy mn ka kb kc mo ke kf kg mp ki kj kk mq km kn ko mr kq kr ks ig bi translated">Instagram API对API调用次数有限制。更多细节可以在这里找到<a class="ae la" href="https://developers.facebook.com/docs/graph-api/overview/rate-limiting#platform-rate-limits" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="2327" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">解决这个问题的一种方法是缓存API响应。对于这个特定的场景，图像URL可以每隔，比如说，每3个小时保存到数据库；使用克隆作业。</p><figure class="mt mu mv mw gt jo"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="55c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不用直接调用Instagram API，图片可以从DB端上来；作为一个缓存。然而，这种特殊的情况并不适合所有的用例。</p><p id="a540" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望本指南有助于在基于Node.js的应用上集成Instagram Basic API。如果你有更好的选择，请在下面的评论中提出。</p><p id="c7cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读。🙂</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><h1 id="8ac6" class="lp lq in bd lr ls no lu lv lw np ly lz ma nq mc md me nr mg mh mi ns mk ml mm bi translated">参考</h1><div class="nt nu gp gr nv nw"><a href="https://github.com/stevenschobert/instafeed.js/wiki/Facebook-app-and-test-user-setup" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">脸书应用和测试用户设置stevenschobert/insta feed . js Wiki</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jt nw"/></div></div></a></div><div class="nt nu gp gr nv nw"><a href="https://developers.facebook.com/docs/instagram-basic-display-api" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">Instagram基本显示API - Instagram平台-文档-开发者脸书</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Instagram基本显示API允许您的应用程序用户在他们的……中获取基本的个人资料信息、照片和视频</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">developers.facebook.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok jt nw"/></div></div></a></div><p id="541b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kw">更多内容看</em><a class="ae la" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="kw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>