<html>
<head>
<title>Dynamically Importing Modules in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JavaScript中动态导入模块</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-dynamically-importing-modules-94e1b88c420?source=collection_archive---------6-----------------------#2021-03-20">https://javascript.plainenglish.io/javascript-dynamically-importing-modules-94e1b88c420?source=collection_archive---------6-----------------------#2021-03-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/05349707e81e1766a8b26849c28e6953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5F1uobf9H8m6T7Pr"/></div></div></figure><p id="b333" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当涉及到开发有效的网站时，页面加载速度是至关重要的——特别是对于那些通过移动运营商的网络速度从移动设备访问的用户。2021年，谷歌根据几个因素对网站进行排名——从累积布局变化到页面加载速度和未使用的JavaScript，这些因素会使文件膨胀，减少加载时间和性能。通过努力减少脚本的数量和加载页面的时间，一个网站将在谷歌和其他搜索引擎上获得更高的分数，这反过来将帮助用户找到你的网站，并增加你的访客数量。</p><p id="f850" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在现代JavaScript中，JS文件可以被分解成多个更小的文件，组件可以只在需要时导出。这有助于缩短页面加载时间，并使您的代码库更容易管理和梳理，如果您或其他开发人员以后需要审查或重构它的话。下面是一个如何将JavaScript模块导入JavaScript的示例:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="dfd3" class="lc ld in ky b gy le lf l lg lh">import User, { userDetail } from './Users.js'</span></pre><p id="a097" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这段代码将从名为“users.js”的JavaScript文件中导入名为Users和userDetails的模块。您可以根据需要将这些组件导入到其他模块化JS文件中。这称为静态导入，以这种方式导入模块的最大问题是，当包含这些代码时，浏览器会立即下载这些代码——这会导致页面加载非常缓慢，从而损害SERP评级，甚至会导致不耐烦的访问者尽可能远离您的站点。</p><p id="f40a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在JavaScript中实现模块化导入的更好方法是使用动态模块导入。与静态模块导入非常相似，您可以仅在需要时导入某些模块——但是动态模块导入允许您仅在绝对必要时使用条件逻辑语句导入代码。这将导致更快的页面加载速度，因为浏览器不会试图立即下载所有的JavaScript。如果用户不需要使用某个模块，它将不会被加载。</p><p id="eea0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在JavaScript中有几种使用动态模块导入的方法。让我们看看从上面动态导入同一个模块:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="824c" class="lc ld in ky b gy le lf l lg lh">import('./Users.js').then(({ default: User, userDetail }) =&gt; {<br/>    //This will be the code that depends on the module...<br/>});</span></pre><p id="9853" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个方法非常类似于静态导入模块，但是这个导入是一个返回承诺的函数。这个承诺包含了这个模块的所有细节。您还会注意到，模块的默认导出必须根据承诺的返回值进行重构。这就是default: User的作用——它将模块的默认导出映射到用户变量。通过使用异步函数，可以进一步简化和清理这个导入函数。这里有一个例子:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="cdc8" class="lc ld in ky b gy le lf l lg lh">const { default: User, userDetail } = await import('./Users.js');</span></pre><p id="7dd7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个方法的工作方式和promise函数完全一样，但是看起来更简洁，也更容易使用。</p><p id="1f4b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用动态导入的模块有几个好处。我能想到的前三个原因是提高初始页面加载速度和避免不必要的浏览器填充。假设我们正在构建一个利用购物车功能的电子商务应用程序。购物车的逻辑相当复杂，因此需要大量代码才能运行。传统上，浏览器会立即下载所有这些代码，这会导致页面加载非常缓慢。然而，动态导入的模块可以解决这个问题，它允许我们在用户实际与购物车交互时只下载购物车的逻辑。</p><p id="da20" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里有一个例子:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="29eb" class="lc ld in ky b gy le lf l lg lh">addToCartBtn.addEventListener('click', async () =&gt; {<br/>  const { showCart, checkout } = await import('./cart.js');<br/>});</span></pre><p id="a6df" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只有当用户单击“添加到购物车”按钮时，上述代码才会导入将功能添加到购物车所需的逻辑模块。通过这样做，购物车的代码直到绝对需要时才会被加载，这将为那些可能永远不会与购物车交互的访问者加快页面加载速度。</p><p id="88a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在许多应用程序中，可能有许多polyfills，允许支持旧浏览器上的特性和功能。这些聚合填充会大大降低不需要它们的用户的页面加载速度，这无疑会影响访问者在现代浏览器上的用户体验。只有在需要时，我们才能使用动态模块来导入聚合填充:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="f6a5" class="lc ld in ky b gy le lf l lg lh">if (isLegacyBrowser) import('./polyfills.js');</span></pre><p id="c7b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该导入没有返回值，因为当导入一个模块时，模块中的所有代码都会被导入，并且它们的聚合填充会在需要时自动设置。这样，可以实现一个函数，如果用户使用的是旧版本的浏览器，该函数将返回true值，然后polyfills模块将被导入。</p><p id="ab56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">另一名开发人员指出，在开发全球应用程序时，可能会有许多与国际化相关的文件和代码，为许多不同的语言提供支持和翻译。通过在初始加载时加载所有这些语言支持模块，浏览器将下载所有这些模块，这很可能会降低用户的页面加载速度。如果我们有一种方法，只在需要的时候导入国际化文件，甚至只导入用户特定语言需要的文件，那会怎么样？这是动态导入模块的另一个用途:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3b1c" class="lc ld in ky b gy le lf l lg lh">const userLang = window.navigator.userLanguage<br/>|| window.navigator.language<br/>const { localStrings } = awai import(`strings.${userLang}.js`);</span></pre><p id="4071" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这段代码允许浏览器根据用户的浏览器设置检测用户的首选语言，并只加载支持该语言所需的模块。</p><p id="0c7e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见，动态导入的模块在JavaScript中非常有用。它允许更快的初始页面加载，防止浏览器下载未使用的代码，并提供更快、更好的用户体验。本文中的例子只是动态导入的模块可以做的一些令人惊奇的事情，但是我希望它能给你一些有用的建议，告诉你如何提高你的站点或应用程序的性能和排名。</p></div></div>    
</body>
</html>