<html>
<head>
<title>Easily Integrate ClamAV Antivirus Software in Your Node.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js应用程序中轻松集成ClamAV防病毒软件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integrate-clamav-antivirus-software-in-your-node-js-application-39d92ff76792?source=collection_archive---------2-----------------------#2021-10-16">https://javascript.plainenglish.io/integrate-clamav-antivirus-software-in-your-node-js-application-39d92ff76792?source=collection_archive---------2-----------------------#2021-10-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9484" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">向您展示如何在Node.js应用程序中扫描恶意文件的简单步骤</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/392b939bcc86bdc5b244f335353f18a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0FLVSqXZMLG8klz3"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jackson_893?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Michael Geiger</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="de2e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">谈到互联网和web应用程序，安全性是一个重要的关键词。我们总是努力保护我们的系统免受网络攻击。危及安全会导致我们暴露有价值的信息，从而毁掉我们的业务。</p><p id="a711" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">大多数安全攻击都是通过向网站上传恶意文件来完成的。许多网站允许用户上传个人照片、简历等文件。黑客可能会利用这个机会将易受攻击的文件上传到网站，并获得未经授权的访问权限。</p><p id="7e47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，如果我们的web应用程序允许用户上传文件，那么我们需要提供某种级别的安全性来扫描文件中的漏洞。我们应该在服务器上安装杀毒软件并扫描上传的文件。</p><p id="0923" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ClamAV 是扫描网络应用程序文件的绝佳选择。由于其多功能性，它支持多种文件格式和签名语言。还有一个很棒的Node.js包叫做<code class="fe ls lt lu lv b">clamscan</code>，它提供了一个从后端应用程序扫描文件的API。</p><p id="7dd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将探讨如何使用clamscan来扫描文件，以检测服务器中的病毒和恶意内容。因此，没有进一步的行动，让我们直接进入它。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="bca4" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">在Ubuntu中安装和配置ClamAV</h1><p id="371a" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">首先，我们需要在我们的服务器或本地计算机上安装ClamAV。在Linux机器上安装ClamAV相当容易:</p><ul class=""><li id="0700" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated">为了在基于Fedora的发行版上安装，</li></ul><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="6e68" class="nn me iq lv b gy no np l nq nr">sudo yum install clamav</span></pre><ul class=""><li id="80f2" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated">为了在基于Debian的发行版上安装，</li></ul><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="9ee4" class="nn me iq lv b gy no np l nq nr">sudo apt-get install clamav clamav-daemon</span></pre><ul class=""><li id="c65a" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated">对OS X来说，</li></ul><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="2bdc" class="nn me iq lv b gy no np l nq nr">sudo brew install clamav</span></pre><p id="f37d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的Linux机器上安装ClamAV之后，我们需要配置一些设置。对于运行Ubuntu作为其操作系统的计算机，在终端中执行以下命令来启动<code class="fe ls lt lu lv b">clamav-freshclam</code>。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="2481" class="nn me iq lv b gy no np l nq nr">sudo service clamav-freshclam restart<br/>sudo service clamav-freshclam status</span></pre><p id="9ee0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，我们应该开始<code class="fe ls lt lu lv b">clamav-daemon</code>服务。这个过程非常重要，因为它将在<code class="fe ls lt lu lv b">/var/run/clamav/clamd.ctl</code>中创建一个套接字文件，用于扫描上传到服务器的文件流。</p><p id="ab28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们在终端中运行以下命令来启动<code class="fe ls lt lu lv b">clamav-daemon</code>:</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="a9fb" class="nn me iq lv b gy no np l nq nr">sudo service clamav-daemon start<br/>sudo service clamav-daemon status</span></pre><p id="c870" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的Linux机器上安装和配置ClamAV之后，我们准备进一步在Node.js应用程序中实现扫描文件。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="a827" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">设置项目</h1><p id="6dfa" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">首先，让我们创建一个新项目并设置一些基本配置。</p><p id="e837" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要从头开始创建一个新的Node.js应用程序，我们需要在终端中键入以下命令:</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="f38c" class="nn me iq lv b gy no np l nq nr">npm init -y</span></pre><p id="0883" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将创建一个包含一些信息的<code class="fe ls lt lu lv b">package.json</code>文件。然后，我们应该通过在终端中运行以下命令来安装所需的包以及express js:</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="ac23" class="nn me iq lv b gy no np l nq nr">npm install express</span></pre><p id="3bf3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该命令将安装express js和运行Node.js应用程序所需的所有其他依赖项。接下来，让我们在项目的根目录下创建一个名为<code class="fe ls lt lu lv b">server.js</code>的文件。在这里，我们将粘贴以下代码块。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9624" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要运行服务器，让我们在<code class="fe ls lt lu lv b">package.json</code>中添加以下代码。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="1b13" class="nn me iq lv b gy no np l nq nr">{<br/>  // ...<br/>  "scripts": {<br/>    "start": "node server.js",<br/>    // ...<br/>  },<br/>  // ...<br/>}</span></pre><p id="a99f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，如果我们在终端中运行<code class="fe ls lt lu lv b">npm start</code>，我们应该会看到一条消息“服务器正在监听端口3000”。这意味着我们的应用程序已经成功配置。</p><h1 id="7f1b" class="md me iq bd mf mg nu mi mj mk nv mm mn jw nw jx mp jz nx ka mr kc ny kd mt mu bi translated">安装和配置Clamscan</h1><p id="5db7" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">现在，我们已经初始化了我们的项目，并实现了一些基本配置，是时候为项目安装和配置clamscan了。</p><p id="5fdd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要安装clamscan，我们应该在终端中编写以下命令:</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="0932" class="nn me iq lv b gy no np l nq nr">npm install clamscan</span></pre><p id="37f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它将安装使用ClamAV扫描和发现恶意文件所需的所有必要的依赖项和API。</p><p id="c448" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，我们需要修改下面的<code class="fe ls lt lu lv b">server.js</code>中的代码来配置clamscan。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="2d4d" class="md me iq bd mf mg nu mi mj mk nv mm mn jw nw jx mp jz nx ka mr kc ny kd mt mu bi translated">扫描文件</h1><p id="6661" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">现在，我们可以使用以下代码块扫描服务器中的文件:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="3f4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以修改代码来扫描通过API上传的文件。因此，我们甚至可以在将文件保存到存储之前轻松检测到恶意内容。</p><p id="9b9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是在此之前，我们需要安装几个包:<code class="fe ls lt lu lv b">cors </code>和<code class="fe ls lt lu lv b">express-fileupload</code>。我们需要这些包来实现向服务器上传文件。我们可以通过在终端中运行以下命令来安装这两个软件包:</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="21a2" class="nn me iq lv b gy no np l nq nr">npm install cors express-fileupload</span></pre><p id="7825" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们创建一个名为<code class="fe ls lt lu lv b">config.js</code>的新文件，并将<code class="fe ls lt lu lv b">clamscanConfig</code>移动到<code class="fe ls lt lu lv b">config.js</code>。让我们也在<code class="fe ls lt lu lv b">config.js</code>中添加<code class="fe ls lt lu lv b">fileUploadConfig</code>，这将是<code class="fe ls lt lu lv b">express-fileupload</code>的配置选项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9632" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，让我们将以下代码块添加到<code class="fe ls lt lu lv b">server.js</code>文件中:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="9acf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们将在每个路由器中使用<code class="fe ls lt lu lv b">req.clamscan</code>，这里我们需要上传一个或多个文件。</p><p id="cba3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">至此更改完<code class="fe ls lt lu lv b">server.js</code>后，完整的<code class="fe ls lt lu lv b">server.js</code>将类似于下面的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="54c6" class="nn me iq bd mf nz oa dn mj ob oc dp mn lf od oe mp lj of og mr ln oh oi mt oj bi translated">实现上传API</h2><p id="4939" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">到目前为止，我们配置了这么多东西！现在，是时候创建一个上传路径了，文件将被上传到这里。</p><p id="2c74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们首先创建一个简单的上传文件的POST API:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6f17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们实现了一个简单的POST API来上传头像图片。我们可以通过使用<a class="ae kv" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>或任何其他平台上传文件来测试这个API。在此之前，我们需要在项目的根目录下创建一个名为<code class="fe ls lt lu lv b">upload</code>的文件夹，防止找不到目录的错误。</p><p id="f157" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果文件成功上传，我们将进入下一阶段，在存储文件之前对其进行扫描。</p><p id="84e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们更改上面的代码，在将文件保存到服务器之前扫描它们:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="a4e7" class="md me iq bd mf mg nu mi mj mk nv mm mn jw nw jx mp jz nx ka mr kc ny kd mt mu bi translated">结果</h1><p id="88f4" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">现在是测试API的时候了。让我们上传一个恶意文件，看看服务器的输出是什么。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/388a0857396e7a3d86510a809bafad7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ioOC2YYDSwvWO8B5C8lsRg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image captured by the author</figcaption></figure><p id="62ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以看到，防病毒软件已成功检测到恶意文件，并阻止了web应用程序在服务器上存储该文件。我们还可以通过通知用户有关病毒的信息来警告他们。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="94cf" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">摘要</h1><p id="77e3" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">到目前为止，我们已经在我们的Linux机器上安装了ClamAV，并创建了一个Node.js应用程序，我们可以在其中扫描上传的文件，并检测该文件是否被感染。我们还通过上传一个恶意文件来测试我们的API。</p><p id="e7b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在可以利用这些知识，在所有后端应用程序中扫描恶意文件。这将使我们的用户在使用我们的应用程序时更可靠、更有信心。</p><p id="1c9e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，我们可以防止我们的网站受到有害的攻击和安全漏洞。虽然我们不能100%安全地抵御攻击者，但这将使我们在一定程度上领先于他们，并确保我们的资源安全无虞。</p><h1 id="b328" class="md me iq bd mf mg nu mi mj mk nv mm mn jw nw jx mp jz nx ka mr kc ny kd mt mu bi translated">资源</h1><ul class=""><li id="5e4d" class="na nb iq ky b kz mv lc mw lf ol lj om ln on lr nf ng nh ni bi translated"><a class="ae kv" href="https://github.com/kylefarris/clamscan#readme" rel="noopener ugc nofollow" target="_blank">https://github.com/kylefarris/clamscan#readme</a></li><li id="8262" class="na nb iq ky b kz oo lc op lf oq lj or ln os lr nf ng nh ni bi translated"><a class="ae kv" href="https://kainikhil.medium.com/installing-clamav-and-clam-f4d26d8150c4" rel="noopener">https://kainikhil . medium . com/installing-clamav-and-clam-f 4d 26d 8150 C4</a></li><li id="984f" class="na nb iq ky b kz oo lc op lf oq lj or ln os lr nf ng nh ni bi translated"><a class="ae kv" href="https://kainikhil.medium.com/nodejs-file-upload-and-virus-scan-9f23691394f3" rel="noopener">https://kaini hil . medium . com/nodejs-file-upload-and-virus-scan-9f 23691394 F3</a></li></ul></div></div>    
</body>
</html>