# 让我们使用 JavaScript 创建一个重试机制

> 原文：<https://javascript.plainenglish.io/lets-make-a-retry-mechanism-a339307d44bc?source=collection_archive---------2----------------------->

![](img/07d0848e8207022b12b5c0c64c3c5ca1.png)

Photo by [Christopher Gower](https://unsplash.com/@cgower?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

# 你为什么要费心重试呢？

有时候，当向某个 API 发出请求时，事情会出错。

我记得在工作中有某个 **bug** 需要修复。

我们需要**谷歌地理定位库**来完成一些特定的操作。

不幸的是，由于一些问题，它有时无法加载，我们的应用程序部分将无法正常工作。

我的任务是实现一个**重试机制**来尝试多次重新加载，从而使应用程序更有弹性**。**

**为此，我们需要创建一个基本上一直调用另一个函数的函数(在本例中，后者是加载库的那个)。**

**这个代码片段有我们的**重试函数**的起始代码，默认情况下重试 3 次，并在后续调用之间设置 2.5 秒的间隔来加载库。**

**另外，`loadLibrary()`是一个模拟 Google 库负载的函数。**

**它返回一个包含一个在 500 毫秒后调用一个回调的`setTimeout`的`Promise`。**

**但是这不会起作用，因为我们只需要调用这个**加载函数**一定的次数，而不是永远！**

**通过这些增加，我们有了一个**工作重试功能**。**

**通过递增`numberOfTries`变量，`retry()`函数知道到目前为止已经尝试了多少次加载。**

**`try/catch`块用于**错误处理**目的:**

*   **在**成功**时，它通过调用`clearInterval()`结束循环，并且**履行**承诺。**
*   **在出现**错误**的情况下，它会被捕获并记录到控制台，同时记录当前的尝试次数。**

**为了停止无用的函数调用，不要忘记相应地`clearInterval()`。**

****重试机制在以下两种情况下结束**:**

*   **已经达到重试的**限制**。**
*   **在一次重试调用后，我们设法**成功加载了**我们的库。**

**还有最后一件事要改变。**

**目前，我们的`loadLibrary()`功能**每次都工作**。在“随机”数字的帮助下，我们将模拟一种情况，其中负载试验将在时间的 **~30%** 中工作。**

**就是这样！**

**我们的`retry()`函数将尝试加载库一个设定的次数，并将告诉它是否**成功**，以及在什么**尝试计数**时它停止。**

**希望这篇文章能引起你的兴趣，对你有所帮助！**

**您在获取/加载数据时是否遇到过任何问题，并且您需要一个**重试机制**？也许这段代码可以拯救你的一天，我会很高兴。**

**我渴望看到你的**评论**和**反馈**！**

***更多内容请看*[*plain English . io*](http://plainenglish.io/)**