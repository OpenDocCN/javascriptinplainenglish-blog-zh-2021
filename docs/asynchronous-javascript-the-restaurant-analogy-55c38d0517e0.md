# å¼‚æ­¥ JavaScript:é¤é¦†ç±»æ¯”

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/asynchronous-javascript-the-restaurant-analogy-55c38d0517e0?source=collection_archive---------4----------------------->

![](img/e2d26b302c5fc9c035ff12648834b9eb.png)

æœ¬æ–‡é¢å‘åˆšå¼€å§‹å­¦ä¹  JavaScript å¹¶è¯•å›¾ç†è§£ JavaScript è¿è¡Œæ—¶å·¥ä½œåŸç†çš„åˆå­¦è€…ã€‚è¿™å¯¹æœ‰ç»éªŒçš„ä¸“ä¸šäººå£«æ¥è¯´ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¤ä¹ ã€‚

è¿™æ˜¯æˆ‘ä½¿ç”¨**é¤å…ç±»æ¯”**æ¥è¿‡åº¦ç®€åŒ– JavaScript çš„å¼‚æ­¥æœ¬è´¨çš„ä¸€æ¬¡å°è¯•ã€‚å¦‚æœæˆ‘æœ‰ä»»ä½•é”™è¯¯ï¼Œè¯·éšæ—¶åœ¨è¯„è®ºä¸­çº æ­£æˆ‘ã€‚

# **éœ€è¦å¼‚æ­¥æ‰§è¡Œ**

JavaScript æ˜¯ä¸€ç§åŒæ­¥çš„å•çº¿ç¨‹ç¼–ç¨‹è¯­è¨€ã€‚å®ƒçš„ä»£ç æ˜¯åœ¨å•çº¿ç¨‹ä¸­ä½¿ç”¨å•ä¸ªè°ƒç”¨å †æ ˆé¡ºåºæ‰§è¡Œçš„ã€‚ä½†æ˜¯ä¸å¯èƒ½æŒ‰é¡ºåºå®Œæˆæ‰€æœ‰æ“ä½œã€‚

å‡è®¾æˆ‘ä»¬å¸Œæœ›åœ¨é¡ºåºè¿è¡ŒæœŸé—´ç­‰å¾…ç”Ÿæˆä¸€äº›æ•°æ®æˆ–è¾“å…¥ã€‚ç”±äº JavaScript æ˜¯å•çº¿ç¨‹çš„ï¼Œè®©ä»£ç ç­‰å¾…æŸä¸ªæ“ä½œå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨ç¨‹åºå†»ç»“ã€‚é€šè¿‡ä»ä¸»çº¿ç¨‹å¸è½½è¿™äº›è€—æ—¶çš„æ“ä½œï¼Œå¯ä»¥é¿å…è¿™ç§æƒ…å†µã€‚ **JavaScript è¿è¡Œæ—¶ç¯å¢ƒ** (Browsers/NodeJS)æä¾›äº†ä¸€ç»„å¤„ç†æ­¤ç±»æ“ä½œçš„å¤–éƒ¨ APIã€‚

![](img/964ba33a9d1b6d58ef6e0cb0d9a2e2f5.png)

ä¸Šå›¾å±•ç¤ºäº† JavaScript è¿è¡Œæ—¶ç¯å¢ƒçš„åŸºæœ¬æ¶æ„ã€‚å®ƒåŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†:

*   [JavaScript å¼•æ“](https://en.wikipedia.org/wiki/JavaScript_engine) âš™ï¸
*   [Web API](https://developer.mozilla.org/en-US/docs/Web/API)ğŸ”´ğŸ”´ğŸ”´
*   ä»»åŠ¡é˜Ÿåˆ—`ğŸŸ¦ğŸ”£ğŸ” ğŸ”¢ğŸ”¡ğŸ”¤`
*   [äº‹ä»¶å¾ªç¯](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop)ğŸ”„

æ‰€æœ‰è¿™äº›å…ƒç´ æ„æˆäº†å¼‚æ­¥ JavaScript çš„åŸºæœ¬æ„ä»¶ã€‚

# **å¦‚æœç½‘ç»œæµè§ˆå™¨æ˜¯ä¸€å®¶é¤é¦†**

![](img/2da587f28652b6ea5c2af1c09f21fe1d.png)

* the waiter is part of the JS Runtime even though shown outside

æŠŠç½‘ç»œæµè§ˆå™¨æƒ³è±¡æˆä¸€å®¶**é¤é¦†**ã€‚å®ƒåŒ…æ‹¬ä¸€ä¸ªé¤å…å’Œä¸€ä¸ªå¨æˆ¿ã€‚

**é¤å…**æ˜¯é¡¾å®¢è¿›æ¥ç‚¹é¤çš„åœ°æ–¹ã€‚è¿™ç±»ä¼¼äºç”¨æˆ·åŠ è½½ä¸€ä¸ª**ç½‘é¡µ**å¹¶æ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚ä»æœåŠ¡å™¨è·å–æ•°æ®ã€‚

T21 å¨æˆ¿æ˜¯æ‰€æœ‰é­”æ³•å‘ç”Ÿçš„åœ°æ–¹ã€‚è¿™ç±»ä¼¼äºç”±ä¸åŒç»„ä»¶ç»„æˆçš„ **JavaScript è¿è¡Œæ—¶ç¯å¢ƒ**ï¼Œæ¯ä¸ªç»„ä»¶æ‰§è¡Œä¸€ä¸ªå•ç‹¬çš„ä»»åŠ¡ã€‚

ä¸‹é¢åˆ—å‡ºäº†è¿™äº›ç»„ä»¶ã€‚

> *ğŸ¤µ* ***æœåŠ¡å‘˜(JavaScript å¼•æ“)*** :æœåŠ¡å‘˜æ‰§è¡Œçš„ä»»åŠ¡æ˜¯è·‘æ¥è·‘å»æ¥å•æäº¤åˆ°å¨æˆ¿ï¼Œä¸Šèœï¼Œæ‘†æ¡Œå­ã€‚æœåŠ¡å‘˜ä¹Ÿæ˜¯å¨æˆ¿çš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡åœ¨å›¾ä¸­ä»–è¢«æ˜¾ç¤ºåœ¨å¤–é¢ã€‚è¿™ç±»ä¼¼äºè¿è¡Œä»£ç çš„ **JavaScript å¼•æ“**ã€‚
> 
> *ğŸ‘¨â€ğŸ³* ***å¨å¸ˆ(Web API)***:å¨å¸ˆä»æœåŠ¡å‘˜æ‰‹ä¸­æ¥è¿‡è®¢å•ï¼Œå‡†å¤‡å¥½ç‰©å“ï¼Œæ”¾åœ¨é€é¤å°ä¸Šã€‚è¿™ç±»ä¼¼äº**Web API**æ‰§è¡Œç”¨æˆ·è¯·æ±‚çš„ä»»åŠ¡ï¼Œå¹¶å°†ç»“æœæ¨é€åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚
> 
> *ğŸ‘¨â€ğŸ’¼* ***å¤–å–ç»ç†(äº‹ä»¶å¾ªç¯)*** :ä»–çš„å·¥ä½œæ˜¯ç®¡ç†å¤–å–æŸœå°ã€‚ä»–é‡å¤æ‰§è¡Œä¸¤é¡¹ä¸»è¦ä»»åŠ¡ã€‚
> 
> 1.æ£€æŸ¥é€è´§å°ä¸Šæ˜¯å¦æœ‰ç‰©å“ã€‚
> 
> 2.æŸ¥çœ‹æœåŠ¡å‘˜æ˜¯å¦æœ‰ç©ºï¼Œæœ‰ç©ºå°±æ‰“ç”µè¯ç»™ä»–ã€‚
> 
> è¿™ç±»ä¼¼äº**äº‹ä»¶å¾ªç¯**ï¼Œå…¶å·¥ä½œæ˜¯:
> 
> 1.æ£€æŸ¥ä»»åŠ¡é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰é¡¹ç›®
> 
> 2.æ£€æŸ¥ JavaScript å¼•æ“ä¸­è°ƒç”¨å †æ ˆçš„çŠ¶æ€ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™ä»é˜Ÿåˆ—ä¸­æ¨é€é¡¹ç›®ã€‚
> 
> *ğŸ½ï¸* ***é€é¤å°(ä»»åŠ¡é˜Ÿåˆ—)*** :è¿™æ˜¯å¨å¸ˆä»¬æ”¾ç½®å‡†å¤‡å¥½çš„èœè‚´çš„æ¡Œå­ï¼Œä»¥ä¾¿å¤–å–ç»ç†åœ¨æœ‰ç©ºçš„æ—¶å€™æŠŠå®ƒä¼ ç»™æœåŠ¡å‘˜ã€‚è¿™ç±»ä¼¼äº JavaScript è¿è¡Œæ—¶ä¸­çš„**ä»»åŠ¡é˜Ÿåˆ—**ã€‚

## **ä¸‹è®¢å•**

å®¢æˆ·çš„æ¯ä¸€ä¸ªè®¢å•éƒ½å¯ä»¥ç­‰åŒäºä¸€ä¸ª API è°ƒç”¨ã€‚å½“é¡¾å®¢ç‚¹èœæ—¶ï¼ŒæœåŠ¡å‘˜ğŸ¤µè®°ä¸‹å¹¶å°†å…¶ä¼ é€’ç»™å„è‡ªçš„**å¨å¸ˆ**ğŸ‘¨â€ğŸ³åœ¨å¨æˆ¿ã€‚

å¦‚æœé¤å…æ­£åœ¨åŒæ­¥å·¥ä½œ**ï¼Œ**æœåŠ¡å‘˜**ğŸ¤µä¼šåœ¨å¨æˆ¿é‡Œç­‰ç€ï¼Œç›´åˆ°è®¢å•å®Œæˆï¼Œè¿™æ ·å°±å¯ä»¥é€åˆ°é¡¾å®¢æ‰‹ä¸­ã€‚**

**è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ğŸ˜‘ã€‚åœ¨å‡†å¤‡é£Ÿç‰©çš„è¿‡ç¨‹ä¸­ï¼Œé¤å…å°†æš‚åœè¥ä¸šğŸš«ã€‚ä¸ä¼šæ¥å—æ–°çš„è®¢å•ï¼Œä¸ä¼šæä¾›é£Ÿç‰©ï¼Œä¹Ÿä¸ä¼šå®‰æ’é¤æ¡Œã€‚**

**å¦‚æœé¤å…ä»¥å¼‚æ­¥æ–¹å¼è¿è¡Œï¼Œè¿™æ˜¯å¯ä»¥é¿å…çš„ã€‚**

****æœåŠ¡å‘˜**ğŸ¤µç°åœ¨æŠŠè®¢å•äº¤ç»™å¨æˆ¿ï¼Œç»§ç»­ä»–çš„å·¥ä½œï¼Œè€Œ**å¨å¸ˆ**ğŸ‘¨â€ğŸ³å‡†å¤‡èœã€‚ä¸€æ—¦èœåšå¥½äº†ï¼Œ**å¨å¸ˆ**ğŸ‘¨â€ğŸ³å°†å…¶æ”¾åœ¨**äº¤ä»˜å°**ä¸ŠğŸ½ï¸.ç°åœ¨**å¤–å–ç»ç†**ğŸ‘¨â€ğŸ’¼æ¥æ‰‹å¹¶è®©**æœåŠ¡å‘˜**ğŸ¤µçŸ¥é“ç‰¹å®šçš„ ***è®¢å•å‡†å¤‡å¥½äº†*** ã€‚**æœåŠ¡å‘˜**ğŸ¤µç„¶åå¯ä»¥æ¥å—è®¢å•å¹¶å°†å…¶æä¾›ç»™å®¢æˆ·ã€‚**

**ç»“æœï¼Œ**æœåŠ¡å‘˜**ğŸ¤µå› æ­¤ï¼Œåœ¨å‡†å¤‡é£Ÿç‰©æ—¶ï¼Œé¤å…æ“ä½œ**ä¸ä¼šè¢«é˜»æ­¢**ã€‚**

## **å¤è¯•**

**JavaScript ä½¿ç”¨**å›è°ƒ**æ¥å¤„ç†è¿™æ ·çš„æ“ä½œğŸ“ã€‚å½“è®¢å•è¢«ä¼ é€’åˆ°å¨æˆ¿æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿä¼ é€’ä¸€ä¸ª**å›è°ƒ**ğŸ“éšé‡è€Œå®‰ã€‚è¿™ä¸ªå›è°ƒæŒæœ‰ä¸€ä¸ª**éŸ³ç¬¦**ğŸ“è¯è¯´`**'Serve order to table X'**`ã€‚å½“è®¢å•å‡†å¤‡å¥½äº†ï¼Œå¨å¸ˆğŸ‘¨â€ğŸ³å°†å‡†å¤‡å¥½çš„èœè‚´è¿åŒ**å›æ‹¨** **ç¥¨æ®**ä¸€èµ·æ”¾ç½®ğŸ“åœ¨**äº¤ä»˜å°ä¸Š**ğŸ½ï¸.**å¤–å–ç»ç†**ğŸ‘¨â€ğŸ’¼ç„¶åæ‰“äº†ä¸€ä¸ª**ç”µè¯**ğŸ“å¯¹ç€**æœåŠ¡å‘˜**ğŸ¤µå¯¹äºé‚£ä¸ªç‰¹åˆ«çš„è®¢å•ã€‚**æœåŠ¡å‘˜**ğŸ¤µæ¥æ”¶ç‰©å“ï¼Œé˜…è¯»**å¤‡æ³¨**ğŸ“å¹¶ä¾›åº”**å·¥ä½œå° X** ä¸Šçš„ç‰©å“ã€‚**

## ****é€šè¿‡ä»£ç **è¡¨ç¤ºé¤å…åŠŸèƒ½**

**ä»¥ä¸‹åŠŸèƒ½è´Ÿè´£å®Œæˆæ¯ä¸ªè®¢å•ã€‚**

> *****prepareItem(itemNameï¼Œcallback)*** :è¯¥å‡½æ•°å–ä¸€ä¸ª***itemName****ğŸ”*å’Œ**å›è°ƒ**å’Œ*ğŸ“*ä½œä¸ºå‚æ•°ã€‚ä½¿ç”¨**è®¾ç½®è¶…æ—¶**å’Œ*æ¨¡æ‹Ÿå‡†å¤‡ç‰©å“â°*åœ¨æŒ‡å®šçš„**è¶…æ—¶** *åè§¦å‘çš„ APIâ³*(å‡†å¤‡æ—¶é—´)ã€‚ä½¿ç”¨ ***é¡¹ç›®åç§°*** é€‰æ‹©å‡†å¤‡æ—¶é—´ï¼Œå¹¶æ ¹æ®å‡†å¤‡æ—¶é—´è®¾ç½®è¶…æ—¶ã€‚ä¸€æ—¦**è¶…æ—¶**â°è§¦å‘ï¼Œå®ƒè°ƒç”¨ä¼ å…¥çš„å›è°ƒå‡½æ•°ã€‚**

```
function prepareItem(itemName, callback){
    Let preparationTime = 0;
    switch(itemName){
        case "coffeeâ˜•": preparationTime = 4000; break;
        case "sodağŸ¥¤": preparationTime = 2000; break;
        case "frenchFriesğŸŸ": preparationTime = 5000; break;
        case "hamburgerğŸ”": preparationTime = 3000; break;
        case "sandwichğŸ¥ª": preparationTime = 6000; break;
        default: preparationTime = 1000;
    }
    setTimeout(()=>{
        console.log(itemName + 'Prepared');
        callback();
    },preparationTime);
}function serveOrder(){
    console.log('Order Served');
}
```

> *****serveOrder()*:**è¯¥åŠŸèƒ½åœ¨**æ§åˆ¶å°** *ä¸Šæ‰“å°`**'Order Served'**`ğŸ’»*ã€‚ä¸€æ—¦è®¢å•ä¸­çš„é¡¹ç›®å‡†å¤‡å®Œæ¯•ï¼Œå°±åº”è¯¥è°ƒç”¨å®ƒã€‚**

```
function serveOrder(){
    console.log('Order Served');
}
```

****prepareItem()** å‡½æ•°ç°åœ¨å¯ä»¥é€šè¿‡ä¼ é€’`**"coffee**â˜•"`ä½œä¸º **itemName** å’Œ **serveOrder()** æ–¹æ³•ä½œä¸º**å›è°ƒæ¥è°ƒç”¨(æ³¨æ„**ğŸ“ **)****

```
prepareItem("coffeeâ˜•", serveOrder);
```

**è¿™ä¸ªå‡½æ•°è°ƒç”¨å¯ä»¥åŒ…è£…åœ¨ä¸€ä¸ª **submitOrder()** å‡½æ•°ä¸­ï¼Œä»¥å®ç°æ›´å¥½çš„æ¨¡å—åŒ–ã€‚**

```
function submitOrder(){
    prepareItem("coffeeâ˜•", serveOrder);
}
submitOrder();
```

**è¿™å¾ˆå¥½ï¼Œä½†è¿˜ä¸å¤ŸğŸ¤¨ã€‚å¦‚æœå®¢æˆ·çš„è®¢å•åŒ…å«**ä¸‰ä¸ªç›¸å…³é¡¹ç›®ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ****

```
**["hamburger**ğŸ”**", "frenchFries**ğŸŸ**", "soda**ğŸ¥¤**"]**
```

**è¿™ä¸‰é¡¹ä¸­çš„ä»»ä½•ä¸€é¡¹ï¼Œå¦‚æœåˆ†å¼€ä¸Šï¼Œéƒ½æ˜¯æ²¡æœ‰ç”¨çš„ã€‚éœ€è¦ä¸€èµ·ä¸Šã€‚è¿™å¯¼è‡´äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ğŸ™„ã€‚**

**å¦‚æœ**æœåŠ¡å‘˜**ğŸ¤µå°†æ‰€æœ‰ä¸‰ä¸ªé¡¹ç›®çš„è®¢å•æ”¾åœ¨ä¸€èµ·ï¼Œ **submitOrder()** å‡½æ•°å¦‚ä¸‹æ‰€ç¤º:**

```
function submitOrder(){
    prepareItem(**"**hamburgerğŸ”**"**, serveOrder);
    prepareItem("frenchFriesğŸŸ", serveOrder);
    prepareItem("sodağŸ¥¤", serveOrder);
}
submitOrder();
```

**è¿™ä¸ä¼šäº§ç”Ÿé¢„æœŸçš„ç»“æœğŸ˜•å› ä¸ºè¿™äº›é¡¹ç›®å¯èƒ½ä¼šæ— åºåˆ°è¾¾ã€‚**

## **åµŒå¥—å›è°ƒ**

**å¦‚æœä½¿ç”¨**åµŒå¥—å›è°ƒ** `ğŸ“ğŸ“ğŸ“`å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚**

****æœåŠ¡å‘˜**ğŸ¤µå°†`**"hamburger**ğŸ”**"**`çš„è®¢å•æäº¤ç»™ç›¸åº”çš„**å¨å¸ˆ**ğŸ‘¨â€ğŸ³å¹¶ä¸”ä¼ é€’ä¸€ä¸ª**å›è°ƒ**è¿åŒå®ƒå…·æœ‰ä¸‹é¢çš„**éŸ³ç¬¦**ğŸ“**

```
*** Submit Order for "****frenchFries**ğŸŸ**"**
*** Submit Order for** **"soda**ğŸ¥¤**"**
*** Serve items to table X**
```

**ä¸€æ—¦è®¢å•å®Œæˆï¼Œå¨å¸ˆå°±ä¼šğŸ‘¨â€ğŸ³å°†å…¶æ”¾ç½®åœ¨**ä¼ é€å°ä¸Š**ğŸ½ï¸å’Œå¤–å–ç»ç†ğŸ‘¨â€ğŸ’¼å‘å‡ºä¸€ä¸ª**å‘¼å«**ğŸ“å¯¹äº†**æœåŠ¡å‘˜**ğŸ¤µåƒå¾€å¸¸ä¸€æ ·ã€‚**

****æœåŠ¡å‘˜**ğŸ¤µç§»é™¤**æ³¨é‡Š**ğŸ“åœ¨é¡¶éƒ¨ï¼Œé˜…è¯»å®ƒå¹¶æŒ‰ç…§æç¤ºæäº¤`"**frenchFries**ğŸŸ"`çš„è®¢å•ã€‚`**"hamburger**ğŸ”**"**`ä¸ä¼šç«‹å³äº¤ä»˜ã€‚`"**frenchFries**ğŸŸ"`çš„è®¢å•ä¸å‰©ä½™çš„**å›æ‹¨** **ç¥¨æ®**ä¸€èµ·ä¸‹å•ğŸ“ã€‚**

```
*** Submit Order for** **"soda**ğŸ¥¤**"**
*** Serve items to table X**
```

**ä¸€æ—¦ç¬¬äºŒä¸ªè®¢å•å®Œæˆï¼Œå•†å“åˆ°è¾¾**äº¤ä»˜å°**ğŸ½ï¸ å’ŒæœåŠ¡å‘˜**ğŸ¤µ**æ˜¯å«**å—ğŸ“åˆæ¥äº†ã€‚ç°åœ¨ï¼Œè¿™ä½**ä¾è€…**ğŸ¤µåˆ é™¤**æ³¨é‡Š**ğŸ“åœ¨é¡¶éƒ¨ï¼Œé˜…è¯»å¹¶æäº¤è®¢å•`**"soda**ğŸ¥¤**"**`ã€‚`**"hamburger**ğŸ”**"**` å’Œ`"**frenchFries**ğŸŸ"`å°šæœªäº¤ä»˜ã€‚è¯¥è®¢å•ä¸æœ€åä¸€æ¬¡**å›æ‹¨** **é€šçŸ¥**ä¸€èµ·å‘å‡ºğŸ“ã€‚****

```
***** Serve items to table X****
```

****è®¢å•å®Œæˆåï¼Œå•†å“åˆ°è¾¾**äº¤ä»˜å°**ğŸ½ï¸å’Œé‚£ä¸ª**æœåŠ¡å‘˜**ğŸ¤µ**æ˜¯å«**å—ğŸ“å†ä¸€æ¬¡ã€‚ç°åœ¨ï¼Œ**å›è°ƒ** **æ³¨æ„**ğŸ“è¯´è¦ä¸Šèœã€‚å› æ­¤ï¼Œä»–å°†**æ¡Œå­ X** ä¸Šçš„æ‰€æœ‰é¡¹ç›®ä¸€èµ·ç«¯ä¸Šæ¡Œã€‚****

****ä½¿ç”¨**åµŒå¥—å›è°ƒ**çš„ **submitOrder()** å‡½æ•°å¦‚ä¸‹ã€‚****

```
**function submitOrder(){
    prepareItem(**"**hamburgerğŸ”**"**, ()=>{
        prepareItem("frenchFriesğŸŸ", ()=>{
            prepareItem("sodağŸ¥¤", serveOrder);
        });
    });
}
submitOrder();**
```

****![](img/372abaf435cbe7088bdc7e8279241b0c.png)****

****ä¸Šé¢çš„åºåˆ—å›¾æ˜¾ç¤ºäº†ä¸‰ä¸ªä¸åŒé¡¹ç›®çš„è®¢å•ä¹‹é—´çš„æ—¶é—´å®‰æ’ã€‚****

****è¿™ä¸‰ä¸ªé¡¹ç›®çš„è®¢å•æœ¬èº«æ˜¯ç›¸å½“å‹å€’æ€§çš„ï¼Œå¯¹ä¸å¯¹ï¼ŸğŸ˜…å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤šçš„ä¸œè¥¿ã€‚æœ¬ä¾‹ä¸­çš„ **submitOrder()** å‡½æ•°å¯èƒ½çœ‹èµ·æ¥æœ‰ç‚¹åƒè¿™æ ·ğŸ˜µã€‚****

```
**function submitOrder(){
    prepareItem("coffeeâ˜•", ()=> {
        prepareItem("sodağŸ¥¤", ()=> {
            prepareItem("frenchFriesğŸŸ", ()=> {
                prepareItem("hamburgerğŸ”", ()=> {
                    prepareItem("sandwitchğŸ¥ª", serveOrder);
                });
            });
        });
    });
}
submitOrder();**
```

****è¿™ç§ä»£ç çš„å¯è¯»æ€§åœ¨æ¯æ¬¡åµŒå¥—åéƒ½ä¼šé™ä½ï¼Œå¹¶ä¸”å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚è¿™ç§ä»£ç é€šå¸¸è¢«ç§°ä¸º**â€˜å›è°ƒåœ°ç‹±â€™**ğŸ‘¹ã€‚****

# ******æ‰¿è¯º******

****ES6 ç‰ˆ JavaScript æ¨å‡º [**æ‰¿è¯º**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) ğŸ¤æ¥å¤„ç†è¿™æ ·çš„é—®é¢˜ã€‚ä¸€ä¸ª**æ‰¿è¯º**æ˜¯ä¸€ä¸ª**å¯¹è±¡**ï¼Œä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„**æœ€ç»ˆå®Œæˆæˆ–å¤±è´¥**ã€‚****

****ä¸€è¾¹ç”¨**è®¸è¯º**ï¼Œä¸€è¾¹ç”¨**æ‹›å¾…**ğŸ¤µå¾—åˆ°ä¸€ä¸ª**æ‰¿è¯º**ğŸ¤ä¸‹å•æ—¶å›é€€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å›å«é€šçŸ¥è¢«ä¼ é€’åˆ°å¨æˆ¿ã€‚**æœåŠ¡å‘˜**ğŸ¤µç„¶åé™„ä¸Šä¸€å¼ **çš„å­—æ¡**ğŸ“ä¹Ÿå°±æ˜¯è¯´ï¼Œ ***æ‰¿è¯ºè§£å†³åéœ€è¦åšä»€ä¹ˆ*** ï¼Œåˆ°**æ‰¿è¯º**ğŸ¤ä¸€ç›´è—åœ¨å¿ƒé‡Œã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œé™„åŠ çš„æ³¨é‡Šå°†æ˜¯:****

```
***** Serve item to table X****
```

****å½“è®¢å•å‡†å¤‡å¥½äº†ï¼Œå¨å¸ˆ**ğŸ‘¨â€ğŸ³å°†å…¶æ”¾ç½®åœ¨**äº¤ä»˜å°**ğŸ½ï¸è¿åŒ`**'Promise Resolved** âœ…'`æ¶ˆæ¯ã€‚******

****å¤–å–ç»ç†**ğŸ‘¨â€ğŸ’¼ç„¶åæŠŠè®¢å•äº¤ç»™**æœåŠ¡å‘˜**ğŸ¤µã€‚ç„¶åä»–æ‰¾åˆ°åŒ¹é…çš„**æ‰¿è¯º**ğŸ¤ä»ä»–é‚£å¥—**çš„æ‰¿è¯º**ä¸­ï¼Œè¯»å‡ºäº†é™„åœ¨åé¢çš„**æ³¨é‡Š**ğŸ“å¹¶ä¾›åº”**å·¥ä½œå° X** ä¸Šçš„ç‰©å“ã€‚**

## ****æ‰¿è¯ºä»£ç å®ç°****

**æˆ‘ä»¬å¯ä»¥é‡å†™ **prepareItem()** å‡½æ•°æ¥è¿”å›ä¸€ä¸ª**æ‰¿è¯º**ğŸ¤å¦‚ä¸‹ã€‚**

```
function prepareItem(item){
    let preparationTime = 0;
    switch(item){
        case "coffeeâ˜•": preparationTime = 4000; break;
        case "sodağŸ¥¤": preparationTime = 2000; break;
        case "frenchFriesğŸŸ": preparationTime = 5000; break;
        case "hamburgerğŸ”": preparationTime = 3000; break;
        case "sandwichğŸ¥ª": preparationTime = 6000; break;
        default: preparationTime = 1000;
    }
    return new **Promise**((resolve, reject) => {
        setTimeout(()=>{
            console.log(item + 'Prepared');
            resolve();
        },preparationTime);
    });
}
```

**è¯¥å‡½æ•°ä¸å†å°†ä¸€ä¸ª**å›è°ƒ**å‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„**æ‰¿è¯ºå¯¹è±¡**ã€‚è¯¥æ‰¿è¯ºé‡‡ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè®©**è§£å†³** âœ…å’Œ**æ‹’ç»** âŒä½œä¸ºå‚æ•°ã€‚å¦‚æœæ“ä½œ ***æˆåŠŸ*** æˆ–è€…æœ‰ ***é”™è¯¯*** æˆ‘ä»¬å¯ä»¥è°ƒç”¨ **resolve()** è€Œä¸æ˜¯è°ƒç”¨å›è°ƒå‡½æ•°ã€‚**

**ä½¿ç”¨ä¸Šé¢çš„ **prepareItem()** å®ç°ï¼Œå•ä¸ªé¡¹ç›®çš„ **submitOrder()** å‡½æ•°å¯ä»¥ç¼–å†™å¦‚ä¸‹ã€‚**

```
function submitOrder(){
    let res = prepareItem("coffeeâ˜•");
    res.then(serveOrder);
}
submitOrder();
```

**![](img/156a1ac41cd9d8f37f71546fafc8fb25.png)**

**Callbacks vs Promises**

## ****æ‰¿è¯ºé“¾æ¥:****

****æ‰¿è¯ºé“¾æ¥** `ğŸ¤ğŸ”—ğŸ¤ğŸ”—ğŸ¤` æ˜¯è§£å†³åµŒå¥—å›è°ƒå¯¼è‡´çš„å›è°ƒåœ°ç‹±æƒ…å†µã€‚**

**promise å“åº”ä¸Šçš„' **then()** 'è°ƒç”¨å°†å‡½æ•°ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°å¯èƒ½è¿”å›å¦ä¸€ä¸ª**æ‰¿è¯º**ğŸ¤ã€‚è¿™ä¸ªæ–°**æ‰¿è¯ºçš„å›åº”**ğŸ¤å¯ä»¥é€šè¿‡[é“¾æ¥](https://www.tutorialspoint.com/what-is-function-chaining-in-javascript) â›“' **ç„¶å()**è°ƒç”¨æ¥è®¿é—®ã€‚**

**ä½¿ç”¨æ‰¿è¯ºåºåˆ—çš„ **submitOrder()** å‡½æ•°å¯ä»¥æ˜¯è¿™æ ·çš„:**

```
function submitOrder() {
    let res1 = prepareItem("hamburgerğŸ”");
    let res2 = res1.then(() => {
        return prepareItem("frenchFriesğŸŸ");
    });
    let res3 = res2.then(() => {
        return prepareItem("sodağŸ¥¤"); 
    });
    res3.then(serveOrder);
}
submitOrder();
```

**è¿™å¯ä»¥é€šè¿‡åˆ é™¤**å›è½¦**å…³é”®å­—è¿›ä¸€æ­¥ç®€åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤º:**

```
function submitOrder() {
    let res1 = prepareItem("hamburgerğŸ”");
    let res2 = res1.then(() => prepareItem("frenchFriesğŸŸ"));
    let res3 = res2.then(() => prepareItem("sodağŸ¥¤"));
    res3.then(serveOrder);
}
submitOrder();
```

**å¯¹å•ç‹¬å“åº”å˜é‡çš„èµ‹å€¼å¯ä»¥é€šè¿‡**é“¾æ¥**â›“'**then()ã€t48]'è°ƒç”¨æ¥ç§»é™¤ï¼Œå¦‚ä¸‹æ‰€ç¤º:****

```
function submitOrder() {
    prepareItem("hamburgerğŸ”")
        .then(() => prepareItem("frenchFriesğŸŸ"))
        .then(() => prepareItem("sodağŸ¥¤"))
        .then(serveOrder);
}
submitOrder();
```

**è¿™çœ‹èµ·æ¥æ¯”ä½¿ç”¨åµŒå¥—å›è°ƒæ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚**

**![](img/bc60013badc4fee11b94cdae3fbd0ad1.png)**

**Sequence diagram for Promise chaining**

**å½“è®¢å•ä¸­æœ‰æ›´å¤šé¡¹ç›®æ—¶ï¼Œ **submitOrder()** å‡½æ•°å¯èƒ½å¦‚ä¸‹æ‰€ç¤º:**

```
function submitOrder(){
    prepareItem("coffeeâ˜•")
        .then(() => prepareItem("sodağŸ¥¤"))
        .then(() => prepareItem("frenchFriesğŸŸ"))
        .then(() => prepareItem("hamburgerğŸ”"))
        .then(() => prepareItem("sandwichğŸ¥ª"))
        .then(serveOrder);
}
submitOrder();
```

# ****å¼‚æ­¥/ç­‰å¾…****

**JavaScript åœ¨ 2017 å¹´åŠ å…¥äº† [**async/await**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function) è¯­æ³•ã€‚è¿™åŸºæœ¬ä¸Šå°±æ˜¯**å¥æ³•ç³–**ğŸšå¯¹äº**çš„æ‰¿è¯º**ğŸ¤è¿™ä½¿å¾—å¼‚æ­¥ä»£ç çœ‹èµ·æ¥æ›´æœ‰é¡ºåº**å’Œä½¿å¾—ä»£ç æ›´å®¹æ˜“é˜…è¯»ã€‚****

******submitOrder()** å‡½æ•°å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ **async/await** è¯­æ³•ç¼–å†™:****

```
**async function submitOrder(){
    await prepareItem("coffeeâ˜•");
    await prepareItem("sodağŸ¥¤");
    await prepareItem("frenchFriesğŸŸ");
    await prepareItem("hamburgerğŸ”");
    await prepareItem("sandwichğŸ¥ª");
    completeOrder();
}
submitOrder();**
```

****éœ€è¦å°†**ç­‰å¾…**è°ƒç”¨åŒ…è£…åœ¨ä¸€ä¸ª**å¼‚æ­¥**å‡½æ•°ä¸­ã€‚æ‰€ä»¥ï¼Œ **submitOrder()** å‡½æ•°ç°åœ¨è¢«æ ‡è®°ä¸º **async** ã€‚è¿™å¯ä»¥åƒä»»ä½•å…¶ä»–å‡½æ•°ä¸€æ ·è°ƒç”¨ã€‚****

****ä»£ç ç°åœ¨çœ‹èµ·æ¥æ›´åŠ æ¸…æ™°æ˜“è¯»ã€‚å®ƒçœ‹èµ·æ¥æ˜¯è¿ç»­çš„ï¼Œä½†å®é™…ä¸Šæ˜¯å¯¹æ‰¿è¯ºçš„æŠ½è±¡ã€‚****

# ******ç»“è®º******

****æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬çœ‹äº†å¦‚ä½•åœ¨ä¸€å®¶**é¤é¦†**çš„å·¥ä½œä¸­å»ºæ¨¡ JavaScript çš„**å¼‚æ­¥**è¡Œä¸ºğŸ¤µğŸ‘¨â€ğŸ³ğŸ‘¨â€ğŸ’¼ğŸ½ï¸.ç„¶åï¼Œæˆ‘ä»¬ä»¥é¤é¦†ä»£ç ä¸ºä¾‹ï¼Œç ”ç©¶äº† JavaScript ç”¨æ¥å»ºæ¨¡è¿™ç§å¼‚æ­¥è¡Œä¸ºçš„ä¸åŒæ–¹æ³•ã€‚****

****æˆ‘ä»¬ç”¨é¤é¦†çš„ä¾‹å­æ¥è¯´æ˜åŸºäº**å›è®¿**çš„æ–¹æ³•å’ŒåŸºäº**æ‰¿è¯º**çš„æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«ã€‚æˆ‘ä»¬è¿˜æåˆ°äº†å¦‚ä½•å°†åŸºäºæ‰¿è¯ºçš„ä»£ç è½¬æ¢æˆ **async/await** è¯­æ³•ã€‚****

*****æ›´å¤šå†…å®¹è¯·çœ‹* [***è¯´ç™½äº†å°±æ˜¯***](http://plainenglish.io/) *ã€‚æŠ¥åå‚åŠ æˆ‘ä»¬çš„* [***å…è´¹å‘¨æŠ¥åœ¨è¿™é‡Œ***](http://newsletter.plainenglish.io/) ***ã€‚*******