<html>
<head>
<title>Weakmap in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScriptä¸­çš„Weakmap</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/weakmap-in-javascript-d575b14f872b?source=collection_archive---------14-----------------------#2021-08-26">https://javascript.plainenglish.io/weakmap-in-javascript-d575b14f872b?source=collection_archive---------14-----------------------#2021-08-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/ea3fe0d9dcf6dd9775f623d4a355a074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-WIX3Q-ss8qeR3Qn.jpg"/></div></div></figure><div class=""/><div class=""><h2 id="b695" class="pw-subtitle-paragraph jv ix iy bd b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km dk translated">ç†è§£å¼±å¼•ç”¨å’Œå¼ºå¼•ç”¨çš„åŒºåˆ«ï¼Œè®°ä½æˆ‘ä»¬çš„åƒåœ¾æ”¶é›†å™¨ï¼</h2></div><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="817a" class="kw kx iy ks b gy ky kz l la lb">let obj = { name: â€˜totoâ€™ }</span><span id="f3ec" class="kw kx iy ks b gy lc kz l la lb">// The object { name: â€˜totoâ€™ } can be accessed<br/>// since obj has the reference to it</span><span id="1cc1" class="kw kx iy ks b gy lc kz l la lb">// overwrite the reference<br/>obj = null</span><span id="5538" class="kw kx iy ks b gy lc kz l la lb">// the object will be removed from the memory<br/>// since we have lost all reference on it</span></pre><p id="a7d5" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">å¦ä¸€ä¸ªä¾‹å­ï¼Œ</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="839b" class="kw kx iy ks b gy ky kz l la lb">let obj = { name: â€˜totoâ€™ }<br/>let arr = [ obj ]</span><span id="3950" class="kw kx iy ks b gy lc kz l la lb">obj = null</span></pre><p id="8d22" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">åœ¨æœ¬ä¾‹ä¸­ï¼Œå¯¹è±¡`{ name: 'toto' } 'ä¸ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºæ•°ç»„ä¿ç•™äº†å¯¹å®ƒçš„å¼•ç”¨ï¼</p><h2 id="e2d4" class="kw kx iy bd lz ma mb dn mc md me dp mf lm mg mh mi lq mj mk ml lu mm mn mo mp bi translated">å¼ºå¼•ç”¨å’Œå¼±å¼•ç”¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p id="f3b6" class="pw-post-body-paragraph ld le iy lf b lg mq jz li lj mr kc ll lm ms lo lp lq mt ls lt lu mu lw lx ly ig bi translated">äº‹å®ä¸Šï¼ŒJavaScriptä¸­çš„å¤§å¤šæ•°å˜é‡éƒ½ä¿ç•™äº†å¯¹ä¸€ä¸ªå¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢çš„æ•°ç»„ä¿å­˜äº†ä¸€ä¸ªå¯¹å¯¹è±¡<strong class="lf iz"> ({ name: 'toto' }) </strong>çš„<strong class="lf iz">å¼º</strong>å¼•ç”¨ã€‚</p><p id="dee1" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">å¦‚æœä»»ä½•å˜é‡ä¿æŒä¸€ä¸ªå¯¹è¯¥å¯¹è±¡çš„<strong class="lf iz">å¼ºå¼•ç”¨</strong>ï¼Œè¯¥å¯¹è±¡å°†ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨ç§»é™¤ã€‚ä½†æ˜¯å¦‚æœåªæœ‰å˜é‡ä¿æŒå¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œå®ƒå°†è¢«åƒåœ¾æ”¶é›†å™¨åˆ é™¤ã€‚</p><p id="1458" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ä¸€äº›å˜é‡ç±»å‹å¯¹ä¸€ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼±å¼•ç”¨ï¼Œè¿™å°±æ˜¯Weakmapçš„æƒ…å†µã€‚</p><h2 id="fb53" class="kw kx iy bd lz ma mb dn mc md me dp mf lm mg mh mi lq mj mk ml lu mm mn mo mp bi translated">Weakmap</h2><p id="01b7" class="pw-post-body-paragraph ld le iy lf b lg mq jz li lj mr kc ll lm ms lo lp lq mt ls lt lu mu lw lx ly ig bi translated">weakmapæ˜¯ä¸€ä¸ªé¢å¤–çš„æ•°æ®å­˜å‚¨ï¼Œå®ƒå¯ä»¥å…è®¸æˆ‘ä»¬ä»å¤–éƒ¨æ‰©å±•ä¸€ä¸ªå¯¹è±¡(ç¬¬ä¸‰æ–¹åº“)æˆ–å¯†å°å¯¹è±¡ï¼Œè€Œä¸éœ€è¦æ¨æ–­åƒåœ¾æ”¶é›†å™¨ï¼æˆ–è€…èªæ˜åœ°åˆ›å»ºä¸€ä¸ªç¼“å­˜åŠŸèƒ½ï¼</p><p id="3f05" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">åˆ«æ…Œï¼Œæˆ‘ä¼šè§£é‡Šç»™ä½ çœ‹è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼åœ¨æˆ‘ä»¬æ¯”è¾ƒmapå’Œweakmapä¹‹å‰ã€‚</p><h2 id="cf35" class="kw kx iy bd lz ma mb dn mc md me dp mf lm mg mh mi lq mj mk ml lu mm mn mo mp bi translated">åœ°å›¾å¯¹åœ°å›¾</h2><p id="d270" class="pw-post-body-paragraph ld le iy lf b lg mq jz li lj mr kc ll lm ms lo lp lq mt ls lt lu mu lw lx ly ig bi translated">ä½¿ç”¨mapï¼Œå¯¹è±¡å ç”¨å†…å­˜ï¼Œå¯èƒ½ä¸ä¼šè¢«åƒåœ¾æ”¶é›†ã€‚æ˜ å°„æœ‰ä¸€ä¸ªå¯¹å¯¹è±¡çš„å¼ºå¼•ç”¨ã€‚</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="3c50" class="kw kx iy ks b gy ky kz l la lb">let obj = { name: â€˜totoâ€™ }<br/>let mapObj = new Map()<br/>mapObj.set(obj, â€˜any valueâ€™)</span><span id="1e48" class="kw kx iy ks b gy lc kz l la lb">obj = null<br/>mapObj.size() // 1</span></pre><p id="9f24" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">Weakmapå®Œå…¨ä¸åŒï¼Œå®ƒä¸é˜»æ­¢å…³é”®å¯¹è±¡çš„åƒåœ¾æ”¶é›†ã€‚</p><p id="ab49" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ç¬¬ä¸€æ¡è§„åˆ™: weakmapåªæ¥å—â€œobject as key â€;<strong class="lf iz">å…¶æ¬¡</strong>ï¼Œå®ƒåªä¿ç•™å¯¹å¯¹è±¡çš„å¼±å¼•ç”¨ã€‚</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="96e0" class="kw kx iy ks b gy ky kz l la lb">let obj = { name: â€˜totoâ€™ }<br/>let weakmapObj = new WeakMap()<br/>weakmapObj.set(obj, â€˜any valueâ€™)</span><span id="1063" class="kw kx iy ks b gy lc kz l la lb">obj = null<br/>weakmapObj .size() // 0</span></pre><p id="ee21" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">è¯¥å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨ç§»é™¤ï¼Œå› ä¸ºweakmapåªæœ‰ä¸€ä¸ªå¯¹å¯¹è±¡*{ name: 'toto' }*çš„<strong class="lf iz">å¼±å¼•ç”¨</strong>ï¼Œå¹¶ä¸”è¯¥å¯¹è±¡ä¸å†æœ‰å¼ºå¼•ç”¨(åªæœ‰å˜é‡objä¿ç•™äº†å¯¹å®ƒçš„å¼•ç”¨)ã€‚</p><h2 id="dfd8" class="kw kx iy bd lz ma mb dn mc md me dp mf lm mg mh mi lq mj mk ml lu mm mn mo mp bi translated">ä»€ä¹ˆæ—¶å€™ç”¨è¿™ä¸ªï¼Ÿ</h2><p id="f69e" class="pw-post-body-paragraph ld le iy lf b lg mq jz li lj mr kc ll lm ms lo lp lq mt ls lt lu mu lw lx ly ig bi translated">å¦‚ä½ æ‰€è§ï¼ŒWeakmapå¾ˆå¼º(æ²¡é”™ï¼Œæ˜¯ä¸ªç©ç¬‘)ä½†ä¸æ˜¯æ¯æ¬¡éƒ½èƒ½ç”¨ã€‚åªèƒ½åœ¨å°‘æ•°æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p><p id="505f" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated"><strong class="lf iz">ç¼“å­˜åŠŸèƒ½</strong></p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="45ac" class="kw kx iy ks b gy ky kz l la lb">const cache = new WeakMap()</span><span id="3209" class="kw kx iy ks b gy lc kz l la lb">const process = function (obj) { <br/> // If the input is not already cached <br/> if (!cache.has(obj)) { <br/> // Imagine a function that need a lot of memory/ressource <br/> // We donâ€™t want to re-execute bigOperation function<br/> // if the input is the same ! <br/> const result = bigOperation(obj) <br/> // So we execute the function one time and<br/> // we store the result in cache ! <br/> cache.set(obj, result) <br/> } <br/> return cache.get(obj) <br/>}</span><span id="b10a" class="kw kx iy ks b gy lc kz l la lb">let obj = { /* any object */ } <br/>// first time we donâ€™t have this input as cache, so we will put into <br/>const firstResult = process(obj) <br/>// second time we donâ€™t need to execute the big function, <br/>// just need to exctract the result in cache <br/>const secondeResult = process(obj) <br/>// the original object will be removed from weakmap ! <br/>obj = null <br/></span></pre><p id="5b0d" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">æœ‰äº†åœ°å›¾ï¼Œè¿™ä¸ªç¼“å­˜å‡½æ•°åº”è¯¥æŠŠobjä¿å­˜åœ¨å†…å­˜ä¸­ã€‚å®ƒä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼</p><p id="ed04" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">å½“æˆ‘ä»¬ä¿å­˜ä¸€ä¸ªå¯¹æœªä½¿ç”¨å¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œå°±ä¼šäº§ç”Ÿå†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥å¦‚æœä½ ä¸å†ä½¿ç”¨ä»»ä½•å¯¹è±¡ï¼Œå°±åˆ é™¤å¯¹å®ƒçš„ä»»ä½•å˜é‡å¼•ç”¨ï¼</p><p id="1b76" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">âš ï¸æˆ‘ä»¬ä¸èƒ½ç”¨<em class="mv">ã€‚keys() /ã€‚values() /ã€‚å› ä¸ºæˆ‘ä»¬ä¸çŸ¥é“åƒåœ¾æ”¶é›†å™¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ é™¤å¯¹è±¡ï¼</em></p><p id="eed6" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated"><strong class="lf iz">æœ€åä¸€ä¸ªä¾‹å­</strong></p><p id="35f5" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">æ— å†…å­˜æ³„æ¼çš„åŠ¨æ€è®¿é—®è®¡æ•°å™¨</p><pre class="kn ko kp kq gt kr ks kt ku aw kv bi"><span id="a052" class="kw kx iy ks b gy ky kz l la lb">// Counter of visits<br/>let visitsCountMap = new WeakMap()</span><span id="5118" class="kw kx iy ks b gy lc kz l la lb">// increase the visits count<br/>function countUser(user) {<br/> const count = visitsCountMap.get(user) || 0<br/> visitsCountMap.set(user, count + 1)<br/>}</span><span id="491f" class="kw kx iy ks b gy lc kz l la lb">let toto = { name: â€œtotoâ€ }</span><span id="4a5d" class="kw kx iy ks b gy lc kz l la lb">countUser(toto) // count his visits</span><span id="f3ac" class="kw kx iy ks b gy lc kz l la lb">// later toto leaves us<br/>toto = null<br/></span></pre><p id="663f" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated"><em class="mv">æ³¨:æœ¬æ–‡çµæ„Ÿæ¥è‡ª</em><a class="ae mw" href="https://javascript.info/weakmap-weakset*" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://javascript.info/weakmap-weakset</em></a></p></div><div class="ab cl mx my hr mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ig ih ii ij ik"><p id="e45d" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">å¸Œæœ›ä½ å–œæ¬¢è¿™ç¯‡è¯»ç‰©ï¼</p><p id="fcd9" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ğŸå¦‚æœä½ åœ¨<a class="ae mw" href="https://twitter.com/code__oz" rel="noopener ugc nofollow" target="_blank">æ¨ç‰¹</a>ä¸Šå…³æ³¨æˆ‘å¹¶ç»™æˆ‘æ‰“ç”µè¯ï¼Œä½ å¯ä»¥å…è´¹å¾—åˆ°æˆ‘çš„æ–°ä¹¦<strong class="lf iz">è¢«ä½ä¼°çš„javascriptæŠ€èƒ½ï¼Œæ”¹å˜ç°çŠ¶</strong>ğŸ˜</p><p id="b86a" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">æˆ–è€…å¾—åˆ°å®ƒ<a class="ae mw" href="https://codeoz.gumroad.com/l/RXLYp" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a></p><p id="012d" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ğŸ<a class="ae mw" href="https://www.getrevue.co/profile/code__oz" rel="noopener ugc nofollow" target="_blank">æˆ‘çš„ç®€è®¯</a></p><p id="e764" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">â˜•ï¸ä½ å¯ä»¥<a class="ae mw" href="https://www.buymeacoffee.com/CodeoZ" rel="noopener ugc nofollow" target="_blank">æ”¯æŒæˆ‘çš„ä½œå“</a>ğŸ™</p><p id="f563" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ğŸƒâ€â™‚ï¸ï¼Œä½ å¯ä»¥è·Ÿç€æˆ‘ğŸ‘‡</p><p id="6e07" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ğŸ•Š <a class="ae mw" href="https://twitter.com/code__oz" rel="noopener ugc nofollow" target="_blank">æ¨ç‰¹</a></p><p id="aaed" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ğŸ‘¨â€ğŸ’»<a class="ae mw" href="https://github.com/Code-Oz" rel="noopener ugc nofollow" target="_blank"> Github </a></p><p id="977d" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated">ä½ å¯ä»¥æ ‡è®°ğŸ”–è¿™ç¯‡æ–‡ç« ï¼</p><p id="9ce6" class="pw-post-body-paragraph ld le iy lf b lg lh jz li lj lk kc ll lm ln lo lp lq lr ls lt lu lv lw lx ly ig bi translated"><em class="mv">æ›´å¤šå†…å®¹çœ‹</em> <a class="ae mw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="lf iz"> <em class="mv">è¯´ç™½äº†. io </em> </strong> </a></p></div></div>    
</body>
</html>