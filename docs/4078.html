<html>
<head>
<title>How to Run a Python Script using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js运行Python脚本</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-run-python-script-using-node-js-6b351169e916?source=collection_archive---------0-----------------------#2021-08-14">https://javascript.plainenglish.io/how-to-run-python-script-using-node-js-6b351169e916?source=collection_archive---------0-----------------------#2021-08-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="240c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">文章末尾提供了完整的代码</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8a065db64c65df4145cff3e0e024b3e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vQlTUP2eDYU9j8Zy"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c369" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有一天，你想出了一个绝妙的主意，在你的项目中使用了很酷的Python库。但是您不知道如何将它与您现有的Node.js服务器集成。别担心！今天，我将向您展示如何轻松地从Node.js中读取Python脚本，并为您提供一步一步的实现指南，以便您可以将时间节省下来，用于以后更重要的任务。</p><p id="5e64" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了简单起见，我将使用<a class="ae ks" href="http://glitch.com" rel="noopener ugc nofollow" target="_blank"> Glitch </a>来演示如何让它工作，但是您可以随意将其应用到您喜欢的其他平台上！</p><p id="7bc2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们需要创建一个<strong class="kv io"> server.js </strong>文件作为我们应用程序的服务器。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lp"><img src="../Images/b368f63a4e7710a450124b27f1115ed5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ApGnb_Kl7wkSgA1O9JasIg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Your server.js file</figcaption></figure><p id="faa6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里的想法很简单，你使用<strong class="kv io">子进程</strong>和<strong class="kv io"> spawn() </strong>从Node.js调用你的<strong class="kv io"> Python脚本</strong>(不需要事先知道它们是什么)。然后Node.js将<strong class="kv io">存储Python脚本</strong>的输出，之后你可以对变量做任何你想做的事情。因此，当表单在客户端提交时，我们需要添加一个新的POST方法来运行Python脚本:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lq"><img src="../Images/fa67c11e705f3a8351fa5ef0367ac68e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4tb-CN6WsWxZrkfdW00og.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Add a new POST method to read Python script</figcaption></figure><p id="4ee8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里有一些你需要知道的<strong class="kv io">流程</strong>:</p><ol class=""><li id="0403" class="lr ls in kv b kw kx kz la lc lt lg lu lk lv lo lw lx ly lz bi translated">在变量<code class="fe ma mb mc md b">python</code>的声明中，<code class="fe ma mb mc md b">'python3'</code>是在python脚本中运行库所需的python版本<strong class="kv io">。<code class="fe ma mb mc md b">python</code>常，足矣。然而，如果错误发生:<code class="fe ma mb mc md b">cannot import [your libraries]</code>即使你已经安装了它们，那么你应该考虑使用<code class="fe ma mb mc md b">python3</code>和<strong class="kv io">使用<code class="fe ma mb mc md b">pip3</code>重新安装你的库</strong>。</strong></li><li id="d58c" class="lr ls in kv b kw me kz mf lc mg lg mh lk mi lo lw lx ly lz bi translated"><code class="fe ma mb mc md b">stderr</code>将<strong class="kv io">把你的Python脚本</strong>(如果存在)的错误返回到你的控制台，这样你就可以在进入下一部分之前修复它们。</li></ol><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/069f50ed4bd4472381632ffff720f004.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*tsXwQ6tiSh0xcXNepg47wA.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">An example of stderr error</figcaption></figure><p id="2593" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">3.当您的<strong class="kv io"> script.py成功运行并且没有错误</strong>时，您的Python脚本的输出将存储在变量<code class="fe ma mb mc md b">dataToSend</code>中，服务器将返回行<code class="fe ma mb mc md b">child process exited with code 0</code>。然后，<strong class="kv io">你可以使用Node.js </strong>中的输出变量做任何你想做的事情。</p><p id="ca81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，假设您有一个脚本文件<strong class="kv io">将Hello World打印到控制台。</strong></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mk"><img src="../Images/43e3900d33e8ea64312fa37c0b4bf012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHrODDNVhHk1VYvRPNdEOQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Your script.py code</figcaption></figure><p id="123a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意<strong class="kv io"> sys是允许Python从Node.js服务器读取参数</strong>的模块，在接下来的例子中，我们将<strong class="kv io">将参数从服务器传递给Python </strong>。如果没有发生错误，在使用Node.js: <code class="fe ma mb mc md b">child process exited with code 0, Hello World!</code>运行script.py之后，您将从控制台收到这条消息。</p><p id="93cb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，让我们看看如何从我们的服务器向script.py 传递一个或多个参数。只需简单地<strong class="kv io">在server.js中的脚本路径</strong>旁边添加一些新变量，Python就会自动理解这些参数，并使用<code class="fe ma mb mc md b">sys.argv[<em class="ml">your_index</em>]</code>按顺序读取它们(这就是为什么我们需要提前<code class="fe ma mb mc md b">import sys</code>)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lq"><img src="../Images/6ee369baaa868d7555b9b7c9d953fa80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sa50uMzV-M2S1ZN4_bbyFg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Update your server.js</figcaption></figure><p id="3d2e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，假设我们想说“Hello”+这个人的名字作为Node.js服务器的参数。我们将编辑Python源代码，如下所示:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/9391124ff83e9f721d78f286ac14044c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYOcqDL-_L6HsEYLUgpIfA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Your new script.py</figcaption></figure><p id="0cfa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是我们成功运行代码后会得到的结果:<code class="fe ma mb mc md b">child process exited with code 0, Hello Duyen!</code>。</p><p id="da92" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">恭喜，您已经学会了如何将Node.js中的参数传递给Python文件。您可以添加更多的参数并增加<code class="fe ma mb mc md b">sys.argv[]</code>的索引来获得新的值。</p><p id="2394" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我将向您展示<strong class="kv io">一个没有人告诉过您的小技巧</strong>，以便您的Node.js文件只读取Python代码的必要部分，而不是整个文件。这个技巧就是……<strong class="kv io">从你的服务器调用函数作为参数！</strong></p><p id="2442" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设你想用三种不同的方式问候一个人，而不仅仅是说“你好”。为此，只需为每种问候方式创建一个函数，然后<strong class="kv io">将一个函数的名称作为第一个参数</strong>传递给服务器。通过使用这种方法，<strong class="kv io">您不需要创建多个Python文件</strong>和不同的POST方法来获取您的web应用程序所需的值。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/36748b21d47576fff2d69dbf96d829cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y9pxOJqtNgqg7Cat2UKiyQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create functions in your script.py</figcaption></figure><p id="92d2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如你所见，当我们现在从server.js调用script.py时，它只会运行你从Node.js作为第一个参数传递的函数，因此，这个方法<strong class="kv io">会帮助你更好地组织你的Python脚本</strong>并且<strong class="kv io">只使用你需要的资源！</strong></p><p id="4eac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，您需要做的最后一件事是<strong class="kv io">将server.js </strong>中变量<strong class="kv io"> python的声明</strong>更改为:</p><p id="1b3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe ma mb mc md b">const python = spawn('python3', ['public/script.py', 'welcome', 'Duyen']);</code></p><p id="8d64" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">就是这样！</strong></p><p id="b0eb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你做得很好。当程序成功运行时，您将会看到这个输出:<code class="fe ma mb mc md b">child process exited with code 0, Welcome, Duyen!</code>。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mo mp l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Here is the GUI for what we have done above! To access the full code, click the link below.</figcaption></figure><div class="mq mr gp gr ms mt"><a href="https://glitch.com/edit/#!/nodewithpython?previewSize=0&amp;attributionHidden=true&amp;sidebarCollapsed=false&amp;path=public%2Findex.html&amp;previewFirst=false" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab fo"><div class="mv ab mw cl cj mx"><h2 class="bd io gy z fp my fr fs mz fu fw im bi translated">小故障</h2><div class="na l"><h3 class="bd b gy z fp my fr fs mz fu fw dk translated">结合自动化部署、即时托管和协作编辑，Glitch让您直接编码，以便您可以…</h3></div><div class="nb l"><p class="bd b dl z fp my fr fs mz fu fw dk translated">glitch.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh km mt"/></div></div></a></div><p id="74e1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你在学习我的教程时有任何问题或者不能修复你的错误，你可以在下面留言直接跟我说。我会尽力帮忙的！</p><p id="31ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">编码快乐，祝你有美好的一天！</p><p id="061d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="ml">更多内容看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="ml">plain English . io</em></strong></a></p></div></div>    
</body>
</html>