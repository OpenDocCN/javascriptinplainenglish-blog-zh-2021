<html>
<head>
<title>Why and when you should use console.error()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么以及何时应该使用console.error()</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-and-when-you-should-use-console-error-58d600b924d0?source=collection_archive---------9-----------------------#2021-01-19">https://javascript.plainenglish.io/why-and-when-you-should-use-console-error-58d600b924d0?source=collection_archive---------9-----------------------#2021-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1704" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以及为什么和什么时候你不应该</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ae01dc8671f0380cb1c3570e3ab75abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3MWZt8yzCL6Onp_19UW3PQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Think about who you’re telling game over — just because the player failed doesn’t mean the game failed. Photo by <a class="ae kv" href="https://unsplash.com/@sigmund?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae kv" href="https://unsplash.com/s/photos/error?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="68c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">几个月前，我在阅读HTTP状态代码时——就像人们不经意间所做的那样——偶然发现了两点:</p><ol class=""><li id="1268" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">返回代码418是“我是茶壶”。这是一个愚人节玩笑——嗯，就像我们这些书呆子能开的玩笑一样。文末我会有链接。</li><li id="9858" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">4xx响应针对客户端导致的故障，而5xx响应针对服务器导致的故障。这些是不同的。</li></ol><p id="b344" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我内心深处知道这一点，但直到我从事一个特定的项目，我才意识到这种区别背后的智慧，以及它为什么重要。<strong class="ky ir">错误处理</strong> —开发和工程的区别— <strong class="ky ir">需要理解所有参与者在系统中扮演的角色。</strong>不同的错误原因需要不同的处理，包括记录警告和错误。</p><p id="52d7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你读过“停止使用console.log！”文章，那么就把这个当做第二步。在工程中，不在于知道方法是否存在——ide会为您做到这一点——而在于知道何时使用它们。</p><h2 id="b7f5" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">你的系统里有哪些演员？</h2><p id="a4d6" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">在工作中，我正在构建一个webhook通知系统，这样第三方就可以收到关于产品内部发生的事件的通知。我用它作为一个例子，因为它有许多演员，不同类型的互动，也因为它是我的首选。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8155529d101a1d5ed82e99bfff146f3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*5cAcMd8QBVvfZeWVuq9Msg.png"/></div></figure><p id="fda6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生产者将事件推送到我的系统。开发人员和我从事同样的产品。</p><p id="b626" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> API调用者</strong>是扩展我的产品的其他公司编写的第三方应用程序(HTTP客户端)。对我的API的请求是由用户在设置时在其应用程序中触发的。开发人员从事不同的产品，可能和我在不同的公司工作。</p><p id="ad63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">接收器</strong>是每当我从生产者那里听到一个事件时，从我的系统接收HTTP请求的服务器。在这种情况下，我的系统是HTTP客户端，他们的是HTTP服务器。拥有API调用者的人也拥有接收者。</p><p id="64ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> Webhook系统操作员</strong>是管理和支持系统的人员，他们试图保持系统的更新和可用性。与这些人交流的最常见方式是通过日志，尽管我们也有指标和警报。(我们碰巧实践了DevOps，这意味着开发人员和操作人员在同一个scrum团队——或者，在我们的例子中，是同一批人。)</p><p id="3d55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，我们有<strong class="ky ir">支持团队成员</strong>。他们对帮助API调用者在调用时诊断问题感兴趣。他们也看日志，虽然不是同一个日志。</p><p id="94fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们通过一些错误来说明正确的错误处理。</p><h2 id="4c52" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">API调用程序缺少参数</h2><p id="4c3a" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">当告诉我的系统第三方想要接收事件时，API调用者忘记包含我的系统发布事件的URL。这个错误是API调用者的错误。如你所料，我们返回一个400错误。</p><p id="c3bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们应该记录吗？<strong class="ky ir">是的，因为支持</strong>。API调用者可能会尝试诊断这个400错误，并呼叫支持人员寻求帮助。在这种情况下，日志可能包含更多信息。(出于安全原因，尽量避免在API响应中将堆栈跟踪发送回客户端，因为行号的相关性可能会将包版本泄露给第三方，从而暴露系统中的漏洞)</p><p id="1958" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然支持是我们想要记录的主要原因，我们应该在“信息”处记录。</p><p id="c148" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">旁注:为什么日志级别很重要？</strong></p><p id="5585" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以——也想——配置您的应用程序，以<strong class="ky ir">不同的方式对待不同的日志级别</strong>。例如，我们在开发环境之外禁用调试日志，这对<strong class="ky ir"> PII合规性</strong>很有帮助。我们还有一个系统，如果出现几个“错误”日志，或者出现大量“警告”日志，它会<strong class="ky ir">寻呼</strong> <strong class="ky ir">操作员</strong>(例如，在凌晨3点被电话叫醒)<strong class="ky ir"> </strong>，因此问题可以得到解决。</p><p id="d2dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">横向注释:如何获得不同的日志级别？</strong></p><p id="2010" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Python中，查看核心<code class="fe nf ng nh ni b">logging</code>包；在Java、SLF4J(或任何时下流行的东西——Java中有太多的日志包，我的IDE自动完成功能很混乱)；在Node中，您可以“monkeypatch”控制台对象。您也可以使用一个包，尽管您使用的其他包可能不支持日志包。</p><h2 id="7521" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">API调用方请求失败:无法访问数据库</h2><p id="5896" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">出了问题，只有操作员才能解决。我们希望他们尽快恢复可用性，即使是凌晨3点。他们需要被呼叫。</p><p id="6c20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，我们记录一个错误。</p><p id="06a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我对API的经验法则是<strong class="ky ir">如果你返回一个5xx </strong>(表示服务器错误)，错误级别的<strong class="ky ir">日志。对于事件驱动的系统，如果您因为系统中的某个问题而进入死信队列，错误日志可能是合适的。</strong></p><h2 id="6c3c" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">生成器发送了一个无效事件</h2><p id="96ef" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">这个比较棘手。这是我们产品的错误，但不是我的团队的错误。</p><p id="3cc4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们选择“警告”,因为在我们的情况下，这可能是有人在开发，而不是上游致命错误的结果。此外，在生产者系统上工作的开发人员处于不同的时区——他们的工作发生在我们睡觉的时候——所以我们不想在那个时候被分页。他们可以看到我们的日志，所以他们可以寻找“警告”来调试他们的问题，或者我们可以在双方都方便的时候帮助他们。</p><p id="3d92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们看到大量的“警告”日志，我们仍然会被分页，所以我们仍然会被生产。</p><p id="aec4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为如果这个问题发生在prod中，我们可能能够恢复它，所以我们将它发送到死信队列，以便我们可以在问题解决后赶上进度。</p><h2 id="837e" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">向接收人发送派单时出错</h2><p id="5ba6" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">这可能是接收者的错，也可能是我们的错。可能第三方接收器正在经历断电或维护窗口，或者过载。或者，也许第三方开发商只是想收支平衡。或者，也许我们这边的网络变化正在破坏我们发送请求的能力。我们并不总是能区分这两者(尽管有时我们能)。</p><p id="4dbe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们不确定的情况下，我们记录“警告”，因为我们不想被寻呼，如果只是因为一些坏的接收器而发生的话。如果我们因为我们这边的错误而一次看到一大堆这样的错误，那么我们在“警告”日志上的更高的阈值就会呼叫我们。</p><h1 id="d2d2" class="nj mh iq bd mi nk nl nm ml nn no np mo jw nq jx mr jz nr ka mu kc ns kd mx nt bi translated">结论</h1><p id="1a8c" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">只是因为它是一个错误并不意味着它是你的错误。错误处理期间适当级别的日志记录是为了解决支持、操作、合规性和系统接口问题。不要只是<code class="fe nf ng nh ni b">console.log</code>，也不要只是<code class="fe nf ng nh ni b">console.info</code>、<code class="fe nf ng nh ni b">console.error</code>等。；在<strong class="ky ir">右水平</strong>处登录<strong class="ky ir">右原因</strong>。</p><h2 id="f8b2" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">如约而至:“我是茶壶”</h2><ul class=""><li id="7e67" class="ls lt iq ky b kz mz lc na lf nu lj nv ln nw lr nx ly lz ma bi translated">MDN上的信息太多了:<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/418" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/HTTP/Status/418</a></li><li id="c3cd" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr nx ly lz ma bi translated">更简短更有趣:<a class="ae kv" href="https://httpstatuses.com/418" rel="noopener ugc nofollow" target="_blank">https://httpstatuses.com/418</a></li></ul></div></div>    
</body>
</html>