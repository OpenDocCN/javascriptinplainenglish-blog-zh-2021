<html>
<head>
<title>How to Create a DateTime Filter in Ag-Grid/React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Ag-Grid/React中创建日期时间过滤器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-a-datetime-filter-in-ag-grid-react-e2e1ba2fc80?source=collection_archive---------1-----------------------#2021-04-26">https://javascript.plainenglish.io/how-to-create-a-datetime-filter-in-ag-grid-react-e2e1ba2fc80?source=collection_archive---------1-----------------------#2021-04-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9079d3e0809a97f7b1cb3b20f1afcc7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*igBQCxEaq55yrcBB"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@nubelsondev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nubelson Fernandes</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2dfb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://stackblitz.com/edit/custom-datetime-filter-component-for-ag-grid?file=src/DTPicker.jsx" rel="noopener ugc nofollow" target="_blank"> <em class="ky">堆叠演示</em> </a></p><p id="cb44" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我使用AG-Grid 的反应版<a class="ae jz" href="https://www.ag-grid.com/react-grid/" rel="noopener ugc nofollow" target="_blank">作为我个人和专业项目的数据网格。社区版附带大量现成的免费功能，以及很好的、易于阅读的文档</a><a class="ae jz" href="https://www.ag-grid.com/react-grid/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1b34" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在最近的一个项目中，我发现自己需要一个日期时间过滤器来过滤我的一个专栏。通过阅读文档，您可以看到AG-Grid提供了一个非常有效的<a class="ae jz" href="https://www.ag-grid.com/react-grid/filter-date/" rel="noopener ugc nofollow" target="_blank">日期过滤器</a>，但是它没有提供基于时间过滤的默认选项。根据GitHub上的ag-Grid问题部分，尽管对该功能的需求相对较高，但ag-Grid团队没有实施该功能的计划。</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="ld le l"/></div></figure><p id="d390" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GitHub user @gportela85提供了一个基于<a class="ae jz" href="https://github.com/ag-grid/ag-grid/issues/2233#issuecomment-765008771" rel="noopener ugc nofollow" target="_blank"> jQuery的解决方案</a>，该解决方案与普通的ag-Grid JS版本配合使用效果很好，但是<a class="ae jz" href="https://stackoverflow.com/questions/51304288/what-is-the-right-way-to-use-jquery-in-react?fbclid=IwAR1iQfEi3i-F7DmCzeLehzlwcNBKlwJwxvHtXm3W3JDV_b4ZU0k5BPN_iJA" rel="noopener ugc nofollow" target="_blank">我们不应该在我们的React项目</a>中使用jQuery。那么，当开发人员需要一个他们正在使用的包没有提供的组件时，他们会怎么做呢？当然，他们创造了自己的。</p></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><p id="fc21" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们看一下AG-Grid文档中非常简短的<a class="ae jz" href="https://www.ag-grid.com/react-grid/filter-custom/" rel="noopener ugc nofollow" target="_blank">自定义过滤器页面</a>，我们会看到第三个选项是我们可以创建自己的自定义日期组件并自定义自己的日期选择器。</p><p id="028f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们遵循链接，我们会进入<a class="ae jz" href="https://www.ag-grid.com/react-grid/component-date/" rel="noopener ugc nofollow" target="_blank">日期组件</a>的界面，该界面向我们展示了强制和可选的方法。就在这下面，您将看到日期参数对象，它在初始化时被传递给网格组件。我们需要在应用程序中实现这些方法:</p><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lm"><img src="../Images/fc8e1b4a2390b2dd660c203e81b8d6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJyugvzzAJL8GoC-mMI5Kw.png"/></div></div></figure><figure class="kz la lb lc gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ln"><img src="../Images/7b778b5de154a5b1881b78ff51431b77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6IPUmeIH0v7S-r2hrKwCgQ.png"/></div></div></figure><p id="7e99" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于我们的DateTime组件，我们将利用React的<code class="fe lo lp lq lr b"><a class="ae jz" href="https://reactjs.org/docs/forwarding-refs.html" rel="noopener ugc nofollow" target="_blank">forwardRef</a></code>钩子。<code class="fe lo lp lq lr b">forwardRef</code>钩子接受一个带有<code class="fe lo lp lq lr b">props</code>和<code class="fe lo lp lq lr b">ref</code>参数的函数，其中<code class="fe lo lp lq lr b">props</code>保存组件的属性，<code class="fe lo lp lq lr b">ref</code>保存传递给组件的引用，然后返回一个JSX元素。我们将从这样设置组件开始:</p><h1 id="5128" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak"> DTPicker.jsx </strong></h1><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure><p id="77f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，让我们添加日期的初始状态，以及一个在日期被选中时处理状态变化的函数:</p><h1 id="63af" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated"><strong class="ak"> DTPicker.jsx </strong></h1><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure><p id="857b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">就在我们的<code class="fe lo lp lq lr b">onDateChanged</code>函数之后，我们可以实例化我们的日期时间选择器实例。对于这个演示，我们将使用<a class="ae jz" href="https://flatpickr.js.org/" rel="noopener ugc nofollow" target="_blank"> Flatpickr </a>，但是有很多很好的选项可供选择。如果您在本地跟进，只需运行<code class="fe lo lp lq lr b">npm i flatpickr</code>来安装这个包。我们将为Flatpickr实例设置一个ref，并设置一个状态变量来跟踪任何更改。我们还将为实际的输入字段设置一个ref。需要记住的一点是，当我们在ag-Grid中使用第三方组件时，我们无法控制它们，这意味着当用户点击日历选择器时，无法实现<code class="fe lo lp lq lr b">preventDefault</code>。我们可以通过向picker元素添加<code class="fe lo lp lq lr b">ag-custom-component-popup</code>类来解决这个问题:</p><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure><p id="b503" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们必须从自定义日期接口实现强制的<code class="fe lo lp lq lr b">getDate</code>和<code class="fe lo lp lq lr b">setDate</code>方法以及可选的<code class="fe lo lp lq lr b">setInputPlaceholder</code>和<code class="fe lo lp lq lr b">setInputAriaLabel</code>方法。为此，我们将使用React的<code class="fe lo lp lq lr b"><a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useimperativehandle" rel="noopener ugc nofollow" target="_blank">useImperativeHandle</a></code> <a class="ae jz" href="https://reactjs.org/docs/hooks-reference.html#useimperativehandle" rel="noopener ugc nofollow" target="_blank">钩子</a>。<code class="fe lo lp lq lr b">useImperativeHandle</code>允许我们通过引用暴露子组件内部的函数。出于我们的目的，我们希望向ag-Grid实例公开的函数是<code class="fe lo lp lq lr b">getDate</code>、<code class="fe lo lp lq lr b">setDate</code>和其余的方法。我们使用的<code class="fe lo lp lq lr b">ref</code>是我们和<code class="fe lo lp lq lr b">props</code>一起传递给组件的<code class="fe lo lp lq lr b">ref</code>。代码将如下所示:</p><h1 id="94db" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">DTPicker.jsx</h1><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><p id="2b1d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，这就是组件的构建，但是我们如何将它实现到我们的AG-Grid中呢？嗯，如果我们回头看看<a class="ae jz" href="https://www.ag-grid.com/react-grid/components/#mixing-javascript-and-react" rel="noopener ugc nofollow" target="_blank"> AG-Grid文档中关于如何注册组件的章节</a>，我们会发现我们必须导入我们的自定义组件，并将其传递给AG-Grid的<code class="fe lo lp lq lr b">frameworkComponents</code> prop。让我们将它添加到我们的表中:</p><h1 id="4e5c" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">App.jsx</h1><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure><p id="bdcf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们应该有一个成功集成到AG-Grid实例中的工作日期时间过滤器。Flatpickr有一大堆开箱即用的样式，所以你可以试着找一个你喜欢的。下面是我们组件的最终代码:</p><h2 id="060d" class="mr lt in bd lu ms mt dn ly mu mv dp mc kl mw mx mg kp my mz mk kt na nb mo nc bi translated">DTPicker.jsx</h2><figure class="kz la lb lc gt jo"><div class="bz fp l di"><div class="mq le l"/></div></figure><p id="9844" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里有一个建立在StackBlitz上的工作的<a class="ae jz" href="https://stackblitz.com/edit/medium-datetime-filter-component-for-ag-grid-flatpickr?file=src/DTPicker.jsx" rel="noopener ugc nofollow" target="_blank">演示供你使用</a>。感谢阅读！</p></div><div class="ab cl lf lg hr lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ig ih ii ij ik"><p id="4e66" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我发现一些有用的资源，我想你也会喜欢:</p><ul class=""><li id="2a9f" class="nd ne in kc b kd ke kh ki kl nf kp ng kt nh kx ni nj nk nl bi translated"><a class="ae jz" href="https://www.ag-grid.com/react-grid/filter-custom/" rel="noopener ugc nofollow" target="_blank"> AG-Grids定制过滤器</a></li><li id="3fac" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><a class="ae jz" href="https://levelup.gitconnected.com/reacts-useimperativehandle-made-simple-81035a21eef0" rel="noopener ugc nofollow" target="_blank"> React的useImperativeHandle制作简单</a></li><li id="60bf" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><a class="ae jz" href="https://blog.bitsrc.io/understanding-ref-forwarding-in-react-80accd93ed74" rel="noopener ugc nofollow" target="_blank">了解React中的参考转发</a></li><li id="2a85" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><a class="ae jz" href="https://flatpickr.js.org/" rel="noopener ugc nofollow" target="_blank"> Flatpickr文档</a></li><li id="6664" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><a class="ae jz" href="https://blog.ag-grid.com/next-level-cell-editing-in-ag-grid-with-crud-and-react-hooks/#date-picker" rel="noopener ugc nofollow" target="_blank">使用CRUD和React挂钩在ag-Grid中进行下一级单元格编辑</a></li><li id="1b02" class="nd ne in kc b kd nm kh nn kl no kp np kt nq kx ni nj nk nl bi translated"><a class="ae jz" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/datetime-local" rel="noopener ugc nofollow" target="_blank"> HTML日期时间-本地输入</a></li></ul><p id="045c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="ky">更多内容看plainenglish.io </em> </a></p></div></div>    
</body>
</html>