<html>
<head>
<title>Level Up Your MongoDb Query Skills</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提升您的MongoDb查询技能</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/level-up-your-mongodb-query-skills-db059432f5f9?source=collection_archive---------9-----------------------#2021-02-17">https://javascript.plainenglish.io/level-up-your-mongodb-query-skills-db059432f5f9?source=collection_archive---------9-----------------------#2021-02-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d92c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">主MongoDb查询</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/d3896813b54e78bf5056ecedcde7c9c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vUVV2kXRwJrhSbj1BKKr2g.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@mroz?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Filip Mroz</a> on <a class="ae ks" href="https://unsplash.com/s/photos/stairs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9cb9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">每个web开发人员都喜欢MongoDB。好吧，好吧，几乎每个网络开发者。它是市场领先的基于文档的数据库平台绝非偶然。MongoDB非常灵活，允许开发人员快速存储大量非结构化数据。</p><p id="c8ef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本指南中，我们将学习如何编写MongoDB查询，例如:</p><p id="babb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">CRUD操作:</p><ul class=""><li id="101f" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">创建(<code class="fe ly lz ma mb b">insertOne()</code>，<code class="fe ly lz ma mb b">insertMany()</code>)</li><li id="60a2" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">读(<code class="fe ly lz ma mb b">findOne()</code>，<code class="fe ly lz ma mb b">find()</code>)</li><li id="0f7b" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">更新(<code class="fe ly lz ma mb b">updateOne()</code>，<code class="fe ly lz ma mb b">update()</code>)</li><li id="e046" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">删除(<code class="fe ly lz ma mb b">deleteOne()</code>，<code class="fe ly lz ma mb b">deleteMany()</code>)</li></ul><p id="9d62" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">更高级的查询操作使用:</p><ul class=""><li id="68c6" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">读取选项(<code class="fe ly lz ma mb b">sort</code>、<code class="fe ly lz ma mb b">limit</code>、<code class="fe ly lz ma mb b">skip</code>、<code class="fe ly lz ma mb b">projection</code>)</li><li id="4c49" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">比较查询运算符(<code class="fe ly lz ma mb b">$gt</code>、<code class="fe ly lz ma mb b">$lt</code>、<code class="fe ly lz ma mb b">$gte</code>、<code class="fe ly lz ma mb b">$lte</code>)</li><li id="f513" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">设置运算符(<code class="fe ly lz ma mb b">$in</code>、<code class="fe ly lz ma mb b">$all</code>、<code class="fe ly lz ma mb b">$nin</code>)</li><li id="a001" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">布尔运算符(<code class="fe ly lz ma mb b">$ne</code>、<code class="fe ly lz ma mb b">$not</code>、<code class="fe ly lz ma mb b">$or</code>、<code class="fe ly lz ma mb b">$nor</code>、<code class="fe ly lz ma mb b">$exists</code>)</li></ul><p id="3af8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我将使用Node.js驱动程序连接到MongoDB。你可以在这里看到如何连接到你喜欢的语言的驱动程序。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">MongoDB connection</figcaption></figure><p id="295b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">成功连接到MongoDB之后，让我们继续查看各种MongoDB查询。</p><p id="4c75" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">创建操作</strong></p><p id="8b9b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建或插入操作向集合中添加新文档。以下方法可用于将文档插入集合:</p><ul class=""><li id="db58" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> insertOne: </strong>将单个文档插入集合。</li><li id="ca00" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><strong class="kv io">插入多个</strong>:将多个文档插入一个集合。</li></ul><p id="7856" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们看看这些方法的用法:</p><p id="f87a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我们将创建一个用户集合，在其中插入文档，使用insertOne插入单个文档，使用insertMany插入一个文档数组。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="653e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">根据这个查询，<code class="fe ly lz ma mb b">insertOne()</code>将把单个文档<code class="fe ly lz ma mb b">user</code>插入到用户集合中，而<code class="fe ly lz ma mb b">insertMany()</code>将把多个文档<code class="fe ly lz ma mb b">multipleUsers</code>插入到用户集合中。</p><p id="90af" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">读取操作</strong></p><p id="e7fc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以使用读操作从MongoDB数据库中检索数据。要从集合中检索文档，可以使用以下方法之一:</p><ul class=""><li id="79d4" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> find </strong>:在您想要查询的集合上调用这个方法。要检索集合中的所有文档，将一个空文档作为查询过滤器参数传递给<code class="fe ly lz ma mb b">find()</code>。为了检索特定的文档，<code class="fe ly lz ma mb b">find()</code>接受一个描述您想要选择的文档的查询文档。</li><li id="4f4c" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><strong class="kv io"> findOne: </strong>这个方法用于从集合中检索单个文档。您需要为该方法提供一个查询参数，它将使用该参数返回集合中与查询匹配的文档。<code class="fe ly lz ma mb b">findOne()</code>只返回第一个匹配的文档。如果不提供查询文档，或者提供一个空文档，MongDB将匹配集合中的所有文档。</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Retrieve documents using find and findOne</figcaption></figure><p id="a307" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个查询将返回<code class="fe ly lz ma mb b">User</code>集合中的所有用户，第二个查询将返回<code class="fe ly lz ma mb b">firstName</code>字段值为<code class="fe ly lz ma mb b">Chinedu</code>的所有用户，第三个查询将只返回一个文档，其中<code class="fe ly lz ma mb b">firstName </code>字段值为<code class="fe ly lz ma mb b">Lebron </code>，而<code class="fe ly lz ma mb b">lastName </code>字段值为<code class="fe ly lz ma mb b">James</code>。</p><p id="d88f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">更新操作</strong></p><p id="b9a0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">MongoDB中的更新操作修改集合中的现有文档。让我们来看一下更新方法:</p><ul class=""><li id="69a7" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> updateOne </strong>:该方法用于更新单个文档。<code class="fe ly lz ma mb b">updateOne()</code>接受过滤文件和更新文件。如果查询匹配集合中的文档，<code class="fe ly lz ma mb b">updateOne()</code>将使用更新文档更新文档的相关字段。如果没有与您的过滤器匹配的文档，您可以将<code class="fe ly lz ma mb b">upsert</code>选项设置为真，以创建一个新文档。</li></ul><p id="091c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="09ec" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个查询将首先检查集合中是否有用户的<code class="fe ly lz ma mb b">firstName</code>是<code class="fe ly lz ma mb b">Chinedu</code>。如果找到一个以上的用户，第一个匹配过滤器的文档将用一个<code class="fe ly lz ma mb b">hobbies</code>字段和一个数组值进行更新，但是如果没有找到用户，则不会更新任何文档。</p><ul class=""><li id="be63" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> updateMany: </strong>该方法用于更新多个文档。<code class="fe ly lz ma mb b">UpdateMany()</code>接受过滤文档和更新文档。如果集合中的任何文档与过滤器匹配，它将被更新文档替换。</li></ul><p id="4457" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="7492" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将匹配所有的用户，其中<code class="fe ly lz ma mb b">firstName</code>字段值为<code class="fe ly lz ma mb b">Cristiano</code>，并且将他们的年龄增加1。</p><p id="0af6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">删除操作</strong></p><p id="862b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe ly lz ma mb b">deleteOne()</code>和<code class="fe ly lz ma mb b">deleteMany()</code>方法用于从集合中移除文档。让我们看看这些方法是如何工作的:</p><ul class=""><li id="5495" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> deleteOne: </strong>该方法用于删除集合中的单个文档。<code class="fe ly lz ma mb b">deleteOne()</code>接受查询文档并删除第一个匹配的文档。如果您没有提供查询文档，或者如果您提供了一个空文档，MongoDB将匹配集合中的所有文档并删除第一个匹配。</li></ul><p id="2584" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="5282" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将匹配<code class="fe ly lz ma mb b">User</code>集合中第一个文档，其中<code class="fe ly lz ma mb b">firstName</code>字段值为<code class="fe ly lz ma mb b">Chinedu</code>，并删除它。</p><ul class=""><li id="0247" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> deleteMany: </strong>该方法用于删除集合中的多个文档。<code class="fe ly lz ma mb b">deleteMany()</code>接受查询文档并删除集合中所有匹配的文档。如果您没有提供查询文档，或者如果您提供了一个空文档，MongoDB将匹配集合中的所有文档并删除它们。</li></ul><p id="a30a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="18f3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将选择并删除<code class="fe ly lz ma mb b">User</code>集合中<code class="fe ly lz ma mb b">lastName</code>字段值为<code class="fe ly lz ma mb b">James</code>的所有文档。</p><p id="4ae0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> MongoDB查询Max </strong></p><p id="5b48" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">本节是对MongoDB查询功能的更全面的参考。</p><p id="1e66" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">跳过、限制和排序查询选项</strong></p><ul class=""><li id="bffd" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> Skip: </strong>查询集合时，<code class="fe ly lz ma mb b">skip()</code>用于控制MongoDB从哪里开始返回结果。这通常用于实现分页结果。</li><li id="0bfb" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><strong class="kv io"> Limit: </strong>该方法用于指定将被返回的文档的最大数量。这种方法类似于SQL数据库中的<code class="fe ly lz ma mb b">LIMIT</code>语句。这很有用，因为它将防止MongoDB返回不需要的结果，从而最大化性能。</li><li id="034e" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><strong class="kv io">排序:</strong>该方法指定查询返回匹配文档的顺序。如果您想以升序或降序返回匹配的文档，这个方法将帮助您实现这一点。</li></ul><p id="81d6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们来看看它们的用法:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="e803" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将返回前三个用户，按年龄升序排列。</p><p id="45e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">投影</strong></p><p id="9111" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Projection用于指定要从查询结果中的每个文档返回或传递到管道下一阶段的字段。</p><p id="f5cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设您想检查数据库中是否存在一个用户:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="2694" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果用户存在，将返回整个文档，但是您不希望仅仅为了检查用户是否存在而返回整个文档。您可以使用投影来限制返回的字段。</p><p id="b00c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要进行投影，您需要为<code class="fe ly lz ma mb b">find()</code>或<code class="fe ly lz ma mb b">findOne()</code>查询提供一个额外的参数。此参数包含include或exclude规范。将想要返回的字段的值设置为1，将想要排除的字段的值设置为0。</p><p id="5dd8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">考虑下面的例子:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="526c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果这个用户存在，将只返回<code class="fe ly lz ma mb b">_id</code>字段。</p><p id="02ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意，除非<code class="fe ly lz ma mb b">_id</code>字段被明确排除，即<code class="fe ly lz ma mb b">_id: 0</code>，否则默认情况下它总是被包含在内。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="6979" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果该用户存在，将返回<code class="fe ly lz ma mb b">lastName </code>和<code class="fe ly lz ma mb b">_id</code>字段，因为默认包含<code class="fe ly lz ma mb b">_id</code>字段。</p><p id="809e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在某些情况下，您可能希望指定要排除的字段。例如，如果我们想返回没有年龄的用户，我们在projection参数中将年龄值设置为零:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="7aea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将返回除年龄之外的所有用户字段。</p><p id="c5ed" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">比较查询运算符</strong></p><p id="30a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大多数情况下，您会希望查询某个范围内的文档。在大多数编程语言中，这可以通过<code class="fe ly lz ma mb b">&lt;</code>、<code class="fe ly lz ma mb b">&lt;=</code>、<code class="fe ly lz ma mb b">&gt;</code>和<code class="fe ly lz ma mb b">&gt;=</code>符号来实现。对于MongoDB，使用<code class="fe ly lz ma mb b">$lt</code>、<code class="fe ly lz ma mb b">$lte</code>、<code class="fe ly lz ma mb b">$gt</code>和<code class="fe ly lz ma mb b">$gte</code>组操作符来实现这一点。让我们分别来看看:</p><ul class=""><li id="c13f" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $lt: </strong> lt是小于的缩写，<code class="fe ly lz ma mb b">$lt</code>操作符选择字段值小于指定值的文档。</li></ul><p id="2aa5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">考虑一下这个:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="65e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将选择并返回所有39岁以下的用户。</p><p id="dab2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe ly lz ma mb b">$lt</code>操作符也可用于嵌入文档。假设我们的用户集合中有一个嵌入式文档，比如地址字段中有一个邮政编码:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="8ccd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们可以使用<code class="fe ly lz ma mb b">$lt</code> <strong class="kv io"> </strong>操作符，通过以下查询来查找住在拉各斯维多利亚岛的用户:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="c4c8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我使用了一个我们还没有讨论过的操作符<code class="fe ly lz ma mb b">$gt</code>，但是这个查询检索邮政编码大于<code class="fe ly lz ma mb b">101240</code>小于<code class="fe ly lz ma mb b">101242</code>的用户，基本上是居住在维多利亚岛的用户(<code class="fe ly lz ma mb b">101241</code>)。</p><ul class=""><li id="41b1" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">我知道你已经猜到了，gt代表“大于”<code class="fe ly lz ma mb b">$gt</code> <strong class="kv io"> </strong>匹配字段值大于指定值的文档。</li></ul><p id="4e63" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="60e9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询查找39岁以上的用户。与<code class="fe ly lz ma mb b">$lt</code>一样，<code class="fe ly lz ma mb b">$gt</code> <strong class="kv io"> </strong>运算符也可以用在嵌入式文档上。</p><ul class=""><li id="8b3a" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $lte: </strong> <code class="fe ly lz ma mb b">$lte</code> <strong class="kv io"> </strong>选择字段值小于或等于指定值的文档。该运算符的使用方式与<code class="fe ly lz ma mb b">$lt</code> <strong class="kv io"> </strong>的使用方式相同:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="6b34" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此查询选择小于或等于17岁的用户。</p><ul class=""><li id="775e" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $gte: </strong> <code class="fe ly lz ma mb b">$gte</code> <strong class="kv io"> </strong>选择字段值大于或等于指定值的文档。</li></ul><p id="d141" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="422f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询选择18岁及以上的用户。</p><p id="83b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">组合这些运算符时，不要犯重复搜索字段的常见错误:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="e422" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面的查询只考虑了最后一个条件。正确表达查询:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="7a48" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请注意，只有当值属于同一类型时，范围查询才会匹配这些值。也就是说，在一个文档集合中，如果您有一个字段的值由多种类型组成(例如，数字和字符串)，并且您发出一个范围查询，比如说<code class="fe ly lz ma mb b">{field: {$lt: 100}}</code>，该查询将只匹配和检索字段值为数字的文档。如果需要字符串结果，则必须用字符串进行查询。</p><p id="ec50" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">设置操作符</strong></p><p id="10f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">集合运算符包括<code class="fe ly lz ma mb b">$in</code>、<code class="fe ly lz ma mb b">$nin</code>和<code class="fe ly lz ma mb b">$all</code>。这些查询运算符将一个或多个值的列表作为筛选条件。让我们分别来看看:</p><ul class=""><li id="2ada" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $in: </strong>如果任何给定值与搜索字段匹配，该操作符将返回一个文档。如果该字段包含一个数组，<code class="fe ly lz ma mb b">$in</code>操作符将返回集合中至少有一个给定值与搜索字段匹配的所有文档。</li></ul><p id="3bb4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="6fc1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个查询基本上是说，找到39岁或40岁的用户。从我们的用户集合中，我们只有一个39岁的用户(Serena Williams ),没有40岁的用户。因此，将返回一个文档。</p><ul class=""><li id="3ee7" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $nin: </strong> <code class="fe ly lz ma mb b">$nin</code> (not in)仅当给定元素都不匹配搜索字段时，才返回文档。从用户集合中，我们可以使用这个操作符来查找既不是18岁也不是50岁的用户:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="fec1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将返回用户集合中年龄字段值既不是18也不是50的所有文档。没有一个用户的年龄在18岁或50岁，因此，将返回用户集合中的所有文档。</p><ul class=""><li id="7bc2" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $all: </strong> <code class="fe ly lz ma mb b">$all</code>如果所有给定元素都匹配搜索关键字，则匹配。我们可以利用<code class="fe ly lz ma mb b">$all</code>操作符来查找爱好字段值包含<code class="fe ly lz ma mb b">Football</code>和<code class="fe ly lz ma mb b">Chess</code>的用户:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="1067" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将只返回爱好字段包含足球和象棋的所有用户。</p><p id="c3e1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">布尔运算符</strong></p><p id="5aa9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">MongoDB的布尔运算符包括<code class="fe ly lz ma mb b">$ne</code>、<code class="fe ly lz ma mb b">$not</code>、<code class="fe ly lz ma mb b">$or</code>、<code class="fe ly lz ma mb b">$and</code>、<code class="fe ly lz ma mb b">$nor</code>和<code class="fe ly lz ma mb b">$exists</code>。</p><p id="70ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们来了解一下他们:</p><ul class=""><li id="5701" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $ne: </strong>比方说由于某种原因，你想检索除了45岁以外的所有用户，你是如何实现的？我们使用<code class="fe ly lz ma mb b">$ne</code>操作符。<code class="fe ly lz ma mb b">$ne</code>(不等于)运算符返回搜索字段的值不等于给定值的文档。该操作符也将返回不包含搜索字段的文档。</li></ul><p id="158c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="de52" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将检索年龄不超过45岁的所有用户。</p><ul class=""><li id="19d6" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io">$ not:</strong><code class="fe ly lz ma mb b">$not</code>操作符对指定的查询操作符执行<em class="mj">翻转挑战</em>。假设您使用以下查询来选择18岁以上的用户:</li></ul><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="c163" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在上述查询中使用<code class="fe ly lz ma mb b">$not</code>操作符时，将选择18岁及以下的用户:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="d2cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可能想知道这与<code class="fe ly lz ma mb b">$lte</code>操作符有什么不同。虽然<code class="fe ly lz ma mb b">$lte</code>操作符将只选择具有年龄字段且其值小于或等于18的用户，但查询<code class="fe ly lz ma mb b">{$not: { $gt: 18 }}</code>不仅会选择小于或等于18的用户，还会选择没有年龄字段的用户。</p><ul class=""><li id="7e09" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io">$或:</strong> <code class="fe ly lz ma mb b">$or</code>将计算两个或更多表达式的数组，并将选择与至少一个表达式匹配的文档。</li></ul><p id="efab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">考虑下面的例子:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="aa73" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询包含两个表达式的数组。$or运算符将计算这些表达式，并从用户集合中选择文档，其中<code class="fe ly lz ma mb b">firstName</code> <strong class="kv io"> </strong>字段值为<code class="fe ly lz ma mb b">Serena</code> <strong class="kv io"> </strong>或者<code class="fe ly lz ma mb b">age</code> <strong class="kv io"> </strong>字段值小于<code class="fe ly lz ma mb b">40</code>。</p><p id="de3c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果没有符合这些表达式的文档，<code class="fe ly lz ma mb b">$or</code>将不会检索到任何文档。</p><ul class=""><li id="a14a" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv io"> $nor: </strong>因此，虽然<code class="fe ly lz ma mb b">$or</code>操作符将选择至少匹配一个给定表达式的文档，但是<code class="fe ly lz ma mb b">$nor</code>将选择不匹配数组中所有查询表达式的文档。<code class="fe ly lz ma mb b">$nor</code>操作符也将选择不包含表达式中指定的搜索字段的文档。</li></ul><p id="315a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将我们之前示例中的<code class="fe ly lz ma mb b">$or</code>更改为<code class="fe ly lz ma mb b">$nor</code>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="c893" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将从用户集合中选择以下文档:</p><ul class=""><li id="8789" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><code class="fe ly lz ma mb b">firstName</code>字段值不等于<code class="fe ly lz ma mb b">Serena</code>的用户</li><li id="9e97" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><code class="fe ly lz ma mb b">age</code>字段值等于<code class="fe ly lz ma mb b">40</code>及以上的用户</li><li id="3cd8" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">没有<code class="fe ly lz ma mb b">firstName</code>和<code class="fe ly lz ma mb b">age</code>字段的用户</li><li id="bc18" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated"><strong class="kv io"> $exists: </strong>如果你需要检查一个特定的字段是否存在于一个文档中，使用<code class="fe ly lz ma mb b">$exists</code>操作符。该运算符只能接受布尔值。当布尔值为<code class="fe ly lz ma mb b">true</code>时，<code class="fe ly lz ma mb b">$exists</code>将匹配包含该字段的文档，包括字段值为<code class="fe ly lz ma mb b">null</code>的文档。如果布尔值为<code class="fe ly lz ma mb b">false</code>，<code class="fe ly lz ma mb b">$exists</code>将只匹配不包含该字段的文档。</li></ul><p id="fc51" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请考虑以下情况:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="16a3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该查询将只选择带有<code class="fe ly lz ma mb b">age</code>字段的文档，即使该字段是<code class="fe ly lz ma mb b">null</code>。如果布尔值被更改为<code class="fe ly lz ma mb b">false</code>，查询将只选择没有<code class="fe ly lz ma mb b">age</code>字段的文档。</p></div><div class="ab cl mk ml hr mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ig ih ii ij ik"><p id="b121" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本指南中，我们研究了各种MongoDB查询，从基本的CRUD操作到更高级的查询，使用了:</p><ul class=""><li id="e1a3" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">读取选项(<code class="fe ly lz ma mb b">sort</code>、<code class="fe ly lz ma mb b">limit</code>、<code class="fe ly lz ma mb b">skip</code>、<code class="fe ly lz ma mb b">projection</code>)</li><li id="7f84" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">比较查询运算符(<code class="fe ly lz ma mb b">$lt</code>、<code class="fe ly lz ma mb b">$gt</code>、<code class="fe ly lz ma mb b">$lte</code>、<code class="fe ly lz ma mb b">$gte</code>)</li><li id="def7" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">设置操作员(<code class="fe ly lz ma mb b">$in</code>、<code class="fe ly lz ma mb b">$all</code>、<code class="fe ly lz ma mb b">$nin</code>)</li><li id="857e" class="lp lq in kv b kw mc kz md lc me lg mf lk mg lo lu lv lw lx bi translated">布尔运算符(<code class="fe ly lz ma mb b">$ne</code>、<code class="fe ly lz ma mb b">$not</code>、<code class="fe ly lz ma mb b">$or</code>、<code class="fe ly lz ma mb b">$nor</code>、<code class="fe ly lz ma mb b">$exists</code>)</li></ul><p id="14e8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我在写这篇文章的时候学到了很多，我希望你能从这篇文章中学到一些东西。</p><p id="37ff" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">注意到这篇文章中有什么错误吗？请在评论部分指出这一点。我很乐意纠正它并加以改进。</p></div></div>    
</body>
</html>