<html>
<head>
<title>Introducing Shield: A Node Package to Solve Server-side Type Checking Issues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Shield简介:解决服务器端类型检查问题的节点包</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/shield-javascript-and-the-solution-to-server-side-type-checking-5e27e9f9fa72?source=collection_archive---------26-----------------------#2021-07-13">https://javascript.plainenglish.io/shield-javascript-and-the-solution-to-server-side-type-checking-5e27e9f9fa72?source=collection_archive---------26-----------------------#2021-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/b5e97056e842c003a22659465e193e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GC-GwhswrjQGdwvR"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@introspectivedsgn?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Erik Mclean</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="fe74" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">解决服务器端类型检查难题的节点模块。</h2></div><p id="a4fd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我发现自己最近用JavaScript写了很多后端代码，总是遇到同样的问题。类型检查。</p><p id="7f63" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当作为开发人员编码特性时，TypeScript是很棒的！但是客户数据呢？在大多数情况下，数据作为字符串化的JSON blobs发送到节点后端。验证这些数据的格式是否正确可能是一项全职工作。以下面我试图为lambda解析器编写的一些代码为例。看看你是否能理解它。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/409c90ebf6c64d2752f79d05c27b4519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UvSLFZ9BVxdzhKdSlhF3sQ.png"/></div></div></figure><p id="dff5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">可怕吧？我们遗漏了很多案例，我们甚至不知道我们目前在检查什么。然后，经典问题，需求变了。现在怎么办？您需要对其进行排序，并根据新值进行编辑。当然，这不是不可能的，但这是讨厌的工作。</p><p id="5760" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，一个应用程序从来都不是一个处理程序，类型分布在十几个位置，每个位置的组织性都不如前一个。这都是假设所有的类型检查都在每个处理程序的同一个地方完成，通常是分散在后端，因为每个部分在继续之前只检查它需要的内容。</p><p id="6f27" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">回车:模板-盾牌。好吧，也许这个名字不是最好的，但它是一个快速节点模块，我写它就是为了解决这个问题。让我们看看如何使用它来解决这种混乱，清理代码，并建立一个更好的开发环境！</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="ac8d" class="md me jg bd mf mg mh mi mj mk ml mm mn km mo kn mp kp mq kq mr ks ms kt mt mu bi translated">什么是盾？</h1><p id="485c" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">使用Shield，你定义一个变量作为一个“模板”,它将保护你不受任何不严格遵循其结构的对象的影响！模板根据输入数据递归解析，并给出详细的读数，显示匹配失败发生在哪里！</p><p id="75aa" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面的对象是一个模板，它和上面的条件做同样的检查！然而，它更干净、更紧凑、可读性更好！</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/0c42b66f55cfc13b4183af0390fe1e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YIzqlMc5NlWaocAJt8bdKA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">100x better!</figcaption></figure><p id="619b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后，使用模板就像将它传递给shield进行检查一样简单。Shield将递归解析模板，使其与对象匹配。如果一切都完全匹配，则允许该对象通过！</p><p id="08db" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">简单地在lambda解析器的顶部定义一个模板，然后抛出和接收不匹配的请求，这已经大大提高了我的无服务器代码的可读性！对于任何处理原始JSON字符串或其他类型的危险数据的基于节点的请求处理程序来说，几行代码可以带来巨大的风格改进！</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lr"><img src="../Images/ca040888ac5c77a36c565c9141921d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*peh7zlqV27TcReUEBajw2Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">De-riskify in simple steps</figcaption></figure><p id="6b76" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">此外，对于不正确的值，Shield将提供匹配失败的描述。向用户展示这一点可能不太有用，但是可以使调试数据问题不那么令人头痛！</p><div class="ls lt lu lv gt ab cb"><figure class="na is nb nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/b0838760a2a14d1ebbfab2123f3aef5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:860/format:webp/1*2iIZKX2sXiV9mJK9NzC-eA.png"/></div></figure><figure class="na is ng nc nd ne nf paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><img src="../Images/e89682854bf09e116923113d40a4ce64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*7Fh6ccMxyVsOCQOkffCQUA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk nh di ni nj">The template and data (left) product a detailed read out (right) when sent through Shield</figcaption></figure></div><p id="4654" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在上面的例子中，</p><ul class=""><li id="98d0" class="nk nl jg kx b ky kz lb lc le nm li nn lm no lq np nq nr ns bi translated">“a”是正确的，因此不在结果中。</li><li id="75e0" class="nk nl jg kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated">“b”太长，收到一条错误消息</li><li id="4faf" class="nk nl jg kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated">模板上应该有“c ”,但给定的数据中却没有</li><li id="9b87" class="nk nl jg kx b ky nt lb nu le nv li nw lm nx lq np nq nr ns bi translated">“d”在数据上，但对模板没有期望。</li></ul><p id="bb38" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了让Shield将其标记为有效，这三个问题都需要解决。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="c91a" class="md me jg bd mf mg mh mi mj mk ml mm mn km mo kn mp kp mq kq mr ks ms kt mt mu bi translated">语法示例</h1><p id="b232" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">模板对象被定义在一个特定的结构中，这样Shield就可以正确地解析它们。</p><h2 id="8f0f" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">直接匹配</h2><p id="2635" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">如果键是普通值，那么Shield将尝试寻找具有相同值的匹配键。如果一个对象使用直接匹配，所有的键都直接映射到模板。</p><h2 id="f915" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">类型检查</h2><p id="961f" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">像<code class="fe ok ol om on b">_string</code>和<code class="fe ok ol om on b">_int</code>这样的关键字允许你指定一个属性或者对象是一个特定的类型。此外，您可以对这些数据类型的长度、大小和其他值设置限制。</p><h2 id="6af0" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">数组检查之一</h2><p id="082a" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">在许多情况下，您可能有一个要从中选择的选项列表。关键字<code class="fe ok ol om on b">_oneOf</code>允许你指定一个元素列表，给定的对象必须至少匹配其中的一个。它们可以是直接匹配或模板，或者是直接匹配和模板的混合。</p><h2 id="ab07" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">检查数组的每个元素</h2><p id="6662" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">用<code class="fe ok ol om on b">_arrayLike</code> Shield将验证该项目是一个数组，并且每个元素都匹配所提供的子模板。这与<code class="fe ok ol om on b">_oneOf</code>相结合，允许从任何尺寸的输入缩放到任何尺寸的模板。</p><h2 id="6ce3" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">条件对象键</h2><p id="0c0b" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">使用<code class="fe ok ol om on b">_mapLike</code>您还可以检查对象的关键点是否满足特定条件，如果对象关键点需要看起来像自定义和动态的</p><h2 id="e8b5" class="ny me jg bd mf nz oa dn mj ob oc dp mn le od oe mp li of og mr lm oh oi mt oj bi translated">自定义模板</h2><p id="b4e1" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">最后，还有一个provider helper <code class="fe ok ol om on b">registerHandler</code>，它允许为您的检查需求创建更多的定制处理程序。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="2343" class="md me jg bd mf mg mh mi mj mk ml mm mn km mo kn mp kp mq kq mr ks ms kt mt mu bi translated">示例模板</h1><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/5b560a8d70ed385c7d88a445d3d9f7aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a52R13dSxb4sCRAj5e5Pow.png"/></div></div></figure><p id="589e" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">虽然这样格式化很奇怪，但上面的模板接受-7，-12，从12到20，“a”，“fish”或“dog”作为有效值。其他的都会被屏蔽。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/523a5260669bf82a3c6c8242bdf433c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pQCPxFza3MHk14gIlRp_qg.png"/></div></div></figure><p id="7c8c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">同样，尽管这种用法有问题，但上面的模板确保它接收的对象的键至少有12个字符，值为正整数。</p><figure class="ls lt lu lv gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/9e4b0b57fae023a67fc8d7621a972572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CvWZegG_ZGjZqBcB9Tvh_A.png"/></div></div></figure><p id="e851" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">最后，这个模板确保它接收一个值数组，每个值都是一个最大值为10的整数。</p><h1 id="36c1" class="md me jg bd mf mg op mi mj mk oq mm mn km or kn mp kp os kq mr ks ot kt mt mu bi translated">更多资源</h1><p id="3800" class="pw-post-body-paragraph kv kw jg kx b ky mv kh la lb mw kk ld le mx lg lh li my lk ll lm mz lo lp lq ij bi translated">想用这个？看看吧！</p><div class="ip iq gp gr ir ou"><a href="https://www.npmjs.com/package/template-shield" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd jh gy z fp oz fr fs pa fu fw jf bi translated">模板屏蔽</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">针对那些讨厌的客户端的轻量级服务器端类型检查</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">www.npmjs.com</p></div></div><div class="pd l"><div class="pe l pf pg ph pd pi ix ou"/></div></div></a></div><div class="ip iq gp gr ir ou"><a href="https://github.com/eric-robertson/type-shield" rel="noopener  ugc nofollow" target="_blank"><div class="ov ab fo"><div class="ow ab ox cl cj oy"><h2 class="bd jh gy z fp oz fr fs pa fu fw jf bi translated">埃里克-罗伯逊/铅字盾牌</h2><div class="pb l"><h3 class="bd b gy z fp oz fr fs pa fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="pc l"><p class="bd b dl z fp oz fr fs pa fu fw dk translated">github.com</p></div></div><div class="pd l"><div class="pj l pf pg ph pd pi ix ou"/></div></div></a></div><p id="ab31" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">名字有点不固定哈哈。如果有用的话，请鼓掌支持我！</p><p id="142b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="pk">更多内容请看</em><a class="ae jd" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kx jh"><em class="pk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>