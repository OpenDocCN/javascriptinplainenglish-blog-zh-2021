<html>
<head>
<title>How I Built My First React Native Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何构建我的第一个React本地库</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-i-built-my-first-react-native-library-9d4191c0ad44?source=collection_archive---------3-----------------------#2021-05-14">https://javascript.plainenglish.io/how-i-built-my-first-react-native-library-9d4191c0ad44?source=collection_archive---------3-----------------------#2021-05-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a886" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<a class="ae ki" href="https://medium.com/swlh/how-i-built-a-language-learning-app-with-react-native-8c4f09500783" rel="noopener">之前的一篇文章</a>中，我描述了构建<strong class="jm io">翻牌</strong>的过程，这是一个语言学习应用，也是我的第一个移动应用开发项目。</p><p id="ff23" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这款应用期待已久的功能之一是<strong class="jm io">挑战模式</strong>，用户可以在一个类似测验的界面中测试自己的知识:给定一个英语单词，用户必须用德语键入，包括文章。</p><p id="788c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在设计这种模式的UI时，我意识到一个简单的输入文本对用户来说不是很友好:首先，对于一个名词，你应该键入冠词，然后在冠词和单词之间加一个空格。对我来说，这看起来有点便宜。此外，我想给出这个单词有多少个字母的视觉提示。这促使我考虑这种类型的输入:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/e8829b5b190eaaba4ee250ec4586ce2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tg0LIFh_cSQQErb12dUqgA.png"/></div></div></figure><p id="f67a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我开始研究一个React本地库，它允许我这样做。第一个挑战是找出这个东西实际上是怎么叫的。我的一些搜索关键字是:</p><ul class=""><li id="87ae" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated">单个字符输入</li><li id="b0dd" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">单字符输入</li><li id="a798" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">多框输入</li><li id="94d0" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">单字母输入</li></ul><p id="2a31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">结果发现外面真的没有多少。这种类型的界面在<strong class="jm io"> OTP </strong>(一次性密码)屏幕中似乎很常见，但这通常意味着只支持数字，或者不支持空格、换行符等等。此外，我发现的大多数项目都是为<strong class="jm io"> React </strong>而不是为<strong class="jm io"> React Native </strong>编写的。在我的搜索结束时，我没有为我的目标留下合适的库。</p><p id="a5a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我最后给出了一个典型的答案:</p><blockquote class="lk"><p id="3d4d" class="ll lm in bd ln lo lp lq lr ls lt kh dk translated">“好吧，我就自己造”</p></blockquote><h2 id="9d18" class="lu lv in bd lw lx ly dn lz ma mb dp mc jv md me mf jz mg mh mi kd mj mk ml mm bi translated">步骤1——将它构建为我的项目中的一个组件</h2><p id="5ce4" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">在开始的时候，我主要关注的是在我的项目中拥有这个功能，因此我只是把它作为翻转卡片项目中的一个组件来创建。核心思想是接受一个<em class="kj">单词结构</em>(这是一个布尔数组，其中<code class="fe ms mt mu mv b">true</code>表示<em class="kj">字母</em>，<code class="fe ms mt mu mv b">false</code>表示<em class="kj">空格</em>)，然后在需要时为每个字母或空格呈现单个的单字母文本输入。在键入时，执行回调函数，并将键入的单词(作为字母数组和字符串)作为函数参数传递。</p><p id="9f21" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我不会用所有的细节来烦你，但我必须应对许多不可预见的挑战:</p><p id="0508" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">管理<em class="kj">退格键</em>行为并不那么简单:核心思想是当点击退格键时，焦点转到上一次输入，字母被删除。但是如果你的注意力集中在一个已经有一封信的盒子上呢？在这种情况下，只有当光标位于字母之后的<strong class="jm io">时，您才希望删除当前字母。</strong></p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/767c42229a2738c6dd050cbb4b06e974.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/1*mf_T6OIIzVegdXbs762nmg.gif"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk">Different cases for the backspace behavior</figcaption></figure><p id="03f7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">另一个挑战是，我想在需要时有效地将单词分成多行。为此，我创建了一个名为<code class="fe ms mt mu mv b">maxBoxesPerLine </code>的设置，然后我实现了一个基于该设置创建字母块的逻辑。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/fc05a427e737cdf01ab06dd823fbb80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*Ap5dLJp58liGVN3u_7Ji9Q.png"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk">A long word with maxBoxesPerLine set to 12</figcaption></figure><p id="5590" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还创建了一个名为<code class="fe ms mt mu mv b">lineBreakOnSpace</code>的设置，它总是为一个新单词创建一个新行。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/6c52e98ea41b957251c89de4328b387a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*m5VuShy5j0fZnyifEqLTrg.png"/></div></figure><p id="9e6d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个过程的最后，我将这个新组件集成到我的应用程序中，进行了测试，然后发布了期待已久的<strong class="jm io">挑战模式</strong>功能。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="3adc" class="lu lv in bd lw lx nj dn lz ma nk dp mc jv nl me mf jz nm mh mi kd nn mk ml mm bi translated">步骤2 —将其作为独立库发布</h2><p id="e870" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">该特性发布后，我重新查看了我的组件，注意到它足够独立，可以作为一个独立的库轻松发布。</p><p id="7195" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我第一次尝试这种类型的项目，所以我开始为存储库寻找一个模板。主要目标是有一个能让我:</p><ul class=""><li id="e7dc" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated">在设备模拟器(iOS和Android)中运行组件</li><li id="cf64" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">使用<strong class="jm io">热重装</strong>加快更新速度</li><li id="4bfb" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">在<strong class="jm io">类型脚本</strong>中编写代码</li><li id="49f8" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">编写测试</li><li id="034b" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">轻松地将库导出为<strong class="jm io"> npm </strong>包</li></ul><p id="5b03" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">经过一番研究，我找到了这个<a class="ae ki" href="https://github.com/demchenkoalex/react-native-module-template" rel="noopener ugc nofollow" target="_blank">优秀的模板</a>，它符合我的所有要求。该项目带有一个包含演示应用程序的<code class="fe ms mt mu mv b">/example</code>文件夹。这已经以某种方式进行了配置，使我们可以导入我们的组件，就像它是项目中一个现有的依赖项一样。</p><pre class="kl km kn ko gt no mv np nq aw nr bi"><span id="249a" class="lu lv in mv b gy ns nt l nu nv">import { ComponentName } from 'react-native-library-name';</span></pre><p id="e16c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">示例项目可以在设备模拟器中启动，组件可以实时编辑，就像您在处理标准React本地项目时一样。</p><h2 id="f745" class="lu lv in bd lw lx nj dn lz ma nk dp mc jv nl me mf jz nm mh mi kd nn mk ml mm bi translated">测试</h2><p id="1da5" class="pw-post-body-paragraph jk jl in jm b jn mn jp jq jr mo jt ju jv mp jx jy jz mq kb kc kd mr kf kg kh ig bi translated">由于在需要时将单词分成行的逻辑(基于上面提到的设置)非常复杂，我意识到这对于一些单元测试来说是一个很好的用例。模板已经安装了<strong class="jm io"> Jest </strong>，所以我创建了覆盖不同场景的测试。我在测试中包括的另一件事是返回焦点应该转移到的输入框的索引的方法(例如，当按backspace或键入一个字母时)。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nw"><img src="../Images/222c16762305fd3fabcca9ce4a09fbe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bx40sv-xSfqcGTbUND_hoA.png"/></div></div></figure><p id="0448" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些测试甚至在我每次通过GitHub动作提交提交时都被执行，因此如果我在更新组件时破坏了什么，我会立即注意到。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi nx"><img src="../Images/c90c491469e02ec97d0aeb4cc1eb513d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x8Zchquf2gv_y7-WdmjAgw.png"/></div></div></figure><p id="1369" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">仍然缺少的是用可能的道具组合对组件进行可视化测试的方法。对于这一点，什么被证明是一个伟大的工具是反应本地的<a class="ae ki" href="https://storybook.js.org/tutorials/intro-to-storybook/react-native/en/get-started/" rel="noopener ugc nofollow" target="_blank">故事书。我已经熟悉了<strong class="jm io"> Storybook </strong>，它是一个强大的工具，用于在隔离模式下测试web项目的UI组件。然而，我不知道React的本地支持。最棒的是，它允许以两种不同的方式与组件交互:</a></p><ul class=""><li id="fada" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated">直接从设备仿真程序</li><li id="5263" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">从故事书服务器(可通过浏览器访问)</li></ul><p id="a7fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在项目中设置Storybook后，我创建了这些故事:</p><ul class=""><li id="e2bb" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated"><strong class="jm io">默认</strong>情况:最基本版本的组件，只有所需的道具</li><li id="c615" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated">一个<strong class="jm io">游乐场</strong>案例:由于<em class="kj">旋钮</em>的特性，在这里我允许定制所有可能的道具(包括背景颜色、输入大小等等)</li><li id="563c" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated"><strong class="jm io">常见</strong>用例:组件最典型配置的一组标准道具组合</li></ul><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/edca578d59b027bc95a5ba5790d3901d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/1*-m5ILJHOSYAKxF-w5c_PWA.gif"/></div><figcaption class="mx my gj gh gi mz na bd b be z dk">Component Playground built with Storybook for React Native</figcaption></figure></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="d222" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当一切都准备好并经过适当测试后，只差一件东西:名字。</p><p id="004f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在与一些朋友/开发伙伴进行了一次投票后，我最终得到了这个名字:<code class="fe ms mt mu mv b">react-native-quiz-input</code></p><p id="5df1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该图书馆现已在以下网站提供:</p><ul class=""><li id="ffdf" class="kw kx in jm b jn jo jr js jv ky jz kz kd la kh lb lc ld le bi translated"><a class="ae ki" href="https://github.com/antoniocosentino/react-native-quiz-input" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> GitHub </strong> </a></li><li id="a632" class="kw kx in jm b jn lf jr lg jv lh jz li kd lj kh lb lc ld le bi translated"><a class="ae ki" href="https://www.npmjs.com/package/react-native-quiz-input" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> npm </strong> </a></li></ul><p id="7570" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还希望有一个游乐场，让想在下载组件之前试用它的开发人员可以方便地进入。因此，我在Expo.io上创建了一个<a class="ae ki" href="https://snack.expo.io/@antoniocosentino/react-native-quiz-input-demo" rel="noopener ugc nofollow" target="_blank">小吃</a>，它允许你在真实的设备上甚至在浏览器中试用这个库，这要感谢<strong class="jm io"> React Native Web </strong>的支持。</p><p id="99f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kj">更多内容请看</em><a class="ae ki" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="kj">plain English . io</em></a></p></div></div>    
</body>
</html>