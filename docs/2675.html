<html>
<head>
<title>Create a Discord Bot with Node.js, Express, Eris, Replit, and UptimeRobot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Node.js、Express、厄里斯、Replit和UptimeRobot创建一个Discord Bot</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/panini-bot-f7025d014aab?source=collection_archive---------5-----------------------#2021-06-02">https://javascript.plainenglish.io/panini-bot-f7025d014aab?source=collection_archive---------5-----------------------#2021-06-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="80d2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">今天就把帕尼尼机器人加入你的不和谐服务器吧！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/63f3de0a916797f980dabd9be7bc0c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0tB5cbauvqEbVR2sSP04A.png"/></div></div></figure><p id="2e16" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我看到<a class="ae lk" href="https://twitter.com/TheCodePixi/status/1387755394722844672?s=20" rel="noopener ugc nofollow" target="_blank">Emi</a>关于开源<a class="ae lk" href="https://www.npmjs.com/package/pandera" rel="noopener ugc nofollow" target="_blank"> Pandera包</a>的推文时，我就知道这一定是一个不和谐机器人。所以，下面是我如何建立一个机器人，它将插入一个新词，以“p”开头，用于不和谐消息中“疫情”的每个实例。</p><p id="038b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我已经用<a class="ae lk" href="https://replit.com/" rel="noopener ugc nofollow" target="_blank"> replit </a>和<a class="ae lk" href="https://uptimerobot.com/" rel="noopener ugc nofollow" target="_blank"> UptimeRobot </a>制作了一个Python Discord bot，它可以给我的朋友发送狗的照片，所以我启动了一个<a class="ae lk" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> repl，并将其命名为Panini。你可以在这里查看<a class="ae lk" href="https://replit.com/@abbeyperini/Panini" rel="noopener ugc nofollow" target="_blank">现场代码</a>。</p><h1 id="f299" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">用Replit、UptimeRobot、Node.js、Express和厄里斯制造不和机器人</h1><p id="3cfc" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">为了让我的机器人存活，我在Node.js repl中首先需要一个<a class="ae lk" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a>服务器。在控制台中运行<code class="fe mi mj mk ml b">npm install express</code>之后，我向index.js添加了以下代码:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="a48f" class="mq lm in ml b gy mr ms l mt mu">// server imports<br/>const express = require('express');<br/>const app = express();<br/>const port = 3000;</span><span id="358e" class="mq lm in ml b gy mv ms l mt mu">// create main route<br/>app.get('/', (req, res) =&gt; res.send('Hello World!'));</span><span id="1a99" class="mq lm in ml b gy mv ms l mt mu">// instantiate server<br/>app.listen(port, () =&gt; console.log(`App is listening at <a class="ae lk" href="http://localhost:${port}`" rel="noopener ugc nofollow" target="_blank">http://localhost:${port}`</a>));</span></pre><p id="7a41" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我点击run时，我应该看到控制台上方弹出一个浏览器窗口，上面写着“Hello World！”以及控制台中的“App正在监听<a class="ae lk" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>”。我需要窗口顶部的URL来连接UptimeRobot并让Panini Bot保持活动状态。</p><p id="9bc9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在登录到我的UptimeRobot帐户并在我的仪表板中单击“Add New Monitor”后，我将其设置为HTTP(s) Monitor类型，给它一个友好的名称，从我的repl浏览器窗口输入URL，并将监视间隔设置为每5分钟。然后它会定期ping我的帕尼尼机器人服务器。你甚至可以让你的机器人在每次pings你的服务器并且服务器停机时给你发邮件！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/81a143f3327ca939042240f20142a5b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*g3UOlAEGMROiUVFQtyfEJQ.png"/></div></figure><p id="1f52" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我创建了一个不和谐的机器人，安装了<a class="ae lk" href="https://www.npmjs.com/package/eris" rel="noopener ugc nofollow" target="_blank">厄里斯包</a>并让我的帕尼尼机器人上线。</p><p id="1475" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了创建一个机器人，我登录了Discord并导航到https://discord.com/developers/applications。我点击“新建应用程序”并给我的机器人应用程序起了个名字。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/437785680e7f3ce1a5c95dab1f00794a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqjTns3unH2fEZI-FjJV8w.png"/></div></div></figure><p id="3b41" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我保存了应用程序ID供以后使用——这是bot令牌。事后，我还是不得不点击左边导航栏中的‘Bot’。添加一个机器人后，当我看到一个机器人屏幕显示“一个野生机器人出现了！”时，我知道我完成了</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi my"><img src="../Images/9137fc14c3f190e81d9d79b3b4743539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ulZsitCrcYy5iecDl7Bd2w.png"/></div></div></figure><p id="9eb2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我的机器人是活的，随时可以使用。如果你想确保没有其他人将你的机器人添加到服务器，请关闭“公共机器人”</p><p id="9f3a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">repl有一个secrets选项卡，它的工作方式就像一个<code class="fe mi mj mk ml b">dotenv</code>文件或secrets manager。你所要做的就是点击左边导航栏中的锁，你应该会看到这个屏幕:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mz"><img src="../Images/2d004d9965deb37c7524910508ba4647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCa80-7Fr4_GUfGjzXfQFA.png"/></div></div></figure><p id="52dd" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我将我的Discord应用程序id添加到值字段中。关键是您想要使用的变量名。我使用了<code class="fe mi mj mk ml b">bot_id</code>，所以我用<code class="fe mi mj mk ml b">process.env['bot_id']</code>访问我的机器人令牌。Repl甚至会为您将访问您的秘密所需的代码插入到您的文件中。</p><p id="1b67" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我运行<code class="fe mi mj mk ml b">npm install eris</code>并添加初始bot代码:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="57c3" class="mq lm in ml b gy mr ms l mt mu">const eris = require('eris');</span><span id="83bd" class="mq lm in ml b gy mv ms l mt mu">const bot = new eris.CommandClient(process.env['bot_id'], {}, {<br/>    description: "Returns your message with the word 'pandemic' replaced by a random word starting with the letter 'p.'",<br/>    owner: "Abbey Perini",<br/>    prefix: '!'<br/>});</span><span id="fcbf" class="mq lm in ml b gy mv ms l mt mu">// what the bot does when it's ready<br/>bot.on('ready', () =&gt; {<br/>    console.log('Connected and ready');<br/>});</span><span id="e7c8" class="mq lm in ml b gy mv ms l mt mu">// error 'handling'<br/>bot.on("error", (err) =&gt; {<br/>    console.error(err);<br/>});</span><span id="569e" class="mq lm in ml b gy mv ms l mt mu">// instantiate bot<br/>bot.connect();</span></pre><p id="db92" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，当我点击“运行”时，我会在控制台中看到“连接并就绪”。这也将我的代码连接到我的新的不和谐机器人，前缀所有的命令与感叹号，和！帮助命令将返回一条消息，包括上面定义的<code class="fe mi mj mk ml b">description</code>和<code class="fe mi mj mk ml b">owner</code>属性。</p><p id="292e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">充分披露:我最初写这个机器人与<code class="fe mi mj mk ml b">eris.Client()</code>和连锁异步功能！帕尼尼司令部。在我的第一轮用户测试——也就是让我的朋友打破它——之后，我倾向于使用厄里斯提供的工具，使用<code class="fe mi mj mk ml b">eris.CommandClient()</code>比使用新的<code class="fe mi mj mk ml b">eris.Client()</code>有一些很酷的好处:</p><p id="305e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mi mj mk ml b">description</code>和<code class="fe mi mj mk ml b">fullDescription</code>定义了！发送给用户的帮助命令。你只需要<code class="fe mi mj mk ml b">return</code>任何你想发送的信息来响应正在使用的命令。内置的参数也非常简洁。您不仅获得了一个具有有用属性的<code class="fe mi mj mk ml b">msg</code>对象，如<code class="fe mi mj mk ml b">username</code>和<code class="fe mi mj mk ml b">id</code>，还获得了<code class="fe mi mj mk ml b">args</code>参数，即命令后按空格分割的整个消息的数组。</p><p id="84a7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我注册了我的第一个命令，并测试了机器人是否在线:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="c2f8" class="mq lm in ml b gy mr ms l mt mu">const paniniSummon = bot.registerCommand("Panini", (msg, args) =&gt; {<br/>    return "Reporting for duty!";<br/>}, {<br/>        description: "Summon Panini Bot",<br/>        fullDescription: "If you want Panini Bot to replace the word 'pandemic' for you, start your message with this command."<br/>    })</span></pre><p id="0883" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我<a class="ae lk" href="https://discordjs.guide/preparations/adding-your-bot-to-servers.html#bot-invite-links" rel="noopener ugc nofollow" target="_blank">创建了一个邀请链接</a>并邀请Panini Bot加入我的Bot测试服务器。我建议做一个用于bot测试的服务器或者通道，尤其是刚开始的时候。添加我的机器人后，我发送了一条消息，内容为！帕尼尼，它回复了一条信息说“报到！”</p><h1 id="cbcb" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">制作帕尼尼机器人</h1><p id="fe6e" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我想让帕尼尼机器人看到一条消息！Panini命令，删除该消息，然后发送新消息。新消息应该提到用户，然后是他们的原始消息，但一个以“p”开头的全新单词将取代“疫情”或“疫情”的所有实例当我最初编写我的<code class="fe mi mj mk ml b">createMessage</code>函数时，它用相同的随机p-word替换了所有“疫情”的实例。出于这个博客的目的，我们将跳到帕尼尼机器人2.1。</p><p id="99fc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在用户测试后，我意识到我需要别名命令，这样用户也可以使用！帕尼尼。此外，我很快发现，如果命令后面没有消息体，或者它没有包括“疫情”的至少一个实例，我需要Panini Bot发送一条错误消息经过一番努力让这个机器人在我自己建立的服务器上运行，我想添加一个权限错误消息。最重要的是，我的朋友们立刻把它变成了一个疯狂的Libs机器人，所以我知道我必须重写<code class="fe mi mj mk ml b">createMessage</code>,这样,“疫情”的每一个实例都会被不同的p-word替换。</p><p id="cbba" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先是新命令别名:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="a515" class="mq lm in ml b gy mr ms l mt mu">// Alias !halp to !help<br/>bot.registerCommandAlias("halp", "help");<br/>// Alias !panini to !Panini<br/>bot.registerCommandAlias("panini", "Panini")</span></pre><p id="53c9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我安装了Pandera ( <code class="fe mi mj mk ml b">npm install pandera</code>)并添加了我的导入声明:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="9b07" class="mq lm in ml b gy mr ms l mt mu">const pandera = require('pandera');</span></pre><p id="e736" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当我调用<code class="fe mi mj mk ml b">pandera()</code>时，它会随机返回1个p字。</p><p id="1986" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我写了一个数组，这样机器人就可以检查“疫情”是否在消息体中:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="cde4" class="mq lm in ml b gy mr ms l mt mu">const pandemicsArray = ['pandemic', 'Pandemic', 'pandemic!', 'Pandemic!', 'pandemic?', 'Pandemic?', 'pandemic.', 'Pandemic.', 'pandemic,', 'Pandemic,', 'pandemic:', 'Pandemic:', 'pandemic;', 'Pandemic;', '"pandemic"', '"Pandemic"', "'pandemic'", "'Pandemic'"];</span></pre><p id="fff9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在让我们重写<code class="fe mi mj mk ml b">paniniSummon</code>命令:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="a12c" class="mq lm in ml b gy mr ms l mt mu">const paniniSummon = bot.registerCommand("Panini", (msg, args) =&gt; {<br/>    console.log(msg.id, msg.content, msg.author.username, msg.channel.id);</span><span id="8bb3" class="mq lm in ml b gy mv ms l mt mu">  let includesPan = false;<br/>  for (i = 0; i &lt; args.length; i++) {<br/>      if (pandemicsArray.includes(args[i])) {<br/>            includesPan = true;<br/>      }<br/>  }</span><span id="475e" class="mq lm in ml b gy mv ms l mt mu">  if (args.length === 0) {<br/>      return "No message to edit. Use the command '!help' for more information.";<br/>  } else if (!includesPan) {<br/>      return "No instance of 'pandemic' to replace. Use the command '!help' for more information.";<br/>  }</span><span id="f534" class="mq lm in ml b gy mv ms l mt mu">  deleteOldMessage(msg)</span><span id="3d06" class="mq lm in ml b gy mv ms l mt mu">  return formatNewMessage(msg, args);<br/>}, {<br/>      description: "Summon Panini Bot",<br/>      fullDescription: "If you want Panini Bot to replace the word 'pandemic' for you, start your message with this command."<br/>    })</span></pre><p id="1976" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在几轮用户测试之后，我开始<code class="fe mi mj mk ml b">console.log</code>-在任何东西被替换之前收集关于消息的信息，并在消息体被格式化之后收集信息。是我对“疫情”这个词的检查因为<code class="fe mi mj mk ml b">args</code>是一个单词数组，所以很容易迭代并对照我的<code class="fe mi mj mk ml b">pandemicsArray</code>检查每个单词。</p><p id="3e30" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mi mj mk ml b">if</code>模块首先检查命令后是否有任何消息，然后检查<code class="fe mi mj mk ml b">includesPan</code>是否为真。如果两者都不成立，将向用户返回一条包含更多信息的错误消息。接下来，我调用<code class="fe mi mj mk ml b">deleteOldMessage</code>并传递整个<code class="fe mi mj mk ml b">msg</code>对象。然后我调用<code class="fe mi mj mk ml b">formatNewMessage</code>并传递<code class="fe mi mj mk ml b">msg</code>对象和<code class="fe mi mj mk ml b">args</code>数组。无论我从<code class="fe mi mj mk ml b">formatNewMessage</code>得到什么，都将作为新的不和谐信息返回。</p><p id="c682" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mi mj mk ml b">deleteOldMessage</code>从帕尼尼机器人1.0到帕尼尼机器人2.0几乎没有什么变化:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="c771" class="mq lm in ml b gy mr ms l mt mu">async function deleteOldMessage(msg) {<br/>    const channel = msg.channel.id;<br/>    await bot.deleteMessage(channel, msg.id, "replace the word 'Pandemic'")<br/>        .catch((error) =&gt; { // error message<br/>            if (error.message === "Missing Permissions") {<br/>                sendPermissionsError(channel);<br/>            }<br/>        });<br/>}</span></pre><p id="77f4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">当在命令中调用<code class="fe mi mj mk ml b">deleteOldMessage</code>时，我需要来自<code class="fe mi mj mk ml b">msg</code>对象的通道id，并添加了如下所示的<code class="fe mi mj mk ml b">sendPermissionsError</code>函数:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="ccac" class="mq lm in ml b gy mr ms l mt mu">async function sendPermissionsError(channel) {<br/>    await bot.createMessage(channel, "Panini Bot needs the Manage Messages permission to delete replaced messages. <a class="ae lk" href="https://support.discord.com/hc/en-us/articles/206029707-How-do-I-set-up-Permissions" rel="noopener ugc nofollow" target="_blank">https://support.discord.com/hc/en-us/articles/206029707-How-do-I-set-up-Permissions</a>");<br/>}</span></pre><p id="4292" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">帕尼尼机器人将需要“管理消息”权限，以便它可以在替换旧消息之前删除旧消息。帕尼尼机器人所在的任何服务器要么必须让用户在频道级别管理其他用户的消息，要么让帕尼尼成为管理员。我还使用<a class="ae lk" href="https://discordapi.com/permissions.html" rel="noopener ugc nofollow" target="_blank">这个计算器</a>将权限添加到我的discord bot邀请链接中。</p><p id="6756" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，是时候格式化帕尼尼机器人发送回来的新消息了——又名疫情疯狂Libs。</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="8108" class="mq lm in ml b gy mr ms l mt mu">function formatNewMessage(msg, args) {<br/>  const author = msg.author.id;</span><span id="a59b" class="mq lm in ml b gy mv ms l mt mu">  let numOfP = 0;<br/>  for (i = 0; i &lt; args.length; i++) {<br/>     if (pandemicsArray.includes(args[i])) {<br/>         numOfP++;<br/>     }<br/>  }</span><span id="6bd9" class="mq lm in ml b gy mv ms l mt mu">  let pArray = [];<br/>  for (i = 0; i &lt; numOfP; i++) {<br/>      let newP = pandera();<br/>    pArray.push(newP);<br/>  }</span><span id="0952" class="mq lm in ml b gy mv ms l mt mu">  let pIndex = 0;<br/>  for (i = 0; i &lt; args.length; i++) {<br/>  if (pandemicsArray.includes(args[i])) {<br/>    let index = args.indexOf(args[i]);<br/>    let oldArg = args[i];<br/>    let newArg = oldArg.replace(/pandemic/gi, pArray[pIndex]);<br/>    args[index] = newArg;<br/>    pIndex++;<br/>    }<br/>  }</span><span id="f506" class="mq lm in ml b gy mv ms l mt mu">  let messageBody = args.join(" ");<br/>  let fullMessage = `&lt;@${author}&gt; says "${messageBody}"`;<br/>  console.log(fullMessage);<br/>  return fullMessage;<br/>}</span></pre><p id="0db2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我想提到用户，所以我从<code class="fe mi mj mk ml b">msg</code>对象中提取用户的id。Discord提语法是<code class="fe mi mj mk ml b">&lt;@userID&gt;</code>，所以函数末尾的模板文字我会<code class="fe mi mj mk ml b">return</code>以<code class="fe mi mj mk ml b">&lt;@${author}&gt;</code>开头。</p><p id="2177" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后，我使用<code class="fe mi mj mk ml b">.includes()</code>和我们的老伙伴<code class="fe mi mj mk ml b">pandemicsArray</code>做了一个<code class="fe mi mj mk ml b">for</code>循环来获得消息体中“疫情”的实例数。</p><p id="e4d7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">接下来，我编写了一个<code class="fe mi mj mk ml b">for</code>循环来填充相同数量的新p字数组。</p><p id="ce88" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，我编写了一个<code class="fe mi mj mk ml b">for</code>循环，用一个唯一的p-word替换“疫情”的每个实例。正则表达式<code class="fe mi mj mk ml b">/pandemic/gi</code>将基于<code class="fe mi mj mk ml b">pIndex</code>计数器用来自<code class="fe mi mj mk ml b">pArray</code>的一个字替换疫情的每个实例，并且不区分大小写。这意味着它会留下用户的标点符号，即使<code class="fe mi mj mk ml b">args[i]</code>有点像“疫情！”或者“疫情”</p><p id="c97a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在这一点上，它起作用了，但是我看着三个<code class="fe mi mj mk ml b">for</code>循环，知道一定有其他方法。我联系了两位开发人员，他们总是愿意带我了解编码概念，<a class="ae lk" href="https://twitter.com/KirkCodes" rel="noopener ugc nofollow" target="_blank"> Kirk </a>和<a class="ae lk" href="https://github.com/alyons" rel="noopener ugc nofollow" target="_blank"> Alex </a>。</p><p id="b8f6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">杰出的函数式程序员Kirk提醒我,<code class="fe mi mj mk ml b">map</code>的存在是有原因的，并把它框定为数组的变换。以下是他的解决方案:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="b4af" class="mq lm in ml b gy mr ms l mt mu">function formatNewMessage(msg, args) {<br/>  const author = msg.author.id;</span><span id="86bc" class="mq lm in ml b gy mv ms l mt mu">  const pandemicReplacer = (word) =&gt; {<br/>    if (pandemicsArray.includes(word)) {<br/>      return word.replace(/pandemic/gi, pandera())<br/>    }<br/>      return word<br/>    }</span><span id="4e1a" class="mq lm in ml b gy mv ms l mt mu">  const messageBody = args.map(pandemicReplacer).join(" ");<br/>  let fullMessage = `&lt;@${author}&gt; says "${messageBody}"`;<br/>    <br/>  return fullMessage;<br/>}</span></pre><p id="a801" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">高级DevOps工程师兼云基础架构向导Alex选择将整个消息作为一个字符串来处理，而不是一组单词:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="7474" class="mq lm in ml b gy mr ms l mt mu">function formatMessageExAid(msg, args) {<br/>  const author = msg.author.id;<br/>  let messageBody = args.join(" ");<br/>  let newMsg = `&lt;@${author}&gt; says "${messageBody}"`;</span><span id="b2bd" class="mq lm in ml b gy mv ms l mt mu">  while (newMsg.includes('pandemic')) {<br/>    newMsg = newMsg.replace(/pandemic/i, pandera());<br/>  }</span><span id="dcf1" class="mq lm in ml b gy mv ms l mt mu">  return newMsg;<br/>}</span></pre><h1 id="5421" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">结论</h1><p id="3f89" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我喜欢在repl中工作，不仅因为我可以从我的手机上检查机器人，还因为我可以邀请其他开发人员进行合作。有几个功能我犹豫要不要加入帕尼尼机器人。我选择不考虑大小写，但是我可以添加关闭权限错误消息和/或<code class="fe mi mj mk ml b">deleteOldMessage</code>的选项。如果你对这个或帕尼尼机器人的任何其他部分有想法，请在评论中分享！</p><p id="2f6d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">帕尼尼机器人建造起来非常有趣！超级特别感谢<a class="ae lk" href="https://twitter.com/TheCodePixi" rel="noopener ugc nofollow" target="_blank"> Emi </a>和<a class="ae lk" href="https://twitter.com/yechielk" rel="noopener ugc nofollow" target="_blank"> Yechiel </a>首先建造了Pandera。一如既往，感谢柯克和亚历克斯的鼓励和教育在同一时间。</p><p id="2ba2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><a class="ae lk" href="https://discord.com/oauth2/authorize?client_id=845293659712389120&amp;scope=bot&amp;permissions=8192" rel="noopener ugc nofollow" target="_blank">立即将帕尼尼机器人添加到您的Discord服务器！</a></p><p id="71ed" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="na">更多内容请看</em><a class="ae lk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="na">plain English . io</em></a></p></div></div>    
</body>
</html>