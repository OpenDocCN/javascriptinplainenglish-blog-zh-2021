<html>
<head>
<title>Load Testing HTTP APIs with ApiZapi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用ApiZapi负载测试HTTP APIs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/load-testing-http-apis-with-apizapi-3e2ac01ea5c8?source=collection_archive---------17-----------------------#2021-09-10">https://javascript.plainenglish.io/load-testing-http-apis-with-apizapi-3e2ac01ea5c8?source=collection_archive---------17-----------------------#2021-09-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/02dd0d165bdc3aaff86aeba9f4eeadb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vI11_TL4egQKtb8d2OIeRQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Image courtesy of Ryan Fields, on Unsplash <a class="ae jz" href="https://unsplash.com/photos/Xz7MMD5tZwA" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/Xz7MMD5tZwA</a></figcaption></figure><p id="ea42" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ApiZapi概述，这是一个新的HTTP API负载测试SaaS应用程序，用于在不断增加的虚拟用户负载下运行基于场景的测试。</p><p id="4db9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">注意:我是</em> <a class="ae jz" href="https://apizapi.com" rel="noopener ugc nofollow" target="_blank"> <em class="ky"> ApiZapi </em> </a> <em class="ky">负载测试工具的创建者和开发者，我写这篇文章是为了向其他人介绍该工具的一般功能。</em></p><h1 id="f18d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">概观</h1><p id="ad53" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">ApiZapi是一个云托管的服务，允许您在HTTP API端点上执行基于场景的测试，并通过模拟成千上万的用户交互来增加负载。该工具将涵盖直接负载测试、峰值和断点测试。使用该应用程序，您可以指定一系列HTTP调用，这些调用代表了您希望发送到API端点的交互的真实使用情况。我们的目标是模拟用户的真实交互，并同时与多个虚拟用户(vu)大规模运行这些交互。结果是您将基础设施置于现实的负载之下。这些交互构成了工作负载。您还可以配置初始化和关闭序列。作为初始化序列的一部分，您可以调用创建帐户和/或登录将在工作负荷运行期间使用的帐户。</p><p id="4ac5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">ApiZapi可用于发现单点故障和瓶颈。最好将它与您的日志记录基础设施和其他应用程序性能管理工具结合使用，以进一步诊断负载测试中的问题。然后由您来改变您的架构，调整您的主机来处理您的理想正常负载，并测试您是否也可以处理可能的峰值负载使用。随着客户使用流量的增加，您希望走在客户使用流量的前面，并知道自己的极限是什么。测试可以手动运行，也可以每天触发。测试也可以通过HTTP POST调用作为CI/CD管道的一部分启动。Webhook用于将完成状态接收回您的CI/CD环境。</p><h1 id="9b25" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">入门指南</h1><p id="bc61" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">注册非常容易，只需输入电子邮件和密码(在测试期结束前需要一个加入代码)，你就可以使用一个免费版本，它具有大多数相同的功能，但有一些限制。</p><p id="8cee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要享受全部功能，您需要转到个人资料页面并切换计划。您将不会被收取任何月费，您只需支付当月所有测试运行的使用秒数。例如，如果你一整个月都没有运行任何测试，那么这个月是不收费的。</p><p id="7b23" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以查看一个仪表板视图，其中显示了本月的最新费用以及过去几个月的视图。您也可以在这里输入金额来设置收费限额。如果你达到了这个限额，你将不能再运行那个月的任何测试，除非你增加你的花费限额。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/4617bdc837ed2125ef4f18d36f6dd8f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y8XeYIz8sj0Y9fmCFvN0bw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Dashboard view (All screen shots from apizapi.com)</figcaption></figure><h1 id="677d" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">网站访问的验证</h1><p id="9cae" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">一旦您创建了一个测试，您可以点击编辑它，然后最终运行它。如果您将它设置为在多达二十个虚拟用户(vu)的情况下运行，这是正确的。对于VU计数大于20，这是需要你证明你有访问测试您的网站。为了防止ApiZapi被用作DDoS攻击平台，我们要求您提供一个特殊的DNS TXT条目，以证明您有权在您的api端点上执行负载测试。或者，您可以提供一个文件供ApiZapi访问。该文件将是一个JSON文件，其中包含一个特定的id。点击<strong class="kc io">现场验证</strong>按钮，了解如何完成此操作的详细信息。</p><p id="bfe5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:<em class="ky">值得一提的是，您可以使用ApiZapi来测试运行在本地机器上的api端点。这很容易做到。简单地输入要连接的IP地址和端口，例如“http://42.27.0.33:3000”。用</em><a class="ae jz" href="http://checkip.amazonaws.com/" rel="noopener ugc nofollow" target="_blank"><em class="ky"/></a><em class="ky">看看你的IP地址是什么。然后，您可以在本地机器上运行您的服务，比如Node.js Express services，并开始与它进行交互。您很可能在您的实际机器前面有一个防火墙或某种类型的路由器。例如，使用家用路由器，您可以设置从实际的外部IP地址到实际的内部机器IP地址和端口的端口转发。如果将VUs设置为大于20，还必须提供要访问的apizapiverify.json文件。你可以先用浏览器测试一下能不能拿到文件。</em></p><h1 id="bc85" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">查看负载测试</h1><p id="2b83" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">您可以看到一个测试列表，其中包含每个测试的一些高级细节。每一测试行的末尾都有图标操作，您可以单击这些图标操作。从现有测试列表中，您可以单击一个测试来导航到运行页面，或者导航到编辑页面。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/b6b519d5661d49d3c256e6e008fc142f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-VuQqJnqRcO5B3P9TMctA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Test list view</figcaption></figure><h1 id="803c" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">负载测试编辑</h1><p id="9559" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">您将点击<strong class="kc io"> Add Test </strong>来创建一个新的负载测试。从这里开始，UI中有许多选项卡，您可以填写这些选项卡来指定应该发生什么。<strong class="kc io">配置</strong>是对你将要点击的服务器主机的主设置，运行时间间隔和缩放数字。<strong class="kc io">触发器</strong>用于设置循环运行以及设置Webhooks进入和退出，用于外部触发或接收运行完成的通知。<strong class="kc io">代理扇出</strong>用于设置AWS区域的使用，呼叫将通过这些区域路由，以便能够模拟来自世界各地的流量。<strong class="kc io">运行时数据</strong>是您设置内部变量的地方，既可以跨所有VU使用，也可以针对每个VU使用。最后两个选项卡用于添加实际的工作负载HTTP调用。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/aa3421272183044af59014645769f139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yjQWP4usOaxdzoEW3vnc3w.png"/></div></div></figure><h1 id="3805" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">HTTP呼叫</h1><p id="c2c0" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">通话可以作为一张“卡片”放入几个列表中。对于需要在主工作负载卡列表之前和之后发生的调用，有初始化和关闭列表。每张卡代表一个单独的HTTP呼叫。对于每张卡，您指定呼叫和预期结果。</p><p id="e729" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">工作负荷初始化-关闭</strong>卡按顺序运行。当vu(虚拟用户)因为步数缩放而开始行动时，每个人都将独自完成他们的序列。工作负载初始化卡在VU扩展引入它们时运行。例如，最初可能有20个vu，所有的vu都做第一张卡，然后在另一个步骤间隔，另一组20个vu做它们的init步骤。这些按顺序运行，每个VU仅运行一次。</p><p id="ea5d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">卡的<strong class="kc io">工作负荷</strong>序列将在初始化序列完成后运行。工作负载卡是随机运行的，不像初始化和关闭顺序卡那样按顺序运行。你仍然可以拖动卡片，但是，这只是为了方便你。对于给定的间隔触发，每个虚拟用户将有一张随机选择的卡，用于将要进行的HTTP调用。</p><p id="e104" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以使用每个卡上的切换控件来启用和禁用各个卡。还有一组标有<strong class="kc io">低</strong>、<strong class="kc io">中、</strong>和<strong class="kc io">高</strong>的单选按钮。这将为每个设置权重，以确定每个调用的频率。工作量卡之后还可以是需要按顺序进行的二次呼叫，这些可以在<strong class="kc io">二次呼叫</strong>列表中找到。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/782c47b9424f8d458363961866622ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DJo52TbaUrfVdW2bPUsDcg.png"/></div></div></figure><p id="1df1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用于工作卡使用的<strong class="kc io">呼叫详细信息</strong>对话框相当简单。您为所选的主机设置想要访问的路径。可以设置头值，包括cookies等。如果动词是POST，那么您还可以为该调用指定一个JSON主体。使用${globalContext引入变量有一个特殊的语法。？？？}和${userContext。？？？}.这些值要么是预先在UI中设置的，要么是在每次调用的结果处理中保存的。每个虚拟用户都有自己的上下文，以及变量的全局共享上下文。这里看到的用户上下文变量的一个例子是令牌。这表示一个JWT令牌，该令牌是从先前的卡调用中设置的，该卡调用某个授权路由，该授权路由返回JWT。响应中返回的Cookies会被保留下来，并在后续调用中重用，就像浏览器交互一样。还有一种方法可以提取cookie的值并重用它。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/d3875a4d29698245944021605501325e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ofR1g_hgck_fNXjwUMFxWw.png"/></div></div></figure><p id="84e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您将<strong class="kc io"> HTTP动词</strong>更改为POST或PUT，您可以添加一个要作为请求的一部分发送的主体。可以发送JSON，Text，x-www-form-urlencoded，form-data等。这意味着您也可以通过发送文件。您还可以从响应中收集数据，并将其保存在用户或全局上下文中，然后以JSON、text、HTML或XML的形式发送回来。</p><p id="7358" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<strong class="kc io">响应处理</strong>对话框中，您可以获取标题或正文响应值，并将它们保存到全局和用户上下文中。您还可以对身体、响应状态和平均时间进行测试。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/83a5840c869b8317fcf099e31b20f9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9pMxZUQgY0EL-b4dTGmDAQ.png"/></div></div></figure><h1 id="8c0f" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结果视图</h1><p id="cfd7" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">可以查看给定运行的结果，以准确理解负载结果，并确定结果和成功。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/c22d732cc00a8a4fa8ec1bda2f70c77b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEdz_kScXIQQk4hfDHRjIg.png"/></div></div></figure><p id="3c31" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以查看<strong class="kc io">卡统计</strong>选项卡，了解有关如何执行单个呼叫的具体细节。“状态”列给出了给定卡的总体信息，以确定它是否符合您的预期。如果超过了平均响应时间阈值，或者在处理返回时出现任何错误(如意外的状态代码)，它将处于失败状态。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/0432dfb0172fe3f5d29f3cfa47624d5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*RXGWwQpa85vkuQLEugqYsA.png"/></div></figure><p id="48c6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以查看<strong class="kc io">返回代码</strong>选项卡，了解关于故障的具体细节。这些可能是失败，因为返回的代码不是您所期望的。这为您提供了错误发生的时间、当时的虚拟用户数以及其他有助于您解决问题的详细信息。您可以在图中看到，这个特定的错误是服务器返回“错误网关”，并且只在虚拟用户数达到20K时发生。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/b74a49310869765c2c5a24c5107d1a1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tCujr_NNcAxxbd8gHSqTjQ.png"/></div></div></figure><h1 id="83ca" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结论</h1><p id="5789" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">在这篇短文中，还有更多的内容需要讨论。希望你现在对基本原理有了很好的理解。如果您有更多的时间，并且想要更深入地了解这些功能和一些用例，请访问<a class="ae jz" href="https://www.apizapi.com/#/userdoc" rel="noopener ugc nofollow" target="_blank">用户文档</a>。</p><p id="da80" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容尽在</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">plain English . io</em></strong></a></p></div></div>    
</body>
</html>