<html>
<head>
<title>Integration &amp; Unit Testing For Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js的集成和单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/integration-unit-testing-for-node-js-5d44b588cd17?source=collection_archive---------10-----------------------#2021-04-10">https://javascript.plainenglish.io/integration-unit-testing-for-node-js-5d44b588cd17?source=collection_archive---------10-----------------------#2021-04-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="874d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用摩卡和柴☕️测试Node &amp; Express项目的初学者指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/261c54ac61a45e2524cd57a9ca885f7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5_pqCzTrn6e0ERbk"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@sincerelymedia?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sincerely Media</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="edfa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">软件测试验证我们的代码按预期工作，并且满足它需要的技术、功能和用户需求。测试是开发任何软件的一个重要部分，但是作为一个学习和发展他们技能的领域，它经常被新工程师忽略。通常情况下，很难找到好的教程、指南或博客文章来解释代码项目的不同类型的测试，以及如何实际编写这些测试。</p><p id="fc7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，我想回顾一下在软件测试中经常出现的一些重要词汇，以及它们的含义:</p><h2 id="6ab4" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated"><strong class="ak">单元测试</strong></h2><p id="fce6" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">单元测试是对程序的最小“单元”或组件的测试。在大多数情况下，被测试的最小单元是一个函数。因此，在这些情况下，我们正在测试以确保我们的单个功能按预期工作。</p><p id="b194" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">单元测试是在任何其他类型的软件测试之前执行的，通常开发人员有责任进行和编写这些测试。</p><h2 id="ac68" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated"><strong class="ak">集成测试</strong></h2><p id="3c14" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">集成测试是对提供给定功能的一组相关代码单元组合的测试。在这种情况下，我们正在测试单元之间的交互中可能出现的错误。</p><p id="6028" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">集成测试也可能是开发人员的责任，但是让独立的测试人员参与集成测试并不罕见。</p><p id="2837" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个例子中，我们将检查一个节点的单元和集成测试。Js &amp; Express API项目。我们的示例项目的主要功能是用一个随机数响应GET HTTP请求，这并不太重要，因为主要的焦点是测试。</p></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h1 id="0ed9" class="mu lq in bd lr mv mw mx lu my mz na lx jt nb ju ma jw nc jx md jz nd ka mg ne bi translated">工具</h1><h2 id="3273" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">Node.js &amp; Express🔥</h2><p id="8c82" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">我们将创建一个简单的Node.js应用程序，它使用<a class="ae ks" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express.js </a>框架来创建一个迷你API。这只是为了举例，将作为测试中的代码。</p><p id="cffd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有关这两者的更多信息，请查看<a class="ae ks" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>和<a class="ae ks" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express.js </a>文档。</p><h2 id="3338" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">摩卡☕️</h2><p id="9479" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">Mocha是一个灵活的开源JavaScript测试框架，运行在Node.js上。它用于测试同步和异步代码，并很好地将测试结果记录到控制台。Mocha既可以用于单元测试，也可以用于集成测试。</p><p id="30c7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Mocha可以与大多数<a class="ae ks" href="https://stackoverflow.com/questions/25678063/whats-the-difference-between-assertion-library-testing-framework-and-testing-e/25678226#25678226" rel="noopener ugc nofollow" target="_blank">断言库</a>(一个负责验证测试结果的工具)一起使用，但是与Mocha一起使用的最流行的Node.js断言库叫做Chai。</p><h2 id="58ff" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">柴&amp;柴-http</h2><p id="27f5" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">Chai是一个行为/测试驱动的设计断言库，在Node.js测试中经常与Mocha一起使用。Chai-http是Chai的一个插件，它允许我们用Chai编写http集成测试。</p><p id="eaf2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">以热饮为主题的两个人一起工作，创造了一个测试Node.js &amp; Express项目的好方法。</p></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h1 id="a244" class="mu lq in bd lr mv mw mx lu my mz na lx jt nb ju ma jw nc jx md jz nd ka mg ne bi translated">该设置</h1><p id="42e6" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">需求:<a class="ae ks" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js安装</a>。</p><p id="45ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了最好地演示测试，我们需要一些代码来测试。</p><p id="b524" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nf">(如果您使用本教程作为测试现有项目的指南，那太好了！您不需要创建这个项目，但是测试应该遵循相同的原则。)</em></p><p id="0f3b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，创建一个新的Node.js项目(创建一个新文件夹并从那里运行<code class="fe ng nh ni nj b">npm init</code>)。之后，继续使用<code class="fe ng nh ni nj b">npm install express</code>安装express。</p><p id="9ceb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，我们将创建我们的<code class="fe ng nh ni nj b">server.js</code>文件，它将保存我们的示例应用程序的所有逻辑:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="221e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们的节点应用程序在<code class="fe ng nh ni nj b">localhost:3000</code>监听，并公开一个返回随机数的端点<code class="fe ng nh ni nj b">/random</code>。您可以通过运行您的应用程序(<code class="fe ng nh ni nj b">npm start</code>)并在浏览器中导航到<code class="fe ng nh ni nj b">localhost:3000</code>来尝试一下。</p></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h1 id="f04b" class="mu lq in bd lr mv mw mx lu my mz na lx jt nb ju ma jw nc jx md jz nd ka mg ne bi translated">测试</h1><p id="0c48" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">现在是测试的时候了！</p><p id="9aa3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为了正确设置，我建议你创建一个<code class="fe ng nh ni nj b">test</code>子文件夹来保存这个应用程序的所有测试文件。</p><p id="2125" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，我们需要通过运行以下命令来安装测试库:</p><pre class="kd ke kf kg gt nm nj nn no aw np bi"><span id="2623" class="lp lq in nj b gy nq nr l ns nt">npm install mocha chai chai-http</span></pre><p id="7de2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">确保在我们的<code class="fe ng nh ni nj b">package.json</code>中，我们已经将Mocha添加到我们的测试脚本中，如下所示:</p><pre class="kd ke kf kg gt nm nj nn no aw np bi"><span id="d900" class="lp lq in nj b gy nq nr l ns nt">...<br/>  "main": "server.js",   <br/>  "scripts": { <br/>    "start": "node server.js",<br/>    "test": "mocha"<br/>  },   <br/>  "author": "",<br/>...</span></pre><p id="ffb6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这意味着现在我们只需要在想要运行测试时运行<code class="fe ng nh ni nj b">npm test</code>。我们现在已经设置好了，准备编写我们的第一个单元测试。</p><h2 id="296a" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">单元测试</h2><p id="69e5" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">如前所述，单元测试就是测试单个的功能。在我们的示例代码中，我们将编写一个单元测试，检查我们的<code class="fe ng nh ni nj b">getRandom</code>函数是否做了它应该做的事情，并生成一个0到100之间的随机整数。</p><p id="7324" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们首先需要chai和chai.assert来获取我们的断言库。然后，我们描述被测函数，调用该函数，并对结果进行断言。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="f594" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这里，<code class="fe ng nh ni nj b">describe</code>函数封装了我们的测试。第一个参数是一个描述我们正在测试的内容的字符串(为了举例，我称之为‘单元测试’，但是传递类似‘get random random number generation’这样的东西会更有描述性)。</p><p id="759d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">传递的第二个参数是作为测试主体的函数。它以一个<code class="fe ng nh ni nj b">it</code>函数开始，类似于<code class="fe ng nh ni nj b">describe</code>函数，描述测试。这里，我们给出了我们正在测试的功能的一个小描述，或者预期的功能是什么。第二个参数是另一个函数，在这个函数中，我们实际上可以编写我们的测试代码。</p><p id="9e22" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个例子中，我们使用的是<code class="fe ng nh ni nj b">assert</code>断言风格，但是Chai提供了其他风格的断言，比如<code class="fe ng nh ni nj b">should</code>或者<code class="fe ng nh ni nj b">expect</code>。你可以在<a class="ae ks" href="https://www.chaijs.com/guide/styles/" rel="noopener ugc nofollow" target="_blank">柴断言风格指南</a>中找到它们之间的区别。</p><p id="2d68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当这个测试运行时，我们的<code class="fe ng nh ni nj b">getRandom</code>函数被调用，测试对结果进行断言。我们断言(验证)返回的结果(<code class="fe ng nh ni nj b">random</code>)不为空，是一个数字，至少为0，但不超过100。如果所有这些断言都通过了，那就意味着我们的代码按照预期的方式运行，并且我们的单元通过了单元测试。</p><h2 id="7845" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">集成测试</h2><p id="027a" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">测试我们的API端点的功能构成了一个集成测试，因为我们正在测试当我们的<code class="fe ng nh ni nj b">/random</code>端点被点击时，我们的程序的所有独立部分如何一起工作来发送一个响应。为了做到这一点，我们需要使用<code class="fe ng nh ni nj b">chai-http</code>。这个包允许我们在测试期间向服务器发出HTTP请求。</p><p id="c4e7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于使用了异步代码并承诺实现这一功能，我们不得不以稍微不同的方式对待这一代码的集成测试。我们在调用和测试我们的异步代码的<code class="fe ng nh ni nj b">it</code>函数内部传递一个回调(和以前一样)。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="447e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe ng nh ni nj b">chai-http</code>允许我们通过传入应用程序来构造对应用程序的请求。这将自动打开我们的服务器来接收请求。然后我们可以使用<code class="fe ng nh ni nj b">.get()</code>来调用我们的<code class="fe ng nh ni nj b">/random</code>端点。然后使用<code class="fe ng nh ni nj b">end</code>方法发出请求并断言响应。</p><p id="0a0b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因为<code class="fe ng nh ni nj b">end</code>函数是一个回调函数，我们必须使用<code class="fe ng nh ni nj b">done</code>回调函数来向Mocha表明我们的回调函数已经完成，断言已经准备好被验证。如果我们不这样做，测试将在断言被检查之前通过。</p><p id="fbfd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们检查我们的响应包含一个成功的状态代码，并且响应返回的数字不为空，是一个数字，至少为0但不大于100(没有变化)。</p><p id="eb59" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这个集成测试中，我们不仅要确保从我们期望的API端点获得响应，还要确保我们的API在响应GET请求时，整体上表现得像预期的一样。这是在测试我们的应用程序的多个“单元”如何一起提供这种功能。</p></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><p id="6370" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">就是这样！我们已经完成了迷你API的单元测试和集成测试。</p><p id="7e6c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">虽然这是一个简化的示例，但是您可以使用这些作为模板，继续测试您自己的更深入的Node &amp; Express项目。实现保持不变，但是您可以进一步开发这些示例测试并复制它们，以便测试更大更复杂的程序。</p><p id="815b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面我链接了Node.js中其他一些关于单元和集成测试的优秀指南，以及Mocha &amp; Chai的官方文档。测试愉快！</p></div><div class="ab cl mn mo hr mp" role="separator"><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms mt"/><span class="mq bw bk mr ms"/></div><div class="ig ih ii ij ik"><h2 id="1524" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">资源</h2><ul class=""><li id="3498" class="nu nv in kv b kw mi kz mj lc nw lg nx lk ny lo nz oa ob oc bi translated">使用Mocha &amp; Chai在Node.js中进行单元测试—<a class="ae ks" href="https://livecodestream.dev/post/testing-in-nodejs-using-mocha-and-chai-part-1/" rel="noopener ugc nofollow" target="_blank">https://livecodestream . dev/post/Testing-in-nodejs-using-Mocha-and-Chai-part-1/</a></li><li id="f422" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">Node.js与Mocha &amp; Chai的集成测试—<a class="ae ks" href="https://livecodestream.dev/post/testing-in-nodejs-using-mocha-and-chai-part-2/" rel="noopener ugc nofollow" target="_blank">https://livecodestream . dev/post/Testing-in-nodejs-using-Mocha-and-Chai-part-2/</a></li><li id="f6fb" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">使用Mocha &amp; Chai进行JavaScript测试—<a class="ae ks" href="https://codeburst.io/javascript-unit-testing-using-mocha-and-chai-1d97d9f18e71" rel="noopener" target="_blank">https://code burst . io/JavaScript-unit-Testing-using-Mocha-and-Chai-1d 97d 9 f 18 e 71</a></li><li id="385e" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">Node.js的单元和集成测试—<a class="ae ks" href="https://blog.logrocket.com/unit-and-integration-testing-for-node-js-apps/" rel="noopener ugc nofollow" target="_blank">https://blog . log rocket . com/unit-and-Integration-Testing-for-node-js-apps/</a></li><li id="712b" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">摩卡—<a class="ae ks" href="https://mochajs.org" rel="noopener ugc nofollow" target="_blank">https://mochajs.org</a></li><li id="d4ce" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">柴—<a class="ae ks" href="https://www.chaijs.com" rel="noopener ugc nofollow" target="_blank">https://www.chaijs.com</a></li><li id="7b67" class="nu nv in kv b kw od kz oe lc of lg og lk oh lo nz oa ob oc bi translated">柴-http—<a class="ae ks" href="https://www.chaijs.com/plugins/chai-http/" rel="noopener ugc nofollow" target="_blank">https://www.chaijs.com/plugins/chai-http/</a></li></ul><p id="4e34" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="nf">更多内容看</em><a class="ae ks" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="nf">plain English . io</em></strong></a></p></div></div>    
</body>
</html>