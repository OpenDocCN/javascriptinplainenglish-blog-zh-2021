<html>
<head>
<title>How to Fix the React useState Hook Not Setting Initial Value Problem?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修复React useState钩子不设置初始值的问题？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-fix-the-react-usestate-hook-not-setting-initial-value-problem-7def65b44362?source=collection_archive---------2-----------------------#2021-09-04">https://javascript.plainenglish.io/how-to-fix-the-react-usestate-hook-not-setting-initial-value-problem-7def65b44362?source=collection_archive---------2-----------------------#2021-09-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3abc4dd4f37c83e0319c83d1f9ad3973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FFTTj6Uq39oimYEf"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dilson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dalal Nizam</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4eda" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lb lc ld le b">useState</code>钩子让我们在React组件中创建状态变量。</p><p id="06d5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它需要一个参数作为状态的初始值。</p><p id="b186" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候，我们可能想从道具中设置一个状态的初始值。</p><p id="b358" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们想在prop值改变时更新初始值。</p><p id="e0fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用最新的属性值来修复React <code class="fe lb lc ld le b">useState</code>钩子。</p><h1 id="80a6" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">当Prop更新时更新状态</h1><p id="61d4" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">为了在道具更新时更新状态，我们必须用<code class="fe lb lc ld le b">useEffect</code>钩子来观察道具值。</p><p id="a9d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe lb lc ld le b">useEffect</code>回调中，我们可以调用state setter函数用道具的值更新状态值。</p><p id="2864" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm le mn mo aw mp bi"><span id="22ae" class="mq lg iq le b gy mr ms l mt mu">import React, { useEffect, useState } from "react";</span><span id="5761" class="mq lg iq le b gy mv ms l mt mu">const Count = ({ count }) =&gt; {<br/>  const [num, setNum] = useState(count);</span><span id="5e1d" class="mq lg iq le b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    setNum(count);<br/>  }, [count]);</span><span id="004d" class="mq lg iq le b gy mv ms l mt mu">  return &lt;p&gt;{num}&lt;/p&gt;;<br/>};</span><span id="ba61" class="mq lg iq le b gy mv ms l mt mu">export default function App() {<br/>  const [count, setCount] = useState(0);</span><span id="96e5" class="mq lg iq le b gy mv ms l mt mu">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;button onClick={() =&gt; setCount((c) =&gt; c + 1)}&gt;increment&lt;/button&gt;<br/>      &lt;Count count={count} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="7518" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lb lc ld le b">Count</code>组件中，我们有一个带有<code class="fe lb lc ld le b">count</code>值的<code class="fe lb lc ld le b">useState</code>钩子作为参数。</p><p id="720a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这最初将<code class="fe lb lc ld le b">num</code>设置为<code class="fe lb lc ld le b">count</code>。</p><p id="a738" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们有一个<code class="fe lb lc ld le b">useEffect</code>钩子，它通过将值传递给第二个参数中的数组来监视<code class="fe lb lc ld le b">count</code>值。</p><p id="d5c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在回调中，我们调用<code class="fe lb lc ld le b">setNum</code>来更新<code class="fe lb lc ld le b">num</code>值，并在该值下面的返回语句中呈现该值。</p><p id="66ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe lb lc ld le b">App</code>中，我们用<code class="fe lb lc ld le b">useState</code>钩子创建了<code class="fe lb lc ld le b">count</code>状态。</p><p id="0d73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在按钮的<code class="fe lb lc ld le b">onClick</code>处理程序中调用<code class="fe lb lc ld le b">setCount</code>，更新<code class="fe lb lc ld le b">count</code>状态的值。</p><p id="646c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe lb lc ld le b">count</code>值作为<code class="fe lb lc ld le b">Count</code>组件中<code class="fe lb lc ld le b">count</code>道具的值进行传递。</p><p id="4f74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们点击增量按钮时，我们看到<code class="fe lb lc ld le b">num</code>值更新，并显示其最新值。</p><h1 id="93cd" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">结论</h1><p id="3868" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以通过用<code class="fe lb lc ld le b">useEffect</code>钩子观察属性的值，然后用属性的值作为参数调用<code class="fe lb lc ld le b">useEffect</code>回调中的state setter函数，确保React组件状态在属性的值改变时更新。</p></div></div>    
</body>
</html>