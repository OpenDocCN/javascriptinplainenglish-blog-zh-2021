<html>
<head>
<title>I Recreated the ‘Flying Windows’ Screensaver with JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用JavaScript重新创建了“飞行窗口”屏保</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/flying-windows-screensaver-in-javascript-6682c9244916?source=collection_archive---------7-----------------------#2021-01-07">https://javascript.plainenglish.io/flying-windows-screensaver-in-javascript-6682c9244916?source=collection_archive---------7-----------------------#2021-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c2b7" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用p5.js库创建</h2></div><p id="6474" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将向您展示如何使用名为<strong class="ke io"> p5.js </strong>的库在画布上创建3D效果。我看了一些演示这个库的用法的视频，我还发现这个<a class="ae ky" href="https://www.youtube.com/watch?v=17WoOqgXsRM&amp;feature=emb_logo" rel="noopener ugc nofollow" target="_blank">编码挑战</a>(创建星域)正在处理中。我决定用JavaScript重写，然后稍微改进一下。你还记得旧的Windows屏保吗？其中一个是这样的:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi kz"><img src="../Images/61342871338e8f06b281e0f948913108.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/0*FgxMn8KGAqiClDJH.gif"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">old Windows screensaver</figcaption></figure><p id="6b42" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的动画是基于星际模拟，或<a class="ae ky" href="https://en.wikipedia.org/wiki/Warp_drive" rel="noopener ugc nofollow" target="_blank">曲速驱动</a>。我们可以看到飞行的窗户，而不是“星星”。让我们重新创建这个，但是使用最新的Windows徽标，所以结果看起来像这样。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/2ae119fdda0026ca47ed4aaef4ccefb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/0*taxK663F-zq21l8Q.gif"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">flying Windows logo created in p5.js (<strong class="bd lm">Check out the </strong><a class="ae ky" href="https://editor.p5js.org/miresk/sketches/DzxMND-Rw" rel="noopener ugc nofollow" target="_blank"><strong class="bd lm">DEMO</strong></a>)</figcaption></figure><h1 id="d0ea" class="ln lo in bd lp lq lr ls lt lu lv lw lx jt ly ju lz jw ma jx mb jz mc ka md me bi translated">P5.js</h1><p id="e42d" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">p5.js是一个用于创造性编码的JavaScript库，致力于使艺术家、设计师、教育工作者、初学者和其他任何人都可以访问和包容编码！</p><p id="3861" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它是处理的<a class="ae ky" href="https://processing.org/" rel="noopener ugc nofollow" target="_blank">的JavaScript实现，这是一个灵活的软件sketchbook和一种用于学习如何在视觉艺术的环境中编码的语言。入手非常容易，因为还有一个在线的</a><a class="ae ky" href="https://editor.p5js.org/" rel="noopener ugc nofollow" target="_blank"> p5.js编辑器</a>。当您打开它时，您将只看到3个文件:</p><ul class=""><li id="0562" class="mk ml in ke b kf kg ki kj kl mm kp mn kt mo kx mp mq mr ms bi translated">index.html</li><li id="288e" class="mk ml in ke b kf mt ki mu kl mv kp mw kt mx kx mp mq mr ms bi translated">草图. js</li><li id="9263" class="mk ml in ke b kf mt ki mu kl mv kp mw kt mx kx mp mq mr ms bi translated">style.css</li></ul><p id="e904" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Index.html链接了这个库，sketch.js是我们将要使用的文件。默认情况下，它包含两个主要功能:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="fd22" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> setup() </strong>用于初始化，只运行一次，而<strong class="ke io"> draw() </strong>函数重复运行，用于动画。这就是你现在需要知道的关于p5.js的全部内容。</p><h1 id="fbfc" class="ln lo in bd lp lq lr ls lt lu lv lw lx jt ly ju lz jw ma jx mb jz mc ka md me bi translated">视窗模拟曲速驱动</h1><p id="e0a4" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">曲速引擎基本上意味着超光速旅行，你可能在《星际迷航》系列中对它很熟悉。我们想创建窗口而不是星星，所以让我们先创建几个变量。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d58f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后在setup()函数中，我们可以遍历窗口的数量，并用新创建的窗口对象填充数组。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8c06" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">窗口对象是什么样子的？让我们用类来定义它</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="dcad" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">窗口有几个属性:<strong class="ke io"> x </strong>、<strong class="ke io"> y </strong>、<strong class="ke io"> z </strong>(坐标)和<strong class="ke io"> pz </strong>，是之前的z位置。<strong class="ke io">宽度</strong>和<strong class="ke io">高度</strong>是定义画布尺寸的系统变量。</p><p id="ed14" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae ky" href="https://p5js.org/reference/#/p5/random" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> Random() </strong> </a>函数返回一个随机浮点数，我们用它在屏幕上随机重新分配我们的窗口(x，y，z)。</p><h2 id="af61" class="na lo in bd lp nb nc dn lt nd ne dp lx kl nf ng lz kp nh ni mb kt nj nk md nl bi translated">更新()</h2><p id="f205" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">还有<em class="nm"> update() </em>函数我们可以看看:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="f408" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">只是这里发生了一些事情。</p><p id="73db" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在画布中，“x”和“y”从左上角开始。</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/43387fb5b2cd0ca6f32a895cdf813410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/0*kNcolXnzdfRH_-MT.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk"><a class="ae ky" href="https://diveinto.html5doctor.com/canvas.html" rel="noopener ugc nofollow" target="_blank">Canvas coordinates system</a></figcaption></figure><p id="6b90" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">即使我们没有启用WEBGL (3D)模式，我们也有“z”坐标。我们想模拟轴上的运动。在<em class="nm"> update() </em>函数中，我们通过减去速度来更新坐标，这样物体看起来会向我们走来。</p><pre class="la lb lc ld gt no np nq nr aw ns bi"><span id="df8e" class="na lo in np b gy nt nu l nv nw">this.z = this.z - speed;</span></pre><p id="6fe9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果“z”小于1，则对象在画布之外，因此我们重置坐标。</p><h2 id="b9d8" class="na lo in bd lp nb nc dn lt nd ne dp lx kl nf ng lz kp nh ni mb kt nj nk md nl bi translated">显示()</h2><p id="fb42" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">在<em class="nm"> show() </em>函数中我们有:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="367a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">丹尼尔·希夫曼在他的<a class="ae ky" href="https://github.com/CodingTrain/website/blob/main/CodingChallenges/CC_001_StarField/Processing/CC_001_StarField/Star.pde" rel="noopener ugc nofollow" target="_blank">源代码</a>的注释中解释了上述内容:</p><blockquote class="nx ny nz"><p id="fda2" class="kc kd nm ke b kf kg jo kh ki kj jr kk oa km kn ko ob kq kr ks oc ku kv kw kx ig bi translated"><em class="in">有了这些“地图”，我得到了新的恒星位置<br/>除法x / z得到了一个介于0和一个非常大的数之间的数，<br/>我们在0-宽度/2的范围内映射这个数(按比例映射到0-1的范围内)。<br/>通过这种方式，我们可以确定新坐标“sx”和“sy”在每一帧移动得更快，并且它们在画布外完成了它们的行程</em></p></blockquote><p id="28b2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想在这里指出两点:</p><ul class=""><li id="19b0" class="mk ml in ke b kf kg ki kj kl mm kp mn kt mo kx mp mq mr ms bi translated"><a class="ae ky" href="https://p5js.org/reference/#/p5/map" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> map() </strong> </a>函数将一个数字从一个范围重新映射到另一个范围。</li></ul><pre class="la lb lc ld gt no np nq nr aw ns bi"><span id="a84d" class="na lo in np b gy nt nu l nv nw">map(value, start1, stop1, start2, stop2)</span></pre><ul class=""><li id="fd8c" class="mk ml in ke b kf kg ki kj kl mm kp mn kt mo kx mp mq mr ms bi translated"><strong class="ke io">x/z和y / z的划分</strong>代表弱透视投影方程。换句话说，将世界空间坐标(x，y，z)转换到屏幕空间(u，v)</li></ul><pre class="la lb lc ld gt no np nq nr aw ns bi"><span id="040f" class="na lo in np b gy nt nu l nv nw">u = x / z; <br/>v = y / z;</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b37c16df3e2b5c1d95fbad069b375d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/0*jp0lZTZXi47O9cqI.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk"><a class="ae ky" href="https://www.cse.unr.edu/~bebis/CS791E/Notes/PerspectiveProjection.pdf" rel="noopener ugc nofollow" target="_blank">Weak Perspective Projection</a></figcaption></figure><h2 id="8c97" class="na lo in bd lp nb nc dn lt nd ne dp lx kl nf ng lz kp nh ni mb kt nj nk md nl bi translated">绘制()</h2><p id="69ca" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">现在我们可以更新主draw()函数:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d014" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们遍历窗口数组，并在每个对象上调用我们之前定义的函数。您应该看到这个:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/d946c0129ce90a40ac443b8566c97095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*fDZXCsv02RONJs9o.gif"/></div></figure><p id="a68c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">快到了！但是我们想要窗户！</p><h2 id="3fdf" class="na lo in bd lp nb nc dn lt nd ne dp lx kl nf ng lz kp nh ni mb kt nj nk md nl bi translated"><a class="ae ky" href="https://p5js.org/reference/#/p5/loadImage" rel="noopener ugc nofollow" target="_blank">加载图像</a></h2><p id="ef0c" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">我下载了Windows徽标，并准备了几种不同的颜色:</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div class="gh gi of"><img src="../Images/74573ca003a825071433c259ce939b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/0*kB9gLq0TSE3eQiBH.png"/></div><figcaption class="lh li gj gh gi lj lk bd b be z dk">Windows logos</figcaption></figure><p id="6703" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要创建一个<em class="nm"> preload() </em>函数，并创建一个新变量<em class="nm"> imgs </em></p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="d10a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我准备了5张图片，给它们起了相同的名字，加上了数字后缀，这样很容易在循环中加载它们。现在我们可以向构造函数添加另一个属性，在这里我们可以再次使用random函数。我们在那里传递一个数组，所以会选择一个随机的图像变量。</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><blockquote class="nx ny nz"><p id="651d" class="kc kd nm ke b kf kg jo kh ki kj jr kk oa km kn ko ob kq kr ks oc ku kv kw kx ig bi translated"><em class="in">注意:我尝试用</em><a class="ae ky" href="https://p5js.org/reference/#/p5/tint" rel="noopener ugc nofollow" target="_blank"><em class="in">【tint()</em></a><em class="in">函数改变图像的颜色，而不是创建几个图像，但是性能受到了很大的影响。</em></p></blockquote><p id="013f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，我们只需将<em class="nm"> show() </em>函数中的<em class="nm"> ellipse() </em>替换为图像()，如下所示:</p><pre class="la lb lc ld gt no np nq nr aw ns bi"><span id="be64" class="na lo in np b gy nt nu l nv nw">image(<strong class="np io">this.img</strong>, sx, sy, r, r);</span></pre><p id="7661" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">耶！我们重新创建了Windows屏保。不过，我觉得好像少了点什么。</p><h2 id="9551" class="na lo in bd lp nb nc dn lt nd ne dp lx kl nf ng lz kp nh ni mb kt nj nk md nl bi translated">加载(错误)声音</h2><p id="2ee4" class="pw-post-body-paragraph kc kd in ke b kf mf jo kh ki mg jr kk kl mh kn ko kp mi kr ks kt mj kv kw kx ig bi translated">我想循环播放windows错误声音，就好像飞出屏幕的Windows正在制造错误一样。P5有一个额外的库叫做<strong class="ke io"> p5.sound.js </strong>，我们可以用它来做这件事。</p><p id="3ffb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们只需像这样更新预加载函数:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="53b4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并更新主setup()函数:</p><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="4e77" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">做得好，你应该会得到这个<a class="ae ky" href="https://editor.p5js.org/miresk/sketches/DzxMND-Rw" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io">结果</strong> </a>。</p><p id="7d00" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读！</p></div><div class="ab cl og oh hr oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ig ih ii ij ik"><div class="la lb lc ld gt on"><a href="https://miro.substack.com/" rel="noopener  ugc nofollow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd io gy z fp os fr fs ot fu fw im bi translated">是米罗的错！</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">关于web前端技术的时事通讯</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">miro.substack.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb lf on"/></div></div></a></div></div></div>    
</body>
</html>