<html>
<head>
<title>Why PWAs are Simultaneously Bad and Brilliant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么艾滋病人既坏又聪明</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-pwas-are-annoying-as-hell-and-brilliant-and-just-like-the-music-industry-27ae07cbad8c?source=collection_archive---------13-----------------------#2021-03-04">https://javascript.plainenglish.io/why-pwas-are-annoying-as-hell-and-brilliant-and-just-like-the-music-industry-27ae07cbad8c?source=collection_archive---------13-----------------------#2021-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bcde" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">为什么它们让我想起了音乐产业</h2></div><h1 id="fa4f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">PWAs和服务人员生命周期基本上是一场流行竞赛</h1><h2 id="b6db" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">你谷歌过这些吗？</h2><blockquote class="lm"><p id="517c" class="ln lo iq bd lp lq lr ls lt lu lv lw dk translated">PWA冻结app <br/> PWA给旧页面<br/> PWA不被替换<br/>到底什么是服务人员</p></blockquote><p id="4834" class="pw-post-body-paragraph lx ly iq lz b ma mb jr mc md me ju mf lc mg mh mi lf mj mk ml li mm mn mo lw ij bi translated">让我来帮忙。</p><h2 id="b5bb" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">什么是PWA？</h2><p id="8b10" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">渐进式网络应用程序可以让用户轻松地将你的网站下载到他们的手机上，缓存页面资源，甚至给用户通知。这都是由服务人员提供动力的。</p><p id="27b9" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">服务人员是一段代码，<em class="mz">提升</em>您的网站，能够缓存您页面的资源(疯狂快速的刷新和加载时间)，监控通知推送，安装到手机上等等…</p><h2 id="b768" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">怎么会？</h2><p id="4173" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">它们很容易实现，但会造成很大的混乱，因为它们会拦截发送给浏览器的消息，并导致用户更新延迟——因为它们可以缓存结果。</p><p id="1dd9" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">这些问题是其能力的直接结果，因此要使用它们，你需要很好地了解它们。我在我的兼职项目中使用它们，这样用户可以很容易地在他们的手机上安装应用程序，我可以提醒他们记录他们的一天。</p><h1 id="b6a5" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">生命周期概述—这里发生了什么？</h1><p id="2833" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">谷歌和戴夫·格迪斯的聪明的科学家们已经为在这里学习这个制作了一个游戏。</p><p id="a5ac" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">简而言之，服务人员是一个Javascript文件，可以保存在用户的浏览器中。当它存在时，它不能被改变，它必须被替换。</p><p id="318e" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">要被替换，你需要更新你的Javascript文件，让里面有不同的内容——即。与旧的不一样。</p><p id="450d" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">然后，当浏览器或标签下一次关闭时，新代码将安装到浏览器中，并等到浏览器再次关闭时再安装。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nd"><img src="../Images/ec586042c4bc67809bc1295d206b8ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUCN5nuvm6vSm2bGSsxPwA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">My simplistic understanding.</figcaption></figure><h1 id="3123" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">1.安装/注册服务人员</h1><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nt"><img src="../Images/dd9bb99e3359d838efa22b6ae560b688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pAuSIVhhHckRBKd8f93inA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">You are not allowed in if you don’t register</figcaption></figure><p id="bafc" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">本质上，您是在要求浏览器接受<code class="fe nu nv nw nx b">js</code>文件。为此，你需要告诉互联网浏览器(又名<code class="fe nu nv nw nx b">navigator</code>)在浏览器的<code class="fe nu nv nw nx b">serviceWorker</code>区注册这个代码。</p><p id="ad0c" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated"><code class="fe nu nv nw nx b">navigator.serviceWorker.register("/serviceWorker.js")</code></p><p id="4fb5" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">如果已经安装了服务工作器，并且两个服务工作器的代码与已安装的相同，则不会发生任何事情。如果文件不同，浏览器将存储新版本。</p><h1 id="0565" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">2.等待</h1><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ny"><img src="../Images/d55478868e730155b8ab3793823f4439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vE186mAH6DDcx1exMCclA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">When you are the first service worker!</figcaption></figure><p id="ed3a" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">如果这是用户第一次运行该站点，服务人员会立即直接等待，因此新请求的服务人员将同时被安装和激活。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi nz"><img src="../Images/0255eeb27f38997dfe67edab6c7fbe12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6NFuXuc5ASqPIXOGCkKWNQ.png"/></div></div></figure><h2 id="2392" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">但是下次</h2><p id="3eaf" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">下一次用户访问该网站时，浏览器将再次请求该网站的文件，并接收新版本的服务工作人员。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oa"><img src="../Images/85dd1dcee1ab834207e5650c0ae7a0ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYQFgofawkxn-K56-kh4vw.png"/></div></div></figure><p id="82f6" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">此服务工作者将不会执行；它只不过是在浏览器中等待，而先前安装的服务工作人员则做所有的艰苦工作。</p><h1 id="b641" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">3.激活的</h1><p id="19db" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">激活意味着服务工作进程正在运行。它在浏览器中可操作。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ob"><img src="../Images/c85fb5f6fda4c9f4ba8779aa851a4950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lX6PCOnAR0dYHtLlP0Mkag.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">The party starts; the service worker performs!</figcaption></figure><p id="c4d5" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">服务工作者在用户刷新后仍然存在，因此当前服务工作者将保持活动状态，直到用户导航离开您的站点或关闭浏览器…</p><h1 id="3824" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">4.停止</h1><p id="d673" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">当浏览器关闭时，服务工作人员不再具有执行任何操作的控制权。它已停止，仍在浏览器中，但未终止…</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oc"><img src="../Images/f1e06f3dd65414c531bda3166321bf52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KwXzuS0n77hssUwVuFSYGA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">Just chill here until next time — there is no-one else here lined up for next time!</figcaption></figure><h1 id="c9ca" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">5.终止的</h1><p id="b294" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">只有当页面不再被使用时(即用户离开/关闭了页面的所有实例时)<strong class="lz ir">和</strong>还有另一个服务工作者在等待时，活动的服务工作者才能死亡。此操作将停止浏览器使用服务工作文件，并将其删除。</p><p id="072f" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">此时，下一个服务工作者(即等待中的服务工作者)将会激活，但会被停止—这只是在等待，直到下次加载站点。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi od"><img src="../Images/99047c71fbd03bf0c714fb71f278eb22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tDdFoByeJ-PliNs602cfVA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">We always want the newest and coolest performers</figcaption></figure><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oe"><img src="../Images/06b9340a822809be587db32e741e07d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zprlRemJAMisi__5coOPlw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">Notice the green SW1 disappears as it has been terminated and the yellow SW2 has been put in stopped</figcaption></figure><h1 id="1b29" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">服务人员故意显得犹豫/有礼貌</h1><p id="092e" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">他们等待演出或会议结束。</p><h2 id="940a" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">如果不是这样培养服务人员……</h2><p id="6d93" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">行为的原因是对资源的请求没有排序。因此，服务工作者可能仅在请求了一些页面资源之后才激活。这意味着您的站点可能同时加载新资源和旧资源。这可能很糟糕……</p><h2 id="0175" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">但如果你真的希望这样，你可以这样做:</h2><pre class="ne nf ng nh gt of nx og oh aw oi bi"><span id="e861" class="kx kg iq nx b gy oj ok l ol om">self.addEventListener("activate", event =&gt; {<br/>  // waitUntil allows you to pause all other states of life<br/>  // in short it stops fetch events happening so you have a bit more<br/>  // certainty that your resources are fine but it doesn't stop the <br/>  // main page / index file being loaded as that always happens<br/>  // first<br/>  event.waitUntil(clients.claim())<br/>})</span></pre><p id="ac87" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">注意:我发现在生产环境中始终使用此选项非常谨慎:</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi on"><img src="../Images/c760318c950ad5434004a40f0bda7caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lPyT70lNIi2JSzUDpQm1GA.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk"><a class="ae na" href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle</a></figcaption></figure><h2 id="0785" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">在ASAP中强制新版本:</h2><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oo"><img src="../Images/2c9a336beb9dbfb07e7b6e12d89a99b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMNic7J1xCCwEqRwoaDOpw.png"/></div></div></figure><p id="f74f" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">有了新的服务员工，你就可以实施新政策。这将意味着新版本的服务工作者将立即安装并激活。</p><p id="385f" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">不过在这样做的时候也要小心，因为这可能意味着缓存中没有更新您的新文件(所以您可能还想使用<code class="fe nu nv nw nx b">clients.claim()</code>):</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi op"><img src="../Images/08bc21c6c48d27e6348a632410debef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xnY0754DhPDIw5Wi-ypFw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk"><a class="ae na" href="https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle</a></figcaption></figure><h1 id="6554" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">其他说明</h1><p id="323d" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">您可能不想与他们一起开发，因为您可能会进行更改，但只能获得缓存版本。你可以做两件事中的一件——把它们设置为当环境变量存在时不安装(比如<code class="fe nu nv nw nx b">development</code>)，或者让<code class="fe nu nv nw nx b">update on reload</code>检查你的浏览器开发工具内部(尽管你需要记住总是打开这个)</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oq"><img src="../Images/6eb7be95ee585002d854bccad369f908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mhdiK5WjXn8HuZvoe74oxw.png"/></div></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">Chrome’s dev tools</figcaption></figure><p id="8d52" class="pw-post-body-paragraph lx ly iq lz b ma mu jr mc md mv ju mf lc mw mh mi lf mx mk ml li my mn mo lw ij bi translated">此外，在这些开发工具中，还有一种称为灯塔的东西，用于测试PWAs，这对于了解一切是否正确非常有用:</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi or"><img src="../Images/420e65a5f2f033cec2d003a8edb625d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMFIXI5R9PInHWlIi9nnvQ.png"/></div></div></figure><ul class=""><li id="c3dc" class="os ot iq lz b ma mu md mv lc ou lf ov li ow lw ox oy oz pa bi translated">在重新加载页面时按住<code class="fe nu nv nw nx b">shift</code>将禁用活动的服务工作者对负载的干预(表现得好像负载不存在)</li><li id="da75" class="os ot iq lz b ma pb md pc lc pd lf pe li pf lw ox oy oz pa bi translated">如果服务工作器获取的任何资源失败，服务工作器将被完全忽略，就好像它从未存在过一样…</li></ul></div><div class="ab cl pg ph hu pi" role="separator"><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl pm"/><span class="pj bw bk pk pl"/></div><div class="ij ik il im in"><h2 id="177c" class="kx kg iq bd kh ky kz dn kl la lb dp kp lc ld le kr lf lg lh kt li lj lk kv ll bi translated">我通过玩这个游戏学到了很多</h2><p id="40ad" class="pw-post-body-paragraph lx ly iq lz b ma mp jr mc md mq ju mf lc mr mh mi lf ms mk ml li mt mn mo lw ij bi translated">如果你想了解PWAs，我会全力推荐它。这很慢，但这是目的——你只能通过重复来学习。</p><figure class="ne nf ng nh gt ni gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi pn"><img src="../Images/8f705e64a1668f1c3d65f470720cb5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8ua-CeKSQOVZlo9Q.png"/></div></div></figure><div class="po pp gp gr pq pr"><a href="https://mastery.games/serviceworkies/" rel="noopener  ugc nofollow" target="_blank"><div class="ps ab fo"><div class="pt ab pu cl cj pv"><h2 class="bd ir gy z fp pw fr fs px fu fw ip bi translated">服务人员</h2><div class="py l"><h3 class="bd b gy z fp pw fr fs px fu fw dk translated">编辑描述</h3></div><div class="pz l"><p class="bd b dl z fp pw fr fs px fu fw dk translated">精通.游戏</p></div></div></div></a></div></div></div>    
</body>
</html>