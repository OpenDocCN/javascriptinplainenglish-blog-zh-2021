<html>
<head>
<title>How To Handle Routing With Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Express处理路由</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-handle-routing-with-express-1c2f64e3407b?source=collection_archive---------7-----------------------#2021-05-23">https://javascript.plainenglish.io/how-to-handle-routing-with-express-1c2f64e3407b?source=collection_archive---------7-----------------------#2021-05-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="366b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过示例了解如何在express中执行输入验证。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/94a3d96d5beca145ca77e349bb743521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5f8_gTDFGJtpzD9B"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@vishnurnair?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vishnu R Nair</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0e4f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在上一个教程中，我们看了如何用POST HTTP动词或方法将数据发送到不同的端点。</p><p id="135c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">本文将研究用POST验证发送到不同端点的输入的多种方法。</p><p id="f21f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将看看如何在没有任何包的情况下进行验证，然后我们将看看如何使用各种包进行数据验证。对于我们的案例，我们将查看joi npm验证包。</p><h1 id="ec51" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">输入验证</h1><p id="8f76" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">假设我们将一些数据发布到一个特定的端点，比如'/user '端点，我们希望在创建数据并保存到服务器之前执行一些验证。</p><p id="6456" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">许多开发人员认为，不应该信任客户端发送的数据，所以，以免使用执行一些验证规则。</p><p id="4b40" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设用户正在向我们发送他的名字。首先，我们希望确保名称保持一定的最大数量，并且不应该为空。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="36fb" class="mr lq in mn b gy ms mt l mu mv"><em class="mw">// route handler</em></span><span id="041b" class="mr lq in mn b gy mx mt l mu mv">router.post('/user', (req, res, next) =&gt; {</span><span id="3740" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">// check if the sent name is blank</em></span><span id="7aeb" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">if</em> (!req.body.name || req.body.name.length &lt; 3) {</span><span id="1f23" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">// send back a 400 bad request</em></span><span id="7d51" class="mr lq in mn b gy mx mt l mu mv">res.status(400).send("Name is required ans should be atleast 3 letter")</span><span id="f62e" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">return</em></span><span id="eb77" class="mr lq in mn b gy mx mt l mu mv">}</span><span id="9775" class="mr lq in mn b gy mx mt l mu mv">res.json({</span><span id="7ea6" class="mr lq in mn b gy mx mt l mu mv">status: 'success',</span><span id="b79c" class="mr lq in mn b gy mx mt l mu mv">data: req.body</span><span id="aee7" class="mr lq in mn b gy mx mt l mu mv">})</span><span id="b7ed" class="mr lq in mn b gy mx mt l mu mv">});</span></pre><p id="0f00" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从上面的代码片段来看，我们正在验证用户的输入。</p><p id="5918" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以注意到我们有一个if语句，它将接受名称并检查它是否为空或者至少是一个三个字母的单词。</p><p id="21f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果它没有通过测试，我们将向用户发送一个状态码400，否则我们将把数据发送回用户。</p><h1 id="67b2" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">测试端点</h1><p id="bb0c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">让我们用Postman测试端点。</p><p id="8de9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您不熟悉postman，请打开Postman应用程序并按照步骤操作。</p><ul class=""><li id="658b" class="my mz in kv b kw kx kz la lc na lg nb lk nc lo nd ne nf ng bi translated">创建新请求</li><li id="1487" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">将方法更改为POST(默认情况下，它是GET)</li><li id="a69d" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">在URL栏上，输入您用express配置的路线；在我们的例子中，它是'/user '</li><li id="31b9" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">所以，在地址栏上，你应该有:<a class="ae ks" href="http://localhost:5000/friends/1" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/user</a></li><li id="459f" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">单击body选项卡，将其更改为raw(默认情况下，它是表单数据或无)</li><li id="7798" class="my mz in kv b kw nh kz ni lc nj lg nk lk nl lo nd ne nf ng bi translated">因此，将格式改为application/JSON(默认情况下，它是文本格式)</li></ul><p id="3382" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们已经配置了Postman，现在可以测试我们的post API端点了</p><h1 id="0723" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">使用错误请求进行测试</h1><p id="94a0" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">让我们看看我们传递的输入是否少于三个，看看我们的应用程序将向用户返回什么。</p><p id="23d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在邮递员正文中输入以下数据，然后单击发送</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="c568" class="mr lq in mn b gy ms mt l mu mv">{</span><span id="f3e5" class="mr lq in mn b gy mx mt l mu mv">"name":"Jo"</span><span id="f7ba" class="mr lq in mn b gy mx mt l mu mv">}</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/5fd6ff7b8462d7c044fb7974bf99528f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-Vez86BOlFkfCJQ3cmgJA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Bad request Postman</figcaption></figure><p id="e773" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您检查Postman上的响应，您会注意到我们的验证规则捕捉到了错误。同样，空白输入也会出错。</p><p id="b4df" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">假设我们有许多来自用户的输入需要验证。为每个输入写下验证可能很耗时，并且经常会导致不为人知的错误。</p><p id="4d8b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这种情况下，我们可以利用npm包管理器来加快我们的开发过程。我们将看到如何使用joi包管理器来执行输入验证。</p><h1 id="9d46" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">使用Joi进行输入验证</h1><p id="4259" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">首先，我们需要在我们的应用程序开发环境中安装joi验证包。</p><h2 id="4cee" class="mr lq in bd lr nn no dn lv np nq dp lz lc nr ns mb lg nt nu md lk nv nw mf nx bi translated"><strong class="ak">使用国家预防机制</strong></h2><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="de79" class="mr lq in mn b gy ms mt l mu mv">npm i joi</span></pre><p id="16c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">安装后，我们需要请求它，并使它在我们的应用程序中可用。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="e5d2" class="mr lq in mn b gy ms mt l mu mv">const Joi = require(‘joi’);</span></pre><p id="c59c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">之后，我们可以使用joi为姓名输入创建验证规则，如下所示。</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="bf23" class="mr lq in mn b gy ms mt l mu mv">const schema = { name: Joi.string().min(3).required() };</span><span id="854b" class="mr lq in mn b gy mx mt l mu mv">const validInput = Joi.validate(req, body, schema);</span><span id="0a8a" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">if</em> (validInput.error) {</span><span id="effc" class="mr lq in mn b gy mx mt l mu mv">res.status(400).send(result.error);</span><span id="798d" class="mr lq in mn b gy mx mt l mu mv"><em class="mw">return</em>;</span><span id="3544" class="mr lq in mn b gy mx mt l mu mv">}</span></pre><p id="efdb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">从上面的代码片段可以看出，我们可以将max、min和required等验证链接在一起。</p><p id="adf8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这是一个展示我们如何用joi执行验证的例子。</p><p id="d8c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要深入了解joi，你可以点击这里查看。</p><h1 id="55ee" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">结论</h1><p id="92e6" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">感谢您阅读本文到目前为止。如果你觉得它令人兴奋，不要犹豫，让我知道在评论区和分享。</p><p id="8072" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">更多阅读</strong></p><div class="ny nz gp gr oa ob"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-handle-routing-with-express-7c1870a2ff89"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd io gy z fp og fr fs oh fu fw im bi translated">如何使用Express处理路由</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">了解快速路由</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ok l"><div class="ol l om on oo ok op km ob"/></div></div></a></div><p id="f257" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mw">更多内容尽在</em><a class="ae ks" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>