<html>
<head>
<title>How to Set Timeout for a JavaScript Promise</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为JavaScript承诺设置超时</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-set-javascript-promise-timeout-7d51c87bc38e?source=collection_archive---------5-----------------------#2021-10-21">https://javascript.plainenglish.io/how-to-set-javascript-promise-timeout-7d51c87bc38e?source=collection_archive---------5-----------------------#2021-10-21</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><h2 id="cf06" class="ip iq ir bd b dl is it iu iv iw ix dk iy translated" aria-label="kicker paragraph">提示和技巧</h2><div class=""/><div class=""><h2 id="0948" class="pw-subtitle-paragraph jx ja ir bd b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko dk translated">只是不要永远等待承诺的实现，你需要设定自己的条件。</h2></div><figure class="kq kr ks kt gu ku gi gj paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gi gj kp"><img src="../Images/c3f2a002b4398dc0091d083c31aad8f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67YCGFqMCN8auLnXQA7qlw.jpeg"/></div></div><figcaption class="lb lc gk gi gj ld le bd b be z dk">Image by <a class="ae lf" href="https://pixabay.com/users/cherylholt-209609/" rel="noopener ugc nofollow" target="_blank">cherylholt</a> on <a class="ae lf" href="https://pixabay.com" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><p id="aa6d" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">你有没有想过为什么不能为你的JavaScript承诺设置一个超时？你并不孤单。</p><p id="1764" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">我以前也有同样的问题，实际上，我找不到<strong class="li jb">为什么</strong>的答案。但我最终决定停止思考，开始行动。</p><p id="cda8" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">为JavaScript承诺实现超时并不困难，您可以自己轻松完成。</p></div><div class="ab cl mc md hv me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ik il im in io"><div class="kq kr ks kt gu mj"><a href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener follow" target="_blank"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">订阅艾哈迈德的时事通讯？</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">订阅艾哈迈德的时事通讯📰直接获得最佳实践、教程、提示、技巧和许多其他很酷的东西…</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">medium.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx kz mj"/></div></div></a></div></div><div class="ab cl mc md hv me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ik il im in io"><h1 id="5b98" class="my mz ir bd na nb nc nd ne nf ng nh ni kg nj kh nk kj nl kk nm km nn kn no np bi translated">这是我思考问题的方式</h1><ol class=""><li id="48f0" class="nq nr ir li b lj ns lm nt lp nu lt nv lx nw mb nx ny nz oa bi translated">超时本身可以使用本机的<code class="fe ob oc od oe b">setTimeout()</code>函数来实现。</li><li id="548f" class="nq nr ir li b lj of lm og lp oh lt oi lx oj mb nx ny nz oa bi translated">我可以利用本机的<code class="fe ob oc od oe b">Promise.race()</code>函数，这样我就可以在超时和最初的承诺之间开始一场比赛。</li><li id="9a96" class="nq nr ir li b lj of lm og lp oh lt oi lx oj mb nx ny nz oa bi translated">这样，我可以将超时作为一个承诺来实现。</li><li id="9501" class="nq nr ir li b lj of lm og lp oh lt oi lx oj mb nx ny nz oa bi translated">剩下的部分是关于如何将小部分整合在一起，以获得预期的结果。</li></ol><h1 id="4486" class="my mz ir bd na nb ok nd ne nf ol nh ni kg om kh nk kj on kk nm km oo kn no np bi translated">履行</h1><h2 id="1466" class="op mz ir bd na oq or dn ne os ot dp ni lp ou ov nk lt ow ox nm lx oy oz no ix bi translated">等待</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="pa pb l"/></div></figure><p id="37e0" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">这里的<strong class="li jb">超时</strong>部分是作为<strong class="li jb">承诺</strong>本身实现的。这是通过将原生的<code class="fe ob oc od oe b">setTimeout()</code>函数包装成一个承诺来实现的，该承诺将总是解析为常量字符串<code class="fe ob oc od oe b">‘time out’</code>。你可以根据需要修改这个部分，你甚至可以返回一个对象。</p><h2 id="7ce9" class="op mz ir bd na oq or dn ne os ot dp ni lp ou ov nk lt ow ox nm lx oy oz no ix bi translated">PromiseWithTimeout超时</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="pa pb l"/></div></figure><p id="020c" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">这里，新的Promise功能被定义为一个名为<strong class="li jb"> PromiseWithTimeout </strong>的新对象类型，这样它就可以像使用本地<strong class="li jb"> Promise </strong>对象一样使用。因此，你应该使用<code class="fe ob oc od oe b">let myPromise = new PromiseWithTimeout(…)</code>，而不是<code class="fe ob oc od oe b">let myPromise = new Promise(…)</code>。</p><p id="9a13" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">主要思想是使用原生的<code class="fe ob oc od oe b">Promise.race()</code>函数，然后返回我们定义的<strong class="li jb">原始承诺</strong>和<strong class="li jb">等待承诺</strong>之间的竞争承诺。</p><h2 id="500e" class="op mz ir bd na oq or dn ne os ot dp ni lp ou ov nk lt ow ox nm lx oy oz no ix bi translated"><strong class="ak">使用PromiseWithTimeout </strong></h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="pa pb l"/></div></figure><p id="d870" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">现在你可以开始轻松使用新的<strong class="li jb"> PromiseWithTimeout </strong>了。</p><h2 id="a8af" class="op mz ir bd na oq or dn ne os ot dp ni lp ou ov nk lt ow ox nm lx oy oz no ix bi translated">从PromiseWithTimeout获取结果</h2><figure class="kq kr ks kt gu ku"><div class="bz fq l di"><div class="pa pb l"/></div></figure><p id="d09d" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">现在，根据您决定如何解决<strong class="li jb"> wait </strong>承诺，您可以断言返回的结果，以检查它是超时还是最初承诺的实际结果。</p></div><div class="ab cl mc md hv me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ik il im in io"><h1 id="81c6" class="my mz ir bd na nb nc nd ne nf ng nh ni kg nj kh nk kj nl kk nm km nn kn no np bi translated">希望这些内容对你有用。如果您想支持:</h1><p id="ab87" class="pw-post-body-paragraph lg lh ir li b lj ns kb ll lm nt ke lo lp pc lr ls lt pd lv lw lx pe lz ma mb ik bi translated">如果您还不是<strong class="li jb">中型</strong>会员，您可以使用<a class="ae lf" href="https://medium.com/@eng_ahmed.tarek/membership" rel="noopener"> <strong class="li jb">我的推荐链接</strong> </a>，这样我就可以从<strong class="li jb">中型</strong>中获得您的一部分费用，您无需支付任何额外费用。订阅<br/><a class="ae lf" href="https://medium.com/subscribe/@eng_ahmed.tarek" rel="noopener"><strong class="li jb">我的简讯</strong> </a>将最佳实践、教程、提示、技巧和许多其他很酷的东西直接发送到您的收件箱。</p></div><div class="ab cl mc md hv me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ik il im in io"><h1 id="3393" class="my mz ir bd na nb nc nd ne nf ng nh ni kg nj kh nk kj nl kk nm km nn kn no np bi translated">其他资源</h1><p id="d078" class="pw-post-body-paragraph lg lh ir li b lj ns kb ll lm nt ke lo lp pc lr ls lt pd lv lw lx pe lz ma mb ik bi translated">这些是您可能感兴趣的其他资源。</p><div class="pf pg gq gs ph mj"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-use-observables-with-vanilla-javascript-aca40a7590ff"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">如何在普通JavaScript中使用Observables</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">没有使用框架，只是纯香草JavaScript。</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ms l"><div class="pi l mu mv mw ms mx kz mj"/></div></div></a></div><div class="pf pg gq gs ph mj"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-customize-webpages-ui-behavior-using-javascript-userscripts-7b6a090e0135"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">使用JavaScript用户脚本定制网页用户界面/行为</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">即使你不拥有这个网页，你仍然可以附上你的JavaScript用户脚本。</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ms l"><div class="pj l mu mv mw ms mx kz mj"/></div></div></a></div><div class="pf pg gq gs ph mj"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-get-freelancers-new-projects-notifications-on-your-slack-channel-69c9c74d3220"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">如何在你的Slack频道上获得自由职业者的新项目通知</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">这是一个设置用户脚本的问题，我将为您提供。</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">javascript.plainenglish.io</p></div></div><div class="ms l"><div class="pk l mu mv mw ms mx kz mj"/></div></div></a></div><div class="pf pg gq gs ph mj"><a href="https://betterprogramming.pub/twitter-auto-retweet-bot-with-node-js-and-typescript-4d6eaf24c0ab" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">用Node.js和TypeScript构建一个Twitter自动转发机器人</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">了解如何创建一个Twitter机器人来转发任何带有特定关键字或标签的推文</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">better编程. pub</p></div></div><div class="ms l"><div class="pl l mu mv mw ms mx kz mj"/></div></div></a></div><div class="pf pg gq gs ph mj"><a href="https://levelup.gitconnected.com/paging-partitioning-main-equations-to-make-it-easy-44fe89d5290b" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fp"><div class="ml ab mm cl cj mn"><h2 class="bd jb gz z fq mo fs ft mp fv fx ja bi translated">分页/分区—简化这一过程的主要等式</h2><div class="mq l"><h3 class="bd b gz z fq mo fs ft mp fv fx dk translated">最后，这是您理解分页/分区主要等式并学习如何在代码中应用它们的机会。</h3></div><div class="mr l"><p class="bd b dl z fq mo fs ft mp fv fx dk translated">levelup.gitconnected.com</p></div></div><div class="ms l"><div class="pm l mu mv mw ms mx kz mj"/></div></div></a></div><p id="b42f" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated">最后，希望你觉得读这个故事和我写它一样有趣。</p></div><div class="ab cl mc md hv me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ik il im in io"><p id="c4ae" class="pw-post-body-paragraph lg lh ir li b lj lk kb ll lm ln ke lo lp lq lr ls lt lu lv lw lx ly lz ma mb ik bi translated"><em class="pn">更多内容请看</em><a class="ae lf" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="li jb"><em class="pn">plain English . io</em></strong></a></p></div></div>    
</body>
</html>