<html>
<head>
<title>How to Use Node.js with Google Sheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Google Sheets中使用Node.js</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-node-js-with-google-sheets-c256c26e10fc?source=collection_archive---------1-----------------------#2021-05-17">https://javascript.plainenglish.io/how-to-use-node-js-with-google-sheets-c256c26e10fc?source=collection_archive---------1-----------------------#2021-05-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="6956" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">在本教程中，我们将介绍如何使用Google Sheets API和Node.js在Google Sheets中进行基本的数据读写。</h2></div><p id="6378" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:我们要让事情变得简单。我们将通过使用Google Sheets API和Node.js来读写我们的Google Sheets中的数据。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/0bbce4878bfb8599a77d56370852a98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lqrLTW4pY5KakjNs"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@clark_fransa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arnold Francisca</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="94d8" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">启用Google Sheets API</h1><ol class=""><li id="ba07" class="mh mi in ke b kf mj ki mk kl ml kp mm kt mn kx mo mp mq mr bi translated">登录<a class="ae lo" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>。</li><li id="2e44" class="mh mi in ke b kf ms ki mt kl mu kp mv kt mw kx mo mp mq mr bi translated">在您的仪表板上，点击位于Google Cloud Platform旁边的“我的第一个项目”(名称可以不同)。</li></ol><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mx"><img src="../Images/b29f1635801195212cbb6e011d2681e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9FbIyxPg1LGe0NTEPy7Cw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="6ce7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将出现一个弹出框，在右上角单击“新建项目”</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi my"><img src="../Images/4d3e171ec4268991ce8593dc21f2468b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8eHuOK31O3FTXUUok2WUg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="1929" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">输入您选择的项目名称。</p><p id="54f6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">保持“位置”字段不变。</p><p id="1a45" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">输入名称后，单击“创建”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi mz"><img src="../Images/d69e241dc73031a1787ca2f22917eeb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OoL7qaWlG_ls-jpcTA1JKw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="73cf" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建项目后，单击“我的第一个项目”,然后选择您刚刚创建的新项目。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi na"><img src="../Images/676f6f2707e0a8ee706d5e02f3357423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdjXoPQyn_QN6KNEOUSuCQ.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="f824" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.选择项目后，单击“启用API和服务”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/cd0edffe75958189af488ba466de51ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*tAeJ4ZxK7VfN3ew1iHBuoA.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="b39d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.搜索“Google sheets”并选择它。在Google sheets页面上，点击“启用”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nc"><img src="../Images/0dd2c8ec2507ce65afe4c9e544a1c61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpjCZhld2O5S9dVOI3M4sA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="91c3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我已经启用了它，这就是它显示“管理”的原因，您的应该显示“启用”。</p><p id="a204" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">启用后，单击“管理”。</p><p id="6b5b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.点击“管理”后，您将被重定向至您的控制面板。</p><p id="4138" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在“APIs &amp; Services”下，单击“Credentials”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/8bfd3e975bafba46a427df04956a27d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*socYeOO6MTtEwU1OCllV2g.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="0616" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.在凭据页面上，单击“创建凭据”，然后单击下拉列表中的“服务帐户”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ne"><img src="../Images/c366b0c5e35ed814e01b0c33458dbd76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AYW2ackKhLyY8qoDqOYO3w.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="2bdf" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">7.输入“服务名称”，它可以是您喜欢的任何名称。输入姓名后，点击“创建”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nf"><img src="../Images/0bedc5d00a011a9406891899175cd44c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HMOs4rI6W_92q3xRyxMEA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="b646" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于“可选”字段，只需单击“继续”。</p><p id="97c5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在您的控制面板上，您将看到刚刚在“服务帐户”下创建的服务帐户</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ng"><img src="../Images/0f8875e0aca1bf89f5dc1b3c404d7f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R_iYB9qne1XH7UhpEeR7LA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="7ecc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">复制电子邮件地址，我们稍后会用到它。</p><p id="d384" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">8.点击电子邮件地址，将出现一个页面，在这个页面上，我们必须点击“键”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nh"><img src="../Images/529de107fa58ba845e00525e54332520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYrXoO3nVnWyqX8bn0wGHQ.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="42dd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在“密钥”列下，单击“添加密钥”，然后选择“创建新密钥”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/d51321c9ee42c375df4e95c54f8a95b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*2pm3pFppUa5ZBtvFM_5sTg.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="e60e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">选择“创建新密钥”后，会出现一个弹出框。选择“JSON”并单击“创建”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/dcb70874649f84ebcca750dce3f47e0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTbFr40COPXclisTr_Noow.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="6d49" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您的服务帐户的私钥将被下载到您的机器上。<strong class="ke io">不要与任何人共享此密钥，因为这会让他们访问您的服务帐户。</strong></p><p id="2536" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这样，我们启用了我们的Google Sheets API，创建了一个我们将在项目中使用的私钥。现在我们将深入编码部分。</p></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><p id="84d7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在进入编码部分之前，我希望大家创建一个包含一些数据的Google电子表格。对于本教程，我将使用截图中给出的电子表格。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/a4bd2e7985ecceeaa988215f3b643969.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*LjwlvX5jKuNhbAgjJ2RuwA.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="3a8d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击右上角的“分享按钮”。输入我们在步骤7中复制的电子邮件。</p><p id="edd7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该角色应为“编辑”并取消选中“通知人员”选项。然后点击“分享”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ns"><img src="../Images/74df5352741fc2c23c89e9407157e06f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caW3DeSpavj48VuCyXCDbg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="25ef" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在Google工作表已经与我们的服务帐户共享，我们可以开始在NodeJS项目中使用这个Google工作表了。</p></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><h1 id="78f4" class="lp lq in bd lr ls nt lu lv lw nu ly lz jt nv ju mb jw nw jx md jz nx ka mf mg bi translated">用Node.js读取电子表格</h1><ol class=""><li id="18f1" class="mh mi in ke b kf mj ki mk kl ml kp mm kt mn kx mo mp mq mr bi translated">在你的机器上创建一个空的目录，它可以在任何地方，你想叫它什么都可以。对于这个项目，我把我的目录叫做‘Google _ sheets _ and _ nodejs’。</li></ol><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/53c00ab6744ac298d2c15a7eba3bd1d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*2niDDsvs0s3CF7VabzdmLg.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="5bc0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.在任何你喜欢的文本编辑器中打开这个目录。我正在使用“Visual Studio代码”。如果你想让事情和我一模一样，你可以在这里下载。</p><p id="5d4d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.粘贴我们在步骤8中下载的私钥文件，因为它位于目录的根目录中。将文件重命名为您喜欢的任何名称，我将把它命名为“credentials.json”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/64c3e8a5219678a34d40c9cf385036a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:648/format:webp/1*3lbu42PAhuSYUGkQDNhG9A.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="84fe" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">4.打开“VS代码”中的集成终端或机器终端。如果您使用计算机的终端，首先导航到工作目录，然后运行命令:</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="03ed" class="of lq in ob b gy og oh l oi oj">npm init -y</span></pre><p id="c3c7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该命令将初始化目录，并创建一个“package.json”文件，该文件将记录我们所有的依赖项。</p><p id="0056" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">5.现在，我们将安装项目所需的依赖项。只有两个，我们想要的，即'快递'，和'谷歌API '。运行下面的命令来安装它们。</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="5636" class="of lq in ob b gy og oh l oi oj">npm i express googleapis</span></pre><p id="e9f8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行该命令后，我们将获得“package-lock.json”文件和“node_moldules”文件夹。</p><p id="a074" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">6.我们还将安装' nodemon '，当我们保存文件时，服务器将自动重启。我们将“nodemon”安装为一个开发依赖项，因为我们只是希望它用于本地开发和测试。</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="7975" class="of lq in ob b gy og oh l oi oj">npm i nodemon -D</span></pre><p id="caaf" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在“package.json”文件中，创建一个名为“dev”的脚本，其值为“nodemon server”。这将允许我们使用以下命令再次运行开发服务器:</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="64ab" class="of lq in ob b gy og oh l oi oj">npm run dev</span></pre><p id="4611" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成上述步骤后，您的“package.json”文件应该如下所示:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/be4e336dfc152c2ca50e08b8572274a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*SQiUi4dUsnyX2D51ywBu_w.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="a900" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">页（page的缩写）s:依赖关系版本可能会有所不同。</p><p id="cfd3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">7.创建一个“server.js”文件，我们将在其中编写所有代码。要创建该文件，请在终端中运行以下命令:</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="8a47" class="of lq in ob b gy og oh l oi oj">touch server.js</span></pre><p id="ca67" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">8.打开“server.js”文件，调用我们刚刚安装的依赖项。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/7e9177222057b22a4a532895430d207e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*Fo66h4jJztTa2AUmS7eSow.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="c16e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">初始化express并在端口3000(可以是任何数字)上监听服务器。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi om"><img src="../Images/e139a6cb478f12c8e7ed01033317e774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbQw7XMDhhUdVj5gfO7oRw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="9c12" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面的代码允许我们解析传入的JSON数据。</p><pre class="kz la lb lc gt oa ob oc od aw oe bi"><span id="c5d3" class="of lq in ob b gy og oh l oi oj">app.use(express.json())</span></pre><p id="d381" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">9.我们将创建一个名为“authentication”的函数，因为读取数据(get请求)和写入数据(post请求)是很常见的。</p><p id="4f9b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“authentication”应该是一个“async”函数，因为我们将在其中使用promise“async”将允许我们在函数中使用“await”。您也可以使用“then”和“catch”块来处理承诺，但我更喜欢“async await”。你可以在<a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Async_await" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于“异步等待”的内容。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d42c6413274cab364af3eb77044768ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*R4v5YujP9sbP3SW4Mu_ECQ.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="afe4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">auth变量将使用credentials.json文件验证我们的凭证。scopes的属性告诉我们将使用哪个Google API，并且我们既可以读取数据也可以向工作表中写入数据。</p><p id="e051" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→一旦我们的详细信息在“auth”变量中得到验证，“client”变量将存储来自“<strong class="ke io"> auth.getClient() </strong>”方法的客户端(我们的服务帐户)详细信息。</p><p id="cc23" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→变量“sheets”将创建Google Sheets的一个实例，然后我们将使用该实例从我们的帐户中使用sheet id访问特定的sheet。' google.sheets '有两个属性:I) 'version '的值是' v4 ',因为这是我们正在使用的；II)' auth '的值是我们创建的' client '变量的值。它说获取这个客户的google sheets详细信息。</p><p id="8a77" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→最后我们会返回一个‘sheets’的对象。</p><p id="b441" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">10.现在，我们将创建一个“get”请求来从我们的电子表格中读取数据。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/17ae4de49bd2c0da7204414c84927cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*mgg2abL4Om1_VDIMNKMH5Q.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="183e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保将“get”请求的回调函数设置为“async”。</p><p id="24d0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→我们将等待“认证”功能，因为它包含“await”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi op"><img src="../Images/25883f732342ab1128d6925e1610b6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*JQk-HUJcvoF1i9CtKqWZOg.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="ce5c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→然后我们将从函数中析构“sheets”变量。如果你不知道JavaScript中的析构是什么，你可以在这里了解更多。</p><p id="f529" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→在“get”请求外创建一个名为“id”的变量。我们将它存储为一个全局变量，因为我们将在“get”和“post”请求中使用它。带红色下划线的文本是电子表格id:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi oq"><img src="../Images/52fed844fbeff743e030d9d915faf63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDRKLyJJd-7R2ns0JbJHng.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi or"><img src="../Images/4459f25490cb432ff6c925d4a93c1afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzP6-9Zn2JmaCWHYaVrUyg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="c308" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">11.现在，我们将读取电子表格中的行。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi os"><img src="../Images/83db0e0cd15ea1d1d2ed187b3de45c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*GTNNj7XJOSmx6nobNQoS3g.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="55fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→确保将所有代码放在“try catch”块中，因为这样可以轻松处理错误。你可以在这里了解更多关于<a class="ae lo" href="https://www.w3schools.com/js/js_errors.asp" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="1cb4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→“sheets . spread sheet . value . get”总共有5个参数，其中2个参数是必需的，即“spreadsheetId”和“range”，这2个参数称为路径参数。“spreadsheetId”将具有电子表格的id,“range”将具有工作表的名称。我们还可以限制工作表的范围，只需用'！'分隔工作表名称并输入列范围。例如:“Sheet1！一个:D。</p><p id="6e5e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→其他3个可选参数是——I)“major dimension”表示是按行还是按列获取数据，默认为“rows”。II)“valueRenderOption”告诉获取数据，就像它已经被输入到google sheet中一样，或者只是作为一个字符串。III) 'dateTimeRenderOption '告诉时间、日期和持续时间应该如何在输出中表示。你可以在这里阅读更多关于他们<a class="ae lo" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/get" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="ac40" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">response变量将存储我们指定的google工作表。最后，我们将从收到的响应中发送“response.data”。我们将使用“Postman”来测试我们的请求。这是一个很棒的工具&amp;不需要前端就可以免费测试请求。如果还没有安装，你可以在这里下载<a class="ae lo" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="3fce" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→打开postman，输入‘http://localhost:3000(您指定的端口号)/’，点击‘发送’。结果会是这样的:</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/8e87d0bd5eb94a5f5702a65dedf40540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*dkDmAhmYpGI7881_y_04eQ.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="703a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→“值”数组会因电子表格中的数据不同而有所不同，但格式应该是相同的。</p><p id="2f6b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→这样，我们就成功地从电子表格中读取了数据。</p></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><h1 id="1a11" class="lp lq in bd lr ls nt lu lv lw nu ly lz jt nv ju mb jw nw jx md jz nx ka mf mg bi translated">使用Node.js将数据写入电子表格</h1><ol class=""><li id="f0d3" class="mh mi in ke b kf mj ki mk kl ml kp mm kt mn kx mo mp mq mr bi translated">在文本编辑器中创建新的“发布”请求。</li></ol><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/4b929cad16fb5d2d969ed93fd0902c6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*efkkIG51-RqX1T3V-jkDOw.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="7f53" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">确保post请求的回调函数为“async ”,因为我们将在其中使用“await”。</p><p id="c6a3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">2.现在，我们将数据写入电子表格。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ov"><img src="../Images/0e9c14e116b2c93b5276f468eae12065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ziWeyuMldETDFhLug29Znw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="87e0" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→确保将所有代码放在“try catch”块中，因为这样可以更有效地处理错误。你可以在这里了解更多关于‘try catch’模块<a class="ae lo" href="https://www.w3schools.com/js/js_errors.asp" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="e891" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→首先，从“req.body”对象中析构“newName”和“newValue”变量。这也将要求用户输入新的名称和值。</p><p id="c933" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→然后从“认证”功能中析构“sheets”变量。请确保将“await”关键字放在“authentication”之前。</p><p id="8b99" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→“sheets . spreadsheets . value . append”将数据添加到电子表格中。它主要接受4个参数，即:“spreadsheetId”、“range”、“valueInputOption”和“resource”。“spreadsheetId”和“range”在“读取数据”的第11点中解释。</p><p id="35ea" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一方面，“资源”是一个带有“值”属性的对象，“值”是一个数组。这个数组保存我们想要插入到电子表格中的新数据。要插入的数据也应该是一个数组。</p><p id="77b3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“valueInputOption”决定了Google Sheets如何解释输入数据。“USER _ ENTERED”意味着用户输入的值将被解析，就像用户将它输入到Google Sheets中一样。你可以在这里了解更多关于“价值输入选项”对<a class="ae lo" href="https://developers.google.com/sheets/api/reference/rest/v4/ValueInputOption" rel="noopener ugc nofollow" target="_blank">的选择。</a></p><p id="5b2f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→其他4个参数可能对您的应用有用。您可以在“查询参数”标题下的处查看这些参数<a class="ae lo" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/append" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5a83" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将追加请求的响应存储在一个名为“writeReq”的变量中。</p><p id="f600" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→现在，我们正在检查“writeReq”的状态，如果“writeReq.status”评估为200，这意味着一切顺利，我们将返回一条消息，说明“电子表格已成功更新”。这条消息可以是任何内容。</p><p id="765d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“if”块外的“return”语句只有在“writeReq”状态的计算结果不是200时才会执行。您可以通过对变量执行'<strong class="ke io"> console.log </strong>'来检查' writeReq '上可用的各种其他选项。</p><p id="62ff" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">“catch”块将在出现错误时执行，因为我们正在执行“<strong class="ke io"> console.log(e) </strong>”，所以调试错误会更容易。</p><p id="08df" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3.现在，打开“Postman”，创建一个新的“POST”请求到“http://localhost:3000(您的端口号)/”。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ow"><img src="../Images/374b01df88ff9b5f0cf0a0dc988237c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RP-sHl1e32ERwJdbeyxhrQ.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="1e48" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→点击‘Body’&gt;‘raw’&gt;‘JSON’。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ox"><img src="../Images/ddd7b5c4abeb8c270dd06bae618c4d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPxtagTNo-1ssiyWci-hzg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="19a1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→输入如图所示的数据,“新名称”和“新值”键的名称应该相同。您可以根据自己的意愿为这些键输入值(例如:您可以写除Mark之外的任何名称&amp;除75之外的任何其他“新值”)。</p><p id="ca11" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→输入数据后，点击“发送”。单击send后，响应应该是这样的。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi oy"><img src="../Images/d81aec89504ddc0a5513613bfadd1652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6La07hrELgo-WrBQaxh-Q.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure><p id="99f4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">→您的Google表单现在会更新。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div class="ab gu cl oz"><img src="../Images/d1c4606c62632a95d2836347601c1555.png" data-original-src="https://miro.medium.com/v2/0*Sa5JMyp_oHlBnr5f"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">image by author</figcaption></figure></div><div class="ab cl nk nl hr nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="ig ih ii ij ik"><h1 id="6163" class="lp lq in bd lr ls nt lu lv lw nu ly lz jt nv ju mb jw nw jx md jz nx ka mf mg bi translated">结论</h1><p id="dffa" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl pa kn ko kp pb kr ks kt pc kv kw kx ig bi translated">这样，我们成功地读取了数据，并将数据插入到电子表格中。希望这篇文章值得你花时间，如果你还在读这篇文章，非常感谢你抽出时间来读这篇文章！</p><p id="0ed8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="pd">更多内容尽在</em><a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="pd">plain English . io</em></a></p></div></div>    
</body>
</html>