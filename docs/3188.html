<html>
<head>
<title>Making a Web-based Flappy Bird Clone with p5.js | Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用p5.js制作基于Web的Flappy Bird克隆体|第3部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/making-a-web-based-flappy-bird-clone-with-p5-js-part-3-32d4e96b8737?source=collection_archive---------16-----------------------#2021-06-28">https://javascript.plainenglish.io/making-a-web-based-flappy-bird-clone-with-p5-js-part-3-32d4e96b8737?source=collection_archive---------16-----------------------#2021-06-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/76f346c8e4d0ec32b885df850db8c5e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*V35iN2RCMU_pOcLX8xK9mA.png"/></div></figure><h2 id="1d57" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">概述</h2><p id="b572" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">这是flappy鸟克隆系列的第3部分。你可以在这里找到第一部分<a class="ae li" rel="noopener ugc nofollow" target="_blank" href="/how-to-make-a-web-based-flappy-bird-clone-with-p5-js-part-1-2913fde25c8a">，在这里</a>找到第二部分<a class="ae li" rel="noopener ugc nofollow" target="_blank" href="/making-a-web-based-flappy-bird-clone-with-p5-js-part-2-c554254881b1">。在上一篇文章中，我讲述了如何将地面和管道对象添加到屏幕上，并使它们像Flappy Bird中那样移动。</a></p><h2 id="2b9d" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">鸟的物体</h2><p id="500d" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">现在，我们将研究著名的扑翼鸟本身。同样，这个游戏中的鸟在整个游戏过程中保持水平方向不动，只在屏幕上上下移动。因此，鸟的位置更新将只在上下方向。游戏中的鸟也在拍打它的翅膀，因此我们需要找到一种机制来显示鸟的不同图像，使它看起来像鸟在拍打翅膀。</p><p id="6438" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">首先是鸟类图像的导入。在提供的起始代码中，我包含了3张鸟的图片，它们之间唯一的区别是翅膀的位置。为了在我们的代码中使用这些，我们将把图像预加载到一个数组中。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="55ba" class="jr js in lt b gy lx ly l lz ma">let BIRD_IMG;</span><span id="e60b" class="jr js in lt b gy mb ly l lz ma">function preload() {<br/> BIRD_IMG = [<br/>  loadImage(“assets/bird1.png”),<br/>  loadImage(“assets/bird2.png”),<br/>  loadImage(“assets/bird3.png”),<br/> ];<br/>}</span></pre><p id="6139" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">在我们深入到主要代码之前，让我们收集一下我们需要对这只鸟做些什么的想法。第一件事是让鸟能够跳跃。然后，每当这只鸟跳跃时，它就把自己向上旋转。当它向上旋转时，它扇动翅膀。当鸟不飞行时，它失去高度，指向地面下方。</p><h2 id="bf44" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">该上来的一定要下来</h2><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="795b" class="jr js in lt b gy lx ly l lz ma">function Bird() {<br/> this.SCALE = 1.75;</span><span id="fc11" class="jr js in lt b gy mb ly l lz ma"> this.y = WIN_HEIGHT / 2;<br/> this.x = WIN_WIDTH / 3;<br/> this.tilt = 0; </span><span id="afee" class="jr js in lt b gy mb ly l lz ma"> //Physics variables<br/> this.tick_count = 0;<br/> this.gravity = 0.2;<br/> this.velocity = 0; //Jump velocity — NOT CONSTANT VELOCITY<br/> this.jump_height = this.y + 20;</span><span id="6da2" class="jr js in lt b gy mb ly l lz ma"> this.show = (i) =&gt; {<br/>  imageMode(CENTER); <br/>  // NOTE: we change the image mode here to make sure the bird<br/>  // rotates around it's center. <br/>  image(<br/>   BIRD_IMG[i],<br/>   0,<br/>   0,<br/>   this.SCALE * BIRD_IMG[i].width,<br/>   this.SCALE * BIRD_IMG[i].height<br/>  );<br/> };</span><span id="302e" class="jr js in lt b gy mb ly l lz ma"> this.update = () =&gt; {<br/>  let displacement = this.getDisplacement();<br/>  this.y -= displacement;<br/>  this.updateTiltBasedOnDisplacement(displacement);</span><span id="623d" class="jr js in lt b gy mb ly l lz ma">  //Limiting y position of the bird<br/>  if (this.y &gt; height — GROUND_HEIGHT) {<br/><br/>   this.y = height — GROUND_HEIGHT;<br/>   displacement = 0;<br/>  }</span><span id="a5f1" class="jr js in lt b gy mb ly l lz ma">  if (this.y &lt; -30) {<br/>   this.y = -30;<br/>   displacement = 0;<br/>  }</span><span id="4350" class="jr js in lt b gy mb ly l lz ma">  translate(this.x, this.y);<br/>  rotate(this.tilt);<br/> }</span><span id="1bbd" class="jr js in lt b gy mb ly l lz ma"> this.getDisplacement = () =&gt; {<br/>  // Displacement means the amount of y position change every update<br/>  this.tick_count += 1;<br/>  //kinematics equation — initial velocity is 0 in most cases except<br/>  //for jump event<br/>  let displacement = this.velocity — 0.5 * this.gravity * this.tick_count ** 2;<br/>  this.velocity -= this.gravity * this.tick_count;</span><span id="b25b" class="jr js in lt b gy mb ly l lz ma"> //Limiting velocity and displacement so fall rate doesn’t get <br/> //too high<br/>  if (this.velocity &lt; 0) {<br/>   this.velocity = 0;<br/>  }</span><span id="efe9" class="jr js in lt b gy mb ly l lz ma">  if (displacement &gt;= 5) {<br/>   displacement = 5;<br/>  }</span><span id="c9a1" class="jr js in lt b gy mb ly l lz ma"> //Positive displacement means we are jumping<br/>  if (displacement &gt; 0) {<br/>   displacement += 10;<br/>  }<br/>  return displacement;<br/> };</span><span id="607d" class="jr js in lt b gy mb ly l lz ma"> this.updateTiltBasedOnDisplacement = (displacement) =&gt; {<br/>  if (displacement &gt; 0 || this.y &lt; this.jump_height) {<br/>   // Negative means tilt up because counter-clockwise<br/>   this.tilt = -25;<br/>  } else {<br/>   if (this.tilt &lt; 76) {<br/>    this.tilt += 20;<br/>   }<br/>   if (this.tilt &gt; 90) {<br/>    this.tilt = 90;<br/>   }<br/>  }<br/> };</span><span id="c096" class="jr js in lt b gy mb ly l lz ma"> this.hitGround = () =&gt; {<br/>  return this.y &gt; height — GROUND_HEIGHT — BIRD_IMG[0].width;<br/> };<br/>}</span></pre><p id="bb41" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">这有很多代码，看起来可能有点复杂，但是让我们一点一点来。首先，让我们看看getDisplacement方法。这种方法用于获得鸟在每一个间隔经历的垂直距离。在鸟物体内部，我们有一个内部时钟，我们称之为tick _ count——这是我们运动学方程中的时间变量，你可以通过位移计算看到。</p><p id="c507" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">在update方法中，我们获得了添加到鸟的y位置的位移。在这里，我们没有像处理地面和管道一样，在x和y位置显示鸟的图像。相反，我们使用p5提供的translate函数来移动这只鸟——老实说，我不太记得我为什么决定以这种方式编写代码，但了解一种不同的做事方式应该很有趣。updateTiltBasedOnDisplacement也非常简单明了，但是如果你有任何问题，请在评论区提问。</p><h2 id="bf6e" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么东西落下来…有时会冒出来？</h2><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="f603" class="jr js in lt b gy lx ly l lz ma">function Bird() {<br/> this.FLAP_INTERVAL = 2;<br/> ...</span><span id="1735" class="jr js in lt b gy mb ly l lz ma"> this.update = () =&gt; {<br/>  ...<br/>  this.updateImage()<br/> };</span><span id="4cc8" class="jr js in lt b gy mb ly l lz ma">this.updateImage = () =&gt; {<br/>  if (this.tilt &gt; 80) {<br/>   //If bird is pointing down, don’t animate flapping<br/>   this.show(1);<br/>  } else {<br/>   if (this.img_count &lt;= this.FLAP_INTERVAL) {<br/>    this.show(0);<br/>   } else if (this.img_count &lt;= this.FLAP_INTERVAL * 2) {<br/>    this.show(1);<br/>   } else if (this.img_count &lt;= this.FLAP_INTERVAL * 3) {<br/>    this.show(2);<br/>   } else if (this.img_count &lt;= this.FLAP_INTERVAL * 4) {<br/>    this.show(1);<br/>   }<br/>  }<br/> };</span><span id="1028" class="jr js in lt b gy mb ly l lz ma">this.updateImgCount = () =&gt; {<br/>  //Updates to keep track of flapping mechanism<br/>  this.img_count += 1;<br/>  if (this.img_count &gt; this.FLAP_INTERVAL * 4) {<br/>   this.img_count = 0;<br/>  }<br/> };</span><span id="e96b" class="jr js in lt b gy mb ly l lz ma"> this.jump = () =&gt; {<br/>  this.velocity = 10; //add positive velocity to simulate a jump<br/>  this.tick_count = 0; //tick count reset<br/>  this.jump_height = this.y;<br/> };</span><span id="9c17" class="jr js in lt b gy mb ly l lz ma">this.getDisplacement = () =&gt; {<br/>  ...<br/> };</span><span id="2422" class="jr js in lt b gy mb ly l lz ma">this.updateTiltBasedOnDisplacement = (displacement) =&gt; {<br/>  ...<br/> };</span><span id="9a04" class="jr js in lt b gy mb ly l lz ma">this.hitGround = () =&gt; {<br/>  ...<br/> };<br/>}</span></pre><p id="151c" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">updateImage方法包含“动画”逻辑，其中显示的图像取决于鸟的image_count。FLAP_INTERVAL是图像在特定位置停留多少帧的调整因子。FLAP_INTERVAL为2意味着每幅图像显示2帧。这里的跳跃仅仅意味着给鸟增加一点正速度，getDisplacement方法将处理位置更新。</p><pre class="lo lp lq lr gt ls lt lu lv aw lw bi"><span id="0bb8" class="jr js in lt b gy lx ly l lz ma">// index.js</span><span id="bbcb" class="jr js in lt b gy mb ly l lz ma">...<br/>let bird;</span><span id="f8a2" class="jr js in lt b gy mb ly l lz ma">function setup(){<br/> ... <br/> bird = new Bird()<br/>}</span><span id="d53d" class="jr js in lt b gy mb ly l lz ma">function draw() {<br/> ...</span><span id="4d1b" class="jr js in lt b gy mb ly l lz ma">//don't need to show bird because show is called inside update<br/> bird.update(); <br/>}</span><span id="550d" class="jr js in lt b gy mb ly l lz ma">function keyPressed() {<br/> if (key === " ") {<br/>  bird.jump();<br/> }<br/>}</span><span id="fa51" class="jr js in lt b gy mb ly l lz ma">function mouseClicked() {<br/> bird.jump()<br/>}</span></pre><p id="1525" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated">最后，keyPressed和mouseClicked是监听用户事件的p5函数。在这里，我想让小鸟在我点击空格键或鼠标时跳起来。正如您可能已经猜到的，keyPressed和mouseClicked是检测用户事件的p5函数。</p><figure class="lo lp lq lr gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><h2 id="86ef" class="jr js in bd jt ju jv dn jw jx jy dp jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">暂时就这样了</h2><p id="b621" class="pw-post-body-paragraph kn ko in kp b kq kr ks kt ku kv kw kx ka ky kz la ke lb lc ld ki le lf lg lh ig bi translated">嗯，这是一个密集的，但我们现在在最后冲刺阶段。如果有任何问题，请在评论中告诉我。下一次，我们将添加一个简单的碰撞检测机制，并添加分数跟踪。以下是第四部分的链接。</p><p id="cd8b" class="pw-post-body-paragraph kn ko in kp b kq lj ks kt ku lk kw kx ka ll kz la ke lm lc ld ki ln lf lg lh ig bi translated"><em class="me">更多内容尽在</em><a class="ae li" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kp io"><em class="me">plain English . io</em></strong></a></p></div></div>    
</body>
</html>