<html>
<head>
<title>Handle Multiple Environments in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中处理多种环境</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handle-multiple-environments-in-react-d3d05b2c4248?source=collection_archive---------4-----------------------#2021-01-30">https://javascript.plainenglish.io/handle-multiple-environments-in-react-d3d05b2c4248?source=collection_archive---------4-----------------------#2021-01-30</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="2217" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">简单而优雅的解决方案</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/45e356520b70e02833bd296397e4b047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sla8rFXzQ4IUzRQwgUhcAg.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@johnmarkarnold?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">John Mark Arnold</a> on <a class="ae kw" href="https://unsplash.com/s/photos/blocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1931" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">当处理一个react项目时，我们通常需要存储一些关于我们正在处理的特定环境的信息。例如，我们可以为<code class="fe lt lu lv lw b">development</code>、<code class="fe lt lu lv lw b">test</code>和<code class="fe lt lu lv lw b">production</code>服务器使用单独的BASE_URL。</p><p id="e19e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">但是，当我们需要为单独的环境部署应用程序时，每次都在代码中手动更改端点是不现实的。如果有人忘记更改生产端点，并且我们的生产应用程序与开发端点一起部署，这可能会造成灾难。</p><h1 id="c267" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">有什么解决办法？</h1><p id="4a4f" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">我们必须为不同的环境维护不同的变量。在ReactJS中，我们可以访问名为<code class="fe lt lu lv lw b">NODE_ENV</code>的默认环境变量。</p><p id="1dbf" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">当我们运行下面的命令时,<code class="fe lt lu lv lw b">NODE_ENV</code>的默认值是…</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="b5cd" class="my ly ir lw b gz mz na l nb nc"><strong class="lw is">npm start      // NODE_ENV = </strong> development<br/><strong class="lw is">npm run build  // NODE_ENV =  </strong>production<br/><strong class="lw is">npm run test   // NODE_ENV =  </strong>test</span></pre><p id="6ff7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们可以在运行时使用<strong class="kz is"> process.env.NODE_ENV </strong>从项目内部的任何地方访问这些变量，并决定访问哪个变量。</p><p id="c947" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">因此，对于我们的场景，一个解决方案可能是这样的…</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nd"><img src="../Images/ecab8d648433629f7ea1e3e49738a561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fj4n5vL6ibcXiB8qJ_JItw.png"/></div></div></figure><p id="63e4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这是一个可能的解决方案，但是不可扩展。如果我们有数百个配置变量，那么这些值将分散在整个项目中，很快就会变得一团糟。</p><h1 id="9d38" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">让我们改进这一点</h1><p id="44da" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">React提供了一种处理这种情况的简洁方法。我们希望所有的环境变量都存储在一个地方。为此，我们需要在根文件夹中创建一个名为<code class="fe lt lu lv lw b">.env</code>的文件。</p><p id="5ae8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在该文件中，我们将放置所有的环境变量。但是我们需要小心命名。</p><blockquote class="ne"><p id="fe22" class="nf ng ir bd nh ni nj nk nl nm nn ls dk translated">所有变量都应该以前缀REACT_APP_开头</p></blockquote><p id="5a9d" class="pw-post-body-paragraph kx ky ir kz b la no js lc ld np jv lf lg nq li lj lk nr lm ln lo ns lq lr ls ik bi translated">所以对于我们的基本URL，我们可以写</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="ac2e" class="my ly ir lw b gz mz na l nb nc">REACT_APP_BASE_URL = “MY_BASE_URL_FOR_PRODUCTION”</span></pre><p id="b469" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">然后，我们可以通过简单的</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nt"><img src="../Images/30a179b71f5d63e2aeaa3dc4bf9e9623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2r2f0LD7kxBtJ3JaorUvXw.png"/></div></div></figure><p id="73c6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">优雅对吗？</p><p id="6ff0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">我们可以随心所欲地增加价值。</p><p id="c142" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">好吧，但是我们的其他环境呢？为此，我们将创建另一个名为<strong class="kz is"> </strong> <code class="fe lt lu lv lw b"><strong class="kz is">.env.development</strong></code> <strong class="kz is"> </strong>的文件，并将我们的开发变量放在那里。在<code class="fe lt lu lv lw b"><strong class="kz is">.env.development</strong></code>文件内</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="d87f" class="my ly ir lw b gz mz na l nb nc">REACT_APP_BASE_URL = “MY_BASE_URL_FOR_DEVELOPMENT”</span></pre><p id="b2e7" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">类似地，我们可以通过创建另一个名为<strong class="kz is"> .env.test </strong>的文件来创建另一个测试文件</p><p id="d8e9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在我们准备好了。请注意，我们没有创建任何名为<code class="fe lt lu lv lw b"><strong class="kz is">.env.production</strong></code>的文件，因为默认情况下，如果react没有找到任何带有适当后缀的文件，它会选择<code class="fe lt lu lv lw b"><strong class="kz is">.env</strong></code>文件。所以按照惯例，<code class="fe lt lu lv lw b">.env</code>文件用于生产构建。但是你当然可以创建一个<code class="fe lt lu lv lw b"><strong class="kz is">.env.production</strong></code>文件，它会工作得很好。</p><p id="38f1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在，当您运行命令<strong class="kz is"> npm start </strong>时，基本URL将是您在<code class="fe lt lu lv lw b">.env.development</code>文件中给出的URL，并且在为生产构建时，它将是您的生产URL。</p><h1 id="70fa" class="lx ly ir bd lz ma mb mc md me mf mg mh jx mi jy mj ka mk kb ml kd mm ke mn mo bi translated">需要更多的环境吗？</h1><p id="ab20" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">现在很容易了。如果你需要另一个环境。比如<code class="fe lt lu lv lw b"><em class="nu">staging</em></code> <em class="nu">。</em>然后<em class="nu"> </em>在您的启动脚本中，您必须像这样指定<code class="fe lt lu lv lw b">NODE_ENV</code>变量…</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="6d33" class="my ly ir lw b gz mz na l nb nc">"start:staging": "NODE_ENV=staging react-scripts start",</span></pre><p id="7e2a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">并创建一个相应的. env.staging文件来存放您的环境变量。当你跑步的时候</p><pre class="kh ki kj kk gu mu lw mv mw aw mx bi"><span id="8fab" class="my ly ir lw b gz mz na l nb nc">npm start:staging</span></pre><p id="ca8c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">现在将从<code class="fe lt lu lv lw b"><strong class="kz is">.env.staging</strong></code>文件中读取数值。</p><h2 id="1687" class="my ly ir bd lz nv nw dn md nx ny dp mh lg nz oa mj lk ob oc ml lo od oe mn of bi translated">结论</h2><p id="c80a" class="pw-post-body-paragraph kx ky ir kz b la mp js lc ld mq jv lf lg mr li lj lk ms lm ln lo mt lq lr ls ik bi translated">这就是我们如何在React应用中处理多种环境。</p><p id="9ea2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">祝您愉快！:D</p><p id="3c4e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated"><strong class="kz is">通过</strong><a class="ae kw" href="https://www.linkedin.com/in/56faisal/" rel="noopener ugc nofollow" target="_blank"><strong class="kz is">LinkedIn</strong></a><strong class="kz is">或我的</strong> <a class="ae kw" href="https://www.mohammadfaisal.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz is">个人网站</strong> </a> <strong class="kz is">与我取得联系。</strong></p></div></div>    
</body>
</html>