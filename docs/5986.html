<html>
<head>
<title>Learn Jest — JavaScript Unit Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习Jest——JavaScript单元测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/learn-jest-javascript-unit-testing-5ca104b564ce?source=collection_archive---------15-----------------------#2021-12-22">https://javascript.plainenglish.io/learn-jest-javascript-unit-testing-5ca104b564ce?source=collection_archive---------15-----------------------#2021-12-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b730696e24ad722844b38221b8b39846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1BAjk1oGYmHjprln"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2d34" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">单元测试是指测试单个代码单元，甚至多个代码单元，以确保它们按预期运行。要做到这一点，通常需要识别边缘情况，在这种情况下，由于某些输入，代码的执行可能与预期的不同。在本文中，我们将介绍如何使用<a class="ae kc" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank"> Jest </a>测试框架在JavaScript中实现单元测试。</p><div class="lb lc gp gr ld le"><a href="https://jestjs.io" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">玩笑</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">Jest是一个JavaScript测试框架，旨在确保任何JavaScript代码库的正确性。它允许您…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">jet js . io</p></div></div><div class="ln l"><div class="lo l lp lq lr ln ls jw le"/></div></div></a></div><h1 id="7e08" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">我们在测试什么？</h1><p id="57bd" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">你可以跟随你自己的项目，但是为了完整起见，我创建了一个小的数学库，你可以使用它来跟随本教程。在这一节中，我们将设置项目，因此如果您正在跟进自己的项目，可以跳过这一步。</p><ol class=""><li id="d641" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated">为项目创建一个新目录<code class="fe nf ng nh ni b">mkdir simple-maths</code></li><li id="cff8" class="mw mx iq kf b kg nj kk nk ko nl ks nm kw nn la nb nc nd ne bi translated">初始化一个npm项目<code class="fe nf ng nh ni b">npm init -y</code>(或纱线<code class="fe nf ng nh ni b">yarn init -y</code>)</li><li id="4288" class="mw mx iq kf b kg nj kk nk ko nl ks nm kw nn la nb nc nd ne bi translated">创建一个新文件<code class="fe nf ng nh ni b">index.js</code>并添加以下代码</li></ol><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="5e4c" class="nw lu iq ni b gy nx ny l nz oa">function add(a, b) {<br/>  return a + b<br/>}</span><span id="23bd" class="nw lu iq ni b gy ob ny l nz oa">function subtract(a, b) {<br/>  return a - b<br/>}</span><span id="035b" class="nw lu iq ni b gy ob ny l nz oa">function multiply(a, b) {<br/>  return a * b<br/>}</span><span id="400f" class="nw lu iq ni b gy ob ny l nz oa">function divide(a, b) {<br/>  return a / b<br/>}</span><span id="a0ed" class="nw lu iq ni b gy ob ny l nz oa">function power(a, b) {<br/>  return a ^ b<br/>}</span><span id="77b7" class="nw lu iq ni b gy ob ny l nz oa">module.exports = {<br/>  add,<br/>  subtract,<br/>  multiply,<br/>  divide,<br/>  power<br/>}</span></pre><h1 id="0740" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">安装笑话</strong></h1><p id="3d56" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">我们可以轻松地将Jest安装到我们的npm或yarn项目中。我们将把它作为开发依赖项来安装。</p><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="0d21" class="nw lu iq ni b gy nx ny l nz oa"># npm<br/>npm i --save-dev jest<br/># yarn<br/>yarn add --dev jest</span></pre><p id="d724" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦安装完毕，给你的<code class="fe nf ng nh ni b">package.json</code>文件添加一个<code class="fe nf ng nh ni b">test</code>别名是个好主意。这将允许您运行<code class="fe nf ng nh ni b">npm test</code>或<code class="fe nf ng nh ni b">yarn test</code>而不是<code class="fe nf ng nh ni b">jest</code>命令，以及您最终用来配置它的任何标志。这也让其他人更容易看到测试应该如何运行。</p><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="73c0" class="nw lu iq ni b gy nx ny l nz oa">  ...<br/>  "scripts": {<br/>    "test": "jest"<br/>  }<br/>  ...</span></pre><h1 id="6650" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">写测试</strong></h1><p id="3921" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">默认情况下，Jest会查找<code class="fe nf ng nh ni b">*.test.js</code>和<code class="fe nf ng nh ni b">*.spec.js</code>文件，以及<code class="fe nf ng nh ni b">__test__</code>目录中的任何文件。这个选项可以被<a class="ae kc" href="https://jestjs.io/docs/configuration#testregex-string--arraystring" rel="noopener ugc nofollow" target="_blank">配置为在其他地方</a>寻找，但是为了教程的缘故，我们将使用<code class="fe nf ng nh ni b">*.</code>文件。</p><p id="c738" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个名为<code class="fe nf ng nh ni b">index.test.js</code>的文件。如果您正在使用自己的代码，请尝试找到一个包含独立工作的函数的文件。Jest为我们提供了一个测试套件，包含帮助我们定义和运行测试的函数，以及检查函数结果的断言函数。</p><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="6c45" class="nw lu iq ni b gy nx ny l nz oa">const { add } = require("./index.js")</span><span id="59f2" class="nw lu iq ni b gy ob ny l nz oa">test('adding 1 + 1 = 2', () =&gt; {<br/>  expect(add(1, 1)).toBe(2)<br/>})</span></pre><p id="3146" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过调用<code class="fe nf ng nh ni b">test</code>函数来定义一个测试。第一个参数是测试的描述，应该描述测试的内容。第二个参数是执行第一个参数中描述的操作和检查的函数。为了验证我们的函数也返回我们期望的结果，我们使用‘expect’函数创建一个断言，然后我们“期望”它等于2。<code class="fe nf ng nh ni b">.toBe</code>函数是匹配器，如果提供给<code class="fe nf ng nh ni b">expect</code>的参数不等于<code class="fe nf ng nh ni b">to</code>的参数，那么抛出一个错误，测试失败。有许多匹配器，如果您正在向您的项目添加测试，我鼓励您查看<a class="ae kc" href="https://jestjs.io/docs/expect" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><div class="lb lc gp gr ld le"><a href="https://jestjs.io/docs/expect" rel="noopener  ugc nofollow" target="_blank"><div class="lf ab fo"><div class="lg ab lh cl cj li"><h2 class="bd ir gy z fp lj fr fs lk fu fw ip bi translated">期待笑话</h2><div class="ll l"><h3 class="bd b gy z fp lj fr fs lk fu fw dk translated">当您编写测试时，您经常需要检查值是否满足某些条件。expect让您可以访问…</h3></div><div class="lm l"><p class="bd b dl z fp lj fr fs lk fu fw dk translated">jet js . io</p></div></div><div class="ln l"><div class="oc l lp lq lr ln ls jw le"/></div></div></a></div><h1 id="9d6c" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">运行测试</strong></h1><p id="0a2a" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">在添加任何更多的测试之前，让我们运行我们已经运行过的测试，看看命令看起来像什么，并确保我们的第一个测试通过。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi od"><img src="../Images/2e70137a7d592c422e5451ba1dfa66c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*gwlH495PGAhonvyXJ1tK5A.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">First try :)</figcaption></figure><p id="e156" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很好，我们的测试通过了，否则我会担心的。但是，等一下。什么是测试套件，它与测试有什么不同？一个测试套件本质上就是一组测试，通常用一个文件来表示。所以文件“index.test.js”是一个测试套件，我们在里面定义的测试当然是测试。快照与本教程无关，但要知道快照本质上是一种将UI组件与规范进行比较的方式，而不是硬编码的值。</p><h1 id="a4c8" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">识别测试用例</strong></h1><p id="eb8e" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">边缘情况通常是存在于极端情况下的一组输入或输出。测试这些有助于确保您的代码在其领域内的所有情况下都能正常工作。例如，想象一个将对象添加到列表中的函数。这个函数的边缘情况的例子是追加到一个空列表，或者追加到一个没有更多分配空间的列表。这两者都有已定义的、预期的行为，但是为了确保实现正确地处理事情，我们可以编写单元测试来检查我们的工作。</p><p id="95e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽管测试边缘情况很重要，但我还是建议至少包含一个正常情况(例如，只是向填充列表添加一个项目)，以确保它按预期工作。最后，如果您的代码包含任何参数验证，那么显式声明无效案例的测试是一个好主意(提示:参见<a class="ae kc" href="https://jestjs.io/docs/expect#tothrowerror" rel="noopener ugc nofollow" target="_blank"> toThrow </a> matcher)。</p><h1 id="532b" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated"><strong class="ak">测试失败时会发生什么？</strong></h1><p id="228d" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">让我们再写几个测试，专门针对我的<code class="fe nf ng nh ni b">power</code>函数。我们将像以前一样将测试添加到同一个文件中，将<code class="fe nf ng nh ni b">power</code>添加到我们的导入中。我们将编写三个测试。一个正常情况和一个边缘情况。我们的正常情况是2的2次方，我们的极限情况是4的0次方，也就是1。</p><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="8309" class="nw lu iq ni b gy nx ny l nz oa">const { sum, power } = require("./index.js")</span><span id="feaa" class="nw lu iq ni b gy ob ny l nz oa">...</span><span id="61ab" class="nw lu iq ni b gy ob ny l nz oa">test("raise 2 to 2", () =&gt; {<br/>  expect(power(2, 2)).toBe(4)<br/>})</span><span id="da6a" class="nw lu iq ni b gy ob ny l nz oa">test("raise 4 to 0", () =&gt; {<br/>  expect(power(4, 0)).toBe(1)<br/>})</span></pre><p id="364c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好了，让我们开始测试吧。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi oe"><img src="../Images/52aa2161c3661eaebd33d00670fcb702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PtGoFGXp7Ry0ZYYXvSdmXQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Terminal output can be long, so here’s a side-by-side view of both failed tests</figcaption></figure><p id="1b2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">哦不！我们的测试都失败了。返回的数字完全错误。让我们来看看这些信息。我们得到了预期的输出，收到的输出，以及测试文件中抛出错误的代码行。它不会告诉你到底出了什么问题，只是说有什么地方不对劲。现在让我们来看看<code class="fe nf ng nh ni b">index.js</code>中的权力功能。</p><pre class="no np nq nr gt ns ni nt nu aw nv bi"><span id="599c" class="nw lu iq ni b gy nx ny l nz oa">function power(a, b) {<br/>  return a ^ b<br/>}</span></pre><p id="031e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">快速提示，在深入代码调试函数之前，请仔细检查您收到的值是否真的出乎意料。有时候你在写测试的时候只是打了个错别字，这就是问题所在。好了，让我们在用指数运算符<code class="fe nf ng nh ni b">**</code>替换了按位异或运算符<code class="fe nf ng nh ni b">^</code>之后，重新运行我们的测试。</p><figure class="no np nq nr gt jr gh gi paragraph-image"><div class="gh gi of"><img src="../Images/924df73600b43c8df5ebc50a1db0745b.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*BlWKtw20IBU44bIhapSYFA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">V8 is speeding through our simple tests</figcaption></figure><h1 id="a37d" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结论</h1><p id="3dfb" class="pw-post-body-paragraph kd ke iq kf b kg mr ki kj kk ms km kn ko mt kq kr ks mu ku kv kw mv ky kz la ij bi translated">自动化测试是一个强大的工具，它不仅现在能帮助你，而且在任何时候有人对你的库进行修改时也能帮助你。只是确保不要在编写测试和调查失败上落后。我只是用Jest触及了测试的表面，这个框架可以做更多的事情。我在下面留下了一些资源，但是如果你想看某个特定的东西的教程，请告诉我。</p><h1 id="241b" class="lt lu iq bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">资源</h1><ul class=""><li id="1a3d" class="mw mx iq kf b kg mr kk ms ko og ks oh kw oi la oj nc nd ne bi translated"><a class="ae kc" href="https://jestjs.io" rel="noopener ugc nofollow" target="_blank"> Jest官网</a></li><li id="ed4c" class="mw mx iq kf b kg nj kk nk ko nl ks nm kw nn la oj nc nd ne bi translated"><a class="ae kc" href="https://jestjs.io/docs/expect" rel="noopener ugc nofollow" target="_blank">笑话撮合者</a></li><li id="09d3" class="mw mx iq kf b kg nj kk nk ko nl ks nm kw nn la oj nc nd ne bi translated"><a class="ae kc" href="https://jestjs.io/docs/configuration" rel="noopener ugc nofollow" target="_blank">配置笑话</a></li><li id="2645" class="mw mx iq kf b kg nj kk nk ko nl ks nm kw nn la oj nc nd ne bi translated"><a class="ae kc" href="https://jestjs.io/docs/snapshot-testing" rel="noopener ugc nofollow" target="_blank">快照测试</a></li></ul><p id="0aaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ok">更多内容看</em> <a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="ok">说白了就是</em> </strong> </a> <strong class="kf ir"> <em class="ok">。</em> </strong> <em class="ok">报名参加我们的</em> <a class="ae kc" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="ok">免费每周简讯这里</em> </strong> </a> <strong class="kf ir"> <em class="ok">。</em> </strong></p></div></div>    
</body>
</html>