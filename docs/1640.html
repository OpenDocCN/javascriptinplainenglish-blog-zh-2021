<html>
<head>
<title>How I Built a React Web App That Tracks User Fitness with Strava</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用Strava构建一个React Web应用程序来跟踪用户的健身情况</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/portfolio-project-very-very-far-f77d1241a626?source=collection_archive---------7-----------------------#2021-04-08">https://javascript.plainenglish.io/portfolio-project-very-very-far-f77d1241a626?source=collection_archive---------7-----------------------#2021-04-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d04c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">一款移动优先的React web应用程序，可与用户的Strava帐户连接，以独特的方式检查他们跑步、骑自行车和游泳的总距离。</em></p><p id="e2db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你穿越美国了吗？整个地球呢？你离月球有多近？</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/472c87d711032176198e0f434ca2f4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bh8sYyl2CNEhc-By5D-m_Q.png"/></div></div></figure><p id="6e17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今年三月，我建造了<a class="ae kv" href="https://veryveryfar.vercel.app/" rel="noopener ugc nofollow" target="_blank">非常非常远的</a>。它检查了用户在流行的体育社交媒体平台Strava上的活动，并以独特的方式进行比较。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b5ec0730d1acf71fd8dd76950f53201e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oPI1CTk4JSQCBn_cH0mimw.png"/></div></div></figure><p id="12a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦用户使用他们的Strava帐户登录，他们可以选择并组合他们的<strong class="jm io">跑步</strong>、<strong class="jm io">骑行</strong>和<strong class="jm io">游泳</strong>总数，以查看这些总数如何使用右侧的选择栏与不同的有趣距离进行比较。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b7e79146e42dede949135bcdd62e7d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5Dk0dN1xveX6tK--1Rdww.png"/></div></div></figure><p id="62c2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用户还可以根据自己的喜好将单位从<strong class="jm io">公制(公里)</strong>切换到<strong class="jm io">英制</strong> <strong class="jm io">(英里)</strong>。</p><h2 id="899f" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">这个概念</h2><blockquote class="lp lq lr"><p id="49c6" class="jk jl ki jm b jn jo jp jq jr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg kh ig bi translated">我们花了这么多时间在移动，但实际上我们走了多远？</p></blockquote><p id="352a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">作为一名终身跑步者，我对Strava非常熟悉。这是我见过的所有跑步者中最受欢迎的社交媒体平台。我刚刚完成了<a class="ae kv" href="https://jackdunleavy.medium.com/portfolio-project-spotify-mood-ring-dba09b6da1e0" rel="noopener">一个使用公共Web API的项目</a>，我很兴奋地发现Strava有了自己的<a class="ae kv" href="https://developers.strava.com/docs/reference/" rel="noopener ugc nofollow" target="_blank"/>。文档看起来很棒，我知道我想用它创造一些东西。</p><p id="d78a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我知道的一件事是跑步者喜欢数据。是Strava存在的理由！耐力运动员喜欢看到他们的活动被分解成速度、劈腿、心率、卡路里、最大摄氧量等。这是这个项目背后的中心思想。用户已经完成了所有这些工作，让我们向他们展示这一切是如何累积起来的！</p><h2 id="3d7c" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">技术</h2><p id="b8d0" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">这个项目的完整资源库可以在GitHub <a class="ae kv" href="https://github.com/dunleavyjack/Strava-Very-Very-Far" rel="noopener ugc nofollow" target="_blank">这里</a>获得，为了构建它，我使用了:</p><ul class=""><li id="22a0" class="ma mb in jm b jn jo jr js jv mc jz md kd me kh mf mg mh mi bi translated"><strong class="jm io">做出反应</strong></li><li id="63a3" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">反应路由器</strong></li><li id="0b0f" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Redux </strong></li><li id="a5eb" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Axios </strong>(针对Strava API的请求)</li><li id="5f7c" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> OAuth2授权</strong></li><li id="ea8e" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">自举5 </strong></li><li id="b3d6" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io">图马</strong>(用于设计UI)</li><li id="8c03" class="ma mb in jm b jn mj jr mk jv ml jz mm kd mn kh mf mg mh mi bi translated"><strong class="jm io"> Vercel </strong>(用于托管和部署)</li></ul><h2 id="b114" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">用户界面注意事项</h2><p id="8288" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">斯特拉发明显是橙色的。这是他们的特征之一，也是我想融入这个项目的东西。我不想看起来像Strava，但是我想提醒用户他们的信息来自哪里。</p><p id="fe9c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于这个项目的重点是呈现数据，我喜欢一个简单的，有点几何图形用户界面的想法。我还选择了靛蓝色来搭配Strava标志性的橙色，同时也给我的项目带来了自己的感觉。</p><h2 id="5ef4" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">状态管理</h2><p id="4c0d" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在整个应用程序中，我使用Redux store处理状态。我了解到较小的项目并不总是需要一个，但我想得到一些使用该技术的实践。</p><p id="f098" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我需要跟踪的第一件事是用户喜欢什么单位。我还需要知道用户选择了什么运动。下面是默认状态的一个简短选择:</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="537a" class="kw kx in mp b gy mt mu l mv mw"> metric: true,<br/> sports: ['running'],<br/> totalDistance: 16639</span></pre><p id="6f58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了简单起见，我使用了一个布尔值在公制和英制之间切换，并使用一个数组来表示所选择的运动。我使用<code class="fe mx my mz mp b">‘running’</code>作为默认值，这样用户一登录就会看到一些数据，使用<code class="fe mx my mz mp b">metric</code>是因为我目前住在韩国。</p><p id="b20d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将代表用户选择的所有活动的总数的<code class="fe mx my mz mp b">totalDistance</code>放入商店也使得在应用程序需要计算时调用该值变得更容易。</p><p id="9df6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我需要存储用户基于运动的运动总量:</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="cd87" class="kw kx in mp b gy mt mu l mv mw">  userActivities: {<br/>    runTotal: {<br/>      kms: '9473.53',<br/>      miles: '5886.58',<br/>      count: 816<br/>    },<br/>    rideTotal: {<br/>      kms: '7166.34',<br/>      miles: '4452.95',<br/>      count: 286<br/>    },<br/>    swimTotal: {<br/>      kms: '1.57',<br/>      miles: '0.98',<br/>      count: 2<br/>    }<br/>  }</span></pre><p id="8311" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于来自Strava API的数据是以米为单位给出的，所以我创建了一个简单的函数将其转换成公里和英里。这样，我只需运行一次转换计算，然后简单地切换两个值。</p><p id="f83c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来，我为每个动作设置了动作创建者和减少者。下面是一个我用来<strong class="jm io">添加</strong>和<strong class="jm io">从用户选择中删除</strong>运动的减速器的例子:</p><pre class="kk kl km kn gt mo mp mq mr aw ms bi"><span id="2014" class="kw kx in mp b gy mt mu l mv mw">const setSportsReducer = (sports = [], action) =&gt; {</span><span id="4585" class="kw kx in mp b gy na mu l mv mw">    switch (action.type) {</span><span id="a750" class="kw kx in mp b gy na mu l mv mw">        case "ADD_SPORT":</span><span id="bc9f" class="kw kx in mp b gy na mu l mv mw">    return [...sports, action.payload];</span><span id="e8b2" class="kw kx in mp b gy na mu l mv mw">        case "REMOVE_SPORT":</span><span id="a79d" class="kw kx in mp b gy na mu l mv mw">    return sports.filter((unit) =&gt; unit !== action.payload);</span><span id="840b" class="kw kx in mp b gy na mu l mv mw">        default:</span><span id="4cf0" class="kw kx in mp b gy na mu l mv mw">            return sports;</span><span id="13c9" class="kw kx in mp b gy na mu l mv mw">    }</span><span id="f142" class="kw kx in mp b gy na mu l mv mw">};</span></pre><p id="98e8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我还为每个动作设置了类似的减速器，并安装了<a class="ae kv" href="https://chrome.google.com/webstore/detail/redux-devtools/lmhkpmbekcpmknklioeibfkpmmfibljd?hl=en" rel="noopener ugc nofollow" target="_blank"> Chrome Redux DevTools扩展</a>来可视化整个过程中的一切。</p><h2 id="eb6f" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">挑战和解决方案</h2><p id="e7df" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated"><strong class="jm io">选择栏放在哪里？</strong></p><p id="900c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最初，我在底部有选择栏，但我不确定我是否喜欢它。我得到了一些非常友好、有用的建议，可以把它移到屏幕的右边，我很高兴我听了。</p><p id="24ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> Strava OAuth2登录</strong></p><p id="c0a1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Strava API功能强大且组织良好，但他们的JavaScript文档有时有点难以理解。使用它的项目也比我预期的要少，除了Strava的一些稍微模糊的指导，我找不到设置登录的教程或指南。</p><p id="90f9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，我想通了，写了一个<a class="ae kv" href="https://levelup.gitconnected.com/add-strava-oauth2-login-to-your-react-app-in-15-minutes-6c92e845919e" rel="noopener ugc nofollow" target="_blank">教程</a>来节省别人一些时间。这是由<strong class="jm io"> Javascript用简单英语</strong>在Medium上发布的，希望它能帮到一些人。</p><p id="d093" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">mapStateToProps→use selector()</strong></p><p id="f62d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个项目的第一稿中，我只能以我所学的唯一方式访问Redux商店，每次我需要商店里的东西时都使用<code class="fe mx my mz mp b">connect</code>和<code class="fe mx my mz mp b">mapStateToProps</code>。我以为这是唯一的办法！</p><p id="0645" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">直到我在网上发布了这个项目，才有人指出了非常有用的<code class="fe mx my mz mp b">useSelector()</code>和<code class="fe mx my mz mp b">useDispath()</code>挂钩。它干净多了，所以我回去重构了所有访问状态的东西。改变已经运行良好的东西有点让人头疼，但是我真的很高兴我这么做了。</p><h2 id="aff7" class="kw kx in bd ky kz la dn lb lc ld dp le jv lf lg lh jz li lj lk kd ll lm ln lo bi translated">总而言之</h2><p id="2ff2" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在这个项目中，我学到了很多关于Redux的知识，使用OAuth2授权和来自外部API的错误处理请求也是一次很好的体验。</p><p id="32e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我也很开心地和朋友们分享了这个，听到他们的反馈和建议真是太棒了。</p><p id="bbb0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我对下一个项目感到兴奋！</p><p id="3eef" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ki">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="ki">plain English . io</em></a></p></div></div>    
</body>
</html>