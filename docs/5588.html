<html>
<head>
<title>Stop Using Fetch API Directly — SWR Is Way Better</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止直接使用Fetch API——SWR要好得多</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/stop-using-fetch-api-directly-swr-is-way-better-588976ef6782?source=collection_archive---------0-----------------------#2021-11-22">https://javascript.plainenglish.io/stop-using-fetch-api-directly-swr-is-way-better-588976ef6782?source=collection_archive---------0-----------------------#2021-11-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1e68" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是时候开始在你的React应用中使用SWR了</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/12b391896948a6aa5a65aaa5827a629e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZkeB5hLTR_KsSnTL"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ben White</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3e4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">常见的数据获取实践，如<strong class="ky ir">获取API </strong>或<strong class="ky ir"> Axios库</strong>在React中运行良好。它们可以用来非常容易地发送和获取数据。</p><p id="b668" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是缓存/数据分页/自动重新验证或请求重复数据删除呢？所有这些都需要我们来处理，因为Fetch和Axios都没有提供这样的功能。在本文中，让我们来看看<strong class="ky ir"> SWR </strong>，这是一个令人惊叹的React钩子库，它将React中的数据获取提升到了另一个层次。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="76d6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">SWR是什么？</h1><p id="5976" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><strong class="ky ir"> SWR </strong>代表<code class="fe mw mx my mz b"><strong class="ky ir">stale-while-revalidate</strong></code>，由<a class="ae kv" href="https://tools.ietf.org/html/rfc5861" rel="noopener ugc nofollow" target="_blank"> HTTP RFC 5861 </a>推广的一种HTTP缓存失效策略。基本上，它通过3个主要步骤执行数据提取:</p><ol class=""><li id="12ae" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr nf ng nh ni bi translated">首先返回缓存的数据(<em class="nj">陈旧</em>)</li><li id="dc3b" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr nf ng nh ni bi translated">发送获取请求(<em class="nj">重新验证</em>)</li><li id="d49f" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr nf ng nh ni bi translated">返回最新的数据</li></ol><p id="8bb3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SWR是一个由Vercel开发的快速轻量级软件包。SWR是构建在获取API之上的一层，它在数据获取之上提供了额外的特性。一些特性包括缓存、自动重新验证、分页等。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="c2b7" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">为什么你需要用SWR？</h1><h2 id="052a" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">1.内置缓存和实时体验</h2><p id="db02" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">使用SWR，用户首先看到缓存的(<em class="nj">陈旧的</em>)数据，请求被<strong class="ky ir">自动</strong>缓存。React组件将不断地自动更新最新的数据，从而确保UI总是快速和反应性的。</p><h2 id="fc2a" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">2.自动重新验证</h2><p id="220e" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">SWR确保用户能够看到最新的数据。即使打开了多个选项卡，当选项卡被重新聚焦时，数据也将始终保持同步。这同样适用于窗口。你可以在下面的链接中查看它是如何工作的:</p><p id="e67d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nj">演示:</em><a class="ae kv" href="https://swr.vercel.app/docs/revalidation" rel="noopener ugc nofollow" target="_blank"><em class="nj">swr.vercel.app/docs/revalidation</em></a></p><p id="1d15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">SWR还可以按特定的时间间隔重新验证数据，以确保多个会话拥有相同的同步数据。</p><p id="934a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个很酷的特性是，如果用户离线，一旦他重新连接，SWR将自动重新验证数据，并将更新的数据传递给组件。</p><h2 id="e534" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">3.页码</h2><p id="eb68" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">SWR的另一个有用的特性是它支持分页和无限加载数据。SWR提供了一个名为<code class="fe mw mx my mz b"><strong class="ky ir">useSWRInfinite</strong></code>的简单钩子来处理分页，而不是让用户编写自己的逻辑来对用Fetch或Axios接收的数据进行分页。</p><h2 id="5de1" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">SWR的其他好处</h2><p id="11f7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">您应该在React应用程序中使用SWR的其他原因包括:</p><ul class=""><li id="8274" class="na nb iq ky b kz la lc ld lf nc lj nd ln ne lr ob ng nh ni bi translated">相关提取</li><li id="c63a" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">智能错误重试</li><li id="d0b8" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">分页和滚动位置恢复</li><li id="512d" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">反应悬念</li><li id="6739" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">局部变异(乐观用户界面)</li><li id="76a3" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">快速页面导航</li><li id="2a72" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">间隔轮询</li><li id="09d8" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">SSR / ISR / SSG支持</li><li id="cb28" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">焦点的重新验证</li><li id="d690" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">网络恢复的再验证</li><li id="aea9" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">打字稿和反应原生就绪</li><li id="b2bf" class="na nb iq ky b kz nk lc nl lf nm lj nn ln no lr ob ng nh ni bi translated">支持从REST和GraphQL APIs获取数据</li></ul></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4282" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">例子</h1><p id="9fa5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">让我们来看看如何在React应用程序中使用SWR。</p><h2 id="f7d1" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">步骤1:安装软件包</h2><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="bab1" class="np ma iq mz b gy og oh l oi oj">npm install swr</span></pre><h2 id="becb" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">步骤2:导入使用SWR</h2><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="c7eb" class="np ma iq mz b gy og oh l oi oj">import useSWR from 'swr'</span></pre><p id="30de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe mw mx my mz b">useSWR</code>钩子返回两个值:<code class="fe mw mx my mz b">data</code>和<code class="fe mw mx my mz b">error</code>。它接受一个<code class="fe mw mx my mz b">key</code>(通常是请求的URL或graphQL查询)作为第一个参数，接受一个<code class="fe mw mx my mz b">fetcher</code>函数作为第二个参数。</p><p id="7a50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个如何使用它的例子:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="2fe1" class="np ma iq mz b gy og oh l oi oj">const { data, error } = useSWR('/api/123', fetcher)</span></pre><h2 id="3ace" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">步骤3:编写一个fetcher函数</h2><p id="b02a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated"><code class="fe mw mx my mz b">fetcher</code>函数可以是异步函数，您可以使用任何数据读取库来编写该函数。这里，我们将使用基本的Fetch API编写我们的<code class="fe mw mx my mz b">fetcher</code>函数。在React组件中，我们可以像这样创建函数:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="e5fb" class="np ma iq mz b gy og oh l oi oj">import useSWR from 'swr'</span><span id="b4cb" class="np ma iq mz b gy ok oh l oi oj">function App () {<br/>  // Fetcher function<br/>  const fetcher = (...args) =&gt; fetch(...args).then(res =&gt; res.json())<br/>  //...<br/>}</span></pre><h2 id="aea5" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">步骤4:获取数据</h2><p id="d612" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在这个例子中，我们将使用<a class="ae kv" href="https://jsonplaceholder.typicode.com/" rel="noopener ugc nofollow" target="_blank"> JSONPlaceholder API </a>来获取一些模拟数据。</p><p id="b016" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当获取<code class="fe mw mx my mz b">data</code>(<code class="fe mw mx my mz b">undefined</code>)时，我们可以显示加载消息，如果返回<code class="fe mw mx my mz b">error</code>，我们可以显示错误消息。</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="2508" class="np ma iq mz b gy og oh l oi oj">import useSWR from 'swr'</span><span id="48d2" class="np ma iq mz b gy ok oh l oi oj">function App () {  <br/>   // Fetcher function<br/>   const fetcher = (...args) =&gt; fetch(...args).then(res =&gt; res.json())</span><span id="2932" class="np ma iq mz b gy ok oh l oi oj">// SWR implementation<br/>  const { data, error } = useSWR('<!-- -->https://jsonplaceholder.typicode.com/posts/1<!-- -->', fetcher)</span><span id="660a" class="np ma iq mz b gy ok oh l oi oj">  if (error) return &lt;div&gt;Failed to load&lt;/div&gt;<br/>  if (!data) return &lt;div&gt;Loading&lt;/div&gt;</span><span id="f34c" class="np ma iq mz b gy ok oh l oi oj">  // render data here<br/>}</span></pre><h2 id="0426" class="np ma iq bd mb nq nr dn mf ns nt dp mj lf nu nv ml lj nw nx mn ln ny nz mp oa bi translated">第五步:显示数据</h2><p id="8c7b" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">模拟数据采用以下格式:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="dc1f" class="np ma iq mz b gy og oh l oi oj">{<br/>   "userId": 1,<br/>   "id": 1,<br/>   "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",<br/>   "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"<br/>}</span></pre><p id="9261" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦获取了数据，我们就可以呈现它。我们最后的组件看起来会像这样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="d44b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以运行<code class="fe mw mx my mz b">npm start</code>来测试我们的应用程序，它应该在加载屏幕后显示这样的数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/9b4ad82fdcb478cdc4b7009748db9f05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*fHVSZ1B0uPZbFzVI9KfktQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output screen</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8fe8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="6367" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我们可以通过缓存、分页和自动重取来充分利用SWR的潜力，因为它们可以极大地改善用户体验。它也非常轻量级，可以很容易地被采用。</p><p id="4bad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望我已经向您简要介绍了SWR，以及如何在React应用程序中实现它。所以，让我们努力充分利用SWR，打造一个令人敬畏的UX。</p><p id="09be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">编码快乐！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="331e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">参考</h1><div class="oo op gp gr oq or"><a href="https://swr.vercel.app/docs/getting-started" rel="noopener  ugc nofollow" target="_blank"><div class="os ab fo"><div class="ot ab ou cl cj ov"><h2 class="bd ir gy z fp ow fr fs ox fu fw ip bi translated">入门- SWR</h2><div class="oy l"><h3 class="bd b gy z fp ow fr fs ox fu fw dk translated">在React项目目录中，运行以下命令:或者使用npm:对于使用JSON数据的普通RESTful APIs，首先您…</h3></div><div class="oz l"><p class="bd b dl z fp ow fr fs ox fu fw dk translated">应用程序</p></div></div><div class="pa l"><div class="pb l pc pd pe pa pf kp or"/></div></div></a></div><p id="f3f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nj">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nj">plain English . io</em></a><em class="nj">。报名参加我们的</em> <a class="ae kv" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nj">免费周报在这里</em> </a> <em class="nj">。</em></p></div></div>    
</body>
</html>