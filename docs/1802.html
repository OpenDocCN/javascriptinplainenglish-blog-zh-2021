<html>
<head>
<title>Connect to Serverless Redis via GraphQL from wherever you send HTTP Requests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从发送HTTP请求的任何地方通过GraphQL连接到无服务器Redis</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/connect-to-redis-from-wherever-you-send-http-requests-569eaf190d66?source=collection_archive---------6-----------------------#2021-04-16">https://javascript.plainenglish.io/connect-to-redis-from-wherever-you-send-http-requests-569eaf190d66?source=collection_archive---------6-----------------------#2021-04-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="4fa7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将了解如何从您的客户端应用程序直接访问Redis数据库。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e719b3c308b8c3bf9c77d09c3227572b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z2rRUpddLLqz7E8V"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@firosnv?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Firos nv</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d41f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本文中，我们将实现一个事件预订应用程序，它将包括以下特性:</p><ol class=""><li id="26b7" class="kz la in jm b jn jo jr js jv lb jz lc kd ld kh le lf lg lh bi translated">在数据库中创建事件。</li><li id="1226" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">将事件推送到缓存。</li><li id="178e" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">缓存趋势事件，因此我们将运行CRON作业来定期更新缓存中的趋势事件。</li><li id="b656" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated">在客户端React应用程序上，我们将使用GraphQL直接从Redis服务器获取趋势事件，即不需要连接实际的服务器。</li></ol><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="6146" class="ls lt in lo b gy lu lv l lw lx">REST API Routes<br/>1. POST =&gt; /api/events =&gt; Create events<br/>2. GET  =&gt; /api/events =&gt; Get all events</span></pre><h2 id="69c5" class="ls lt in bd ly lz ma dn mb mc md dp me jv mf mg mh jz mi mj mk kd ml mm mn mo bi translated">软件要求</h2><ol class=""><li id="98ea" class="kz la in jm b jn mp jr mq jv mr jz ms kd mt kh le lf lg lh bi translated"><a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Nod </a> e.js — Node.js是基于<a class="ae ky" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> Chrome的V8 JavaScript引擎</a>构建的JavaScript运行时。</li><li id="72a6" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated"><a class="ae ky" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">Express</a>——用于<a class="ae ky" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>的快速、非个性化、极简的web框架</li><li id="2562" class="kz la in jm b jn li jr lj jv lk jz ll kd lm kh le lf lg lh bi translated"><a class="ae ky" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank">Postman</a>—API开发的协作平台。</li></ol><p id="410a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们开始吧。</p><p id="5b97" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在本地计算机上安装所需的软件包:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="2a85" class="ls lt in lo b gy lu lv l lw lx">npm install express mongoose dotenv redis — save</span></pre><p id="5562" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">用Upstash建立Redis数据库</strong></p><p id="7076" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">是Redis的一个无服务器数据库。对于服务器/实例，您通常按小时或固定价格付费。使用无服务器，你按请求付费。</p><p id="eca8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这意味着当数据库没有被使用时，你是免费的。Upstash为您配置和管理数据库。</p><p id="d929" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先在<a class="ae ky" href="https://upstash.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io">上创建一个账户，抢在</strong> </a> <strong class="jm io">之前。</strong></p><p id="941b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在设置Redis数据库实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/5f842cdfc052b4a4ea9c18758752d708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-Ve88Ysi1yRp1FQsv1qZA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Create New Database</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/77145ea238d6029cea75384a13ce7d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qXi6NIKaAutMgF0p2nkXqw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Connect to your database</figcaption></figure><p id="5ba0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不要忘记在根目录中添加<code class="fe mw mx my lo b">.env</code>文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/846f693e575f9eb510161386ccb8bc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/0*vK6kLJ4K8jbFFMpZ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Root Directory Structure</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi na"><img src="../Images/f4df305f69512264b5264fc6fe2db7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*rIOSf-Myalw6REZiTLMmeQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">.env file</figcaption></figure><p id="9cf1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建一个简单的服务器并连接到本地或远程MongoDB数据库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="8745" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，使用Upstash提供的配置连接到Redis服务器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="48f6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">猫鼬模型:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="8075" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在实现定期缓存趋势事件的逻辑。基本上在这里，我们使用的是一个<code class="fe mw mx my lo b">setInterval()</code>模拟CRON作业。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="f12b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在实现API路由:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="e9f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了创建事件，我们需要来自用户的<code class="fe mw mx my lo b">title, description, imageURL, timeAndDate, fees, notes</code>。</p><p id="6b51" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，我们正在Redis缓存中推送这些事件。</p><h2 id="2caf" class="ls lt in bd ly lz ma dn mb mc md dp me jv mf mg mh jz mi mj mk kd ml mm mn mo bi translated">服务器应用程序的最终代码:</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="8318" class="ls lt in bd ly lz ma dn mb mc md dp me jv mf mg mh jz mi mj mk kd ml mm mn mo bi translated">现在，让我们使用React实现一个客户端应用程序</h2><p id="9aae" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nd jx jy jz ne kb kc kd nf kf kg kh ig bi translated">通过运行以下命令为React创建样板代码:</p><p id="1f59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mw mx my lo b">npx create-react-app client-app &amp;&amp; cd client-app</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/8331693ff6d5bced4ae0409a733277f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*Og2l2b5LEdurFjGnbYEHVA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Folder Structure for React.js app</figcaption></figure><p id="1092" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">安装Apollo客户端库:</p><p id="f63d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mw mx my lo b">npm i @apollo/client</code></p><p id="a221" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，连接到Redis数据库。在您的<strong class="jm io"> index.js </strong>文件<strong class="jm io">中，</strong>添加以下代码以设置GraphQL客户端并连接到Upstash的GraphQL服务器:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="bdfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">从Upstash获取凭据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/365d86b8dbe1248f027ea535eda8dbe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njwzMGB75Q-iEQMsA65Ugg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Upstash GraphQL Redis</figcaption></figure><blockquote class="ni nj nk"><p id="c46d" class="jk jl nl jm b jn jo jp jq jr js jt ju nm jw jx jy nn ka kb kc no ke kf kg kh ig bi translated"><strong class="jm io">注</strong>:使用客户端<code class="fe mw mx my lo b">READ ONLY</code>访问密钥。</p></blockquote><p id="46fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在为UI添加引导:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/1a2242f6fcc61500e586ed981c7fd472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KqD04rSOhU_M3ZCLezAhjA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Bootstrap</figcaption></figure><p id="bf4c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">实现用于直接从Upstash Redis获取趋势事件的代码:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c3ba" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后尝试使用<code class="fe mw mx my lo b">npm start</code>运行:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/00f5f52fb7a3957f2fd524cef15ee0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dtjNciolJuOHjXNLbdEoDA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Running React.js app</figcaption></figure><p id="c78f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您将看到直接从Redis数据库获取的趋势事件。</p></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="0f50" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="nl">结账</em> </strong> <a class="ae ky" href="https://upstash.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="nl">上州</em> </strong> </a> <strong class="jm io"> <em class="nl">进行生产。</em> </strong></p><p id="17eb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nl">更多内容参见</em> <a class="ae ky" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nl">通俗易懂</em> </a></p></div></div>    
</body>
</html>