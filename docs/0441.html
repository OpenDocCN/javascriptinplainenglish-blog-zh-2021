<html>
<head>
<title>A Beginner’s Guide to using JavaScript Fetch with 3rd Party APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过第三方API使用JavaScript Fetch的初学者指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-beginners-guide-to-using-javascript-fetch-with-3rd-party-apis-725c4b33a9c5?source=collection_archive---------10-----------------------#2021-01-26">https://javascript.plainenglish.io/a-beginners-guide-to-using-javascript-fetch-with-3rd-party-apis-725c4b33a9c5?source=collection_archive---------10-----------------------#2021-01-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="3c59" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们演示GET请求的实际使用，使用Fetch API构建一个基于特定品种生成狗的图片的应用程序。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/147dbd226806d5a69de1e19900211430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vv_0-thLCbCkuB8XhItLaQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://www.pexels.com/@jhelmuth?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Julissa Helmuth</a> from <a class="ae ky" href="https://www.pexels.com/photo/beach-sand-water-summer-3800470/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><h1 id="0274" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">为什么要使用第三方API？</h1><p id="efb7" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">回想一下您最近一次在访问网站时看到地图的情形。很有可能地图是使用第三方API外包的，比如谷歌地图或ESRI。</p><p id="f775" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">开发者选择第三方API而不是从头构建服务的原因有很多。最明显的是<em class="mc">其他人已经为我们做了繁重的工作。</em></p><h2 id="fb3f" class="md la in bd lb me mf dn lf mg mh dp lj jv mi mj ln jz mk ml lr kd mm mn lv mo bi translated">Fetch API简介</h2><p id="86fc" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated"><code class="fe mp mq mr ms b">fetch</code> API返回一个承诺，包含在JavaScript中。Fetch正逐渐取代Ajax <code class="fe mp mq mr ms b">XMLHttpRequest</code>方法成为<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Glossary/AJAX" rel="noopener ugc nofollow" target="_blank">现代标准</a>。</p><p id="14b2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当编写浏览器端JavaScript时，我们可以使用<code class="fe mp mq mr ms b">fetch</code> API来访问和操作来自HTTP管道的数据。在这种情况下，HTTP管道包括狗的图片。</p><p id="e4d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mc">请记住，大多数第三方API都需要某种请求头或认证，如果是这样的话，在发送请求之前还需要做一些工作。</em></p></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><h1 id="558e" class="kz la in bd lb lc na le lf lg nb li lj lk nc lm ln lo nd lq lr ls ne lu lv lw bi translated">对第三方API的基本提取</h1><p id="a38e" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">像所有第三方API一样，我们需要参考文档，因为每个API都有自己独特的命名约定和要求。今天，我们将使用<a class="ae ky" href="https://dog.ceo/dog-api/" rel="noopener ugc nofollow" target="_blank">狗API </a>进行演示。</p><p id="5c3c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们首先向Dog API请求检索10张随机的狗图片。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Basic Fetch request</figcaption></figure><p id="6646" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">不太可怕吧？如果我们在浏览器中打开它，我们应该会看到如下所示的响应</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/65bc7e73d3d2a2612642c7dd489abd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*eIpSjIhFGJ5Ym9kf8UYSDw.png"/></div></figure><p id="0bd3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此时，我们可以访问通过第三方API提供的数据。让我们以此为基础，将请求的内容添加到DOM中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="b9a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里我们通过嵌套在一个对象中的数组进行映射，该对象是我们从Fetch <em class="mc">请求</em>中接收到的<em class="mc">响应</em>。你都明白了吗？</p><p id="24b6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于这个数组中的每个条目或URL，我们做了4件事。</p><ol class=""><li id="414b" class="ni nj in jm b jn jo jr js jv nk jz nl kd nm kh nn no np nq bi translated">创建一个新的<code class="fe mp mq mr ms b">img</code>元素。</li><li id="5304" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">将URL添加到<code class="fe mp mq mr ms b">src</code>属性中。</li><li id="bbbe" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">从URL中提取品种的名称作为<code class="fe mp mq mr ms b">alt</code>属性。</li><li id="6822" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">最后，我们将新图像添加到DOM中。</li></ol><p id="4006" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦我们完成了数据映射，最终结果应该是一系列呈现到DOM的图像。去试试吧！</p><h1 id="9eed" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">使用Promise.all发出多个提取请求</h1><p id="ea70" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">如果我们需要同时向不同的端点发出几个请求呢？自然，我们可能会想出一个庞大的解决方案，比如链接Fetch语句或者将它们嵌套在<code class="fe mp mq mr ms b">.then</code>语句中。😳</p><p id="c2f0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我认为这不是世界上最糟糕的事情，但是后者可能是未来维护者的噩梦。幸运的是，有更好的方法。</p><p id="9495" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">继续我们的狗应用程序，让我们实现一个搜索功能，一次浏览和选择多个品种。</p><p id="49ec" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参考文档，似乎<a class="ae ky" href="https://dog.ceo/api/breeds/list/all" rel="noopener ugc nofollow" target="_blank">/api/breedies/list/all</a>将是我们需要到达的端点，以列出API上所有可用的狗品种。</p><p id="c9e4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们重构当前的Fetch，使用一个<code class="fe mp mq mr ms b">Promise.all</code>事件一次到达2个或更多端点。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example using Promise.all()</figcaption></figure><p id="951f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">事情开始变得有点复杂，但仍然是明智的。在继续前进之前，我们可以<code class="fe mp mq mr ms b">console.log</code>我们的反应来验证它是我们所期望的。</p><p id="acb9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切都不顺利，我们应该在控制台上看到类似这样的东西。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8b0d156427b1233fd6591328618e966c.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*As2Y0V82X4PcpSCEcdV0AQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Promise.all response example</figcaption></figure><p id="ba60" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">太棒了，接下来我们可以将它连接到DOM，这样当页面加载时，我们可以同时列出随机的狗图片,<em class="mc">和</em>获取品种名称列表，以动态填充我们的搜索表单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Updating DOM to list Checkboxes in the form</figcaption></figure></div><div class="ab cl mt mu hr mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ig ih ii ij ik"><h1 id="41c2" class="kz la in bd lb lc na le lf lg nb li lj lk nc lm ln lo nd lq lr ls ne lu lv lw bi translated">动态发出多个提取请求</h1><p id="a819" class="pw-post-body-paragraph jk jl in jm b jn lx jp jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh ig bi translated">假设我们需要发出的请求数量取决于用户输入。当使用第三方API时，我们经常会发现自己受限于已经为我们设计好的东西。</p><p id="6fdb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">使用Dog API，如果我们的用户想要同时查看多个狗品种的图片，我们将需要发出多个请求，每个特定品种一个请求。</p><p id="28fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果不知道要提前获取的确切路径，我们将不得不动态地构建这些路径。我们已经有我们的品种渲染到我们的形式作为复选框。让我们进行下一步，将这个表单连接到我们的脚本来收集这些数据。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Global event listener for our form</figcaption></figure><p id="f323" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">到目前为止，我们已经收集了用户在<code class="fe mp mq mr ms b">queue</code>中指定的所有品种名称，但是我们仍然没有进行有效请求所需的URL。让我们使用现有的数据来构建一个新的URL数组。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="304b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这一点上，我们已经取得了我们的<code class="fe mp mq mr ms b">queue</code>,并将每一项重新格式化为一个有效的URL，我们可以将它发送给API。现在我们已经准备好动态获取数据了！</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Dynamic Fetch requests using Promise.all</figcaption></figure><p id="a909" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">还在跟踪吗？现在剩下的就是把结果呈现给用户了！这将是一个4步的过程。</p><ol class=""><li id="80e3" class="ni nj in jm b jn jo jr js jv nk jz nl kd nm kh nn no np nq bi translated">清除DOM上的当前图像</li><li id="3197" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">基于我们的响应对象动态构建一个新的数组。</li><li id="c0e0" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">在不允许重复的情况下，我们必须在展示范围滑块中指定的图像总量时，随机选择品种。</li><li id="d7a9" class="ni nj in jm b jn nr jr ns jv nt jz nu kd nv kh nn no np nq bi translated">将结果打印到DOM</li></ol><p id="4a04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">上述标准的实现可能如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="098b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是全部了！你可以在这里找到这个演示的完整源代码<a class="ae ky" href="https://gist.github.com/hi-matbub/b8eb80c964a1cb70494c1e38189e1a41" rel="noopener ugc nofollow" target="_blank">，在这里</a>预览风格化的<a class="ae ky" href="https://hi-matbub.github.io/fetch-api-challenge/" rel="noopener ugc nofollow" target="_blank"> live app。编码快乐！👋</a></p></div></div>    
</body>
</html>