<html>
<head>
<title>Create a Copy Button with the JavaScript Clipboard API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript剪贴板API创建一个复制按钮</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-creating-a-copy-button-with-the-clipboard-api-41bab347e601?source=collection_archive---------3-----------------------#2021-04-17">https://javascript.plainenglish.io/javascript-creating-a-copy-button-with-the-clipboard-api-41bab347e601?source=collection_archive---------3-----------------------#2021-04-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c0daad47e3019332c326f0942f181121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mnuNKaVrFcHYKd2W"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">A West Oakland California Poppy</figcaption></figure><p id="f468" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我喜欢这个在互联网上流行的新功能——不再需要点击和拖动来从网上复制内容。点击一个按钮，数据就神奇地出现在你的剪贴板上，你可以随心所欲地粘贴它。最棒的是，大多数现代浏览器都支持这一功能。那么如何实现呢？</p><p id="b77e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">很简单:</p><ul class=""><li id="116d" class="kx ky in kb b kc kd kg kh kk kz ko la ks lb kw lc ld le lf bi translated">创建按钮</li><li id="1391" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">设置一个<code class="fe ll lm ln lo b">onclick</code>监听器</li><li id="a6d6" class="kx ky in kb b kc lg kg lh kk li ko lj ks lk kw lc ld le lf bi translated">在事件监听器中使用剪贴板API</li></ul><h1 id="a995" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">履行</h1><p id="c560" class="pw-post-body-paragraph jz ka in kb b kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ig bi translated">HTML:</p><pre class="ms mt mu mv gt mw lo mx my aw mz bi"><span id="53ad" class="na lq in lo b gy nb nc l nd ne">&lt;button id='copy'&gt;copy&lt;/button&gt;<br/>&lt;textarea id='data'&gt;un bel di vedremo&lt;/textarea&gt;</span></pre><p id="791e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">JavaScript:</p><pre class="ms mt mu mv gt mw lo mx my aw mz bi"><span id="f80d" class="na lq in lo b gy nb nc l nd ne">const btn_copy = document.getElementById('copy')<br/>const txt_data = document.getElementById('data')</span><span id="25cb" class="na lq in lo b gy nf nc l nd ne">copy.onclick = () =&gt; {<br/>  const value = txt_data.value<br/>  navigator.clipboard.writeText(value)<br/>}</span></pre><p id="b563" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><code class="fe ll lm ln lo b">writeText</code>返回一个承诺，该承诺在数据成功复制到剪贴板时解决，或者在写入失败时拒绝。对于这个例子，我们忽略这个承诺，但是如果您将大量数据复制到剪贴板，您应该让脚本等待这个写操作解决:</p><pre class="ms mt mu mv gt mw lo mx my aw mz bi"><span id="e13d" class="na lq in lo b gy nb nc l nd ne">copy.onclick= async () =&gt; {<br/>  const value = p_data.value<br/>  await navigator.clipboard.writeText(value)<br/>}</span></pre><p id="dcbf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="ng">你可以在这里</em>  <em class="ng">查看一个活生生的例子</em> <a class="ae nh" href="https://jsbin.com/zefojixuya/edit?html,js,output" rel="noopener ugc nofollow" target="_blank"> <em class="ng">。</em></a></p><h1 id="bd76" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">但是它是如何工作的呢？</h1><p id="fe3f" class="pw-post-body-paragraph jz ka in kb b kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ig bi translated">Clipboard API允许JavsScript访问用户的剪贴板。剪贴板是您复制、剪切和粘贴所有数据的地方。您的系统允许您的浏览器访问这些数据，反过来，在某些条件下，浏览器允许您访问网站:</p><p id="d277" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对剪贴板的读写访问必须由用户通过用户驱动的事件来触发，例如点击按钮、快捷键等。没有用户的互动，网站不能拷贝或粘贴。</p><p id="59f8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">写入权限会自动授予用户当前所在的网站。不专注的网站，其他的标签页，不能随便把东西复制到你的剪贴板上。</p><p id="8415" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">网站需要通过权限API请求读取权限。网站不会在没有问你的情况下阅读你复制的内容。</p><h1 id="b500" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">那么<code class="fe ll lm ln lo b">document.execCommand</code>呢？</h1><p id="1a6f" class="pw-post-body-paragraph jz ka in kb b kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ig bi translated">还可以使用<code class="fe ll lm ln lo b">document.execCommand</code>读写剪贴板。然而，它被FireFox不推荐使用，而且不像Clipboard API，它似乎没有官方的web标准来支持这个特定的目的。为了获得最好的浏览器支持和向前兼容性，我会使用剪贴板API。更不用说，剪贴板API使用起来更容易、更安全、更干净。最好的是剪贴板API返回一个比布尔型<code class="fe ll lm ln lo b">execCommand</code>返回更容易处理和链接的承诺。</p><h1 id="0b10" class="lp lq in bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">逮到你了</h1><p id="7a97" class="pw-post-body-paragraph jz ka in kb b kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks mr ku kv kw ig bi translated">当使用<code class="fe ll lm ln lo b">writeText</code>时，数据被自动编码为UTF-8，这对于大多数用例来说应该没问题，但是您可以使用<code class="fe ll lm ln lo b">write([data])</code>手动设置编码。其中<code class="fe ll lm ln lo b">data</code>是一个<code class="fe ll lm ln lo b">ClipboardItem</code>实例。此项可以有任何文本或数据编码。例如，如果您只想复制中文文本进行翻译:<code class="fe ll lm ln lo b">new ClipboardItem({'text/plain;charset=big5': text})</code>。</p><p id="85b6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">没有用户事件，您无法访问剪贴板API。例如，如果您的网站运行生成长格式翻译的作业，您不能在该作业结束时将数据写入用户的剪贴板。用户必须触发一个事件，比如一次点击，这将授予你对剪贴板的写访问权。</p><p id="0ba4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">来源:</strong></p><div class="ni nj gp gr nk nl"><a href="https://jsbin.com/zefojixuya/edit?html,js,output" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">JS Bin</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">适用于HTML、CSS和JavaScript以及一系列处理器的实时pastebin，包括SCSS、CoffeeScript、Jade等等...</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">jsbin.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz jt nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://www.w3.org/TR/clipboard-apis/#async-clipboard-api" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">剪贴板API和事件</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">本节是非规范性的。该规范定义了系统剪贴板如何向web应用程序公开…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">www.w3.org</p></div></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/writeText" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">Clipboard.writeText()</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">接口的属性将指定的文本字符串写入系统剪贴板。可以使用以下任一方式回读文本…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">developer.mozilla.org</p></div></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard/write" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">Clipboard.write()</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">方法将图像等任意数据写入剪贴板。这可以用来实现剪切和复制…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">developer.mozilla.org</p></div></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">剪贴板API</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">剪贴板API提供了响应剪贴板命令(剪切、复制和粘贴)以及…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">developer.mozilla.org</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz jt nl"/></div></div></a></div><div class="ni nj gp gr nk nl"><a href="https://webcheatsheet.com/html/character_sets_list.php" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd io gy z fp nq fr fs nr fu fw im bi translated">字符集列表</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">字符集列表</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">字符集Listwebcheatsheet.com</p></div></div><div class="nu l"><div class="ob l nw nx ny nu nz jt nl"/></div></div></a></div><p id="ddcc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="ng">更多内容请看</em><a class="ae nh" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="ng">plain English . io</em></strong></a></p></div></div>    
</body>
</html>