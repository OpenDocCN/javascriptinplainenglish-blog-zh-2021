<html>
<head>
<title>How to create an offline search page with Gatsby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Gatsby创建离线搜索页面</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-an-offline-search-page-with-gatsby-eb351d68cb6b?source=collection_archive---------6-----------------------#2021-10-23">https://javascript.plainenglish.io/how-to-create-an-offline-search-page-with-gatsby-eb351d68cb6b?source=collection_archive---------6-----------------------#2021-10-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="715f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在制作JAMStack网站时，需要做出一些妥协，但搜索不是其中之一，这要感谢像<a class="ae ki" href="https://github.com/nextapps-de/flexsearch" rel="noopener ugc nofollow" target="_blank"> flexsearch </a>和<a class="ae ki" href="https://github.com/olivernn/lunr.js/" rel="noopener ugc nofollow" target="_blank"> lunr.js </a>这样的javascript库。</p><p id="9943" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在遵循本教程<a class="ae ki" href="https://labs.walltowall.com/easy-client-side-search-for-gatsby-sites/" rel="noopener ugc nofollow" target="_blank">并将代码与</a><a class="ae ki" href="https://material-ui.com/components/autocomplete/" rel="noopener ugc nofollow" target="_blank"> Material UI自动完成组件</a>结合之后，我能够创建你在这篇博客中看到的搜索栏。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi kj"><img src="../Images/26bd1f8970bee5a4d1ca102c608ae600.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/0*2WBPAWgXo6LKDK43.gif"/></div></figure><p id="af15" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这已经很好了，但我还想有一个搜索页面，在那里可以通过帖子的标签，标题和内容匹配的查询。</p><h1 id="db17" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">创建新的搜索索引</h1><p id="cee4" class="pw-post-body-paragraph jk jl in jm b jn lp jp jq jr lq jt ju jv lr jx jy jz ls kb kc kd lt kf kg kh ig bi translated">首先，我将把下面的代码添加到我的Gatsby配置中，这将创建一个新的<code class="fe lu lv lw lx b">localSearchPage</code>索引，通过GraphQL进行查询。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ly lz l"/></div></figure><h1 id="5c27" class="kr ks in bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">搜索页面</h1><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi ma"><img src="../Images/cc61627764bb5f288149bf8ea43519e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_1UFhSOEu2MrZiel.png"/></div></div></figure><p id="3d35" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如教程所示，<code class="fe lu lv lw lx b">useFlexSearch</code>钩子可以用来获取搜索结果，但是没有指明查询在博客文章字段中的匹配位置。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="df45" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">函数<code class="fe lu lv lw lx b">getExcerpt</code>需要以某种方式返回博文的摘录，其中突出显示了查询。</p><p id="1869" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以我需要找到查询在博文中的确切位置，并用类似于<code class="fe lu lv lw lx b">&lt;span&gt;query&lt;/span&gt;</code>的HTML <code class="fe lu lv lw lx b">span</code>元素替换它，为此，我将使用正则表达式。</p><p id="b586" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此外，我将需要一个功能来修剪文本，并添加一个省略号，如果需要的话，这个从StackOverflow 的<a class="ae ki" href="https://stackoverflow.com/a/41267747/4307769" rel="noopener ugc nofollow" target="_blank">将做得很好。</a></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ly lz l"/></div></figure><p id="f922" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当查询是<code class="fe lu lv lw lx b">adipiscing</code>时，这段代码将把类似于<code class="fe lu lv lw lx b">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed condimentum risus nec scelerisque auctor</code>的字符串转换成<code class="fe lu lv lw lx b">Lorem ipsum dolor sit amet, consectetur &lt;span&gt;adipiscing&lt;/span&gt; elit. Sed condimentum risus nec scelerisque auctor</code>，由于这个字符串是HTML格式的，为了显示它，我将在一个<code class="fe lu lv lw lx b">em</code>元素中使用<code class="fe lu lv lw lx b">dangerouslySetInnerHTML</code>属性。</p><p id="1db0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe lu lv lw lx b">truncateStringToWord</code>的反向使用有点不方便，但是大部分代码可以转移到Gatsby构建过程中，所以博客性能不会受到影响。</p><p id="441c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望这篇博文对你有所帮助，你可以通过在我的博客中搜索<a class="ae ki" href="https://pablo.gg/en/search?q=javascript" rel="noopener ugc nofollow" target="_blank">来查看这个页面。下一集再见！</a></p></div><div class="ab cl mf mg hr mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ig ih ii ij ik"><p id="be75" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mm">原载于</em><a class="ae ki" href="https://pablo.gg/en/blog/coding/how-to-create-an-offline-search-page-with-gatsby/" rel="noopener ugc nofollow" target="_blank"><em class="mm">https://pablo . gg</em></a><em class="mm">。</em></p><p id="fc3a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mm">更多内容请看</em><a class="ae ki" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mm">plain English . io</em></strong></a></p></div></div>    
</body>
</html>