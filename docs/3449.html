<html>
<head>
<title>How to Integrate Ionic and React with Auth0 Login to Build a PWA for Web and Mobile</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何集成Ionic和React与Auth0 Login来构建Web和移动的PWA</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/ionic-react-pwa-with-auth0-login-for-web-and-mobile-no-plugin-required-d627f52d8e97?source=collection_archive---------14-----------------------#2021-07-12">https://javascript.plainenglish.io/ionic-react-pwa-with-auth0-login-for-web-and-mobile-no-plugin-required-d627f52d8e97?source=collection_archive---------14-----------------------#2021-07-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/4dc882a0896d1280a9f0723103a252a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sILSjwUqrM3dJMAdgIBQ8A.png"/></div></div></figure><div class=""/><p id="82d9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文构建了一个Ionic <a class="ae kt" href="https://web.dev/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> PWA </a>应用程序，它使用Auth0进行身份验证。</p><p id="8d66" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将一步一步地介绍如何做到这一点。</p><p id="3a5c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里是<a class="ae kt" href="https://ionic-auth0-react-pwa-deploy.vercel.app/#/home" rel="noopener ugc nofollow" target="_blank">最终演示</a>。</p><p id="9246" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Git回购:<a class="ae kt" href="https://github.com/pazel-io/ionic-auth0-react-pwa" rel="noopener ugc nofollow" target="_blank">github.com/pazel-io/ionic-auth0-react-pwa</a></p><p id="8dbb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文最初发表于<a class="ae kt" href="https://pazel.dev/ionic-react-pwa-with-auth0-login-for-web-and-mobile-no-plugin-required" rel="noopener ugc nofollow" target="_blank"> pazel.dev </a></p><h1 id="080c" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">正在配置Auth0</h1><p id="fb44" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">首先，让我们为您设置Auth0。请前往auth0.com<a class="ae kt" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank">注册一个免费账户。注册后，您可以登录您的帐户。您将登陆Auth0仪表板。从左侧菜单中，选择应用程序页面，然后单击“创建应用程序”按钮。</a></p><p id="4fcb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">单击显示新的单页web应用程序的选项，选择一个名称，然后单击创建(pwa是行为类似于本机应用程序的Web应用程序)。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi lx"><img src="../Images/2ab1afffba50b1acf89a73875a8975fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M8JYyN7mkF0zILc4"/></div></div></figure><p id="48a7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择您的前端使用的技术，或者使用纯JavaScript版本。我会在这里作出反应。这个选择有助于Auth0提供相关的例子和代码片段。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mc"><img src="../Images/dab34b761150ec398c730d8077e48411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VImKuzRBYoTE4AaC"/></div></div></figure><p id="b1c0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">选择前端技术后，您会看到一个快速入门指南，引导您将Auth0集成到web应用程序中。在此之前，让我们使用Ionic CLI创建我们的Ionic应用程序。这个应用程序的代码差不多就是我将在Ionic PWA集成中使用的代码。</p><p id="d7d8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您之前没有安装Ionic CLI，请前往<a class="ae kt" href="https://ionicframework.com/docs/intro/cli" rel="noopener ugc nofollow" target="_blank">ionicframework.com/docs/intro/cli</a>并按照说明安装CLI。</p><p id="359d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，让我们通过运行<code class="fe md me mf mg b">ionic start ionic-auth0-pwa</code>使用CLI创建一个应用程序。CLI应提示您选择前端技术和更多选项。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mh"><img src="../Images/151f1da1f83b726fe3781cf19c8399dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0oaFxSWqTWfiRxg0"/></div></div></figure><p id="1840" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将使用React和空白启动项目。选择选项后，CLI将下载所有必需的npm软件包。(这可能需要几分钟)</p><p id="ffe5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Ionic CLI询问您在npm软件包安装后是否需要一个免费的Ionic帐户。这不是本教程所必需的。您最终会看到一些日志，表明设置已经完成。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mi"><img src="../Images/8177d98c1e3bc1a056f7178b2d4e4828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y_NqVKSli9apN7x-"/></div></div></figure><p id="d7c3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们<code class="fe md me mf mg b">cd</code>到我们刚刚创建的新项目，并运行<code class="fe md me mf mg b">ionic serve</code>。这将运行本地web服务器，并在您的默认浏览器中打开应用程序。(默认端口为8100)</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/541a2f12354493a62d678c9594a3b51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b3U8GdauSm8QDZyi"/></div></div></figure><p id="fa5e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以基于示例添加Auth服务。我将按照Auth0 React示例中的说明添加Auth0登录。</p><p id="9573" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">第一步将Auth0 React包添加到我的Ionic app中。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="7eaf" class="mo kv iy mg b gy mp mq l mr ms">npm install @auth0/auth0-react</span></pre><p id="04df" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来打开<code class="fe md me mf mg b">index.tsx</code>并将<code class="fe md me mf mg b">&lt;App&gt;</code>组件像这样包裹在<code class="fe md me mf mg b">Auth0Provider</code>中。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="2040" class="mo kv iy mg b gy mp mq l mr ms">import React from 'react';<br/>import ReactDOM from 'react-dom';<br/>import App from './App';<br/>import { Auth0Provider } from '@auth0/auth0-react';</span><span id="362e" class="mo kv iy mg b gy mt mq l mr ms">ReactDOM.render(<br/>    &lt;React.StrictMode&gt;<br/>        &lt;Auth0Provider<br/>            domain="REPLACE_WITH_YOUR_DOMAIN"<br/>            clientId="REPLACE_WITH_YOUR_CLIENT_ID"<br/>            redirectUri={window.location.origin}<br/>        &gt;<br/>            &lt;App/&gt;<br/>        &lt;/Auth0Provider&gt;<br/>    &lt;/React.StrictMode&gt;,<br/>    document.getElementById('root')<br/>);</span></pre><p id="0b2a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">ClientId和Domain的值是根据您的应用程序填充的。您也可以在应用程序的设置部分找到它们。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mu"><img src="../Images/295a1c36e737e514e3fdf862b1f6710c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LG5F_mxwLP_NPbfI"/></div></div></figure><p id="9f26" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们为登录和注销创建两个组件。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="996b" class="mo kv iy mg b gy mp mq l mr ms">import React from "react";<br/>import { useAuth0 } from "@auth0/auth0-react";<br/>import { IonButton, IonIcon } from "@ionic/react";<br/>import { logIn } from "ionicons/icons";</span><span id="e1bf" class="mo kv iy mg b gy mt mq l mr ms">const LoginButton = () =&gt; {<br/>    const { loginWithRedirect, loginWithPopup } = useAuth0();</span><span id="6be0" class="mo kv iy mg b gy mt mq l mr ms">    return &lt;IonButton onClick={() =&gt; loginWithPopup()}&gt;<br/>        &lt;IonIcon slot="start" icon={logIn} /&gt;<br/>        Log In<br/>    &lt;/IonButton&gt;;<br/>};</span><span id="646f" class="mo kv iy mg b gy mt mq l mr ms">export default LoginButton;</span></pre><p id="d747" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Auth0示例中的登录组件使用重定向方法，将您的应用程序留给Auth0网站，进行登录并使用Auth token返回到您的应用程序。loginWithPopup还有另一个方法，我将在本例中使用它。loginWithPopup不会离开你的应用程序，并使认证流程更简单。</p><p id="c419" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是我们的LogoutButton组件。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="5686" class="mo kv iy mg b gy mp mq l mr ms">import React from "react";<br/>import { useAuth0 } from "@auth0/auth0-react";<br/>import { IonButton, IonIcon } from "@ionic/react";<br/>import { logOut } from "ionicons/icons";</span><span id="d526" class="mo kv iy mg b gy mt mq l mr ms">const LogoutButton = () =&gt; {<br/>    const { logout } = useAuth0();</span><span id="5361" class="mo kv iy mg b gy mt mq l mr ms">    return (<br/>        &lt;IonButton onClick={() =&gt; logout({ returnTo: window.location.origin })}&gt;<br/>            &lt;IonIcon slot="start" icon={logOut} /&gt;<br/>            Log Out<br/>        &lt;/IonButton&gt;<br/>    );<br/>};</span><span id="2b33" class="mo kv iy mg b gy mt mq l mr ms">export default LogoutButton;</span></pre><p id="3290" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们利用新创建的组件。我将用下面的代码替换<code class="fe md me mf mg b">ExploreContainer.tsx</code>的内容，它是我们Ionic app的默认主页。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="c42b" class="mo kv iy mg b gy mp mq l mr ms">import './ExploreContainer.css';<br/>import LoginButton from "./LoginButton";<br/>import LogoutButton from "./LogoutButton";<br/>import { useAuth0 } from "@auth0/auth0-react";</span><span id="2747" class="mo kv iy mg b gy mt mq l mr ms">interface ContainerProps {<br/>}</span><span id="7158" class="mo kv iy mg b gy mt mq l mr ms">const ExploreContainer: React.FC&lt;ContainerProps&gt; = () =&gt; {<br/>    const {isAuthenticated} = useAuth0();<br/>    if (isAuthenticated) {<br/>        return (<br/>            &lt;div className="container"&gt;<br/>                &lt;LogoutButton/&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>    return (<br/>        &lt;div className="container"&gt;<br/>            &lt;LoginButton/&gt;<br/>        &lt;/div&gt;<br/>    );</span><span id="f522" class="mo kv iy mg b gy mt mq l mr ms">};</span><span id="4e6a" class="mo kv iy mg b gy mt mq l mr ms">export default ExploreContainer;</span></pre><p id="3dc0" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是为了检查<code class="fe md me mf mg b">isAuthenticated</code>标志并决定显示<code class="fe md me mf mg b">LoginButton</code>或<code class="fe md me mf mg b">LogoutButton</code>。结果应该是这样的。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/3eea8ed3cc1be9231e9f007057ccaba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XURlER8serlUDGl9"/></div></div></figure><h1 id="f241" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">测试登录</h1><p id="8a4d" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">单击登录按钮应该会打开一个弹出窗口并显示登录表单。如果您看到的不是登录表单，而是一条消息:“哎呀！出事了”。您可能错过了为您的Auth0应用程序设置回调URL的步骤。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mv"><img src="../Images/9efc00fc10583bdb97c1052e79cbeb1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fIJWPVNoxk1iP_PH"/></div></div></figure><p id="e48c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，请转到你的应用设置。向下滚动到“允许的回拨URL”部分，并在那里输入您的应用程序URL。我们需要为“允许的回调URL”、“允许的Web源”和“允许的注销URL”添加<code class="fe md me mf mg b">http://localhost:8100</code>。</p><p id="d4ab" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您现在单击登录，您应该会看到这个屏幕。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mw"><img src="../Images/c4c9536c36e79efabce7dfcaba24186c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z6wp6YbGPJOt6PCo"/></div></div></figure><p id="624a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以用用户名/密码注册并登录，或者使用谷歌账户登录。提供的登录选项基于您在Auth0中添加应用程序时的默认设置。很明显，你可以通过Auth0来改变这些，以添加其他社交登录，如脸书、苹果或启用多因素认证。</p><h1 id="b78f" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">添加用户配置文件以显示用户信息</h1><p id="b659" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">现在我们有了登录和注销，让我们添加一个UserProfile组件来显示一些用户详细信息。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="57cc" class="mo kv iy mg b gy mp mq l mr ms">import React from "react";<br/>import { useAuth0 } from "@auth0/auth0-react";</span><span id="0f8f" class="mo kv iy mg b gy mt mq l mr ms">const UserProfile = () =&gt; {<br/>    const {user, isAuthenticated, isLoading} = useAuth0();</span><span id="0414" class="mo kv iy mg b gy mt mq l mr ms">    if (isLoading) {<br/>        return &lt;div&gt;Loading ...&lt;/div&gt;;<br/>    }</span><span id="9339" class="mo kv iy mg b gy mt mq l mr ms">    if (isAuthenticated) {<br/>        return &lt;div&gt;<br/>            &lt;img src={user?.picture} alt={user?.name}/&gt;<br/>            &lt;h2&gt;Hello, {user?.name}&lt;/h2&gt;<br/>        &lt;/div&gt;<br/>    }<br/>    return &lt;p&gt;Tap the login button&lt;/p&gt;<br/>};</span><span id="7e0e" class="mo kv iy mg b gy mt mq l mr ms">export default UserProfile;</span></pre><p id="e9b1" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将在<code class="fe md me mf mg b">ExploreContainer</code>中使用新的<code class="fe md me mf mg b">UserProfile</code>组件。新更新的代码是:</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="4a35" class="mo kv iy mg b gy mp mq l mr ms">import './ExploreContainer.css';<br/>import LoginButton from "./LoginButton";<br/>import LogoutButton from "./LogoutButton";<br/>import UserProfile from "./UserProfile";<br/>import { useAuth0 } from "@auth0/auth0-react";</span><span id="5f64" class="mo kv iy mg b gy mt mq l mr ms">interface ContainerProps {<br/>}</span><span id="c6a1" class="mo kv iy mg b gy mt mq l mr ms">const ExploreContainer: React.FC&lt;ContainerProps&gt; = () =&gt; {<br/>    const {isAuthenticated} = useAuth0();<br/>    if (isAuthenticated) {<br/>        return (<br/>            &lt;div className="container"&gt;<br/>                &lt;UserProfile/&gt;<br/>                &lt;LogoutButton/&gt;<br/>            &lt;/div&gt;<br/>        );<br/>    }<br/>    return (<br/>        &lt;div className="container"&gt;<br/>            &lt;UserProfile/&gt;<br/>            &lt;LoginButton/&gt;<br/>        &lt;/div&gt;<br/>    );</span><span id="9630" class="mo kv iy mg b gy mt mq l mr ms">};</span><span id="3fae" class="mo kv iy mg b gy mt mq l mr ms">export default ExploreContainer;</span></pre><p id="566b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，在你登录后，你应该会看到你的名字，头像和一个注销按钮。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/cebfb7f72b305f2e93ed17494c2c9805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uU3nDFjI2SFtFTOD"/></div></div></figure><h1 id="64d1" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">做一个PWA</h1><p id="b286" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我们快到了。我们需要做的就是让这个Ionic app成为PWA。这很容易。打开你的<code class="fe md me mf mg b">index.tsx</code>文件，在第24行找到<code class="fe md me mf mg b">serviceWorkerRegistration.unregister();</code>，把它改成<code class="fe md me mf mg b">serviceWorkerRegistration.register();</code></p><p id="74ad" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了确保我们的PWA准备就绪，我们需要构建应用程序并使用Lighthouse进行测试。运行<code class="fe md me mf mg b">ionic build</code>构建应用程序。这将创建一个包含所有构建文件的构建目录，包括PWA的服务工作器和清单文件。</p><p id="5eaf" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">服务人员要求应用程序托管在安全的环境中。为了服务于构建，我们使用本地节点服务器。运行<code class="fe md me mf mg b">npm i serve -g</code>安装<a class="ae kt" href="https://www.npmjs.com/package/serve" rel="noopener ugc nofollow" target="_blank">npmjs.com/package/serve</a>。</p><p id="a6d3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们可以运行<code class="fe md me mf mg b">serve build</code>命令。这在<code class="fe md me mf mg b">http://localhost:5000</code>上运行应用程序，幸运的是，本地主机被认为是安全的，你现在不需要HTTPS origin来测试我们的PWA。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mx"><img src="../Images/8d9e386f7a9ddc2a27031d0c27895aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nYwoYXmaQbXMAVQj"/></div></div></figure><p id="5433" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在chrome中打开一个隐身窗口，打开<code class="fe md me mf mg b">http://localhost:5000</code>。你会注意到另一个问题。当您刷新页面时，应用程序将不会加载。这是因为<code class="fe md me mf mg b">serve</code>试图找到<code class="fe md me mf mg b">localhost:5000/home</code>并期望一个包含<code class="fe md me mf mg b">index.html</code>文件的<code class="fe md me mf mg b">home</code>文件夹，而这个文件并不存在。有多种方法可以解决这个问题。对于本教程，我将使用散列路由。</p><p id="d328" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你所需要做的就是转到你的<code class="fe md me mf mg b">App.tsx</code>文件，用<code class="fe md me mf mg b">IonReactHashRouter</code>替换<code class="fe md me mf mg b">IonReactRouter</code>。现在页面URL将看起来像这样<code class="fe md me mf mg b">localhost:5000/#/home</code>，并且您可以毫无问题地刷新。</p><p id="50fa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">解决路由问题后，打开<code class="fe md me mf mg b">http://localhost:5000</code>。然后，打开Chrome Devtools，打开Lighthouse选项卡，为Progressive web app生成一个报告。这是我的测试结果，显示PWA应用程序有几个问题需要解决。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/354a6fffa891ecac08eb4b37a126acce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EIDXWXPTn7zdmeO4"/></div></div></figure><p id="7625" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">问题是:</p><ul class=""><li id="b212" class="my mz iy jx b jy jz kc kd kg na kk nb ko nc ks nd ne nf ng bi translated">没有提供某些图标大小。</li><li id="33a9" class="my mz iy jx b jy nh kc ni kg nj kk nk ko nl ks nd ne nf ng bi translated">没有苹果触摸图标。</li><li id="0a9f" class="my mz iy jx b jy nh kc ni kg nj kk nk ko nl ks nd ne nf ng bi translated">meta标记中没有指定主题颜色。</li></ul><p id="1bb8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了解决第一个问题，我们需要在<code class="fe md me mf mg b">manifest.json</code>文件中提供所有尺寸的图标。该文件位于项目的<code class="fe md me mf mg b">public</code>文件夹中。我将使用在线PWA清单&amp;图标生成器(【simicart.com/manifest-generator.html】T21</p><p id="b5be" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需在此处指定您的应用程序图标(最小512px x 512px)和名称。然后单击生成清单下载一个zip文件。它应该包含我们需要的所有图标。我将在资产文件夹中使用Ionic提供的默认图标。您的zip文件内容应该如下所示:</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nm"><img src="../Images/7127df32b60fa8260f78baea34401a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OfCVogLHoSVXgH2e"/></div></div></figure><p id="abf4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">继续将所有图标复制到您的项目的<code class="fe md me mf mg b">public -&gt; assets -&gt; icon</code>文件夹下。</p><p id="8069" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的新manifest.json将包括这些图标，它应该是这样的:</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="1229" class="mo kv iy mg b gy mp mq l mr ms">{<br/>  "short_name": "Ionic App",<br/>  "name": "My Ionic App",<br/>  "icons": [<br/>    {<br/>      "src": "assets/icon/icon-192x192.png",<br/>      "sizes": "192x192",<br/>      "type": "image/png",<br/>      "purpose": "maskable any"<br/>    },<br/>    {<br/>      "src": "assets/icon/icon-256x256.png",<br/>      "sizes": "256x256",<br/>      "type": "image/png",<br/>      "purpose": "maskable any"<br/>    },<br/>    {<br/>      "src": "assets/icon/icon-384x384.png",<br/>      "sizes": "384x384",<br/>      "type": "image/png",<br/>      "purpose": "maskable any"<br/>    },<br/>    {<br/>      "src": "assets/icon/icon-512x512.png",<br/>      "sizes": "512x512",<br/>      "type": "image/png",<br/>      "purpose": "maskable any"<br/>    }<br/>  ],<br/>  "start_url": ".",<br/>  "display": "standalone",<br/>  "theme_color": "#ffffff",<br/>  "background_color": "#ffffff"<br/>}</span></pre><p id="a3ff" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是对第一个问题的修正。</p><p id="5b9e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将以下代码添加到您的<code class="fe md me mf mg b">index.html</code>的<code class="fe md me mf mg b">head</code>标签中，以解决第二个和第三个问题。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="3487" class="mo kv iy mg b gy mp mq l mr ms">&lt;link rel="apple-touch-icon" href="%PUBLIC_URL%/assets/icon/icon-192x192.png"&gt;</span><span id="347b" class="mo kv iy mg b gy mt mq l mr ms">&lt;meta name="theme-color" content="#ffffff"/&gt;</span></pre><p id="ec2e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们都准备好了。让我们再次构建和测试PWA应用程序。运行<code class="fe md me mf mg b">ionic build</code>，然后运行<code class="fe md me mf mg b">serve build</code>。打开Chrome隐姓埋名窗口，用Lighthouse测试。</p><p id="8626" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您应该看到这样的结果，表明您的PWA已经准备好并可以安装了。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/dae0d6d62279e09eb1bf75d7746a1e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lPWsO0mkCa-hweqE"/></div></div></figure><p id="094d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想测试安装，你可以在一个正常的窗口打开你的应用程序(不是匿名的)，你应该可以在Chrome地址栏看到安装按钮。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/1ee790516496b51caa27aac5c87bfb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tiOpACJ_7uAq8KIl"/></div></div></figure><p id="33fa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您尝试登录该应用程序的已安装版本，您会注意到您会得到与之前相同的错误，即“哎呀！出事了”。这是因为原点改为<code class="fe md me mf mg b">localhost:5000</code>。运行服务器时，可以将新的源添加到Auth0设置或指定端口。<code class="fe md me mf mg b">serve build -p 8100</code></p><p id="50a2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该应用程序在桌面上安装后如何工作的一些截图。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nn"><img src="../Images/786b80135b1876093bbcf4fe7b3a4657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ShCuYYI0poOyz0QW"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/7e473ab5460885a37d06bfdcfe67e2c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hfTQXFOZg5BMk1cH"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/88fdfbeb1cc6af79c582d62a23566a82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oPSbZext2nWuXkjs"/></div></div></figure><p id="a990" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">恭喜你。！🥳 🎉 👏 🥂</p><p id="d6cc" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你有了一个可以使用Auth0登录的实用PWA应用程序！</p><p id="c055" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以在手机上使用它，并将其安装为PWA应用程序。</p><p id="62fb" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可以从Github下载我在这个博客中构建的代码(项目)。</p><p id="bf51" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae kt" href="https://github.com/pazel-io/ionic-auth0-react-pwa" rel="noopener ugc nofollow" target="_blank">github.com/pazel-io/ionic-auth0-react-pwa</a></p><h1 id="8982" class="ku kv iy bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">加分—使用Vercel在不到5分钟内部署您的新应用</h1><p id="678d" class="pw-post-body-paragraph jv jw iy jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">为了在手机上测试我们的PWA，如果我们部署应用程序，通过HTTPS上的URL轻松访问它，会更容易。为此我将使用<a class="ae kt" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank"> Vercel </a>。Vercel是一个零配置的云CI/CD，它可以理解我们的Ionic项目的结构，并开箱即用地进行部署。</p><p id="a662" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为此，请前往<a class="ae kt" href="https://vercel.com/" rel="noopener ugc nofollow" target="_blank">vercel.com</a>注册一个免费账户。</p><p id="9d21" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">登录，您可以选择从您的Git repo导入一个项目。如前所述，我正在使用Github。所以我将从我的Github导入项目。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/81ffc1e36093ccfa105c9acd007ca376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k7ldhH5UHYgh23Sy"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/88c1057f11f3e94262bec240d8b20898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pCsNi1Q4ItnlFdfI"/></div></div></figure><p id="ee1c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Vercel已经知道您的项目是Ionic React，并且知道运行什么命令来构建它。只需点击部署即可。这将运行构建并为您提供一个URL，您的项目将在该URL上可用。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/4631f59555361e6d02c66f5f04d9b945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L8sSRkBAytaH9QIL"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/95cc13ac270773bcf5b92bd75a00fe97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*24DWWAHYg8f_7xxG"/></div></div></figure><p id="3b57" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需点击“访问”按钮即可访问您部署的应用程序。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi mj"><img src="../Images/20da15a3143a7358c332067bf2f996fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I0hrvpdaxGvNGZfg"/></div></div></figure><p id="87d5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请记住，您需要为允许的回拨URL、允许的注销URL和允许的Web源添加新的源(Vercel部署域)到Auth0设置，以便成功登录。你可以像这样添加新的。把<code class="fe md me mf mg b">YOUR_APP_NAME</code>换成自己的Vercel app。</p><pre class="ly lz ma mb gt mk mg ml mm aw mn bi"><span id="934e" class="mo kv iy mg b gy mp mq l mr ms">http://localhost:8100, <a class="ae kt" rel="noopener ugc nofollow" target="_blank" href="/{YOUR_APP_NAME}.vercel.app">https://{YOUR_APP_NAME}.vercel.app</a></span></pre><p id="bcd5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我可以在电话上测试了。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/3fc71b5e6dd8d029ea451fc5b4424ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rlA40DNLMltqReEU"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/be5e58213910ca1499d75cba92a05b63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5v7sLrw3uOhLay3l"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/e2b3677aa3bbc8e4c735c46b913096db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*M4kdNTwxAt6X1p1X"/></div></div></figure><p id="dfd4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">继续，打开应用程序的安装版本并尝试登录。</p><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/37da4f5a81e86862e6bc975c24ae55b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wm5n6CqQWsd9PmaC"/></div></div></figure><figure class="ly lz ma mb gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi no"><img src="../Images/52db1ae181a746fc41b96df661521211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_or8xQLYxBG1mqIa"/></div></div></figure><p id="3cdd" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本教程到此为止。只要你在浏览器中运行它或者把它安装成PWA，这个实现对Web和移动设备来说已经足够好了。</p><p id="15f2" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我的下一篇文章中，我将把Ionic &amp; Capacitor与Auth0集成为一个原生应用。</p><p id="098b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">感谢阅读。如果你有任何问题，我是有空的。在这里给我留言或者在Twitter上给我发消息。</p><p id="6cc9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Git回购:<a class="ae kt" href="https://github.com/pazel-io/ionic-auth0-react-pwa" rel="noopener ugc nofollow" target="_blank">github.com/pazel-io/ionic-auth0-react-pwa</a></p><p id="11e7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">演示:<a class="ae kt" href="https://ionic-auth0-react-pwa-deploy.vercel.app/#/home" rel="noopener ugc nofollow" target="_blank">ionic-auth0-react-pwa-deploy.vercel.app/#/h..</a></p><p id="4144" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">推特:<a class="ae kt" href="https://twitter.com/_pazel" rel="noopener ugc nofollow" target="_blank">_帕泽尔</a></p><p id="7b4c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="np">更多内容请看</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx iz"><em class="np">plain English . io</em></strong></a></p></div></div>    
</body>
</html>