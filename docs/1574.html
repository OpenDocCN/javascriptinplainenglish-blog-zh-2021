<html>
<head>
<title>How to Reduce the Number of Re-renders When Updating States?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">更新状态时如何减少重新渲染的次数？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-reduce-the-number-of-re-renders-when-updating-states-cb283154ed4f?source=collection_archive---------9-----------------------#2021-04-04">https://javascript.plainenglish.io/how-to-reduce-the-number-of-re-renders-when-updating-states-cb283154ed4f?source=collection_archive---------9-----------------------#2021-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/16b9db04e35a3b7bdf3f9074196ef6bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-9nAiezwhDUt-a_b"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Jordan</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0783" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">每当React组件中的状态更新时，都会进行重新呈现。</p><p id="7b8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着当我们更新许多状态时，会有许多重新渲染的工作要做。</p><p id="db22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何减少React组件中的重渲染次数。</p><h1 id="7195" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">如何减少重新渲染的次数？</h1><p id="88c3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过减少更新状态的数量来减少重新渲染的次数。</p><p id="f261" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以更新一个对象而不是状态，而不是多个状态。</p><p id="a0e2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="0ae1" class="mn lc iq mj b gy mo mp l mq mr">import { useEffect, useState } from "react";</span><span id="bd1b" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const [request, setRequest] = useState({<br/>    loading: false,<br/>    data: undefined<br/>  });</span><span id="e272" class="mn lc iq mj b gy ms mp l mq mr">  const getData = async () =&gt; {<br/>    setRequest((request) =&gt; ({ ...request, loading: true }));<br/>    const res = await fetch("https://yesno.wtf/api/");<br/>    const data = await res.json();<br/>    setRequest((request) =&gt; ({ ...request, data }));<br/>  };</span><span id="fb1c" class="mn lc iq mj b gy ms mp l mq mr">  useEffect(() =&gt; {<br/>    getData();<br/>  }, []);</span><span id="86c4" class="mn lc iq mj b gy ms mp l mq mr">  useEffect(() =&gt; {<br/>    if (request.data) {<br/>      setRequest((request) =&gt; ({ ...request, loading: false }));<br/>    }<br/>  }, [request]);</span><span id="57c4" class="mn lc iq mj b gy ms mp l mq mr">  return &lt;div className="App"&gt;{JSON.stringify(request)}&lt;/div&gt;;<br/>}</span></pre><p id="7aca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe mt mu mv mj b">request</code>状态，它有<code class="fe mt mu mv mj b">loading</code>和<code class="fe mt mu mv mj b">data</code>属性。</p><p id="63a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">getData</code>函数中，我们调用<code class="fe mt mu mv mj b">setRequest</code>来更新<code class="fe mt mu mv mj b">request</code>状态对象的<code class="fe mt mu mv mj b">loading</code>属性，方法是传入一个回调并返回一个新对象，它是<code class="fe mt mu mv mj b">request</code>的副本，但是<code class="fe mt mu mv mj b">loading</code>被设置为<code class="fe mt mu mv mj b">true</code>。</p><p id="d137" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在函数结束时，我们用新的值<code class="fe mt mu mv mj b">data</code>再次调用<code class="fe mt mu mv mj b">setRequest</code>。</p><p id="3a04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们有一个检查<code class="fe mt mu mv mj b">request.data</code>是否被设置的<code class="fe mt mu mv mj b">useEffect</code>回调，并用一个返回<code class="fe mt mu mv mj b">request</code>对象副本的回调调用<code class="fe mt mu mv mj b">setRequest</code>，其中<code class="fe mt mu mv mj b">loading</code>被设置为<code class="fe mt mu mv mj b">false</code>。</p><p id="7bd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种方法是创建我们自己的钩子来合并不同的状态对象属性。</p><p id="55f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a8e9" class="mn lc iq mj b gy mo mp l mq mr">import { useEffect, useState } from "react";</span><span id="ad47" class="mn lc iq mj b gy ms mp l mq mr">const useMergeState = (initialState) =&gt; {<br/>  const [state, setState] = useState(initialState);<br/>  const setMergedState = (newState) =&gt;<br/>    setState((prevState) =&gt; ({ ...prevState, newState }));<br/>  return [state, setMergedState];<br/>};</span><span id="ea39" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const [request, setRequest] = useMergeState({<br/>    loading: false,<br/>    data: undefined<br/>  });</span><span id="6656" class="mn lc iq mj b gy ms mp l mq mr">  const getData = async () =&gt; {<br/>    setRequest({ loading: true });<br/>    const res = await fetch("https://yesno.wtf/api/");<br/>    const data = await res.json();<br/>    setRequest({ data });<br/>  };</span><span id="d6fa" class="mn lc iq mj b gy ms mp l mq mr">  useEffect(() =&gt; {<br/>    getData();<br/>  }, []);</span><span id="142b" class="mn lc iq mj b gy ms mp l mq mr">  useEffect(() =&gt; {<br/>    if (request.data) {<br/>      setRequest({ loading: false });<br/>    }<br/>  }, [request, setRequest]);</span><span id="7a66" class="mn lc iq mj b gy ms mp l mq mr">return &lt;div className="App"&gt;{JSON.stringify(request)}&lt;/div&gt;;<br/>}</span></pre><p id="64b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了具有<code class="fe mt mu mv mj b">setMergedState</code>函数的<code class="fe mt mu mv mj b">useMergeState</code>钩子，该钩子调用<code class="fe mt mu mv mj b">setState</code>函数，通过<code class="fe mt mu mv mj b">setState</code>中的回调将<code class="fe mt mu mv mj b">newState</code>合并到<code class="fe mt mu mv mj b">prevState</code>中。</p><p id="3d8b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">App</code>中的<code class="fe mt mu mv mj b">useMergeState</code>返回我们的状态和状态设置器函数。</p><p id="4c45" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们不需要向state setter函数传递一个回调来合并状态，而是将我们想要更改的属性传递给<code class="fe mt mu mv mj b">setRequest</code>来更改属性。</p><p id="9a53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在任一示例中，我们一次更新我们对象中需要的内容，而不是更新多个原始值。</p><h1 id="5072" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2c77" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过将状态放入对象并一次更新它们来减少React和JavaScript对组件的重新渲染次数。</p><p id="f654" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>