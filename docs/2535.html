<html>
<head>
<title>Build A Website with Keystone Next And Next.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Keystone Next和Next.js建立一个网站</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-website-with-keystone-next-and-next-js-6c2618c489f6?source=collection_archive---------1-----------------------#2021-05-25">https://javascript.plainenglish.io/build-a-website-with-keystone-next-and-next-js-6c2618c489f6?source=collection_archive---------1-----------------------#2021-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eb77" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用Keystone Next创建一个GraphQL API</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d5170e86764d0bab152bee313ddc1ae9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bgxuYENU9nB-HxIh"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: <a class="ae kv" href="https://unsplash.com/@alfonsmc10" rel="noopener ugc nofollow" target="_blank">Alfons Morales</a> On <a class="ae kv" href="http://unsplash.com" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="09da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本教程中，您将学习如何使用Keystone Next，并使用Next.js作为前端来使用它的GraphQL API。</p><p id="93bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">与Keystone后端，你将建立一个“电话数据库”。您可以添加制造商和电话数据。稍后，您还将负责将电话和公司数据库连接在一起。</p><div class="kg kh ki kj gt ab cb"><figure class="ls kk lt lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/68d27720c853efc1b90bf59e31cf8417.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*VoJ7AT1lm3j-109SpaxvQg.png"/></div></figure><figure class="ls kk ly lu lv lw lx paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6b31ba81e6c7b9f1b44a4d1b7efb764e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*WgMabEJNl1xd-GvylYoAGQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk lz di ma mb">Our Phones and Companies database.</figcaption></figure></div><p id="5dea" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您将学习如何用Next.js连接Keystone服务器。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/f77e57f2506331b24079d4a25e12841b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HIIVsAy-bdl0eRqeJMIuAg.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">End result of this article</figcaption></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="0d22" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">介绍</h1><p id="528e" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">要为网站构建GraphQL API，您需要执行以下步骤:</p><ul class=""><li id="7f92" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">配置您的数据库</li><li id="1422" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">设置您的后端</li><li id="a808" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">为您的GraphQL API编写字段及其对应的模式</li><li id="4b48" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">稍后，构建查询和变异功能</li><li id="447e" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">最后，告诉您的代码运行GraphQL</li></ul><p id="173d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然这是可能的，但它有几个缺陷。例如，如果您想扩展您的应用程序，代码维护就成了一个大问题。它占用了太多的时间和精力。</p><p id="71ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在一个时间就是金钱的行业，这是不可行的。为了缓解这个问题，这就是<a class="ae kv" href="https://next.keystonejs.com/" rel="noopener ugc nofollow" target="_blank">基石</a>的用武之地。要使用Keystone库，您需要做的就是指定您的字段和模式，它会为您处理其余的事情。</p><p id="7ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它不仅可以作为GraphQL后端，还可以作为CMS。随着KeyStone 6的推出，该团队还开发了一个<a class="ae kv" href="https://next.keystonejs.com/guides/document-fields" rel="noopener ugc nofollow" target="_blank">文档API </a>，这意味着写博客成为可能。我们将在本文的后面了解文档特性。</p><p id="e952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然已经谈了它的成果，那就开始吧！</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="bc35" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">入门指南</h1><h2 id="1481" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">PostgreSQL数据库设置</h2><p id="6ece" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">Keystone需要一个PostgreSQL数据库作为先决条件。我推荐使用<a class="ae kv" href="https://www.elephantsql.com/" rel="noopener ugc nofollow" target="_blank"> ElephantSQL </a>，因为它在云中为你建立了一个数据库。它快速可靠。</p><p id="ba28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建ElephantSQL实例后，复制连接URL并将其存储在安全的地方。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/970c40e9926dc48ce891873a125e68a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*iKU1nzI5eYg61qQaGcHG6g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">ElephantSQL ‘Details’ Panel</figcaption></figure><p id="142b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经创建了数据库，是时候生成一个Keystone项目了。</p><h2 id="635a" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">项目初始化</h2><p id="ff5d" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">由于项目包含前端和后端，因此最好将项目组织在文件夹中。为此，运行以下终端命令:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="b173" class="nv ml iq oj b gy on oo l op oq">mkdir keystone-tutorial<br/>cd keystone-tutorial<br/>mkdir frontend #Next.js code goes here</span></pre><h2 id="73f5" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">建筑基石6</h2><p id="14fc" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">为此，运行以下终端命令:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="c063" class="nv ml iq oj b gy on oo l op oq">npm init keystone-app</span></pre><p id="0f50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将告诉NPM建立一个基石项目。</p><p id="20ef" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在构建项目之前，初始化过程会询问您一系列问题。输入您的答案，它将使用您选择的配置创建您的项目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/b05fca5fd5a13828621e213e632cf056.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BgcdrUinrjKIyfJc6s6tqg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Terminal command to generate Keystone app</figcaption></figure><p id="fbd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我将Keystone实例生成到我的<code class="fe os ot ou oj b">backend</code>文件夹中，以促进正确的文件组织。</p><p id="5717" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完事了。在下一节中，我们将研究我们的Keystone服务器。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="b592" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">我们的Keystone服务器</h1><p id="4acf" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在本文的这一部分，导航到<code class="fe os ot ou oj b">backend</code>文件夹，因为这个目录包含我们的Keystone代码。</p><h2 id="45d1" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">用户表</h2><p id="2882" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">我们将不使用启动代码。转到<code class="fe os ot ou oj b">schema.ts</code>，用以下代码替换您的代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="74de" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第1行:导入<code class="fe os ot ou oj b">createSchema</code>和<code class="fe os ot ou oj b">list</code>函数，这两个函数将告诉Keystone在这个文件中为我们的对象构建模式。</li><li id="ca59" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第2行:这里，<code class="fe os ot ou oj b">text</code>、<code class="fe os ot ou oj b">relationship</code>、<code class="fe os ot ou oj b">timestamp</code>和<code class="fe os ot ou oj b">password</code>是我们字段的数据类型。你以后会和他们一起工作。</li><li id="7ea2" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第3行:<code class="fe os ot ou oj b">document</code>是另一种允许用户输入富文本数据的数据类型。</li><li id="0f00" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第5行:告诉Keystone创建我们的模式。</li><li id="949e" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第6行:我们的第一个字段是<code class="fe os ot ou oj b">User</code>字段。</li><li id="bfa4" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第7-10行:它将有三个字段:<code class="fe os ot ou oj b">text</code>类型的<code class="fe os ot ou oj b">name</code>和<code class="fe os ot ou oj b">text</code>类型的<code class="fe os ot ou oj b">email</code>，它们将具有唯一值。</li></ul><p id="22df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用以下终端命令运行代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="87dd" class="nv ml iq oj b gy on oo l op oq">npm run dev </span></pre><p id="fb57" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在转到<code class="fe os ot ou oj b">localhost:3000</code>。这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/b70fa94d2f433ef05a13a674138fca24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9klyQ7SgYgQyAM4q.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="baa5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完事了。让我们一起建设我们的公司领域。</p><h2 id="d1a3" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">构建我们的公司表</h2><p id="f049" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在<code class="fe os ot ou oj b">schema.ts</code>中，将以下代码添加到您的<code class="fe os ot ou oj b">createSchema</code>函数中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/0044a93f29e2361e27619ded94297234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZxImss8V32_cwjjZ1YRLiA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Code to write in schema.ts</figcaption></figure><ul class=""><li id="4d9e" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第1行:创建一个<code class="fe os ot ou oj b">Company</code>模式。</li><li id="db87" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第2–4行:创建一个类型为<code class="fe os ot ou oj b">text</code>的<code class="fe os ot ou oj b">name</code>字段，并创建一个类型为<code class="fe os ot ou oj b">timestamp</code>的<code class="fe os ot ou oj b">year</code>字段。这将允许用户输入时间和日期。我们已经根据需要对这两个字段进行了分类。</li></ul><p id="4441" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在再次运行代码。这将是输出:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/f73bd3326b685d957c054a534a852c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qTf1bYVK0AiPFVfV.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="b472" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以继续做一个<code class="fe os ot ou oj b">Company</code>条目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/331c9b0011459fa99fed82e72c65f1a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FAW7JKAsMW9YDqgZ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Entering some data</figcaption></figure><p id="5b01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果流程成功，它将显示在您公司的主页上:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/5099359b1363826c18fb255cf7bf4039.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*prf7I6xZ5eRy0F2Wcsl5bw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Entry visible on homepage</figcaption></figure><p id="aa72" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的代码按预期工作。现在，让我们创建我们的手机领域。</p><p id="0d19" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">schema.ts</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><h2 id="7886" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">打造我们的电话桌</h2><p id="6408" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在您的<code class="fe os ot ou oj b">schema.ts</code>文件中，在您的<code class="fe os ot ou oj b">createSchema</code>函数中编写以下代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="ad73" class="nv ml iq oj b gy on oo l op oq">Phone: list({<br/>  fields: {<br/>    name: text({ isRequired: true }),<br/>    company: text({ isRequired: true }),<br/>  },<br/>});</span></pre><p id="a47f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们为我们的<code class="fe os ot ou oj b">Phone</code>数据创建一个模式。它将有一个<code class="fe os ot ou oj b">name</code>和一个<code class="fe os ot ou oj b">company</code>字段。</p><p id="f64e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还想给我们的<code class="fe os ot ou oj b">Phone</code>数据类型一个<code class="fe os ot ou oj b">document</code>字段，这样用户可以输入富文本。</p><p id="498f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，转到<a class="ae kv" href="https://next.keystonejs.com/guides/document-fields#customize-the-editor" rel="noopener ugc nofollow" target="_blank">自定义编辑器</a>页面，并确保您已经检查了以下设置:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/62866740b70d4f6bb7c923b02b957a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*m48vfzbTXuj77rXSRaiOag.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Settings to check in Customize your editor</figcaption></figure><p id="bb9a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，Keystone将生成代码，根据我们的喜好定制我们的文档字段。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/951d30fc2450e620b08489d016a0938b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*w0QKcj_8dJFrVCXq42vPUw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Keystone-generated code</figcaption></figure><p id="4919" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">首先修改这段代码，然后将其复制到您的<code class="fe os ot ou oj b">Phone</code>数据类型中，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="6dd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里，我们告诉Keystone添加一个<code class="fe os ot ou oj b">document</code>字段，它将被定制为我们之前指定的设置。</p><p id="a1fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您的<code class="fe os ot ou oj b">Phone</code>数据类型应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="0018" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">重新启动服务器。结果应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/cb88b961f0377f74d4897ca5d29384d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nX-vpv4vo9LLSWe6.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="8b1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！我们的代码有效。</p><p id="33ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一部分中，您将学习如何在代码中实现关系。</p><p id="d3e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">schema.ts</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><h2 id="e0fc" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">实现关系</h2><p id="520a" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在我们的代码中，注意我们的<code class="fe os ot ou oj b">Phone</code>类型有一个字段<code class="fe os ot ou oj b">company</code>。为了更好的用户体验，我们可以尝试链接<code class="fe os ot ou oj b">Phone</code>和<code class="fe os ot ou oj b">Company</code>表，这样我们就可以拥有一个关系数据库。</p><p id="33f9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，将您的<code class="fe os ot ou oj b">Company</code>表模式更改如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pd"><img src="../Images/23721b481b3188de9e46fadf622adfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Btbd_5mqphqBb8a8MSfaww.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Code to write in Company schema</figcaption></figure><ul class=""><li id="f204" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第5行:<code class="fe os ot ou oj b">phone</code>字段现在是类型<code class="fe os ot ou oj b">relationship</code>，它将与<code class="fe os ot ou oj b">Phone’s</code> <code class="fe os ot ou oj b">company</code>字段链接。<code class="fe os ot ou oj b">many</code>属性被设置为<code class="fe os ot ou oj b">true</code>，这意味着对于每个<code class="fe os ot ou oj b">Company</code>，可以存在多个<code class="fe os ot ou oj b">Phones</code>。</li></ul><p id="a36c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，在您的<code class="fe os ot ou oj b">Phone</code>表模式中找到下面一行代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="8986" class="nv ml iq oj b gy on oo l op oq">company: relationship({ isRequired: true }),</span></pre><p id="3504" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="d92f" class="nv ml iq oj b gy on oo l op oq">company: relationship({ ref:"Company.phone" , many: false }),</span></pre><p id="3013" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将告诉Keystone与<code class="fe os ot ou oj b">Company's</code> <code class="fe os ot ou oj b">phone</code>字段建立关系。最后，将<code class="fe os ot ou oj b">many</code>属性设置为<code class="fe os ot ou oj b">false</code>，这意味着对于每一个<code class="fe os ot ou oj b">Phone</code>项，<strong class="ky ir">不能是</strong>的倍数。</p><p id="c033" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行代码。在继续之前，Keystone会询问您的表是否会被销毁。简单地输入<code class="fe os ot ou oj b">y</code>:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pe"><img src="../Images/e26fc7f9df6d15eb87e79e6925a4df56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fjc-efwHv_DLXSPCasrOQg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Type ‘y’</figcaption></figure><p id="a202" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们来测试一下。在您的<code class="fe os ot ou oj b">Company</code>页面中，继续创建另一个条目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/d1f8f410671ae0690b9f7381f4aff080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ooI7ktthLjooJjEJ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Creating an entry in Company</figcaption></figure><p id="7382" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在转到您的手机页面并创建一个条目:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/0602a4213b415ba2c3b2b59bb26b3d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*k-1Z-HRdLJZ3E7dUnP5rRA.gif"/></div></div></figure><p id="d6df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">请注意，在我们公司下面，我们可以在“三星”和“苹果”之间进行选择。这意味着我们成功地创建了一个关系数据库，并且我们的代码像预期的那样工作。</p><p id="152e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在完成了文章的这一部分。在下一部分，我们将简要讨论如何通过GraphQL API使用这些数据。</p><p id="f0d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">schema.ts</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="d1f2" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">使用GraphQL</h1><h2 id="6567" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">GraphQL接口</h2><p id="12de" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">要使用这些数据，请转到<code class="fe os ot ou oj b">localhost:3000/api/graphql</code>。这将允许您运行GraphQL命令并从Keystone中检索数据。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/2a243b63f364be9d93dcc3a4afdff90b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0s74d9gzM7XwgECOBrFyVg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">GraphQL interface</figcaption></figure><h2 id="42c4" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">运行命令</h2><p id="cbff" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">让我们尝试获取所有公司的数据。为此，请在查询编辑器中编写以下查询:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="995d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我们告诉Keystone给我们<code class="fe os ot ou oj b">id</code>、<code class="fe os ot ou oj b">name</code>、<code class="fe os ot ou oj b">year</code>字段。最后，我们也需要这些公司相应的<code class="fe os ot ou oj b">phone</code>数据。</p><p id="c45f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是输出结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/b0c0242fe3a1b66bb84f445d6c5fd349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wShejoCnV5LZ87_3UXXEHQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of query</figcaption></figure><p id="8566" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">太好了！如您所见，我们正在获取数据及其关联的电话名称。</p><p id="fe58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们甚至可以获得特定<code class="fe os ot ou oj b">Company</code>的数据。为此，请运行以下查询:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="f378" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第2行:从<code class="fe os ot ou oj b">Company</code>表中获取数据，该表的<code class="fe os ot ou oj b">id</code>为1。</li></ul><p id="bde0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/e3f8494818403d878a08c5f045d8a60f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*pG6dtPUbbNOH01W_K-PHgw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the query</figcaption></figure><p id="0d8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下查询将获取<code class="fe os ot ou oj b">id</code>为1的<code class="fe os ot ou oj b">Phone</code>对象的数据:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="ae9f" class="nv ml iq oj b gy on oo l op oq">query {<br/>  Phone(where: {id:1 }) { <br/>    name <br/>    company {<br/>      name<br/>    }<br/>  }<br/>}</span></pre><p id="d15e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pj"><img src="../Images/b26eb2eb9025d8b374b3a3d2578d2c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwCSnrmdG8Nkt4g-w0yVgA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the query</figcaption></figure><p id="0766" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">既然你已经学会了如何在Keystone中使用GraphQL，那么是时候用Next.js编写这个应用程序的前端了。</p></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="da38" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">构建前端</h1><p id="69ca" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在文章的这一部分，导航到您的<code class="fe os ot ou oj b">frontend</code>文件夹。</p><h2 id="2a9f" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">项目设置</h2><p id="dc16" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">要初始化项目，请键入以下终端命令:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="b13c" class="nv ml iq oj b gy on oo l op oq">npx create-next-app . </span></pre><p id="fcd1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经初始化了我们的项目，您必须删除起始代码。为此，继续删除<code class="fe os ot ou oj b">/pages/index.js</code>中<code class="fe os ot ou oj b">div</code>标签之间的所有代码。最后，<code class="fe os ot ou oj b">/pages/index.js</code>应该是这样的:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="da44" class="nv ml iq oj b gy on oo l op oq">export default function Home() {<br/>  return (<br/>    &lt;div&gt; <br/>     &lt;p&gt;Home page &lt;/p&gt;<br/>    &lt;/div&gt;  <br/>  )<br/>}</span></pre><h2 id="f148" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">安装所需模块</h2><p id="21a2" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在这里，我们将安装以下库:</p><ul class=""><li id="37fe" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><code class="fe os ot ou oj b">@keystone-next/document-renderer</code>。这将呈现来自<code class="fe os ot ou oj b">document</code>字段的数据。</li><li id="229c" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated"><code class="fe os ot ou oj b">@apollo/client</code>:用于对我们的API进行GraphQL查询。</li><li id="74e8" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated"><code class="fe os ot ou oj b">graphql</code>:对<code class="fe os ot ou oj b">@apollo/client</code>的外部依赖。</li></ul><p id="26c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，运行以下终端命令:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="6eeb" class="nv ml iq oj b gy on oo l op oq">npm i @keystone-next/document-renderer @apollo/client graphql</span></pre><h2 id="5f6c" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">更改端口</h2><p id="1be5" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">尝试运行全新的Next应用程序:</p><p id="82bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您的Keystone服务器已经在后台运行，结果将是:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/f2a281c9484239e9db4538728817f523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zqNxOmpD8TGs3TUvkIXKLA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Terminal command error</figcaption></figure><p id="dead" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于Next默认在端口<code class="fe os ot ou oj b">3000</code>上运行，我们得到了一个错误。然而，Keystone服务器已经占用了<code class="fe os ot ou oj b">3000</code>端口。我们需要解决这个问题。</p><p id="d5d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的<code class="fe os ot ou oj b">package.json</code>文件中，找到下面一行:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="5aa6" class="nv ml iq oj b gy on oo l op oq">"dev": "next dev",</span></pre><p id="69dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="a9d7" class="nv ml iq oj b gy on oo l op oq">"dev": "next -p 3001",</span></pre><p id="fbfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在已经告诉Next在端口<code class="fe os ot ou oj b">3001</code>上运行我们的应用程序。尝试再次运行代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/15d4d93df8835b7ee90fef9cfcb51967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpzcLPLJwut6rUSWp4N0Yg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Successful command</figcaption></figure><p id="be0e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在去<code class="fe os ot ou oj b">localhost:3001</code>。最终结果应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/70e25675d6e031d6a6735cb278c4b6f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*kZhaO8EgJVFWmbYRluisWA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="059d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们组织这个项目的文件结构。</p><h2 id="ba89" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">项目文件结构</h2><p id="9a61" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在您的<code class="fe os ot ou oj b">pages</code>目录中，创建以下文件夹:</p><ul class=""><li id="4053" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated"><code class="fe os ot ou oj b">company</code>:处理从<code class="fe os ot ou oj b">/company</code>开始的路线。在这里，创建两个文件:<code class="fe os ot ou oj b">index.js</code>和<code class="fe os ot ou oj b">[id].js</code>。</li><li id="bd83" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated"><code class="fe os ot ou oj b">phone</code>:将处理从<code class="fe os ot ou oj b">/phone</code>开始的路线。同样，在这里也创建两个文件:<code class="fe os ot ou oj b">index.js</code>和<code class="fe os ot ou oj b">[id].js</code>。</li></ul><p id="3399" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另外，在这个app的根目录下，创建一个<code class="fe os ot ou oj b">helpers</code>文件夹，在这个文件夹内，创建一个名为<code class="fe os ot ou oj b">apollo-client.js</code>的文件。这将帮助我们连接到我们的GraphQL API。</p><p id="84b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您的前端项目的目录应该如下所示:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/ebacbfdc606554bff26fd00557aa27c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*qQgIHMccDv85c2LaVm3puw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Final project structure</figcaption></figure><p id="c862" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在让我们配置我们的GraphQL客户端。</p><h2 id="92b8" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">Apollo客户端配置</h2><p id="1a13" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在您的<code class="fe os ot ou oj b">/helpers/apollo-client.js</code>文件中，编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="9e9e" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第3–6行:创建一个指向Keystone服务器URL的<code class="fe os ot ou oj b">ApolloClient</code>实例。这种情况下是<code class="fe os ot ou oj b">localhost:3000/api/graphql</code>。</li><li id="59b3" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第8行:导出这个<code class="fe os ot ou oj b">ApolloClient</code>实例及其相关配置。</li></ul><h2 id="df9a" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">构建主页</h2><p id="ad22" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">在主页上，我们希望将用户重定向到<code class="fe os ot ou oj b">company</code>页面或<code class="fe os ot ou oj b">phone</code>目录。</p><p id="2cb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在您的<code class="fe os ot ou oj b">/pages/index.js</code>页面中，首先导入<code class="fe os ot ou oj b"><a class="ae kv" href="https://nextjs.org/docs/api-reference/next/link" rel="noopener ugc nofollow" target="_blank">Link</a></code>模块<a class="ae kv" href="https://nextjs.org/docs/api-reference/next/link" rel="noopener ugc nofollow" target="_blank">和</a>，如下所示:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="598a" class="nv ml iq oj b gy on oo l op oq">import Link from "next/link";</span></pre><p id="c4fb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，在同一个文件中找到<code class="fe os ot ou oj b">return</code>块:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="fb72" class="nv ml iq oj b gy on oo l op oq">return ( <br/>  &lt;div&gt;<br/>    &lt;p&gt;Home page&lt;/p&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="d86e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样修改它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="0fbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行代码。结果应该是这样的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/22c057d117de61fbacc0f707ea9cbe3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*79fiJXYnEDB0bpRISUGG7Q.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="cc6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成后，现在是时候开始我们的<code class="fe os ot ou oj b">/company</code>路线了。</p><p id="1636" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">/pages/index.js</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><h2 id="6251" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">显示公司表</h2><p id="c0b3" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">当用户转到<code class="fe os ot ou oj b">/company</code>时，我们希望向他显示所有可用公司的列表。</p><p id="e100" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到<code class="fe os ot ou oj b">pages/company/index.js</code>并编写以下代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="a71a" class="nv ml iq oj b gy on oo l op oq">export default function Companies() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt; List of all companies shown here.&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="df18" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是一个基本的React组件。稍后我们将对这个文件进行一些修改。</p><p id="17d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/85a518c19470877e769e28e558698898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HWGplxzAG-5c_CU3GX9CZA.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="9473" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第二步，我们现在需要从Keystone后端获取数据。</p><p id="e0d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe os ot ou oj b">/pages/company/index.js</code>中，首先，进行以下导入:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="e0ec" class="nv ml iq oj b gy on oo l op oq">import { gql } from "@apollo/client";<br/>import client from "../../helpers/apollo-client";<br/>import Link from "next/link";</span></pre><p id="fbdc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe os ot ou oj b">gql</code>和<code class="fe os ot ou oj b">client</code>模块将帮助我们进行GraphQL查询，并将结果返回给前端。</p><p id="4826" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，将下面这段代码添加到该文件的末尾:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="4649" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第2–11行:执行查询以获取所有公司的<code class="fe os ot ou oj b">name</code>和<code class="fe os ot ou oj b">id</code>字段，并将查询结果存储在<code class="fe os ot ou oj b">data</code>变量中。</li><li id="56de" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第15行:送<code class="fe os ot ou oj b">data</code>当道具。</li></ul><p id="7908" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据现已发送。作为我们的最后一步，我们必须在前端显示它。</p><p id="0110" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe os ot ou oj b">pages/company/index.js</code>中，找到你的<code class="fe os ot ou oj b">Companies</code>函数声明:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="075f" class="nv ml iq oj b gy on oo l op oq">export default function Companies() {<br/>  //further code...</span></pre><p id="4554" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="a60b" class="nv ml iq oj b gy on oo l op oq">export default function Companies({ data }) {<br/>  //further code..</span></pre><p id="f81e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着您现在可以在我们的组件中使用<code class="fe os ot ou oj b">data</code> prop。这里，您将显示<code class="fe os ot ou oj b">data</code>变量的值。</p><p id="8b28" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">找到您的<code class="fe os ot ou oj b">return</code>块:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="4144" class="nv ml iq oj b gy on oo l op oq">return (<br/>  &lt;div&gt;<br/>    &lt;h1&gt; List of all companies shown here.&lt;/h1&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="ddfd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="b8d2" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第4行:由于<code class="fe os ot ou oj b">data</code>属性是一个数组，我们可以使用<code class="fe os ot ou oj b">map</code>函数。</li><li id="20df" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第6行:<code class="fe os ot ou oj b">Link</code>元素将引导用户到<code class="fe os ot ou oj b">/company/[id]</code>路线。这里，<code class="fe os ot ou oj b">id</code>是具体公司的ID。</li><li id="75c7" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第7行:显示数组中每一项的<code class="fe os ot ou oj b">name</code>字段。</li></ul><p id="190c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行代码。这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/bcab1ce7ff2a3052795312687d5ba5e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zvLfEL9TIEdfUxPi6BAJSQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="e8d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是显示每个公司的电话列表。为此，转到<code class="fe os ot ou oj b">/pages/company/[id].js</code>并开始编写以下代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="4707" class="nv ml iq oj b gy on oo l op oq">import { gql } from "@apollo/client";<br/>import client from "../../helpers/apollo-client";<br/>import Link from "next/link";</span><span id="8912" class="nv ml iq oj b gy po oo l op oq">export default function PhoneList() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt; List of phones&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="b4ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着无论何时你点击<code class="fe os ot ou oj b">/companies</code>页面上的任何一项，Next.js都会将你重定向到<code class="fe os ot ou oj b">/companies/[id]</code>页面。这里，它将呈现<code class="fe os ot ou oj b">PhoneList</code>组件。</p><p id="495b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">作为最后一步，您必须呈现每个公司的电话列表。</p><p id="639d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在此之前，您需要生成静态路径。为此，转到<code class="fe os ot ou oj b">/pages/company/[id].js</code>，将以下代码添加到文件末尾:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="0b7d" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第2行:<code class="fe os ot ou oj b">getStaticPaths</code>函数将告诉Next静态生成我们的动态路由。这为我们的静态站点提供了更好的性能。</li><li id="c864" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第3–11行:执行GraphQL查询，从<code class="fe os ot ou oj b">Companies</code>表中获取所有的<code class="fe os ot ou oj b">id</code>字段，并将结果存储在<code class="fe os ot ou oj b">data</code>变量中。</li><li id="f2a8" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第13行:从查询中提取<code class="fe os ot ou oj b">id</code>属性，并将它们存储在<code class="fe os ot ou oj b">paths</code>数组中。</li><li id="3717" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第19行:将这些<code class="fe os ot ou oj b">id’s</code>发送给Next。我们还将<code class="fe os ot ou oj b">fallback</code>属性设置为<code class="fe os ot ou oj b">false</code>，这意味着所有未生成的路由都将返回一个<code class="fe os ot ou oj b">404</code>错误。</li></ul><p id="51d6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经生成了静态路径，是时候从Keystone实际获取数据了。在<code class="fe os ot ou oj b">/pages/company/[id].js</code>中，在文件末尾添加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Working with</figcaption></figure><ul class=""><li id="85db" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第2行:提取<code class="fe os ot ou oj b">params</code>属性以从URL获取参数。</li><li id="889e" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第3行:从URL中提取<code class="fe os ot ou oj b">id</code>参数。</li><li id="abdb" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第4行:执行GraphQL查询，从特定公司获取<code class="fe os ot ou oj b">phone</code>字段。</li><li id="6816" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第15行:在这里，我们将<code class="fe os ot ou oj b">id</code>分类为一个参数，它将告诉GraphQL参考哪个公司。</li><li id="6b5b" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第20行:通过props将获取的数据发送给我们的React组件。</li></ul><p id="0d1b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经获取了数据，最后一步是实际显示它。为此，首先找到您的<code class="fe os ot ou oj b">PhoneList</code>组件声明:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="35c9" class="nv ml iq oj b gy on oo l op oq">export default function PhoneList() {<br/>  //further code..</span></pre><p id="ea05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="ecf9" class="nv ml iq oj b gy on oo l op oq">export default function PhoneList({ data }) {</span></pre><p id="481e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，找到您的<code class="fe os ot ou oj b">return</code>块:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="04d9" class="nv ml iq oj b gy on oo l op oq">return (<br/>  &lt;div&gt;<br/>    &lt;h1&gt; List of phones&lt;/h1&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="f809" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="1846" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第4行:由于<code class="fe os ot ou oj b">data</code>是一个数组，我们可以使用<code class="fe os ot ou oj b">map</code>方法。</li><li id="e1f5" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第6行:单击时，将用户重定向到<code class="fe os ot ou oj b">/phone/{id}</code> route，其中<code class="fe os ot ou oj b">id</code>是电话的ID。</li><li id="2fa8" class="nh ni iq ky b kz nq lc nr lf ns lj nt ln nu lr nm nn no np bi translated">第7行:显示手机名称。</li></ul><p id="07ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将产生以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/1aa84005d2c6e41882f5253f82c9965d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Z7yvAc9HAbHePeRClpfdpQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="ab54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在下一节中，您将最终在相应的页面上显示手机数据。</p><p id="540e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">不过，在继续之前，我建议您稍微休息一下，或者进一步研究一下代码。</p><p id="1f89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">/pages/company/index.js</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="7060" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而<code class="fe os ot ou oj b">pages/company/[id].js</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><h2 id="5961" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">使用电话表</h2><p id="5794" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">当客户端导航到<code class="fe os ot ou oj b">/phone</code>页面时，他应该会看到所有可用电话的列表。</p><p id="1ed0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，转到您的<code class="fe os ot ou oj b">/pages/phone/index.js</code>文件，开始编写以下代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="c8f9" class="nv ml iq oj b gy on oo l op oq">import { gql } from "@apollo/client";<br/>import client from "../../helpers/apollo-client";<br/>import Link from "next/link";</span><span id="88ba" class="nv ml iq oj b gy po oo l op oq">export default function AllPhones() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;List of all phones&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="9b83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您需要获取数据库中所有可用电话的列表。为此，请在文件末尾编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="aeb2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这段代码中，我们执行了一个查询来获取数据库中所有电话的<code class="fe os ot ou oj b">id</code>和<code class="fe os ot ou oj b">name</code>字段。最后在<code class="fe os ot ou oj b">Line 13</code>上，我们将数据作为道具发送，这样我们就可以将它们展示给用户。</p><p id="44d9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经从Keystone获取了结果，剩下的工作就是将它们显示到UI上。</p><p id="5fbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">找到您的<code class="fe os ot ou oj b">AllPhones</code>功能组件声明:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="c311" class="nv ml iq oj b gy on oo l op oq">export default function AllPhones() {<br/>  //further code..</span></pre><p id="4ba7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="8e7f" class="nv ml iq oj b gy on oo l op oq">export default function AllPhones({ data }) {<br/>  //further code...</span></pre><p id="01af" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，找到你的<code class="fe os ot ou oj b">return</code>块:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="15ab" class="nv ml iq oj b gy on oo l op oq">return (<br/>  &lt;div&gt;<br/>    &lt;h1&gt;List of all phones&lt;/h1&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="257b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="9db5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将是结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mc"><img src="../Images/7a7cc03c9536e4568c2d21e269b24280.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*UXK_uMHlkJjc0tdQbD-xsQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="a0d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的代码运行良好。现在是时候显示每部手机的数据了。</p><p id="b3bc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">转到<code class="fe os ot ou oj b">/pages/phone/[id].js</code>，从创建一个基本的React组件开始:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><ul class=""><li id="5c60" class="nh ni iq ky b kz la lc ld lf nj lj nk ln nl lr nm nn no np bi translated">第4行:我们还导入了<code class="fe os ot ou oj b">DocumentRenderer</code>,因为Keystone需要它来呈现文档字段。</li></ul><p id="6ed1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在获取数据之前，Next.js要求您使用<code class="fe os ot ou oj b">getStaticPaths</code>方法生成静态路径。为此，请在文件末尾追加以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="0cb4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个代码类似于<code class="fe os ot ou oj b">company/[id].js</code>的代码。我们已经从<code class="fe os ot ou oj b">Phone</code>项中提取了<code class="fe os ot ou oj b">id</code>字段，然后将它们作为路径发送到Next.js。稍后，Next.js将使用静态渲染来构建这些路径。</p><p id="4f9b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您需要使用<code class="fe os ot ou oj b">getStaticProps</code>函数从服务器获取<code class="fe os ot ou oj b">Phone</code>数据。为此，请编写以下代码:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="737d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该功能与<code class="fe os ot ou oj b">/company/[id].js</code>类似。注意，在<code class="fe os ot ou oj b">Line 10</code>上，我们还提取了<code class="fe os ot ou oj b">document</code>字段。这包含了我们想要得到的电话的描述。</p><p id="1e7d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，您现在必须显示数据。找到您的<code class="fe os ot ou oj b">PhoneData</code>组件声明:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="af6a" class="nv ml iq oj b gy on oo l op oq">export default function PhoneData() {</span></pre><p id="ea36" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="58eb" class="nv ml iq oj b gy on oo l op oq">export default function PhoneData({ data }) {</span></pre><p id="6e3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在您已经引入了<code class="fe os ot ou oj b">data</code>道具，是时候在您的组件中显示它了。</p><p id="489f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">找到你的<code class="fe os ot ou oj b">return</code>块:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="2276" class="nv ml iq oj b gy on oo l op oq">return (<br/>  &lt;div&gt;<br/>    &lt;h1&gt;Phone name: &lt;/h1&gt;<br/>)</span></pre><p id="e476" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">像这样改变它:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="fb1c" class="nv ml iq oj b gy on oo l op oq">return (<br/>  &lt;div&gt;<br/>    &lt;h1&gt;Phone name: {data.name}&lt;/h1&gt;<br/>    &lt;h2&gt;Description:&lt;/h2&gt;<br/>    &lt;DocumentRenderer document={data.document.document} /&gt;<br/>  &lt;/div&gt;<br/>);</span></pre><p id="c21f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这一次，我们使用了<code class="fe os ot ou oj b">DocumentRenderer</code>组件来呈现我们的<code class="fe os ot ou oj b">Phone</code>项的文档字段。</p><p id="1e8f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们完事了。再次运行代码。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pp"><img src="../Images/18123df5204043df128cdd9e26a81850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tBcQJW41YUOczzBRA6IChQ.gif"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Output of the code</figcaption></figure><p id="8c0d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，我们的文档字段呈现得很好，这意味着我们的前端可以正确处理富文本。</p><p id="516e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文的下一部分，您将学习如何通过环境变量保护您的应用程序。</p><p id="50c7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，<code class="fe os ot ou oj b">pages/phone/index.js</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure><p id="f2ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">而<code class="fe os ot ou oj b">pages/phone/[id].js</code>应该是这样的:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ov ow l"/></div></figure></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="bbeb" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">安全措施</h1><h2 id="d124" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">环境变量</h2><p id="327f" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">转到您前端的项目代码。注意在<code class="fe os ot ou oj b">/helpers/apollo-client.js</code>中，您的GraphQL端点是公开的:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="5b8e" class="nv ml iq oj b gy on oo l op oq">const client = new ApolloClient({<br/><strong class="oj ir">  uri: "http://localhost:3000/api/graphql"</strong>,<br/>  //further code..</span></pre><p id="3804" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为您的应用程序没有投入生产，所以这是可以的。然而，如果你的服务器在网上，这将导致严重的问题。</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="8c56" class="nv ml iq oj b gy on oo l op oq">//if in production, this is NOT OK<br/>const client = new ApolloClient({<br/><strong class="oj ir">  uri: "https://mykeystone.com/api/graphql"</strong>,<br/>  //further code..</span></pre><p id="880b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这会通过向Keystone服务器发送垃圾请求导致DOS攻击。让我们通过环境变量来缓解这个问题。</p><p id="f5cf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此，首先，在项目中创建一个<code class="fe os ot ou oj b">.env.local</code>文件，如下所示:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="482f" class="nv ml iq oj b gy on oo l op oq">CONNECT_URI = https://mykeystone.com/api/graphql</span></pre><p id="378d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后告诉Apollo使用您的环境变量:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="2fa6" class="nv ml iq oj b gy on oo l op oq">//good to go!<br/>const client = new ApolloClient({<br/><strong class="oj ir">  uri: process.env.CONNECT_URI</strong>,<br/>  //further code..</span></pre><p id="d860" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们的后端代码也有缺陷。在Keystone服务器的代码中，找到<code class="fe os ot ou oj b">keystone.ts</code>文件。在那里，找到以下代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="ecd0" class="nv ml iq oj b gy on oo l op oq">db: {<br/>adapter: "prisma_postgresql",<br/><strong class="oj ir">url: process.env.DATABASE_URL || "postgres://db://",</strong><br/>},<br/>//further code...</span></pre><p id="66d1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于我们的数据库在云中，我们需要隐藏它。首先，用下面的终端命令安装<code class="fe os ot ou oj b">dotenv</code>:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="be26" class="nv ml iq oj b gy on oo l op oq">npm install dotenv</span></pre><p id="f35c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe os ot ou oj b">keystone.ts</code>的开头，写下下面的代码:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="3b77" class="nv ml iq oj b gy on oo l op oq">require("dotenv").config(); //env vars are now exposed.</span></pre><p id="8275" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在，您可以在项目中使用环境变量。在您的<code class="fe os ot ou oj b">.env</code>文件中，添加您的连接字符串:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="1c40" class="nv ml iq oj b gy on oo l op oq">DATABASE_URL = postgres://dbURL</span></pre><p id="bd69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最后，移除<code class="fe os ot ou oj b">keystone.ts</code>中的连接字符串:</p><pre class="kg kh ki kj gt oi oj ok ol aw om bi"><span id="0f69" class="nv ml iq oj b gy on oo l op oq">//connection string is now blank! This is okay. <br/>db: {<br/>adapter: "prisma_postgresql",<br/>url: process.env.DATABASE_URL <strong class="oj ir">||</strong> <strong class="oj ir">""</strong>,<br/>},</span></pre></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="e567" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">额外资源</h1><h2 id="3a48" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">GitHub知识库</h2><ul class=""><li id="ac8f" class="nh ni iq ky b kz nc lc nd lf pq lj pr ln ps lr nm nn no np bi translated"><a class="ae kv" href="https://github.com/HussainArif12/keystone-tutorial" rel="noopener ugc nofollow" target="_blank">这里是这个项目的源代码</a></li></ul><h2 id="bc49" class="nv ml iq bd mm nw nx dn mq ny nz dp mu lf oa ob mw lj oc od my ln oe of na og bi translated">进一步阅读</h2><ul class=""><li id="d7fb" class="nh ni iq ky b kz nc lc nd lf pq lj pr ln ps lr nm nn no np bi translated"><a class="ae kv" href="https://next.keystonejs.com/" rel="noopener ugc nofollow" target="_blank"> Keystone下一个文档</a></li></ul></div><div class="ab cl md me hu mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ij ik il im in"><h1 id="0bf5" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">结论</h1><p id="9c44" class="pw-post-body-paragraph kw kx iq ky b kz nc jr lb lc nd ju le lf ne lh li lj nf ll lm ln ng lp lq lr ij bi translated">Keystone Next使用起来绝对轻松。构建表和实现它们之间的关系就像在公园散步一样简单。此外，使用库中的文档字段意味着用户可以编写丰富的文本，这意味着它是一个多功能的软件。</p><p id="b32b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您有任何困惑，我建议您查看代码示例来理解这些概念。</p><p id="c3d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">非常感谢你坚持到最后！</p><p id="94ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="pt">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="pt">plain English . io</em></a></p></div></div>    
</body>
</html>