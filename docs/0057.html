<html>
<head>
<title>How to Create Read-Only Role in MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在MongoDB中创建只读角色</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-read-only-role-in-mongodb-b92efe7f1d43?source=collection_archive---------14-----------------------#2021-01-04">https://javascript.plainenglish.io/how-to-create-read-only-role-in-mongodb-b92efe7f1d43?source=collection_archive---------14-----------------------#2021-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a3305a7a8466e09d9cf405c2a7de06e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sghmAdq3IoifkNBx"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@luizabraun?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luiza Braun</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="21ad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这篇文章讨论了如何在MongoDB数据库中创建一个只读角色。事不宜迟，我们开始吧。</p><h1 id="e6d1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">方案</h1><p id="2f58" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">假设您是一名DevOps工程师或后端团队的团队领导，通常这些角色是授予数据库访问权限的角色。</p><p id="e9e1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有两个新雇用的开发人员刚刚加入您的团队，管理层决定只提供对暂存环境中数据库的读访问权限，以便简化调试工作流。我们姑且称他们为开发者A和开发者b吧。</p><p id="bc6f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里是可用的Mongo数据库列表。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/2a62f4603aaf959850525f774de2ebd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*5U_7BX5CYV6XbZa3q9lCTw.png"/></div></figure><p id="6b03" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们总结一下这个场景，并将其分成两个教程。</p><p id="4d97" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">方法1 —为开发人员a创建一个对<strong class="kf ir">客户端</strong>数据库具有只读访问权限的用户。</p><p id="dad7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">方法2 —为开发人员B创建一个对所有数据库具有只读访问权限的用户</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="2d08" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated">方法1</h1><p id="aadf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">首先，我们必须创建一个用户来访问数据库。尽管您可以在任何数据库中创建用户。但是我建议在<strong class="kf ir">管理</strong>数据库中创建所有用户，这样更容易管理。因此，在未来，您可以雇佣一名数据库管理员，您只需授予他访问管理数据库的权限，这样他就可以帮助您管理数据库用户角色的创建，而无需公开任何其他数据库。</p><p id="a1d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本教程中，我们将使用Mongo Shell来创建用户。</p><pre class="mf mg mh mi gt mv mw mx my aw mz bi"><span id="aac2" class="na lc iq mw b gy nb nc l nd ne">use admin; // Make sure we go to the admin database </span><span id="5fa1" class="na lc iq mw b gy nf nc l nd ne">// Create devA user and read access only to client DB. db.createUser({ <br/>  user: "devA", <br/>  pwd: "devA",<br/>  roles: [ { role: "read", db: "client" } ] <br/>});</span></pre><p id="3bb7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用上面简单的命令，我们现在将拥有一个对客户端数据库只有读取权限的<strong class="kf ir"> devA </strong>用户，您可以在下面的屏幕截图中看到该用户已成功添加。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/c468a50d4c7a9394c3f424c102511f71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VoqIgxdSXP4hHHBYixw-w.png"/></div></div></figure><p id="cdc8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们用MongoDB Compass来验证一下。下面的截图显示，我们正在尝试使用新创建的用户<strong class="kf ir">“devA”连接到数据库。</strong></p><ul class=""><li id="f7cd" class="nh ni iq kf b kg kh kk kl ko nj ks nk kw nl la nm nn no np bi translated">我们只能看到<strong class="kf ir">客户端</strong>数据库，尽管总共有5个数据库。</li><li id="e45c" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">试图创建一个集合，得到一个“未授权”的错误，这正是我们想要的。只读访问。</li></ul><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nv"><img src="../Images/d295f958a6437dac1529062a89cf3e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frkb9AZvsTneM8YzfcunvQ.png"/></div></div></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nw"><img src="../Images/b87d3579b21887f7b1aaa117802a4f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6zdPS__Km9EubbP7ZwnVA.png"/></div></div></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/cdd3889679080e6564ebaefd3fc57e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IM0zs52Spe6gbO5LMw_B4A.png"/></div></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="5c94" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated">方法2</h1><p id="6951" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">本教程比你想象的要简单得多。有一个名为<strong class="kf ir"> readAnyDatabase </strong>的内置角色，您可以在其中授予用户</p><pre class="mf mg mh mi gt mv mw mx my aw mz bi"><span id="e315" class="na lc iq mw b gy nb nc l nd ne">use admin; // Make sure we go to the admin database</span><span id="cbe6" class="na lc iq mw b gy nf nc l nd ne">// Create devB user and provide read access all of the DB.<br/>db.createUser({<br/>  user: "devB",<br/>  pwd: "devB",<br/>  roles: ["readAnyDatabase"]<br/>});</span></pre><p id="2866" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在让我们验证一下新添加的用户，<strong class="kf ir"> devB </strong>可以访问所有的数据库。从下面的截图中，我们可以看到<strong class="kf ir"> devB </strong>对所有数据库都有只读访问权限，创建新记录也被禁止。</p><p id="28f2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从MongoDB 3.4开始，readAnyDatabase不再提供对<strong class="kf ir">本地</strong>和<strong class="kf ir">配置</strong>数据库的读访问。</p><blockquote class="ny"><p id="4744" class="nz oa iq bd ob oc od oe of og oh la dk translated">在除了<code class="fe oi oj ok mw b">local</code>和<code class="fe oi oj ok mw b">config</code>之外的所有数据库上提供与<code class="fe oi oj ok mw b"><a class="ae kc" href="https://docs.mongodb.com/manual/reference/built-in-roles/#read" rel="noopener ugc nofollow" target="_blank">read</a></code>相同的只读权限。该角色还在整个集群上提供<code class="fe oi oj ok mw b"><a class="ae kc" href="https://docs.mongodb.com/manual/reference/privilege-actions/#listDatabases" rel="noopener ugc nofollow" target="_blank">listDatabases</a></code>操作。— MongoDB <a class="ae kc" href="https://docs.mongodb.com/manual/reference/built-in-roles/#readAnyDatabase" rel="noopener ugc nofollow" target="_blank">文档</a></p></blockquote><figure class="om on oo op oq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ol"><img src="../Images/15f7cbaebc729c68a8a847412c4f4c08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exUtZl71za4fjeDSjwcaVA.png"/></div></div></figure><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi or"><img src="../Images/57f8ee7cf516b5012a63cd48225c4583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-E4pNsaRPSVC82wleNsdwA.png"/></div></div></figure></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><h1 id="e5dd" class="lb lc iq bd ld le mq lg lh li mr lk ll lm ms lo lp lq mt ls lt lu mu lw lx ly bi translated">结论</h1><p id="0c1c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">简而言之，这篇文章讨论了两种不同的场景:</p><ul class=""><li id="903c" class="nh ni iq kf b kg kh kk kl ko nj ks nk kw nl la nm nn no np bi translated">创建对指定数据库的只读访问</li><li id="1f1f" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">创建除本地数据库<strong class="kf ir">和配置数据库</strong>之外的所有数据库的只读访问权限。</li></ul><p id="c65a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">感谢您的阅读，下一篇文章再见。</p><h1 id="d9ff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考</h1><ul class=""><li id="9cf2" class="nh ni iq kf b kg lz kk ma ko os ks ot kw ou la nm nn no np bi translated">MongoDB createUser手册<a class="ae kc" href="https://docs.mongodb.com/manual/reference/method/db.createUser/" rel="noopener ugc nofollow" target="_blank">参考</a></li><li id="6055" class="nh ni iq kf b kg nq kk nr ko ns ks nt kw nu la nm nn no np bi translated">用于<a class="ae kc" href="https://docs.mongodb.com/manual/reference/built-in-roles/" rel="noopener ugc nofollow" target="_blank">内置角色</a>的MongoDB手册</li></ul></div></div>    
</body>
</html>