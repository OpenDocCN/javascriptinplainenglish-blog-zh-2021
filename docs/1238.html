<html>
<head>
<title>Globalize Variables in a Node.js App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js应用程序中全球化变量</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/globalize-variables-in-nodejs-application-f782f52deffe?source=collection_archive---------17-----------------------#2021-03-15">https://javascript.plainenglish.io/globalize-variables-in-nodejs-application-f782f52deffe?source=collection_archive---------17-----------------------#2021-03-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e889" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">全球化js变量可能不合适，对于常见用例应该最小化。在本文中，我们将展示一些关于全球化变量的问题，另一方面，这种方法的必要性，以及编写全球化函数和它的一些实施的例子。</h2><div class=""/><div class=""><h2 id="3408" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">全球化变量一次，初始化后就一直使用</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/2f0b8a987b097f033244062da98b4b4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fVjQTWyGBxI_fEj7aKAVg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image Credit: <a class="ae le" href="https://unsplash.com/@cferdo" rel="noopener ugc nofollow" target="_blank">Fernando @cferdo</a></figcaption></figure><h1 id="be6d" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">JavaScript中全球化变量带来了问题</h1><p id="0b8f" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">在我们的应用程序中编写全局变量增加了被第三方脚本或插件覆盖的机会。应用程序可能会出现错误行为，有问题的功能会介入。</p><p id="3632" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">因此，在全球化变量时，我们应该尽量避免通用的变量名。避免常见的变量名:</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="09df" class="nd lg iq mz b gy ne nf l ng nh">result, data, info, gInfo etc.</span></pre><p id="0f9f" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">我们应该总是初始化一个局部变量，而不是直接使用它。</p><blockquote class="ni nj nk"><p id="ebfa" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">代替</p></blockquote><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="ee2d" class="nd lg iq mz b gy ne nf l ng nh">function scoring(point) {<br/>  return existing + point<br/>}</span></pre><blockquote class="ni nj nk"><p id="c2fb" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">我们应该这样做</p></blockquote><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="fab7" class="nd lg iq mz b gy ne nf l ng nh"><strong class="mz ja">var existing = 0; </strong></span><span id="c6e1" class="nd lg iq mz b gy np nf l ng nh">function scoring(point) {<br/>  return existing + point<br/>}</span></pre><h1 id="21c4" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">但是，为什么我们有时需要全球化的变量呢？</h1><ul class=""><li id="61ab" class="nq nr iq lz b ma mb md me mg ns mk nt mo nu ms nv nw nx ny bi translated">提高效率</li><li id="0d93" class="nq nr iq lz b ma nz md oa mg ob mk oc mo od ms nv nw nx ny bi translated">减少多余的线路</li><li id="4518" class="nq nr iq lz b ma nz md oa mg ob mk oc mo od ms nv nw nx ny bi translated">用于调试用途</li></ul><h2 id="2408" class="nd lg iq bd lh oe of dn ll og oh dp lp mg oi oj lr mk ok ol lt mo om on lv iw bi translated">提高效率</h2><p id="bac6" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">变量在项目范围内自动可用。函数<strong class="lz ja"> globfunc </strong>在项目范围内的其他脚本中自动可用。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="eeba" class="nd lg iq mz b gy ne nf l ng nh">// NodeProject/src/index.js</span><span id="5b86" class="nd lg iq mz b gy np nf l ng nh"><strong class="mz ja">const globfunc = () =&gt; {<br/>  alert("Accessile Globally !!")<br/>}</strong></span><span id="ea2f" class="nd lg iq mz b gy np nf l ng nh"><strong class="mz ja">global.globfunc = globfunc</strong></span><span id="60a0" class="nd lg iq mz b gy np nf l ng nh">...<br/>...</span><span id="a725" class="nd lg iq mz b gy np nf l ng nh"><strong class="mz ja">// Run the server!</strong><br/>const start = async () =&gt; {<br/>  try {<br/>    app.listen(3000, function() {<br/>      console.log("listening on port 3000!");<br/>    });<br/>  } catch (err) {<br/>    console.log("error");<br/>}};</span><span id="5701" class="nd lg iq mz b gy np nf l ng nh">start();</span></pre><h2 id="75e0" class="nd lg iq bd lh oe of dn ll og oh dp lp mg oi oj lr mk ok ol lt mo om on lv iw bi translated">减少多余的线路</h2><p id="52b8" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">由于上述原因，相同的函数“<strong class="lz ja"> globfunc”不需要import / require </strong>行来使其在项目范围内的另一个脚本中可用。</p><blockquote class="ni nj nk"><p id="fb68" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">另一个场景:</p></blockquote><p id="e7bd" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">通过从浏览器的控制台部分执行<strong class="lz ja"> I18n </strong>变量，可以进行快速测试。</p><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="77c9" class="nd lg iq mz b gy ne nf l ng nh">import I18n from 'I18n-js'</span><span id="9381" class="nd lg iq mz b gy np nf l ng nh"><strong class="mz ja">global.I18n = I18n</strong></span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oo"><img src="../Images/71bdeb1e3a5a9eeb14456aba3a7a124c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SgefIT9IRbPFBcKKTm3uLQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Self-Shot Console for <strong class="bd op">I18n</strong></figcaption></figure><h2 id="55bf" class="nd lg iq bd lh oe of dn ll og oh dp lp mg oi oj lr mk ok ol lt mo om on lv iw bi translated">用于调试用途</h2><ul class=""><li id="102e" class="nq nr iq lz b ma mb md me mg ns mk nt mo nu ms nv nw nx ny bi translated">从控制台部分验证数据变得很容易。</li><li id="8a20" class="nq nr iq lz b ma nz md oa mg ob mk oc mo od ms nv nw nx ny bi translated">JavaScript测试框架Jest中的示例用例:</li></ul><blockquote class="ni nj nk"><p id="44b7" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">抑制控制台警告</p></blockquote><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="cd45" class="nd lg iq mz b gy ne nf l ng nh">import * as dFilters from "./test-filters"</span><span id="7d6a" class="nd lg iq mz b gy np nf l ng nh">let <strong class="mz ja">gWarn</strong></span><span id="096c" class="nd lg iq mz b gy np nf l ng nh">describe('test-filters', () =&gt; {<br/>  beforeEach(() =&gt; {<br/>    <strong class="mz ja">gWarn = global.console.warn<br/></strong>    global.console.warn = (message) =&gt; {<br/>      throw message<br/>    })<br/>  })</span><span id="2e3e" class="nd lg iq mz b gy np nf l ng nh">  afterEach(() =&gt; {<br/><strong class="mz ja">    global.console.warn = gWarn<br/></strong>  })</span><span id="d727" class="nd lg iq mz b gy np nf l ng nh">  describe('testFunction1', () =&gt; {<br/>    const { testFunction1 } = dFilters<br/>    ...<br/>    ...<br/>  })</span><span id="61fb" class="nd lg iq mz b gy np nf l ng nh">})</span></pre><h1 id="b3de" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">全球化一个Js模块怎么样？</h1><p id="396d" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我一直在使用一个简单的助手函数来全球化JS模块:</p><blockquote class="ni nj nk"><p id="1513" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">示例导出模块:<br/>NodeApp/src/helper/db _ utils . js</p></blockquote><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oq or l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">db_utils.js</figcaption></figure><blockquote class="ni nj nk"><p id="f6ea" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">NodeApp/src/helper/globalize . js</p></blockquote><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oq or l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">globalize.js</figcaption></figure><blockquote class="ni nj nk"><p id="8b06" class="lx ly nl lz b ma mt ka mc md mu kd mf nm mv mi mj nn mw mm mn no mx mq mr ms ij bi translated">从NodeApp/src/index.js实现</p></blockquote><pre class="kp kq kr ks gt my mz na nb aw nc bi"><span id="19d4" class="nd lg iq mz b gy ne nf l ng nh"><strong class="mz ja">global["globalize"] = require("./helper/globalize");<br/>const dbHelper = require("./helper/db_utils");<br/>globalize(dbHelper);</strong></span><span id="a4b9" class="nd lg iq mz b gy np nf l ng nh">...<br/>...</span><span id="c53e" class="nd lg iq mz b gy np nf l ng nh">// Run the server!</span><span id="6d10" class="nd lg iq mz b gy np nf l ng nh">const start = async () =&gt; {<br/>  try {<br/>    app.listen(3000, function() {<br/>    console.log("listening on port 3000!");<br/>  });<br/>  } catch (err) {<br/>    console.log("error");<br/>  }<br/>};</span><span id="e52a" class="nd lg iq mz b gy np nf l ng nh">start();</span></pre><p id="bb72" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">就是这样。有了上面的三行代码，函数<strong class="lz ja"> dbGetAll </strong>、<strong class="lz ja"> dbGetOne </strong>、<strong class="lz ja"> dbCreate、</strong>和<strong class="lz ja"> dbUpdate </strong>现在可以全局访问，并且现在可以在项目范围内的任何地方使用！具体实现请参考文章:<strong class="lz ja"/><a class="ae le" href="https://seanpang.medium.com/what-you-can-do-to-standardize-the-crud-calls-to-mongo-in-nodejs-7b4c569488e6" rel="noopener"><strong class="lz ja">你能做些什么来规范NodeJS </strong> </a>中对Mongo的CRUD调用。</p></div><div class="ab cl os ot hu ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="ij ik il im in"><h1 id="641d" class="lf lg iq bd lh li oz lk ll lm pa lo lp kf pb kg lr ki pc kj lt kl pd km lv lw bi translated">结论</h1><p id="0650" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">变量的全球化有利有弊。这些问题在本文中有所解释，你应该对应用程序由于全局变量而导致的漏洞采取额外的预防措施。</p><p id="14b7" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">明智的做法是对关键操作进行进一步的权限检查和访问。</p><p id="2a6a" class="pw-post-body-paragraph lx ly iq lz b ma mt ka mc md mu kd mf mg mv mi mj mk mw mm mn mo mx mq mr ms ij bi translated">感谢您的阅读。我希望您发现这很有用！</p></div></div>    
</body>
</html>