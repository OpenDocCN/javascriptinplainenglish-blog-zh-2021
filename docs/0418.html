<html>
<head>
<title>Fetching Data With UseEffect in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中使用UseEffect提取数据</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/fetching-data-with-useeffect-in-react-604ed53edffe?source=collection_archive---------9-----------------------#2021-01-25">https://javascript.plainenglish.io/fetching-data-with-useeffect-in-react-604ed53edffe?source=collection_archive---------9-----------------------#2021-01-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="066f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过真实的例子了解React UseEffect。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/de9af38d5ab74c454a62f51ad719df7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*98jGJXoNOKlhFhR3LkBVLg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image created with ❤️️ By <a class="ae kv" href="https://mehdiouss315.medium.com/" rel="noopener">author.</a></figcaption></figure><h1 id="5df2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="1041" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">React提供了一系列挂钩，允许您向组件添加特性。这些钩子是JavaScript函数，你可以从React包中导入，UseState和UseEffect是你应该知道的重要函数。</p><p id="3172" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，我们将了解React中的UseEffect挂钩，以及如何使用它从API获取数据。让我们开始吧。</p><h1 id="28a3" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">钩子的使用效果是什么？</h1><p id="5776" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">React中的钩子<code class="fe mp mq mr ms b">useEffect()</code>让我们在处理功能组件时执行有用的操作，比如从API获取数据或处理DOM。</p><p id="3ecd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">钩子<code class="fe mp mq mr ms b">useEffect()</code>接受一个回调函数，这个函数默认情况下会在每次重新渲染和组件挂载时运行。</p><p id="f81c" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了使用钩子<code class="fe mp mq mr ms b">useEffect</code>，你必须首先从React包中导入它。</p><p id="916e" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="a09d" class="mx kx iq ms b gy my mz l na nb">import React, <strong class="ms ir">{ useEffect }</strong> from 'react';</span></pre><p id="c15f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在你可以毫无问题地在你的代码上使用钩子了。看看下面的例子:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="2152" class="mx kx iq ms b gy my mz l na nb"><strong class="ms ir">useEffect</strong>(<strong class="ms ir">()=&gt;{</strong><br/>  document.body.style.background = "blue";<br/><strong class="ms ir">}</strong>);</span></pre><p id="3de9" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">正如你在上面看到的，函数<code class="fe mp mq mr ms b">useEffect</code>将一个回调函数作为它的第一个参数，它将在每次重新渲染时运行。它将主体的背景设置为蓝色。</p><p id="0b17" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">为了避免在每次渲染后执行效果回调，我们提供了第二个参数，一个空数组:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="a863" class="mx kx iq ms b gy my mz l na nb"><strong class="ms ir">useEffect</strong>(<strong class="ms ir">()=&gt;{</strong><br/>  document.body.style.background = "blue";<br/><strong class="ms ir">},[]</strong>);</span></pre><p id="e3cd" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">这告诉<code class="fe mp mq mr ms b">useEffect</code>只在坐骑上运行一次。</p><h1 id="e3f7" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">使用UseEffect提取数据</h1><p id="42ed" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钩子<code class="fe mp mq mr ms b">useEffect</code>的另一个用例是从API获取数据。我们将使用这个钩子从Github用户API获取数据。</p><p id="7c44" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">Github用户API给了我们该网站前30名用户的名单。我们将尝试使用promises ( <code class="fe mp mq mr ms b">.then()</code>)通过钩子<code class="fe mp mq mr ms b">useEffect</code>获取这些用户的登录信息。</p><p id="f6e7" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">看看下面的例子:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="d54e" class="mx kx iq ms b gy my mz l na nb">import React , { <strong class="ms ir">useState , useEffect</strong> } from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="a9c8" class="mx kx iq ms b gy nc mz l na nb"><br/>const App = ()=&gt;{<br/> <em class="nd">// The API URL.<br/> </em>const APIurl = 'https://api.github.com/users';</span><span id="0e47" class="mx kx iq ms b gy nc mz l na nb"><em class="nd">// useState.<br/> </em>const [users, setUsers] = <strong class="ms ir">useState([])</strong>;</span><span id="3289" class="mx kx iq ms b gy nc mz l na nb"><em class="nd">// useEffect.<br/> </em>useEffect(()=&gt;{<br/>  fetch(APIurl)<br/>   .then(<strong class="ms ir">res</strong> =&gt; <strong class="ms ir">res.json()</strong>)<br/>   .then(<strong class="ms ir">data</strong> =&gt; <strong class="ms ir">setUsers(data)</strong>);<br/>},[]);</span><span id="7a94" class="mx kx iq ms b gy nc mz l na nb">return(<br/>&lt;&gt;<br/> &lt;ul&gt;</span><span id="e32c" class="mx kx iq ms b gy nc mz l na nb"> {users.<strong class="ms ir">map</strong>(user =&gt; (<br/>  <strong class="ms ir">&lt;li key={user.id}&gt;{user.login}&lt;/li&gt;</strong><br/> ))}</span><span id="e695" class="mx kx iq ms b gy nc mz l na nb"> &lt;/ul&gt;<br/>&lt;/&gt;<br/>)<br/>}</span><span id="13ef" class="mx kx iq ms b gy nc mz l na nb"><em class="nd">// Rendering the component with the render method.<br/></em>ReactDOM.render(<br/> &lt;App /&gt;,<br/> document.getElementById('root')<br/>);</span></pre><p id="2e73" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nd">输出:</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8f9eabdfb5859f02e8a652f05e2e5faf.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*bm98NPbLmH_mBcBUUzihUg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">We get the first 30 users' login lists.</figcaption></figure><p id="871f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">也可以用async/await代替promises。但是请注意，用async/await语法处理承诺需要创建一个单独的函数，因为效果回调不能是异步的。</p><p id="0e8b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">下面是使用async/await的同一个示例:</p><pre class="kg kh ki kj gt mt ms mu mv aw mw bi"><span id="0de2" class="mx kx iq ms b gy my mz l na nb">import React , { useState , useEffect } from 'react';<br/>import ReactDOM from 'react-dom';</span><span id="2170" class="mx kx iq ms b gy nc mz l na nb">const App = ()=&gt;{<br/>// The API URL.<br/>  const APIurl = '<a class="ae kv" href="https://api.github.com/users'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/users'</a>;</span><span id="1697" class="mx kx iq ms b gy nc mz l na nb">// useState.<br/>  const [users, setUsers] = useState([]);</span><span id="c4c9" class="mx kx iq ms b gy nc mz l na nb">// useEffect.<br/>  <strong class="ms ir">useEffect</strong>(()=&gt;{<br/>    <strong class="ms ir">getUser()</strong>;}<br/>    ,[]);</span><span id="b0a3" class="mx kx iq ms b gy nc mz l na nb">// Separate function.<br/>  <strong class="ms ir">async</strong> function <strong class="ms ir">getUser</strong>() {<br/>    const response = <strong class="ms ir">await</strong> fetch(APIurl);<br/>    const data = <strong class="ms ir">await</strong> response.json();<br/>    <strong class="ms ir">setUsers</strong>(data);<br/>  }</span><span id="1259" class="mx kx iq ms b gy nc mz l na nb">return(<br/>    &lt;&gt;<br/>    &lt;ul&gt;<br/>      {users.map(user =&gt; (<br/>        &lt;li key={user.id}&gt;{user.login}&lt;/li&gt;<br/>      ))}<br/>    &lt;/ul&gt;<br/>    &lt;/&gt;<br/>  )<br/>}</span><span id="eae9" class="mx kx iq ms b gy nc mz l na nb">// Rendering the component with the render method.<br/>ReactDOM.render(<br/>  &lt;App /&gt;,<br/>  document.getElementById('root')<br/>);</span></pre><p id="2bf5" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如你所见，这就是你如何用<code class="fe mp mq mr ms b">useEffect().</code>获取数据</p><h1 id="9521" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">结论</h1><p id="e8c9" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钩子<code class="fe mp mq mr ms b">useEffect</code>是你必须知道的重要且有用的React钩子之一。而且这个钩子基本上是给功能组件添加特性和执行效果。我鼓励你练习更多的例子，因为这是变得更好的唯一方法。</p><p id="08ca" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">感谢您阅读本文，希望您觉得有用。</p><h1 id="6d04" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">更多阅读</h1><p id="56b5" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><em class="nd">如果你对JavaScript和web开发相关的更有用的内容感兴趣，也可以</em> <a class="ae kv" href="https://mehdiouss.ck.page/" rel="noopener ugc nofollow" target="_blank"> <em class="nd">订阅</em> </a> <em class="nd">我的快讯。</em></p><p id="56e2" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated"><em class="nd">下面是另一篇有用的文章，请点击链接查看:</em></p><div class="nf ng gp gr nh ni"><a href="https://medium.com/javascript-in-plain-english/the-web-storage-api-in-javascript-explained-with-examples-85a5fac65155" rel="noopener follow" target="_blank"><div class="nj ab fo"><div class="nk ab nl cl cj nm"><h2 class="bd ir gy z fp nn fr fs no fu fw ip bi translated">举例说明JavaScript中的Web存储API</h2><div class="np l"><h3 class="bd b gy z fp nn fr fs no fu fw dk translated">通过示例了解JavaScript中的web存储API。</h3></div><div class="nq l"><p class="bd b dl z fp nn fr fs no fu fw dk translated">medium.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw kp ni"/></div></div></a></div></div></div>    
</body>
</html>