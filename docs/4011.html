<html>
<head>
<title>Comprehensive Functional Testing of a React &amp; Node Express App with React Test Library &amp; Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React测试库和Jest对React和Node Express应用程序进行全面的功能测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/comprehensive-functional-testing-of-a-react-node-express-app-with-react-test-library-jest-dec0df3c4ab4?source=collection_archive---------5-----------------------#2021-08-11">https://javascript.plainenglish.io/comprehensive-functional-testing-of-a-react-node-express-app-with-react-test-library-jest-dec0df3c4ab4?source=collection_archive---------5-----------------------#2021-08-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/bf210400e6368520931f8a44e0a94f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lKjRKUvngHuaVS9j"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@tvschaitanya?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chaitanya Tvs</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9c22" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用Jest进行端点API测试，用React测试库进行UI自动化测试。</p><p id="e425" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文旨在帮助您开始测试React前端和Node.js Express后端应用程序。你会意识到你不能用同样的方式测试后端和前端。这是因为UI测试需要真实的交互来测试其内容，以及由点击和键盘输入等导致的呈现变化。相比之下，后端代码需要在单个功能的小单元中进行测试。</p><p id="01f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于代码的后端测试，您需要采取两种方法，一种是代码功能和集成的实际单元测试，另一种是HTTP端点API的测试。</p><p id="59d1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将为您在低级JavaScript代码测试层面提供一个良好的开端。当然还有很多其他的测试技术可以在以后使用，比如负载测试。这篇文章的内容与我写的那本书的内容有关，这本书在亚马逊上有售，名为“<a class="ae jz" href="https://www.amazon.com/dp/0997196696" rel="noopener ugc nofollow" target="_blank">AWS中的JavaScript三层架构，包含React、Node和MongoDB </a>”</p><h1 id="6fed" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">要测试的应用概述</h1><p id="9bef" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">对于这篇文章，我真的试着做了一个最小的应用程序来尽可能容易地理解对测试有用的机制。该应用程序示例展示了购物点的电子商务购物车的用户界面。为了简单起见，没有数据库，只有购物车中产品的内部数组。用户界面如下所示。</p><figure class="mc md me mf gt jo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/89e7226dd0a53e035d3c0fbd00ed393a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*nzsQ_Gh-TOt__zB5idOtZw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Strawberry and Blackberry photos by <a class="ae jz" href="https://unsplash.com/@jruscello?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jessica Ruscello</a> on <a class="ae jz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="52b2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过UI，您可以看到购物车中有什么，选择一个交付选项(这将改变订单总数)，然后单击进行购买。</p><p id="d5b4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们先快速看一下Node Express代码。要查看的两个文件是index.js和carts.js。这是相当标准的锅炉板节点服务器代码。您可以看到React应用程序的服务以及购物车的Express API路由。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="5f41" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下一个要考虑的文件是为提供购物车内容的API处理快速路线的文件。现在，它将只包含用于处理特定购物车id的GET动词。你需要添加更多的动词来使它完全发挥作用。如前所述，顶部有一个硬编码数组。该数组包含购物车条目。当然，您可能还想为应用程序添加更多的功能，比如登录和使用JWT对路线进行身份验证。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><h1 id="3b29" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">后端节点快速HTTP API级别测试</h1><p id="ac31" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">对于API端点的测试，我们需要对服务进行实际的HTTP调用。对于如何做到这一点，您有几个选择。我将解释让我们开始的最简单的方法。您可以在本地运行Node.js服务器，或者公开运行它，然后再检查实际的IP地址和端口。一种更简单的方法是将服务器实际导入到测试代码中，并使用NPM <a class="ae jz" href="https://www.npmjs.com/package/supertest" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">超级测试</strong> </a>模块来访问服务和API端点路由。</p><p id="6108" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我们的测试代码中，我们将使用<a class="ae jz" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>。我们在package.json文件中设置了一个脚本来启动它。你只要输入<code class="fe mi mj mk ml b">npm run test-API</code>。Jest很容易使用。使用Jest，您有一个包含所有测试的<code class="fe mi mj mk ml b">describe</code>块。每个测试都有一个标题/描述和一些要运行的功能代码。当你打电话给<code class="fe mi mj mk ml b">done()</code>时，每个测试将被认为是完成的。然后设置为按顺序运行每个测试块。您可以并行运行测试。我们已经设置了<code class="fe mi mj mk ml b">runInBand</code>标志，让测试按顺序运行。我们还设置了<code class="fe mi mj mk ml b">collectCoverage true</code>标志来收集代码覆盖率数据以供查看。这是Jest将用于您的测试运行的文件。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f633" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以看到，我们有一个测试来获取一个有效的购物车，还有一个测试来确保我们捕捉到一个无效的购物车id。值得一提的是，您可以在调试器下运行VS代码中的测试代码，并在测试代码和快速路由代码上设置断点！</p><h1 id="08a0" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">后端单元级测试</h1><p id="ed72" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">单元级测试不同于API级测试。对于HTTP API，我们实际上与用户使用的完整可用端点进行了交互。在单元测试中，我们分离出一个功能或者一小段代码，然后缩小范围进行测试。这两种类型的测试都是必要的，以获得全面的覆盖，并有更好的机会在问题最终成为产品中的bug之前捕捉到它们。</p><p id="5adc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您单元测试的代码可以在Node.js Express应用程序或React应用程序中。我现在将说明React应用程序中一些代码的测试。作为React应用程序的一部分，我们需要一个函数来计算购物车中商品的价格。我们可以将该函数分离到它自己的模块中，这样我们就可以很容易地对其进行单元测试。下面的代码展示了sum模块和测试它的Jest文件。</p><pre class="mc md me mf gt mm ml mn mo aw mp bi"><span id="1fe2" class="mq kz in ml b gy mr ms l mt mu">// sum.js<br/>export default function sum() {<br/>  var s = 0;<br/>  for (var i=0; i &lt; arguments.length; i++) {<br/>      s += arguments[i];<br/>  }<br/>  return s;<br/>}</span></pre><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="293d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以看到同样使用Jest来设置测试用例。在package.json中设置了另一个脚本来运行这个特定的测试。这个可以用<code class="fe mi mj mk ml b">npm run test-react</code>运行。这是因为它包含在react项目的代码中，react脚本的使用将查找所有以“test.js”结尾的文件。</p><h1 id="dc90" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">使用React测试库进行UI自动化测试</h1><p id="a874" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">React应用相当标准。要查看的主要文件是src目录中名为index.js、App.js、cartview.js、cartItem.js和ShippingOptions.js的JavaScript文件。该应用程序使用<code class="fe mi mj mk ml b">ShippingOptions</code>和<code class="fe mi mj mk ml b">CartView</code>功能组件。<code class="fe mi mj mk ml b">CartView</code>依次使用<code class="fe mi mj mk ml b">CartItem</code>功能组件。</p><p id="29a2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将要使用的测试框架将是Jest和代表React测试库的RTL。您可以浏览下面的代码，看到它使用了相同的Jest功能，带有describe和test块。</p><p id="cefa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">RTL给了你渲染用户界面的能力。您可以使用下面的代码行— <code class="fe mi mj mk ml b">render(&lt;App cartId={777} /&gt;)</code>来实现。通过这样做，功能组件中的所有实际代码都将运行并使用虚拟DOM。这意味着应用程序被实例化，因此CartView也被实例化。与React的常规功能一样，将调用<code class="fe mi mj mk ml b">useEffect()</code>函数和网络<code class="fe mi mj mk ml b">fetch()</code>调用来检索购物车id。</p><p id="c70c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里我们利用Jest的功能，用我们自己的结果覆盖<code class="fe mi mj mk ml b">fetch()</code>调用。这是在<code class="fe mi mj mk ml b">beforeAll()</code>调用中设置的，然后在调用<code class="fe mi mj mk ml b">window.fetch.mockResolvedValueOnce()</code>中使用。这将截取底层网络调用，并返回我们想要的测试结果。</p><p id="fcc6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用由<code class="fe mi mj mk ml b">@testing-library/jest-dom/extend-expect import</code>提供的<code class="fe mi mj mk ml b">expect()</code>调用来完成大量的结果测试。我们使用screen对象来查找要测试和交互的UI元素。你可以看到几个测试价值的例子。单击单选按钮来更改运输选择，然后验证是否计算了正确的订单总额。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="68ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">该测试可以使用<code class="fe mi mj mk ml b">npm run test-react</code>运行。还要注意，这里使用了await，因为在代码开始运行时，UI正在呈现，我们需要等待某个UI元素出现。另一种方法是设置计时器的使用，但这肯定没有那么有效。</p><p id="f1d1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mv">注意:要查看代码覆盖率报告，请转到</em> <code class="fe mi mj mk ml b"><em class="mv">coverage/lcov-report</em></code> <em class="mv">目录并打开index.html文件。在这个屏幕上，您可以点击一个文件并深入到源代码中来查看实际的代码行覆盖率。</em></p><h1 id="6360" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">结论</h1><p id="b095" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">任何React和Node.js项目都必然需要多种测试方法。Jest是一个很好的框架，它充当了每一种不同类型测试的启动点。在单元测试和API测试的情况下，只有Jest的使用。在UI自动化测试的情况下，它与React测试库框架结合使用。</p><p id="90aa" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">关于这些框架中的每一个，都有更多的东西需要学习，我鼓励您从这些基础知识开始，然后继续学习更有经验的用法。我包含的GitHub代码有一些额外的更高级的测试用法和一些建议(在代码注释中)供您考虑。我也鼓励你去看看我写的那本书，它实际上是三本合二为一的书，其中有一部分专门讨论React开发"<a class="ae jz" href="https://www.amazon.com/dp/0997196696" rel="noopener ugc nofollow" target="_blank">AWS中的JavaScript三层架构，包括React、Node和MongoDB </a>"。也在我的<a class="ae jz" href="https://www.youtube.com/channel/UCZpDsJis8EqdNHgdMCtrePQ" rel="noopener ugc nofollow" target="_blank"> YouTube频道</a>中有所涉及。</p><p id="fb49" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mv">注意:</em> </strong> <em class="mv">本文的所有代码都可以在GitHub的资源库中找到，这里是——</em><a class="ae jz" href="https://github.com/eljamaki01/ReactNodeTesting.git" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://github.com/eljamaki01/ReactNodeTesting.git</em></a><em class="mv">。要构建并运行它，首先，下载代码。然后从项目的主目录，在命令提示符下，运行</em> <code class="fe mi mj mk ml b"><em class="mv">npm install</em></code> <em class="mv">，运行</em> <code class="fe mi mj mk ml b"><em class="mv">npm run build-react</em></code> <em class="mv">，再运行</em> <code class="fe mi mj mk ml b"><em class="mv">node index.js</em></code> <em class="mv">，然后在浏览器中，转到</em> <code class="fe mi mj mk ml b"><a class="ae jz" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></code> <em class="mv">。您可以从命令行运行测试脚本，如上所述。</em></p><p id="4c24" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> <em class="mv">资源:</em> </strong> <em class="mv">链接到有用的文档，像用</em> <code class="fe mi mj mk ml b"><em class="mv">get/find/query</em></code> <em class="mv">查找元素的RTL方法——</em><a class="ae jz" href="https://testing-library.com/docs/react-testing-library/cheatsheet" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://testing-library . com/docs/react-testing-library/cheat sheet</em></a><em class="mv"><br/>链接到有用的文档，关于如何处理来自</em><code class="fe mi mj mk ml b"><a class="ae jz" href="http://twitter.com/testing" rel="noopener ugc nofollow" target="_blank"><em class="mv">@testing</em></a><em class="mv">-library/jest-dom</em></code><em class="mv">——</em><a class="ae jz" href="https://github.com/testing-library/jest-dom" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://github.com/testing-library/jest-dom</em></a></p><p id="e7ea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mv">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mv">plain English . io</em></strong></a></p></div></div>    
</body>
</html>