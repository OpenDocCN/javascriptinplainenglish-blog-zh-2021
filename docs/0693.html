<html>
<head>
<title>Gatsby.js — Filtering and Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsby.js —过滤和图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/gatsby-js-filtering-and-images-aaba4e831bca?source=collection_archive---------10-----------------------#2021-02-12">https://javascript.plainenglish.io/gatsby-js-filtering-and-images-aaba4e831bca?source=collection_archive---------10-----------------------#2021-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a099fb1c1bacb8612ecf868bd1addaad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y3oPlnWqMDx88YCk"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@newhighmediagroup?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Richard T</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cf69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Gatsby是一个基于React的静态网站框架。</p><p id="f7a9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用它从外部数据源创建静态网站等等。</p><p id="fb08" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Gatsby创建一个站点。</p><h1 id="c082" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用GraphQL过滤</h1><p id="5577" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用GraphQL查询过滤结果中的项目。</p><p id="2e2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="de60" class="mn lc iq mj b gy mo mp l mq mr">{<br/>  allSitePage(filter: {path: {eq: "/pokemon"}}) {<br/>    edges {<br/>      node {<br/>        id<br/>        path<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="ac5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们得到等于T1的T0。</p><p id="405e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">eq</code>意为平等。</p><h1 id="9db0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">GraphQL查询别名</h1><p id="16ca" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加GraphQL查询别名。</p><p id="a5d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e203" class="mn lc iq mj b gy mo mp l mq mr">{<br/>  fileCount: allFile { <br/>    totalCount<br/>  }<br/>  filePageInfo: allFile {<br/>    pageInfo {<br/>      currentPage<br/>    }<br/>  }<br/>}</span></pre><p id="04f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">fileCount</code>和<code class="fe ms mt mu mj b">filePageInfo</code>是别名。</p><p id="6ce0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">冒号后的表达式是查询。</p><h1 id="19f5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">GraphQL查询片段</h1><p id="6056" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">GraphQL查询片段是可以重用的可共享的查询块。</p><p id="7632" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以创建一个片段，并通过编写以下内容使用它进行查询:</p><p id="362b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">src/pages/index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="e675" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import { graphql } from "gatsby"</span><span id="ecb5" class="mn lc iq mj b gy mv mp l mq mr">export const query = graphql`<br/>  fragment SiteInformation on SiteSiteMetadata {<br/>    title<br/>    description<br/>  }<br/>`</span><span id="5ce1" class="mn lc iq mj b gy mv mp l mq mr">export const pageQuery = graphql`<br/>  query SiteQuery {<br/>    site {<br/>      siteMetadata {<br/>        ...SiteInformation<br/>      }<br/>    }<br/>  }<br/>`</span><span id="535b" class="mn lc iq mj b gy mv mp l mq mr">export default function Home({ data }) {<br/>  return &lt;div&gt;{data.site.siteMetadata.title}&lt;/div&gt;<br/>}</span></pre><p id="fb51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe ms mt mu mj b">query</code>查询创建片段。</p><p id="ddfb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们为<code class="fe ms mt mu mj b">SiteSiteMetadata</code>类型创建片段，它包含网站的元数据字段。</p><p id="8385" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后<code class="fe ms mt mu mj b">pageQuery</code>使用我们刚刚创建的片段。</p><h1 id="6143" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用<code class="fe ms mt mu mj b">fetch</code>查询数据客户端</h1><p id="d996" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Fetch API在客户端查询数据。</p><p id="34ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5107" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState, useEffect } from "react"</span><span id="d007" class="mn lc iq mj b gy mv mp l mq mr">const IndexPage = () =&gt; {<br/>  const [starsCount, setStarsCount] = useState(0)<br/>  useEffect(() =&gt; {<br/>    fetch(`https://api.github.com/repos/gatsbyjs/gatsby`)<br/>      .then(response =&gt; response.json())<br/>      .then(resultData =&gt; {<br/>        setStarsCount(resultData.stargazers_count)<br/>      })<br/>  }, [])</span><span id="8883" class="mn lc iq mj b gy mv mp l mq mr">  return (<br/>    &lt;section&gt;<br/>      &lt;p&gt;Gatsby start count: {starsCount}&lt;/p&gt;<br/>    &lt;/section&gt;<br/>  )<br/>}<br/>export default IndexPage</span></pre><p id="f1b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">来获取Gatsby项目的Github星数并显示出来。</p><h1 id="2b58" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">形象</h1><p id="73b8" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在我们的盖茨比项目中添加图像。</p><p id="8665" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="fc32" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">src/pages/index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="185e" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import LaptopImg from "../assets/laptop.jpg"</span><span id="4297" class="mn lc iq mj b gy mv mp l mq mr">const IndexPage = () =&gt; {<br/>  return (<br/>    &lt;section&gt;<br/>      &lt;img src={LaptopImg} alt="laptop" /&gt;<br/>    &lt;/section&gt;<br/>  )<br/>}<br/>export default IndexPage</span></pre><p id="0ec7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe ms mt mu mj b">/assets</code>文件夹中导入图像，并将<code class="fe ms mt mu mj b">src</code>属性设置为导入的图像。</p><h1 id="f12a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">参考<code class="fe ms mt mu mj b">static</code>文件夹中的图像</h1><p id="3416" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">此外，我们可以通过路径引用<code class="fe ms mt mu mj b">static</code>文件夹中的图像。</p><p id="1f74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="07b0" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"</span><span id="0ac3" class="mn lc iq mj b gy mv mp l mq mr">const IndexPage = () =&gt; {<br/>  return (<br/>    &lt;section&gt;<br/>      &lt;img src={`laptop.jpg`} alt="laptop" /&gt;<br/>    &lt;/section&gt;<br/>  )<br/>}<br/>export default IndexPage</span></pre><p id="ab19" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">假设我们在<code class="fe ms mt mu mj b">static</code>文件夹中有图像。</p><h1 id="aca6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">用gatsby-image优化和查询局部图像</h1><p id="ab89" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe ms mt mu mj b">gatsby-image</code>来添加图像。</p><p id="d690" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要安装软件包所需的软件包，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8192" class="mn lc iq mj b gy mo mp l mq mr">npm i gatsby-plugin-sharp gatsby-transformer-sharp</span></pre><p id="c8b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><p id="719a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">gatsby-config.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7c88" class="mn lc iq mj b gy mo mp l mq mr">const path = require('path');</span><span id="2f9b" class="mn lc iq mj b gy mv mp l mq mr">module.exports = {<br/>  plugins: [<br/>    {<br/>      resolve: `gatsby-source-filesystem`,<br/>      options: {<br/>        name: `images`,<br/>        path: path.join(__dirname, `src`, `images`),<br/>      },<br/>    },<br/>    `gatsby-plugin-sharp`,<br/>    `gatsby-transformer-sharp`,<br/>  ],<br/>}</span></pre><p id="8e93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以通过编写以下内容来获取页面上的图像:</p><p id="be63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">src/pages/index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="13a5" class="mn lc iq mj b gy mo mp l mq mr">import React from "react"<br/>import { useStaticQuery, graphql } from "gatsby"<br/>import Img from "gatsby-image"</span><span id="b022" class="mn lc iq mj b gy mv mp l mq mr">const IndexPage = () =&gt; {<br/>  const data = useStaticQuery(graphql`<br/>    query {<br/>      allFile(<br/>        filter: {<br/>          extension: { regex: "/(jpg)|(png)|(jpeg)/" }<br/>          relativeDirectory: { eq: "" }<br/>        }<br/>      ) {<br/>        edges {<br/>          node {<br/>            base<br/>            childImageSharp {<br/>              fluid {<br/>                ...GatsbyImageSharpFluid<br/>              }<br/>            }<br/>          }<br/>        }<br/>      }<br/>    }<br/>  `)</span><span id="8117" class="mn lc iq mj b gy mv mp l mq mr">  return (<br/>    &lt;div&gt;<br/>      {data.allFile.edges.map(image =&gt; (<br/>        &lt;Img<br/>          fluid={image.node.childImageSharp.fluid}<br/>          alt={image.node.base.split(".")[0]}<br/>        /&gt;<br/>      ))}<br/>    &lt;/div&gt;<br/>  )<br/>}<br/>export default IndexPage</span></pre><p id="9ffd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过<code class="fe ms mt mu mj b">allFile</code>查询获得文件。</p><p id="a900" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe ms mt mu mj b">src/images</code>文件夹中获取我们在<code class="fe ms mt mu mj b">gatsby-config.js</code>中指定的图像。</p><h1 id="66c2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="a91a" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用GraphQL过滤项目，我们可以用GraphQL查询得到图像并显示它们。</p><p id="be0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>