<html>
<head>
<title>Authentication Simplified With JSON Web Tokens</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JSON Web令牌简化了身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/authentication-simplified-with-json-web-tokens-25880e91c0?source=collection_archive---------17-----------------------#2021-01-27">https://javascript.plainenglish.io/authentication-simplified-with-json-web-tokens-25880e91c0?source=collection_archive---------17-----------------------#2021-01-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d34f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">保护您的web应用程序的快速而简单的方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2f66fa6a257edcf043fbc3912e495216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NeTWTx5DK7S4qf9VUjaKLw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://www.pexels.com/@tima-miroshnichenko?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Tima Miroshnichenko</a> from <a class="ae kv" href="https://www.pexels.com/photo/man-people-woman-water-6266301/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="1c1e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JSON web令牌(JWT)是向任何web服务添加身份验证和授权的一种快速而简单的方法。</p><p id="0e63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然身份验证和授权听起来相似，但它们是两个根本不同的东西。</p><p id="ff4d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">认证是确认用户是他们声称的那个人的过程。用户名和密码、face ID和一次性密码都是身份验证的例子。</p><p id="b8c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一方面，授权限制了允许用户做什么的范围。与普通用户相比，授予管理员额外的访问权限就是授权的一个例子。</p><p id="b85b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您使用用户名和密码登录到Medium。如果成功，灵媒已经通过<strong class="ky ir">认证</strong>你就是你声称的那个人。然后你可以去更改你的个人资料设置，因为这是你自己的账户，你被<strong class="ky ir">授权</strong>这么做。</p><h1 id="4fdf" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是JWT</h1><p id="d230" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">JSON web令牌，或简称为JWT，是一种安全表示<a class="ae kv" href="https://tools.ietf.org/html/rfc7519" rel="noopener ugc nofollow" target="_blank">声明的简洁方法</a>。从本质上来说，这是一种双方交换信息的安全方式，也就是<strong class="ky ir">数字签名</strong>。</p><p id="a29b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JWT由三部分组成。报头、有效载荷和签名验证。</p><p id="a3df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">报头数据标识用于生成签名的算法和令牌类型。</p><p id="e945" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有效载荷是您希望交换的JSON编码数据。</p><p id="2699" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">最重要的是签名，它是通过加密哈希函数运行您的头、有效负载和秘密的组合来进行数字签名的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/d08db3c71b94e03fcfb62987366c1385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*abuRWOG3QmIv285_2LSYuA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">JWT Info — From <a class="ae kv" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">Jwt.io</a></figcaption></figure><h1 id="4385" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">任何人都可以破译JWT</h1><p id="6a31" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">不相信我？来吧，把下面的JWT复制到<a class="ae kv" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">这个网站</a>。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="61ac" class="mv lt iq mr b gy mw mx l my mz">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.o52bYlRaL9DW_IphDyb26eK9ZM4z9o8y-Ne-A7SzroI</span></pre><p id="3fd2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这不安全，我什么都看得到！</p><p id="f498" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">没那么快。</p><p id="1e66" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然你可以很容易地解码任何JWT(这是故意的)，创造一个假的几乎是不可能的。</p><h1 id="df44" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">数字签名</h1><p id="8a51" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这背后的神奇之处在于用于创建数字签名的<a class="ae kv" href="http://www.aspencrypt.com/crypto101_hash.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ky ir">单向</strong>散列函数</a>。</p><p id="514e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">创建JWT时，您可以通过哈希函数运行标头、有效负载和密钥，对其进行数字签名。</p><p id="3d00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你想知道加密散列函数是如何工作的，那么读一下<a class="ae kv" href="http://www.aspencrypt.com/crypto101_hash.html" rel="noopener ugc nofollow" target="_blank">。简而言之，它是一种对给定的输入产生相同输出的方式，以这种方式无法确定原始输入。</a></p><p id="f8f0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，当对JWT的数字签名进行编码时，下面的内容将通过一个单向散列函数来产生一个唯一的结果。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="cb02" class="mv lt iq mr b gy mw mx l my mz">hash(header.payload.<strong class="mr ir">my-super-secret-key) </strong>=&gt;<strong class="mr ir"> </strong>F2QT4fwpMeJf36POk6yJV_ad</span></pre><p id="eda3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如您所见，报头和有效载荷很容易被解码。秘钥是保证JWT安全的关键。如果其他人发现了你的秘密密钥的价值，那么他们将能够<strong class="ky ir">绕过你的授权</strong>。</p><blockquote class="na"><p id="776a" class="nb nc iq bd nd ne nf ng nh ni nj lr dk translated">JWT只有在签名时使用的密钥与发行时使用的密钥相同时，才具有有效的签名。</p></blockquote><h1 id="8b45" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw nk jx me jz nl ka mg kc nm kd mi mj bi translated">要求</h1><p id="b9e8" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">JWT的有效载荷应该包含用户的<a class="ae kv" href="https://tools.ietf.org/html/rfc7519#section-4" rel="noopener ugc nofollow" target="_blank">声明</a>。这些声明代表了关于用户和其他附加数据的各种声明。</p><p id="21b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如何选择命名这些不同的主张取决于你。然而，在<a class="ae kv" href="https://tools.ietf.org/html/rfc7519#section-4" rel="noopener ugc nofollow" target="_blank">官方文件</a>中列出了指导方针。</p><p id="478b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于这个例子，我选择对我的令牌进行如下声明。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="ea6b" class="mv lt iq mr b gy mw mx l my mz">{<br/>  "sub": "1234567890",<br/>  "name": "John Doe",<br/>  "admin": true<br/>}</span></pre><ul class=""><li id="509a" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated">sub——subject的缩写，在本例中是用户的ID。</li><li id="4a30" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">用户名。</li><li id="4bb9" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">无论用户是否是管理员。</li></ul><p id="fa90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当决定你希望做出哪些声明时，请记住，JWT可以很容易地被解码以暴露这些信息。所以，不要在令牌内编码任何敏感数据<strong class="ky ir">。</strong></p><h1 id="5baa" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">确认</h1><p id="197f" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">假设提供的JWT是有效的，那么为了验证令牌的真实性，需要检查签名。</p><p id="fe85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如前所述，JWT的数字签名是通过将报头和有效载荷数据以及您的密钥传递给单向哈希函数来创建的。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="3c2c" class="mv lt iq mr b gy mw mx l my mz">hashFunction("base64EncodedHeader.base64EncodedPayload.secret")</span></pre><p id="dd1a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您可以通过自己计算该签名并将其与令牌提供的签名进行比较来确定令牌是否有效。</p><h1 id="9d5f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">传动装置ˌ[机]变速器</h1><p id="608b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">当向受保护的资源提交请求时，您应该使用<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Authorization" rel="noopener ugc nofollow" target="_blank">承载模式</a>将JWT嵌入到HTTP请求的授权头中。</p><pre class="kg kh ki kj gt mq mr ms mt aw mu bi"><span id="2586" class="mv lt iq mr b gy mw mx l my mz">Authorization: Bearer &lt;YOUR-JWT-HERE&gt;</span></pre><h1 id="8e59" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">我应该用JWT的吗</h1><p id="edd5" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">与<a class="ae kv" href="https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html" rel="noopener ugc nofollow" target="_blank">会话</a>相比，JWT会话的设置和管理要简单得多。在大多数情况下，您可以安装下面的模块之一，只需几行代码就可以启动并运行。</p><ul class=""><li id="0f89" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated">快速且易于设置。</li><li id="d0fe" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">服务器上没有状态的持久性，所有都封装在JWT声明中。</li><li id="f6b7" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">可伸缩性不是问题，因为客户端存储JWT。</li></ul><p id="f121" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">也就是说，他们也有一些弱点。</p><ul class=""><li id="844e" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated">您的密钥被泄露的风险。</li><li id="360b" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">带宽，JWT的大小明显大于会话cookie。</li><li id="5da3" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">撤销令牌可能比使会话无效更复杂。</li></ul><p id="dcc8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">JSON web令牌是否适合您的应用程序将取决于您的特定需求。但是，它们是开始一些简单、安全和可扩展的身份验证的好方法！</p><p id="a732" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，并且愿意支持我成为一名作家，考虑注册<a class="ae kv" href="https://adam-galtrey.medium.com/membership" rel="noopener">成为一名媒体成员</a>。每月只需5美元，你就可以无限制地阅读Medium上的所有文章。如果你<a class="ae kv" href="https://adam-galtrey.medium.com/membership" rel="noopener">用我的链接</a>注册，我也会赚一小笔佣金。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><h1 id="4154" class="ls lt iq bd lu lv oi lx ly lz oj mb mc jw ok jx me jz ol ka mg kc om kd mi mj bi translated">JWT图书馆</h1><ul class=""><li id="0356" class="nn no iq ky b kz mk lc ml lf on lj oo ln op lr ns nt nu nv bi translated">【JavaScript的JWT</li><li id="4c33" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><a class="ae kv" href="https://pyjwt.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">Python的JWT</a></li><li id="5d75" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><a class="ae kv" href="https://github.com/auth0/java-jwt" rel="noopener ugc nofollow" target="_blank">面向Java的JWT</a></li><li id="25f8" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><a class="ae kv" href="https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel.tokens.jwt.jwtsecuritytokenhandler?view=azure-dotnet" rel="noopener ugc nofollow" target="_blank"> JWT为C# </a></li><li id="77cc" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><a class="ae kv" href="https://github.com/dgrijalva/jwt-go" rel="noopener ugc nofollow" target="_blank"> JWT围棋</a></li></ul></div></div>    
</body>
</html>