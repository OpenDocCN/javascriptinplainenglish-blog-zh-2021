<html>
<head>
<title>Gatsby TypeScript Docker Env Vars Alternative</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gatsbyç±»å‹è„šæœ¬Dockerç¯å¢ƒå˜é‡æ›¿ä»£</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/gatsby-typescript-docker-env-vars-alternative-fc7e322bc9e?source=collection_archive---------10-----------------------#2021-03-30">https://javascript.plainenglish.io/gatsby-typescript-docker-env-vars-alternative-fc7e322bc9e?source=collection_archive---------10-----------------------#2021-03-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5c28" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">è®©TypeScript Gatsbyåœ¨Dockerè¿è¡Œæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/3ddc12912c5c29e21b2d2b45647a5818.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8O7GCljXfxiycleQ5CdUA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Getting TypeScript GatsbyJS To Work With Environment Variables At Docker Run Time</figcaption></figure><h1 id="3b80" class="ks kt in bd ku kv kw kx ky kz la lb lc jt ld ju le jw lf jx lg jz lh ka li lj bi translated">è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p id="8100" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">å¦‚æœä½ è¿˜æ²¡æœ‰çœ‹è¿‡æ­£è§„çš„GatsbyJSç‰ˆæœ¬çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼Œæˆ‘æ¨èä½ å»çœ‹çœ‹åŸæ–‡ã€‚</p><div class="mg mh gp gr mi mj"><a href="https://codingwithmanny.medium.com/gatsby-docker-env-vars-alternative-e81802281999" rel="noopener follow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd io gy z fp mo fr fs mp fu fw im bi translated">Gatsby Dockerç¯å¢ƒå˜é‡æ›¿ä»£</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">è®©GatsbyJSåœ¨Dockerè¿è¡Œæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">codingwithmanny.medium.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx km mj"/></div></div></a></div><p id="50ef" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">æœ¬æ–‡å°†ç‰¹åˆ«å…³æ³¨è®¾ç½®ç›¸åŒçš„ç¯å¢ƒï¼Œä½†æ˜¯å…·æœ‰<strong class="lm io"> TypeScript </strong>æ”¯æŒã€‚</p></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="44e7" class="ks kt in bd ku kv nk kx ky kz nl lb lc jt nm ju le jw nn jx lg jz no ka li lj bi translated">è®¾ç½®æˆ‘ä»¬çš„TypeScripté¡¹ç›®</h1><p id="022e" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">ä½¿ç”¨Gatsby CLIï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="1b38" class="nu kt in nq b gy nv nw l nx ny">gatsby new gatsby-ts-env-vars;<br/>cd gatsby-ts-env-vars;<br/>yarn develop;</span></pre><p id="2fb5" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ä¸€æ—¦æˆ‘ä»¬çš„é¡¹ç›®è®¾ç½®å¥½äº†ï¼Œè®©æˆ‘ä»¬æ·»åŠ å¿…è¦çš„ä¾èµ–é¡¹ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="ce6b" class="nu kt in nq b gy nv nw l nx ny">yarn add typescript gatsby-plugin-typescript;<br/>yarn add -D <a class="ae nz" href="http://twitter.com/types/react-helmet" rel="noopener ugc nofollow" target="_blank">@types/react-helmet</a>;</span></pre><p id="15f5" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ç°åœ¨æˆ‘ä»¬å°†é…ç½®Gatsbyæ¥æ”¯æŒTypeScriptã€‚</p><p id="0393" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T0ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="5f91" class="nu kt in nq b gy nv nw l nx ny">module.exports = {<br/>  siteMetadata: {<br/>    title: `Gatsby Default Starter`,<br/>    description: `Kick off your next, great Gatsby project with this default starter. This barebones starter ships with the main Gatsby configuration files you might need.`,<br/>    author: `<a class="ae nz" href="http://twitter.com/gatsbyjs" rel="noopener ugc nofollow" target="_blank">@gatsbyjs</a>`,<br/>  },<br/>  plugins: [<br/><strong class="nq io">    `gatsby-plugin-typescript`,<br/></strong>// ... rest of code</span></pre><p id="9889" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å®‰è£…äº†TypeScriptï¼Œè®©æˆ‘ä»¬è¿è¡Œä¸€ä¸ªåˆå§‹initæ¥ç”Ÿæˆ<code class="fe oa ob oc nq b">tsconfig.json</code>æ–‡ä»¶ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="945f" class="nu kt in nq b gy nv nw l nx ny">./node_modules/.bin/tsc --init</span></pre><p id="c6c5" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">æˆ‘ä»¬éœ€è¦å¯¹<code class="fe oa ob oc nq b">tsconfig.json</code>æ–‡ä»¶åšä¸€ä¸ªè°ƒæ•´ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="3683" class="nu kt in nq b gy nv nw l nx ny">// "checkJs": true,<br/><strong class="nq io">"jsx": "preserve",</strong><br/>// "declaration": true,</span></pre><p id="9ee1" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰æ–‡ä»¶æ›´æ”¹ä¸º<code class="fe oa ob oc nq b">tsx</code>æ–‡ä»¶ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="3963" class="nu kt in nq b gy nv nw l nx ny">/src/components/header.tsx<br/>/src/components/layout.tsx<br/>/src/components/seo.tsx<br/>/src/pages/404.tsx<br/>/src/pages/index.tsx<br/>/src/pages/page-2.tsx</span></pre><p id="1ec5" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ä»¥åŠæˆ‘ä»¬éœ€è¦æ·»åŠ å’Œè°ƒæ•´çš„æ‰€æœ‰ç±»å‹ã€‚</p><p id="a852" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong> <code class="fe oa ob oc nq b">src/components/header.tsx</code></p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="fd06" class="nu kt in nq b gy nv nw l nx ny">import * as React from "react"<br/>import PropTypes from "prop-types"<br/>import { Link } from "gatsby"</span><span id="e43d" class="nu kt in nq b gy od nw l nx ny">const Header = ({ siteTitle }<strong class="nq io">: { siteTitle: string }) =&gt; (</strong></span></pre><p id="d8c5" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T5ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="1ff8" class="nu kt in nq b gy nv nw l nx ny">/**<br/> * Layout component that queries for data<br/> * with Gatsby's useStaticQuery component<br/> *<br/> * See: <a class="ae nz" href="https://www.gatsbyjs.com/docs/use-static-query/" rel="noopener ugc nofollow" target="_blank">https://www.gatsbyjs.com/docs/use-static-query/</a><br/> */</span><span id="9490" class="nu kt in nq b gy od nw l nx ny">import * as React from "react"<br/>import PropTypes from "prop-types"<br/>import { useStaticQuery, graphql } from "gatsby"</span><span id="7535" class="nu kt in nq b gy od nw l nx ny">import Header from "./header"<br/>import "./layout.css"</span><span id="f77f" class="nu kt in nq b gy od nw l nx ny">const Layout = ({ children }<strong class="nq io">: { children?: React.ReactNode}</strong>) =&gt; {</span></pre><p id="991f" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>æ–‡ä»¶:<code class="fe oa ob oc nq b">src/components/seo.tsx</code></p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="5c45" class="nu kt in nq b gy nv nw l nx ny">import * as React from "react"<br/>import PropTypes from "prop-types"<br/>import { Helmet } from "react-helmet"<br/>import { useStaticQuery, graphql } from "gatsby"</span><span id="3d99" class="nu kt in nq b gy od nw l nx ny"><strong class="nq io">interface SEOTypes {<br/>  description?: string;<br/>  lang?: string;<br/>  meta?: [{<br/>    name: string; <br/>    content: any; <br/>    property?: undefined;<br/>  }],<br/>  title?: string;<br/>}</strong></span><span id="5982" class="nu kt in nq b gy od nw l nx ny">function SEO({ description, lang, meta, title }<strong class="nq io">: SEOTypes</strong>) {<br/> <br/>// ...</span><span id="a6dd" class="nu kt in nq b gy od nw l nx ny">return (<br/>    &lt;Helmet<br/>      htmlAttributes={{<br/>        lang,<br/>      }}<br/>      title={title}<br/><strong class="nq io">      titleTemplate={defaultTitle ? `%s | ${defaultTitle}` : ''}</strong><br/>      meta={[<br/>        {<br/>          name: `description`,<br/>          content: metaDescription,<br/>        },<br/>        {<br/>          property: `og:title`,<br/>          content: title,<br/>        },<br/>        {<br/>          property: `og:description`,<br/>          content: metaDescription,<br/>        },<br/>        {<br/>          property: `og:type`,<br/>          content: `website`,<br/>        },<br/>        {<br/>          name: `twitter:card`,<br/>          content: `summary`,<br/>        },<br/>        {<br/>          name: `twitter:creator`,<br/>          content: site.siteMetadata?.author || ``,<br/>        },<br/>        {<br/>          name: `twitter:title`,<br/>          content: title,<br/>        },<br/>        {<br/>          name: `twitter:description`,<br/>          content: metaDescription,<br/>        },<br/>      ].concat(<strong class="nq io">meta || []</strong>)}</span></pre><p id="1414" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T7ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="ed13" class="nu kt in nq b gy nv nw l nx ny">// Lowercase<br/><strong class="nq io">      formats={["auto", "webp", "avif"]}</strong></span></pre><p id="5676" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæˆ‘ä»¬åº”è¯¥èƒ½å¤Ÿæ‰§è¡Œ<code class="fe oa ob oc nq b">yarn develop</code>å¹¶çœ‹åˆ°ä»¥ä¸‹å†…å®¹:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/a66b2a7011292f2befac1a04af2bc399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JDHXhdzrEk7vpG_fdYs1tQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Our local development environment working with TypeScript</figcaption></figure></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="1e35" class="ks kt in bd ku kv nk kx ky kz nl lb lc jt nm ju le jw nn jx lg jz no ka li lj bi translated">åˆ›å»ºæˆ‘ä»¬çš„åŸºç¡€é¡¹ç›®</h1><p id="d2d8" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»æœ‰äº†TypeScriptè®¾ç½®ï¼Œè®©æˆ‘ä»¬åˆ›å»ºé¡¹ç›®æ‰€éœ€çš„åŸºæœ¬æ–‡ä»¶ï¼Œä½¿äº‹æƒ…ç±»ä¼¼äºè¿™ä¸ªGatsbyç¯å¢ƒå˜é‡æ–‡ç« çš„<a class="ae nz" href="https://codingwithmanny.medium.com/gatsby-docker-env-vars-alternative-e81802281999" rel="noopener">éç±»å‹è„šæœ¬ç‰ˆæœ¬ã€‚</a></p><p id="3980" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">åˆ›å»ºæˆ‘ä»¬çš„ç¯å¢ƒå˜é‡æ–‡ä»¶:</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="d44d" class="nu kt in nq b gy nv nw l nx ny">mkdir static;<br/>echo 'window.GATSBY_API_URL="<a class="ae nz" href="https://jsonplaceholder.typicode.com" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com</a>"' &gt; static/env.js;</span></pre><p id="6f5f" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ç’ç€g it</p><p id="cbea" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T9ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="4db5" class="nu kt in nq b gy nv nw l nx ny"># dotenv environment variable files<br/>.env*<br/>static/env.js</span></pre><p id="ebc3" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T10ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="1698" class="nu kt in nq b gy nv nw l nx ny">import * as React from "react"</span><span id="530c" class="nu kt in nq b gy od nw l nx ny">import Layout from "../components/layout"<br/>import SEO from "../components/seo"</span><span id="e1c5" class="nu kt in nq b gy od nw l nx ny">const IndexPage = () =&gt; {<br/><strong class="nq io">  const [todos, setTodos] = React.useState&lt;[{<br/>  title?: string}] | undefined&gt;()</strong></span><span id="6da8" class="nu kt in nq b gy od nw l nx ny"><strong class="nq io">  React.useEffect(() =&gt; {<br/>    fetch(`${window.GATSBY_API_URL}/todos`)<br/>      .then(response =&gt; response.json())<br/>      .then(json =&gt; setTodos(json))<br/>  }, [])</strong></span><span id="7965" class="nu kt in nq b gy od nw l nx ny">   return (<br/>    &lt;Layout&gt;<br/>      &lt;SEO title="Home" /&gt;<br/><strong class="nq io">      &lt;h1&gt;Todos&lt;/h1&gt;<br/>      {todos &amp;&amp; todos.length &gt; 0 &amp;&amp; (<br/>        &lt;ul&gt;<br/>          {todos.map((todo, key) =&gt; (<br/>            &lt;li key={`todo-${key}`}&gt;{todo?.title}&lt;/li&gt;<br/>          ))}<br/>        &lt;/ul&gt;<br/>      )}</strong><br/>    &lt;/Layout&gt;<br/>  )<br/>}</span><span id="86d1" class="nu kt in nq b gy od nw l nx ny">export default IndexPage</span></pre><p id="78a0" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">å¢åŠ å¯¹è‡ªå®šä¹‰<code class="fe oa ob oc nq b">window</code>ç±»å‹çš„æ”¯æŒã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="dd41" class="nu kt in nq b gy nv nw l nx ny">mkdir src/types;<br/>touch src/types/window.d.ts;</span></pre><p id="498f" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T12ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="c264" class="nu kt in nq b gy nv nw l nx ny"><strong class="nq io">interface Window {<br/>  GATSBY_API_URL: string;<br/>}</strong></span></pre><p id="6d55" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">å¤åˆ¶æ·»åŠ æˆ‘ä»¬çš„<code class="fe oa ob oc nq b">env.js</code>æ–‡ä»¶æ‰€éœ€çš„<code class="fe oa ob oc nq b">html.js</code>æ–‡ä»¶ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="f564" class="nu kt in nq b gy nv nw l nx ny">cp .cache/default-html.js src/html.js</span></pre><p id="3082" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T15ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="130c" class="nu kt in nq b gy nv nw l nx ny">import React from "react"<br/>import PropTypes from "prop-types"</span><span id="971e" class="nu kt in nq b gy od nw l nx ny">export default function HTML(props) {<br/>  return (<br/>    &lt;html {...props.htmlAttributes}&gt;<br/>      &lt;head&gt;<br/>        &lt;meta charSet="utf-8" /&gt;<br/>        &lt;meta httpEquiv="x-ua-compatible" content="ie=edge" /&gt;<br/>        &lt;meta<br/>          name="viewport"<br/>          content="width=device-width, initial-scale=1, shrink-to-fit=no"<br/>        /&gt;<br/><strong class="nq io">        &lt;script src="/env.js"&gt;&lt;/script&gt;</strong></span></pre><p id="8857" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">å¦‚æœæˆ‘ä»¬è¿è¡Œ<code class="fe oa ob oc nq b">yarn develop</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥çœ‹åˆ°äº‹æƒ…æ­£åœ¨è¿›è¡Œã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/c127c84482b0b9459e9b93050c08f076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwYdXlIyf-gF6dOSosm-7w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Application working with our env.js file</figcaption></figure></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="3155" class="ks kt in bd ku kv nk kx ky kz nl lb lc jt nm ju le jw nn jx lg jz no ka li lj bi translated">Dockeræ„å»ºè§£å†³æ–¹æ¡ˆ</h1><p id="9a96" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">ä¸‹ä¸€æ­¥æ˜¯ç”¨dockerå’Œæ‰€éœ€çš„é…ç½®æ–‡ä»¶è¿›è¡Œè®¾ç½®ã€‚</p><h2 id="1355" class="nu kt in bd ku of og dn ky oh oi dp lc lt oj ok le lx ol om lg mb on oo li op bi translated">é—®é¢˜å›é¡¾</h2><p id="e171" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†é€šè¿‡dockerä¼ é€’ç¯å¢ƒå˜é‡(æœ€åˆè®¾ç½®Gatsbyçš„æ–¹å¼)æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºå½“æˆ‘ä»¬è¿è¡ŒDockeræ˜ åƒæ—¶ï¼Œåœ¨Gatsbyæ„å»ºå®Œæˆä¹‹å‰å®ƒä¸ä¼šå·¥ä½œã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/b0575a7e16cf3a9171bae39ff32c12f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5JETvbzqqK2395FWGJ6vA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Gatsby Docker still building</figcaption></figure><h2 id="e790" class="nu kt in bd ku of og dn ky oh oi dp lc lt oj ok le lx ol om lg mb on oo li op bi translated">è§£å†³åŠæ³•</h2><p id="c80e" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">æˆ‘ä»¬å°†ä¿®æ”¹/æ·»åŠ 3ä¸ªæ–‡ä»¶ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="be1c" class="nu kt in nq b gy nv nw l nx ny">mkdir docker;<br/>touch docker/entrypoint.sh;<br/>touch .dockerignore;<br/>touch Dockerfile;</span></pre><p id="5284" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T0ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="59e8" class="nu kt in nq b gy nv nw l nx ny"># SET DEFAULT ENV IF NOT SET<br/>export GATSBY_API_URL="${GATSBY_API_URL:=unknown}";</span><span id="29da" class="nu kt in nq b gy od nw l nx ny"># CHECK IF FILES IS NOT CREATED, ELSE CREATE<br/>cd /usr/share/nginx/html;</span><span id="2fe9" class="nu kt in nq b gy od nw l nx ny">if [ ! -f env.js ];<br/>then<br/>    echo "window.GATSBY_API_URL='$GATSBY_API_URL';" &gt; env.js<br/>fi;</span><span id="c13a" class="nu kt in nq b gy od nw l nx ny">#Ì¶ Ì¶BÌ¶UÌ¶IÌ¶LÌ¶DÌ¶ Ì¶PÌ¶RÌ¶OÌ¶JÌ¶EÌ¶CÌ¶TÌ¶<br/>yÌ¶aÌ¶rÌ¶nÌ¶ Ì¶bÌ¶uÌ¶iÌ¶lÌ¶dÌ¶;Ì¶</span><span id="5b65" class="nu kt in nq b gy od nw l nx ny"># KEEP NGINX DAEMON RUNNING<br/>nginx -g 'daemon off;'; nginx -s reload;</span></pre><p id="2444" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">2021å¹´7æœˆ9æ—¥æ›´æ–°:</strong></p><p id="adc3" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">æ„Ÿè°¢<a class="oq or ep" href="https://medium.com/u/91dfd1332931?source=post_page-----fc7e322bc9e--------------------------------" rel="noopener" target="_blank">åŸƒå¡åŸºè€¶å°”Â·å†ˆè¨é›·æ–¯Â·é‡Œäºšå°”</a>æ³¨æ„åˆ°<code class="fe oa ob oc nq b">yarn build</code>ä¸åº”è¯¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ˜ åƒæ—¶ä¼šç»™å‡ºä¸€ä¸ªé”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºåœ¨ä¸‹é¢çš„<code class="fe oa ob oc nq b">Dockerfile</code>ä¸­ï¼Œæˆ‘å°†è¯¥è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼Œæ„å»ºå’ŒæœåŠ¡æ„å»ºï¼Œå…¶ä¸­ä¸åŒ…å«ä¹Ÿä¸ä¼šè¯†åˆ«ç¬¬äºŒæ­¥ä¸­<code class="fe oa ob oc nq b">entrypoint.sh</code>ä¸­çš„<code class="fe oa ob oc nq b">yarn build</code>ã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="cd7d" class="nu kt in nq b gy nv nw l nx ny">/usr/local/bin/entrypoint.sh: line 13: yarn: not found</span></pre><p id="be2a" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">æ–‡ç« ç°åœ¨ç»§ç»­ã€‚</p><p id="c8f2" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T5ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="0148" class="nu kt in nq b gy nv nw l nx ny">node_modules/<br/>*/node_modules/<br/>.git<br/>public<br/>.cache<br/>package-lock.json<br/>.env<br/>static/env.js</span></pre><p id="9c52" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">æ–‡ä»¶:</strong>T6ã€‘</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="f44e" class="nu kt in nq b gy nv nw l nx ny"># BUILD PROCESS<br/>FROM node:12.18.4-alpine as build-stage</span><span id="0edc" class="nu kt in nq b gy od nw l nx ny">RUN apk update; \<br/>    apk add libpng-dev; \<br/>    apk add autoconf; \<br/>    apk add automake; \<br/>    apk add make; \<br/>    apk add g++; \<br/>    apk add libtool; \<br/>    apk add nasm;</span><span id="176e" class="nu kt in nq b gy od nw l nx ny">WORKDIR /usr/src/app</span><span id="9fbe" class="nu kt in nq b gy od nw l nx ny">COPY package.json yarn.lock /usr/src/app/</span><span id="513a" class="nu kt in nq b gy od nw l nx ny">RUN yarn install --non-interactive --frozen-lockfile</span><span id="6b2f" class="nu kt in nq b gy od nw l nx ny">COPY . ./</span><span id="b9ef" class="nu kt in nq b gy od nw l nx ny">RUN yarn run build --verbose</span><span id="ce17" class="nu kt in nq b gy od nw l nx ny"># BUILT APP<br/>FROM nginx:1.15.4-alpine</span><span id="0ad2" class="nu kt in nq b gy od nw l nx ny">WORKDIR /usr/share/nginx/html</span><span id="81fa" class="nu kt in nq b gy od nw l nx ny">COPY --from=build-stage /usr/src/app/public /usr/share/nginx/html</span><span id="4c21" class="nu kt in nq b gy od nw l nx ny">COPY $PWD/docker/entrypoint.sh /usr/local/bin</span><span id="48c0" class="nu kt in nq b gy od nw l nx ny">RUN chmod +x /usr/local/bin/entrypoint.sh</span><span id="c8d2" class="nu kt in nq b gy od nw l nx ny">ENTRYPOINT ["/bin/sh", "/usr/local/bin/entrypoint.sh"]</span><span id="0dba" class="nu kt in nq b gy od nw l nx ny">EXPOSE 80</span><span id="5df4" class="nu kt in nq b gy od nw l nx ny">CMD ["/bin/sh", "-c", "exec nginx -g 'daemon off;';"]</span></pre><p id="5643" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">é…ç½®å®Œæˆåï¼Œæˆ‘ä»¬å°†æ„å»ºå®ƒã€‚</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="d8d7" class="nu kt in nq b gy nv nw l nx ny">docker build . -t gatsby-building-ts</span></pre><p id="38cf" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ç„¶åï¼Œå½“æˆ‘ä»¬ä¼ é€’ç¯å¢ƒå˜é‡å¹¶è¿è¡Œå›¾åƒæ—¶:</p><pre class="kd ke kf kg gt np nq nr ns aw nt bi"><span id="ae9e" class="nu kt in nq b gy nv nw l nx ny">docker run -it -d -p 8000:80 -e GATSBY_API_URL=<a class="ae nz" href="https://jsonplaceholder.typicode.com" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com</a> --name gatsby gatsby-building-ts;</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oe"><img src="../Images/c232658e6dec2c6426009d83036d7cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LWSBuV0l0gEyFANZ6uxcYw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Docker environment variables being passed at run time</figcaption></figure></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><p id="79ee" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">é¡¹ç›®èµ„æºåº“:</strong>å¦‚æœæ‚¨æœ‰å…´è¶£æŸ¥çœ‹ä»£ç ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œè·å¾—æ‰€æœ‰å†…å®¹ã€‚</p><div class="mg mh gp gr mi mj"><a href="https://github.com/codingwithmanny/gatsby-env-vars/tree/main" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd io gy z fp mo fr fs mp fu fw im bi translated">coding with Manny/Gatsby-env-vars</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">åœ¨GitHubä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸ºcodingwithmanny/Gatsby-env-varsçš„å¼€å‘åšå‡ºè´¡çŒ®ã€‚</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">github.com</p></div></div><div class="ms l"><div class="os l mu mv mw ms mx km mj"/></div></div></a></div></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><h1 id="b4c3" class="ks kt in bd ku kv nk kx ky kz nl lb lc jt nm ju le jw nn jx lg jz no ka li lj bi translated">æœ€å</h1><p id="09f9" class="pw-post-body-paragraph lk ll in lm b ln lo jo lp lq lr jr ls lt lu lv lw lx ly lz ma mb mc md me mf ig bi translated">ä¸‹ä¸€æ­¥å°†æ˜¯åˆ¶ä½œä¸€ä¸ªæ›´çœŸå®çš„ä¾‹å­/å®ç°ï¼Œè®©å®ƒä¸<strong class="lm io"> <em class="ot"> Auth0 </em> </strong>ä¸€èµ·å·¥ä½œã€‚æˆ‘åº”è¯¥å¾ˆå¿«å°±ä¼šå†™è¿™ç¯‡æ–‡ç« äº†ã€‚</p><p id="2a81" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">å¦‚æœä½ ä»ä¸­è·å¾—äº†ä»·å€¼ï¼Œè¯·åœ¨twitterä¸Šåˆ†äº«ğŸ¦æˆ–è€…å…¶ä»–ç¤¾äº¤åª’ä½“å¹³å°ã€‚å†æ¬¡æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚ğŸ™</p><p id="fa9a" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated">ä¹Ÿè¯·åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘:<a class="ae nz" href="http://twitter.com/codingwithmanny" rel="noopener ugc nofollow" target="_blank"> @codingwithmanny </a>å’Œinsta gram at<a class="ae nz" href="https://instagram.com/codingwithmanny" rel="noopener ugc nofollow" target="_blank">@ codingwithmanny</a>ã€‚</p><p id="eb38" class="pw-post-body-paragraph lk ll in lm b ln my jo lp lq mz jr ls lt na lv lw lx nb lz ma mb nc md me mf ig bi translated"><strong class="lm io">å»¶ä¼¸é˜…è¯»:</strong></p><div class="mg mh gp gr mi mj"><a href="https://codingwithmanny.medium.com/gatsby-docker-env-vars-alternative-e81802281999" rel="noopener follow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd io gy z fp mo fr fs mp fu fw im bi translated">Gatsby Dockerç¯å¢ƒå˜é‡æ›¿ä»£</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">è®©GatsbyJSåœ¨Dockerè¿è¡Œæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">codingwithmanny.medium.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx km mj"/></div></div></a></div><div class="mg mh gp gr mi mj"><a href="https://codingwithmanny.medium.com/nodejs-typescript-docker-deployment-process-with-aws-ebs-14796cd78392" rel="noopener follow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd io gy z fp mo fr fs mp fu fw im bi translated">ä½¿ç”¨AWS EBSçš„NodeJSç±»å‹è„šæœ¬Dockeréƒ¨ç½²æµç¨‹</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">å¦‚ä½•æ‰“åŒ…NodeJS TypeScriptåº”ç”¨ç¨‹åºï¼Œå°†Dockeræ˜ åƒæ„å»ºå¹¶éƒ¨ç½²åˆ°AWS Elastic Beanstalk</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">codingwithmanny.medium.com</p></div></div><div class="ms l"><div class="ou l mu mv mw ms mx km mj"/></div></div></a></div><div class="mg mh gp gr mi mj"><a href="https://codingwithmanny.medium.com/automating-nodejs-ts-deployments-with-codepipeline-to-elastic-beanstalk-79664321ab91" rel="noopener follow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd io gy z fp mo fr fs mp fu fw im bi translated">é€šè¿‡åˆ°Elastic Beanstalkçš„ä»£ç ç®¡é“è‡ªåŠ¨åŒ–èŠ‚ç‚¹TSéƒ¨ç½²</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">ä½¿ç”¨AWS CodePipelineåˆ°Elastic Beanstalk Dockerè®¾ç½®è¿ç»­éƒ¨ç½²</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">codingwithmanny.medium.com</p></div></div><div class="ms l"><div class="ov l mu mv mw ms mx km mj"/></div></div></a></div></div></div>    
</body>
</html>