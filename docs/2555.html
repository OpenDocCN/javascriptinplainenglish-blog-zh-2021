<html>
<head>
<title>Migrating a 150K LOC Codebase to Vite and ESBuild: Why? ({art 1/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将150K LOC代码库迁移到Vite和ESBuild:为什么？({第1/3条)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/migrating-a-150k-loc-codebase-to-vite-and-esbuild-why-part-1-3-4ccd9bea2a61?source=collection_archive---------2-----------------------#2021-05-26">https://javascript.plainenglish.io/migrating-a-150k-loc-codebase-to-vite-and-esbuild-why-part-1-3-4ccd9bea2a61?source=collection_archive---------2-----------------------#2021-05-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="cebd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Vite是什么？我们为什么考虑它？比Webpack快吗？够成熟吗？</p><p id="a3db" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是关于将React+TypeScript代码库从Webpack迁移到Vite的三篇文章系列的一部分。<a class="ae ki" href="https://noriste.medium.com/migrating-a-150k-loc-codebase-to-vite-and-esbuild-how-part-2-3-91b0b873f388" rel="noopener">第2部分</a>讲的是我们是如何做到的，<a class="ae ki" href="https://noriste.medium.com/migrating-a-150k-loc-codebase-to-vite-and-esbuild-is-it-worthwhile-part-3-3-5a12894bac96" rel="noopener">第3部分</a>讲的是事后分析。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/bcb10b44d9c861d20ffd53f0809f90b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1asz_EDOb6l3XN7Fux74BQ.png"/></div></div></figure><h1 id="3555" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">从Webpack的慢到Vite</h1><p id="d38e" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">总是同一个故事:你开始在一个分支上工作，运行<code class="fe ly lz ma mb b">yarn start</code> <strong class="jm io">并等待两分钟</strong>。然后你保存一个文件，等待20或30秒，应用程序就会刷新。然后，您在您正在处理的分支之间切换多次，并且您需要再次重新启动dev服务器。如此糟糕的开发者体验。</p><p id="d6cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们通过转移到<a class="ae ki" href="https://vitejs.dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> Vite </strong> </a>和<a class="ae ki" href="https://esbuild.github.io/" rel="noopener ugc nofollow" target="_blank"> ESBuild </a>来减少这个问题。继续读下去。</p><p id="4686" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">WorkWave RouteManager的UI团队每天都在开发一个150K LOC(并且还在增长，大约250K LOC是最终大小)的代码库。由于产品的性质和技术限制，目前我们无法将应用程序分成小块。75%的代码由所有应用程序部分共享和使用。</p><p id="d296" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该应用基于<strong class="jm io"> React和TypeScript </strong>，跨越<strong class="jm io"> Web Worker </strong>，使用Webpack、babel-loader、ts-loader和<a class="ae ki" href="https://github.com/TypeStrong/fork-ts-checker-webpack-plugin" rel="noopener ugc nofollow" target="_blank"> fork-ts-checker </a>来捆绑和验证代码。所有依赖项每周更新一次。</p><p id="c0d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最近，<a class="ae ki" href="https://dev.to/yyx990803/announcing-vite-2-0-2f0a" rel="noopener ugc nofollow" target="_blank"> Vite 2.0 </a>已经发布。它的核心思想很简单:利用<a class="ae ki" href="https://hacks.mozilla.org/2018/03/es-modules-a-cartoon-deep-dive/" rel="noopener ugc nofollow" target="_blank"> ESModules </a>将文件“按原样”提供给浏览器。当浏览器解析源文件并向web服务器请求导入文件时，Vite会这样做</p><ul class=""><li id="3966" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh mh mi mj mk bi translated">将NPM依赖项转换为ESModules并为其服务</li><li id="6e01" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">通过<a class="ae ki" href="https://github.com/evanw/esbuild" rel="noopener ugc nofollow" target="_blank"> ESBuild </a>传输你的源代码</li><li id="1cf5" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">将代码提供给浏览器</li></ul><p id="2afb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是什么意思？意思是<strong class="jm io"> Vite不提前捆绑代码</strong>。相反，当浏览器要求一个文件时，Vite转换它。一张图胜过千言万语。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi mq"><img src="../Images/d7ecb2659d9b621855556bceb2c822d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iV_EYBUlkinreNmfd7a6iQ.jpeg"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">The browser loading the thousands of unbundled .ts and .tsx files.</figcaption></figure><p id="c8d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">文件被缓存，但是<strong class="jm io"> Vite从本质上消除了构建工具的负担，将它转移到浏览器</strong>。你可以阅读更多关于<a class="ae ki" href="https://vitejs.dev/guide/why.html" rel="noopener ugc nofollow" target="_blank"> Vite docs </a>或者CSS-Tricks的<a class="ae ki" href="https://css-tricks.com/comparing-the-new-generation-of-build-tools/" rel="noopener ugc nofollow" target="_blank">比较新一代构建工具</a>的文章。</p><p id="e7c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">建筑怎么样？Vite利用Rollup来构建项目，不用担心最终捆绑包的浏览器兼容性。</p><h1 id="6c74" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">维特的优点</h1><p id="875b" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">与Webpack不同，Vite不是一个通用工具。<strong class="jm io"> Vite支持几个甜区</strong>。如果你的项目属于这些点，Vite提供</p><ul class=""><li id="ad8d" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh mh mi mj mk bi translated">得益于ESBuild的速度，性能更佳。</li><li id="7ef0" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">配置少。</li><li id="22ef" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">更少的依赖性:像我们这样的React+TypeScript项目所需的一切都由Vite直接管理，<strong class="jm io"> React快速刷新包括在内</strong>。</li></ul><p id="239f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但不是所有闪光的都是金子！Vite不包括哪些<strong class="jm io"/>？</p><ul class=""><li id="1d6d" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh mh mi mj mk bi translated">TypeScript验证:简而言之，ESBuild删除类型批注而不验证它们。您必须自己运行<code class="fe ly lz ma mb b">tsc</code>来验证类型。</li><li id="5eed" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">这取决于您的配置，但是在我们的例子中，ESLint的运行要感谢fork-ts-checker。Vite不在乎ESLint。</li></ul><p id="863e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mv">注意:我将在本系列</em>  <em class="mv">的第三部分</em> <a class="ae ki" href="https://noriste.medium.com/migrating-a-150k-loc-codebase-to-vite-and-esbuild-is-it-worthwhile-part-3-3-5a12894bac96" rel="noopener"> <em class="mv">中谈论这些缺失，包括一些关于Vite和Webpack的客观考虑以及整体开发者体验。</em></a></p><p id="cafa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后同样重要的一点:<strong class="jm io">Vite及其生态系统是否足够成熟</strong>？</p><ul class=""><li id="2b60" class="mc md in jm b jn jo jr js jv me jz mf kd mg kh mh mi mj mk bi translated">生态圈喜欢:比如<a class="ae ki" href="https://storybook.js.org/blog/storybook-6-2/" rel="noopener ugc nofollow" target="_blank">故事书会支持</a>，<a class="ae ki" href="https://www.cypress.io/blog/2021/04/06/introducing-the-cypress-component-test-runner/" rel="noopener ugc nofollow" target="_blank">柏树对Vite </a>有一流的支持。</li><li id="12b6" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">Vite的创造者尤雨溪和Vue一样。</li><li id="e940" class="mc md in jm b jn ml jr mm jv mn jz mo kd mp kh mh mi mj mk bi translated">我们只有一个关于Vite的依赖的问题，Evan在不到两天的时间里就解决了。</li></ul><p id="aab1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后:赌Vite是没有风险的。无论如何，我们决定保持代码库与Webpack兼容，以便在遇到麻烦时在Vite和Webpack之间进行交换。</p><h1 id="a1a8" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">基准</h1><p id="ae68" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">为了让您对性能改进有所了解，请看一下我们早期的基准测试，也就是我与团队其他成员分享的那些</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f9d1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后，让代码库ESBuild-ready允许我们也让Webpack节食，这些是我们的最终基准。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="0696" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">迁移代码库</h1><p id="c82a" class="pw-post-body-paragraph jk jl in jm b jn lt jp jq jr lu jt ju jv lv jx jy jz lw kb kc kd lx kf kg kh ig bi translated">本系列的第二部分深化了我们代码库迁移的技术细节。<a class="ae ki" href="https://noriste.medium.com/migrating-a-150k-loc-codebase-to-vite-and-esbuild-is-it-worthwhile-part-3-3-5a12894bac96" rel="noopener">第三部分</a>是关于结论、DX以及与Webpack更公平的比较。</p></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><p id="ad6a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大家好，我是斯特凡诺·马尼，我是一名充满激情的<strong class="jm io">前端工程师</strong>，一名<strong class="jm io">演讲者</strong>和一名<strong class="jm io">讲师</strong>。我作为高级前端工程师/团队领导为<a class="ae ki" href="https://www.workwave.com/" rel="noopener ugc nofollow" target="_blank">工作波</a>远程工作。</p><p id="5426" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我喜欢创造高质量的产品，测试和自动化一切，学习和分享我的知识，帮助别人，在会议上发言，面对新的挑战。</p><p id="13b9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以在<a class="ae ki" href="https://twitter.com/NoriSte?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae ki" href="https://github.com/NoriSte?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae ki" href="https://www.linkedin.com/in/noriste/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上找到我。你可以找到我最近所有的投稿/演讲等。关于<a class="ae ki" href="https://github.com/NoriSte/all-my-contributions" rel="noopener ugc nofollow" target="_blank">我的GitHub总结</a>。</p><p id="5e14" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mv">更多内容请看</em><a class="ae ki" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mv">plain English . io</em></a></p></div></div>    
</body>
</html>