<html>
<head>
<title>How to Automatically Reload a Page After a Given Period of Inactivity in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中如何在给定的不活动时间后自动重新加载页面？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-automatically-reload-a-page-after-a-given-period-of-inactivity-in-javascript-991d632d1f80?source=collection_archive---------2-----------------------#2021-08-31">https://javascript.plainenglish.io/how-to-automatically-reload-a-page-after-a-given-period-of-inactivity-in-javascript-991d632d1f80?source=collection_archive---------2-----------------------#2021-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/7b89e3131031e34d734194c6936ef0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZPmjXyfOxx8Y0DD-"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@dunamis_church?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Dunamis Church</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4ca8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们希望在网页上不活动一段时间后自动重新加载页面。</p><p id="2da2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何用JavaScript在一段给定的不活动时间后自动重新加载页面。</p><h1 id="20f6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">记录有活动的时间</h1><p id="4c22" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以监听<code class="fe me mf mg mh b">mousemove</code>和<code class="fe me mf mg mh b">keypress</code>事件，让我们分别监听鼠标和键盘活动。</p><p id="1986" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以在事件侦听器中记录用户最后一次使用页面的时间。</p><p id="085e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用这个时间来计算用户最后一次使用这个页面是多久以前。</p><p id="c2b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="69e1" class="mq lc iq mh b gy mr ms l mt mu">let time = new Date().getTime();<br/>const setActivityTime = (e) =&gt; {<br/>  time = new Date().getTime();<br/>}<br/>document.body.addEventListener("mousemove", setActivityTime);<br/>document.body.addEventListener("keypress", setActivityTime);</span><span id="9406" class="mq lc iq mh b gy mv ms l mt mu">const refresh = () =&gt; {<br/>  if (new Date().getTime() - time &gt;= 60000) {<br/>    window.location.reload(true);<br/>  } else {<br/>    setTimeout(refresh, 10000);<br/>  }<br/>}</span><span id="dc50" class="mq lc iq mh b gy mv ms l mt mu">setTimeout(refresh, 10000);</span></pre><p id="1b69" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe me mf mg mh b">time</code>变量，它以毫秒为单位的时间戳作为初始值。</p><p id="5806" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们有了<code class="fe me mf mg mh b">setActivityTime</code>事件监听器，我们用它来设置用户最后一次使用页面的<code class="fe me mf mg mh b">time</code>。</p><p id="5804" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们监听<code class="fe me mf mg mh b">mousemove</code>和<code class="fe me mf mg mh b">keypress</code>事件，并使用<code class="fe me mf mg mh b">setActivityTime</code>作为事件监听器来记录用户最后一次与页面交互的时间。</p><p id="e908" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们有了<code class="fe me mf mg mh b">refresh</code>函数，它检查用户最后一次与页面交互的时间。</p><p id="68a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果时间超过60秒，那么我们调用<code class="fe me mf mg mh b">location.reload</code>重新加载页面。</p><p id="5b91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">否则，我们在10秒后再次调用<code class="fe me mf mg mh b">refresh</code>再次检查。</p><p id="6f9a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，如果超过60秒没有交互，页面应该会刷新。</p><h1 id="8108" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="1ea9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以记录用户与页面交互的最新时间。</p><p id="157f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们可以检查最后一次页面活动是在多久之前，如果需要，可以根据时间比较进行刷新。</p><p id="ea70" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>