<html>
<head>
<title>How to Observe Changes to the DOM without using a JavaScript framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在不使用JavaScript框架的情况下观察DOM的变化</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-observe-changes-to-the-dom-without-using-a-javascript-framework-38eee2c65822?source=collection_archive---------10-----------------------#2021-06-27">https://javascript.plainenglish.io/how-to-observe-changes-to-the-dom-without-using-a-javascript-framework-38eee2c65822?source=collection_archive---------10-----------------------#2021-06-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="84ea" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用变异观察器来观察和识别任何DOM元素发生的变化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8ab6155cce9b9fa471799daf34bdf387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-_Ey1S3GTJ7aLB_J.jpg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo courtesy of the National Cancer Institute on Unsplash</figcaption></figure><p id="1e36" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">大约十年前，我在web应用程序中使用jQuery来操作文档对象模型(DOM)。jQuery已经被Angular、Backbone和React等其他框架所取代。这些框架几乎已经成为web开发的标准。</p><p id="3a69" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">几年前，我遇到过这样一种情况，我必须观察特定DOM元素的变化，并删除WebView中由另一个框架添加的任何子元素。虽然在该框架中更改代码而不添加这些不必要的DOM元素会更理想，但我没有这个选择。</p><h1 id="f7a9" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">欢迎突变观察者</h1><p id="f2bc" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">变异观察器允许您监控对DOM所做的任何更改，并在需要时运行您自己的代码。如果添加、删除任何元素或者添加或更改属性，则可以使用该代码。突变观察者是我们从浏览器免费获得的Web APIs之一。</p><p id="287f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们使用这个API的一个常见场景是，如果一个<code class="fe mo mp mq mr b">div</code>元素被添加到一个特定的部分，并且我们想要添加一个事件监听器用于鼠标悬停。</p><p id="120a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">MutationObserver需要一个构造函数，该函数用于处理这些突变。构造函数将突变列表和一个观察器作为参数。</p><p id="2c25" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在定义了一个MutationObserver之后，您还需要选择想要观察的元素或节点，并在MutationObserver对象上调用Observer函数。observe函数有两个参数，一个是要观察的元素，另一个是我们要传递给观察者的选项。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="a0bc" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">变异观察器选项</h1><p id="bb27" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">变异观察器让我们传递许多不同的选项来观察我们想要观察的东西。您可以观察正在观察的DOM元素的树结构下的所有项目。您还可以观察元素的属性变化。为了让观察者观察到一个节点，至少<code class="fe mo mp mq mr b">childList</code>、<code class="fe mo mp mq mr b">attributes</code>和/或<code class="fe mo mp mq mr b">characterData</code>必须为真。以下是您可以传递的不同选项的列表。</p><ul class=""><li id="6890" class="mu mv iq kx b ky kz lb lc le mw li mx lm my lq mz na nb nc bi translated">子树</li><li id="6742" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">子列表</li><li id="bcbf" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">属性</li><li id="3d4f" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">属性过滤器</li><li id="cb42" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">attributeOldValue</li><li id="8564" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">字符数据</li><li id="7086" class="mu mv iq kx b ky nd lb ne le nf li ng lm nh lq mz na nb nc bi translated">characterDataOldValue</li></ul><h1 id="35ab" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">单击监听器示例</h1><p id="da78" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">一个我们如何使用变异观察器的例子是，如果我们向一个HTML中的元素添加一个div元素，并且我们想在鼠标经过该元素时向div元素添加一个事件监听器。“让我们”创建一个id为“div_section”的节；</p><pre class="kg kh ki kj gt ni mr nj nk aw nl bi"><span id="74c5" class="nm ls iq mr b gy nn no l np nq">&lt;section id="div_section"&gt;</span><span id="da48" class="nm ls iq mr b gy nr no l np nq">&lt;/section&gt;</span></pre><p id="531a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在让我们写一些JavaScript来添加一个<code class="fe mo mp mq mr b">div</code>元素到这个部分。</p><pre class="kg kh ki kj gt ni mr nj nk aw nl bi"><span id="55a4" class="nm ls iq mr b gy nn no l np nq">const section = document.querySelector('#div_section');</span><span id="eda7" class="nm ls iq mr b gy nr no l np nq">let my_div_element = document.createElement('div');</span><span id="c909" class="nm ls iq mr b gy nr no l np nq">my_div_element.className = 'div_element';</span><span id="f984" class="nm ls iq mr b gy nr no l np nq">my_div_element.textContent = `My content goes here`;</span><span id="68f5" class="nm ls iq mr b gy nr no l np nq">section.appendChild(my_div_element);</span></pre><p id="f921" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦JavaScript被执行，产生的HTML将如下所示。</p><pre class="kg kh ki kj gt ni mr nj nk aw nl bi"><span id="1835" class="nm ls iq mr b gy nn no l np nq">&lt;section id="div_section"&gt;</span><span id="a95b" class="nm ls iq mr b gy nr no l np nq">    &lt;div class="div_element"&gt;My content goes here&lt;/div&gt;</span><span id="c9d4" class="nm ls iq mr b gy nr no l np nq">&lt;/section&gt;</span></pre><p id="96e6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，让我们编写一个事件处理程序，在事件被触发时打印console.log。</p><pre class="kg kh ki kj gt ni mr nj nk aw nl bi"><span id="2c17" class="nm ls iq mr b gy nn no l np nq">function eventMouseOver(event) {</span><span id="abd9" class="nm ls iq mr b gy nr no l np nq">    console.log('This element was just moused over');</span><span id="25ea" class="nm ls iq mr b gy nr no l np nq">}</span></pre><p id="1cf1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，我们可以编写一个变异观察器，以便在任何时候向我们的部分添加一个带有类<code class="fe mo mp mq mr b">div_element</code>的新的<code class="fe mo mp mq mr b">div</code>元素时添加这个事件监听器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="ee0a" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，每当有人将鼠标放在我们的div元素上时，我们都会得到一条console.log消息，表明鼠标已经被放在上面。</p><p id="e6af" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个完整的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ms mt l"/></div></figure><h1 id="c0c9" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated"><strong class="ak">结论</strong></h1><p id="ac11" class="pw-post-body-paragraph kv kw iq kx b ky mj jr la lb mk ju ld le ml lg lh li mm lk ll lm mn lo lp lq ij bi translated">正如我们在上面的例子中看到的，变异观察者给了web开发人员很多控制DOM的能力。尤其是在用例中，我们可能需要使用另一个框架，这个框架可能以我们无法控制的方式操纵我们的HTML。</p><p id="8884" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我的场景中有一些框架不断遍历整个DOM寻找变化。当您使用突变观察者API时，这是不必要的。查看下面的文档。</p><div class="ns nt gp gr nu nv"><a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd ir gy z fp oa fr fs ob fu fw ip bi translated">变异观察器-Web API | MDN</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">MutationObserver接口提供了监视对DOM树进行更改的能力。它被设计成…</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">developer.mozilla.org</p></div></div><div class="oe l"><div class="of l og oh oi oe oj kp nv"/></div></div></a></div><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok mt l"/></div></figure><p id="fcef" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ol">最初发布于</em><a class="ae om" href="https://fek.io/blog/how-to-observe-changes-to-the-dom-without-using-a-java-script-framework/" rel="noopener ugc nofollow" target="_blank"><em class="ol">https://fek . io</em></a><em class="ol">。</em></p></div></div>    
</body>
</html>