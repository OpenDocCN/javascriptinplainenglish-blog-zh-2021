<html>
<head>
<title>GatsbyJS Page Queries with Environment Variables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有环境变量的GatsbyJS页面查询</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/gatsby-page-queries-with-environment-variables-1eae8557ee01?source=collection_archive---------5-----------------------#2021-04-17">https://javascript.plainenglish.io/gatsby-page-queries-with-environment-variables-1eae8557ee01?source=collection_archive---------5-----------------------#2021-04-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="4641" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">中间的，代码味的</h2><div class=""/><div class=""><h2 id="dd63" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">实施降价发布工作流程时学习</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/b8ccf8c914bb486e7589ff2b344c017c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFVnoOs6DQnYh3WqijGJSg.jpeg"/></div></div></figure><p id="b2f6" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们将讨论的核心问题是在对<code class="fe lt lu lv lw b">src\pages</code>文件夹中的页面进行页面查询时使用环境变量。这显然是一个常见的问题(<a class="ae lx" href="https://github.com/gatsbyjs/gatsby/issues/10023" rel="noopener ugc nofollow" target="_blank">例</a>)。在我让它工作之前，我确实很努力。我们还将讨论页面查询、变量和<code class="fe lt lu lv lw b">createPage</code>动作。</p><h2 id="ad00" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">降价发布工作流程:</h2><p id="1e45" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我的博客使用<a class="ae lx" href="https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog" rel="noopener ugc nofollow" target="_blank"> Gatsby Starter Blog </a>，它从Markdown (MD)文件加载博客文章。它会列出并加载所有的博客文章，不管你是否写完了。</p><p id="227c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我想要一个标准的发布工作流程:文章将根据它们的“状态”显示在网站上。状态可以是“草稿”、“已发布”或“已存档”。</p><p id="902e" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">当我处于“gatsby develop”模式时，我希望发布“已发布”<em class="mv">和</em>“草稿”文章。然后，我可以在编辑/保存文章草稿时看到它们的样子。</p><p id="4928" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">当我运行<code class="fe lt lu lv lw b">gatsby build; gatsby serve</code>时，我想只显示status = "published "的文章。最好使用<em class="mv">环境变量(env vars)来完成。</em>当您想要存储根据您发布到的模式(开发与生产)或位置(中国与美国)而变化的信息(也称为变量)时，Env变量最有用。</p><h2 id="6c4b" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated"><strong class="ak">前台状态字段</strong></h2><p id="a1e6" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">要添加一个发布工作流，首先我要在index.md文件的顶部为每篇文章的<a class="ae lx" href="https://www.gatsbyjs.com/docs/how-to/routing/adding-markdown-pages/#frontmatter-for-metadata-in-markdown-files" rel="noopener ugc nofollow" target="_blank"> frontmatter </a>添加一个<code class="fe lt lu lv lw b">status</code>字段。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7e99" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">下面的查询将读取<code class="fe lt lu lv lw b">status</code>字段值。</p><h2 id="6b2f" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">在盖茨比中使用环境变量</h2><p id="ca2b" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我在node中使用环境变量，最流行的包是<a class="ae lx" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a>。盖茨比显然与dotenv同船；你只需要“激活”它。要激活环境变量，请在<code class="fe lt lu lv lw b">gatsby-config.js</code>或<code class="fe lt lu lv lw b">gatsby-node.js.</code>的顶部包含此代码</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="13d6" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">现在，Gatsby将在站点的根文件夹中寻找两个可选文件:</p><ul class=""><li id="6dde" class="my mz in kz b la lb ld le lg na lk nb lo nc ls nd ne nf ng bi translated"><code class="fe lt lu lv lw b">.env.development</code>:运行<code class="fe lt lu lv lw b">gatsby develop</code>时加载数值</li><li id="b3b3" class="my mz in kz b la nh ld ni lg nj lk nk lo nl ls nd ne nf ng bi translated"><code class="fe lt lu lv lw b">.env.production</code>:运行<code class="fe lt lu lv lw b">gatsby build</code>时加载数值</li></ul><p id="bcd8" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">注意:对您的。env文件需要Gatsby重启。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><blockquote class="nm nn no"><p id="ab0f" class="kx ky mv kz b la lb jx lc ld le ka lf np lh li lj nq ll lm ln nr lp lq lr ls ig bi translated">注意:。env文件应该在本地git中<strong class="kz ix"> <em class="in">忽略</em> </strong>。这些文件通常最终保存着<strong class="kz ix">秘密</strong>，比如api密匙，它们不应该在你的git repo中。盖茨比把<code class="fe lt lu lv lw b">.env.*</code>加到你的名字里。git自动忽略文件。这意味着。env文件不会在你的发布服务的git repo中，就像<a class="ae lx" href="https://docs.netlify.com/configure-builds/environment-variables/" rel="noopener ugc nofollow" target="_blank"> Netlify </a>或<a class="ae lx" href="https://support.gatsbyjs.com/hc/en-us/articles/360053096753-Managing-Environment-Variables" rel="noopener ugc nofollow" target="_blank"> Gatsby Cloud </a>一样，无法读取。要使env变量可用于您的发布服务，您需要将它们复制到发布服务。选项因发布服务而异。</p></blockquote><h2 id="e903" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">在我们的代码中加入环境变量</h2><p id="e04a" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我们将使用变量<code class="fe lt lu lv lw b">arBlogStatusesToShow</code>过滤所有的博客文章，筛选出我们想要显示的内容。我们将根据环境变量<code class="fe lt lu lv lw b">BLOG_STATUSES_TO_SHOW_LIST</code>填充<code class="fe lt lu lv lw b">arBlogStatusesToShow</code>。我在那里添加了“_LIST ”,以确保任何使用该变量的人都知道它是一个字符串列表，而不是一个数组。</p><blockquote class="nm nn no"><p id="f5c2" class="kx ky mv kz b la lb jx lc ld le ka lf np lh li lj nq ll lm ln nr lp lq lr ls ig bi translated">根据多年的经验，我建议使用描述性很强的变量和函数名。你的大部分代码将来会被其他人编辑，或者在你忘记发生了什么之后很久还会被你编辑。几乎没有人阅读文档，否则文档会不准确。代码是事实的基本来源，如果代码冗长且“像散文一样”，程序员会更快地找到它。</p></blockquote><p id="c51e" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我的工作流程需要使用允许状态的<strong class="kz ix">列表</strong>对状态字段进行过滤。因此，我们将BLOG _ status _ TO _ SHOW _ LIST = " published，draft "转换为下面第7行的JavaScript数组。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="c976" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated">Gatsby GraphQL概述</h1><p id="f7a6" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">在让我的代码工作之后，这是我对Gatsby中GraphQL变量的理解。有<strong class="kz ix">两大类:</strong></p><p id="acfd" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">1.<strong class="kz ix">静态查询</strong>(又名“组件查询”)只运行一次。不允许变量。我在工作流程中没有使用任何工具。</p><p id="2fdb" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">2.<strong class="kz ix">页面查询</strong>(又名“普通查询”)。这些有两种口味:</p><ul class=""><li id="a509" class="my mz in kz b la lb ld le lg na lk nb lo nc ls nd ne nf ng bi translated">在<code class="fe lt lu lv lw b">src\pages</code>文件夹中页面底部的页面查询。盖茨比自动在上面运行<code class="fe lt lu lv lw b">createPage()</code>。<strong class="kz ix">在自动构建期间，您不能将变量直接传递给这些查询。</strong></li><li id="7256" class="my mz in kz b la nh ld ni lg nj lk nk lo nl ls nd ne nf ng bi translated">在<code class="fe lt lu lv lw b">gatsby-node.js</code>中执行的页面查询。</li></ul><p id="c87c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lt lu lv lw b">gatsby-node.js</code>中的页面查询可以通过以下方式创建页面:</p><ul class=""><li id="72e8" class="my mz in kz b la lb ld le lg na lk nb lo nc ls nd ne nf ng bi translated">使用<code class="fe lt lu lv lw b">src\template</code>文件配合<code class="fe lt lu lv lw b">createPage()</code>动作。</li><li id="820d" class="my mz in kz b la nh ld ni lg nj lk nk lo nl ls nd ne nf ng bi translated">使用<code class="fe lt lu lv lw b">deletePage()</code>删除<code class="fe lt lu lv lw b">src\pages</code>页面，然后<strong class="kz ix">用<code class="fe lt lu lv lw b">createPage().</code> <strong class="kz ix">重新创建</strong>页面。这是在构建时将变量(包括env vars)传递到</strong> <code class="fe lt lu lv lw b"><strong class="kz ix">src\pages</strong></code> <strong class="kz ix">页面的唯一方法。</strong></li></ul><h1 id="8fa7" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated"><strong class="ak">选项1。使用src \模板文件</strong></h1><p id="d58e" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">这种方法在<a class="ae lx" href="https://www.gatsbyjs.com/starters/gatsbyjs/gatsby-starter-blog" rel="noopener ugc nofollow" target="_blank"> Gatsby Starter博客</a>中有很好的记录。下面，我们使用模板文件为每篇博客文章创建一个单独的页面。</p><p id="7754" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">注意第10行的过滤器代码。我不得不使用<code class="fe lt lu lv lw b">JSON.stringify(arBlogStatusesToShow)</code>在查询中正确格式化JavaScript数组。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="abe3" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">请注意下面第4–6行中GraphQL查询变量的使用。它们与上面传入的<code class="fe lt lu lv lw b">context</code>对象中的值同名。<strong class="kz ix"> <em class="mv">如果您想将值传递给查询，这是必需的。</em> </strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="5bab" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated"><strong class="ak">选项2。使用src \ pages文件:删除然后重新创建</strong></h1><p id="2adc" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我添加了页面<code class="fe lt lu lv lw b">src\pages\bloglist.js</code>来演示一种将变量传递给页面查询的方法。</p><p id="8dc9" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">因为它在<code class="fe lt lu lv lw b">pages</code>文件夹中，所以页面上的查询将在构建期间自动运行。届时，它将不会返回任何博客帖子，因为<code class="fe lt lu lv lw b">allowedBlogStatuses</code> var将是“未定义的”。</p><blockquote class="nm nn no"><p id="ff9f" class="kx ky mv kz b la lb jx lc ld le ka lf np lh li lj nq ll lm ln nr lp lq lr ls ig bi translated"><strong class="kz ix"> <em class="in">理解页面文件夹自动查询解析和尝试运行是在没有访问传入变量的情况下发生的，这一点至关重要。我浪费了很多时间去寻找如何去做，因为我不相信这是不可行的。</em> </strong></p></blockquote><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="8cbe" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">接下来，在下面的代码中，我们删除然后重新创建页面，并作为一个变量传入允许的状态数组。</p><p id="1ad2" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">注意事项:</p><ul class=""><li id="8849" class="my mz in kz b la lb ld le lg na lk nb lo nc ls nd ne nf ng bi translated">使用这种方法，我不必<code class="fe lt lu lv lw b">JSON.stringify()</code>数组。显然，当您使用<code class="fe lt lu lv lw b">context</code>对象时，盖茨比会自动为您这样做。</li><li id="cb31" class="my mz in kz b la nh ld ni lg nj lk nk lo nl ls nd ne nf ng bi translated">上面的<code class="fe lt lu lv lw b">src\pages\bloglist.js</code>页面使用的变量名是<code class="fe lt lu lv lw b">allowedBlogStatuses</code>。我们传进去的是<code class="fe lt lu lv lw b">arBlogStatusesToShow</code>。只要<code class="fe lt lu lv lw b">context</code>对象左侧的变量名与页面查询中的变量名匹配，这就没问题。右边的名字是任意的，但是按照惯例，是一样的。当上下文变量的左侧和右侧相同时，您可以简单地陈述查询变量的名称，而不用赋值。</li><li id="e6b5" class="my mz in kz b la nh ld ni lg nj lk nk lo nl ls nd ne nf ng bi translated">特别注意下面的<code class="fe lt lu lv lw b">exports.onCreatePage</code>，第3行。</li></ul><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="5a73" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">下图来自Chrome开发工具。它显示了在运行时通过<code class="fe lt lu lv lw b">page-data.json</code>为<code class="fe lt lu lv lw b">/bloglist/</code>实际传递到您的web页面的内容。它只包含你想要的博客文章。它还包括<code class="fe lt lu lv lw b">testString</code>值。(点击放大):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi od"><img src="../Images/8b4a8bca81097adae1b24d1b6e357376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LU1RCIrqHb-3T-eqiP2f9Q.png"/></div></div></figure><h1 id="25bc" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated"><strong class="ak">选项3。使用src\templates文件，传入查询结果</strong></h1><p id="0a5a" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">在这种方法中，我将我的主页从<code class="fe lt lu lv lw b">src\pages\index.js</code>移到了<code class="fe lt lu lv lw b">src\templates\index.js</code>，向您展示文件位置是相当随意的。</p><p id="0b1a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><strong class="kz ix"> <em class="mv">我还把index.js底部的GraphQL去掉了，页面上没有GraphQL查询。相反，我完全在<code class="fe lt lu lv lw b">gatsby-node.js</code>中编写和运行查询，并通过<code class="fe lt lu lv lw b">context</code>对象传入结果集<code class="fe lt lu lv lw b">blogPostListResults</code>。</em></strong></p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="005a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lt lu lv lw b">path: “/"</code> arg将使模板成为<a class="ae lx" href="http://www.edpike365.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ix">www.edpike365.com/</strong></a>的主页</p><p id="e0ae" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">下面的代码没有使用<code class="fe lt lu lv lw b">data</code>对象。它将是空的。<code class="fe lt lu lv lw b">pageContext</code>对象将包含一个数据对象，该数据对象包含<code class="fe lt lu lv lw b">data</code>通常包含的所有信息。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="e06c" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated">附录a .神奇的“盖茨比_”环境变量</h1><p id="47d2" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">以<code class="fe lt lu lv lw b">GATSBY_</code>开头命名的Env变量将可用于您的服务器端NodeJS代码，就像任何env变量(gatsby-config.js、gatsby-node.js和它们导入的任何代码)一样。</p><p id="b20b" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lt lu lv lw b">GATSBY_</code> env var的值被<strong class="kz ix"> <em class="mv">也</em> </strong>注入到你的页面或者模板JSX中去，在<strong class="kz ix"><em class="mv"/></strong><em class="mv">页面之前【JSX】</em>被发送到网页浏览器。<strong class="kz ix">它们不会作为变量出现在page-data.json文件中。</strong></p><p id="450f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在. env文件中声明变量:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="b281" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在你的JSX页面中使用它(第8行):</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="3199" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">值被注入到源代码中。这是Chrome开发工具的截图。用<code class="fe lt lu lv lw b">var gatsbyTestValue</code>标注第28行。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi oe"><img src="../Images/d35bed1107c9cf7e68b47cc567e2c880.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbvzMLpafE8xVfCfntW7dA.png"/></div></div></figure><blockquote class="nm nn no"><p id="8f9b" class="kx ky mv kz b la lb jx lc ld le ka lf np lh li lj nq ll lm ln nr lp lq lr ls ig bi translated"><strong class="kz ix">主要问题</strong>:如果您的页面在<code class="fe lt lu lv lw b">src\pages</code>中，<code class="fe lt lu lv lw b">GATSBY_</code> env变量在自动构建期间不可用于“页面内”查询。</p></blockquote><h1 id="0817" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated">附录b .部署到Netlify</h1><p id="13c1" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我在Github和Netlify上主持。我没有使用盖茨比Netlify插件。</p><p id="aae5" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">存储环境变量有两个选项:</p><h2 id="472e" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">选项1: Netlify配置文件</h2><p id="df39" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">将您的env变量放在根文件夹中的一个<code class="fe lt lu lv lw b">netlify.toml</code>文件中。它们将在<code class="fe lt lu lv lw b">process.env</code>中可用，就像使用<code class="fe lt lu lv lw b">.env</code>文件一样。但是，您的git repo中必须有这个文件。这不是首选，因为在某些时候您需要存储机密。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h2 id="e35f" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">选项2: Netlify构建设置</h2><p id="a3c0" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">到了<a class="ae lx" href="http://app.netlify.com/sites/_your_project_name_/settings/deploys" rel="noopener ugc nofollow" target="_blank">app.netlify.com/sites/_your_project_name_/settings/deploys</a></p><p id="bfab" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在该页面上，转到<strong class="kz ix"> &gt;构建&amp;部署&gt;环境&gt;编辑设置</strong>按钮</p><blockquote class="nm nn no"><p id="738a" class="kx ky mv kz b la lb jx lc ld le ka lf np lh li lj nq ll lm ln nr lp lq lr ls ig bi translated">明白了:不要把“值”放在引号中。当您引用process.env变量时，会为您添加它们。我使用了一个数组，所以它看起来像这样:</p></blockquote><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi of"><img src="../Images/c2b28d3a89ecd66fd616f65817eab8f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMTghVgBKjHPY3xoaQZFXA.png"/></div></div></figure><h1 id="ac00" class="ns lz in bd ma nt nu nv md nw nx ny mg kc nz kd mj kf oa kg mm ki ob kj mp oc bi translated"><strong class="ak">附录c .在客户端JSX中使用查询过滤结果</strong></h1><p id="df49" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">我认为值得一提的是我一路走来学到的一些东西。谢天谢地，我在发布我的发布工作流的这个版本之前发现了它。</p><p id="9e92" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在这种方法中，<code class="fe lt lu lv lw b">index.js</code>页面上的查询没有过滤器。您将获得页面的“数据”对象中的所有博客条目，不管它们的<code class="fe lt lu lv lw b">status</code>。这将发生在<code class="fe lt lu lv lw b">src/pages</code>自动构建期间。然后我根据全局<code class="fe lt lu lv lw b">GATSBY_BLOG_STATUS</code>环境变量过滤它们。</p><p id="a02a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">将var添加到您的<code class="fe lt lu lv lw b">.env.development</code>文件中。别忘了重启盖茨比:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="bf0f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">然后添加一个过滤函数:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="f58a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这似乎行得通；当您查看网页时，它只显示“已发布”和“草稿”博客文章的摘要。但是，它有一个可伸缩性问题，您可以在下面的page-data.json中看到:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi og"><img src="../Images/7ea62057523682a0c23372d8a1152c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q_RwGSuGIJXF21JcE3d36Q.png"/></div></div></figure><p id="8348" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">正如你在Chrome开发工具“网络&gt;预览”标签中看到的，<code class="fe lt lu lv lw b">result.data.allMarkDownRemark.nodes</code>包含博客条目摘要。可惜的是，它包含了<strong class="kz ix"> <em class="mv">所有</em> </strong>的博客文章，<strong class="kz ix"> <em class="mv">不计地位</em> </strong>。因此，即使我的“存档”博客帖子也会在那里。</p><p id="34db" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">每次网站加载时，我的所有博客条目的摘要都会通过网络发送(尽管有存储空间)。随着我博客的增长，这将成为一个严重的问题。</p><p id="539f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">另一方面，如果我希望能够在运行时进行过滤，我可以让它们都可用。我甚至可以把它们都添加到Redux商店。</p><h2 id="ad29" class="ly lz in bd ma mb mc dn md me mf dp mg lg mh mi mj lk mk ml mm lo mn mo mp it bi translated">结论</h2><p id="714e" class="pw-post-body-paragraph kx ky in kz b la mq jx lc ld mr ka lf lg ms li lj lk mt lm ln lo mu lq lr ls ig bi translated">嗯，就这些。我希望这有所帮助！有什么想法吗？如果是这样，一定要在评论里继续讨论。</p><p id="6e58" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><em class="mv">更多内容看</em> <a class="ae lx" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kz ix"> <em class="mv">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>