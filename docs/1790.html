<html>
<head>
<title>An Introduction to the Basics of JavaScript Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript测试基础介绍</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/basics-of-javascript-testing-5bdb7f7f1fe3?source=collection_archive---------16-----------------------#2021-04-15">https://javascript.plainenglish.io/basics-of-javascript-testing-5bdb7f7f1fe3?source=collection_archive---------16-----------------------#2021-04-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/72b2b640c61acfee16e9f379473443cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CSGyNhAiO-2T7Aqz"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@goshua13?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joshua Aragon</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fa30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可能会想:<strong class="kc io"> </strong>“等等，又一篇关于JavaScript测试的文章？”</p><p id="5f7c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">是的，我愿意更多地谈论JavaScript测试基础的原因是，围绕这个主题的许多文章都是以非常相似的方式构建的——通过展示代码片段和工具来编写JavaScript测试。</p><p id="3abc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文将采用不同的方法来测试JavaScript，以及如何构建像断言库或测试框架这样的工具。</p><p id="f938" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文中使用的例子来自<a class="ae jz" href="http://testingjavascript.com" rel="noopener ugc nofollow" target="_blank">TestingJavaScript.com</a>作者<a class="ky kz ep" href="https://medium.com/u/db72389e89d8?source=post_page-----5bdb7f7f1fe3--------------------------------" rel="noopener" target="_blank">肯特·c·多兹</a>。</p><h2 id="f517" class="la lb in bd lc ld le dn lf lg lh dp li kl lj lk ll kp lm ln lo kt lp lq lr ls bi translated">用普通JavaScript创建一个简单的测试</h2><p id="f78e" class="pw-post-body-paragraph ka kb in kc b kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt lx kv kw kx ig bi translated">假设有一个<code class="fe ly lz ma mb b">sum()</code>函数，它将两个给定的数字相加并返回结果。例如，3 + 7将返回10。</p><p id="1fe4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了用普通的JavaScript测试这个<code class="fe ly lz ma mb b">sum()</code>函数，我们可以简单地通过下面代码片段中的4个步骤:</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Creating a simple test with plain JavaScript</figcaption></figure><ol class=""><li id="454c" class="mi mj in kc b kd ke kh ki kl mk kp ml kt mm kx mn mo mp mq bi translated">执行功能</li><li id="8de1" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">定义期望</li><li id="6962" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">返回值</li><li id="10fb" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">比较</li><li id="e141" class="mi mj in kc b kd mr kh ms kl mt kp mu kt mv kx mn mo mp mq bi translated">利润！</li></ol><p id="559a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">到目前为止一切顺利。我们刚刚编写了第一个JavaScript测试。<br/>如果你想执行你的测试，你可以简单地使用Node.js和do <br/> <code class="fe ly lz ma mb b">node simple-test.js</code>。这将在您的本地终端中执行您的测试。</p><p id="5545" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了真正理解像Jasmine或Chai这样的断言库是如何工作的，接下来我们将自己创建一个。</p><h2 id="2ace" class="la lb in bd lc ld le dn lf lg lh dp li kl lj lk ll kp lm ln lo kt lp lq lr ls bi translated">抽象测试并创建您自己的断言库</h2><p id="4809" class="pw-post-body-paragraph ka kb in kc b kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt lx kv kw kx ig bi translated">上面我们写的测试看起来还不算太差，但是测试多了怎么办？如果我们总是自己用那个<code class="fe ly lz ma mb b">if</code>语句对结果和预期进行比较，并在结果和预期不匹配时抛出一个错误，那么可能要写很多代码。</p><p id="0391" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是断言库的由来。它将帮助您抽象断言:</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Creating an assertion library with plain JavaScript</figcaption></figure><p id="33bd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看一下上面的代码片段。首先，我们看到我们做了与简单的JavaScript测试相同的事情，在第3行运行了<code class="fe ly lz ma mb b">sum(3,7)</code>函数，并定义了一个期望值10。之后，我们看到断言库开始运行(第5行)。</p><p id="1df2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它的读法非常自然，符合常见的英语句子结构:We<code class="fe ly lz ma mb b">expect</code>the<code class="fe ly lz ma mb b">(result)</code>T7<code class="fe ly lz ma mb b">(expected)</code>。</p><p id="ad54" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">断言库所做的是，它提供了像<code class="fe ly lz ma mb b">expect</code>或<code class="fe ly lz ma mb b">toBe</code>这样的函数，让我们使用它们来编写更干净、更抽象的测试。正如您在第16行中看到的，它的源代码与我们简单的JavaScript测试没有太大区别。这只是一个函数，用所谓的“匹配器”(在我们的例子中是<code class="fe ly lz ma mb b">toBe</code>)返回一个对象。这个语法最初在一个名为<a class="ae jz" href="https://jasmine.github.io/index.html" rel="noopener ugc nofollow" target="_blank"> Jasmine </a>的库中使用，它现在是测试框架<a class="ae jz" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>的一部分。</p><p id="8b93" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">进一步抽象我们的测试的下一步是创建一个我们自己的测试框架，非常类似于Jest。</p><h2 id="ad2b" class="la lb in bd lc ld le dn lf lg lh dp li kl lj lk ll kp lm ln lo kt lp lq lr ls bi translated">通过创建你自己的测试框架来抽象更多</h2><p id="36be" class="pw-post-body-paragraph ka kb in kc b kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt lx kv kw kx ig bi translated">你试过上面的代码吗？复制出来，粘贴到一个新的JavaScript文件中，使用Node.js ( <code class="fe ly lz ma mb b">node testfile.js</code>)执行。</p><p id="a309" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成了吗？当您执行终端并通过测试时，您会在终端中看到什么？</p><p id="07c7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于通过的测试，您现在看不到任何输出，这很遗憾。我们还想知道我们的测试何时成功执行，并得到一个漂亮的勾号，最好是可爱的绿色。</p><p id="916b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是测试框架出现的地方。测试框架将您的测试包装在一个函数中，这允许您在一个范围内执行测试。要了解不同变量范围的更多信息，请查看Kevin Kononenko 的这个非常棒的代码类比:</p><div class="mw mx gp gr my mz"><a href="https://medium.com/free-code-camp/how-javascript-variable-scoping-is-just-like-multiple-levels-of-government-d7ddabc49bf1" rel="noopener follow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd io gy z fp ne fr fs nf fu fw im bi translated">JavaScript变量作用域就像多级政府</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">你有没有在一次又一次地得到一个未定义的值后沮丧地砸碎你的键盘，同时试图…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">medium.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jt mz"/></div></div></a></div><p id="684b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">测试框架还提供了更好的测试结果日志。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create a testing framework with plain JavaScript</figcaption></figure><p id="860c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如你在上面的代码片段中看到的,<code class="fe ly lz ma mb b">test(title, callback)</code>函数(在第12行)试图执行回调，如果能够执行的话，就注销一个。</p><p id="db9c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">否则(当它捕捉到错误时)，它将记录一个✕和相应的错误消息。</p><p id="4f93" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的<code class="fe ly lz ma mb b">sum()</code>测试可以被包装在这个测试块中，在使用Node.js执行它之后，我们将获得适当的终端输出，无论测试是通过还是失败。</p><p id="4110" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你仔细观察:这个例子中的第1到第4行和一个简单的<a class="ae jz" href="https://jestjs.io/docs/getting-started" rel="noopener ugc nofollow" target="_blank">玩笑测试</a>看起来完全一样。</p><p id="4a0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们不需要编写自己的测试框架，我们可以依赖Jest这样的稳定测试框架来测试我们的JavaScript。</p><h2 id="35c3" class="la lb in bd lc ld le dn lf lg lh dp li kl lj lk ll kp lm ln lo kt lp lq lr ls bi translated">结论</h2><p id="514c" class="pw-post-body-paragraph ka kb in kc b kd lt kf kg kh lu kj kk kl lv kn ko kp lw kr ks kt lx kv kw kx ig bi translated">正如你所看到的，编写一个JavaScript测试非常简单，你所使用的工具(比如Jasmine或者Jest)的核心就是简单的JavaScript函数，这些函数抽象了你的测试。</p></div><div class="ab cl no np hr nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ig ih ii ij ik"><p id="6dea" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">鸣谢:Kent C. Dodds，他在“专业测试JavaScript课程”中的教学理念启发了我写这篇文章。</p><p id="6edb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nv">更多内容尽在</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nv">plain English . io</em></a></p></div></div>    
</body>
</html>