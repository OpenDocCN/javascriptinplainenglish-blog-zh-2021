<html>
<head>
<title>User Gesture Restricted Web APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用户手势限制的Web APIs</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/user-gesture-restricted-web-apis-d794454453f7?source=collection_archive---------1-----------------------#2021-01-31">https://javascript.plainenglish.io/user-gesture-restricted-web-apis-d794454453f7?source=collection_archive---------1-----------------------#2021-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2877" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">API只能通过用户手势来启动——这个错误意味着什么，如何修复它？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/95a97d5a0e59e2140d804ee1c50e9dea.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*J3Ygm52dcu75LQkQ6McuEw.png"/></div></figure><p id="1d09" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在处理Web APIs时，您会遇到以下错误:</p><pre class="kg kh ki kj gt lj lk ll lm aw ln bi"><span id="f687" class="lo lp iq lk b gy lq lr l ls lt">API can only be initiated by a user gesture</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lu"><img src="../Images/fd2dcbb16f5c7d0239023c95955609bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D8S-ioA14xfxWZ8k1wNZlA.png"/></div></div></figure><p id="b637" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为什么会出现这个错误，它到底意味着什么？</p><h1 id="1e6a" class="lz lp iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">为什么会这样？</h1><p id="8a9c" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">这个错误意味着您试图调用的<em class="mv"> API不能仅仅在您的代码中调用，它需要通过用户手势</em>来启动。</p><p id="5dc6" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">让我们以<a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API" rel="noopener ugc nofollow" target="_blank">全屏API </a>为例。这个Web API有一个方法<code class="fe mx my mz lk b">Element.requestFullscreen()</code>，它将目标<code class="fe mx my mz lk b">element</code>和整个浏览器的网页置于全屏模式。</p><p id="3b49" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下面是一个页面加载后立即调用<code class="fe mx my mz lk b">requestFullscreen</code>的例子:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3133" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这段代码将<strong class="kp ir"> <em class="mv">不起作用</em> </strong>，因为动作不是由用户手势发起的。应用此限制是为了使您不能强制网站以全屏模式显示，您只能通过用户手势或动作进入全屏模式。</p><p id="5c1a" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这种限制背后的主要原因是出于<strong class="kp ir"> <em class="mv">安全</em> </strong>原因——想象一下，如果视频可以在您没有选择播放的情况下自动播放，或者恶意网站可以在您访问网页时占据您的整个屏幕。将这些API方法限制为用户手势确保它们是用户想要的<strong class="kp ir"><em class="mv"/></strong>。</p><h1 id="5f40" class="lz lp iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">我该怎么办？</h1><p id="9325" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">为了修复这种类型的错误，需要在用户操作的事件监听器中调用API方法，比如一个<code class="fe mx my mz lk b">click</code>或<code class="fe mx my mz lk b">keydown</code>事件。</p><p id="ca80" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这里有一个例子，当点击一个按钮时，我们调用<code class="fe mx my mz lk b">requestFullscreen</code>来修复上面的错误:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="04a0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae mw" href="https://html.spec.whatwg.org/multipage/interaction.html#triggered-by-user-activation" rel="noopener ugc nofollow" target="_blank">有效的用户手势</a>包括:</p><ul class=""><li id="c0f5" class="nc nd iq kp b kq kr kt ku kw ne la nf le ng li nh ni nj nk bi translated"><code class="fe mx my mz lk b">change</code></li><li id="0069" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">click</code></li><li id="4fe9" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">contextmenu</code></li><li id="adb1" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">dblclick</code></li><li id="c576" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">mouseup</code></li><li id="8b36" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">pointerup</code></li><li id="5a81" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">reset</code></li><li id="7dd6" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">submit</code></li><li id="8e22" class="nc nd iq kp b kq nl kt nm kw nn la no le np li nh ni nj nk bi translated"><code class="fe mx my mz lk b">touchend</code></li></ul><p id="3989" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">事件如<code class="fe mx my mz lk b">mousemove</code>或<code class="fe mx my mz lk b">mouseenter</code>是<strong class="kp ir"> <em class="mv">不是</em> </strong>有效的用户手势。</p><h1 id="4df3" class="lz lp iq bd ma mb mc md me mf mg mh mi jw mj jx mk jz ml ka mm kc mn kd mo mp bi translated">结论</h1><p id="d193" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">总之，出于安全原因，浏览器阻止某些脚本运行，除非被用户操作触发。这也适用于除<code class="fe mx my mz lk b">Fullscreen</code>之外的方法，例如通过<code class="fe mx my mz lk b"><a class="ae mw" href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement" rel="noopener ugc nofollow" target="_blank">HTMLMediaElement.play()</a></code>播放视频或音频。</p><p id="8d60" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><em class="mv">希望这有所帮助！</em></p></div></div>    
</body>
</html>