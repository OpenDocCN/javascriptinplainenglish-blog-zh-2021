<html>
<head>
<title>Internationalization in React: Using Hooks and Context Provider</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React中的国际化:使用钩子和上下文提供者</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/internationalization-in-react-js-application-34925edd81dd?source=collection_archive---------11-----------------------#2021-07-28">https://javascript.plainenglish.io/internationalization-in-react-js-application-34925edd81dd?source=collection_archive---------11-----------------------#2021-07-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a9e82a4e4baed41f57ed1b9109948f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DuRx7MUoyR6AdRvIHetlEA.png"/></div></div></figure><div class=""/><p id="5c8a" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">为多语言应用程序编码总是具有挑战性。大多数情况下，您最终会添加一些第三方库。使用basic React，您可以拥有一个健壮的、可伸缩的库。</em></p><p id="800c" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在任何跨国公司工作，你都必须支持来自世界各地的客户。您的应用程序必须支持多语言功能。并且用户应该能够在语言之间切换。大多数时候你会选择像<a class="ae kx" href="https://www.i18next.com/" rel="noopener ugc nofollow" target="_blank"> i18next </a>这样的第三方库。然而，它也有自己的挑战。</p><p id="b697" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">在本文中，我将重点介绍如何创建一个简单易用的国际化模块，并且只使用很少几行代码。我不会比较你为什么应该或不应该使用第三方库。</em></p><p id="ea81" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在继续之前，让我们了解一下库的需求。</p><figure class="kz la lb lc gt is gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/8784491167764a0a96e1e510f584a104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*BtpACNzwiLOd13Ye"/></div></figure><h1 id="1d0b" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">项目要求</h1><ol class=""><li id="11b2" class="mb mc jb ka b kb md kf me kj mf kn mg kr mh kv mi mj mk ml bi translated">用户应该能够在语言之间切换</li><li id="0d60" class="mb mc jb ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">当用户切换到另一种语言时，用户应该看到不同的文本。</li></ol><h1 id="e346" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">非功能需求</h1><ol class=""><li id="55e3" class="mb mc jb ka b kb md kf me kj mf kn mg kr mh kv mi mj mk ml bi translated">假设我们正在使用React，这个库应该支持React的最新钩子概念</li><li id="431b" class="mb mc jb ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">该库应该提供一个在运行时更新翻译的选项(通过网络获取)</li><li id="d8f9" class="mb mc jb ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">该库应该提供对默认消息的支持，以防如果请求的话，该键/值不存在于消息集中</li><li id="c863" class="mb mc jb ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">该库应该提供一种基于用户偏好更新默认区域设置的方法</li><li id="65ba" class="mb mc jb ka b kb mm kf mn kj mo kn mp kr mq kv mi mj mk ml bi translated">开发人员应该能够在任何地区获得消息，即使默认的地区是不同的。这将有助于同时获得不同语言的信息。</li></ol><p id="8786" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">示例应用:</strong></p><figure class="kz la lb lc gt is gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e49c4e9a6e3fb69e445e11a3cde0d87b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*EwBb-InH8KtUQLeQRH-kMQ.gif"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk">Sample App</figcaption></figure><h1 id="cadc" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">创建React.js应用程序</h1><p id="9865" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">创建一个react应用程序非常简单。可以使用<code class="fe mz na nb nc b">create-react-app,</code>创建react app。如果你已经有了自己的app。您可以跳过这一步，进入下一步。</p><pre class="kz la lb lc gt nd nc ne nf aw ng bi"><span id="2f9d" class="nh le jb nc b gy ni nj l nk nl">npx create-react-app my-multi-lingual-app --template typescript</span></pre><p id="b55f" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦创建了应用程序，您就可以从<code class="fe mz na nb nc b">App.tsx</code>中删除现有代码。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="68b6" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">注意:</strong> <em class="kw">对于本文，我们将使用Typescript编写代码。我总是建议对定制构建库使用TypeScript。它不仅减少了解释大量代码的工作量，而且通过补充JS中不好的部分提供了更好的支持。你可以阅读这篇文章，找到更多我不再使用JavaScript的理由</em><a class="ae kx" rel="noopener ugc nofollow" target="_blank" href="/im-not-using-javascript-anymore-6851c707b3d1"><em class="kw"/></a><em class="kw">。</em></p><h1 id="0c6b" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">创建i18n包</h1><p id="101b" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">为了简单起见，让我们在<code class="fe mz na nb nc b">src</code>目录中创建一个目录。网上有很多文章，比如<a class="ae kx" href="https://docs.npmjs.com/creating-node-js-modules" rel="noopener ugc nofollow" target="_blank"> <strong class="ka jc">如何创建node.js模块</strong> </a>。如果您愿意的话，您可以按照它们中的任何一个来创建一个单独的包并发布您的库。</p><p id="24eb" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">创建一个文件国际化. tsx </strong></p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="e5f8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们导入它，并用默认的英文文本创建一个基本的应用程序结构。</p><h2 id="d55c" class="nh le jb bd lf no np dn lj nq nr dp ln kj ns nt lr kn nu nv lv kr nw nx lz ny bi translated">更新应用程序的HTML模板</h2><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="f835" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">用默认消息测试I18nProvider类</h1><p id="85d9" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">对于我们的<strong class="ka jc">国际化</strong>模块，我们将使用<a class="ae kx" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">反应上下文API </a>。为了避免直接暴露给提供者类，我们将使用HOC组件包装提供者。你可以在这里详细阅读<a class="ae kx" href="https://itnext.io/combining-hocs-with-the-new-reacts-context-api-9d3617dccf0b" rel="noopener ugc nofollow" target="_blank"/>，如何为提供者创建一个包装类。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="0818" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了访问provider类的值，让我们创建一个自定义挂钩。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="25d8" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">更新<em class="kw"> App.tsx </em>，获取硬编码消息</strong></p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="4fd6" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">从网络获取消息</h1><p id="26cc" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">刷新后，您可以看到硬编码的消息。让我们从网络中获取消息，并在<strong class="ka jc"> I18nProvider </strong>中将它们设置为消息。为此，我们需要创建一个公共方法来提供上下文。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="db9d" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">类似地，我们必须将该方法具体化为<strong class="ka jc"> set locale </strong>。在<strong class="ka jc"> App.tsx </strong>中访问所有这些方法非常简单。我们来更新一下<strong class="ka jc"> App.tsx </strong>。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="e792" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">处理网络延迟</h1><p id="fbb7" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">即使我们从网络上获取消息并将其设置为messages，我们仍然会看到一个破碎的页面。这是因为我们试图在没有错误处理的情况下访问给定代码<code class="fe mz na nb nc b">&lt;p&gt;Welcome, {messages["en-US"].hello}&lt;/p&gt;</code>中的消息文本。由于网络延迟(异步)，你会看到这个破碎的网页。要避免这样的问题，还是优雅地处理。我们可以在我们的<strong class="ka jc"> I18nProvider </strong>中添加一个<strong class="ka jc"> boolean(loaded) </strong>。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="8c66" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在更新<strong class="ka jc"> App.tsx </strong>以显示从网络获取消息后加载消息。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="eb38" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">在语言之间切换</h1><p id="e150" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated"><strong class="ka jc"> I18nProvider </strong>公开了<strong class="ka jc"> setLocale </strong>方法。通过用<strong class="ka jc">键</strong>发送locale参数，我们可以从<strong class="ka jc"> I18nProvider </strong>获取消息。用一种语言处理信息要比用多种语言容易得多。为了根据当前的语言环境从<strong class="ka jc"> I18nProvider </strong>获取文本，我们可以添加<strong class="ka jc"> translate </strong>一个助手函数/方法。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="9fed" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，在<strong class="ka jc"> App.tsx </strong>中获取地区文本将变得更加容易。</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><h1 id="686f" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">最终代码</h1><p id="6172" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated"><code class="fe mz na nb nc b">src/i18n/Internationalization.tsx</code>的完整代码</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="dc17" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe mz na nb nc b">src/i18n/App.tsx</code>的最终代码</p><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nm nn l"/></div></figure><p id="fd14" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka jc">注:</strong>你总能在运行代码-沙箱里找到源代码，<a class="ae kx" href="https://codesandbox.io/s/react-internationalization-screr" rel="noopener ugc nofollow" target="_blank">react-国际化-screr </a>。</p><h1 id="e723" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">演示应用程序</h1><figure class="kz la lb lc gt is"><div class="bz fp l di"><div class="nz nn l"/></div></figure><h1 id="1c6b" class="ld le jb bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">结论</h1><p id="1d90" class="pw-post-body-paragraph jy jz jb ka b kb md kd ke kf me kh ki kj mw kl km kn mx kp kq kr my kt ku kv ij bi translated">我们可以通过添加几行代码清楚地看到。我们可以创建一个基本的简单国际化库。但是，如果您的应用程序非常大，并且您不想维护自己的自定义库。您应该使用第三方库。你会得到更好的支持和标准化。</p><p id="6e12" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">谢谢，希望你喜欢这篇文章。它将为您提供如何使用React.js上下文API的基本概念。如果你觉得这个有用，请分享并反馈。如果你有任何疑问和建议，请写在评论中。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="0884" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">原载于</em><a class="ae kx" href="https://blog.decipher.dev/internationalization-in-plain-reactjs" rel="noopener ugc nofollow" target="_blank"><em class="kw">https://blog . decipe . dev</em></a><em class="kw">。</em></p><p id="e401" class="pw-post-body-paragraph jy jz jb ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更多内容请看</em><a class="ae kx" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka jc"><em class="kw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>