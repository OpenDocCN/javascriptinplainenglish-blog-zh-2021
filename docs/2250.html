<html>
<head>
<title>A Guide to Understanding the ‘this’ Keyword in React Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React组件中“this”关键字的理解指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-guide-to-understanding-the-this-keyword-in-react-components-c280c37d4862?source=collection_archive---------3-----------------------#2021-05-11">https://javascript.plainenglish.io/a-guide-to-understanding-the-this-keyword-in-react-components-c280c37d4862?source=collection_archive---------3-----------------------#2021-05-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ec9c0da7e9febc65ed896bd6d5c39a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6ih-jmPCNk9Gc_7i"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7e56" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">React是一个令人惊叹的视图库，被web开发行业的许多人使用。当您正确理解React的核心概念时，在您的项目中使用React就变得容易了。</p><p id="9e86" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您不了解React所基于的一些关键JavaScript概念，您可能会遇到一些麻烦，其中一个概念就是<code class="fe ky kz la lb b">this</code>关键字。</p><p id="42ca" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我为你解码。React类组件基本上是一个JavaScript类，当一个类扩展到<code class="fe ky kz la lb b"><strong class="kc io">React.Component</strong></code>类时，它被赋予React的所有功能。所以，如果你不知道JavaScript类是如何工作的，不要担心！我已经为你准备好了。</p><p id="4473" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事情是这样的。JavaScript类只是构造函数的<em class="lc">语法糖</em>，这是JavaScript的一个重要概念，用于创建对象。而构造函数<strong class="kc io"> <em class="lc"> </em> </strong>里面的<code class="fe ky kz la lb b">this</code>关键字，指的是一个对象，这个对象由使用<code class="fe ky kz la lb b">this</code>关键字声明的所有属性和方法组成。</p><p id="f017" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了给你一个清晰的概念，下面是JavaScript中一个<strong class="kc io">构造函数<em class="lc"> </em> </strong>和一个c <strong class="kc io">类</strong>的比较。</p><ul class=""><li id="aa94" class="ld le in kc b kd ke kh ki kl lf kp lg kt lh kx li lj lk ll bi translated"><strong class="kc io">构造函数示例</strong></li></ul><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lm"><img src="../Images/b8bf15a338dc16312a40363b994a72fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpqWTW3wZm59Lmc3SgQyxQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Constructor Function Example</figcaption></figure><ul class=""><li id="a2b1" class="ld le in kc b kd ke kh ki kl lf kp lg kt lh kx li lj lk ll bi translated"><strong class="kc io">班级示例</strong></li></ul><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/aa4c17ffff47bb605a4f8211254e3f80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-GUuaFvPIaerZlEcsramg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Class Example</figcaption></figure><p id="4e0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当用<code class="fe ky kz la lb b">new</code>关键字调用时，两者以相似的方式工作并创建相似的实例(对象)。因此，在这两个例子中，<code class="fe ky kz la lb b">this</code>指的是一个具有所有属性和函数的对象，当用<code class="fe ky kz la lb b">new</code>关键字调用时将返回这些属性和函数。</p><p id="a2f4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以，到了React类组件中的<code class="fe ky kz la lb b">this</code>，让我们通过创建下面的例子来理解它。</p><figure class="ln lo lp lq gt jo"><div class="bz fp l di"><div class="ls lt l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">React Class Component Example</figcaption></figure><p id="692f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您使用<code class="fe ky kz la lb b">ReactDOM.render()</code>将这个组件渲染到一个特定的<code class="fe ky kz la lb b">DOM node</code>中时，我们通过将<code class="fe ky kz la lb b">this</code>的值记录到浏览器的控制台中来获得它，如下所示。</p><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/c0bfbe69533d12cea9bc54cafd04f2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmY9eU8RoatGXbY5MRy9Zw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">`this` value inside Class Component</figcaption></figure><p id="e572" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">React使用<code class="fe ky kz la lb b">this</code>的东西有很多，正如你所看到的上面的对象由很多东西组成。我们会试着把它分解，然后一个一个地进行。</p><p id="a582" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如您所知，类中声明的函数将被添加到<code class="fe ky kz la lb b">this</code>对象中。两个函数<code class="fe ky kz la lb b">count</code>和<code class="fe ky kz la lb b">reset</code>被添加到<code class="fe ky kz la lb b">this</code>对象中，如上图所示；然后可以通过<code class="fe ky kz la lb b">this</code>访问它们，并作为事件处理程序附加在HTML(反应元素)中，HTML将从组件返回(<a class="ae jz" href="#f9ba" rel="noopener ugc nofollow">参考上面的代码</a> —第39行)。</p><p id="677d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里有个问题。当在类中声明的普通函数中使用React基于类的特性时，像<code class="fe ky kz la lb b">this.setState or this.state</code>一样通过<code class="fe ky kz la lb b">this</code>访问会导致<strong class="kc io">错误！那么这里出了什么问题呢？答案是<code class="fe ky kz la lb b">this</code>没有引用React类组件，而是引用了<code class="fe ky kz la lb b">Window</code>对象</strong></p><p id="c4a8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是因为当带有附加事件处理程序的HTML被注入到<code class="fe ky kz la lb b">DOM</code>中时，函数内部的<code class="fe ky kz la lb b">this</code>将引用<code class="fe ky kz la lb b">Window</code>对象，因为普通函数拥有自己的<code class="fe ky kz la lb b">this</code>对象，而不管该函数是在什么环境下创建的。</p><figure class="ln lo lp lq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/e9e5b297156a54aa0045ea90a1f222a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWaCI-Dm_iJ7sYc5Q1WgPw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">window object example</figcaption></figure><p id="de3c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有两种方法可以解决这个问题:</p><ol class=""><li id="6ae3" class="ld le in kc b kd ke kh ki kl lf kp lg kt lh kx lw lj lk ll bi translated"><strong class="kc io">将函数</strong>(事件处理程序)与类组件的<code class="fe ky kz la lb b">this</code>值绑定，这样无论函数在<code class="fe ky kz la lb b">DOM</code>中运行到哪里，<code class="fe ky kz la lb b">this</code>都将始终指向一个特定的<strong class="kc io"> React类组件</strong> ( <a class="ae jz" href="#f9ba" rel="noopener ugc nofollow">参考上面的代码</a> —第9行)。</li><li id="fc4f" class="ld le in kc b kd lx kh ly kl lz kp ma kt mb kx lw lj lk ll bi translated"><strong class="kc io">箭头功能</strong>是解决这个问题的另一种方法。使用箭头函数代替函数声明，因为箭头函数没有自己的<code class="fe ky kz la lb b">this</code>。因此，arrow函数中的“this”总是指arrow函数的外部环境的<code class="fe ky kz la lb b">this</code>，在那里创建了<strong class="kc io"/>。在我们的例子中，<strong class="kc io">外部环境是React类组件</strong> ( <a class="ae jz" href="#f9ba" rel="noopener ugc nofollow">参考上面的代码</a> —第22行)。</li></ol><p id="eb73" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">有时候，即使你注意到了上面的事情，当在任何嵌套函数中放置基于<code class="fe ky kz la lb b">this</code>的调用时，你也必须小心，<a class="ae jz" href="#f9ba" rel="noopener ugc nofollow">就像上面第18行</a>中的代码。因此，总是建议使用箭头函数，并在编码时注意<code class="fe ky kz la lb b">this</code>是如何工作的。</p><p id="686b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可能想知道<code class="fe ky kz la lb b">this</code>在<strong class="kc io">反应功能组件</strong> <em class="lc">里面指的是什么？</em></p><p id="6b0d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">React将其函数组件视为一个普通的函数，该函数返回<strong class="kc io"> React元素</strong>、<strong class="kc io">，除了将函数组件的第一个字母大写之外，React将其视为React组件。</strong>这是<strong class="kc io"> </strong>因为React认为以<strong class="kc io"> small case开头的元素是要创建并放入DOM的HTML元素</strong>，如下例所示。</p><p id="4514" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">&lt;div&gt;{this.state.count}&lt;/div&gt;</code> ( <a class="ae jz" href="#f9ba" rel="noopener ugc nofollow">参考上面的</a>代码)</p><p id="0443" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">所以<strong class="kc io">中的<code class="fe ky kz la lb b">this</code>功能组件</strong>指的是<code class="fe ky kz la lb b">Window Object</code> ( <a class="ae jz" href="#0fed" rel="noopener ugc nofollow">指的是</a>上面的窗口对象图像)。</p><p id="ba1f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们将关注<strong class="kc io"> React </strong>使用<code class="fe ky kz la lb b">this</code>关键字实现的<strong class="kc io">概念</strong></p><p id="8c8b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了<code class="fe ky kz la lb b">state</code>、<code class="fe ky kz la lb b">props</code>、<code class="fe ky kz la lb b">setState</code>是React的基本特性，还有其他微小的东西是类组件中<code class="fe ky kz la lb b">this</code>的一部分。了解这些会有所不同。</p><ol class=""><li id="ac6b" class="ld le in kc b kd ke kh ki kl lf kp lg kt lh kx lw lj lk ll bi translated"><code class="fe ky kz la lb b"><strong class="kc io">this.forceUpdate(callback)</strong></code> : <br/>每当我们依赖于<code class="fe ky kz la lb b">state</code>和<code class="fe ky kz la lb b">props</code>之外的东西获取数据，并且如果这些数据应该被用来改变UI的某个部分，我们使用<code class="fe ky kz la lb b">forceUpdate</code>调用render方法将新的改变放入DOM，因为除了 <code class="fe ky kz la lb b"><strong class="kc io">state</strong></code> <strong class="kc io">和</strong> <code class="fe ky kz la lb b"><strong class="kc io">prop</strong></code> <strong class="kc io">改变</strong>之外，<strong class="kc io"> React不会重新呈现。</strong></li><li id="9544" class="ld le in kc b kd lx kh ly kl lz kp ma kt mb kx lw lj lk ll bi translated"><code class="fe ky kz la lb b"><strong class="kc io">this.isReactComponent</strong></code> : <br/>我们怎么知道一个组件是类组件还是功能组件？假设我们看不到源代码，比如从其他模块导入，基于此，我们必须在代码中做一些事情。<br/> <br/>这就是<code class="fe ky kz la lb b">isReactComponent</code>属性通过有一个值<code class="fe ky kz la lb b">{}</code>(空对象)告诉我们它是一个React类组件，对于函数组件，该属性不存在，它是<code class="fe ky kz la lb b">undefined</code>。</li><li id="325b" class="ld le in kc b kd lx kh ly kl lz kp ma kt mb kx lw lj lk ll bi translated"><code class="fe ky kz la lb b"><strong class="kc io">this.context</strong></code> : <br/> Props是数据在组件树中流动的方式，但有时当只有树深处的一些组件需要时，它不是传递数据的有效方式，因为这会使其他中间组件不必要地访问那些数据。这就是上下文存储这些数据的地方。<br/> <br/>当一个组件订阅一个上下文时，该数据将在类组件内的<code class="fe ky kz la lb b">this.context</code>中可用。要了解更多关于上下文的信息，请点击<a class="ae jz" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</li></ol><p id="b3ce" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是关于<code class="fe ky kz la lb b">this</code>的一切！你在这里看到的其他东西都涉及React的内部设置，你根本不需要担心。嗯，你可能认为在<code class="fe ky kz la lb b">this</code>里面有我们看到的<code class="fe ky kz la lb b">refs</code>。但是<code class="fe ky kz la lb b">this.refs</code>是访问组件中DOM元素的引用的遗留方式。React的未来版本将不再支持并移除这一功能。如果您确实想使用<code class="fe ky kz la lb b">refs</code>，请查看本<a class="ae jz" href="https://reactjs.org/docs/refs-and-the-dom.html" rel="noopener ugc nofollow" target="_blank">指南</a>。</p><p id="fd34" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，<strong class="kc io">感谢您的宝贵时间！</strong>我希望这篇博客能帮助你理解<code class="fe ky kz la lb b">this</code>在React组件中是如何工作的！</p><p id="bbda" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请一定要看看我的手艺。我很想在评论区看到你的意见。</p><p id="861d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并且让我知道你在React和JavaScript还有什么不懂的，我会为你覆盖:)</p><p id="73af" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lc">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="lc">plain English . io</em></a></p></div></div>    
</body>
</html>