<html>
<head>
<title>Redis Caching with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js的Redis缓存</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/guide-to-redis-caching-with-node-js-e50356b06c1c?source=collection_archive---------11-----------------------#2021-07-23">https://javascript.plainenglish.io/guide-to-redis-caching-with-node-js-e50356b06c1c?source=collection_archive---------11-----------------------#2021-07-23</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d195" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Node.js中的Redis缓存入门</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/9113c3fc4294f0230564e91bac63be9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HuwqQJWFNpomg28TRWPqBQ.jpeg"/></div></div></figure><p id="e677" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">没有最低限度的性能，现代应用程序就无法运行。随着时间的推移，随着应用程序的复杂性和请求数量呈指数级增长，这种需求也会增加。因此，缓存应运而生。<strong class="kq io">缓存</strong>指的是将数据存储在临时位置的过程，这样应用程序可以更快地访问和检索数据。缓存的目的是通过加速数据访问操作来减少网络上发送数据的带宽成本和应用程序的响应时间。</p><h2 id="abd1" class="lk ll in bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb mc bi translated">Redis是什么？</h2><p id="b50f" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">Redis是一种功能强大、用途广泛的内存缓存机制，速度惊人。我们称之为“多功能”是因为它是处理缓存、类似数据库的特性、会话管理、实时分析、事件流、队列管理等的完美选择。</p><h2 id="acff" class="lk ll in bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb mc bi translated">安装Redis</h2><p id="df0a" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在这里，我们将一步一步地使用Node.js应用程序构建<em class="mi"> Redis </em>缓存。</p><p id="3a87" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我们需要将<em class="mi"> Redis </em>的二进制文件下载到您的目录中，并使用以下命令进行编译。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mj"><img src="../Images/0adc7d225861b68e3d75912147eb8219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wu-5d77ccJtH_7g6PDn3Ww.png"/></div></div></figure><p id="b831" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">安装后，使用以下命令启动<em class="mi"> redis </em>服务器。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mk"><img src="../Images/2923c1b873aac49ae579f2873814a878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7LW8xhX6Ms6yG-UqbOiNw.png"/></div></div></figure><p id="4f13" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您也可以使用下面的命令来测试连接是否仍然有效。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ml"><img src="../Images/886d66e3e4dd732c7c78c6c6a025a365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0xF_52jUQzqcDY8MMOHD1A.png"/></div></div></figure><p id="d917" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">对于上面的命令，应该收到的响应为<code class="fe mm mn mo mp b"><strong class="kq io"><em class="mi">pong</em></strong></code> <strong class="kq io"> <em class="mi"> </em> </strong>，这意味着我们的<em class="mi"> Redis </em>服务器正在成功运行。</p><p id="efc7" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">欲了解更多详情，请阅读<a class="ae mq" href="https://redis.io/topics/quickstart" rel="noopener ugc nofollow" target="_blank">官方快速入门指南</a>。</p><h2 id="28de" class="lk ll in bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb mc bi translated">设置Node.js应用程序</h2><p id="d85a" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在本教程中，我们使用<code class="fe mm mn mo mp b"><strong class="kq io">axios </strong></code>从外部API访问数据。我们还使用了<code class="fe mm mn mo mp b"><strong class="kq io">redis </strong></code>,它是Node的标准Redis客户端。我们可以使用<code class="fe mm mn mo mp b"><strong class="kq io">npm</strong>.</code>安装上述两个软件包，如下所示</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="0269" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们可以使用下面的代码片段来设置节点服务器。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="17b5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">之后，我们使用来自https://openweathermap.org的公开API来获取任何给定城市的天气细节。</p><p id="3be6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">您可以将任何城市名称作为要查找的字符串传递给API，并检索json格式的天气详细信息数组。对API的示例请求如下所示。在这里用xxx替换您的API密钥以供使用。</p><p id="ae1c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">https://api.openweathermap.org/data/2.5/weather?q=London的appid=xxx </p><p id="7aad" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我们的节点应用程序之上，我们定义了一个名为<code class="fe mm mn mo mp b">/weather</code>的路由，它从API中检索任何城市的天气细节，并将它们发送回客户端。这里我们使用了<code class="fe mm mn mo mp b">axios</code> <strong class="kq io"> </strong> <em class="mi">获取</em>请求来达到这个目的。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><h2 id="0640" class="lk ll in bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb mc bi translated">Redis缓存</h2><p id="91d8" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在让我们转到最重要的部分，将<em class="mi"> redis </em>缓存应用到应用程序。首先，我们需要通过我们的节点应用程序连接到<em class="mi"> redis </em>服务器。我们可以通过以下方式来实现，</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="76f9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里需要提到的是<strong class="kq io"> 6379 </strong>是<em class="mi">Redis</em>服务器的默认端口号。之后，我们可以使用上面创建的<em class="mi"> Redis客户端</em>来处理我们的节点应用程序中的缓存。</p><p id="7b7b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我们需要从请求查询参数中提取城市名称。然后我们需要将那个城市名作为<strong class="kq io"> <em class="mi">键</em> </strong>传递到缓存中，以检查天气详细信息是否已经在其中。</p><p id="4295" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里需要提到的是，<em class="mi"> Redis </em>缓存将数据存储为<strong class="kq io"> <em class="mi">键值对</em> </strong>。因此，您需要一个键来检索相关的值。由于Redis包没有对承诺的本地支持，我们必须传递一个回调来处理检索到的数据。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="98ec" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们如何知道<em class="mi"> Redis </em>缓存中是否有与传递的城市名称相关的天气细节？</p><p id="3f67" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果从<em class="mi"> Redis </em>返回的值是<strong class="kq io"> <em class="mi">而不是null </em> </strong>，则意味着相关数据存在于缓存中，因此很容易在响应中返回该数据。只要确保将字符串转换回JSON就行了。</p><p id="0fce" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">否则，如果返回值为<strong class="kq io"> <em class="mi"> null </em> </strong>，我们必须向外部API发送请求来检索相关的天气数据。从API获取天气数据后，我们将它存储在缓存中，以便下次向节点服务器发送相同的请求时，它可以用存储在缓存中的数据进行响应，而不是从API请求它们。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="9183" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这里我们使用了<code class="fe mm mn mo mp b"><strong class="kq io">setex</strong></code> <strong class="kq io"> </strong>函数来代替通常的<code class="fe mm mn mo mp b"><strong class="kq io">set</strong></code> <strong class="kq io"> </strong>函数，因为我们可以为存储的键-值对设置一个<strong class="kq io"> <em class="mi">到期时间</em> </strong>。在我们为到期时间设置了一个值之后，Redis 将在经过的时间到期时自动从缓存中删除这个键-值对。</p><p id="31aa" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">上述实现的完整源代码如下:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mr ms l"/></div></figure><p id="579a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，我们已经完成了本文主要关注的主题。但是我想简单介绍一下<strong class="kq io"> Redis <em class="mi"> </em> </strong>缓存。</p><p id="2e0d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">Redis缓存有一些操作，我们可以使用它们来轻松地处理它，如下所示。</p><ul class=""><li id="883b" class="mt mu in kq b kr ks ku kv kx mv lb mw lf mx lj my mz na nb bi translated"><strong class="kq io"> <em class="mi">检查密钥是否存在</em> </strong>:该方法用于检查一个密钥是否已经存在，并据此进行处理。为此，您可以使用<code class="fe mm mn mo mp b"><strong class="kq io">exists</strong>()</code>功能。</li><li id="3d2f" class="mt mu in kq b kr nc ku nd kx ne lb nf lf ng lj my mz na nb bi translated"><strong class="kq io"> <em class="mi">从任意值中删除键</em> </strong>:有时，你需要清除一些键并重新初始化它们。要清除按键，可以使用<code class="fe mm mn mo mp b"><strong class="kq io">del</strong></code> <strong class="kq io"> </strong>命令。</li></ul><p id="7265" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">还需要提到的是<em class="mi"> Redis </em>支持不同的数据类型而不是使用一个字符串比如<strong class="kq io"> <em class="mi"> hashes，list</em>和<em class="mi"> sets </em> </strong>。您可以使用这些类型将数据存储到R <em class="mi"> edis </em>缓存中。</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><h2 id="028f" class="lk ll in bd lm ln lo dn lp lq lr dp ls kx lt lu lv lb lw lx ly lf lz ma mb mc bi translated">结论</h2><p id="7965" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在本文中，我们介绍了如何使用外部API作为数据源，使用<strong class="kq io"> Redis </strong>作为缓存，在Node.js REST API上实现缓存。希望你能通过这个获得知识。</p><p id="959b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">编码快乐！</p><p id="dadc" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="mi">更多内容请看</em><a class="ae mq" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="mi">plain English . io</em></strong></a></p></div></div>    
</body>
</html>