<html>
<head>
<title>Compress Images Before Upload in React with React Image File Resizer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React中上传之前压缩图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/compression-images-before-upload-in-a-react-app-with-react-image-file-resizer-c1870c9bcf47?source=collection_archive---------2-----------------------#2021-01-09">https://javascript.plainenglish.io/compression-images-before-upload-in-a-react-app-with-react-image-file-resizer-c1870c9bcf47?source=collection_archive---------2-----------------------#2021-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ce3af98c453f958a848c53022692e903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xO8PxmFpZLDMRkbl"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@viktortalashuk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Viktor Talashuk</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="bf8e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React图像文件Resizer允许我们在上传图像之前对其进行压缩和操作。</p><p id="fa4f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何在上传到React应用程序之前处理我们的图像。</p><h1 id="5cb2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">装置</h1><p id="fbb6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过运行以下命令来安装该软件包:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="79f5" class="mn lc iq mj b gy mo mp l mq mr">npm i react-image-file-resizer</span></pre><p id="d446" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">或者</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="111e" class="mn lc iq mj b gy mo mp l mq mr">yarn add react-image-file-resizer</span></pre><h1 id="460c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">压缩和处理图像</h1><p id="20bf" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以压缩和操作我们从文件输入中选择的图像。</p><p id="2ef0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2888" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import Resizer from "react-image-file-resizer";</span><span id="59a0" class="mn lc iq mj b gy ms mp l mq mr">const resizeFile = (file) =&gt;<br/>  new Promise((resolve) =&gt; {<br/>    Resizer.imageFileResizer(<br/>      file,<br/>      300,<br/>      400,<br/>      "JPEG",<br/>      80,<br/>      0,<br/>      (uri) =&gt; {<br/>        resolve(uri);<br/>      },<br/>      "base64"<br/>    );<br/>  });</span><span id="aa04" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const onChange = async (event) =&gt; {<br/>    const file = event.target.files[0];<br/>    const image = await resizeFile(file);<br/>    console.log(image);<br/>  };</span><span id="fc9a" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;input onChange={onChange} type="file" /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="47f1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe mt mu mv mj b">resizeFile</code>函数，它获取图像文件并返回调整文件大小和压缩文件的承诺。</p><p id="ed2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第一个参数是file对象。</p><p id="0433" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个和第三个是宽度和高度。</p><p id="a5a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第四个是要转换的格式。</p><p id="5099" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">5是图像质量从0到100。</p><p id="b817" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第六是图像的旋转。</p><p id="5ad9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第七个是用于获得新图像URI的函数。</p><p id="5ee5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">8号是格式。</p><p id="9a00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最小宽度和高度需要两个以上的参数。</p><p id="5d93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">onChange</code>处理程序中，我们从文件输入中获取文件。</p><p id="b892" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们做到了这一点，我们就可以进行上传。</p><h1 id="29ee" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">上传文件</h1><p id="f2d2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">为了上传文件，我们编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7f5c" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import Resizer from "react-image-file-resizer";</span><span id="50fb" class="mn lc iq mj b gy ms mp l mq mr">const resizeFile = (file) =&gt;<br/>  new Promise((resolve) =&gt; {<br/>    Resizer.imageFileResizer(<br/>      file,<br/>      300,<br/>      400,<br/>      "JPEG",<br/>      80,<br/>      0,<br/>      (uri) =&gt; {<br/>        resolve(uri);<br/>      },<br/>      "base64"<br/>    );<br/>  });</span><span id="cde1" class="mn lc iq mj b gy ms mp l mq mr">const dataURIToBlob = (dataURI) =&gt; {<br/>  const splitDataURI = dataURI.split(",");<br/>  const byteString =<br/>    splitDataURI[0].indexOf("base64") &gt;= 0<br/>      ? atob(splitDataURI[1])<br/>      : decodeURI(splitDataURI[1]);<br/>  const mimeString = splitDataURI[0].split(":")[1].split(";")[0];</span><span id="2c6a" class="mn lc iq mj b gy ms mp l mq mr">  const ia = new Uint8Array(byteString.length);<br/>  for (let i = 0; i &lt; byteString.length; i++) ia[i] = byteString.charCodeAt(i);</span><span id="7fb5" class="mn lc iq mj b gy ms mp l mq mr">  return new Blob([ia], { type: mimeString });<br/>};</span><span id="7a44" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const onChange = async (event) =&gt; {<br/>    const file = event.target.files[0];<br/>    const image = await resizeFile(file);<br/>    console.log(image);<br/>    const newFile = dataURIToBlob(image);<br/>    const formData = new FormData();<br/>    formData.append("image", newFile);<br/>    const res = await fetch(<br/>      "https://run.mocky.io/v3/c5189845-2a93-49aa-85c7-70bc64e8af90",<br/>      {<br/>        method: "POST",<br/>        body: formData<br/>      }<br/>    );<br/>    const data = await res.text();<br/>    console.log(data);<br/>  };</span><span id="4985" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;input onChange={onChange} type="file" /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="40e3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了<code class="fe mt mu mv mj b">dataURItoBlob</code>函数来将base64字符串转换回文件。</p><p id="7800" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它遍历从base64字符串创建的字节字符串，并将其放入Uint8Array中。</p><p id="1acc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后放在<code class="fe mt mu mv mj b">Blob</code>构造函数中返回文件对象。</p><p id="c40d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们这样做了，我们就把它放在<code class="fe mt mu mv mj b">FormData</code>构造函数中。</p><p id="a500" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe mt mu mv mj b">fetch</code>功能上传。</p><h1 id="080d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="a7c3" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在用React图像文件Resizer包将图像上传到React应用程序之前对其进行压缩和调整大小。</p></div></div>    
</body>
</html>