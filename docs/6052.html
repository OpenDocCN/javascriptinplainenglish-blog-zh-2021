<html>
<head>
<title>Create a PWA App Manifest Dynamically</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动态创建PWA应用程序清单</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-pwa-app-manifest-dynamically-3b3d45340b11?source=collection_archive---------0-----------------------#2021-12-28">https://javascript.plainenglish.io/create-a-pwa-app-manifest-dynamically-3b3d45340b11?source=collection_archive---------0-----------------------#2021-12-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8b39" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">想知道如何在桌面和手机上创建不同图标的应用清单吗？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/a7e68ed7ba54fb7416a9776f6612af48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kaCmmp24udg2OqgwvMWHw.png"/></div></div></figure><p id="0e41" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">每个渐进式网络应用都有一个<a class="ae lk" href="https://developer.mozilla.org/en-US/docs/Web/Manifest" rel="noopener ugc nofollow" target="_blank">应用清单</a>，一个简单的JSON文件，包含你的应用的基本信息，即名称、图标、描述等。</p><p id="1234" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您只是想在现有的web应用程序中添加PWA功能，<a class="ae lk" href="https://progressier.com" rel="noopener ugc nofollow" target="_blank"> Progressier </a>拥有您需要的一切(包括动态应用程序图标选项)。但是如果您想动态创建自己的web应用程序清单，请继续阅读。</p><h1 id="3220" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">传统的做法</h1><p id="8e13" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">构建第一个PWA时，最简单的方法是直接在HTML模板的<code class="fe mi mj mk ml b">&lt;head&gt;</code>部分添加一个到应用清单的链接。</p><p id="a1ca" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在你网站的任何地方主持<code class="fe mi mj mk ml b">manifest.json</code>。生成的JSON文件应该如下所示:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="1965" class="mq lm in ml b gy mr ms l mt mu">{ <br/>  "short_name":"Coronavirus", <br/>  "name":"The Coronavirus App", <br/>  "background_color":"#ffffff", <br/>  "theme_color":"#ffffff", <br/>  "display":"standalone", <br/>  "orientation":"any", <br/>  "start_url":"https://coronavirus.app",       <br/>  "scope":"https://coronavirus.app", <br/>  "icons":[    <br/>    {"src":"/icon512.png","sizes":"512x512","type":"image/png"},<br/>    {"src":"/icon192.png","sizes":"192x192","type":"image/png"},      <br/>    {src":"/icon196.png","sizes":"196x196","type":"image/png"} <br/>  ] <br/>}</span></pre><h1 id="9644" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">为什么你会想换一种方式</h1><p id="d221" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">虽然上面的方法是处理web应用程序清单的一种非常有效的方式，但是在一些合理的情况下，静态文件是不行的，您可能希望动态地生成它:</p><ul class=""><li id="9660" class="mv mw in kq b kr ks ku kv kx mx lb my lf mz lj na nb nc nd bi translated">你需要桌面和手机上完全不同的图标</li><li id="b303" class="mv mw in kq b kr ne ku nf kx ng lb nh lf ni lj na nb nc nd bi translated">您希望在同一个域中托管多个不同的pwa</li><li id="1dfd" class="mv mw in kq b kr ne ku nf kx ng lb nh lf ni lj na nb nc nd bi translated">对于每个登录的用户，PWA应该看起来不同</li></ul><p id="1dd8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">可能还有更多有效的例子。要动态生成您的应用程序清单，您有两种选择:当用户请求时，在您的服务器上构建它。或者直接在浏览器中自动生成(我们的首选方法)。</p><h1 id="4c1c" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">服务器端动态应用程序清单生成</h1><p id="b096" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">不要把这个文件作为静态文件放在您的站点上，而是把到<code class="fe mi mj mk ml b">/manifest.json</code>的路径做成一个API，这将允许您根据您的需要以编程的方式生成JSON文件的内容。这里有一个使用Node.js/Express.js:的例子</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="9688" class="mq lm in ml b gy mr ms l mt mu">app.get('/manifest.json', async function(req, res){ <br/>  //for brevity, we're not including the isDesktop function here <br/>  let iconUrl = isDesktop() ? '/desktop.png' : '/mobile.png'; <br/>  let manifest = { <br/>    name: "App name", <br/>    icons: [{ <br/>     src: iconUrl, <br/>     sizes:  "512x512", <br/>     type:"image/png" <br/>    }] <br/>  } <br/>  res.header('content-type', 'application/json'); <br/>  return res.status(200).send(JSON.stringify(manifest)); <br/>});</span></pre><h1 id="b79c" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">客户端动态应用程序清单创建</h1><blockquote class="nj nk nl"><p id="ffbe" class="ko kp nm kq b kr ks jo kt ku kv jr kw nn ky kz la no lc ld le np lg lh li lj ig bi translated">2022年6月更新:客户端动态应用程序清单生成不再是一个可行的选项。所以不要做以下的事情。更多见评论。</p></blockquote><p id="ccd6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">大多数人不知道<code class="fe mi mj mk ml b">/manifest.json</code>不一定是实际文件。它与<a class="ae lk" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs" rel="noopener ugc nofollow" target="_blank">数据URL </a>配合得很好(尽管有一个缺点——见注释)。</p><p id="a01e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">无需从服务器下载额外的文件，这意味着更快的加载速度和更低的服务器成本。由于每次修改web应用程序清单的内容时，数据URL都会不同，因此您不必担心浏览器不会相应地更新其内容。</p><p id="f1ad" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在您的客户端代码中，您可以这样创建它:</p><pre class="kd ke kf kg gt mm ml mn mo aw mp bi"><span id="dc04" class="mq lm in ml b gy mr ms l mt mu">//for brevity, we're not including the isDesktop function here <br/>let iconUrl = isDesktop() ? '/desktop.png' : '/mobile.png'; <br/>let manifest = { <br/>  name: "App name", <br/>  icons: [{ src: iconUrl, sizes: "512x512", type:"image/png" }] <br/>}; <br/>let content = encodeURIComponent(JSON.stringify(manifest)); <br/>let url = "data:application/manifest+json,"+content; <br/>let element = document.createElement('link'); <br/>element.setAttribute('rel', 'manifest'); <br/>element.setAttribute('href', url); <br/>document.querySelector('head').appendChild(element);</span></pre><p id="a128" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<a class="ae lk" href="https://progressier.com" rel="noopener ugc nofollow" target="_blank"> Progressier </a>上，我们遇到了相当多的复杂用例，用户需要在他们的Android主屏幕、Android闪屏、iPhone闪屏和安装了PWA的Windows/Mac上使用完全不同的徽标，因此我们相应地设计了我们的仪表盘。</p><p id="8e99" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在幕后，我们使用这些用户设置通过上述方法动态生成他们的应用程序清单。</p><p id="9ed8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">问题或反馈？下面留言评论！</p><p id="ac5b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nm">更多内容看</em> <a class="ae lk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">说白了。报名参加我们的</em> </a><a class="ae lk" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nm">免费每周简讯</em> </a> <em class="nm">。在我们的</em> <a class="ae lk" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nm">社区</em> </a> <em class="nm">获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>