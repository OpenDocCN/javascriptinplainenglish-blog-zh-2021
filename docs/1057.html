<html>
<head>
<title>How to Toggle Dark Mode in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React中切换黑暗模式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/toggle-dark-mode-in-react-d1cf01d4c429?source=collection_archive---------12-----------------------#2021-03-05">https://javascript.plainenglish.io/toggle-dark-mode-in-react-d1cf01d4c429?source=collection_archive---------12-----------------------#2021-03-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4b35e58188736988c6a6cf0c4da70359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P1UIMdzfscdWcfIhdlb3ZQ.jpeg"/></div></div></figure><p id="d4fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我重建我的<a class="ae kt" href="https://abbeyperini.dev" rel="noopener ugc nofollow" target="_blank">作品集网站</a>时，我知道我想在设计中找点乐子，一个明暗模式正符合要求。我很喜欢在这个项目中的许多发现，但是我最喜欢的是颜色变化的SVG。本教程假设熟悉React，我使用的是v17.0.1和功能组件。</p><p id="ea56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">首先，我创建了一个基本布局。接下来，我把我的<a class="ae kt" href="https://coolors.co/292929-2f4550-586f7c-b8dbd9-f9f8f8" rel="noopener ugc nofollow" target="_blank">深色</a>和<a class="ae kt" href="https://coolors.co/eddcd2-fff1e6-dbe7e4-bcd4e6-1d2c35" rel="noopener ugc nofollow" target="_blank">浅色</a>配色方案放在一起。这需要一点反复试验，但是在测试了我所有的组合以获得足够的对比度和位置后，我发现我需要6个CSS变量。我猜你会说我使用了“黑暗优先”开发，因为变量名在黑暗主题的上下文中是有意义的。灯光主题变化较少，但需要<code class="fe ku kv kw kx b">--button-border</code>，其中<code class="fe ku kv kw kx b">--accent</code>将与背景颜色相同。</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="7c5e" class="lg lh in kx b gy li lj l lk ll">.theme-dark {<br/>  --dark-text: #292929;<br/>  --light-text: #F9F8F8;  <br/>  --dark-background: #2F4550;<br/>  --light-background: #586F7C;<br/>  --accent: #B8DBD9;<br/>  --button-border: #B8DBD9;<br/>}</span></pre></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><pre class="lc kx ld le aw lf bi"><span id="f4d7" class="lg lh in kx b gy lt lu lv lw lx lj l lk ll">.theme-light {<br/>  --dark-text: #5E4B56;<br/>  --light-text: #5E4B56;<br/>  --dark-background: #DBE7E4;<br/>  --light-background: #EDDCD2;<br/>  --accent: #DBE7E4;<br/>  --button-border: #5E4B56;<br/>}</span></pre><p id="4041" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我开始将颜色应用到我的基本布局中:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="746b" class="lg lh in kx b gy li lj l lk ll">html, #root {<br/>  background-color: var(--dark-background);<br/>  color: var(--dark-text);<br/>}</span><span id="2350" class="lg lh in kx b gy ly lj l lk ll">nav {<br/>  background-color: var(--dark-background);<br/>  color: var(--light-text);<br/>}</span><span id="6ebb" class="lg lh in kx b gy ly lj l lk ll">.main-container {<br/>  background-color: var(--light-background);<br/>}</span></pre><p id="aa26" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还将我想要弹出的内容部分的背景设置为<code class="fe ku kv kw kx b">--accent</code>。<code class="fe ku kv kw kx b">--dark-text</code>本来可以在黑暗主题的所有背景上工作，但是我将部分标题设置为<code class="fe ku kv kw kx b">--light-text</code>以使它们更加突出。</p><p id="918c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我找到了Musthaq Ahamad的<a class="ae kt" href="https://medium.com/@haxzie/dark-and-light-theme-switcher-using-css-variables-and-pure-javascript-zocada-dd0059d72fa2" rel="noopener">基本主题切换器教程</a>，并着手将其应用于功能性React组件。</p><p id="33fa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将更改主题和检查主题首选项的localStorage的函数放在一个名为themes.js的文件中。</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="00d2" class="lg lh in kx b gy li lj l lk ll">function setTheme(themeName) {<br/>    localStorage.setItem('theme', themeName);<br/>    document.documentElement.className = themeName;<br/>}</span><span id="d962" class="lg lh in kx b gy ly lj l lk ll">function keepTheme() {<br/>  if (localStorage.getItem('theme')) {<br/>    if (localStorage.getItem('theme') === 'theme-dark') {<br/>      setTheme('theme-dark');<br/>    } else if (localStorage.getItem('theme') === 'theme-light') {<br/>      setTheme('theme-light')<br/>    }<br/>  } else {<br/>    setTheme('theme-dark')<br/>  }<br/>}</span><span id="1a52" class="lg lh in kx b gy ly lj l lk ll">module.exports = {<br/>  setTheme,<br/>  keepTheme<br/>}</span></pre><p id="1642" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我的App.js文件中，我将<code class="fe ku kv kw kx b">keepTheme()</code>添加到我的<code class="fe ku kv kw kx b">useEffect()</code>中。</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="f1bf" class="lg lh in kx b gy li lj l lk ll">import { keepTheme } from './utils/themes';</span><span id="6c84" class="lg lh in kx b gy ly lj l lk ll">function App() {</span><span id="d739" class="lg lh in kx b gy ly lj l lk ll">  useEffect(() =&gt; {<br/>      keepTheme();<br/>  })<br/>}</span></pre><p id="14b7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我将切换组件添加到我的导航栏组件中。我根据克里斯·邦格斯的教程<a class="ae kt" href="https://h.daily-dev-tips.com/creating-day-night-css-only-toggle-switch" rel="noopener ugc nofollow" target="_blank">和卡蒂亚·德·胡安的作品</a><a class="ae kt" href="https://dribbble.com/shots/3220898-Day-Night-toggle-DailyUI-015" rel="noopener ugc nofollow" target="_blank">设计了这个开关。然后我调整大小，翻转默认为</a><a class="ae kt" href="https://github.com/abbeyperini/Portfolio2.0/blob/master/portfolio/src/styles/toggle.css" rel="noopener ugc nofollow" target="_blank">黑暗模式</a>。虽然这个开关如此可爱以至于你可能会死，但本教程将适用于任何<code class="fe ku kv kw kx b">&lt;button&gt;</code>或可点击的<code class="fe ku kv kw kx b">&lt;input&gt;</code>。首先，我设置了基本的JSX、本地州和一个变量来保存我们从localStorage获得的主题:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="b8c8" class="lg lh in kx b gy li lj l lk ll">import React, { useEffect, useState } from 'react';<br/>import '../styles/toggle.css';<br/>import { setTheme } from '../utils/themes';</span><span id="d4a1" class="lg lh in kx b gy ly lj l lk ll">function Toggle() {<br/>  const [togClass, setTogClass] = useState('dark');<br/>  let theme = localStorage.getItem('theme');</span><span id="3153" class="lg lh in kx b gy ly lj l lk ll">  return (<br/>        &lt;div className="container--toggle"&gt;<br/>           &lt;input type="checkbox" id="toggle" className="toggle--checkbox" onClick={handleOnClick} /&gt;<br/>            &lt;label htmlFor="toggle" className="toggle--label"&gt;<br/>                &lt;span className="toggle--label-background"&gt;&lt;/span&gt;<br/>            &lt;/label&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="2d95" class="lg lh in kx b gy ly lj l lk ll">export default Toggle;</span></pre><p id="f8a6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当用户点击开关时，我希望页面上的主题改变，开关也随之改变。我将导入的<code class="fe ku kv kw kx b">setTheme()</code>函数和本地状态的<code class="fe ku kv kw kx b">setTogClass()</code>添加到一个<code class="fe ku kv kw kx b">handleOnClick</code>函数中。你可以在上面的JSX中看到它被传递到了开关的可点击部分。</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="4d46" class="lg lh in kx b gy li lj l lk ll">const handleOnClick = () =&gt; {<br/>  if (localStorage.getItem('theme') === 'theme-dark') {<br/>      setTheme('theme-light');<br/>      setTogClass('light')<br/>  } else {<br/>      setTheme('theme-dark');<br/>      setTogClass('dark')<br/>  }<br/>}</span></pre><p id="b007" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我使用这个组件的<code class="fe ku kv kw kx b">useEffect()</code>来确保本地状态<code class="fe ku kv kw kx b">togClass</code>总是加载正确的主题。</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="a005" class="lg lh in kx b gy li lj l lk ll">useEffect(() =&gt; {<br/>    if (localStorage.getItem('theme') === 'theme-dark') {<br/>        setTogClass('dark')<br/>    } else if (localStorage.getItem('theme') === 'theme-light') {<br/>        setTogClass('light')<br/>    }<br/>}, [theme])</span></pre><p id="9f7f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为我的切换是一个复选框，深色主题应该显示未选中(月亮)状态，浅色主题应该显示选中(太阳)状态。我无法让<code class="fe ku kv kw kx b"><a class="ae kt" href="https://reactjs.org/docs/uncontrolled-components.html" rel="noopener ugc nofollow" target="_blank">defaultChecked</a></code>按照我想要的方式工作，所以我用这个条件渲染<a class="ae kt" href="https://twitter.com/dan_abramov/status/1365107258280071168" rel="noopener ugc nofollow" target="_blank">三元运算符</a>(条件运算符)替换了未选中的<code class="fe ku kv kw kx b">&lt;input&gt;</code>:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="97fd" class="lg lh in kx b gy li lj l lk ll">{<br/>    togClass === "light" <strong class="kx io">?</strong><br/>    &lt;input type="checkbox" id="toggle" className="toggle--checkbox" onClick={handleOnClick} checked /&gt;<br/>    <strong class="kx io">:</strong><br/>    &lt;input type="checkbox" id="toggle" className="toggle--checkbox" onClick={handleOnClick} /&gt;<br/>}</span></pre><p id="0646" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用了一个<code class="fe ku kv kw kx b">&lt;button&gt;</code>，您可以像这样轻松地使用条件呈现来更改<code class="fe ku kv kw kx b">&lt;button&gt;</code>标签中的<code class="fe ku kv kw kx b">className</code>属性，并获得相同的效果。</p><p id="f9fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">综上所述，切换组件的代码如下所示:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="41bc" class="lg lh in kx b gy li lj l lk ll">import React, { useEffect, useState } from 'react';<br/>import '../styles/toggle.css';<br/>import { setTheme } from '../utils/themes';</span><span id="86b2" class="lg lh in kx b gy ly lj l lk ll">function Toggle() {<br/>    const [togClass, setTogClass] = useState('dark');<br/>    let theme = localStorage.getItem('theme');</span><span id="a022" class="lg lh in kx b gy ly lj l lk ll">const handleOnClick = () =&gt; {<br/>        if (localStorage.getItem('theme') === 'theme-dark') {<br/>            setTheme('theme-light');<br/>            setTogClass('light')<br/>        } else {<br/>            setTheme('theme-dark');<br/>            setTogClass('dark')<br/>        }<br/>    }</span><span id="3eb5" class="lg lh in kx b gy ly lj l lk ll">useEffect(() =&gt; {<br/>        if (localStorage.getItem('theme') === 'theme-dark') {<br/>            setTogClass('dark')<br/>        } else if (localStorage.getItem('theme') === 'theme-light') {<br/>            setTogClass('light')<br/>        }<br/>    }, [theme])</span><span id="5d22" class="lg lh in kx b gy ly lj l lk ll">return (<br/>        &lt;div className="container--toggle"&gt;<br/>            {<br/>                togClass === "light" ?<br/>                &lt;input type="checkbox" id="toggle" className="toggle--checkbox" onClick={handleOnClick} checked /&gt;<br/>                :<br/>                &lt;input type="checkbox" id="toggle" className="toggle--checkbox" onClick={handleOnClick} /&gt;<br/>            }<br/>            &lt;label htmlFor="toggle" className="toggle--label"&gt;<br/>                &lt;span className="toggle--label-background"&gt;&lt;/span&gt;<br/>            &lt;/label&gt;<br/>        &lt;/div&gt;<br/>    )<br/>}</span><span id="ad31" class="lg lh in kx b gy ly lj l lk ll">export default Toggle;</span></pre><h1 id="215e" class="lz lh in bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">更新</h1><p id="e17a" class="pw-post-body-paragraph jv jw in jx b jy mw ka kb kc mx ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">要了解我是如何重构这个组件的逻辑并使其可访问的，请阅读React 中的<a class="ae kt" href="https://abbeyperini.medium.com/an-accessible-dark-mode-toggle-in-react-873f7b1495c7" rel="noopener">一个可访问的黑暗模式切换。</a></p><p id="0d62" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我最喜欢的部分:颜色切换SVGs！CSS变量也适用于SVG代码！</p><p id="e2b1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我从<a class="ae kt" href="https://devicon.dev/" rel="noopener ugc nofollow" target="_blank"> DEVICON </a>获得了Github和Chrome图标的SVG代码。对于Github图标，我只需改变一个<code class="fe ku kv kw kx b">&lt;g&gt;</code>中的填充属性:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="d207" class="lg lh in kx b gy li lj l lk ll">&lt;g fill="var(--dark-text)"&gt;</span></pre><p id="2aa5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Chrome图标在一个<code class="fe ku kv kw kx b">&lt;circle&gt;</code>和一个<code class="fe ku kv kw kx b">&lt;path&gt;</code>中有一个填充属性:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="a3a1" class="lg lh in kx b gy li lj l lk ll">&lt;circle fill="var(--dark-text)" cx="63.624" cy="64.474" r="22.634"&gt;&lt;/circle&gt;&lt;path fill="var(--dark-text)" <strong class="kx io">...</strong>&gt;</span></pre><p id="33fd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">结果看起来像这样:</p><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/9940d2f7a04ed9a13fbfbe31e1d6aba8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*K2iYVIgN1Pl1PsHgsq1VlA.gif"/></div></figure><figure class="ky kz la lb gt jo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/0ae72b33a79c7d5a76910d73f2a2564d.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/1*-mH7_oehtO792Hw3JWGs1Q.gif"/></div></figure><h1 id="07e1" class="lz lh in bd ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv bi translated">结论</h1><p id="27f9" class="pw-post-body-paragraph jv jw in jx b jy mw ka kb kc mx ke kf kg my ki kj kk mz km kn ko na kq kr ks ig bi translated">我试图包含所有相关的代码，但是你也可以在我的网站的<a class="ae kt" href="https://github.com/abbeyperini/Portfolio2.0" rel="noopener ugc nofollow" target="_blank"> Github库</a>中看到完整的代码。如果你喜欢这篇文章或者有问题，请留下你的评论！我也希望看到任何按照本教程建立的东西。</p><p id="d88c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nd">更多内容请看</em><a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nd">plain English . io</em></strong></a></p></div></div>    
</body>
</html>