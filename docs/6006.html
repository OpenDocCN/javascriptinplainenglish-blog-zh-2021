<html>
<head>
<title>Create a Crypto Crowdfunding Widget From a Few Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用几行代码创建一个加密众筹窗口小部件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-crypto-crowdfunding-widget-from-a-few-lines-of-code-103a756a66cf?source=collection_archive---------14-----------------------#2021-12-23">https://javascript.plainenglish.io/create-a-crypto-crowdfunding-widget-from-a-few-lines-of-code-103a756a66cf?source=collection_archive---------14-----------------------#2021-12-23</a></blockquote><div><div class="fc ic id ie if ig"/><div class="ih ii ij ik il"><div class=""/><figure class="gm go jm jn jo jp gi gj paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="gi gj jl"><img src="../Images/281759c0c1a429486a21a16939a7d6ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-vkMUGAmkqZUikl0"/></div></div><figcaption class="jw jx gk gi gj jy jz bd b be z dk">Source: <a class="ae ka" href="https://www.pexels.com/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/</a></figcaption></figure><p id="a632" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">你想开始自己的众筹活动吗？或者为修复Github问题筹集资金？或者你会为你的文章接受一些捐赠吗？有了密码就非常简单了。在本文中，我们将构建一个加密众筹小部件，用于在任何以太坊兼容网络上接受ERC-20令牌或加密。</p><h2 id="121d" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">该理论</h2><p id="36d3" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated">我们的小部件将是一个动态生成的PNG，它是从我们的以太坊地址和余额生成的。您可以在任何可以通过URL嵌入图像的地方嵌入此图像。你可以把它添加到你的GitHub readme或者一个问题的描述中，或者你可以把它嵌入到你的文章中，等等。该图像将包含一个二维码到您的以太坊地址和一个指示器，显示您的平衡，以及它离目标有多远。当你开始一个新的活动，你必须创建一个新的以太坊帐户或智能合同(例如。ICO合同)来接受资金。</p><p id="79b6" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">用户可以简单地扫描二维码，然后发送一些密码。大约需要10秒钟。向众筹活动发送crypto从未如此简单。</p><h2 id="2190" class="kz la io bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">代码</h2><p id="4e22" class="pw-post-body-paragraph kb kc io kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky ih bi translated">我们将使用JavaScript来实现，使用node-canvas来生成结果PNG图像。</p><p id="e74e" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">首先，我们将创建一个灰色画布。</p><pre class="lx ly lz ma gu mb mc md me aw mf bi"><span id="cdfb" class="kz la io mc b gz mg mh l mi mj">const canvas = createCanvas(200, 270) <br/>const ctx = canvas.getContext(‘2d’) <br/>ctx.fillStyle = “#aaaaaa” <br/>ctx.fillRect(0, 0, canvas.width, canvas.height)</span></pre><p id="bac7" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">然后把二维码涂在上面。为此，我们将使用<a class="ae ka" href="https://www.npmjs.com/package/qrcode" rel="noopener ugc nofollow" target="_blank"> qrcode </a>库。</p><pre class="lx ly lz ma gu mb mc md me aw mf bi"><span id="f10b" class="kz la io mc b gz mg mh l mi mj">let qrcode = new Image()<br/>qrcode.src = await QRCode.toDataURL(config.ETH_ADDRESS)<br/>ctx.drawImage(qrcode, 10, 10, 180, 180)</span></pre><p id="992c" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">下一步是查询余额。我们可以通过使用<a class="ae ka" href="https://www.npmjs.com/package/web3" rel="noopener ugc nofollow" target="_blank"> web3 </a>库轻松做到这一点。</p><pre class="lx ly lz ma gu mb mc md me aw mf bi"><span id="82d5" class="kz la io mc b gz mg mh l mi mj">const web3 = new Web3(config.PROVIDER_URL)<br/>const balance = parseInt(<br/>  await web3.eth.getBalance(config.ETH_ADDRESS))</span></pre><p id="781d" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">Web3类的构造函数有一个provider参数。这是<a class="ae ka" href="https://ethereum.org/en/developers/docs/apis/json-rpc/" rel="noopener ugc nofollow" target="_blank">以太坊JSON-RPC </a>端点的URL。如果你想使用以太坊主网，或者一个测试网络，那么最好的方法是使用ConsenSys的<a class="ae ka" href="https://infura.io/" rel="noopener ugc nofollow" target="_blank"> Infura </a>。MetaMask也用这个。如果你想在另一个以太坊兼容的网络上接受支付，比如Polygon或xDAI等。然后你可以<a class="ae ka" href="https://github.com/ethereum-lists/chains/tree/master/_data/chains" rel="noopener ugc nofollow" target="_blank">在这里</a>找到RPC端点。</p><p id="1157" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">如果您想接受代币支付，也可以查询您的ERC20余额。</p><pre class="lx ly lz ma gu mb mc md me aw mf bi"><span id="3444" class="kz la io mc b gz mg mh l mi mj">const contract = new web3.eth.Contract(erc20_abi as AbiItem[],<br/>  CONTRACT_ADDRESS)<br/>const balance = <br/>  await contract.methods.balanceOf(config.ETH_ADDRESS).call()</span></pre><p id="6b72" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">契约类的构造函数有两个参数:接口定义(ABI)和ERC20令牌契约的地址。</p><p id="c887" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">如果余额已知，计算百分比就很容易了。</p><pre class="lx ly lz ma gu mb mc md me aw mf bi"><span id="008b" class="kz la io mc b gz mg mh l mi mj">let percent = balance / (config.TARGET_VALUE * 10 ** 18);<br/>if (percent &gt; 1)<br/>  percent = 1;</span></pre><p id="8841" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">重要的是余额是，所以你必须用10除以</p><p id="e1fa" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">完整的代码如下所示:</p><figure class="lx ly lz ma gu jp"><div class="bz fq l di"><div class="mk ml l"/></div></figure><p id="dd04" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">23行代码。正如我写的，这没什么大不了的。完整代码可在<a class="ae ka" href="https://github.com/TheBojda/Ethereum-crowdfunding-widget-javascript" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。(我还有一个<a class="ae ka" href="https://github.com/TheBojda/Ethereum-crowdfunding-widget" rel="noopener ugc nofollow" target="_blank"> PHP实现</a>。)</p><p id="7dae" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">代码可以在一个最小的Lightsail实例(3，5美元/mo)上运行，但是如果您不想为它分配一个完整的EC2实例，您可以将其部署到AWS lambda。所有的东西都包含在GitHub回购协议中。</p><p id="697d" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">这是一个收集xDAI的示例小部件(顺便说一下，如果您喜欢这篇文章，或者只是想试试它是如何工作的，您可以给我发一些xDAI):</p><p id="a87b" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated"><a class="ae ka" href="https://qiaby8b8pf.execute-api.eu-central-1.amazonaws.com" rel="noopener ugc nofollow" target="_blank">https://qiaby8b8pf.execute-api.eu-central-1.amazonaws.com</a></p><p id="4549" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated">本文最初发表于<a class="ae ka" href="https://hackernoon.com/create-a-crypto-crowdfunding-widget-from-a-few-lines-of-code" rel="noopener ugc nofollow" target="_blank">黑客线上</a>。</p><p id="b9ec" class="pw-post-body-paragraph kb kc io kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ih bi translated"><em class="mm">更多内容参见</em> <a class="ae ka" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mm">浅显英语。io </em> </a> <em class="mm">。注册我们的</em> <a class="ae ka" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="mm">免费周报</em> </a> <em class="mm">。在我们的</em> <a class="ae ka" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="mm">社区不和</em> </a> <em class="mm">中获得独家写作机会和建议。</em></p></div></div>    
</body>
</html>