<html>
<head>
<title>Testing Global State Libraries with React 18 Alpha Concurrent Rendering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用React 18 Alpha并发渲染测试全局状态库</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/testing-global-state-libraries-with-react-18-alpha-concurrent-rendering-6a070b5538fd?source=collection_archive---------19-----------------------#2021-06-10">https://javascript.plainenglish.io/testing-global-state-libraries-with-react-18-alpha-concurrent-rendering-6a070b5538fd?source=collection_archive---------19-----------------------#2021-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6509" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是撕裂和分支</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/288c041114d7860fb9fd9675d17a7f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hSocWKFY5mnZwjhD.png"/></div></div></figure><h1 id="efd4" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="9b96" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">React团队公布了带有各种功能的React 18 的计划<a class="ae mf" href="https://reactjs.org/blog/2021/06/08/the-plan-for-react-18.html" rel="noopener ugc nofollow" target="_blank">。其中，并发渲染是我的兴趣之一，因为我一直在开发各种全局状态库，并且存在称为“撕裂”和“分支”的已知问题。</a></p><p id="9971" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">撕裂是一种不受欢迎的行为，其中两个组件为同一全局状态呈现不同的值。</p><p id="54e3" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">分支是一种理想的行为，在这种行为中，组件在转换更新中呈现状态的旧值。</p><p id="2a08" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">两者都是微妙的行为，在大多数适度的应用程序中不需要。</p><p id="2688" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">尽管如此，出于好奇，我制作了一个小实验工具来测试各种库在并发渲染中的行为。</p><h1 id="a983" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">工具</h1><p id="1de7" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">它被称为“这将反应全局状态工作在并发渲染？”</p><div class="ml mm gp gr mn mo"><a href="https://github.com/dai-shi/will-this-react-global-state-work-in-concurrent-rendering" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd ir gy z fp mt fr fs mu fu fw ip bi translated">戴式/将此反应全局状态工作在并行渲染中</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">React并发渲染中的测试撕裂和分支React 18即将推出一项名为“并发……”的新功能</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">github.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc kp mo"/></div></div></a></div><p id="9412" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">它为每个库运行一个微型计数器应用程序，并测试行为。</p><p id="31b6" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">共有6项测试。</p><ul class=""><li id="4c8d" class="nd ne iq ll b lm mg lp mh ls nf lw ng ma nh me ni nj nk nl bi translated">[使用过渡]</li><li id="7d8b" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试1:随着过渡而正确更新</li><li id="faba" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试2:过渡时无撕裂</li><li id="a5c0" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试3:中断渲染的能力</li><li id="7fd0" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试4:带过渡的正确分支</li><li id="4264" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">[具有密集自动增量(实验)]</li><li id="cded" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试5:用自动增量正确更新</li><li id="f61d" class="nd ne iq ll b lm nm lp nn ls no lw np ma nq me ni nj nk nl bi translated">测试6:自动递增时无撕裂</li></ul><p id="ca35" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">Test 5和test 6试图区分useMutableSource行为，但是它并没有完全像预期的那样工作。</p><h1 id="28de" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结果</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/e04c7222837305c7a9febbcc78bf4792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MoyRSp6OPl6FwJ_m.png"/></div></div></figure><p id="d99c" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">我们如何阅读这个表格？</p><p id="d76d" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">测试1是查看是否所有计数都正确更新。三个图书馆都失败了。我认为他们有点过于积极地批量更新。</p><p id="a29b" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">测试2是目标之一。有两个库失败了，但是正如您看到redux与useMutableSource通过了。我希望任何有useMutableSource的库都能通过这个测试。</p><p id="2c74" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">测试三是看时间片是否有效。如果做不到这一点，就意味着无法获得并发渲染的好处。</p><p id="f96c" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">测试4是另一个目标。分支只适用于React状态，大多数全局状态库使用模块状态，测试失败是意料之中的。</p><p id="ea77" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated">测试5和测试6是实验性的。它们显示出一些差异。目前可以说的是，React state通过了两项测试。</p><h1 id="51a8" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">结束语</h1><p id="ee73" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是一个简短的帖子，介绍我最近用React 18 alpha进行的实验。我认为这比用推特来解释我对结果的看法要好。请注意，它们只是写作时的结果，可能不准确。测试可能会出错。有兴趣的话，请克隆一下库，自己试试。</p></div><div class="ab cl ns nt hu nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="ij ik il im in"><p id="f43b" class="pw-post-body-paragraph lj lk iq ll b lm mg jr lo lp mh ju lr ls mi lu lv lw mj ly lz ma mk mc md me ij bi translated"><em class="nz">原载于2021年6月10日</em><a class="ae mf" href="https://blog.axlight.com/posts/testing-global-state-libraries-with-react-18-alpha-concurrent-rendering/" rel="noopener ugc nofollow" target="_blank"><em class="nz">【https://blog.axlight.com】</em></a><em class="nz">。</em></p></div></div>    
</body>
</html>