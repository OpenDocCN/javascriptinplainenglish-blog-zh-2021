<html>
<head>
<title>Crash Course in CORS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CORS速成班</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/crash-course-about-cors-e24a56c1656d?source=collection_archive---------10-----------------------#2021-06-10">https://javascript.plainenglish.io/crash-course-about-cors-e24a56c1656d?source=collection_archive---------10-----------------------#2021-06-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3216" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">处理和理解CORS误差基础的指南。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8bdaf0684d45d4ae427c24971022254b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YBFOkf8swQBhcKz23SQw7A.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Crash course about CORS</figcaption></figure><p id="a440" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lo">这篇文章献给我亲爱的兄弟</em> <a class="ae lp" href="https://www.linkedin.com/in/omercohenaviv/" rel="noopener ugc nofollow" target="_blank"> <em class="lo">奥马尔·科恩</em> </a> <em class="lo">，他一直在努力成为一名更好的开发者。</em></p><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="0e70" class="lv lw in lr b gy lx ly l lz ma">Access to XMLHttpRequest at 'https://localhost:3000' from origin 'https://localhost:8000' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource</span></pre><p id="4320" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">上面的错误你看着眼熟吗？</p><p id="a7cc" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">如果您是全栈web开发人员，您很可能已经解决了这个错误。有经验的全栈开发人员会意识到他们忘记了添加CORS头文件作为中间件，新手必须谷歌一下。</p><p id="e981" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">但是这个CORS是怎么回事呢？我们为什么需要它？以及理解它将如何使我们成为更好的全栈开发人员。关于它的所有内容，更多内容将在下一篇文章中介绍。敬请期待！</p><h1 id="dccb" class="mb lw in bd mc md me mf mg mh mi mj mk jt ml ju mm jw mn jx mo jz mp ka mq mr bi translated">这个CORS是怎么回事</h1><p id="655b" class="pw-post-body-paragraph ks kt in ku b kv ms jo kx ky mt jr la lb mu ld le lf mv lh li lj mw ll lm ln ig bi translated">CORS主张跨产地资源共享。简而言之，这意味着，当我们的浏览器从域‘A’获得资源(Javascript、HTML、CSS)时，我们有一些关于与域‘B’共享它的规则。</p><p id="0a7e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">实际上，CORS是SOP政策的延伸，所以为了理解CORS，我们必须熟悉同源政策。</p><p id="2aa2" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">SOP是一种网络浏览器安全机制，旨在保护您的私人数据免受恶意网站的侵害。</p><p id="d090" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">当浏览器向服务器发送HTTP请求时，与其他域相关的任何cookie(包括身份验证会话cookie)也会作为请求的一部分发送。现在想象一下，如果这些敏感数据被发送到我们访问的每个网站，会发生什么？这就是SOP发挥作用的地方。它检查我们拥有的敏感数据(如cookies)是否“属于”我们正在访问的当前网站，然后才允许访问这些数据。</p><p id="52d4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">对于DOM访问(通过JavaScript)也是如此。根据标准操作程序，如果一个JavaScript文件(来自其他来源)试图从一个非HTML文件来源的域访问您的DOM元素，它将被您的浏览器阻止。</p><blockquote class="mx my mz"><p id="ae0e" class="ks kt lo ku b kv kw jo kx ky kz jr la na lc ld le nb lg lh li nc lk ll lm ln ig bi translated">假设你不知何故被骗去参观www.your-bank.bad-site.com。在那个不良网站上，有一个<a class="ae lp" href="https://www.w3schools.com/html/html_iframe.asp" rel="noopener ugc nofollow" target="_blank"> iframe </a>加载<a class="ae lp" href="http://www.your-bank.com," rel="noopener ugc nofollow" target="_blank"><em class="in">www.your-bank.com</em>，</a>在那里你进行合法登录。登录后，在坏网站上的一个简单的JavaScript调用可以被用来访问iframe中加载的<a class="ae lp" href="http://www.your-bank.com" rel="noopener ugc nofollow" target="_blank"><em class="in">【www.your-bank.com】</em></a>的DOM元素，比如你的账户余额。现在想象一下他们能做什么…</p></blockquote><pre class="kd ke kf kg gt lq lr ls lt aw lu bi"><span id="c19c" class="lv lw in lr b gy lx ly l lz ma">frames.bank_frame.document.getElementById("balance").value</span></pre><blockquote class="mx my mz"><p id="1c5b" class="ks kt lo ku b kv kw jo kx ky kz jr la na lc ld le nb lg lh li nc lk ll lm ln ig bi translated">它所做的是访问iframe元素(名为<em class="in"> bank_frame </em>，然后在iframe的DOM中，它访问名为<em class="in"> balance </em>的HTML元素并获取其值。当然，这甚至可以扩展到伪造浏览器调用，将您的资金发送到其他地方！如果没有同源策略，这些跨站点请求可能会在您不同意或不知情的情况下执行。</p></blockquote><p id="78ad" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然而，重要的是要知道，SOP也寻找我们的浏览器上运行的文件的上下文。如果我们有一个从另一个来源(通过CDN)加载的JS文件，浏览器将允许它在我们的浏览器上运行，因为它是由那个HTML文件加载的。它与我们的HTML文件具有相同的上下文。</p><p id="2d33" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">顺便说一句，什么被认为是“同源”是有严格规定的。例如，其中一个具有相同的端口。因此，如果我们从https://www.example.com:8080的<a class="ae lp" href="https://www.example.com:8080," rel="noopener ugc nofollow" target="_blank">，</a>获得一个HTML文件，它将不会与https://www.example.com:8081的<a class="ae lp" href="https://www.example.com:8081." rel="noopener ugc nofollow" target="_blank">共享。</a>这听起来太严格了？这就是CORS开始行动的地方。</p><h1 id="6e1f" class="mb lw in bd mc md me mf mg mh mi mj mk jt ml ju mm jw mn jx mo jz mp ka mq mr bi translated">共享世界中的灵活性</h1><p id="3cec" class="pw-post-body-paragraph ks kt in ku b kv ms jo kx ky mt jr la lb mu ld le lf mv lh li lj mw ll lm ln ig bi translated">到目前为止，我们已经了解了如何限制我们的浏览器共享来自不同来源的资源。但是如果我们真的想要共享资源呢？有没有安全的方法绕过SOP的严格机制？</p><p id="2e93" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">考虑下面这个最常见的例子:我们进入一个网站并从中获取资源——一些HTML、CSS和JS。现在，我们必须向不同的源发出另一个请求，以从REST API获取数据。根据SOP，这是不允许的！请求将被发送，但是我们的浏览器将阻止响应。</p><p id="3fae" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">CORS配置主要在服务器端处理。我们基本上必须设置一些标头，这些标头将与来自服务器的响应一起发送。如果响应包含正确的标头，则浏览器不会阻止响应。我只想强调，CORS和SOP政策是浏览器的事情。</p><p id="443b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">例如，如果我们从浏览器向REST API发送一个请求，由于某种原因，服务器没有配置为向我们发送正确的头，从而使浏览器阻塞响应，有一种方法可以绕过它！</p><p id="1ed1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">解决方案是建立一个代理，作为浏览器和API之间的“代理”。当代理向该服务器发送请求时，它当然不会阻止来自该服务器的响应(它不是浏览器)。然后，我们可以用正确的头设置代理，将响应发送回浏览器。</p><h1 id="0486" class="mb lw in bd mc md me mf mg mh mi mj mk jt ml ju mm jw mn jx mo jz mp ka mq mr bi translated">结论</h1><p id="87b4" class="pw-post-body-paragraph ks kt in ku b kv ms jo kx ky mt jr la lb mu ld le lf mv lh li lj mw ll lm ln ig bi translated">在本文中，我们学习了SOP和CORS。它们都旨在为网络用户提供安全和隐私机制。它使我们在浏览器中接收的数据(HTML等)远离恶意攻击者。</p><p id="e44d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">重要的是要记住，CORS是浏览器用户的一种安全机制，但我们是在服务器端设置的。如果来自服务器的响应具有正确的标题，那么我们的浏览器将不会阻止它。</p><p id="d9fd" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我没有详细说明如何配置这些头，因为这篇文章是关于理解CORS一般是如何工作的，以及我们为什么需要它。如果您想了解如何配置CORS标头，可以使用以下资源:</p><ul class=""><li id="f246" class="nd ne in ku b kv kw ky kz lb nf lf ng lj nh ln ni nj nk nl bi translated"><a class="ae lp" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" rel="noopener ugc nofollow" target="_blank">MDN上的CORS</a>。</li><li id="e080" class="nd ne in ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><a class="ae lp" href="https://medium.com/@baphemot/understanding-cors-18ad6b478e2b" rel="noopener">好文章自媒体。</a></li><li id="f74f" class="nd ne in ku b kv nm ky nn lb no lf np lj nq ln ni nj nk nl bi translated"><a class="ae lp" href="https://auth0.com/blog/cors-tutorial-a-guide-to-cross-origin-resource-sharing/" rel="noopener ugc nofollow" target="_blank">来自Oauth的完全指南。</a></li></ul><p id="1754" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="lo">更多内容看</em> <a class="ae lp" href="https://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="lo">说白了就是io </em> </strong> </a> <em class="lo">。报名参加我们的</em> <a class="ae lp" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="lo">免费周报</em> </strong> </a> <em class="lo">。关注我们关于</em><a class="ae lp" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="lo">Twitter</em></strong></a><em class="lo">和</em><a class="ae lp" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="lo">LinkedIn</em></strong></a><em class="lo">。加入我们的</em> <a class="ae lp" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="ku io"> <em class="lo">社区</em> </strong> </a> <em class="lo">。</em></p></div></div>    
</body>
</html>