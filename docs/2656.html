<html>
<head>
<title>Hiding DOM Elements in React Based on Scrolling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于滚动隐藏React中的DOM元素</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/hiding-dom-elements-in-react-based-on-scrolling-d9a9ef1f1f5?source=collection_archive---------3-----------------------#2021-06-01">https://javascript.plainenglish.io/hiding-dom-elements-in-react-based-on-scrolling-d9a9ef1f1f5?source=collection_archive---------3-----------------------#2021-06-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e8e597cd2553f7da2db8ab0b70e558b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_oPWmUP-vS-203fG"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@sigmund?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sigmund</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c61f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在前端开发中，我们经常遇到需要根据滚动级别显示/隐藏元素的情况。在这里，我将讨论使用React实现这一点的两种方法。首先，我们自己实现它，其次使用已经可用的npm包。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="847b" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.履行</h1><p id="4acb" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">考虑这样一个HTML元素:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="7d04" class="mr lg in mn b gy ms mt l mu mv">&lt;div id="hide"&gt;Content hidden when scrolled beyond 1000px&lt;/div&gt;</span></pre><p id="81d3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了在React中隐藏这一点，我们需要根据滚动级别有条件地呈现这个div，最合理的选择是使用一个<strong class="kc io"> <em class="mw">状态变量</em> </strong>，它跟踪元素是否可见。我们可以使用<strong class="kc io"> <em class="mw"> useState </em> </strong>钩子来实现这一点。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="51d0" class="mr lg in mn b gy ms mt l mu mv">const [isVisible, setIsVisible] = useState(true);</span></pre><p id="bd82" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并使用这个变量<strong class="kc io"> <em class="mw">有条件地渲染</em> </strong>这个div，就像这样:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="3cb8" class="mr lg in mn b gy ms mt l mu mv">{<br/>   <strong class="mn io">isVisible <br/>      &amp;&amp; </strong><br/>   &lt;div id="hide"&gt;Content hidden when scrolled beyond 1000px&lt;/div&gt;<br/>}</span></pre><p id="6357" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，剩下的就是创建变量，跟踪滚动级别，并找出元素是否必须显示或隐藏。我们可以通过添加一个<strong class="kc io"> <em class="mw">事件监听器</em> </strong>来跟踪滚动，这必须在组件安装时添加，在组件卸载时删除。</p><p id="ce91" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，我们使用<strong class="kc io"> <em class="mw"> useEffect </em> </strong>钩子来添加事件监听器，带有一个空白的依赖数组，该数组返回一个函数，该函数在卸载期间执行我们的清理(即删除事件监听器)。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8fa2" class="mr lg in mn b gy ms mt l mu mv">useEffect(() =&gt; {   <br/>  window.addEventListener("scroll", <strong class="mn io">listenToScroll</strong>);<br/>  return () =&gt; <br/>     window.removeEventListener("scroll", <strong class="mn io">listenToScroll</strong>); <br/>}, [])</span></pre><p id="827d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们的挂载和卸载功能已经完成，可以添加和删除滚动事件监听器了。现在我们到了最后也是最重要的一步，就是定义<strong class="kc io"><em class="mw">listenToScroll()</em></strong>函数，它是我们在上一步中作为监听器函数添加的。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="4f69" class="mr lg in mn b gy ms mt l mu mv">const listenToScroll = () =&gt; {<br/>  let heightToHideFrom = 1000;<br/>  const winScroll = document.body.scrollTop || <br/>      document.documentElement.scrollTop;<br/>     <br/>  if (<strong class="mn io">winScroll &gt; heightToHideFrom</strong>) { <br/>     <strong class="mn io">isVisible &amp;&amp;</strong>      // to limit setting state only the first time         <br/>       <strong class="mn io">setIsVisible(false);</strong><br/>  } else {<strong class="mn io"><br/>       setIsVisible(true);</strong><br/>  }  <br/>};</span></pre><p id="a71e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，现在我们的isVisible变量将跟踪是否必须显示或隐藏div。整个事情看起来会像这样:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5420" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">也可能有这样的情况，当一个元素到达一个div时，你可能想要隐藏它，为此你需要做的就是改变<strong class="kc io"><em class="mw">heightToHideFrom</em></strong>变量中的<strong class="kc io"> <em class="mw"> listenToScroll()。</em> </strong></p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a10f" class="mr lg in mn b gy ms mt l mu mv">const heightToHideFrom = <br/>      getOffset(document.querySelector("#<strong class="mn io">your-div-id</strong>")</span></pre><p id="c7f2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面使用的<strong class="kc io"> <em class="mw"> getOffset() </em> </strong>函数还没有定义，但是它的作用只是从你想要的div的包围矩形中获取顶部偏移量，可以这样实现:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="1b67" class="mr lg in mn b gy ms mt l mu mv">const getOffset = (element) =&gt; {<br/>  const rect = element?.getBoundingClientRect(),<br/>    scrollTop = <br/>      window.pageYOffset ||  document.documentElement.scrollTop;</span><span id="b9d6" class="mr lg in mn b gy mz mt l mu mv">  return rect!.top + scrollTop;<br/>};</span></pre><p id="9452" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于任何给定的场景，您可以使用这些方法，轻松地隐藏/显示React中的任何元素！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="bdfb" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.NPM套餐</h1><p id="97f5" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">实际上，为你工作的每个项目编写隐藏/显示元素的组件只是不必要的重复发明。这就是预构建包派上用场的地方。</p><p id="3682" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是为什么我构建了这个包，<a class="ae jz" href="https://www.npmjs.com/package/react-hide-on-scroll" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mw">react-hide-on-scroll</em></strong></a>，它有许多实用组件，为大多数场景提供功能，比如在特定高度范围之间、从特定高度、在特定div之间或从特定div，或者基于滚动方向隐藏/显示，等等。</p><p id="f231" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">例如，为了在滚动超过1000像素时隐藏一个div，而不是编写所有代码来实现我们在上一个示例中所做的，我们可以简单地这样做:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="245d" class="mr lg in mn b gy ms mt l mu mv">&lt;HideOn atHeight height={1000}&gt;<br/>   &lt;div id="hide"&gt;Content hidden when scrolled beyond 1000px&lt;/div&gt;<br/>&lt;/HideOn&gt;</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/ad718ffbceee9e1d71328063b27ea906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWKa8F8C-gheUFBszSqhuA.png"/></div></div></figure><p id="f1b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它的包大小只有949b minified+gzipped，所以它也不会给你的项目增加很多开销！而且它还有清晰的说明和API。</p><p id="d06c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，通过运行以下命令下载这个包，开始构建您的项目，而不用担心构建隐藏/显示功能:</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a475" class="mr lg in mn b gy ms mt l mu mv">npm i react-hide-on-scroll</span></pre><p id="7b01" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">访问<a class="ae jz" href="https://www.npmjs.com/package/react-hide-on-scroll" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mw">NPM</em></strong></a><strong class="kc io"><em class="mw">页面</em></strong>:<a class="ae jz" href="https://www.npmjs.com/package/react-hide-on-scroll" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"/></a><strong class="kc io">。</strong></p><p id="4490" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你愿意，你也可以为这个项目做贡献！</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="b044" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢您的阅读。</p><p id="18e4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mw">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mw">plain English . io</em></a></p></div></div>    
</body>
</html>