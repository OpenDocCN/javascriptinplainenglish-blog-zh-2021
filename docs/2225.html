<html>
<head>
<title>3 Easy Ways to Debug Jest Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调试Jest测试的3种简单方法</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/3-easy-ways-to-debug-jest-tests-66f26b97b3af?source=collection_archive---------2-----------------------#2021-05-10">https://javascript.plainenglish.io/3-easy-ways-to-debug-jest-tests-66f26b97b3af?source=collection_archive---------2-----------------------#2021-05-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/2bc883f4e280630ad2aec13bd2eccbe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s1pe1Mdm16e8LUA7UrrMBg.png"/></div></div></figure><ul class=""><li id="0abd" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><a class="ae kn" href="#33be" rel="noopener ugc nofollow">简介</a></li><li id="f42d" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated"><a class="ae kn" href="#ed67" rel="noopener ugc nofollow"> 1#原生节点inspect + Chrome DevTools </a></li><li id="6946" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated"><a class="ae kn" href="#8958" rel="noopener ugc nofollow"> 2# VSCode脚本运行器</a></li><li id="64f9" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated"><a class="ae kn" href="#8856" rel="noopener ugc nofollow"> 3# VSCode扩展</a></li><li id="251f" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated"><a class="ae kn" href="#e83f" rel="noopener ugc nofollow">汇总表</a></li><li id="bccb" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated"><a class="ae kn" href="#f769" rel="noopener ugc nofollow">额外要点:异步测试问题</a></li></ul><p id="33be" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">编写测试是软件开发的关键部分。更常见的是单元测试或集成测试，这些是与本文最相关的。</p><p id="9905" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">调试测试背后的想法是减少对“console.log”表达式的依赖，并帮助找到导致测试失败的原因。在Javascript世界中，由于“零编译时间”和更快的启动时间，我们倾向于编写一些“console.log ”,运行并查看输出是什么。在其他编译语言中，这个过程太慢而不实用，调试工具用得更多。我认为这是我们必须作为我们的东西，以提高我们作为开发人员的质量。</p><p id="98c7" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">在这里，我们将看到在调试模式下运行测试的三种不同方式，从“最难”到“最容易”(对我来说)，至少从在调试模式下运行测试用例的“必须做的事情”的角度来看是这样的。第一种情况将完全独立于IDE，另外两种将基于<a class="ae kn" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a>。所有的选项将使用Jest作为测试运行程序。</p><p id="ed67" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><strong class="jx io"> 1。原生节点检查+ Chrome开发工具</strong></p><p id="6efa" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">这种方式需要首先启动命令，在“检查模式”下运行测试，然后打开DevTools执行代码调试。</p><ul class=""><li id="7c8c" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">运行命令(使用— inspect-brk，我们确保在第一行停止该过程，更多信息<a class="ae kn" href="https://nodejs.org/en/docs/guides/debugging-getting-started/" rel="noopener ugc nofollow" target="_blank">在此处</a>)</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/7d559ac2f2ba11fec9c829f4b3784bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PukaO3KkSiAd89zavz8PZA.png"/></div></div></figure><ul class=""><li id="e0f4" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">这将显示类似于</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ln"><img src="../Images/75d39c27a25d7aaeb2ce7e9f76f2bd76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10cZK0pLZFWSfMCO8iZ6Pg.png"/></div></div></figure><ul class=""><li id="56b5" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">现在我们应该打开我们的Chrome应用程序，并转到URL“Chrome://inspect/# devices ”,在那里我们将看到</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lo"><img src="../Images/32757a1f03c89fbdb397729ae07bee24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCaRHo9EVNBCQnP_tbMjFA.png"/></div></div></figure><ul class=""><li id="084e" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">要开始调试，请按“检查”,将显示检查器屏幕</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lp"><img src="../Images/17a6f27fc46efa4a194d6e17553532c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4uPZkDShfLA1DlRigs2q8A.png"/></div></div></figure><ul class=""><li id="3e3d" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">如果我们看不到我们的代码，我们只需按“+ Add to workspace”并选择包含我们代码的文件夹。一旦我们看到左侧的文件夹结构，我们就可以导航并打开所需的文件。我们也可以按“CMD+o”(windows中的CTRL + o)来按名称搜索文件</li><li id="5820" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated">现在我们可以使用调试器选项(添加断点、转到下一步、单步执行等)来调试或编码</li></ul><p id="feaa" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><em class="lq">这里重要的一点是，直到我们关闭inspector视图，我们的test runner命令才会结束，即使测试代码已经全部处理完毕。</em></p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/f8d4b7660d6894a4085e28760d49aa73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jyRNSr-ZYisI0-NpFZgGTA.png"/></div></div></figure><p id="8958" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><strong class="jx io"> 2。VSCode脚本运行器</strong></p><p id="3578" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">VSCode debugger允许我们做一些不同的事情来调试我们的代码。这里，我们将展示如何替换Chrome DevTools inspector，并使用VSCode直接在代码编辑器中调试代码。</p><ul class=""><li id="d232" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第一个任务是选择侧边栏中的调试菜单</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/1667261dab0616da27c98b9798a94360.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*iBrFMLli0WWMtiO4VIRUOA.png"/></div></figure><ul class=""><li id="6b55" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">然后我们点击“Ejecutar y depurar”(这将是您的系统语言)，我们将看到类似这样的内容</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/4b54b5166b8521631bd9e29c788fe239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gyrqj9VYHicEeRRj2_coOg.png"/></div></div></figure><ul class=""><li id="fd1d" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">我们选择Node.js。这将在我们的目录中创建一个文件。我们的配置将存储在vscode/launch.json中。</li><li id="8671" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated">现在我们将添加我们的“附加”配置来调试我们的测试文件。为此，在同一个调试视图中，我们将选择“Agregar配置”(翻译成您的系统语言)</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/857c7a9e8581a0e58a986e91680b6c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*TuBjR9n1FhMVi57I6B7-vw.png"/></div></figure><ul class=""><li id="cdbb" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在列表中，我们选择“Node.js: Attach”</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/3c0530cf1b7c6f4dabcf631df559203d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ja6Tq6y3FkkIok9HFkYJBA.png"/></div></div></figure><ul class=""><li id="d6f1" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">现在我们有了这样一个“launch.json”文件</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/2cb39b1e5d1c2073253695206c4c7126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRRs8NzAbR2duH68phvDtg.png"/></div></div></figure><ul class=""><li id="b5fd" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">到目前为止，我们不需要另一个配置，它是在创建文件时创建的。所以我们的文件结尾是</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/b3dc353d502872f1546ff3711ee61a4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RHpE5cSxVyZFfzRnCkGqHA.png"/></div></div></figure><ul class=""><li id="e6f0" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">现在我们准备开始调试我们的文件。正如我们之前所做的，我们运行命令开始调试</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi li"><img src="../Images/7d559ac2f2ba11fec9c829f4b3784bbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PukaO3KkSiAd89zavz8PZA.png"/></div></div></figure><ul class=""><li id="2544" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">然后在VSCode中将de进程附加到我们的调试器</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/ba22a2854aa5f34c624d0871693e8570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*rdHMdaj2lb-t-rymTHGdpg.png"/></div></figure><ul class=""><li id="989d" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">现在我们可以添加断点来调试我们的进程，就像我们在Chrome inspector中做的一样，我们可以看到变量值，继续进程，等等。</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/dcc526d7679ddb8bcafa624878e28110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IwsjkX9jbGaG-EhldeaiQ.png"/></div></div></figure><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/3f66f240a0a2381d20b7431fa3ee6dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*cm_PNYjurZBzrLL8oDcmkA.png"/></div></figure><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/768130f68a7e4b74f1e8d10f33fbca30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*C7YlhxKTtmhA-YuqzWyDQw.png"/></div></figure></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><p id="0462" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">我们这里的另一个选项是，我们可以先按“Attach ”,然后运行命令来开始测试。如果我们选择这种方法，我们:</p><ul class=""><li id="89b1" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">必须先在代码中添加断点(以确保执行在代码中的某个点停止)</li><li id="3f0a" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated">我们可以从命令中删除“— inspect-brk”</li></ul><p id="8856" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><strong class="jx io"> 3。VSCode扩展</strong></p><p id="0cf1" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">调试(和运行)我们的测试用例以及单个测试文件的最简单方法是使用我们的VSCode的一个可用扩展。</p><p id="d2cf" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">对于这个例子，我们将使用扩展“Jest Runner”</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/f67bd75349caef96e8530554cfc5a622.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWOFFCGhMAJ9ATjBNdicng.png"/></div></div></figure><p id="6379" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">一旦安装完毕，我们将有一个上下文菜单来运行或调试我们的测试用例。我们只需右击测试文件，就可以选择我们想要的操作</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/9ce5674fa225cf6fda48c552e95d701d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qS6Si8RlGB2GJ-B54vqLxA.png"/></div></div></figure><p id="57e5" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">使用安装的扩展运行测试的另一种方法是使用命令工具:</p><ul class=""><li id="5cb9" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Shift + Cmd+ p(在windows中为Shift + Ctrl +p)打开命令选项板</li><li id="f45a" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated">写“笑话”</li></ul><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/ec52cc07f73ed24cb930c4b91c2927e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7xNlGWHOyEfzGOu0GoBgCQ.png"/></div></div></figure><p id="be0f" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">您唯一需要做的事情是在选择“Debug Jest”之前添加所需的断点，调试过程将在您的VSCode中开始，并带有所有之前看到的选项来调试我们的代码。</p><p id="e83f" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><strong class="jx io">汇总表</strong></p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/488462202c816e1df95c4e641e01bc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aKVjruyxDOlCVok02FkNoA.png"/></div></div></figure><p id="f769" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><strong class="jx io">额外要点:“运行异步测试时出现问题”</strong></p><p id="4679" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">这个“问题”在我们之前看到的调试测试用例的所有方法中都是常见的。我们来解释一下“问题”。</p><p id="e037" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">对于像这样的测试用例</p><figure class="lj lk ll lm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/b08fbb71ef4681098e6544c7f2050a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcF65f3eh_C6uAQXMwFo_w.png"/></div></div></figure><p id="bdb2" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">在调试过程中，您可以看到“之后”中的代码可以在“之前”块中的代码结束之前被调用。</p><p id="bfe4" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">这可能是因为测试超时。测试用例结束的最大时间比我们调试代码的时间要短。</p><p id="32bb" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">要解决这个问题，我们只需增加jest超时。有几种方法可以增加测试超时，下面是其中的两种:</p><ul class=""><li id="237e" class="jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于代码:<code class="fe mo mp mq mr b">jest.setTimeout(30000);</code></li><li id="e6a3" class="jv jw in jx b jy ko ka kp kc kq ke kr kg ks ki kj kk kl km bi translated">在命令上:<code class="fe mo mp mq mr b">--testTimeout</code><a class="ae kn" href="https://jestjs.io/docs/cli#testtimeout-number" rel="noopener ugc nofollow" target="_blank">https://jestjs.io/docs/cli#testtimeout-number</a></li></ul><p id="c499" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">我希望你喜欢它的内容，并开始使用更多我们有的调试工具，而不再使用旧的好工具“console.log”。</p><p id="fdb6" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">如果你有其他方法来调试你的Jest测试用例，请在评论中告诉我。</p><p id="572b" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated">感谢阅读。</p><p id="f2cc" class="pw-post-body-paragraph kt ku in jx b jy jz kv kw ka kb kx ky kc kz la lb ke lc ld le kg lf lg lh ki ig bi translated"><em class="lq">更多内容尽在</em><a class="ae kn" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="lq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>