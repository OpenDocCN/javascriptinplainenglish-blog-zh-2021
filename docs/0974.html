<html>
<head>
<title>How to Trigger Animations with React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用React钩子触发动画</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-trigger-animations-using-react-hooks-27f0231b98b7?source=collection_archive---------5-----------------------#2021-03-01">https://javascript.plainenglish.io/how-to-trigger-animations-using-react-hooks-27f0231b98b7?source=collection_archive---------5-----------------------#2021-03-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/cce1795085d016dc8aef3d4e07c0bfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xYdulvtZPmAjlMtfs_ALHg.png"/></div></div></figure><h1 id="7ab7" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">网站动画</h1><p id="915e" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在这个时代，网站似乎需要动画。我会说，根据你要去的网站类型，动画可能是合适的。在这篇文章中，让我们来看看如何使用React钩子触发动画。我们希望能够控制用户何时看到动画。当用户滚动到网站的某个部分时，我们将使用CSS滑动元素。</p><h1 id="7cf1" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置</h1><p id="2759" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">在这篇文章中，我将使用React和Tailwind CSS，但是你可以使用任何你想使用的CSS。我将为顺风CSS使用一个名为@headlessui/react的组件。所以让我们从安装这个包开始。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="b10e" class="ma jw in lw b gy mb mc l md me">npm i @headlessui/react</span></pre><h1 id="e6dc" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">滑动组件</h1><p id="b371" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在我们已经安装好了，让我们创建一个组件来使用Tailwind CSS类，它将动画元素，使其滑入屏幕。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="db94" class="ma jw in lw b gy mb mc l md me">import { Transition } from '@headlessui/react';</span><span id="d19a" class="ma jw in lw b gy mf mc l md me">interface Props {<br/>  show?: boolean;<br/>  children: React.ReactNode;<br/>}</span><span id="2762" class="ma jw in lw b gy mf mc l md me">export default function SlideUp(props: Props) {<br/>  const { show, children } = props;<br/>  return (<br/>    &lt;Transition<br/>      show={show}<br/>      enter="transform transition ease-out duration-500"<br/>      enterFrom="opacity-0 translate-y-full"<br/>      enterTo="opacity-100 translate-y-0"<br/>      leave="transform transition ease-out duration-500"<br/>      leaveFrom="opacity-100 translate-y-0"<br/>      leaveTo="opacity-0 translate-y-full"<br/>    &gt;<br/>      {children}<br/>    &lt;/Transition&gt;<br/>  );<br/>}</span></pre><p id="1103" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">使用这个组件，你可以定义当布尔show设置为true时CSS运行什么。然后当它被设置为false时，它将撤销或隐藏该元素。</p><p id="17df" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">因此，当它想要显示它将运行这个动画类</p><p id="5f70" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">从</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="066c" class="ma jw in lw b gy mb mc l md me">opacity-0 translate-y-full</span></pre><p id="a995" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">到</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="2e43" class="ma jw in lw b gy mb mc l md me">opacity-100 translate-y-0</span></pre><p id="d3e7" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">它将以0的不透明度开始，并将元素滑动到视口中，将不透明度动画化为100。</p><p id="bc39" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">现在让我们创建一个容器组件来控制显示布尔值。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="1158" class="ma jw in lw b gy mb mc l md me">import { useState, useRef } from 'react';<br/>import useTriggerOnScroll from '../../../hooks/useTriggerOnScroll';<br/>import Slide from '../SlideUp';</span><span id="f542" class="ma jw in lw b gy mf mc l md me">interface Props {<br/>  className?: string;<br/>  children: React.ReactNode;<br/>}</span><span id="88ce" class="ma jw in lw b gy mf mc l md me">export default function ScrollSlideUp(props: Props) {<br/>  const { className = '', children } = props;<br/>  const el = useRef();<br/>  const [show, setShow] = useState&lt;boolean&gt;(false);<br/>  useTriggerOnScroll(el, (triggered) =&gt; {<br/>    setShow(triggered);<br/>  });<br/>  return (<br/>    &lt;div className={className} ref={el}&gt;<br/>      &lt;Slide show={show}&gt;{children}&lt;/Slide&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="f8cf" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">这个组件将包围我们的转换组件。你可以设置你自己的CSS类，你不需要使用Tailwind。这个容器组件将设置一个react引用来控制元素，并使用我们的自定义钩子来计算元素是否已经被滚动到。如果有，那么它将使用一个触发的布尔值调用回调。然后，使用触发的布尔值，我们可以将过渡组件设置为动画。</p><h1 id="a7ca" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">useTriggerOnScroll</h1><p id="1a80" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在让我们创建我们的自定义挂钩。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="ae1b" class="ma jw in lw b gy mb mc l md me">import { useEffect, useState } from 'react';</span><span id="1762" class="ma jw in lw b gy mf mc l md me">function getOffset(el) {<br/>  var _x = 0;<br/>  var _y = 0;<br/>  while (el &amp;&amp; !isNaN(el.offsetLeft) &amp;&amp; !isNaN(el.offsetTop)) {<br/>    _x += el.offsetLeft - el.scrollLeft;<br/>    _y += el.offsetTop - el.scrollTop;<br/>    el = el.offsetParent;<br/>  }<br/>  return { top: _y, left: _x };<br/>}</span><span id="d120" class="ma jw in lw b gy mf mc l md me">function hasScrolledTo(el) {<br/>  if (!el) return false;<br/>  const top = getOffset(el).top;<br/>  const offset = window.innerHeight / 2;<br/>  return top - offset &lt;= window.pageYOffset;<br/>}</span><span id="49e0" class="ma jw in lw b gy mf mc l md me">export default function useTriggerOnScroll(ref, onTrigger) {<br/>  const [triggered, setTriggered] = useState&lt;boolean&gt;(false);<br/>  useEffect(() =&gt; {<br/>    function onScroll() {<br/>      const viewed = hasScrolledTo(ref.current);<br/>      if (viewed &amp;&amp; !triggered) {<br/>        window.removeEventListener('scroll', onScroll);<br/>        setTriggered(true);<br/>        onTrigger(true);<br/>      } else if (!viewed &amp;&amp; triggered) {<br/>        window.removeEventListener('scroll', onScroll);<br/>        setTriggered(false);<br/>        onTrigger(false);<br/>      }<br/>    }<br/>    setTimeout(() =&gt; {<br/>      window.addEventListener('scroll', onScroll);<br/>    }, 1000);<br/>    return () =&gt; {<br/>      window.removeEventListener('scroll', onScroll);<br/>    };<br/>  }, [ref, onTrigger, triggered]);<br/>}</span></pre><p id="25e7" class="pw-post-body-paragraph kt ku in kv b kw mg ky kz la mh lc ld le mi lg lh li mj lk ll lm mk lo lp lq ig bi translated">这将设置一些帮助函数来计算元素是否已经被滚动到。然后我们设置一个useEffect来创建窗口滚动事件监听器。每当网页滚动时，它将调用我们的事件处理程序，并检查元素是否已经滚动到。如果有，我们将状态设置为true并调用onTrigger call back，然后它将调用我们的容器组件并激活元素。当用户向上滚动时，if会将show boolean设置为false并重新隐藏该元素。</p><h1 id="1730" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><p id="3f59" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">有许多CSS动画库和软件包。这是创建一个自定义挂钩，如果你需要任何自定义代码编写动画。如果您对如何运行动画有任何意见或建议，请随时留下您的评论。</p></div></div>    
</body>
</html>