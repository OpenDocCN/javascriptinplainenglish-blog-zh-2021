<html>
<head>
<title>Introduction to Testing in React with Jest and React Testing Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React with Jest和React测试库中的测试介绍</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/introduction-to-testing-in-react-with-jest-and-react-testing-library-c1c32bb11739?source=collection_archive---------5-----------------------#2021-04-07">https://javascript.plainenglish.io/introduction-to-testing-in-react-with-jest-and-react-testing-library-c1c32bb11739?source=collection_archive---------5-----------------------#2021-04-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f45e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">create-react-app中的App.test.js和setupTests.js文件是用来做什么的？</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/2f683d42825a14da2375db93a78e600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*imtyfaxGGCJ_jRPZ"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jerry_318?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jerry Wang</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8da7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你用过create-react-app，我敢肯定你以前见过<code class="fe ls lt lu lv b">App.test.js</code>和<code class="fe ls lt lu lv b">setupTests.js</code>文件。如果你和我一样，开始一个新项目的第一件事就是删除那些文件。所有教程都是这么做的吧？</p><p id="2bb0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我从未想过在我的应用程序中包含测试。我一直认为我可以在开发的时候手动测试这个应用程序。我认为学习如何编写测试并在我自己的项目中编写它们是浪费时间。</p><p id="898a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">直到现在。在我目前的工作中，我的任务是使用Jest和React测试库在React应用程序中编写测试。</p><p id="67a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在过去的几天里，我花了很多时间学习测试，我将在本文中分享我所学到的东西。我们将创建一个新的create-react-app应用程序，看看这两个文件，<code class="fe ls lt lu lv b">App.test.js</code>和<code class="fe ls lt lu lv b">setupTests.js</code>。该是我们了解它们的用途以及如何使用它们的时候了。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="0179" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">运行您的第一个测试</h1><p id="266b" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">create-react-app自带Jest和react测试库安装。这是在您的应用程序中运行单元测试的推荐方式。</p><p id="f25a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们创建一个新的应用程序并打开<code class="fe ls lt lu lv b">App.test.js</code>文件，这将是它的样子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="3e50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这实际上是他们为我们创造的一个测试。如果你想知道会发生什么，在你的项目终端中运行<code class="fe ls lt lu lv b">npm test</code>。</p><p id="f232" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一次运行<code class="fe ls lt lu lv b">npm test</code>时，你会得到这个命令的提示。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/5d441eac4030f76eb6047eb90a9faa6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3RGY_VGGLwLwzqEpCeX9dQ.png"/></div></div></figure><p id="5f7e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Jest有一个监视模式，检查自上次提交以来是否有任何测试文件被更改。按下<code class="fe ls lt lu lv b">a</code>运行所有测试。然后，您将看到此消息出现。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nd"><img src="../Images/7d10f7595568f72a668acbcc1878efe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j49KBYu9DDDVlAMGvFNC8Q.png"/></div></div></figure><p id="967a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">绿色表示我们的测试通过了！但是我们到底测试了什么呢？让我们更仔细地检查代码。</p><h1 id="4358" class="md me iq bd mf mg ne mi mj mk nf mm mn jw ng jx mp jz nh ka mr kc ni kd mt mu bi translated">应用测试网站</h1><p id="286f" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">我们将首先看一下<code class="fe ls lt lu lv b">App.test.js</code>文件，并逐行分解。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="3cbc" class="nn me iq lv b gy no np l nq nr">import { render, screen } from '@testing-library/react';<br/>import App from './App';</span></pre><p id="c5ec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这前两行似乎并不太奇怪。我们从<code class="fe ls lt lu lv b">@testing-library/react</code>库中导入两个对象，并导入App组件。到目前为止，一切顺利。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="7a7c" class="nn me iq lv b gy no np l nq nr">test('renders learn react link', () =&gt; {<br/>  <br/>});</span></pre><p id="de5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是考验。create-react-app使用<a class="ae kv" href="https://jestjs.io/" rel="noopener ugc nofollow" target="_blank"> Jest </a>作为测试框架。Jest帮助我们设置和运行测试。</p><p id="35a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">测试函数有三个参数；名称、功能和超时(可选，此处不包含)。</p><p id="babc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">第一个参数是测试的名称。在我们的例子中，测试被命名为<em class="ns">“渲染学习反应链接”</em>。第二个参数是包含测试期望的函数。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="2c61" class="nn me iq lv b gy no np l nq nr">render(&lt;App /&gt;);</span></pre><p id="8b14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在函数中，我们首先将App组件从<code class="fe ls lt lu lv b">@testing-library/react</code>库中传递给render方法。这就是<a class="ae kv" href="https://testing-library.com/docs/react-testing-library/intro/" rel="noopener ugc nofollow" target="_blank">反应测试库</a>发挥作用的地方。React测试库帮助我们渲染组件、搜索和与虚拟DOM交互。通过使用App组件作为参数调用render方法，我们创建了App组件的虚拟DOM。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="b887" class="nn me iq lv b gy no np l nq nr">const linkElement = screen.getByText(/learn react/i);</span></pre><p id="5206" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以使用screen对象访问虚拟DOM。我们在屏幕上调用<code class="fe ls lt lu lv b">getByText()</code>方法。这是一个允许我们在页面上查找元素的查询。你可以在这里阅读更多关于查询<a class="ae kv" href="https://testing-library.com/docs/queries/about/" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><p id="435b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们通过的论证是<code class="fe ls lt lu lv b">/learn react/i</code>。这是一个不区分大小写的正则表达式。如果我们愿意，我们也可以只传递一个字符串。</p><p id="7649" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">基本上，上面的代码行是说用文本<em class="ns">“learn react”</em>(不区分大小写)在虚拟DOM中查找一个元素，并将其存储在一个名为<code class="fe ls lt lu lv b">linkElement</code>的变量中。</p><pre class="kg kh ki kj gt nj lv nk nl aw nm bi"><span id="0284" class="nn me iq lv b gy no np l nq nr">expect(linkElement).toBeInTheDocument();</span></pre><p id="3b3e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里的最后一行代码称为断言。这将导致测试成功或失败。如果我们大声读出来，我们就能理解我们所期待的。<em class="ns">期望链接元素在文档中。</em></p><p id="4cd8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们从Jest调用expect函数，并传递一个<code class="fe ls lt lu lv b">linkElement</code>参数。<code class="fe ls lt lu lv b">linkElement</code>是我们正在检查的。断言的最后一部分称为匹配器。这是来自Jest-DOM，我们将在下一节讨论。匹配器正在做它所说的事情。它正在检查<code class="fe ls lt lu lv b">linkElement</code>是否在文档中。</p><p id="920c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果测试可以在虚拟DOM中找到一个文本为<em class="ns">“learn react”</em>(不区分大小写)的元素，那么这个测试将通过。如果没有，就会失败。</p><p id="ae02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们启动我们的应用程序，我们会看到这一点。正如你所看到的，<em class="ns">【学反应】</em>的文字就在那里！</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/da96ba5e70ded2a8b00e7763c3f3bac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHTyYl67KCdTys8zFHxpxA.png"/></div></div></figure><h1 id="5de6" class="md me iq bd mf mg ne mi mj mk nf mm mn jw ng jx mp jz nh ka mr kc ni kd mt mu bi translated">setupTests.js</h1><p id="d1cc" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">在上一节中，我们提到了<a class="ae kv" href="https://testing-library.com/docs/ecosystem-jest-dom/" rel="noopener ugc nofollow" target="_blank"> Jest-DOM </a>和matchers。这就是需要<code class="fe ls lt lu lv b">setupTests.js</code>文件的地方。</p><p id="738d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">和Jest和React测试库一样，Jest-DOM是和create-react-app一起安装的。<code class="fe ls lt lu lv b">setupTests.js</code>文件将库导入到我们的应用程序中，让我们可以访问匹配器。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5af4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们的示例测试中使用的匹配器是<code class="fe ls lt lu lv b">toBeInTheDocument()</code>方法。我们可以用更多的匹配器。你可以在这里阅读更多关于他们的信息。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="3c32" class="md me iq bd mf mg mh mi mj mk ml mm mn jw mo jx mp jz mq ka mr kc ms kd mt mu bi translated">结论</h1><p id="b3ca" class="pw-post-body-paragraph kw kx iq ky b kz mv jr lb lc mw ju le lf mx lh li lj my ll lm ln mz lp lq lr ij bi translated">感谢阅读！谈到测试，我们只是触及了表面。但是，我希望这篇文章能让你对我们使用create-react-app时这两个文件的作用有所了解。我自己知道，它们只是我马上删除的文件。</p><p id="86f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我正在使用Jest和React测试库更深入地测试React应用程序，敬请期待更多文章！</p><p id="f459" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您想了解如何在React中处理错误，可以看看下面的文章。</p><div class="nu nv gp gr nw nx"><a href="https://levelup.gitconnected.com/how-to-handle-errors-in-react-with-react-error-boundary-436cf423bdca" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">如何用React错误边界处理React中的错误</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">react-error-boundary包介绍及示例</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">levelup.gitconnected.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol kp nx"/></div></div></a></div><p id="61ad" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="ns">更多内容尽在</em><a class="ae kv" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="ns">plain English . io</em></strong></a></p></div></div>    
</body>
</html>