<html>
<head>
<title>Mongoose (validation + hooks = ğŸ”¥)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">çŒ«é¼¬(éªŒè¯+æŒ‚é’©=ğŸ”¥)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/mongoose-validation-hooks-652f77b665e2?source=collection_archive---------9-----------------------#2021-01-26">https://javascript.plainenglish.io/mongoose-validation-hooks-652f77b665e2?source=collection_archive---------9-----------------------#2021-01-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b6df" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">mongooseå†…ç½®çš„éªŒè¯å’Œé’©å­æœ‰æ—¶æ˜¯å¤šä¹ˆå¼ºå¤§ç­‰ç­‰</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/63f03a3b9857b227a141946af098793a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*te5qr8rlPJW70lIn"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@manuelsardo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Manuel Sardo</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7429" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Mongooseæ˜¯mongo DBæ•°æ®åº“çš„ä¸€ä¸ª<strong class="kv io"> ODM(å¯¹è±¡æ–‡æ¡£å»ºæ¨¡å™¨)</strong>ã€‚å®ƒæä¾›äº†è¯¸å¦‚å†…ç½®è½¬æ¢ã€æŸ¥è¯¢æ„å»ºã€éªŒè¯ç­‰ä¾¿åˆ©ã€‚</p><h1 id="15c0" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated"><strong class="ak">éªŒè¯</strong></h1><p id="6cfa" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">æ‚¨ä¸€å®šå·²ç»åœ¨expressä¸­ä½¿ç”¨äº†<a class="ae ks" href="https://www.npmjs.com/package/joi" rel="noopener ugc nofollow" target="_blank"> joi </a>è¿›è¡Œæ¨¡å¼éªŒè¯ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mongoseè¿›è¡ŒéªŒè¯ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨joiè¿™æ ·çš„æ²‰é‡çš„åŒ…å‘¢ï¼Œç°åœ¨æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨mongoose validateå‡½æ•°æ¥éªŒè¯æ¨¡å¼ã€‚</p><p id="c752" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">åœ¨è¿™é‡Œï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ³¨å†Œæ–°ç”¨æˆ·çš„ç®€å•è·¯å¾„:</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="4404" class="mr lq in mn b gy ms mt l mu mv">// *NEW USER ROUTE</span><span id="8ce7" class="mr lq in mn b gy mw mt l mu mv">app.post("/register", async (req, res) =&gt; {</span><span id="3e88" class="mr lq in mn b gy mw mt l mu mv">try {</span><span id="bc2f" class="mr lq in mn b gy mw mt l mu mv">const user = await User.create(req.body);</span><span id="3158" class="mr lq in mn b gy mw mt l mu mv">res.json({ success: true, message: "User saved successfuly!!" });</span><span id="1607" class="mr lq in mn b gy mw mt l mu mv">} catch (e) {</span><span id="b70d" class="mr lq in mn b gy mw mt l mu mv">return res.status(400).json({ success: false, messge: e.message });</span><span id="e085" class="mr lq in mn b gy mw mt l mu mv">}</span><span id="32a5" class="mr lq in mn b gy mw mt l mu mv">});</span></pre><p id="9a7f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mx">ç”¨æˆ·å‹å·:</em></p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="c3cc" class="mr lq in mn b gy ms mt l mu mv">const mongoose = require("mongoose");</span><span id="33ad" class="mr lq in mn b gy mw mt l mu mv">const bcrypt = require("bcryptjs");</span><span id="4f69" class="mr lq in mn b gy mw mt l mu mv">const User = new mongoose.Schema({</span><span id="d7d7" class="mr lq in mn b gy mw mt l mu mv">name: {</span><span id="173f" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="defe" class="mr lq in mn b gy mw mt l mu mv">required: true,</span><span id="1bc9" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="047e" class="mr lq in mn b gy mw mt l mu mv">email: {</span><span id="3a15" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="7a35" class="mr lq in mn b gy mw mt l mu mv">required: true,</span><span id="9023" class="mr lq in mn b gy mw mt l mu mv">unique: true,</span><span id="990c" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="6201" class="mr lq in mn b gy mw mt l mu mv">phone: {</span><span id="b3d8" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="df3e" class="mr lq in mn b gy mw mt l mu mv">required: true,<br/>},</span><span id="c269" class="mr lq in mn b gy mw mt l mu mv">password: {</span><span id="3f82" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="c75f" class="mr lq in mn b gy mw mt l mu mv">required: true</span><span id="3f95" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="a810" class="mr lq in mn b gy mw mt l mu mv">});</span><span id="9e4e" class="mr lq in mn b gy mw mt l mu mv">module.exports = mongoose.model("user", User);</span></pre><p id="face" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mx">å¦‚æœæ‚¨æƒ³è¦è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯:</em></p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="e53b" class="mr lq in mn b gy ms mt l mu mv">....<br/>required: [true, "phone number is required"]<br/>....</span></pre><p id="a9d6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="mx">æ³¨æ„</em> </strong> <em class="mx"> : uniqueä¸æ˜¯éªŒè¯å™¨</em></p><h1 id="1e0c" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated"><strong class="ak">æ·»åŠ éªŒè¯</strong></h1><p id="7edf" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">Mongooseä½¿ç”¨ä¸€ä¸ªå†…ç½®çš„éªŒè¯å‡½æ•°æ¥éªŒè¯æ¨¡å¼ï¼Œå¹¶è¿”å›ä¸€æ¡å®šåˆ¶æ¶ˆæ¯ã€‚</p><p id="33ba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">(ps:éªŒè¯æ¥è§¦é•¿åº¦)</p><p id="20e1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">"è¾“å…¥çš„è¾“å…¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ¶ˆæ¯"</p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="5165" class="mr lq in mn b gy ms mt l mu mv">phone: {</span><span id="b744" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="1eb4" class="mr lq in mn b gy mw mt l mu mv">required: [true, "Phone number is required !"],</span><span id="2f49" class="mr lq in mn b gy mw mt l mu mv">validate: {</span><span id="4a2a" class="mr lq in mn b gy mw mt l mu mv">validator: (v) =&gt; {</span><span id="30de" class="mr lq in mn b gy mw mt l mu mv">return v.length == 10;</span><span id="f3f8" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="7e74" class="mr lq in mn b gy mw mt l mu mv">message: (props) =&gt; props.value + " Must be 10 digits !",</span><span id="2c9e" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="4437" class="mr lq in mn b gy mw mt l mu mv">},</span></pre><p id="f893" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼:</strong></p><pre class="kd ke kf kg gt mm mn mo mp aw mq bi"><span id="0d81" class="mr lq in mn b gy ms mt l mu mv">email: {</span><span id="1069" class="mr lq in mn b gy mw mt l mu mv">type: String,</span><span id="e5cf" class="mr lq in mn b gy mw mt l mu mv">required: [true, "email is required !!"],</span><span id="25ac" class="mr lq in mn b gy mw mt l mu mv">unique: true,</span><span id="9fe9" class="mr lq in mn b gy mw mt l mu mv">validate: {</span><span id="e311" class="mr lq in mn b gy mw mt l mu mv">validator: (email) =&gt; {</span><span id="94a1" class="mr lq in mn b gy mw mt l mu mv">const pattern = /^[A-Z0-9._%+-]+@([A-Z0-9-]+\.)+[A-Z]{2,4}$/i;</span><span id="1d85" class="mr lq in mn b gy mw mt l mu mv">return pattern.test(email);</span><span id="5816" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="7c6d" class="mr lq in mn b gy mw mt l mu mv">message: (props) =&gt; `${props.value} is not in correct format !!`,</span><span id="f905" class="mr lq in mn b gy mw mt l mu mv">},</span><span id="c455" class="mr lq in mn b gy mw mt l mu mv">},</span></pre><blockquote class="my mz na"><p id="7e83" class="kt ku mx kv b kw kx jo ky kz la jr lb nb ld le lf nc lh li lj nd ll lm ln lo ig bi translated">ç°åœ¨ï¼Œåœ¨åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·æ—¶ï¼Œä½ ä¸å¿…æ‹…å¿ƒéªŒè¯ï¼Œmongooseä¼šç›¸åº”åœ°å¤„ç†å’ŒæŠ›å‡ºéªŒè¯ï¼ï¼</p></blockquote><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/444da0c8268135fd714c2d98d3274d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VHaSO_RCAHAbMHOuwnD1NA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Postman screenshot</figcaption></figure><p id="8152" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">åŒæ ·ï¼Œå½“ä½¿ç”¨ä¸æ­£ç¡®çš„ç”µå­é‚®ä»¶æ—¶:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/103ac3ded461630a67328426c60961ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*377vMxoCljo1S6Y4ma1A9w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Postman Screenshot</figcaption></figure><p id="2722" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ç§å•Šã€‚å†è§ï¼Œä¹”ä¼Šã€‚</p><h1 id="dbf1" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">ä¸‹ä¸€æ­¥:ä½¿ç”¨çŒ«é¼¬é’©</h1><p id="8880" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">ä¸»è¦æœ‰ä¸¤ç§è¢«å¹¿æ³›ä½¿ç”¨çš„çŒ«é¼¬é’©:</p><ul class=""><li id="132b" class="nf ng in kv b kw kx kz la lc nh lg ni lk nj lo nk nl nm nn bi translated"><em class="mx">ã€preã€‘</em>:åœ¨ä¿å­˜æ¨¡å‹ä¹‹å‰åšä¸€äº›äº‹æƒ…ã€‚</li><li id="be49" class="nf ng in kv b kw no kz np lc nq lg nr lk ns lo nk nl nm nn bi translated"><em class="mx">â€œpostâ€</em>:ä¿å­˜æ¨¡å‹ååšä¸€äº›äº‹æƒ…ã€‚</li></ul><p id="988c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">ä½¿ç”¨é’©å­/ä¸­é—´ä»¶:</strong></p><p id="32c8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¦‚æœæˆ‘ä»¬åœ¨pre hookä¸­æ§åˆ¶å°è®°å½•è¿™ä¸ªï¼Œæˆ‘ä»¬å¾—åˆ°req.bodyæˆ–ç”¨æˆ·è¾“å…¥çš„å†…å®¹ã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nt"><img src="../Images/d3d9dea03fac8e78e5f2f7ece2a9044f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z3YxRpwOFwf5Ee5TMwgoKw.png"/></div></div></figure><p id="70b2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">åœ¨ä½¿ç”¨<a class="ae ks" href="https://www.npmjs.com/package/bcryptjs" rel="noopener ugc nofollow" target="_blank"> bcryptåº“</a>å°†å¯†ç ä¿å­˜åˆ°æ•°æ®åº“ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¯¹å¯†ç è¿›è¡Œå“ˆå¸Œè¿ç®—ã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nu"><img src="../Images/91e0d001cf6f6435a6a4070e71da7384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UxQDyFZKFLqsR5esBaVZcw.png"/></div></div></figure><p id="5ec8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ç”±äº<em class="mx"> pre </em>æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå®ƒä»¥nextä½œä¸ºå‚æ•°ï¼Œä¹Ÿå¯ä»¥è¿”å›æ‰¿è¯ºï¼ŒæˆåŠŸå®Œæˆåï¼Œå®ƒè°ƒç”¨next()ä¸­é—´ä»¶ã€‚</p><h2 id="b40f" class="mr lq in bd lr nv nw dn lv nx ny dp lz lc nz oa mb lg ob oc md lk od oe mf of bi translated">è®©æˆ‘ä»¬çœ‹çœ‹è¿™æ˜¯å¦æœ‰æ•ˆâ€¦</h2><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/5d6f9ce771c76ce6957ccaae8fb23657.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nIzFg6Mp_b-bhPNYFhla4A.png"/></div></div></figure><p id="b51e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mx">ç°åœ¨æˆ‘ä»¬çš„å¯†ç æ˜¯hashï¼Œæˆ‘ä»¬æ²¡æœ‰å¯¹æ§åˆ¶å™¨åšä»»ä½•æ›´æ”¹ã€‚</em></p><p id="3cad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ç±»ä¼¼åœ°ï¼Œpost hookåœ¨ä¿å­˜æ¨¡å‹åå·¥ä½œã€‚</p><p id="1ab0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ä¸­é—´ä»¶å¯ä»¥æ¥å—çš„äº‹ä»¶:</p><ul class=""><li id="33dd" class="nf ng in kv b kw kx kz la lc nh lg ni lk nj lo nk nl nm nn bi translated">"ä¿å­˜"</li><li id="bda1" class="nf ng in kv b kw no kz np lc nq lg nr lk ns lo nk nl nm nn bi translated">"ç§»é™¤"</li><li id="ddcc" class="nf ng in kv b kw no kz np lc nq lg nr lk ns lo nk nl nm nn bi translated">"éªŒè¯"</li></ul><p id="51d9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è¿˜æœ‰<a class="ae ks" href="https://mongoosejs.com/docs/validation.html" rel="noopener ugc nofollow" target="_blank">æ›´æœ‰</a>ã€‚</p><p id="4526" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mx">æœ€ç»ˆæºä»£ç :</em> <a class="ae ks" href="https://github.com/anandpd/mongoose-validation-medium" rel="noopener ugc nofollow" target="_blank"> <em class="mx">é“¾æ¥</em> </a></p><p id="bb5b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¦‚æœä½ å·²ç»åˆ°è¾¾è¿™é‡Œï¼Œæ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘å¸Œæœ›å®ƒæ¸…æ¥šçš„ä½¿ç”¨mongooseéªŒè¯å’Œä¸­é—´ä»¶/é’©å­ã€‚å¦‚æœä½ å–œæ¬¢ï¼Œåˆ«å¿˜äº†ç•™ä¸‹æŒå£°ã€‚</p><p id="d175" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è°¢è°¢å¤§å®¶ï¼</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oh"><img src="../Images/f3202fbfef8ebae26a9accccb442316a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zNo4Rh2rjnrYYdow"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kelly Sikkema</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>