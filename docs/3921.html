<html>
<head>
<title>Real-time, Bidirectional &amp; Event-based Communication in Node.js using Socket.IO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Socket在Node.js中进行实时、双向和基于事件的通信。超正析象管(Image Orthicon)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/real-time-bidirectional-event-based-communication-in-node-js-using-socket-io-edbc79b0ad25?source=collection_archive---------6-----------------------#2021-08-06">https://javascript.plainenglish.io/real-time-bidirectional-event-based-communication-in-node-js-using-socket-io-edbc79b0ad25?source=collection_archive---------6-----------------------#2021-08-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f6e2ef21b9c5c8fbd57d4adcd6400979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-AaJ56HVWvcGt4ov"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@afgprogrammer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mohammad Rahmani</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f468" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">插座。IO是一个库，支持服务器和客户端之间的实时、双向和基于事件的通信。这个库提供了一个Node.js服务器和一个客户机实现，我们可以用它来构建我们的系统。除了节点服务器，还有其他服务器实现，包括Java和Python。还有许多客户机实现可以与套接字服务器通信。这使您能够用不同的技术构建客户端和服务器端。您可以在这里找到从<a class="ae kc" href="https://socket.io/docs/v4" rel="noopener ugc nofollow" target="_blank">到</a>的实现列表。</p><h1 id="e6dc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">插座是如何？IO工作？</h1><p id="adbe" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要正确理解，您可能需要了解两个基本主题——web socket、单向和双向通信等。让我们逐一介绍。</p><h1 id="5926" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">WebSocket</h1><p id="c72b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">WebSocket只不过是一个计算机通信协议。它通过单个TCP提供全双工通信信道。WebSocket不同于HTTP，尽管这两种协议都位于OSI模型的第7层，并且依赖于TCP。WebSocket以较低的开销实现了web服务器和web客户端之间的交互。它从第一次建立连接时就保持连接打开，并允许web服务器向客户机发送内容，而无需客户机首先请求。所以使用WebSocket的全双工通信特性来了。web服务器和web客户端都使用该连接以全双工方式进行实时数据传输。有一些半双工替代方案可以实现这一功能，但WebSocket以更标准的方式提供这一功能，并且开销最小。</p><h1 id="4ef0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">单向和双向通信</h1><p id="82bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">单向意味着数据只在一个方向上流动，而双向意味着数据在两个方向上流动。HTTP是单向的，客户端发送请求，服务器做出相应的响应。我们可以将RESTful服务视为依赖于HTTP协议的单向通信。当客户机向服务器发送请求时，服务器以HTTP格式接收请求，并向客户机发送响应。发送响应后，连接关闭。每次客户端发送HTTP请求时，都会建立一个新的连接，在得到响应后，连接就会终止。因此，这个过程是单向的，并且这个连接通道不能被服务器或客户机用于以后的通信。另一方面，WebSocket协议是双向的。它是一种全双工协议，用于相同的客户端-服务器通信场景。它是一个有状态的协议，客户端和服务器之间的连接被维护以备将来使用。例如，假设客户机-服务器进行了握手并创建了一个连接。该连接将由协议保持活动状态，直到被任何一方(服务器和客户端)终止。这个信道可以用于双方的通信。客户端可以向服务器发送一些内容，服务器也可以向客户端发送内容。消息交换将以双向模式进行。</p><h1 id="234e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用Socket.io和Express的基本应用程序</h1><p id="5355" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Socket.io能够单独处理设置了可能情况的服务器，但是通常使用带有socket.io的Express framework来呈现一些HTTP请求。几乎在每一个应用中，我们都可能需要这两个方面。例如，我们的套接字可能需要一个管理仪表板。IO应用。任何HTTP框架都需要Express。虽然可以用Socket来开发这种东西。IO，在这些情况下使用HTTP框架也更常见。你可以从<a class="ae kc" href="https://socket.io/get-started/basic-crud-application/" rel="noopener ugc nofollow" target="_blank">这里</a>看到一个用Socket.io开发的纯CRUD应用，但是在这篇文章里，我会用Socket解释一个项目。木卫一和快递一起。它可能会给你一个实际应用的想法。</p><h1 id="c9e3" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建项目和安装依赖项</h1><p id="9f9d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们需要创建一个普通节点项目，并安装<strong class="kf ir"> express </strong>和<strong class="kf ir"> socket.io </strong>库。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c8c4" class="mn lc iq mj b gy mo mp l mq mr">npm init --yes<br/>npm i express socket.io</span></pre><h1 id="d950" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建express服务器并集成Socket。超正析象管(Image Orthicon)</h1><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="985e" class="mn lc iq mj b gy mo mp l mq mr">const http = require('http');<br/>const express = require('express');<br/>const app = express();<br/>const server = http.createServer(app);<br/>const { Server } = require('socket.io');<br/>const io = new Server(server);</span><span id="2946" class="mn lc iq mj b gy ms mp l mq mr">server.listen(3000, () =&gt; {<br/>    console.log('listening on *:3000');<br/>});</span></pre><h1 id="cddd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提供HTML</h1><p id="31bb" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">插座。IO由两部分组成，一部分是服务器，另一部分是加载到浏览器上的客户端库。要在浏览器上加载客户端库，我们需要执行以下操作，</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8c2b" class="mn lc iq mj b gy mo mp l mq mr">&lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br/>&lt;script&gt;<br/>    var socket = io();<br/>&lt;/script&gt;</span></pre><p id="0768" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是加载<a class="ae kc" href="https://github.com/socketio/socket.io-client" rel="noopener ugc nofollow" target="_blank">套接字所需的全部内容。io-client </a>，公开一个<strong class="kf ir"> io </strong>全局，然后连接。让我们创建一个包含表单和列表的完整HTML文件。这个HTML文件将被提供给浏览器或客户端，它们将使用它与服务器进行通信。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2e3d" class="mn lc iq mj b gy mo mp l mq mr">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>    &lt;meta charset="UTF-8"&gt;<br/>    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;<br/>    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>    &lt;title&gt;Document&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    &lt;ul id="notices"&gt;&lt;/ul&gt;<br/>    &lt;form id="form" action=""&gt;<br/>        &lt;input id="input" autocomplete="off" /&gt;&lt;button&gt;Send&lt;/button&gt;<br/>    &lt;/form&gt;</span><span id="a3eb" class="mn lc iq mj b gy ms mp l mq mr">    &lt;script src="/socket.io/socket.io.js"&gt;&lt;/script&gt;<br/>    &lt;script&gt;<br/>      var socket = io();</span><span id="34b6" class="mn lc iq mj b gy ms mp l mq mr">      var messages = document.getElementById('notices');<br/>      var form = document.getElementById('form');<br/>      var input = document.getElementById('input');</span><span id="4adb" class="mn lc iq mj b gy ms mp l mq mr">      form.addEventListener('submit', function(e) {<br/>        e.preventDefault();<br/>        if (input.value) {<br/>          socket.emit('new-notice', input.value);<br/>          input.value = '';<br/>        }<br/>      });</span><span id="4f55" class="mn lc iq mj b gy ms mp l mq mr">      socket.on('add-to-board', function(msg) {<br/>        var item = document.createElement('li');<br/>        item.textContent = msg;<br/>        messages.appendChild(item);<br/>        window.scrollTo(0, document.body.scrollHeight);<br/>      });<br/>    &lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="d67c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，我们没有指定要连接的后端服务器主机，因为默认情况下，它会尝试连接到为页面提供服务的主机。我们还可以在io()函数中指定服务器地址。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="6141" class="mn lc iq mj b gy mo mp l mq mr">var socket = io();</span></pre><p id="fe65" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意index.html文件的两个部分，<strong class="kf ir"> socket.emit() </strong>和<strong class="kf ir"> socket.on() </strong>。这两个方法用于发送带有数据的命名事件和从服务器监听命名事件。</p><p id="4434" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们更新index.js文件，以便为index.html页面提供服务，并在以后从浏览器接受事件。</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a09c" class="mn lc iq mj b gy mo mp l mq mr">const http = require('http');<br/>const express = require('express');<br/>const app = express();<br/>const server = http.createServer(app);<br/>const { Server } = require('socket.io');<br/>const io = new Server(server);</span><span id="f7eb" class="mn lc iq mj b gy ms mp l mq mr">// serving the html page to browser<br/>app.get('/', (req, res) =&gt; {<br/>    res.sendFile(__dirname + '/index.html');<br/>})</span><span id="9c0e" class="mn lc iq mj b gy ms mp l mq mr">// listen for event's form client<br/>io.on('connection', (socket) =&gt; {<br/>    // listen specific named event<br/>    socket.on('new-notice', (data) =&gt; {<br/>        io.emit('add-to-board', data);<br/>    });<br/>});</span><span id="bc08" class="mn lc iq mj b gy ms mp l mq mr">server.listen(3000, () =&gt; {<br/>    console.log('listening on *:3000');<br/>});</span></pre><h1 id="629f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">运行服务器</h1><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="f977" class="mn lc iq mj b gy mo mp l mq mr">node index.js</span></pre><p id="402b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将运行服务器。这个服务器可以拥有Restful方法以及Web套接字连接。您可以根据需要添加任何命名的事件或API端点。您还可以使用集群来提高性能。</p><p id="a48c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mt">更多内容请看</em><a class="ae kc" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mt">plain English . io</em></strong></a></p></div></div>    
</body>
</html>