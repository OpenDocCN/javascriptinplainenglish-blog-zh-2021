<html>
<head>
<title>How to Share States Between React Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React组件之间共享状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-share-states-between-react-components-5817a8d7f68b?source=collection_archive---------9-----------------------#2021-06-30">https://javascript.plainenglish.io/how-to-share-states-between-react-components-5817a8d7f68b?source=collection_archive---------9-----------------------#2021-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/85f2502005bbb3c33863488ae4943627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ugUK1l7bjzg9rQQE"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@ecasap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Elaine Casap</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="838e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在组件之间共享状态是我们在React中要做的很多事情。</p><p id="1b8f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究在React中组件之间共享状态的方法。</p><h1 id="4f8f" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">提升状态</h1><p id="b712" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">如果两个子组件有相同的父组件，那么我们可以将想要共享的状态从子组件添加到父组件中。</p><p id="f46f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="7665" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from "react";</span><span id="e87c" class="mn lc iq mj b gy ms mp l mq mr">const DescendantA = ({ count, onCountChange }) =&gt; {<br/>  return (<br/>    &lt;button onClick={() =&gt; onCountChange((count) =&gt; count + 1)}&gt;<br/>      Click me {count}<br/>    &lt;/button&gt;<br/>  );<br/>};</span><span id="abfd" class="mn lc iq mj b gy ms mp l mq mr">const DescendantB = ({ count, onCountChange }) =&gt; {<br/>  return (<br/>    &lt;button onClick={() =&gt; onCountChange((count) =&gt; count + 1)}&gt;<br/>      Click me {count}<br/>    &lt;/button&gt;<br/>  );<br/>};</span><span id="46d6" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const [count, setCount] = useState(0);<br/>  return (<br/>    &lt;&gt;<br/>      &lt;DescendantA count={count} onCountChange={setCount} /&gt;<br/>      &lt;DescendantB count={count} onCountChange={setCount} /&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span></pre><p id="3d1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>组件，它们都有<code class="fe mt mu mv mj b">App</code>作为它们的共同祖先。</p><p id="a932" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以为了共享一个状态，我们把状态放在<code class="fe mt mu mv mj b">App</code>中。</p><p id="873c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有在<code class="fe mt mu mv mj b">App</code>中定义的<code class="fe mt mu mv mj b">count</code>状态。</p><p id="417d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">count</code>传递给<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>组件。</p><p id="03e0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们将<code class="fe mt mu mv mj b">onCountChange</code>传递给<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>。</p><p id="3497" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>中，我们调用<code class="fe mt mu mv mj b">onCountChange</code>并显示<code class="fe mt mu mv mj b">count</code>值。</p><h1 id="b867" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">上下文API</h1><p id="b87b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在两个组件之间共享状态的另一种方式是使用上下文API。</p><p id="d348" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上下文API允许我们在上下文提供者中的任何组件之间共享状态。</p><p id="4d92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="c875" class="mn lc iq mj b gy mo mp l mq mr">import React, { useContext, useState } from "react";</span><span id="b0d0" class="mn lc iq mj b gy ms mp l mq mr">const CountContext = React.createContext("count");</span><span id="e15c" class="mn lc iq mj b gy ms mp l mq mr">const DescendantA = () =&gt; {<br/>  const { count, setCount } = useContext(CountContext);</span><span id="3b70" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;button onClick={() =&gt; setCount((c) =&gt; c + 1)}&gt;Click me {count}&lt;/button&gt;<br/>  );<br/>};</span><span id="2aa8" class="mn lc iq mj b gy ms mp l mq mr">const DescendantB = () =&gt; {<br/>  const { count, setCount } = useContext(CountContext);</span><span id="dd75" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;button onClick={() =&gt; setCount((c) =&gt; c + 1)}&gt;Click me {count}&lt;/button&gt;<br/>  );<br/>};</span><span id="a05c" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  const [count, setCount] = useState(0);</span><span id="8dfa" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;CountContext.Provider value={{ count, setCount }}&gt;<br/>      &lt;DescendantA /&gt;<br/>      &lt;DescendantB /&gt;<br/>    &lt;/CountContext.Provider&gt;<br/>  );<br/>}</span></pre><p id="8ef4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe mt mu mv mj b">React.createContext</code>来创建上下文。</p><p id="d384" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们定义<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>，后者调用<code class="fe mt mu mv mj b">useContext</code>来获取上下文。</p><p id="cb40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">CountContext.Provider</code>的<code class="fe mt mu mv mj b">value</code>道具就是<code class="fe mt mu mv mj b">useContext</code>返回的东西。</p><p id="cce2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我们可以从返回值中得到<code class="fe mt mu mv mj b">count</code>和<code class="fe mt mu mv mj b">setCount</code> getter和setter。</p><p id="e90c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且在每个组件中，我们都有设置<code class="fe mt mu mv mj b">count</code>的按钮。</p><p id="1138" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">App</code>中，我们将<code class="fe mt mu mv mj b">CountContext.Provider</code>包装在<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>中，这样我们就可以在两个组件中使用上下文。</p><h1 id="15a7" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">状态管理解决方案</h1><p id="3928" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">在多个组件之间共享数据的另一种方式是使用状态管理解决方案。</p><p id="47f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">React应用程序的一个流行的状态管理解决方案是Redux和React-Redux。</p><p id="bab1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要使用它，我们可以写:</p><p id="8b4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">index.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="edd2" class="mn lc iq mj b gy mo mp l mq mr">import { StrictMode } from "react";<br/>import ReactDOM from "react-dom";<br/>import { createStore } from "redux";<br/>import { Provider } from "react-redux";<br/>import App from "./App";</span><span id="14a4" class="mn lc iq mj b gy ms mp l mq mr">const rootReducer = (state = 0, action) =&gt; {<br/>  switch (action.type) {<br/>    case "INCREMENT":<br/>      return state + 1;<br/>    default:<br/>      return state;<br/>  }<br/>};</span><span id="f1ec" class="mn lc iq mj b gy ms mp l mq mr">const store = createStore(rootReducer);</span><span id="3680" class="mn lc iq mj b gy ms mp l mq mr">const rootElement = document.getElementById("root");<br/>ReactDOM.render(<br/>  &lt;StrictMode&gt;<br/>    &lt;Provider store={store}&gt;<br/>      &lt;App /&gt;<br/>    &lt;/Provider&gt;<br/>  &lt;/StrictMode&gt;,<br/>  rootElement<br/>);</span></pre><p id="ea2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">App.js</code></p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="8e03" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { useDispatch, useSelector } from "react-redux";</span><span id="fca4" class="mn lc iq mj b gy ms mp l mq mr">const DescendantA = () =&gt; {<br/>  const dispatch = useDispatch();<br/>  const count = useSelector((state) =&gt; state);</span><span id="6a67" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;button onClick={() =&gt; dispatch({ type: "INCREMENT" })}&gt;<br/>      Click me {count}<br/>    &lt;/button&gt;<br/>  );<br/>};</span><span id="7930" class="mn lc iq mj b gy ms mp l mq mr">const DescendantB = () =&gt; {<br/>  const dispatch = useDispatch();<br/>  const count = useSelector((state) =&gt; state);</span><span id="0f27" class="mn lc iq mj b gy ms mp l mq mr">  return (<br/>    &lt;button onClick={() =&gt; dispatch({ type: "INCREMENT" })}&gt;<br/>      Click me {count}<br/>    &lt;/button&gt;<br/>  );<br/>};</span><span id="2e56" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;&gt;<br/>      &lt;DescendantA /&gt;<br/>      &lt;DescendantB /&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span></pre><p id="c559" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">index.js</code>中，我们有<code class="fe mt mu mv mj b">rootReducer</code>,它接受<code class="fe mt mu mv mj b">state</code>值并基于我们分派的动作类型返回商店的最新值。</p><p id="5da4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">rootReducer</code>传递给<code class="fe mt mu mv mj b">createStore</code>来创建一个Redux商店。</p><p id="e3e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们将<code class="fe mt mu mv mj b">store</code>传递给React-Redux <code class="fe mt mu mv mj b">Provider</code>组件，让我们使用<code class="fe mt mu mv mj b">Provider</code>中任何组件的存储。</p><p id="bfc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">App.js</code>中，我们有<code class="fe mt mu mv mj b">DescendantA</code>和<code class="fe mt mu mv mj b">DescendantB</code>，它们调用<code class="fe mt mu mv mj b">useDispatch</code>钩子来获得<code class="fe mt mu mv mj b">dispatch</code>函数。</p><p id="c3ea" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">dispatch</code>让我们向商店发送一个动作。</p><p id="a086" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，我们用回调来调用<code class="fe mt mu mv mj b">useSelector</code>钩子，以返回回调中的值，也就是<code class="fe mt mu mv mj b">rootReducer</code>的最新返回值。</p><p id="6939" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们点击按钮时，我们调用<code class="fe mt mu mv mj b">dispatch</code>并将<code class="fe mt mu mv mj b">type</code>设置为<code class="fe mt mu mv mj b">'INCREMENT'</code>以提交类型为<code class="fe mt mu mv mj b">'INCREMENT'</code>的动作。</p><p id="8a98" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们应该看到<code class="fe mt mu mv mj b">count</code>更新了。</p><h1 id="cf27" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="249e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有几种方法可以让我们在组件之间共享状态。</p><p id="4fb5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容尽在</em> <a class="ae kc" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir"> <em class="mw">说白了</em> </strong> </a></p></div></div>    
</body>
</html>