<html>
<head>
<title>Endpoint Handlers 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">端点处理器101</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/endpoint-handlers-101-c9aad2e62ebb?source=collection_archive---------14-----------------------#2021-12-03">https://javascript.plainenglish.io/endpoint-handlers-101-c9aad2e62ebb?source=collection_archive---------14-----------------------#2021-12-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d25f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">👋嘿，伙计们！</p><p id="0333" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天，我们将讨论端点处理程序！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/de1e51c2f964e8b9e98c950c4489b308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*gwKHS1XJesj83VegCwReqA.jpeg"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">Built using Draw.io by https://twitter.com/imabptweets</figcaption></figure><p id="0e20" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如上图所示，端点处理程序是一种对所有进入服务器的请求进行观察和验证的工具。它对任何端点的每个传入请求运行重要的安全验证。</p><p id="fe17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切顺利，服务器将处理请求，否则，将根据验证结果向客户端抛出400/403禁止错误。</p><p id="b40c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ku"> PS:任何以4XX开头的错误都与客户端有关。</em></p><h2 id="ae45" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated"><strong class="ak">构建您的端点处理程序类型脚本。</strong></h2><p id="1210" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">这是我最喜欢的部分。我们将看到如何实现端点处理程序。</p><p id="bfda" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，让我们创建一个端点。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="cfc9" class="kv kw in lu b gy ly lz l ma mb">const getCatImages = async(req, res)=&gt;{<br/>    if(req.method!=='GET') return res.status(400).end();<br/>    return res.status(200).json({url: "s3.images.blah/cat1.jpg"})<br/>}</span><span id="0840" class="kv kw in lu b gy mc lz l ma mb">export default getCatImages</span></pre><p id="ae44" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经创建了一个端点，几乎可以完成获取猫图像的工作。</p><p id="ee65" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们有以下限制。</p><p id="c720" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">1.只有爱猫人士才应该得到猫的图像。<br/> 2。只有经过身份验证的用户才能获得图像。<br/> 3。任何被禁止获取猫图像的用户都应该收到禁止请求。</p><p id="21b3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们可以构建端点了，包括这些限制。但是，如果我们有100个端点呢？当需要更新限制时，我们可能需要更新所有这100个端点。</p><p id="112c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">接下来是端点处理程序的角色。<br/>所以让我们构建一个端点处理器，它<strong class="jm io">返回一个“函数返回承诺”</strong>。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="5b70" class="kv kw in lu b gy ly lz l ma mb">const EndpointHandler = async(endpoint, validations)=&gt;{<br/>    return async(req,res) =&gt;{<br/>     <br/><strong class="lu io">     //Only Authenticated Users<br/></strong>     if(validations.onlyAuthenticated){<br/>     const response = await checkAuth(req)<br/>     if(response.status !== 200)<br/>     return res.status(403).json({message: 'Unauthenticated User"})<br/>    }</span><span id="84cf" class="kv kw in lu b gy mc lz l ma mb"><br/><strong class="lu io">     //Cat Lovers Only Allowed<br/></strong>     if(validations.onlyCatLovers)<br/>     {<br/>      const response = await CheckCatLovers(req.cookies)<br/>      if(response.status !== 200)<br/>      return res.status(403).json({message:"You are not a cat lover"})</span><span id="1f03" class="kv kw in lu b gy mc lz l ma mb">     }</span><span id="d288" class="kv kw in lu b gy mc lz l ma mb"><strong class="lu io">     // Banned Users Check<br/></strong>     if(validations.bannedUsersNotAllowed){<br/>         const response = await checkUserisBanned(req.cookies);<br/>         if(response.status !== 200)<br/>         return res.status(403).json({message:"You have been banned. Contact Group Admin"});<br/>}</span><span id="7b2a" class="kv kw in lu b gy mc lz l ma mb">    }<br/>}<br/>export default EndpointHandler</span></pre><p id="f974" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以现在，我们的端点检查所需的验证。</p><p id="7444" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们必须将这个端点处理程序包装到我们的端点。</p><p id="db88" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们回到第一段代码。</p><pre class="kj kk kl km gt lt lu lv lw aw lx bi"><span id="20cb" class="kv kw in lu b gy ly lz l ma mb">import EndpointHandler from './EndpointHandler';</span><span id="611f" class="kv kw in lu b gy mc lz l ma mb">const getCatImages = async(req, res)=&gt;{<br/>    if(req.method!=='GET') return res.status(400).end();<br/>    return res.status(200).json({url: "s3.images.blah/cat1.jpg"})<br/>}</span><span id="62c7" class="kv kw in lu b gy mc lz l ma mb">export default EndpointHandler(getCatImages,<br/>{<br/>onlyAuthenticated:true,<br/>onlyCatLovers:true,<br/>bannedUsersNotAllowed:true<br/>});</span></pre><p id="f975" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是我们如何成功地将端点处理程序与端点集成在一起的。这种方法有助于我们编写更好、更安全的代码，只需一个验证文件源。</p><h2 id="4100" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated"><strong class="ak">好处</strong></h2><p id="2cc1" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">您可以将更多的精力放在编写业务逻辑上，并将处理程序包装在内部，而不用担心端点的安全。</p><p id="1bb1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你有一个可维护的和容易调试的代码库。</p><p id="0ca1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你知道一个可以在任何地方应用的最佳实践</p><h2 id="2a95" class="kv kw in bd kx ky kz dn la lb lc dp ld jv le lf lg jz lh li lj kd lk ll lm ln bi translated"><strong class="ak">缺点</strong></h2><p id="92f7" class="pw-post-body-paragraph jk jl in jm b jn lo jp jq jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh ig bi translated">不是这样的，但是它更适合具有一致端点的服务。具有不同操作的系统可能需要不同的端点处理程序。</p><p id="9599" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是所有的乡亲。</p><p id="2c32" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ku">如果你学到了什么，一定要在推特上分享:</em><a class="ae md" href="https://twitter.com/imabptweets" rel="noopener ugc nofollow" target="_blank"><em class="ku">https://twitter.com/imabptweets</em></a></p><p id="27df" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我很想试试。</p><p id="e912" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="ku">更多内容请看</em> <a class="ae md" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ku">说白了就是</em> </strong> </a> <strong class="jm io"> <em class="ku">。</em> </strong> <em class="ku">报名参加我们的</em> <a class="ae md" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="ku">免费每周简讯这里</em> </strong> </a> <strong class="jm io"> <em class="ku">。</em> </strong></p></div></div>    
</body>
</html>