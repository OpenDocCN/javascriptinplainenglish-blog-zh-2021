<html>
<head>
<title>Where Should You Store JSON Web Tokens (JWT)?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">应该在哪里存储JSON Web令牌(JWT)？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/where-to-store-the-json-web-token-jwt-4f76abcd4577?source=collection_archive---------0-----------------------#2021-07-06">https://javascript.plainenglish.io/where-to-store-the-json-web-token-jwt-4f76abcd4577?source=collection_archive---------0-----------------------#2021-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/30c3d0f5679a34b15dcddc6a90150066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0upFgLD4cIJ2XewRi9a_5g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Where to Store JWT</figcaption></figure><p id="2363" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我设计和开发web应用程序已经超过7年了。</p><p id="82d0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这些年来，我见过很多认证机制，有些是RESTful的，有些不是。RESTful服务大多使用JSON Web令牌(JWT)作为认证令牌。</p><p id="0db4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">每当我实现基于JWT的身份验证时，我都会问自己这个问题，“<strong class="kb io">我们在哪里存储JWT？”</strong></p><p id="c61c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">编辑:本文只关注浏览器的实现。</p><p id="d83b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">让我们来回答这个大问题。</p><p id="a809" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们有三种在客户端存储数据的选择，每一种都有自己的优缺点。选项包括:</p><ol class=""><li id="5430" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">饼干</li><li id="bf32" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">本地存储</li><li id="6c2d" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">会话存储</li></ol><h2 id="485c" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated"><strong class="ak">饼干</strong></h2><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/9b9b3561fdf1dec7d4a25f30a7f3d7f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*1iAVWbhDS6gbRS8pBoqA3A.png"/></div></figure><p id="1c08" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您在cookie上设置了JWT，浏览器将自动发送令牌以及相同站点请求的URL。但是它容易受到CSRF的<a class="ae mk" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="noopener ugc nofollow" target="_blank"/>攻击。</p><p id="5999" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们可以通过设置一个带有<code class="fe ml mm mn mo b">SameSite=strict</code>的cookie来保护站点免受<code class="fe ml mm mn mo b">CSRF</code>的攻击</p><p id="b135" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="kx">编辑1:</em>i̶n̶̶g̶e̶n̶e̶r̶a̶l̶̶p̶e̶o̶p̶l̶e̶̶m̶i̶g̶h̶t̶̶t̶h̶i̶n̶k̶,̶̶x̶s̶s̶̶c̶a̶n̶̶b̶e̶̶d̶e̶f̶e̶a̶t̶e̶d̶̶i̶f̶̶w̶e̶̶s̶e̶t̶̶t̶h̶e̶̶h̶t̶t̶p̶o̶n̶l̶y̶̶f̶l̶a̶g̶,̶̶b̶u̶t̶̶i̶t̶̶i̶s̶̶p̶o̶s̶s̶i̶b̶l̶e̶̶t̶o̶̶a̶t̶t̶a̶c̶k̶̶b̶y̶̶u̶s̶i̶n̶g̶̶x̶s̶t̶̶"̶s̶u̶b̶s̶e̶t̶"̶̶(̶k̶i̶n̶d̶a̶)̶̶o̶f̶̶x̶s̶s̶.̶</p><p id="de05" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="kx">编辑2: </em>通过设置<code class="fe ml mm mn mo b">httpOnly</code>旗，我们可以轻松叛变XSS。</p><p id="c952" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">优点:</strong></p><ol class=""><li id="54d6" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">浏览器将自动向服务器发送令牌。</li><li id="9b8c" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">相同的令牌可用于应用程序实例的多个选项卡。</li></ol><p id="2283" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">反对:</strong></p><ol class=""><li id="6d4d" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">易受XSS攻击。</li><li id="9015" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">如果您使用像<a class="ae mk" href="https://datatracker.ietf.org/doc/html/rfc6750" rel="noopener ugc nofollow" target="_blank"> OAuth 2.0 </a>这样的协议，您需要在报头中附加令牌。</li></ol><p id="8000" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">本地存储</strong></p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/1a77232240ac6479b2543d6fa0f592d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*2la8DIrVgaX40uudxIWUQA.png"/></div></figure><p id="266f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">localStorage不会自动随URL一起发送数据。因此，您需要为每个URL实现auth令牌系统。但最棒的是，这种方法不会受到CSRF的攻击。</p><p id="e927" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">优点</strong></p><ol class=""><li id="0662" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">不容易受到CSRF的攻击。</li><li id="edff" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">相同的令牌可用于应用程序实例的多个选项卡。</li></ol><p id="4a35" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> Con </strong></p><ol class=""><li id="fc25" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">易受XSS攻击。</li><li id="1555" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">您需要为发送令牌实现一种机制。</li></ol><p id="53c6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">会话存储</strong></p><figure class="mg mh mi mj gt jo gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/69dfd653322d5ca31918521381c30109.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*FhxeiWnOsFxjg7pfFSQ-Mg.png"/></div></figure><p id="92b4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">会话存储与本地存储非常相似，只是令牌只能访问一个选项卡，一旦选项卡关闭，会话就会被销毁。所以它<strong class="kb io">对【T4记得我】这样的功能</strong>没用。但这可用于多重登录功能，如选项卡A处于不同的登录状态，而选项卡B处于不同的登录状态。</p><p id="1221" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">优点:</strong></p><ol class=""><li id="4ae7" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">不容易受到CSRF的攻击。</li><li id="e69b" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">易于在一个浏览器中实现多次登录。</li></ol><p id="db7d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">不利:</strong></p><ol class=""><li id="c11c" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated">易受XSS攻击。</li><li id="bce6" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated">一旦选项卡关闭，会话数据就会被销毁。</li></ol><p id="98ca" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">您可能会注意到，所有3种方法都有相同的缺点—“<strong class="kb io">易受XSS攻击”。</strong>是的，所有这些方法都容易受到XSS的攻击。请务必关心XSS，并始终遵循保护XSS的<a class="ae mk" href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" rel="noopener ugc nofollow" target="_blank">最佳实践</a>。</p><h2 id="aebe" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated"><strong class="ak">结论</strong></h2><p id="e43b" class="pw-post-body-paragraph jz ka in kb b kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks mt ku kv kw ig bi translated">默认情况下，localStorage和SessionStorage都不受XSS保护。</p><p id="e914" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然而，Cookie提供了一系列安全选项，如<code class="fe ml mm mn mo b">SameSite</code>、<code class="fe ml mm mn mo b">HttpOnly</code>等。所以搭配曲奇就好了。</p><p id="8fd6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="kx">“用一些安全标志将你的JWT存储在Cookie中。”</em>T19】</strong></p></div><div class="ab cl mu mv hr mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="ig ih ii ij ik"><h2 id="e6cc" class="lm ln in bd lo lp lq dn lr ls lt dp lu kk lv lw lx ko ly lz ma ks mb mc md me bi translated">旁注:</h2><p id="0478" class="pw-post-body-paragraph jz ka in kb b kc mp ke kf kg mq ki kj kk mr km kn ko ms kq kr ks mt ku kv kw ig bi translated">如果你使用Express，<a class="ae mk" href="https://medium.com/hackernoon/express-js-important-npm-packages-related-to-security-2393466e18d5" rel="noopener">这些包</a>可能有助于提高你的应用程序安全性。</p><p id="f068" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">另外，看看我最近的文章</p><ol class=""><li id="92cb" class="ky kz in kb b kc kd kg kh kk la ko lb ks lc kw ld le lf lg bi translated"><a class="ae mk" rel="noopener ugc nofollow" target="_blank" href="/deep-dive-into-tree-shaking-ba2e648b8dcb">深入了解摇树</a>(如何减少你的包裹大小)</li><li id="a9b8" class="ky kz in kb b kc lh kg li kk lj ko lk ks ll kw ld le lf lg bi translated"><a class="ae mk" rel="noopener ugc nofollow" target="_blank" href="/5-useeffect-infinite-loop-patterns-2dc9d45a253f"> 5使用效果无限循环模式</a></li></ol><p id="ca49" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我发现这些文章对我有用，也许这些对你也有用。</p><div class="nb nc gp gr nd ne"><a href="https://scotch.io/bar-talk/why-jwts-suck-as-session-tokens" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd io gy z fp nj fr fs nk fu fw im bi translated">为什么jwt不适合作为会话令牌</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">JSON Web令牌(jwt)现在非常热门。它们在web开发中风靡一时:有了这些神奇的东西…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">scotch.io</p></div></div><div class="nn l"><div class="no l np nq nr nn ns jt ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://auth0.com/docs/security/data-security/token-storage#don-t-store-tokens-in-local-storage" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd io gy z fp nj fr fs nk fu fw im bi translated">令牌存储</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">保护进行API调用的spa伴随着他们自己的一系列问题。你需要确保代币和其他…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">auth0.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns jt ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a href="https://stackoverflow.com/questions/44133536/is-it-safe-to-store-a-jwt-in-localstorage-with-reactjs" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd io gy z fp nj fr fs nk fu fw im bi translated">将JWT储存在带有ReactJS的本地仓库中安全吗？</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">在大多数现代的单页面应用程序中，我们确实必须将令牌存储在客户端的某个地方(大多数…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">stackoverflow.com</p></div></div><div class="nn l"><div class="nu l np nq nr nn ns jt ne"/></div></div></a></div><p id="3217" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="kx">更多内容请看</em><a class="ae mk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="kx">plain English . io</em></strong></a></p></div></div>    
</body>
</html>