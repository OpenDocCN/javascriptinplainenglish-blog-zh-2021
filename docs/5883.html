<html>
<head>
<title>Handling API with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cypress处理API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/handling-api-with-cypress-911d4cc012a2?source=collection_archive---------13-----------------------#2021-12-16">https://javascript.plainenglish.io/handling-api-with-cypress-911d4cc012a2?source=collection_archive---------13-----------------------#2021-12-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/4bb2b60f74566a23c4d0b0941a01eae6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11IzUEjYA7LoPFhrClFg7w.png"/></div></div></figure><p id="f3e6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">自从自动化被引入以来，每个采用它的组织的质量保证部门都获得了许多好处。由于自动化的各种优势，软件测试已经走过了漫长的道路，例如节省时间、早期的错误捕获等。随着时间的推移，各种测试框架已经被引入不同的平台。其中一个就是Cypress，它用于web应用程序测试用例的自动化。</p><p id="ac5d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Cypress帮助QA工程师以更快、更可靠的方式编写测试用例，并且它的设置也非常简单快捷。凭借其用户友好的框架，Cypress在许多方面使自动化变得更加容易，并且在开始编写测试之前几乎不需要配置。几乎所有传统框架要求用户自己编写的任务都有一个插件。</p><p id="35d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Cypress主要关注Web应用程序的自动化，但也支持在需要时处理API命令。由于我们不能用Cypress直接自动化移动应用程序，当我们需要用后端API代替移动命令时，这就派上了用场。</p><p id="7426" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">本文档将简要概述如何使用Cypress处理项目的API。作为先决条件，您必须熟悉Cypress框架的结构以及如何设置它。</p><h2 id="83c0" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">入门</strong></h2><p id="9c71" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">将API引入Cypress测试非常简单。</p><p id="ae93" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于HTTP请求，使用函数<strong class="jx io"> cy.request() </strong>。这可以在spec文件的<strong class="jx io"> it() </strong>函数下调用，或者在<strong class="jx io"> commands.js </strong>中调用，以便有更多的可重用性。</p><p id="81cb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个函数需要的参数是method和url，这两个参数是强制的；和主体，它们是附加的。</p><p id="e873" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">语法:</p><blockquote class="lr"><p id="8389" class="ls lt in bd lu lv lw lx ly lz ma ks dk translated">cy.request(方法，url)</p></blockquote><p id="26d2" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks ig bi translated">例如，我们将使用来自https://reqres.in/的免费测试API</p><p id="445a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面的例子展示了如何在Cypress测试中调用一个简单的get API。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/6058830b1fa4e76dae580559d921a4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F19T-ITNHKsSlRZJ"/></div></div></figure><p id="d3f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行上述测试将显示成功，如下所示:</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/586f9038e941fab5d5a1be20d3f8a58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jXpI8HCH6tQTI_vo"/></div></div></figure><h2 id="57e4" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">查看响应</strong></h2><p id="030f" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">然而，上面的例子仅仅显示了API已经被执行。我们看不到结果。为了看到这一点，我们使用如下所示的<strong class="jx io"> should() </strong>函数:</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/def2d2d80046413fed5f5dc98686fa46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ySJt-Ex5itnwx5eN"/></div></div></figure><p id="1917" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里，我们只是显示响应体，并使用Stringify将返回的对象转换成string。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/533ae9156bf134ec4f01845b85ba77c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jfhQL4cmuIIWes3r"/></div></div></figure><h2 id="5cce" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">添加断言</strong></h2><p id="fb86" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">在许多情况下，您需要操作结果或断言任何值或状态代码。为此，我们使用expect()函数。</p><p id="3591" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">API最基本的断言是状态代码。这可以用下面的方法来完成。</p><p id="f5f3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">语法:</p><blockquote class="lr"><p id="a0af" class="ls lt in bd lu lv lw lx ly lz ma ks dk translated">expect(response . status). to . eq(200)</p></blockquote><p id="0100" class="pw-post-body-paragraph jv jw in jx b jy mb ka kb kc mc ke kf kg md ki kj kk me km kn ko mf kq kr ks ig bi translated">这里，我们断言状态代码应该等于200。</p><p id="960a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">除了状态代码之外，您可以断言在您的响应中发现的任何数据，例如测试中的API正在返回用户列表，我们可以根据测试的需要以多种方式验证该数据。</p><p id="26e2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，您可以断言响应存在、响应中某个字段的值等。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/75647af81a30ed7c33242ac091598e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YYEMbtAL1BpoNpVp"/></div></div></figure><p id="dc51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，您还可以将响应中的值存储在环境变量中，以便在其他测试中使用。为此，将增加以下步骤:</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/67d3ea9e2d1c67869fafc389041708d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s0ZNQEwhJnnWN6fT"/></div></div></figure><p id="34c6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您执行上述代码时，结果将显示如下。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/3cacc5cd7df173e64d8ac12bb905a7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wbzx-J403GhbAgWK"/></div></div></figure><h2 id="9651" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">提高可重用性</h2><p id="f0db" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">祝贺您学习如何在Cypress中使用API！</p><p id="3dbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在假设你需要在几次测试中多次调用这个API。复制和粘贴相同的代码行被认为不是一个好的做法。相反，更明智的做法是将它存储在一个文件中，这样您可以方便地修改它，并在需要时调用它。</p><p id="993c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这样做的一种方法是使用commands.js文件。</p><p id="1cca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只需复制请求并将其粘贴到commands.js文件中，然后用以下内容包装它:</p><p id="b747" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">语法:</p><blockquote class="lr"><p id="daa5" class="ls lt in bd lu lv lw lx ly lz ma ks dk translated">柏树。Commands.add('APITest '，()=&gt; { })</p></blockquote><figure class="mt mu mv mw mx jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/f53b40b31885a27ec55850971afd21df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0utmVLxHVtYTjl6Z"/></div></div></figure><p id="b8c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，这些步骤可以在任何测试中以下面的方式调用，不需要重新编写相同的代码。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi my"><img src="../Images/64961b8673e7f58460aa36f8c0995e01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/0*391ahWMeffw-O-48"/></div></figure><h2 id="5760" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">链接API请求</h2><p id="c2d2" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">假设您需要一步一步地调用API，并且需要一个API在进入下一个API之前完成执行。这可以通过使用then()函数来实现。它允许您在回调函数中使用生成的主题。</p><p id="6c32" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了在我们的测试中引入它，我们将进行以下更改，并添加带有一些断言的第二个API。</p><p id="ebad" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设测试要求您更新第一个用户。为此，您将首先获取第一个用户的id，并将其与第二个API的URL一起使用，以便更新所述用户。这里，我们还添加了body。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/50e0782afde5bcd3d4806f14581d4d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wfOs8dkdBG-O2UlG"/></div></div></figure><p id="1107" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">执行此操作将产生以下结果。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/b37321241e8713e7f5f7ee95d84f9784.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DMESYqi03iuCO23U"/></div></div></figure><h2 id="3fb7" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">进一步的改进</h2><p id="37ac" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">通过本文，您将学会如何处理API，如何修改它们以便在多个测试中使用它们，以及如何链接请求以便进行额外的操作。</p><p id="8836" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您还可以将基本URL存储在cypress.json文件下的“base URL”中。</p><p id="e8af" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">还有很多方法可以改进你的工作，使之更有活力。比方说，您需要在特定请求中每次发送不同的值，或者您需要从fixtures调用大量数据。您不能为不同的数据多次创建相同的请求；相反，您应该修改一个请求来处理多个值。</p><p id="62cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，您需要更新职务字段。要解决这个问题，您可以使用以下更改。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/e6670ea32cf4cac2ba997089bcac6b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*raE9AvlGp5TfABhH"/></div></div></figure><p id="ec6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，您还需要将作业作为参数添加到规范文件中。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d77a134af3ae46b389f93e9306bae3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*gROoin2Qf50Z04aV"/></div></figure><p id="b9dc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后执行您的测试。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/e569301c999fd76072ec22f8b831762f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T47ORyHFLpnjYpgk"/></div></div></figure><h2 id="ca0e" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">Cypress应该用于API测试吗？</h2><p id="590a" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">Cypress提供了许多好处，另外还支持在必要的地方使用API。从根本上说，使用它进行UI自动化测试更有意义，但是在UI测试过程中，在必要的地方执行API调用以使它们更快也是有用的。</p><h2 id="0821" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">更多内容请访问<a class="ae mg" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> PlainEnglish.io </a>。</h2><p id="3aa9" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated"><em class="ne">报名参加我们的</em> <a class="ae mg" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="ne">免费周报</em> </strong> </a> <em class="ne">。关注我们关于</em><a class="ae mg" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ne">Twitter</em></strong></a>，<a class="ae mg" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ne">LinkedIn</em></strong></a><strong class="jx io"><em class="ne">，</em></strong><a class="ae mg" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><em class="ne">YouTube</em><strong class="jx io"><em class="ne">，以及</em></strong><em class="ne"/></a><a class="ae mg" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ne">不和</em> </strong> </a>T49】</p><h2 id="a759" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">希望扩大你的科技创业公司的知名度和采用率吗？检查<a class="ae mg" href="https://circuit.ooo/?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank">电路</a>。</h2></div></div>    
</body>
</html>