<html>
<head>
<title>RazorPay integration with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RazorPay与Node.js的集成</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/razorpay-integration-with-node-js-4915d03ad8ce?source=collection_archive---------0-----------------------#2021-04-11">https://javascript.plainenglish.io/razorpay-integration-with-node-js-4915d03ad8ce?source=collection_archive---------0-----------------------#2021-04-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="41d8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Razorpay是印度一个流行的支付网关，用于电子商务网站或任何付费服务。只需几个步骤，您就可以开始使用这项服务向客户收款。</p><p id="646d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">今天的帖子将涉及Razorpay上的帐户创建&amp;与node.js应用程序的集成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7a937dfa6bbb84be27ee6faed346f6ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qub9gZ-03713UWE5.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Razorpay payment flow</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ky"><img src="../Images/0152abdf2b5c9a3fd39b758cce7b7e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*K5KVP37xOkBMelPsOwIVvw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Order creation to Payment received via webhook flow</figcaption></figure><h2 id="6e46" class="kz la in bd lb lc ld dn le lf lg dp lh jv li lj lk jz ll lm ln kd lo lp lq lr bi translated">第一步。RazorPay帐户设置</h2><p id="eecd" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">前往<a class="ae lx" href="https://dashboard.razorpay.com/signup" rel="noopener ugc nofollow" target="_blank">https://dashboard.razorpay.com/signup</a>并输入您的电子邮件地址&amp;必要信息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/20f93eafc620219eade00c93e6bb1760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CouCOP3Vjh-c2PKvtdWzMA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Dashboard of RazorPay</figcaption></figure><p id="b07c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">默认情况下，它会为您创建一个测试环境，让您尝试所有选项。您可以在“我的帐户-&gt;个人资料-&gt; T2帐户激活”部分填写KYC表格来激活您的帐户。</p><p id="f631" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在转到“设置-&gt; API密钥”来为节点连接生成API密钥。下载密钥并将其存储在安全的地方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/d27e087a2530aa6e82caca8ca5c62c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HZ3AfD16fYtOcqbe8CjiAg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">API key generation</figcaption></figure><h2 id="e6c0" class="kz la in bd lb lc ld dn le lf lg dp lh jv li lj lk jz ll lm ln kd lo lp lq lr bi translated"><strong class="ak">第二步。Node.js设置</strong></h2><p id="378a" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">使用npm安装Razorpay包。</p><pre class="kj kk kl km gt lz ma mb mc aw md bi"><span id="fc00" class="kz la in ma b gy me mf l mg mh">npm i --save razorpay</span></pre><p id="2dfe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在让我们创建index.js文件，并用我们作为API密钥下载的key_id &amp; key_secret实例化Razorpay实例。</p><pre class="kj kk kl km gt lz ma mb mc aw md bi"><span id="85f3" class="kz la in ma b gy me mf l mg mh">const rzp = new Razorpay({<br/> key_id: "YOUR_KEY_ID",<br/> key_secret: "YOUR_KEY_SECRET",<br/>})</span></pre><p id="6882" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">创建订单，并将订单id发回以便结账。</p><pre class="kj kk kl km gt lz ma mb mc aw md bi"><span id="b86d" class="kz la in ma b gy me mf l mg mh">const rzpOrder = await rzp.orders.create({<br/> amount: amount * 100, // rzp format with paise<br/> currency: 'INR',<br/> receipt: "receipt#1" //Receipt no that corresponds to this Order,<br/> payment_capture: true,<br/> notes: {<br/>  orderType: "Pre"<br/> } //Key-value pair used to store additional information<br/>})</span><span id="a561" class="kz la in ma b gy mi mf l mg mh">// To create recurring subscription<br/>const subscriptionObject = {<br/> plan_id: PLAN_ID,<br/> total_count: 60,<br/> quantity: 1,<br/> customer_notify: 1,<br/> notes,<br/>}</span><span id="4f42" class="kz la in ma b gy mi mf l mg mh">const subscription = await rzp.subscriptions.create(subscriptionObject)</span></pre><p id="634c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">传递订单Id以生成结帐对象</p><pre class="kj kk kl km gt lz ma mb mc aw md bi"><span id="5cd2" class="kz la in ma b gy me mf l mg mh">&lt;button id=”rzp-button1"&gt;Pay&lt;/button&gt;<br/>&lt;script src=”https://checkout.razorpay.com/v1/checkout.js"&gt;&lt;/script&gt; &lt;script&gt; <br/> var options = <br/>  {<br/>   “key”: “YOUR_KEY_ID”, // Enter the Key ID generated from the Dashboard <br/>   "name": "Test Company", <br/>   "order_id": "rzpOrder.id", // For one time payment<br/>   "subscription_id" : "subscription.id" // For recurring subscription<br/>   "prefill": {<br/>     "name": "Test User",<br/>     "email": "test.user@example.com",<br/>     "contact": "9999999999"<br/>   },<br/>   "theme": {<br/>    "color": "#3399cc"<br/>   },<br/>   // This handler function will handle the success payment<br/>   "handler": function (response) {<br/>    alert(response.razorpay_payment_id);<br/>    alert("Payment Successfull")<br/>   },<br/>};</span><span id="dd55" class="kz la in ma b gy mi mf l mg mh">var rzp1 = new Razorpay(options);</span><span id="ebe9" class="kz la in ma b gy mi mf l mg mh">document.getElementById('rzp-button1').onclick = function (e) {<br/>  rzp1.open();<br/>  e.preventDefault();<br/>}<br/>rzp1.on('payment.failed', function (response)<br/> {            <br/>  alert(response.error.code);     <br/>  alert(response.error.description);      <br/>  alert(response.error.source);<br/>  alert(response.error.step);     <br/>  alert(response.error.reason);<br/>  alert(response.error.metadata.order_id);<br/>  alert(response.error.metadata.payment_id);<br/> }</span><span id="483b" class="kz la in ma b gy mi mf l mg mh">&lt;/script</span></pre><p id="2c1b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切正确，用户将被重定向到Razorpay结账页面。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/20b6765d7fe04c6abf6a61a27e1a9dfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*z31dwd3v6VmJuVG6DkZpEQ.png"/></div></figure><p id="cace" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以自动获取付款，也可以使用获取方法。Webhooks允许您从Razorpay服务器获得响应。</p><p id="6759" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以从Razorpay webhook订阅某个事件，并将数据存储在您的DB中。</p><p id="21a3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您可以在仪表板上分别为实时模式和测试模式设置webhooks。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ly"><img src="../Images/eb6cf7561465a570425f2b84cbbe28fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RogOfHqv-_SSyaJM3Ljj7A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Webhook setup</figcaption></figure><p id="36c7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在你要验证Razorpay发的webhook事件的真实性。</p><pre class="kj kk kl km gt lz ma mb mc aw md bi"><span id="5d15" class="kz la in ma b gy me mf l mg mh">const requestedBody = JSON.stringify(req.body)</span><span id="dbf8" class="kz la in ma b gy mi mf l mg mh">const receivedSignature = req.headers['x-razorpay-signature']</span><span id="d8cb" class="kz la in ma b gy mi mf l mg mh">const expectedSignature = crypto.createHmac('sha256', RAZORPAY_WEBHOOK_SECRET).update(requestedBody).digest('hex')</span><span id="0248" class="kz la in ma b gy mi mf l mg mh">if (receivedSignature === expectedSignature) { <br/>  // Store in your DB<br/>} else {<br/> res.status(501).send('received but unverified resp')<br/>}</span></pre><h2 id="bbed" class="kz la in bd lb lc ld dn le lf lg dp lh jv li lj lk jz ll lm ln kd lo lp lq lr bi translated">结论</h2><p id="40f6" class="pw-post-body-paragraph jk jl in jm b jn ls jp jq jr lt jt ju jv lu jx jy jz lv kb kc kd lw kf kg kh ig bi translated">仅此而已。您已经准备好开始您的在线支付业务。欲了解更多信息，请访问RazorPay集成的官方文档。</p><p id="282b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io"> <em class="mk">感谢阅读。最初发布于2021年4月12日</em></strong><a class="ae lx" href="https://noob2geek.in/2021/04/12/razorpay-integration-with-node-js/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mk">https://noob 2 geek . I</em></strong></a><strong class="jm io"><em class="mk">n。</em> </strong></p><p id="a01d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mk">更多内容请看</em><a class="ae lx" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>