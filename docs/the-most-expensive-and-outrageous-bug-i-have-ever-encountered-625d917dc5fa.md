# 我遇到过的最贵最离谱的 Bug

> 原文：<https://javascript.plainenglish.io/the-most-expensive-and-outrageous-bug-i-have-ever-encountered-625d917dc5fa?source=collection_archive---------2----------------------->

## 我们必须承担成本。

![](img/c88b51149ac0353dfcf48989646a3cfb.png)

Photo by [Christin Hume](https://unsplash.com/@christinhumephoto?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

在我的职业生涯中，我遇到过的最荒谬、最具创伤性的错误之一是微软 SQL Server 中的一个已知但未记录在案的错误。因为那件事我损失惨重。

故事如下:一家大型啤酒厂的客户想要开发一个管理其经销商(批发商)的系统。这个想法是要有一个完整的系统来处理从销售到饮料配送的路线。

一组配备掌上电脑的销售人员每天拜访客户，接受订单，完成交易，并在一天结束时返回总部并下载订单。这些订单会在一夜之间得到处理并开出账单，在第二天的早上/上午，会开具带有送货路线的发票。

根据客户的要求，数据库应该是微软的 MS SQL Server。但是，考虑到数据量，最推荐的做法是将数据库放在运行 Oracle 的 Unix/Linux 机器上。是年纪大了，好吗？没有像我们今天这样的移动互联网，那是另一个时代。

一大群卖家回来了。它卸载了 4000 到 5000 份订单，其中有 20 到 30 件商品(我记得目录中的一件商品是“马拉松西瓜”，几乎什么也没卖出去)。

一个晴朗的夜晚，我接到技术支持的电话，升级了一个严重的故障情况。整个系统已经离线，客户无法处理订单。

我们到了客户端的网站(当时还没有云计算，那是上个世纪)，直接分析应用和数据库服务器。应用程序服务器正常。数据库服务器处于昏迷状态。它既不前进也不后退。

当控制台发出命令时，他根本不理会。因此，没有客户端能够连接到数据库。不是直接的，不是愤怒的祈祷。没有办法。数据库服务器处于昏迷状态。

有人建议使用 TMSP(微软故障排除技术)，包括重新启动 Windows NT(当时没有 Windows 服务器，我在说，已经很久了，至少计算机不是阀门)。

*   我们重启数据库服务器。没有任何东西
*   我们重启整个服务器。没有任何东西
*   数据库根本没有恢复联机。

我们恢复了一个备份，怀疑银行文件已经损坏。但是 SQL Server 没有离线实用工具来检查文件完整性。他甚至做到了，但他必须上电视。现在吗？但是怎么做呢？我们开始服务的时候他还在昏迷中！

我的一个同事想到了一个绝妙的主意。数据库服务器必须进行回滚，所以它看起来像是处于昏迷状态。我们打赌。

由于服务器出现故障，TMSP 试图恢复广播。这发生在服务器有机会完成回滚之前。当我们重新启动银行时，服务器正在回滚，你知道吗？

我决定按照这位同事(他是 DBA)的建议去做。于是我们让服务器安静下来，大概过了 3、4 个小时，控制台反应一般，数据完好，一切都很漂亮，我们就同意了。

这个错误是 SQL Server 的一个限制。数据库中的大量插入同时发生(几十个供应商同时到达)导致了一些 RAM 资源或类似资源的耗尽。SQL Server 只是拆分事务并回滚。

这家客户酿酒厂是微软在全球最重要的客户之一。她有一个专属的客户/产品经理。当我们激活 MS 的本地支持时，他不得不爬上公司总部，然后爬上 MS 本身，事情逐步升级，直到到达雷德蒙，会见 MS 的那个从 SQL Server 学到最多东西的人。

他分析了情况，从那里，从那里，检查了场景，并对我们说，“这是 SQL Server 的一个未记录的错误，”并展示了一份来自 MS 的内部机密报告，告诉我们大约八个月前发现的这个问题。我们松了口气，问修正什么时候出来。MS 只是说它不会修复这个问题，SQL server 下一个版本会修复它(详细说明，SQL Server 是一个全新的产品，完全重写并适合)，我们必须重写应用程序。

此外，针对客户端的数据量扩展服务器是不够的，MS professional 为我们指定了兼容的服务器硬件。

结果，不幸的是，这家啤酒厂的客户拒绝支付对软件进行必要修改的费用，我们不得不承担这笔费用。

*更多内容看* [***说白了. io***](http://plainenglish.io/) ***。*** *报名参加我们的* [***免费每周简讯点击这里***](http://newsletter.plainenglish.io/) ***。***