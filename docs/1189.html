<html>
<head>
<title>Create a Rest API with Express, PostgreSQL, TypeOrm, and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express、PostgreSQL、TypeOrm和TypeScript创建Rest API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-rest-api-with-express-postgresql-typeorm-and-typescript-ac42a20b66c7?source=collection_archive---------0-----------------------#2021-03-13">https://javascript.plainenglish.io/create-a-rest-api-with-express-postgresql-typeorm-and-typescript-ac42a20b66c7?source=collection_archive---------0-----------------------#2021-03-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="bf4e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用Express framework、PostgreSQL和用TypeScript编码创建一个简单的Rest API</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi kc"><img src="../Images/85feec7b82933d7f791840c3c8721959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*xaVOIVhbI8ol8PK1vy1yrg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Create a Rest API with Express, PostgreSQL, TypeOrm, and TypeScript.</figcaption></figure><h1 id="b400" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">先决条件</h1><p id="52f5" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">请确保您的操作系统和<a class="ae mc" href="https://www.docker.com/get-started" rel="noopener ugc nofollow" target="_blank"> docker </a>上安装了<a class="ae mc" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a> ( &gt; = 10.13.0)。</p><h1 id="6dd2" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">初始化项目</h1><p id="1814" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们需要创建我们的项目，首先创建博客目录。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="e0b7" class="mi kp in me b gy mj mk l ml mm">mkdir blog</span></pre><p id="0b8b" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">稍后，转到博客目录并初始化项目。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="43da" class="mi kp in me b gy mj mk l ml mm">cd blog</span><span id="6924" class="mi kp in me b gy ms mk l ml mm">npm init</span></pre><p id="f414" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">最后一个命令将创建一个<strong class="li io"> package.json </strong>文件，其目的是处理我们项目中安装的所有依赖项的历史。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/3a1df1638ff84cea6d992ef4434069ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*vsjO6BQm9aSdiot1_YPgQA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">package.json</figcaption></figure><h1 id="7a87" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">安装依赖项</h1><p id="f7e5" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">对于我们的API Rest，我们需要下一个依赖项，express，pg，TypeOrm，typescript。</p><p id="17fa" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">安装依赖项开发依赖项。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="b401" class="mi kp in me b gy mj mk l ml mm">npm install typescript @types/express @types/node --save-dev</span></pre><p id="000f" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">我们将只使用最后的依赖来开发我们的API。</p><p id="1e17" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在，安装我们将在生产环境中使用的依赖项。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="2ea5" class="mi kp in me b gy mj mk l ml mm">npm install express pg typeorm</span></pre><p id="3c70" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><a class="ae mc" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> express </strong> </a>:这是一个NodeJS的web应用框架。</p><p id="f271" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><a class="ae mc" href="https://www.npmjs.com/package/pg" rel="noopener ugc nofollow" target="_blank"><strong class="li io">pg</strong></a>:<strong class="li io"/>它是NodeJS模块的集合，用于与您的PostgreSQL数据库接口。</p><p id="0fdd" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><a class="ae mc" href="https://www.npmjs.com/package/typescript" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> Typescript </strong> </a>:这是一种面向应用级JavaScript的语言，这个模块帮助我们为JavaScript添加可选类型，支持面向任何浏览器的大型JavaScript应用的工具。</p><p id="e9ff" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><a class="ae mc" href="https://www.npmjs.com/package/typeorm" rel="noopener ugc nofollow" target="_blank"> <strong class="li io"> typeorm </strong> </a>:这是一个运行在Node JS中的orm，可以使用TypeScript和JavaScript (ES5，ES6，ES7，ES8)。</p><p id="201c" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">这些包帮助我们定义express和NodeJS的类型。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/ab8897b795e2f2d37fbb447393369a2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*HIfxDAszTOA1Ot-y4AUe1Q.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">packahe.json file with our dependencies.</figcaption></figure><h1 id="756d" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">配置TypeScript</h1><p id="84d4" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">首先，我们需要在<strong class="li io"> package.json </strong>文件中添加一个命令来执行<strong class="li io"> typescript </strong>模块的命令。在脚本部分添加下一行。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="426a" class="mi kp in me b gy mj mk l ml mm">“tsc”: “tsc “</span></pre><p id="f8fd" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在，我们将在项目中配置TypeScript，执行以下命令:</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="bbcd" class="mi kp in me b gy mj mk l ml mm">npm run tsc -- --init</span></pre><p id="162b" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">最后一个命令生成<strong class="li io"> tsctsconfig.json </strong>，这个文件表明我们将要使用TypeScript。该文件包含TypeScript转换的工作设置。</p><p id="8c41" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">在该文件中，我们添加了下面几行，这些行帮助我们配置构建目录和根目录。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="0164" class="mi kp in me b gy mj mk l ml mm">“outDir”: “./build”, <br/>“rootDirs”: [“./src”],</span></pre><p id="bd03" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><strong class="li io"> rootDirs </strong>:此配置列表组合代表项目。</p><p id="0b61" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated"><strong class="li io"> outDir </strong>:这一行重定向编译文件的输出。</p><h1 id="f508" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">配置我们的服务器</h1><p id="1b13" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们将创建<strong class="li io"> src </strong>目录和<strong class="li io"> server.ts </strong>文件。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="d75d" class="mi kp in me b gy mj mk l ml mm">mkdir src<br/>cd src<br/>touch server.ts </span></pre><p id="8c93" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">一旦创建了我们的sever.ts文件，我们将创建一个名为Server的类以及构造函数、配置、路由和启动方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/049d9abed5413391822456b8ec3a2c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*58gI-JI-JO2c63L7sAq8Sg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Basic server configuration.</figcaption></figure><p id="a960" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">一旦创建了类和方法，执行下面的命令将我们的类型脚本代码转换成JavaScript。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="20f6" class="mi kp in me b gy mj mk l ml mm">npm run tsc</span></pre><p id="b980" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">记住<strong class="li io"> tsctsconfig.json </strong>配置，JavaScript文件将生成到构建目录中。</p><p id="2494" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在，用下一个命令启动服务器。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="9381" class="mi kp in me b gy mj mk l ml mm">node ./build/server.js</span></pre><p id="d6be" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">之后。尝试进入下一个链接<a class="ae mc" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>。</p><h2 id="8e23" class="mi kp in bd kq mw mx dn ku my mz dp ky lp na nb la lt nc nd lc lx ne nf le ng bi translated">创建控制器</h2><p id="50db" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在这个API示例中，我们将使用控制器来处理路由，我们需要创建控制器目录和post.controller.ts文件。</p><p id="f95c" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">在这个控制器中，我们将处理CRUD的方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/f9b5528d5571346e7c14f4f4484b76c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*vhCxLW1Hjff05M6QD8roZg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Example of controller file.</figcaption></figure><p id="5513" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在，在我们的类服务器中，我们需要导入控制器并配置新的路由。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/3207a476d2214f86a7191169b3f7c021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w_rV5aycQeoxrVJKBQP7BQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Server with the post controller configuration.</figcaption></figure><p id="a98d" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">接下来，执行下面的命令:</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="3123" class="mi kp in me b gy mj mk l ml mm">npm run tsc<br/>node ./build/server.js</span></pre><p id="2a17" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">并尝试访问post控制器的新路由。<a class="ae mc" href="http://localhost:3001/api/posts" rel="noopener ugc nofollow" target="_blank">http://localhost:3001/API/posts</a></p><p id="0f60" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">如果你想证明post控制器的所有方法，使用<a class="ae mc" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> postman </a>。</p><h2 id="426d" class="mi kp in bd kq mw mx dn ku my mz dp ky lp na nb la lt nc nd lc lx ne nf le ng bi translated">创建服务</h2><p id="d792" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在某些情况下，我们需要从不同的地方获取数据，因此数据库或另一个API，为此，我们需要在一个独占文件中处理这个操作。在本练习中，我们将使用服务来处理这些任务。</p><p id="ae27" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">创建名为services的新目录和文件post.service.ts。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/df474e98969bca4f4617112ce3ca5cc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*t7niz3HmkR1gOe3Um3fhWA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Example of post-service file.</figcaption></figure><p id="8177" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">将新服务导入控制器文件并执行每个方法。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/1843858fbfbf04c8ae986e42e22772bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*eu1n-8bCgls6XlM0cxNqVg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Now, in the controller, we execute the method from service.</figcaption></figure><p id="15e1" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在执行命令来解释我们的代码并启动服务器。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="a407" class="mi kp in me b gy mj mk l ml mm">npm run tsc<br/>node ./build/server.js</span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi no"><img src="../Images/bde1a810759a5b327fc3db16141911e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*4IBQqwtUxgu8SsrBjG1UYQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Now you get the message from the post-service.</figcaption></figure><p id="5479" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">在下一节中，我们将配置数据库并执行一些查询。</p><h1 id="ed2c" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">创建数据库</h1><p id="48d8" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在本练习中，我们将使用docker容器，您可以在<a class="ae mc" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">文档</a>中获得一些关于如何安装Docker的信息。</p><p id="c178" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">安装Docker后，运行下一个命令:</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="c00c" class="mi kp in me b gy mj mk l ml mm">docker run -d -p 5433:5432 — name blog -e POSTGRES_USER=blog -e POSTGRES_PASSWORD=blog — mount src=db-blog,dst=/var/lib/postgresql/data postgres</span></pre><p id="33bf" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">标志-d表示容器将在后台以分离模式执行。</p><p id="1648" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">标志-p 5433:5432指定容器将配置端口5432，我们可以从localhost用5444访问它。</p><p id="d9ec" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">— name <strong class="li io"> blog </strong>指定我们的容器的名称。</p><p id="904a" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">在-e POSTGRES_PASSWORD=password行中，我们指定了一个环境变量POSTGRES_PASSWORD。</p><p id="b7be" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">您可以使用<a class="ae mc" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank"> PgAdmin </a>来验证容器是否正确启动。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi np"><img src="../Images/1fb1316fe58103d9cd739160b6c6ca1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*-2CSBgkxK5KZH6XXfAjpKg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Start session in our database.</figcaption></figure><h1 id="f08c" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">配置数据库连接</h1><p id="71f6" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在本节中，我们将使用<a class="ae mc" href="https://typeorm.io/#/" rel="noopener ugc nofollow" target="_blank"> typeorm </a>来配置与API的数据库连接。</p><h2 id="d112" class="mi kp in bd kq mw mx dn ku my mz dp ky lp na nb la lt nc nd lc lx ne nf le ng bi translated">创建连接</h2><p id="01bd" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在服务器文件中，我们从TypeOrm导入createConnection函数，在本节中我们使用异步函数，所以如果你想了解更多关于这个主题的信息，请访问<a class="ae mc" href="https://developer.mozilla.org/es/docs/Web/JavaScript/Reference/Statements/async_function" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nq"><img src="../Images/4b54e9b27c7f5079eeda8d10d9da3c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4J8tg2wpl2d4CCKZqI4pFQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Database configuration.</figcaption></figure><p id="0404" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">最后一张图显示了如何创建一个新的连接，它需要数据库的类型，端口，主机，用户名，密码，数据库名称。方法<strong class="li io"> createConnection </strong>是从TypeOrm模块导入的。</p><p id="215b" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">我们的方法数据库配置将执行到routes方法中，并等待连接完成。在开始路由配置之前，连接是很重要的。</p><p id="3f8d" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">如果你想了解更多关于创建连接的不同方法，请访问typeorm的文档。</p><h2 id="21de" class="mi kp in bd kq mw mx dn ku my mz dp ky lp na nb la lt nc nd lc lx ne nf le ng bi translated">创建实体</h2><p id="b54a" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">好了，我们有了数据库连接，所以下一步是配置应用程序的实体。根据TypeOrm的文档，实体是一个映射到数据库表的类，您可以使用annotation @Entity()定义一个实体。</p><p id="9ad4" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">如果你记得，在数据库的配置中我们有这些行实体<strong class="li io">:[" build/database/entities/* */*。js"] </strong>，所以我们需要创建目录<strong class="li io"> src/database/entities </strong>，<strong class="li io"> </strong>，这个目录将包含我们的实体。</p><p id="c495" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">创建一个名为PostEntity的类，在这个类中，我们定义了我们的表格帖子。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/78701d1ce67241913b85b7d9403f8a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*IYyx_FtB4AapSYTyCIkt8Q.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Post entity example.</figcaption></figure><p id="63ff" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">@PrimaryGeneratedColumn()生成一个主列，其值将自动生成，而@Column()定义我们数据库中的一列。</p><h2 id="0421" class="mi kp in bd kq mw mx dn ku my mz dp ky lp na nb la lt nc nd lc lx ne nf le ng bi translated">创建自定义存储库</h2><p id="a88e" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们需要做的所有操作都将在存储库文件中完成，在该文件中，我们连接到一个特定的表并执行一些操作，如更新、创建、删除和其他DML操作。</p><p id="7eef" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">创建<strong class="li io"> src/repository </strong>目录和一个名为post.repository.ts的文件，并创建类PostRepository，如下所示。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/a241940aa087ac0c362f0acac1f274e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*bzRLHd_XKF-0rnw4ZMfvKQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Example of a repository with TypeOrm.</figcaption></figure><p id="0841" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">PostRepository类从Repository类扩展而来，这个类让我们可以处理我们的实体对象。查找实体、插入、更新、删除等，而@EntityRepository()用于将一个类声明为自定义存储库。</p><h1 id="5939" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">将服务与存储库集成</h1><p id="bffe" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">现在我们有了完成API所必需的一切，我们有了控制器、服务和存储库，在这一部分我们集成了所有的组件。</p><p id="71de" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">首先，我们将把PostRepository导入到类PostService中，并用TypeOrm模块中的一些命令初始化这个存储库。我们将使用的方法是getConnection()这个方法帮助我们获得一个特定的连接，例如，我们的连接被称为<strong class="li io"> blog </strong>和getCustomRepository()获得自定义存储库，例如<strong class="li io"> PostRepository </strong>，一旦初始化服务，我们就可以执行一些方法，例如，find()，这个方法将所有注册检索到表posts中。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/611b1fb56c7e5d7452a9405d1b82e359.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*8xcFtoqxtKrRNSxeSmtDCA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Implementation of PostRepository.</figcaption></figure><p id="a2db" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在翻译代码并启动服务器。</p><pre class="kd ke kf kg gt md me mf mg aw mh bi"><span id="90a1" class="mi kp in me b gy mj mk l ml mm">npm run tsc<br/>node ./build/server.js</span></pre><p id="0a60" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">在posts表中插入一些数据，就可以访问下一个URL<a class="ae mc" href="http://localhost:3001/api/posts" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/API/posts</a>并获取数据。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nt"><img src="../Images/047f788775394b53bf4089a6aab988f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qp9F2kzsLyN7H3R-BpowPg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Get data from database with our API.</figcaption></figure><p id="44aa" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在，我们实现了创建、更新和删除方法，这需要更新控制器和服务。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/93fa5cda80d99f4ab37f2e3585c5d04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*xH-8fhON-iybPGONaHzuPA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Post Controller.</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nv"><img src="../Images/fb4dae9a5bb0ba4ef8ab07d1e5b64bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*vx6ENC-lyugi7bDg14Z-7w.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Post-service.</figcaption></figure><p id="9214" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">现在你可以用Postman编译测试API的代码。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nw"><img src="../Images/90265738a6a3e4ded9ea361c584f4037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HmI1FIhCMI5zalasUnY4Yg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Get all posts.</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nw"><img src="../Images/db8b91f4d0c6f624ace64fbe6094b516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oxcOCo5V33nam_zfJDphIg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk">Creta a post.</figcaption></figure><p id="bdf2" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">至此，我们完成了练习，但是你可以在<a class="ae mc" href="https://github.com/bautistaj/expressApi" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上看到完整的代码。</p><h1 id="5f59" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">结论</h1><p id="66e1" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">让我们来看看我们学到了什么。</p><ul class=""><li id="7e67" class="nx ny in li b lj mn lm mo lp nz lt oa lx ob mb oc od oe of bi translated">如何用express创建单个Rest API？</li><li id="a32a" class="nx ny in li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated">typescript的配置。</li><li id="2c9e" class="nx ny in li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated">Typeform的配置。</li><li id="6965" class="nx ny in li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated">如何配置控制器、服务和存储库。</li><li id="bd95" class="nx ny in li b lj og lm oh lp oi lt oj lx ok mb oc od oe of bi translated">如何配置PostgreSQL Docker容器？</li></ul><p id="8c88" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">首先感谢阅读，希望这个小教程能帮到你。</p><p id="003d" class="pw-post-body-paragraph lg lh in li b lj mn jo ll lm mo jr lo lp mp lr ls lt mq lv lw lx mr lz ma mb ig bi translated">最亲切的问候。</p></div></div>    
</body>
</html>