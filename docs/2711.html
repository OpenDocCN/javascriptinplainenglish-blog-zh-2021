<html>
<head>
<title>How to Set up React with a Ruby on Rails Project Part 3 — CRUD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何设置Rails上的Ruby项目第3部分——CRUD</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-set-up-react-js-with-a-ruby-on-rails-project-part-3-crud-c2478414eba2?source=collection_archive---------22-----------------------#2021-06-03">https://javascript.plainenglish.io/how-to-set-up-react-js-with-a-ruby-on-rails-project-part-3-crud-c2478414eba2?source=collection_archive---------22-----------------------#2021-06-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/027b6234d18748604473049999dde17f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4T-uSk4PqnjrD1EXrdwqog.jpeg"/></div></div></figure><p id="e8c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">欢迎来到我的《对Rails上的Ruby作出反应》(对Rails作出反应？，RX3？罗，罗？).今天，我们将在应用程序中添加CRUD功能。我们已经在后端安装了它，现在我们只需要连接我们的前端。这应该相对容易。</p><p id="7333" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">下面是我们的API在“app/javascript/src/api/api.js”中的代码</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4d8a" class="lc ld in ky b gy le lf l lg lh">import axios from 'axios'</span><span id="b96d" class="lc ld in ky b gy li lf l lg lh">const ROOT_PATH = '/api/v1'<br/>const POSTS_PATH = `${ROOT_PATH}/posts`</span><span id="af95" class="lc ld in ky b gy li lf l lg lh">export const getPosts = () =&gt; {<br/>  return axios.get(POSTS_PATH)<br/>}</span><span id="1306" class="lc ld in ky b gy li lf l lg lh">export const getPost = (postId) =&gt; {<br/>  return axios.get(`${POSTS_PATH}/${postId}`)<br/>}</span><span id="d49a" class="lc ld in ky b gy li lf l lg lh">export const createPost = (postParams) =&gt; {<br/>  return axios.post(POSTS_PATH, postParams)<br/>}</span><span id="de12" class="lc ld in ky b gy li lf l lg lh">export const destroyPost = (postId) =&gt; {<br/>  return axios.delete(`${POSTS_PATH}/${postId}`)<br/>}</span><span id="2f96" class="lc ld in ky b gy li lf l lg lh">export const updatePost = (postId, postParams) =&gt; {<br/>  return axios.put(`${POSTS_PATH}/${postId}`, postParams)<br/>}</span></pre><p id="0d95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这些是我们将连接到数据库的CRUD函数。我认为这些很能说明问题。唯一值得注意的是，使用createPost()和updatePost()时，需要确保将参数作为第二个参数传入。</p><p id="e7c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们转到我们的类型文件，确保我们的动作创建者和减少者有正确的类型。这在“app/JavaScript/src/types/index . js”中。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="e3c0" class="lc ld in ky b gy le lf l lg lh">export const GET_POSTS = "GET_POSTS"<br/>export const GET_POST = "GET_POST"<br/>export const CREATE_POST = "CREATE_POST"<br/>export const DESTROY_POST = "DESTROY_POST"<br/>export const UPDATE_POST = "UPDATE_POST"</span></pre><p id="f52e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们只需要去我们的动作创建器，确保我们向rails后端发出请求，同时向我们的reducers发送动作类型。该文件为“app/JavaScript/src/actions/post . js”。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4819" class="lc ld in ky b gy le lf l lg lh">import * as api from '../api/api'<br/>import { GET_POST, GET_POSTS, CREATE_POST, UPDATE_POST, DESTROY_POST } from '../types/index'</span><span id="2f33" class="lc ld in ky b gy li lf l lg lh">export const getPosts = () =&gt; async (dispatch) =&gt; {<br/>  try { <br/>    const { data } = await api.getPosts()<br/>    dispatch({<br/>      type: GET_POSTS,<br/>      payload: data.data<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>}</span><span id="e46f" class="lc ld in ky b gy li lf l lg lh">export const getPost = (postId) =&gt; async (dispatch) =&gt; {<br/>  try {<br/>    const { data } = await api.getPost(postId)<br/>    dispatch({<br/>      type: GET_POST,<br/>      payload: data.data<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>}</span><span id="5695" class="lc ld in ky b gy li lf l lg lh">export const createPost = (postParams) =&gt; async (dispatch) =&gt; {<br/>  try {<br/>    const { data } = await api.createPost(postParams)<br/>    dispatch({<br/>      type: CREATE_POST,<br/>      payload: data.data<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>}</span><span id="00f1" class="lc ld in ky b gy li lf l lg lh">export const updatePost = (postId, postParams) =&gt; async (dispatch) =&gt; {<br/>  try {<br/>    const { data } = await api.updatePost(postId, postParams)<br/>    dispatch({<br/>      type: UPDATE_POST,<br/>      payload: data.data<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }</span><span id="86b0" class="lc ld in ky b gy li lf l lg lh">}</span><span id="726a" class="lc ld in ky b gy li lf l lg lh">export const destroyPost = (postId) =&gt; async (dispatch) =&gt; {<br/>  try {<br/>    const { data } = await api.destroyPost(postId)<br/>    dispatch({<br/>      type: DESTROY_POST,<br/>      payload: postId<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>}</span></pre><p id="2d50" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看其中一个函数，看看它到底在做什么。让我们看看createPost()函数。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d484" class="lc ld in ky b gy le lf l lg lh">export const createPost = (postParams) =&gt; async (dispatch) =&gt; {<br/>  try {<br/>    const { data } = await api.createPost(postParams)<br/>    dispatch({<br/>      type: CREATE_POST,<br/>      payload: data.data<br/>    })<br/>  } catch (error) {<br/>    console.log(error)<br/>  }<br/>}</span></pre><p id="ffc0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我们创建了一个名为createPost的函数，该函数接受postParams的参数。然后，我们声明这是一个异步函数，我们想使用redux-thunk。</p><p id="d6e1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我们开始尝试捕捉块。我们使用我们的API对后端进行调用，获取输出并将其放入const数据中。</p><p id="99c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们告诉所有的缩减器，我们正在创建CREATE_POST操作并传递数据，以便缩减器可以使用后端的数据来更新我们的redux存储。</p><p id="211b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们会记录任何错误。</p><p id="6d93" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们需要用减速器来处理这些动作。让我们从GET_POST操作类型开始。这设置了当前的帖子，所以我们需要为它创建一个减肥法。</p><p id="3402" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建文件“app/JavaScript/src/reduce/post . js”并将其放在那里。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="60da" class="lc ld in ky b gy le lf l lg lh">import { GET_POST } from '../types/index'</span><span id="83ac" class="lc ld in ky b gy li lf l lg lh">export default (post = null, action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POST:<br/>      return action.payload<br/>    default:<br/>      return post<br/>  }<br/>}</span></pre><p id="f7cf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将初始帖子设置为空，然后我们告诉这个减压器，每当它看到GET_POST动作时，获取该有效负载，并将其分配给redux存储上的帖子密钥。请确保将此reducer添加到您的“app/JavaScript/src/reduce/index . js”文件中。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="0426" class="lc ld in ky b gy le lf l lg lh">import { combineReducers } from 'redux'<br/>import posts from './posts'<br/>import post from './post'</span><span id="99ad" class="lc ld in ky b gy li lf l lg lh">export default combineReducers({<br/>  posts,<br/>  post<br/>})</span></pre><p id="d1ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将制作一个帖子#show page，但在此之前，我们需要设置我们的路由器。在“app/JavaScript/src/components/app . js”中，我们需要导入我们将要制作的Page组件，然后告诉路由器在我们转到/post/id时呈现该组件。</p><p id="af17" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">添加代码后，您的App.js应该如下所示:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4681" class="lc ld in ky b gy le lf l lg lh">import React from 'react'<br/>import { Route, Switch } from 'react-router-dom'<br/>import Posts from '../components/Posts/Posts'<br/>import Post from '../components/Posts/Post'</span><span id="87e2" class="lc ld in ky b gy li lf l lg lh">const App = () =&gt; {<br/>  return (<br/>    &lt;Switch&gt;<br/>      &lt;Route exact path="/" component={Posts} /&gt;<br/>      &lt;Route exact path="/posts/:id" component={Post} /&gt;<br/>    &lt;/Switch&gt;<br/>  )<br/>}</span><span id="3eca" class="lc ld in ky b gy li lf l lg lh">export default App</span></pre><p id="83f2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我们的帖子列表项组件中，我们将添加到各个帖子组件的链接。由于我们正在与React Router Dome合作，我们不能只使用标签。相反，我们必须从反应路由器导入链路。该组件应如下所示:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="e3be" class="lc ld in ky b gy le lf l lg lh">import React from 'react'<br/>import { Link } from 'react-router-dom'</span><span id="9d00" class="lc ld in ky b gy li lf l lg lh">const PostListItem = ({post}) =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;Link to={`/posts/${post.id}`}&gt;<br/>        &lt;h2&gt;{post.attributes.title}&lt;/h2&gt;<br/>      &lt;/Link&gt;<br/>      &lt;p&gt;{post.attributes.body}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="e05a" class="lc ld in ky b gy li lf l lg lh">export default PostListItem</span></pre><p id="3dc9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们现在无法运行应用程序，因为我们正在导入不存在的帖子组件。让我们制作一个快速组件，以便了解现在是否一切正常。</p><h1 id="75a9" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">阅读</h1><p id="a925" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">在“app/JavaScript/src/components/Post/Post”处制作一个包含以下内容的组件:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="4b3a" class="lc ld in ky b gy le lf l lg lh">import React from 'react'</span><span id="a171" class="lc ld in ky b gy li lf l lg lh">const Post = () =&gt; {<br/>  return(<br/>    &lt;div&gt;<br/>      &lt;h1&gt;This is the Post Component&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="af91" class="lc ld in ky b gy li lf l lg lh">export default Post</span></pre><p id="411e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">转到"<a class="ae ml" href="http://localhost:3000/posts/123%E2%80%9D" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/posts/123 "</a>，您应该会看到新的Post组件。</p><p id="fffc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你也可以去<a class="ae ml" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000/ </a>查看我们放在那里的链接，链接到特定的Post组件。</p><p id="2c9c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们已经有了Post组件，现在让我们将它连接到我们的api。我们将设置我们的组件，以便在组件呈现时获取post，然后一旦它获得数据，它将再次呈现，这次使用新数据。</p><p id="c646" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这将为我们的组件设置它需要的正确数据:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2aee" class="lc ld in ky b gy le lf l lg lh">import React, { useEffect } from 'react'<br/>import { useDispatch, useSelector } from 'react-redux'<br/>import { getPost } from '../../actions/posts'</span><span id="851a" class="lc ld in ky b gy li lf l lg lh">const Post = ({match}) =&gt; {<br/>  const dispatch = useDispatch()<br/>  const post = useSelector(state =&gt; state.post)<br/>  const postId = match.params.id</span><span id="9cb4" class="lc ld in ky b gy li lf l lg lh">  useEffect(() =&gt; {<br/>    dispatch(getPost(postId))<br/>  }, [])<br/></span><span id="f0c6" class="lc ld in ky b gy li lf l lg lh">  return(<br/>    &lt;div&gt;<br/>      &lt;h1&gt;This is the Post Component&lt;/h1&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="b896" class="lc ld in ky b gy li lf l lg lh">export default Post</span></pre><p id="211e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里，我们从URL获取id，然后使用该Id从后端获取文章数据。关于useDispatch和useSelector的更多解释，<a class="ae ml" rel="noopener ugc nofollow" target="_blank" href="/how-to-set-up-react-js-with-a-ruby-on-rails-project-part-2-redux-31ac07638f34">见第2部分</a>。</p><p id="5af4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">注意，如果你正在跟随我以前的教程，我放错了一个“结束”在我的控制器里。我必须在继续前进之前解决这个问题。</p><p id="7ecc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，只需要用我们帖子中的信息填充页面。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="6993" class="lc ld in ky b gy le lf l lg lh">import React, { useEffect } from 'react'<br/>import { useDispatch, useSelector } from 'react-redux'<br/>import { getPost } from '../../actions/posts'</span><span id="3d72" class="lc ld in ky b gy li lf l lg lh">const Post = ({match}) =&gt; {<br/>  const dispatch = useDispatch()<br/>  const post = useSelector(state =&gt; state.post)<br/>  const postId = match.params.id</span><span id="5968" class="lc ld in ky b gy li lf l lg lh">  useEffect(() =&gt; {<br/>    dispatch(getPost(postId))<br/>  }, [])</span><span id="1ab2" class="lc ld in ky b gy li lf l lg lh">  if (!post) { return &lt;div&gt;Loading....&lt;/div&gt;}</span><span id="3f60" class="lc ld in ky b gy li lf l lg lh">  return(<br/>    &lt;div&gt;<br/>      &lt;h1&gt;{post.attributes.title}&lt;/h1&gt;<br/>      &lt;p&gt;{post.attributes.body}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="7fa1" class="lc ld in ky b gy li lf l lg lh">export default Post</span></pre><p id="c31c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在你知道了！那是CRUD的R。现在，让我们继续从前端创建记录。</p><h1 id="1026" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">创造</h1><p id="0901" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">首先，我们需要在“app/JavaScript/src/components/Posts”中创建表单。新”。表单看起来是这样的:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="fd5a" class="lc ld in ky b gy le lf l lg lh">import React, { useState } from 'react'<br/>import { useDispatch } from 'react-redux'<br/>import { createPost } from '../../actions/posts'<br/>import { useHistory } from "react-router-dom";</span><span id="d8c8" class="lc ld in ky b gy li lf l lg lh">const New = () =&gt; {<br/>  const dispatch = useDispatch()<br/>  const history = useHistory()<br/>  const [formData, setFormData] = useState({<br/>    title: "",<br/>    body: ""<br/>  })</span><span id="7215" class="lc ld in ky b gy li lf l lg lh">  const handleSubmit = (e) =&gt; {<br/>    e.preventDefault()<br/>    dispatch(createPost({post: formData}))<br/>    history.push("/")<br/>  }<br/></span><span id="ae0e" class="lc ld in ky b gy li lf l lg lh">  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;New Post&lt;/h1&gt;<br/>      &lt;form onSubmit​={handleSubmit}&gt;<br/>        &lt;label htmlFor="title"&gt;Title&lt;/label&gt;<br/>        &lt;input onChange​={(e) =&gt; setFormData({...formData, title: e.target.value})} type="text" name="title" id="title" value={formData.title} /&gt;<br/>        &lt; br /&gt;<br/>        &lt;label htmlFor="body"&gt;Body&lt;/label&gt;<br/>        &lt;textarea onChange​={(e) =&gt; setFormData({...formData, body: e.target.value})}  name="body" id="body" cols={30} rows={10} value={formData.body}&gt;&lt;/textarea&gt;<br/>        &lt; br /&gt;<br/>        &lt;input type="submit" value="Create Post" /&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span><span id="4719" class="lc ld in ky b gy li lf l lg lh">export default New</span></pre><p id="f953" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这段代码让你感到困惑，我有一篇关于在React中使用表单的文章。</p><p id="c80b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个表单中，我们创建一个新的Post对象，然后重定向回主页。如果你现在尝试把它发送到你的后台，你会遇到一个错误。您需要转到您的posts_controller.rb并添加以下内容:</p><p id="c460" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">用::null_session防止伪造</p><p id="5aa4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们将最后一部分添加到我们的减速器中。这只是更新我们Redux存储中的posts键。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="b6b3" class="lc ld in ky b gy le lf l lg lh">import { GET_POSTS, CREATE_POST } from '../types/index'</span><span id="054b" class="lc ld in ky b gy li lf l lg lh">export default (posts = [], action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POSTS:<br/>      return action.payload<br/>    case CREATE_POST:<br/>      return [...posts, action.payload]<br/>    default:<br/>      return posts<br/>  }<br/>}</span></pre><p id="6f69" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果到目前为止你已经完成了所有的工作，它应该可以工作了，现在我们已经在CRUD中完成了创建。</p><h1 id="d72d" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">破坏</h1><p id="8e2d" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">现在是时候摧毁我们的模型了。我们已经设置了动作创建器。我们需要配置我们的减速器。首先，我们需要在Redux存储中使用DESTROY_POST操作类型从posts键中删除帖子，如下所示:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="81f4" class="lc ld in ky b gy le lf l lg lh">import { GET_POSTS, CREATE_POST, DESTROY_POST } from '../types/index'</span><span id="59cf" class="lc ld in ky b gy li lf l lg lh">export default (posts = [], action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POSTS:<br/>      return action.payload<br/>    case CREATE_POST:<br/>      return [...posts, action.payload]<br/>      case DESTROY_POST:<br/>        return posts.filter(post =&gt; post.id != action.payload)<br/>    default:<br/>      return posts<br/>  }<br/>}</span></pre><p id="d82e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们正在浏览我们的帖子，并过滤掉刚刚删除的帖子。接下来，让我们在post reducer中将我们的post设置为null:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="2fe2" class="lc ld in ky b gy le lf l lg lh">import { GET_POST, DESTROY_POST } from '../types/index'</span><span id="c2e3" class="lc ld in ky b gy li lf l lg lh">export default (post = null, action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POST:<br/>      return action.payload<br/>    case DESTROY_POST:<br/>      return null<br/>    default:<br/>      return post<br/>  }<br/>}</span></pre><p id="a6fc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我这样做的原因是，当我们删除文章时，文章也被设置为Redux存储中的文章关键字。</p><p id="4340" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，让我们用下面的代码在“app/JavaScript/src/components/Posts/edit . js”创建一个新组件</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d9e3" class="lc ld in ky b gy le lf l lg lh">import React, { useEffect } from 'react'<br/>import { useDispatch, useSelector } from 'react-redux'<br/>import { getPost, destroyPost } from '../../actions/posts'<br/>import { useHistory } from "react-router-dom";<br/></span><span id="2128" class="lc ld in ky b gy li lf l lg lh">const Edit = ({ match }) =&gt; {<br/>  const dispatch = useDispatch()<br/>  const history = useHistory()<br/>  const post = useSelector(state =&gt; state.post)<br/>  const postId = match.params.id</span><span id="32fc" class="lc ld in ky b gy li lf l lg lh">  const handleClick = () =&gt; {<br/>    dispatch(destroyPost(postId))<br/>    history.push("/")<br/>  }</span><span id="57da" class="lc ld in ky b gy li lf l lg lh">  useEffect(() =&gt; {<br/>    dispatch(getPost(postId))<br/>  }, [])</span><span id="62c4" class="lc ld in ky b gy li lf l lg lh">  if (!post) { return &lt;div&gt;Loading...&lt;/div&gt;}</span><span id="bc01" class="lc ld in ky b gy li lf l lg lh">  return (<br/>    &lt;div&gt;<br/>      &lt;h1&gt;{post.attributes.title}&lt;/h1&gt;<br/>      &lt;button onClick​={handleClick}&gt;Delete me&lt;/button&gt;<br/>    &lt;/div&gt;<br/>  )</span><span id="b71a" class="lc ld in ky b gy li lf l lg lh">}</span><span id="66e7" class="lc ld in ky b gy li lf l lg lh">export default Edit</span></pre><p id="192c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，您应该对这些很熟悉了—我们只是删除了这一次。并确保将路线添加到您的App.js文件中。</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="9398" class="lc ld in ky b gy le lf l lg lh">import React from 'react'<br/>import { Route, Switch } from 'react-router-dom'<br/>import Posts from '../components/Posts/Posts'<br/>import Post from '../components/Posts/Post'<br/>import New from '../components/Posts/New'<br/>import Edit from '../components/Posts/Edit'</span><span id="9caa" class="lc ld in ky b gy li lf l lg lh">const App = () =&gt; {<br/>  return (<br/>    &lt;Switch&gt;<br/>      &lt;Route exact path="/" component={Posts} /&gt;<br/>      &lt;Route exact path="/posts/new" component={New} /&gt;<br/>      &lt;Route exact path="/posts/:id" component={Post} /&gt;<br/>      &lt;Route exact path="/posts/:id/edit" component={Edit} /&gt;<br/>    &lt;/Switch&gt;<br/>  )<br/>}</span><span id="4c1d" class="lc ld in ky b gy li lf l lg lh">export default App</span></pre><p id="22ca" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是我们要做的——摧毁已经完成。再来一个，我们就完了！</p><h1 id="49ac" class="lj ld in bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">更新</h1><p id="a3fe" class="pw-post-body-paragraph jv jw in jx b jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko mk kq kr ks ig bi translated">我们将使用刚刚为删除操作创建的Posts/Edit.js组件。在这个组件中，我们只需要设置一个表单，就像创建一个新帖子一样。</p><p id="43c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您的Posts/Edit.js文件应该如下所示:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="d2c4" class="lc ld in ky b gy le lf l lg lh">import React, { useEffect, useState } from 'react'<br/>import { useDispatch, useSelector } from 'react-redux'<br/>import { getPost, destroyPost, updatePost } from '../../actions/posts'<br/>import { useHistory } from "react-router-dom";<br/></span><span id="f1d6" class="lc ld in ky b gy li lf l lg lh">const Edit = ({ match }) =&gt; {<br/>  const dispatch = useDispatch()<br/>  const history = useHistory()<br/>  const post = useSelector(state =&gt; state.post)<br/>  const postId = match.params.id</span><span id="5b45" class="lc ld in ky b gy li lf l lg lh">  const handleClick = () =&gt; {<br/>    dispatch(destroyPost(postId))<br/>    history.push("/")<br/>  }<br/>  const [formData, setFormData] = useState({<br/>    title: '',<br/>    body: ''<br/>  })</span><span id="d92b" class="lc ld in ky b gy li lf l lg lh">  useEffect(() =&gt; {<br/>    dispatch(getPost(postId))<br/>  }, [])</span><span id="d8e8" class="lc ld in ky b gy li lf l lg lh">  useEffect(() =&gt; {<br/>    if (post) {<br/>      setFormData({<br/>        title: post.attributes.title || '',<br/>        body: post.attributes.body || ''<br/>      })<br/>    }<br/>  }, [post])</span><span id="1f6c" class="lc ld in ky b gy li lf l lg lh">  if (!post) { return &lt;div&gt;Loading...&lt;/div&gt;}</span><span id="e741" class="lc ld in ky b gy li lf l lg lh">  const handleSubmit = (e) =&gt; {<br/>    e.preventDefault()<br/>    dispatch(updatePost(postId, {post: formData}))<br/>    history.push("/")</span><span id="c346" class="lc ld in ky b gy li lf l lg lh">  }</span><span id="b5f0" class="lc ld in ky b gy li lf l lg lh">  return (<br/>    &lt;div&gt;<br/>      &lt;form onSubmit​={handleSubmit}&gt;  <br/>        &lt;h1&gt;{post.attributes.title}&lt;/h1&gt;<br/>        &lt;label htmlFor="title"&gt;Title&lt;/label&gt;<br/>        &lt;input onChange​={(e) =&gt; setFormData({...formData, title: e.target.value})} type="text" name="title" id="title" value={formData.title} /&gt;<br/>        &lt;br /&gt;<br/>        &lt;label htmlFor="body"&gt;Body&lt;/label&gt;<br/>        &lt;textarea onChange​={(e) =&gt; setFormData({...formData, body: e.target.value})} name="body" id="body" cols={30} rows={10} value={formData.body}&gt;&lt;/textarea&gt;<br/>        &lt;br /&gt;<br/>        &lt;button onClick​={handleClick}&gt;Delete me&lt;/button&gt;<br/>        &lt;input type="Submit" value="Save" /&gt;<br/>      &lt;/form&gt;<br/>    &lt;/div&gt;<br/>  )</span><span id="0b64" class="lc ld in ky b gy li lf l lg lh">}</span><span id="3767" class="lc ld in ky b gy li lf l lg lh">export default Edit</span></pre><p id="a581" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这类似于我们的create方法——我们有一个表单设置，并使用我们的动作创建器updatePost()。唯一看起来奇怪的是这部分:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="24cc" class="lc ld in ky b gy le lf l lg lh">useEffect(() =&gt; {<br/>    if (post) {<br/>      setFormData({<br/>        title: post.attributes.title || '',<br/>        body: post.attributes.body || ''<br/>      })<br/>    }<br/>  }, [post])</span></pre><p id="3027" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看到那张[海报]了吗？每当post值改变时，这个useEffect()钩子就会运行。这意味着在我们联系后端并用post更新Redux存储之后，这个函数运行并为我们的表单设置默认值。</p><p id="51d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们要做的最后一件事就是在Redux store中发布我们的帖子。在“app/JavaScript/src/reducers/posts . js”中添加UPDATE_POST:</p><pre class="kt ku kv kw gt kx ky kz la aw lb bi"><span id="3774" class="lc ld in ky b gy le lf l lg lh">import { GET_POSTS, CREATE_POST, DESTROY_POST, UPDATE_POST } from '../types/index'</span><span id="5dda" class="lc ld in ky b gy li lf l lg lh">export default (posts = [], action ) =&gt; {<br/>  switch (action.type) {<br/>    case GET_POSTS:<br/>      return action.payload<br/>    case CREATE_POST:<br/>      return [...posts, action.payload]<br/>    case DESTROY_POST:<br/>      return posts.filter(post =&gt; post.id != action.payload)<br/>    case UPDATE_POST:<br/>      let updatedPosts = posts.map(post =&gt; {<br/>        if (post.id === action.payload.id) {<br/>          return action.payload<br/>        } else {<br/>          return post<br/>        }<br/>      })<br/>      return updatedPosts<br/>    default:<br/>      return posts<br/>  }<br/>}</span></pre><p id="c9f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这里，我们只是映射我们的帖子，并找到我们刚刚更新的帖子。然后我们用新帖子替换旧帖子。</p><p id="9f95" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在我们有了。我们现在已经在React on Rails应用程序中实现了CRUD函数。我计划下一步做认证。一定要在Twitter上关注我，这样我发布的时候你就知道了。</p><p id="09c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mm">更多内容尽在</em><a class="ae ml" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank">T5】plain English . ioT7】</a></p></div></div>    
</body>
</html>