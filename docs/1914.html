<html>
<head>
<title>How to Write File-Based JavaScript Tests with Real Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用真实文件编写基于文件的JavaScript测试</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-write-file-based-tests-with-real-files-d581e2e1d459?source=collection_archive---------14-----------------------#2021-04-21">https://javascript.plainenglish.io/how-to-write-file-based-tests-with-real-files-d581e2e1d459?source=collection_archive---------14-----------------------#2021-04-21</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/9e0af5d72b27bb4d505029baee63670b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qCzrsEHVThO10TL-CYdaiQ.png"/></div></div></figure><p id="e12e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">嘿，伙计们，这篇文章是关于为通过读写文件到磁盘来访问文件系统的项目编写测试的。</p><p id="b759" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我过去的许多项目在某种程度上都与文件访问有关。我开始用类似于<a class="ae kt" href="https://github.com/tschaub/mock-fs" rel="noopener ugc nofollow" target="_blank"> mock-fs </a>的模仿库进行测试，但是很快发现它们并不适用于所有情况，有时你在内部使用第三方库，你不能轻易模仿。所以我想到了一个不同的解决方案，我现在在大多数项目中使用的是真正的文件。</p><h1 id="d7cf" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">使用-local-tmp-dir和输出文件</h1><p id="73b2" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">为什么不用真实文件进行测试，而不是嘲讽？我用-local-tmp-dir 构建了一个名为<a class="ae kt" href="https://github.com/dword-design/with-local-tmp-dir" rel="noopener ugc nofollow" target="_blank">的NPM包，它基本上是在cwd中创建一个临时子文件夹，<code class="fe lx ly lz ma b">cd</code> s放入其中，运行一个函数，然后<code class="fe lx ly lz ma b">cd</code> s返回到先前的cwd。在这个函数中，你可以创建文件和几乎任何东西，在测试中运行你的单元。之后，文件夹被删除，一切都被清理。实际上，您不仅仅需要将它用于测试，您可以在任何地方使用它，但是它主要用于测试。</a></p><p id="56c9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我还编写了另一个助手包<a class="ae kt" href="https://github.com/dword-design/output-files" rel="noopener ugc nofollow" target="_blank">输出文件</a>，它通过传递一个对象一次创建一个完整的文件树。这比编写大量的<code class="fe lx ly lz ma b">fs.writeFile</code>调用来创建许多文件要容易得多。</p><h1 id="9661" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">让我们测试一个脚手架工具！</h1><p id="1ac2" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">好吧，让我们开始吧！首先，你需要一个测试框架。这里我将使用<a class="ae kt" href="https://github.com/mochajs/mocha" rel="noopener ugc nofollow" target="_blank"> Mocha </a>，但是你也可以使用<a class="ae kt" href="https://github.com/facebook/jest" rel="noopener ugc nofollow" target="_blank"> Jest </a>或者你选择的任何其他框架。对于断言，我也使用了<a class="ae kt" href="https://github.com/mjackson/expect" rel="noopener ugc nofollow" target="_blank"> expect </a>。之后，我们将安装一些编写测试所需的包:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="228d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将测试一个将配置文件写入磁盘的小型搭建工具。如果文件已经存在，它不会被覆盖。否则，将创建一个默认文件。它如何工作并不重要，重要的是我们如何测试它😀。</p><h1 id="a61e" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">编写我们的第一个测试</h1><p id="1015" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">让我们添加一个测试文件:</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="67c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们可以通过以下方式运行我们的测试:</p><p id="f017" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><code class="fe lx ly lz ma b">$ mocha index.spec.js</code></p><p id="b571" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">已经很好了，我们已经测试了搭建工具是否创建了一个<code class="fe lx ly lz ma b">README.md</code>和一个<code class="fe lx ly lz ma b">.configrc.json</code>文件，并检查了内容是否正确！</p><h1 id="fd28" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">预先写文件</h1><p id="7aca" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">让我们添加另一个测试，检查文件是否被保留，如果它们已经存在的话。我们将使用<code class="fe lx ly lz ma b">output-files</code>来写这些文件。</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="e8c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">太好了，这已经是大部分工作了！当然，您现在可以深入细节并编写更多测试，但从技术上讲，这就是它需要的全部。你看，用这些包编写基于文件的测试并不比没有它们多多少工作，你可以用真实的文件进行测试🚀。</p><h1 id="dc92" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">编写基于Git的测试</h1><p id="ca61" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">测试设置实际上打开了另一扇门:使用Git存储库进行测试！我知道这听起来有点吓人，但是现在我们可以把文件写到磁盘上进行测试了，为什么不<code class="fe lx ly lz ma b">git init</code>一个git存储库呢？</p><p id="7b7c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设我们的支架工具利用了当前签出的Git存储库，并将原始URL放入<code class="fe lx ly lz ma b">.configrc.json</code>文件中。现在，我们可以通过在我们的测试文件夹中实际实例化一个Git存储库来测试这是否有效。我们需要另一个运行子进程的包，运行<code class="fe lx ly lz ma b">npm install --save-dev execa</code>。</p><figure class="mb mc md me gt jo"><div class="bz fp l di"><div class="mf mg l"/></div></figure><p id="754f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不过要小心，如果存储库没有正确初始化，用户用户Git配置可能会被覆盖。</p><h1 id="502c" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="1c25" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">你看，有很多可能性！🥳，你觉得这个怎么样？请在评论中告诉我！此外，如果你喜欢带有-local-tmp-dir 和<a class="ae kt" href="https://github.com/dword-design/output-files" rel="noopener ugc nofollow" target="_blank">输出文件</a>的<a class="ae kt" href="https://github.com/dword-design/with-local-tmp-dir" rel="noopener ugc nofollow" target="_blank">,给它一颗GitHub上的星吧🌟。如果你喜欢我正在做的事情，请在</a><a class="ae kt" href="https://twitter.com/seblandwehr" rel="noopener ugc nofollow" target="_blank">推特</a>上关注我，或者查看我的<a class="ae kt" href="https://sebastianlandwehr.com/" rel="noopener ugc nofollow" target="_blank">网站</a>。</p><p id="dfe2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mh">原为发表于</em><a class="ae kt" href="https://sebastianlandwehr.com/blog/how-to-write-file-based-javascript-tests-with-real-files" rel="noopener ugc nofollow" target="_blank"><em class="mh">sebastianlandwehr.com</em></a></p><p id="e371" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mh">多内容于</em> <a class="ae kt" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mh">浅显易懂</em></strong></a></p></div></div>    
</body>
</html>