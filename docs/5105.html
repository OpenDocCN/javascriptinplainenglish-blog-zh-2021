<html>
<head>
<title>Save Many Documents on MongoDB, Skipping Duplications, with React and Apollo Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ç”¨Reactå’ŒApolloå®¢æˆ·ç«¯åœ¨MongoDBä¸Šä¿å­˜è®¸å¤šæ–‡æ¡£ï¼Œè·³è¿‡é‡å¤</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/save-many-entries-on-mongodb-skipping-duplications-with-react-and-apollo-client-f5e11a9d2744?source=collection_archive---------8-----------------------#2021-10-16">https://javascript.plainenglish.io/save-many-entries-on-mongodb-skipping-duplications-with-react-and-apollo-client-f5e11a9d2744?source=collection_archive---------8-----------------------#2021-10-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7f93be275a5426ce4c012b8e9e190cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k2Q7DkLcmwYUm5mfHDCyUw.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@impatrickt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Patrick Tomasso</a> on <a class="ae ja" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><h1 id="dbed" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">ç›®æ ‡:</h1><ul class=""><li id="0bd4" class="ky kz jd la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated"><strong class="la je"> <em class="lq">ä½¿ç”¨Apolloå®¢æˆ·ç«¯</em> </strong>ï¼Œä¸€æ¬¡å°†å¤šä¸ªæ–‡æ¡£ä»Reactåº”ç”¨ç¨‹åºä¸Šä¼ åˆ°MongoDBã€‚æ¯ä¸ªæ–‡æ¡£éƒ½æ˜¯ã€‚æˆ‘ä»¬è§£æå’Œæ“ä½œçš„xlsxæ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸æœ¬æ–‡æ— å…³ã€‚</li><li id="4713" class="ky kz jd la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated"><strong class="la je"> <em class="lq">æ‹’ç»ç°æœ‰çš„(åŸºäºå”¯ä¸€id)æ–‡æ¡£ï¼Œä½†å­˜å‚¨æ–°çš„</em> </strong>ã€‚</li></ul><p id="576d" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">æˆ‘ä»¬èµ°å§ï¼</p><h1 id="9ded" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">é€‰æ‹©#1:ç”¨insertOne()å†™æ‰¹é‡</h1><h2 id="5af2" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">1.åœ¨æ‚¨çš„<a class="ae ja" href="https://realm.mongodb.com" rel="noopener ugc nofollow" target="_blank"> Mongo Atlas </a>é¡¹ç›®ä¸­æ·»åŠ Realmå‡½æ•°</h2><figure class="mz na nb nc gt ip"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a998" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><strong class="la je"> <em class="lq">æ³¨æ„#1 </em> </strong> <em class="lq">:ä½¿ç”¨</em><strong class="la je"><em class="lq">{ ordered:false }</em></strong><em class="lq">æ˜¯åœ¨è¿‡è´¦æ•°æ®æ—¶è·³è¿‡å·²æœ‰æ¡ç›®çš„å…³é”®ã€‚</em> <a class="ae ja" href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#std-label-bulkwrite-write-operations-executionofoperations" rel="noopener ugc nofollow" target="_blank"> <em class="lq">æ›´å¤šç»†èŠ‚åœ¨æ­¤</em> </a> <em class="lq">ã€‚</em></p><p id="bbd7" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><strong class="la je">ä½ å¯ä»¥é€šè¿‡ <a class="ae ja" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> MongoDBæŒ‡å—é’ˆ</em> </a> <em class="lq"> app </em>è½»æ¾è®¾ç½®è¿™äº›æŒ‡æ ‡</strong></p><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nf"><img src="../Images/158dc72743a1c95c8444eac001ee81be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MU2HgN67aLJ1Z_ZfmsmEbw.png"/></div></div></figure><h2 id="012e" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">2.è®¾ç½®åŠŸèƒ½çš„è®¾ç½®</h2><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ng"><img src="../Images/b061f41184dc55f4bc0a980ebb4e17f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8Ms7Kx4YaXLANeF643BCg.png"/></div></div></figure><h2 id="bb0e" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">3.åˆ›å»ºè‡ªå®šä¹‰å†²çªè§£å†³ç¨‹åºå¹¶å°†å…¶é“¾æ¥åˆ°å‡½æ•°</h2><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nh"><img src="../Images/03d59a81f03f95f833f5a70718c209f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKIA07MaJPp-aEmTdvSElA.png"/></div></div></figure><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ni"><img src="../Images/7cd431051bd84f6646849dde449ff51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zB2s8-AYcf3Kj7_KRncqA.png"/></div></div></figure><h2 id="fb30" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">4.åœ¨reactåº”ç”¨ç¨‹åºçš„operations.graphqlæ–‡ä»¶ä¸­æ·»åŠ é€è§†å›¾å˜ä½“</h2><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="6022" class="mn kb jd nk b gy no np l nq nr">mutation InsertManyPerformancesSkipDuplicates($data:[PerformanceInsertInput!]!) {</span><span id="387a" class="mn kb jd nk b gy ns np l nq nr">   insertManyPerfsSkipDups(input: $data) { status }</span><span id="de57" class="mn kb jd nk b gy ns np l nq nr">}</span></pre><h2 id="c61b" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">5.ç”¨<a class="ae ja" href="https://www.apollographql.com/blog/tooling/apollo-codegen/typescript-graphql-code-generator-generate-graphql-types/" rel="noopener ugc nofollow" target="_blank"> npm run generate </a>ç”Ÿæˆä½ çš„é’©å­å’Œç±»å‹</h2><h2 id="aa4f" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">6.ç”Ÿæˆé€‚å½“çš„æ•°æ®åï¼Œä½¿ç”¨ç»„ä»¶ä¸­çš„å‡½æ•°</h2><figure class="mz na nb nc gt ip"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ff24" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">è¿™æ˜¯æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸Šçš„ç»“æœå’Œæˆ‘ä»¬çš„æ•°æ®åº“ä¸­ç‰¹å®šæ–‡ä»¶çš„é€è§†æ•°æ®ã€‚</p><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nt"><img src="../Images/d99b08601d97b97d1f1e33610927c73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZQ9rQQMEd8VWoDLot9o2A.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">The informative message to the user about the skipped values due to duplication.</figcaption></figure><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nu"><img src="../Images/c6da0a74bfc2637a520e3214274c7871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dTzWY6SPkacu725eVwDjg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Info from our Database as viewed from MongoDB Compass</figcaption></figure><h1 id="e6cb" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">é€‰æ‹©#2:ç”¨updateOne()å†™æ‰¹é‡</h1><p id="c01f" class="pw-post-body-paragraph lw lx jd la b lb lc lz ma ld le mc md lf nv mf mg lh nw mi mj lj nx ml mm ll ig bi translated">åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å”¯ä¸€éœ€è¦æ”¹å˜çš„æ˜¯æˆ‘ä»¬åœ¨é¢†åŸŸå‡½æ•°ä¸­ä½¿ç”¨çš„æ–¹æ³•ã€‚</p><p id="cddf" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">ä»£æ›¿</p><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="a43a" class="mn kb jd nk b gy no np l nq nr">const operations = performances.map(op =&gt; (<strong class="nk je">{ insertOne : { â€œdocumentâ€ : p }</strong> })); </span><span id="03fb" class="mn kb jd nk b gy ns np l nq nr">return await myCollection.bulkWrite( operations, { ordered : false })</span></pre><p id="2d57" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">æˆ‘ä»¬ç°åœ¨ä½¿ç”¨</p><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="e569" class="mn kb jd nk b gy no np l nq nr">const operations = performances.map(op =&gt; (<strong class="nk je">{ updateOne : {â€œfilterâ€: { â€œcontentIdâ€: p.contentId }, â€œupdateâ€ : {$set: p}, upsert: true } }</strong>)); </span><span id="3302" class="mn kb jd nk b gy ns np l nq nr">return await myCollection.bulkWrite( operations, { ordered : false })</span></pre><p id="9ad0" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">è¿™é‡Œé‡è¦çš„æ˜¯:</p><ol class=""><li id="4f9c" class="ky kz jd la b lb ly ld mb lf ny lh nz lj oa ll ob ln lo lp bi translated"><strong class="la je"> upsert: true </strong>é€‰é¡¹ï¼Œæ„æ€æ˜¯â€œå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¦æ›´æ–°çš„æ–‡æ¡£ï¼Œå°±åˆ›å»ºå®ƒã€‚â€</li><li id="628f" class="ky kz jd la b lb lr ld ls lf lt lh lu lj lv ll ob ln lo lp bi translated"><strong class="la je">è¿‡æ»¤å™¨:{ "contentId": p.contentId }: </strong>è¿™æ˜¯æˆ‘ä»¬è¿›è¡ŒéªŒè¯çš„å±æ€§ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æ‰¾åˆ°é‡å¤é¡¹æ‰€åŸºäºçš„ä¸Šä¸€ä¸ªé€‰é¡¹ã€‚</li></ol><p id="52e2" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">å°±æ˜¯è¿™æ ·ï¼ğŸ™‚</p><p id="58ee" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><em class="lq">æ›´å¤šå†…å®¹çœ‹</em><a class="ae ja" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="la je"><em class="lq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>