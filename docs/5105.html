<html>
<head>
<title>Save Many Documents on MongoDB, Skipping Duplications, with React and Apollo Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React和Apollo客户端在MongoDB上保存许多文档，跳过重复</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/save-many-entries-on-mongodb-skipping-duplications-with-react-and-apollo-client-f5e11a9d2744?source=collection_archive---------8-----------------------#2021-10-16">https://javascript.plainenglish.io/save-many-entries-on-mongodb-skipping-duplications-with-react-and-apollo-client-f5e11a9d2744?source=collection_archive---------8-----------------------#2021-10-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/7f93be275a5426ce4c012b8e9e190cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k2Q7DkLcmwYUm5mfHDCyUw.jpeg"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Photo by <a class="ae ja" href="https://unsplash.com/@impatrickt?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Patrick Tomasso</a> on <a class="ae ja" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><h1 id="dbed" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">目标:</h1><ul class=""><li id="0bd4" class="ky kz jd la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated"><strong class="la je"> <em class="lq">使用Apollo客户端</em> </strong>，一次将多个文档从React应用程序上传到MongoDB。每个文档都是。我们解析和操作的xlsx文件。这个过程与本文无关。</li><li id="4713" class="ky kz jd la b lb lr ld ls lf lt lh lu lj lv ll lm ln lo lp bi translated"><strong class="la je"> <em class="lq">拒绝现有的(基于唯一id)文档，但存储新的</em> </strong>。</li></ul><p id="576d" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">我们走吧！</p><h1 id="9ded" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">选择#1:用insertOne()写批量</h1><h2 id="5af2" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">1.在您的<a class="ae ja" href="https://realm.mongodb.com" rel="noopener ugc nofollow" target="_blank"> Mongo Atlas </a>项目中添加Realm函数</h2><figure class="mz na nb nc gt ip"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a998" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><strong class="la je"> <em class="lq">注意#1 </em> </strong> <em class="lq">:使用</em><strong class="la je"><em class="lq">{ ordered:false }</em></strong><em class="lq">是在过账数据时跳过已有条目的关键。</em> <a class="ae ja" href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#std-label-bulkwrite-write-operations-executionofoperations" rel="noopener ugc nofollow" target="_blank"> <em class="lq">更多细节在此</em> </a> <em class="lq">。</em></p><p id="bbd7" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><strong class="la je">你可以通过 <a class="ae ja" href="https://www.mongodb.com/products/compass" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> MongoDB指南针</em> </a> <em class="lq"> app </em>轻松设置这些指标</strong></p><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nf"><img src="../Images/158dc72743a1c95c8444eac001ee81be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MU2HgN67aLJ1Z_ZfmsmEbw.png"/></div></div></figure><h2 id="012e" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">2.设置功能的设置</h2><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ng"><img src="../Images/b061f41184dc55f4bc0a980ebb4e17f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M8Ms7Kx4YaXLANeF643BCg.png"/></div></div></figure><h2 id="bb0e" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">3.创建自定义冲突解决程序并将其链接到函数</h2><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nh"><img src="../Images/03d59a81f03f95f833f5a70718c209f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKIA07MaJPp-aEmTdvSElA.png"/></div></div></figure><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi ni"><img src="../Images/7cd431051bd84f6646849dde449ff51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zB2s8-AYcf3Kj7_KRncqA.png"/></div></div></figure><h2 id="fb30" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">4.在react应用程序的operations.graphql文件中添加透视图变体</h2><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="6022" class="mn kb jd nk b gy no np l nq nr">mutation InsertManyPerformancesSkipDuplicates($data:[PerformanceInsertInput!]!) {</span><span id="387a" class="mn kb jd nk b gy ns np l nq nr">   insertManyPerfsSkipDups(input: $data) { status }</span><span id="de57" class="mn kb jd nk b gy ns np l nq nr">}</span></pre><h2 id="c61b" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">5.用<a class="ae ja" href="https://www.apollographql.com/blog/tooling/apollo-codegen/typescript-graphql-code-generator-generate-graphql-types/" rel="noopener ugc nofollow" target="_blank"> npm run generate </a>生成你的钩子和类型</h2><h2 id="aa4f" class="mn kb jd bd kc mo mp dn kg mq mr dp kk lf ms mt ko lh mu mv ks lj mw mx kw my bi translated">6.生成适当的数据后，使用组件中的函数</h2><figure class="mz na nb nc gt ip"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ff24" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">这是我们的应用程序上的结果和我们的数据库中特定文件的透视数据。</p><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nt"><img src="../Images/d99b08601d97b97d1f1e33610927c73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CZQ9rQQMEd8VWoDLot9o2A.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">The informative message to the user about the skipped values due to duplication.</figcaption></figure><figure class="mz na nb nc gt ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi nu"><img src="../Images/c6da0a74bfc2637a520e3214274c7871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0dTzWY6SPkacu725eVwDjg.png"/></div></div><figcaption class="iw ix gj gh gi iy iz bd b be z dk">Info from our Database as viewed from MongoDB Compass</figcaption></figure><h1 id="e6cb" class="ka kb jd bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">选择#2:用updateOne()写批量</h1><p id="c01f" class="pw-post-body-paragraph lw lx jd la b lb lc lz ma ld le mc md lf nv mf mg lh nw mi mj lj nx ml mm ll ig bi translated">在这种方法中，我们唯一需要改变的是我们在领域函数中使用的方法。</p><p id="cddf" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">代替</p><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="a43a" class="mn kb jd nk b gy no np l nq nr">const operations = performances.map(op =&gt; (<strong class="nk je">{ insertOne : { “document” : p }</strong> })); </span><span id="03fb" class="mn kb jd nk b gy ns np l nq nr">return await myCollection.bulkWrite( operations, { ordered : false })</span></pre><p id="2d57" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">我们现在使用</p><pre class="mz na nb nc gt nj nk nl nm aw nn bi"><span id="e569" class="mn kb jd nk b gy no np l nq nr">const operations = performances.map(op =&gt; (<strong class="nk je">{ updateOne : {“filter”: { “contentId”: p.contentId }, “update” : {$set: p}, upsert: true } }</strong>)); </span><span id="3302" class="mn kb jd nk b gy ns np l nq nr">return await myCollection.bulkWrite( operations, { ordered : false })</span></pre><p id="9ad0" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">这里重要的是:</p><ol class=""><li id="4f9c" class="ky kz jd la b lb ly ld mb lf ny lh nz lj oa ll ob ln lo lp bi translated"><strong class="la je"> upsert: true </strong>选项，意思是“如果没有找到要更新的文档，就创建它。”</li><li id="628f" class="ky kz jd la b lb lr ld ls lf lt lh lu lj lv ll ob ln lo lp bi translated"><strong class="la je">过滤器:{ "contentId": p.contentId }: </strong>这是我们进行验证的属性，也是我们找到重复项所基于的上一个选项。</li></ol><p id="52e2" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated">就是这样！🙂</p><p id="58ee" class="pw-post-body-paragraph lw lx jd la b lb ly lz ma ld mb mc md lf me mf mg lh mh mi mj lj mk ml mm ll ig bi translated"><em class="lq">更多内容看</em><a class="ae ja" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="la je"><em class="lq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>