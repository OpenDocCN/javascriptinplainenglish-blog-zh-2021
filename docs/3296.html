<html>
<head>
<title>A Guide to Optional Chaining ‘?.’ in JavaScript — Explained with Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可选链接指南？.'用JavaScript——用例子解释</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-guide-to-optional-chaining-in-javascript-explained-with-examples-cab2efccaef9?source=collection_archive---------13-----------------------#2021-07-05">https://javascript.plainenglish.io/a-guide-to-optional-chaining-in-javascript-explained-with-examples-cab2efccaef9?source=collection_archive---------13-----------------------#2021-07-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/f94f1152be24a0ff6523692f400d7d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x5VfiVqt9vVRc4nXPRHWWQ.png"/></div></div></figure><p id="8832" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JavaScript中的可选链接<code class="fe kt ku kv kw b">?.</code>是访问嵌套对象属性的安全方式，即使中间属性不存在。</p><h1 id="f5eb" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">“不存在的财产”问题</h1><p id="596a" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">如果你刚开始看教程，学JavaScript，可能问题还没接触到你，但是挺普遍的。</p><p id="ab8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">举个例子，假设我们有保存用户信息的<code class="fe kt ku kv kw b">user</code>对象。</p><p id="0bd8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们的大多数用户都有在<code class="fe kt ku kv kw b">user.address</code>房产、街道<code class="fe kt ku kv kw b">user.address.street</code>的地址，但有些人没有提供。</p><p id="8dbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，当我们试图获取<code class="fe kt ku kv kw b">user.address.street</code>，而用户碰巧没有地址时，我们会得到一个错误:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="6d0c" class="mi ky in kw b gy mj mk l ml mm">let user = {}; // a user without "address" property</span><span id="3f00" class="mi ky in kw b gy mn mk l ml mm">alert(user.address.street); // Error!</span></pre><p id="deb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是预期的结果。JavaScript是这样工作的。由于<code class="fe kt ku kv kw b">user.address</code>是<code class="fe kt ku kv kw b">undefined</code>，尝试获取<code class="fe kt ku kv kw b">user.address.street</code>失败并出错。</p><p id="49d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在许多实际情况下，我们更希望得到<code class="fe kt ku kv kw b">undefined</code>而不是这里的错误(意思是“没有街道”)。</p><p id="e8bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">…还有另一个例子。在web开发中，我们可以使用一个特殊的方法调用，比如<code class="fe kt ku kv kw b">document.querySelector('.elem')</code>，得到一个对应于web页面元素的对象，当没有这样的元素时，它返回<code class="fe kt ku kv kw b">null</code>。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="c9b2" class="mi ky in kw b gy mj mk l ml mm">// document.querySelector('.elem') is null if there's no element<br/>let html = document.querySelector('.elem').innerHTML; // error if it's null</span></pre><p id="0fba" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，如果元素不存在，我们将在访问<code class="fe kt ku kv kw b">null</code>的<code class="fe kt ku kv kw b">.innerHTML</code>时出错。在某些情况下，缺少元素是正常的，我们希望避免错误，只接受<code class="fe kt ku kv kw b">html = null</code>作为结果。</p><p id="90aa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们如何做到这一点？</p><p id="cd9f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">显而易见的解决方案是在访问其属性之前，使用<code class="fe kt ku kv kw b">if</code>或条件运算符<code class="fe kt ku kv kw b">?</code>检查值，如下所示:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="6b01" class="mi ky in kw b gy mj mk l ml mm">let user = {};</span><span id="e7f0" class="mi ky in kw b gy mn mk l ml mm">alert(user.address ? user.address.street : undefined);</span></pre><p id="04d4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">它工作，没有错误…但它相当不雅。如您所见，<code class="fe kt ku kv kw b">"user.address"</code>在代码中出现了两次。对于嵌套更深的属性，由于需要更多的重复，这就成了一个问题。</p><p id="e291" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如:让我们试试<code class="fe kt ku kv kw b">user.address.street.name</code>。</p><p id="7abe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们需要检查<code class="fe kt ku kv kw b">user.address</code>和<code class="fe kt ku kv kw b">user.address.street</code>:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="caad" class="mi ky in kw b gy mj mk l ml mm">let user = {}; // user has no address</span><span id="575a" class="mi ky in kw b gy mn mk l ml mm">alert(user.address ? user.address.street ? user.address.street.name : null : null);</span></pre><p id="0cbd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这太可怕了，人们甚至可能难以理解这样的代码。</p><p id="dc02" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不要在意，因为有更好的方式来编写它，使用<code class="fe kt ku kv kw b">&amp;&amp;</code>操作符:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="8ca4" class="mi ky in kw b gy mj mk l ml mm">let user = {}; // user has no address</span><span id="e715" class="mi ky in kw b gy mn mk l ml mm">alert( user.address &amp;&amp; user.address.street &amp;&amp; user.address.street.name ); // undefined (no error)</span></pre><p id="41ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用属性的完整路径可以确保所有组件都存在(如果不存在，求值将会停止)，但这并不理想。</p><p id="f292" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如您所见，属性名在代码中仍然是重复的。例如，在上面的代码中，<code class="fe kt ku kv kw b">user.address</code>出现了三次。</p><p id="c9d7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是为什么可选的链接<code class="fe kt ku kv kw b">?.</code>被添加到语言中。来一劳永逸的解决这个问题！</p><h1 id="8b3b" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">可选链接</h1><p id="0fd5" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">如果<code class="fe kt ku kv kw b">?.</code>之前的值为<code class="fe kt ku kv kw b">undefined</code>或<code class="fe kt ku kv kw b">null</code>，可选链接<code class="fe kt ku kv kw b">?.</code>停止评估，并返回<code class="fe kt ku kv kw b">undefined</code>。</p><p id="bf0e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">在本文中，为了简洁起见，我们将说某个东西“存在”，如果它不是</strong> <code class="fe kt ku kv kw b"><strong class="jx io">null</strong></code> <strong class="jx io">而不是</strong> <code class="fe kt ku kv kw b"><strong class="jx io">undefined</strong></code> <strong class="jx io">。</strong></p><p id="50f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">换句话说，<code class="fe kt ku kv kw b">value?.prop</code>:</p><ul class=""><li id="635e" class="mo mp in jx b jy jz kc kd kg mq kk mr ko ms ks mt mu mv mw bi translated">作为<code class="fe kt ku kv kw b">value.prop</code>工作，如果<code class="fe kt ku kv kw b">value</code>存在，</li><li id="2435" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks mt mu mv mw bi translated">否则(当<code class="fe kt ku kv kw b">value</code>为<code class="fe kt ku kv kw b">undefined/null</code>时)返回<code class="fe kt ku kv kw b">undefined</code>。</li></ul><p id="33a2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是使用<code class="fe kt ku kv kw b">?.</code>访问<code class="fe kt ku kv kw b">user.address.street</code>的安全方法:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="b259" class="mi ky in kw b gy mj mk l ml mm">let user = {}; // user has no address</span><span id="58a4" class="mi ky in kw b gy mn mk l ml mm">alert( user?.address?.street ); // undefined (no error)</span></pre><p id="d883" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">代码简洁明了，没有任何重复。</p><p id="d905" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">即使<code class="fe kt ku kv kw b">user</code>对象不存在，用<code class="fe kt ku kv kw b">user?.address</code>读取地址也有效:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="7cc0" class="mi ky in kw b gy mj mk l ml mm">let user = null;</span><span id="9567" class="mi ky in kw b gy mn mk l ml mm">alert( user?.address ); // undefined<br/>alert( user?.address.street ); // undefined</span></pre><p id="9ae9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请注意:<code class="fe kt ku kv kw b">?.</code>语法使它前面的值成为可选的，但不再是可选的。</p><p id="ecc9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如在<code class="fe kt ku kv kw b">user?.address.street.name</code>中，<code class="fe kt ku kv kw b">?.</code>允许<code class="fe kt ku kv kw b">user</code>安全地为<code class="fe kt ku kv kw b">null/undefined</code>(并在那种情况下返回<code class="fe kt ku kv kw b">undefined</code>)，但那只是针对<code class="fe kt ku kv kw b">user</code>。以常规方式访问更多的属性。如果我们希望其中一些是可选的，那么我们需要用<code class="fe kt ku kv kw b">?.</code>替换更多的<code class="fe kt ku kv kw b">.</code>。</p><h1 id="e6e1" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">短路</h1><p id="ef58" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">如前所述，如果左侧部分不存在，<code class="fe kt ku kv kw b">?.</code>会立即停止(“短路”)评估。</p><p id="64e7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，如果有任何进一步的函数调用或副作用，它们不会发生。</p><p id="7389" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="36d3" class="mi ky in kw b gy mj mk l ml mm">let user = null;<br/>let x = 0;</span><span id="1593" class="mi ky in kw b gy mn mk l ml mm">user?.sayHi(x++); // no "sayHi", so the execution doesn't reach x++</span><span id="7e2c" class="mi ky in kw b gy mn mk l ml mm">alert(x); // 0, value not incremented</span></pre><h1 id="8b27" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">其他变体:？。(), ?。[]</h1><p id="0d47" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">可选链接<code class="fe kt ku kv kw b">?.</code>不是一个操作符，而是一个特殊的语法结构，它也适用于函数和方括号。</p><p id="2f05" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如，<code class="fe kt ku kv kw b">?.()</code>用来调用一个可能不存在的函数。</p><p id="85a9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在下面的代码中，我们的一些用户有<code class="fe kt ku kv kw b">admin</code>方法，而一些没有:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="e06c" class="mi ky in kw b gy mj mk l ml mm">let userAdmin = {<br/>  admin() {<br/>    alert("I am admin");<br/>  }<br/>};</span><span id="8590" class="mi ky in kw b gy mn mk l ml mm">let userGuest = {};</span><span id="dd63" class="mi ky in kw b gy mn mk l ml mm">userAdmin.admin?.(); // I am admin</span><span id="3ff5" class="mi ky in kw b gy mn mk l ml mm">userGuest.admin?.(); // nothing (no such method)</span></pre><p id="ebb5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里，在这两行中，我们首先使用点(<code class="fe kt ku kv kw b">userAdmin.admin</code>)来获取<code class="fe kt ku kv kw b">admin</code>属性，因为我们假设用户对象存在，所以读取它是安全的。</p><p id="9211" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后<code class="fe kt ku kv kw b">?.()</code>检查左边部分:如果管理功能存在，那么它就运行(对<code class="fe kt ku kv kw b">userAdmin</code>来说也是如此)。否则(对于<code class="fe kt ku kv kw b">userGuest</code>)，评估会无错误地停止。</p><p id="b925" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们想使用括号<code class="fe kt ku kv kw b">[]</code>而不是点<code class="fe kt ku kv kw b">.</code>来访问属性，那么<code class="fe kt ku kv kw b">?.[]</code>语法也是有效的。与前面的情况类似，它允许从可能不存在的对象中安全地读取属性。</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="936f" class="mi ky in kw b gy mj mk l ml mm">let key = "firstName";</span><span id="c509" class="mi ky in kw b gy mn mk l ml mm">let user1 = {<br/>  firstName: "John"<br/>};</span><span id="d2a2" class="mi ky in kw b gy mn mk l ml mm">let user2 = null;</span><span id="ab95" class="mi ky in kw b gy mn mk l ml mm">alert( user1?.[key] ); // John<br/>alert( user2?.[key] ); // undefined</span></pre><p id="e160" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">同样，我们可以将<code class="fe kt ku kv kw b">?.</code>与<code class="fe kt ku kv kw b">delete</code>一起使用:</p><pre class="ma mb mc md gt me kw mf mg aw mh bi"><span id="8565" class="mi ky in kw b gy mj mk l ml mm">delete user?.name; // delete user.name if user exists</span></pre><h1 id="afd2" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">摘要</h1><p id="ac38" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">可选链接<code class="fe kt ku kv kw b">?.</code>语法有三种形式:</p><ol class=""><li id="04b7" class="mo mp in jx b jy jz kc kd kg mq kk mr ko ms ks nc mu mv mw bi translated"><code class="fe kt ku kv kw b">obj?.prop</code>–如果<code class="fe kt ku kv kw b">obj</code>存在，则返回<code class="fe kt ku kv kw b">obj.prop</code>，否则返回<code class="fe kt ku kv kw b">undefined</code>。</li><li id="6586" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks nc mu mv mw bi translated"><code class="fe kt ku kv kw b">obj?.[prop]</code>–如果<code class="fe kt ku kv kw b">obj</code>存在，则返回<code class="fe kt ku kv kw b">obj[prop]</code>，否则返回<code class="fe kt ku kv kw b">undefined</code>。</li><li id="9f3d" class="mo mp in jx b jy mx kc my kg mz kk na ko nb ks nc mu mv mw bi translated"><code class="fe kt ku kv kw b">obj.method?.()</code>–如果<code class="fe kt ku kv kw b">obj.method</code>存在，则调用<code class="fe kt ku kv kw b">obj.method()</code>，否则返回<code class="fe kt ku kv kw b">undefined</code>。</li></ol><p id="fb41" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如我们所看到的，它们都简单明了，易于使用。<code class="fe kt ku kv kw b">?.</code>检查<code class="fe kt ku kv kw b">null/undefined</code>的左侧部分，如果不是，则允许评估继续进行。</p><p id="e613" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一系列的<code class="fe kt ku kv kw b">?.</code>允许你安全地访问嵌套的属性。</p><p id="a1c7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">尽管如此，我们应该小心地应用<code class="fe kt ku kv kw b">?.</code>,只有在左边部分不存在是可以接受的情况下，这样如果出现编程错误，它不会对我们隐藏。</p></div><div class="ab cl nd ne hr nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="ig ih ii ij ik"><p id="5433" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">希望你喜欢这篇文章。</p><h2 id="dff4" class="mi ky in bd kz nk nl dn ld nm nn dp lh kg no np ll kk nq nr lp ko ns nt lt nu bi translated">表现出一些爱</h2><p id="1651" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg lx ki kj kk ly km kn ko lz kq kr ks ig bi translated">地址:<strong class="jx io">0x 27180 EB 5f 52 D2 AAAA 5d 268 a1 b5 c 910 FD 9 DFC 7 df 4</strong></p><p id="f4c4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="nv">更多内容请看</em><a class="ae nw" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="nv">plain English . io</em></strong></a></p></div></div>    
</body>
</html>