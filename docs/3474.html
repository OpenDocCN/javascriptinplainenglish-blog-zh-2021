<html>
<head>
<title>I Cloned the Instagram Search Field using React (And What I Learned Along the Way)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我用React克隆了Instagram搜索栏(以及我一路走来学到的东西)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/cloning-the-instagram-search-field-d3bc6ba4643?source=collection_archive---------14-----------------------#2021-07-13">https://javascript.plainenglish.io/cloning-the-instagram-search-field-d3bc6ba4643?source=collection_archive---------14-----------------------#2021-07-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="fd27" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">模仿、吸收、创新</h2><div class=""/><div class=""><h2 id="bc76" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">useRef、onClick事件等等</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/64eb5a52c728d40e783dca71393c528c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-sZbRlMsaTJzAnS7lQwaA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@cheaousa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ousa Chea</a> on <a class="ae lb" href="https://unsplash.com/s/photos/microscope?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d6e3" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">虽然我已经转向了其他的追求，但我在学习音乐时积累的知识和智慧将永远伴随着我。伟大的克拉克·特里曾说过这样一句至理名言:“模仿。同化。创新。”克拉克·特里绝对是音乐家中的巨人，他是小号和短号的专家，曾与贝西伯爵、艾灵顿公爵、艾拉·费兹杰拉、塞隆尼斯·蒙克、迪兹·吉莱斯皮、雷·查尔斯、昆西·琼斯等许多人合作过。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Clark Terry in his own words</figcaption></figure><p id="fc2d" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这句口头禅——模仿、吸收、创新——在我的音乐生涯中被证明是一个非常好的指导原则，直到今天仍在发挥作用。这很简单，却非常有效。如果你不确定该做什么，如果你刚刚开始，<em class="ly">继续，复制一个以前已经有过的人</em>。利用他们的专业知识，把它变成你自己的，并把它作为你自己创造性探索的跳板。</p><p id="18ff" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">本着这种精神，我最近一直在努力打造一个Instagram克隆版。使用React作为我的框架，我一直在梳理HTML和CSS，并努力模仿桌面网站上的行为。在过去的一周里，我复制了Instagram的navbar搜索栏，并在这个过程中学到了不少东西。</p><h1 id="8f84" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">可交付成果</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mt ma l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Detailing the behavior of the Instagram Search Container.</figcaption></figure><p id="09d6" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">搜索域的行为可以分为四类:<strong class="le ix">默认</strong>行为、<strong class="le ix"> onClick </strong>行为、<strong class="le ix"> onBlur </strong>行为和<strong class="le ix"> X-Circle的onClick </strong>行为。</p><h2 id="b362" class="mu mc in bd md mv mw dn mh mx my dp ml ll mz na mn lp nb nc mp lt nd ne mr it bi translated">默认</h2><ul class=""><li id="6dc8" class="nf ng in le b lf nh li ni ll nj lp nk lt nl lx nm nn no np bi translated">容器有一个<code class="fe nq nr ns nt b">input</code>子元素</li><li id="a826" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">input元素的样式比navbar的<code class="fe nq nr ns nt b">background-color</code>稍暗，有一个1像素的边框和一个小的边框半径</li><li id="973b" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">有一个搜索图标和<code class="fe nq nr ns nt b">placeholder</code>文本显示，两者都居中对齐</li></ul><h2 id="cd76" class="mu mc in bd md mv mw dn mh mx my dp ml ll mz na mn lp nb nc mp lt nd ne mr it bi translated">onClick</h2><ul class=""><li id="8c09" class="nf ng in le b lf nh li ni ll nj lp nk lt nl lx nm nn no np bi translated"><code class="fe nq nr ns nt b">placeholder</code>文本和搜索图标变为左对齐</li><li id="b493" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">出现一个右对齐的X圆图标</li><li id="75dc" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">输入字段被聚焦</li><li id="a1b4" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">如果用户先前键入了查询，则选择输入值</li></ul><p id="d26e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"> onBlur </strong></p><ul class=""><li id="3b8a" class="nf ng in le b lf lg li lj ll nz lp oa lt ob lx nm nn no np bi translated"><code class="fe nq nr ns nt b">placeholder</code>文本和搜索图标返回到搜索栏的中心</li><li id="2e08" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">X圆图标将从页面中移除</li><li id="f9c6" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">任何用户输入都会被持久化，取代默认布局方案中的<code class="fe nq nr ns nt b">placeholder</code>文本。</li></ul><p id="b12a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><strong class="le ix"> X圈onClick </strong></p><ul class=""><li id="dc77" class="nf ng in le b lf lg li lj ll nz lp oa lt ob lx nm nn no np bi translated">X圆将从页面中删除</li><li id="4d11" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">任何用户输入都会被清除</li><li id="0e91" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx nm nn no np bi translated">搜索容器恢复到其原始状态和样式，在搜索字段的中间显示<code class="fe nq nr ns nt b">placeholder</code>文本和搜索图标。</li></ul><h1 id="2d95" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">查看HTML</h1><p id="76e1" class="pw-post-body-paragraph lc ld in le b lf nh jx lh li ni ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">使用Chrome的开发工具检查搜索容器将产生以下结果:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="of ma l"/></div></figure><p id="2830" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">下面是同一个HTML的注释版本，去掉了类名:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="of ma l"/></div></figure><p id="298e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">CSS没有什么太复杂的，因为它都是非常基本的。大多数元素都在使用<code class="fe nq nr ns nt b">box-sizing: border-box</code>、<a class="ae lb" href="https://medium.com/geekculture/whats-the-deal-with-box-sizing-c8840dc7da24" rel="noopener">，这导致在元素</a>的内部应用了<em class="ly">边框和填充。对于Instagram用来获得现有布局的精确样式类型，该设置是绝对必要的。</em></p><p id="768a" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我发现有趣的一件事是，当搜索字段不聚焦时，Instagram如何隐藏<code class="fe nq nr ns nt b">input</code>值。搜索图标和<code class="fe nq nr ns nt b">placeholder</code>文本包含在两个<code class="fe nq nr ns nt b">div</code>元素中。<strong class="le ix">父</strong> <code class="fe nq nr ns nt b"><strong class="le ix">div</strong></code> <strong class="le ix">具有与输入相同的高度、宽度、背景颜色、边框和边框半径，有效地完全阻止了输入。同时，子</strong> <code class="fe nq nr ns nt b"><strong class="le ix">div</strong></code> <strong class="le ix">用于将文本和搜索图标</strong> <code class="fe nq nr ns nt b"><strong class="le ix">5px</strong></code> <strong class="le ix">向左移动，使它们看起来在页面上居中</strong>。外部包装器使用<code class="fe nq nr ns nt b">position: absolute</code>将它锁定在输入前面的位置，而内部包装器使用<code class="fe nq nr ns nt b">position: relative</code>来移动与外部包装器相关的所有内容<code class="fe nq nr ns nt b">5px</code>。</p><p id="8bff" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">就我个人而言，我觉得这个方案很麻烦，对于我自己的版本，我只是根据元素是否被聚焦来切换<code class="fe nq nr ns nt b">input</code>的文本颜色以匹配背景。</p><h1 id="72ed" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">焦点中的HTML</h1><p id="d88e" class="pw-post-body-paragraph lc ld in le b lf nh jx lh li ni ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">让我们看看当输入被聚焦时搜索容器的HTML:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="of ma l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">This HTML has been “sanitized”. Most class names have been removed for ease of reading. The elements related to the suggestion card have been removed as well.</figcaption></figure><p id="9b5e" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">一旦获得焦点，图标包装就从页面中移除，两个新元素取而代之。搜索图标返回，尽管样式不同，并添加了一个新元素X-Circle。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi og"><img src="../Images/24fd13931c4c394d481fd6eba5b09264.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*cq0Jm88ioBaf4KGP58ZITA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Focused search input with padding visible.</figcaption></figure><p id="3b5b" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这两个图标使用<code class="fe nq nr ns nt b">position: absolute</code>以及<code class="fe nq nr ns nt b">left</code>、<code class="fe nq nr ns nt b">right</code>和<code class="fe nq nr ns nt b">top</code>属性将它们放在父容器中。同时，input元素占据了父容器的整个宽度和高度，但是使用了<code class="fe nq nr ns nt b">box-sizing: border-box</code>和<code class="fe nq nr ns nt b">padding</code>的组合，在两边为新图标留出空间。这一切的代码可以在下面的要点中查看。</p><h1 id="061d" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">事件处理程序</h1><p id="f0b7" class="pw-post-body-paragraph lc ld in le b lf nh jx lh li ni ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">作为参考，下面是我为了克隆Instagram的搜索容器而创建的React组件:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="of ma l"/></div></figure><p id="c720" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="ly">旁白:我正在使用样式组件库作为这个练习的一部分。到目前为止，我一直很喜欢在我的JavaScript文件中直接编辑CSS的能力！</em></p><h2 id="4a36" class="mu mc in bd md mv mw dn mh mx my dp ml ll mz na mn lp nb nc mp lt nd ne mr it bi translated">useRef</h2><p id="d6cb" class="pw-post-body-paragraph lc ld in le b lf nh jx lh li ni ka lk ll oc ln lo lp od lr ls lt oe lv lw lx ig bi translated">我通过将值存储在一个<code class="fe nq nr ns nt b">useState</code>变量中来控制<code class="fe nq nr ns nt b">input</code>和<code class="fe nq nr ns nt b">span</code>文本，并且我用另一个名为<code class="fe nq nr ns nt b">isFocused</code>的<code class="fe nq nr ns nt b">useState</code>变量在两个布局之间交替，该变量随<code class="fe nq nr ns nt b">onClick</code>和<code class="fe nq nr ns nt b">onBlur</code>事件切换。<strong class="le ix">但是因为图标包装器是在</strong><code class="fe nq nr ns nt b"><strong class="le ix">input</strong></code><strong class="le ix">元素上面的<em class="ly">，所以点击不会自动聚焦</em></strong> <code class="fe nq nr ns nt b"><strong class="le ix">input</strong></code>。</p><p id="f272" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">对于普通的JavaScript，这是一个简单的解决方法。一行包含<code class="fe nq nr ns nt b">document.querySelector("the_input_id_here").focus()</code>的代码就可以完成这个任务。但是在React中，您不能使用普通的JavaScript与DOM交互，那么您如何关注输入呢？</p><p id="e573" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">这就是<code class="fe nq nr ns nt b">useRef</code>的用武之地。我认为<code class="fe nq nr ns nt b">useRef</code>钩子允许你在变量中存储一个指向DOM元素的指针。通过初始化一个<code class="fe nq nr ns nt b">useRef</code>变量并将其传递给元素的<code class="fe nq nr ns nt b">ref</code>属性，您就能够在元素上调用普通的JavaScript函数，否则您将无法调用这些函数。<a class="ae lb" href="https://medium.com/trabe/react-useref-hook-b6c9d39e2022" rel="noopener">点击这里查看关于</a> <code class="fe nq nr ns nt b"><a class="ae lb" href="https://medium.com/trabe/react-useref-hook-b6c9d39e2022" rel="noopener">useRef</a></code> <a class="ae lb" href="https://medium.com/trabe/react-useref-hook-b6c9d39e2022" rel="noopener">钩子的更详细的解释。</a></p><h1 id="2719" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">管理点击事件</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oh ma l"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">I made this video for a StackOverflow question</figcaption></figure><p id="0602" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">我不想撒谎，我确实在这件事上浪费了一点时间。我的问题的解决方案在于点击事件序列。单击事件按以下顺序发生:</p><ol class=""><li id="4364" class="nf ng in le b lf lg li lj ll nz lp oa lt ob lx oi nn no np bi translated"><code class="fe nq nr ns nt b">mouseDown</code></li><li id="dcf2" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx oi nn no np bi translated"><code class="fe nq nr ns nt b">blur</code></li><li id="b56d" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx oi nn no np bi translated"><code class="fe nq nr ns nt b">mouseUp</code></li><li id="b094" class="nf ng in le b lf nu li nv ll nw lp nx lt ny lx oi nn no np bi translated"><code class="fe nq nr ns nt b">click</code></li></ol><p id="e88b" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">最初，我的代码将一个<code class="fe nq nr ns nt b">onClick</code>事件附加到IconWrapper，一个<code class="fe nq nr ns nt b">onBlur</code>事件附加到输入，另一个<code class="fe nq nr ns nt b">onClick</code>事件附加到X-Circle。但是由于上面的顺序，X-Circle的<code class="fe nq nr ns nt b">onClick</code>函数永远不会被调用，因为<code class="fe nq nr ns nt b">onBlur</code>函数已经从页面中移除了元素！我甚至尝试给X-Circle的<code class="fe nq nr ns nt b">onClick</code>函数添加一个<code class="fe nq nr ns nt b">e.preventDefault()</code>，但没有成功。</p><p id="e441" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">最终，有人提示我点击事件序列。如果我添加一个<code class="fe nq nr ns nt b">mouseDown</code>事件处理程序，我可以通过<code class="fe nq nr ns nt b">e.preventDefault()</code>阻止输入变模糊，并允许X-Circle的<code class="fe nq nr ns nt b">onClick</code>函数触发。最后，我成功地切换了搜索容器的状态，并管理了用户对X-Circle元素的点击。</p><h1 id="17a5" class="mb mc in bd md me mf mg mh mi mj mk ml kc mm kd mn kf mo kg mp ki mq kj mr ms bi translated">反光</h1><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="oj ma l"/></div></figure><p id="82ca" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated">事实证明，Instagram导航条中间那个简单的小搜索栏比看上去要复杂得多。我学会了如何利用<code class="fe nq nr ns nt b">useRef</code>钩子，如何使用<code class="fe nq nr ns nt b">position: absolute</code>结合<code class="fe nq nr ns nt b">top</code>、<code class="fe nq nr ns nt b">left</code>、<code class="fe nq nr ns nt b">bottom</code>和<code class="fe nq nr ns nt b">right</code>属性来调整元素的布局，我还学会了如何防止模糊事件触发。克拉克·特里的智慧是正确的。你可以从模仿前人身上学到很多东西。现在来消化这些金块，将它们吸收到我的知识体系中，也许还能创造出我自己的新的和创新的东西。</p><p id="bfd4" class="pw-post-body-paragraph lc ld in le b lf lg jx lh li lj ka lk ll lm ln lo lp lq lr ls lt lu lv lw lx ig bi translated"><em class="ly">更多内容请看</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="le ix"><em class="ly">plain English . io</em></strong></a></p></div></div>    
</body>
</html>