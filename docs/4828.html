<html>
<head>
<title>Use GitHub Actions to Deploy a Next.js SSG Site</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作部署Next.js SSG站点</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-github-actions-to-deploy-a-next-js-ssg-site-412f24c676ee?source=collection_archive---------14-----------------------#2021-09-27">https://javascript.plainenglish.io/use-github-actions-to-deploy-a-next-js-ssg-site-412f24c676ee?source=collection_archive---------14-----------------------#2021-09-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="e1a3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">自动化所有的事情！</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/e2cb160691efe1d53e9877226cf7af7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMOzefT1pXqjdcuUen_F6A.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source: <a class="ae ks" href="https://www.reddit.com/r/ProgrammerHumor/comments/f0ag3i/automation/" rel="noopener ugc nofollow" target="_blank">Reddit</a></figcaption></figure><p id="c55c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们使用Github操作为GitHub页面上托管的Next.js SSG站点创建一个基本的部署管道。</p><p id="05ab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">作为参考，这里是本文中使用的代码的<a class="ae ks" href="https://github.com/suhanw/suhanw.github.io" rel="noopener ugc nofollow" target="_blank"> Github repo </a>。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="672d" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">可选读物</h1><p id="c77c" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">本文将重点介绍如何设置GitHub操作，所以我可能会忽略我认为是辅助性的技术细节。如果你感兴趣，这里有一些背景资料:</p><ul class=""><li id="8ae6" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo my mz na nb bi translated"><a class="ae ks" href="https://nextjs.org/docs/advanced-features/static-html-export" rel="noopener ugc nofollow" target="_blank">文档</a>介绍了如何使用Next.js构建SSG站点。对于本文，AYNTK将使用<code class="fe nc nd ne nf b">next build</code>和<code class="fe nc nd ne nf b">next export</code>命令来生成静态站点的文件。</li><li id="4cb1" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated">关于如何在GitHub页面上发布静态站点的<a class="ae ks" href="https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site" rel="noopener ugc nofollow" target="_blank">文档</a>。对于本文，AYNTK将提交并推送项目根目录下的<code class="fe nc nd ne nf b">docs</code>文件夹中的构建文件来部署站点。</li><li id="4578" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated">GitHub动作管道不同组件的<a class="ae ks" href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions#the-components-of-github-actions" rel="noopener ugc nofollow" target="_blank">定义</a>。</li></ul></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="2065" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">特种宽银幕电影</h1><p id="2886" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">让我们创建一个GitHub操作管道来自动化以下步骤:</p><ol class=""><li id="9cf7" class="mt mu in kv b kw kx kz la lc mv lg mw lk mx lo nl mz na nb bi translated">查看GitHub回购</li><li id="a71d" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo nl mz na nb bi translated">设置Node.js</li><li id="173a" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo nl mz na nb bi translated">安装依赖项(如果没有更改，则使用缓存)</li><li id="a327" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo nl mz na nb bi translated">为静态站点构建文件(如果没有更改，则使用缓存)</li><li id="ac17" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo nl mz na nb bi translated">缓存依赖项和源文件</li><li id="019e" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo nl mz na nb bi translated">提交构建文件并将其推送到存储库</li></ol></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="6614" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">创建工作流</h1><p id="3e5c" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">GitHub Actions使用YAML语法来定义事件、作业和步骤。这些YAML文件存储在代码库中，在一个名为<code class="fe nc nd ne nf b">.github/workflows</code>的目录中。因此，让我们创建一个YAML文件来定义部署工作流。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nm"><img src="../Images/f4caca19c7feeafe6711fe30d1beff44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mJ7hPKDtk63IJ4AxhEeJDA.png"/></div></div></figure><p id="120a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">上面代码注释的注释:</p><p id="3f31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">【A】</strong>将提交推送到GitHub repo是触发工作流的事件。<br/><strong class="kv io">【B】</strong>将作业配置为在GitHub(又名Runner)托管的全新Ubuntu Linux虚拟机上运行。<br/><strong class="kv io">【C】</strong><a class="ae ks" href="https://github.com/actions/checkout" rel="noopener ugc nofollow" target="_blank">动作</a>检出回购并将代码下载到Runner中。<br/><strong class="kv io">【D】</strong><a class="ae ks" href="https://github.com/actions/setup-node" rel="noopener ugc nofollow" target="_blank">动作</a>在Runner中安装Node.js，并允许我们运行<code class="fe nc nd ne nf b">npm</code>命令。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="b444" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，添加在运行器中安装项目依赖项的步骤，其中包括<code class="fe nc nd ne nf b">next</code>包。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nn"><img src="../Images/4966006a5042a050506b04d78bde756f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1RCWLKTyMMJn2mdo90d9g.png"/></div></div></figure><p id="9c07" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">啊，我们的老朋友。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="3fc8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">既然已经安装了依赖项，让我们添加构建静态文件的步骤。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/9d4361c7a47d7a5f992cb3f596fe9f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7okC43VxRIy5y25Pb27tA.png"/></div></div></figure><p id="3611" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">【F】</strong>你问的<code class="fe nc nd ne nf b">build</code>是什么鬼？这是一个在<code class="fe nc nd ne nf b">package.json</code>中定义的脚本，它运行:</p><pre class="kd ke kf kg gt np nf nq nr aw ns bi"><span id="a3d0" class="nt lx in nf b gy nu nv l nw nx">next build &amp;&amp; next export -o docs</span></pre><p id="ccc3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">参见<a class="ae ks" href="https://nextjs.org/docs/advanced-features/static-html-export" rel="noopener ugc nofollow" target="_blank">文档</a>。TL；DR，这些是Next.js命令，用于构建SSG站点的文件，并将它们导出到<code class="fe nc nd ne nf b">docs</code>文件夹。</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="7077" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，添加提交步骤，并将对<code class="fe nc nd ne nf b">docs</code>文件夹的更新推送到repo。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ny"><img src="../Images/24f9977836753786a3416c4d28d4b688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qlz80uwrGNmdLaH3q3yXTw.png"/></div></div></figure><p id="b988" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">【G】</strong>这个<a class="ae ks" href="https://github.com/marketplace/actions/git-auto-commit" rel="noopener ugc nofollow" target="_blank">动作</a>将提交在Runner环境中所做的更改，并将提交推送到GitHub repo。默认提交消息将是“自动发布”。</p><p id="154c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，对回购协议进行修改会自动将我的SSG站点部署到GitHub页面。🎉</p><p id="f8d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我现在可以在我的GitHub repo 的<a class="ae ks" href="https://github.com/suhanw/suhanw.github.io/actions" rel="noopener ugc nofollow" target="_blank">操作选项卡中查看管道了。</a></p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="8764" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">贮藏</h1><p id="9f1c" class="pw-post-body-paragraph kt ku in kv b kw mo jo ky kz mp jr lb lc mq le lf lg mr li lj lk ms lm ln lo ig bi translated">我意识到每次我提交时，作业都会运行一次新的<code class="fe nc nd ne nf b">npm install</code>。所以让我们引入缓存，这样只有当<code class="fe nc nd ne nf b">package-lock.json</code>改变时才会进行全新安装。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nz"><img src="../Images/369366fe8eeab8b923c80a3e0b8c2024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyC1bedtaoXXaNlDZwarmA.png"/></div></div></figure><p id="5213" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">【H】</strong>这个<a class="ae ks" href="https://github.com/actions/cache" rel="noopener ugc nofollow" target="_blank">动作</a>跨构建缓存<code class="fe nc nd ne nf b">node_modules</code>文件夹，只要<code class="fe nc nd ne nf b">package-lock.json</code>不变，就让Runner使用缓存。</p><p id="4321" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">此外，注意到<code class="fe nc nd ne nf b">next build</code>发出了以下关于缺少缓存的警告。</p><pre class="kd ke kf kg gt np nf nq nr aw ns bi"><span id="b1d1" class="nt lx in nf b gy nu nv l nw nx">warn  - No build cache found. Please configure build caching for faster rebuilds. Read more: <a class="ae ks" href="https://err.sh/next.js/no-cache" rel="noopener ugc nofollow" target="_blank">https://err.sh/next.js/no-cache</a></span></pre><p id="198b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">警告链接到<a class="ae ks" href="https://nextjs.org/docs/messages/no-cache#github-actions" rel="noopener ugc nofollow" target="_blank">答案</a>来修复它。爱死了。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/c094573e1b01c9846c26d4670810566d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zkJYJl--5HrNQdLMlaA_ww.png"/></div></div></figure><p id="80a3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">【I】</strong>next . js将其缓存存储在<code class="fe nc nd ne nf b">.next/cache</code>目录中。这将跨版本保持缓存，以便更快地重新构建应用程序。例如，如果我只更新了我的代码库而没有更新依赖项，这避免了重新捆绑依赖项。</p><p id="1b83" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">部署时间缩短约30%！🥰</p></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><h1 id="f8d3" class="lw lx in bd ly lz ma mb mc md me mf mg jt mh ju mi jw mj jx mk jz ml ka mm mn bi translated">阅读更多</h1><ul class=""><li id="3739" class="mt mu in kv b kw mo kz mp lc oa lg ob lk oc lo my mz na nb bi translated"><a class="ae ks" href="https://www.suhanwijaya.com/posts/deploy-react-ssr-to-production" rel="noopener ugc nofollow" target="_blank">将React SSR部署到生产中</a></li><li id="b48d" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated"><a class="ae ks" href="https://www.suhanwijaya.com/posts/intro-to-react-server-side-rendering" rel="noopener ugc nofollow" target="_blank">React服务器端渲染简介</a></li><li id="488b" class="mt mu in kv b kw ng kz nh lc ni lg nj lk nk lo my mz na nb bi translated"><a class="ae ks" href="https://www.suhanwijaya.com/posts/decouple-data-from-ui-with-react-hooks" rel="noopener ugc nofollow" target="_blank">用React钩子将数据从UI解耦</a></li></ul></div><div class="ab cl lp lq hr lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ig ih ii ij ik"><p id="4cf4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">📫<em class="od">我们连线上</em><a class="ae ks" href="https://www.linkedin.com/in/suhanwijaya/" rel="noopener ugc nofollow" target="_blank"><em class="od">LinkedIn</em></a><em class="od">或者</em><a class="ae ks" href="https://twitter.com/suhanw" rel="noopener ugc nofollow" target="_blank"><em class="od">Twitter</em></a><em class="od">！</em></p><p id="0374" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="od">更多内容请看</em><a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="od">plain English . io</em></strong></a></p></div></div>    
</body>
</html>