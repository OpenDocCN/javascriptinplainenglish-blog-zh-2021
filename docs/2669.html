<html>
<head>
<title>Everything You Need to Know About Middleware in Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于Express中的中间件，您需要了解的一切</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/everything-you-need-to-know-about-middleware-in-express-e9d57ec3f578?source=collection_archive---------16-----------------------#2021-06-01">https://javascript.plainenglish.io/everything-you-need-to-know-about-middleware-in-express-e9d57ec3f578?source=collection_archive---------16-----------------------#2021-06-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="7f64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">理解什么是中间件以及为什么需要它</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/13c6c6eed6ff645b2d225f33d3e7519a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZtfgRv-pr7AmPENn"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@pakata?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pakatan Goh</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b0b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想成为node.js和express的大师，理解express中中间件的基础知识是至关重要的。不学习什么是中间件，你就阻碍了你成为一名流利的Node.js和Express开发人员的旅程。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="114b" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">了解Node.js如何处理请求</h1><p id="1779" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">为了理解express中的中间件，我们必须首先理解vanilla Node.js如何处理对服务器的请求。</p><p id="69a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在node.js中，对服务器的请求由一个处理所有对服务器的请求的函数来处理。请看下面摘自node.js网站的代码:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mm"><img src="../Images/caeff88c742b60fc14eb542aaf1e2f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VBlbi_aRULm6p2jgrvS-w.png"/></div></div></figure><p id="1354" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然这段代码可能看起来不多，但这只是为了处理两个请求<em class="mn">。</em>一个用于URL“echo”的post方法，另一个用于处理404错误。</p><p id="5f89" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在想象一下，如果我们有5个、10个甚至100个网址要处理呢？</p><p id="1cbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您能想象在一个函数中处理所有这些请求会让我们的代码变得多么臃肿和混乱吗？</p><p id="05d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是express中间件的用武之地。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="8c1c" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">Express中的中间件是什么？</h1><p id="f2f7" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">简而言之，Express中的中间件是由一系列函数组成的堆栈。</p><p id="8cd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">暂时把技术术语放在一边。express中的中间件到底是什么<em class="mn"/>？</p><p id="cbed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">express中的中间件是我们将vanilla node.js中的一个请求处理函数分解成多个按顺序发生的处理函数的一种方式。这使得我们可以编写更简洁的代码，因为我们可以根据功能将代码分成不同的函数。</p><p id="93f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，您可以让一个中间件函数处理对URL“ECHO”的POST请求，让另一个中间件函数处理对同一个URL“ECHO”的所有GET请求。</p><p id="f469" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">中间件功能不仅限于处理HTTP请求，还可以处理大量其他用例。</p><p id="ac44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，您可以创建一个记录所有请求的中间件函数和另一个为每个请求设置HTTP头的函数。但是，要真正理解中间件，还需要一个更重要的概念。<em class="mn">下一个()的概念</em></p><h1 id="675d" class="lj lk iq bd ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc ms me mf mg bi translated">Express中间件的下一步</h1><p id="0ab1" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">在标准的Express URL处理程序中，有两个回调参数req和response(在大多数教程中通常称为res和req)。</p><p id="9211" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在express中间件处理程序中，有第三个回调参数。</p><p id="1a9b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn"> next() </em>参数告诉express移动到堆栈中的下一个函数。如果不放置<em class="mn"> next() </em> express将会卡在堆栈中的第一个函数上，导致服务器出错。</p><p id="aa0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果这对你来说仍然有点困惑，不要担心。在下一节中，我们实际上将向express服务器添加中间件。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/17202def6ed88b9eea3b70bea9401804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GnymPy8skRmXH-z04x911Q.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Diagram of how MIddleware in express works. The blue boxes represent middleware handler functions</figcaption></figure><h1 id="f719" class="lj lk iq bd ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc ms me mf mg bi translated">在Express中添加中间件</h1><p id="da9f" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">为了展示如何在express中使用中间件，我将使用我在文章<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/how-to-create-a-server-in-node-js-using-express-997579e7f075">如何使用Express </a>在Node.js中创建服务器中写的代码。如果你还没有去那篇文章，并复制粘贴在底部的代码。</p><p id="264d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们只对这段代码做一个小改动。</p><p id="0d59" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将添加一个中间件函数，它记录对默认“/”URL的每个请求的HTTP状态代码。这方面的代码如下所示:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="e560" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您要将这段代码放入visual studio代码中，启动服务器，并在vs代码终端中访问<a class="ae lb" href="http://localhost:5000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000/ </a>，您应该会看到200状态代码。这只是一个小例子，但我希望您能意识到express中的强大中间件所提供的功能。</p><h1 id="5752" class="lj lk iq bd ll lm mo lo lp lq mp ls lt lu mq lw lx ly mr ma mb mc ms me mf mg bi translated">结论</h1><p id="2cf0" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">感谢您阅读完我关于<strong class="jp ir">‘关于Express中间件您需要知道的一切’的文章。</strong>我希望现在您已经对Express中的中间件有了更好的理解。祝你有美好的一天！</p><p id="7762" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mn">更多内容请看</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mn">plain English . io</em></a></p></div></div>    
</body>
</html>