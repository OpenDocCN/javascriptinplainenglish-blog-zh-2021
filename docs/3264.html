<html>
<head>
<title>JavaScript Async and Await — Your Asynchronous Buddies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Async和Await——您的异步伙伴</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-async-and-await-your-asynchronous-buddies-516fb5b1750?source=collection_archive---------7-----------------------#2021-07-03">https://javascript.plainenglish.io/javascript-async-and-await-your-asynchronous-buddies-516fb5b1750?source=collection_archive---------7-----------------------#2021-07-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/ef2015e31eac81ec9b21103b409a1c8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rdH-QCFoDElPKMzA"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@photographybyniels?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Niels Kehl</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8d33" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe ky kz la lb b">async</code>和<code class="fe ky kz la lb b">await</code>关键字帮助我们更方便地处理<a class="ae jz" href="https://jscurious.com/a-brief-guide-to-promises-in-javascript/" rel="noopener ugc nofollow" target="_blank">承诺</a>，比使用<code class="fe ky kz la lb b">then()</code>和<code class="fe ky kz la lb b">catch()</code>的常规承诺处理更具可读性。</p><p id="4ebd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看看如何使用<code class="fe ky kz la lb b">.then()</code>和<code class="fe ky kz la lb b">.catch()</code>来消费承诺。</p><pre class="lc ld le lf gt lg lb lh li aw lj bi"><span id="b342" class="lk ll in lb b gy lm ln l lo lp">let flag = true;</span><span id="e1c2" class="lk ll in lb b gy lq ln l lo lp">let promise = new Promise((resolve, reject) =&gt; {<br/>    setTimeout(() =&gt; {<br/>      if(flag) resolve('I am resolved');<br/>      else reject(new Error('I am rejected'));<br/>    }, 1000);<br/>});</span><span id="63c0" class="lk ll in lb b gy lq ln l lo lp">promise.then(res =&gt; console.log(res)).catch(err =&gt; console.log(err));<br/>// I am resolved</span></pre><p id="cf67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的承诺可以用下面这样的<code class="fe ky kz la lb b">async</code>和<code class="fe ky kz la lb b">await</code>来消费。</p><pre class="lc ld le lf gt lg lb lh li aw lj bi"><span id="d033" class="lk ll in lb b gy lm ln l lo lp">async function demo() {<br/>    let promise = new Promise((resolve, reject) =&gt; {<br/>        setTimeout(() =&gt; {<br/>            resolve('I am resolved');<br/>        }, 1000);<br/>    });<br/>    <br/>    let res = await promise;<br/>    console.log(res);  // I am resolved<br/>}</span><span id="bfea" class="lk ll in lb b gy lq ln l lo lp">demo();</span></pre><blockquote class="lr ls lt"><p id="3772" class="ka kb lu kc b kd ke kf kg kh ki kj kk lv km kn ko lw kq kr ks lx ku kv kw kx ig bi translated"><em class="in"/><code class="fe ky kz la lb b"><em class="in">await</em></code><em class="in">关键字只能在</em> <code class="fe ky kz la lb b"><em class="in">async</em></code> <em class="in">函数中使用。</em></p></blockquote><h1 id="af7f" class="ly ll in bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">异步关键字</h1><p id="5aa7" class="pw-post-body-paragraph ka kb in kc b kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt mz kv kw kx ig bi translated">如果我们在任何函数前使用<code class="fe ky kz la lb b">async</code>,那么函数将返回一个承诺。如果函数没有显式返回任何承诺，那么它将隐式地将承诺包装在返回值周围。让我们看一个例子。</p><pre class="lc ld le lf gt lg lb lh li aw lj bi"><span id="9573" class="lk ll in lb b gy lm ln l lo lp">async function greet() {<br/>    return 'Welcome';<br/>}</span><span id="cbf9" class="lk ll in lb b gy lq ln l lo lp">greet().then(res =&gt; console.log(res));<br/>// Welcome</span></pre><h1 id="d122" class="ly ll in bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">await关键字</h1><p id="fa07" class="pw-post-body-paragraph ka kb in kc b kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt mz kv kw kx ig bi translated">关键字<code class="fe ky kz la lb b">await</code>等待一个承诺，并暂停该行中的代码，直到承诺得到解决。记住await关键字应该总是在<code class="fe ky kz la lb b">async</code>函数中使用，否则它将抛出一个错误。</p><pre class="lc ld le lf gt lg lb lh li aw lj bi"><span id="cff4" class="lk ll in lb b gy lm ln l lo lp">async function foo() {<br/>    let promise = new Promise((resolve, reject) =&gt; {<br/>        setTimeout(() =&gt; {<br/>            resolve('I am resolved');<br/>        }, 1000);<br/>    });</span><span id="18e1" class="lk ll in lb b gy lq ln l lo lp">let res = await promise;<br/>    console.log(res);<br/>    console.log('end');<br/>}</span><span id="69a9" class="lk ll in lb b gy lq ln l lo lp">foo();<br/>// I am resolved<br/>// end</span></pre><p id="616f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里，代码执行在使用<code class="fe ky kz la lb b">await</code>的那一行暂停，并在承诺完成时继续执行。因此，在1秒钟后，承诺将被解决，控制台声明将被打印。</p><h1 id="0a16" class="ly ll in bd lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu bi translated">处理错误</h1><p id="2dd2" class="pw-post-body-paragraph ka kb in kc b kd mv kf kg kh mw kj kk kl mx kn ko kp my kr ks kt mz kv kw kx ig bi translated">我们可以使用<a class="ae jz" href="https://jscurious.com/javascript-error-handling-using-try-catch/" rel="noopener ugc nofollow" target="_blank"> try…catch </a>块来处理<code class="fe ky kz la lb b">async</code> / <code class="fe ky kz la lb b">await</code>中的错误。</p><pre class="lc ld le lf gt lg lb lh li aw lj bi"><span id="f691" class="lk ll in lb b gy lm ln l lo lp">async function foo() {<br/>    let promise = new Promise((resolve, reject) =&gt; {<br/>        setTimeout(() =&gt; {<br/>            reject(new Error('I am rejected'));<br/>        }, 1000);<br/>    });</span><span id="8c29" class="lk ll in lb b gy lq ln l lo lp">try {<br/>        let res = await promise;<br/>        console.log(res);<br/>    } catch (e) {<br/>        console.log(e);<br/>    }<br/>}</span><span id="4937" class="lk ll in lb b gy lq ln l lo lp">foo();<br/>// Error: I am rejected</span></pre></div><div class="ab cl na nb hr nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ig ih ii ij ik"><h1 id="414c" class="ly ll in bd lz ma nh mc md me ni mg mh mi nj mk ml mm nk mo mp mq nl ms mt mu bi translated">参考</h1><ul class=""><li id="e55a" class="nm nn in kc b kd mv kh mw kl no kp np kt nq kx nr ns nt nu bi translated"><a class="ae jz" href="https://jscurious.com/a-brief-guide-to-promises-in-javascript/" rel="noopener ugc nofollow" target="_blank">JavaScript中的承诺</a></li><li id="62df" class="nm nn in kc b kd nv kh nw kl nx kp ny kt nz kx nr ns nt nu bi translated"><a class="ae jz" href="https://jscurious.com/callback-functions-in-javascript/" rel="noopener ugc nofollow" target="_blank">JavaScript中的回调函数</a></li><li id="1ef2" class="nm nn in kc b kd nv kh nw kl nx kp ny kt nz kx nr ns nt nu bi translated"><a class="ae jz" href="https://jscurious.com/javascript-error-handling-using-try-catch/" rel="noopener ugc nofollow" target="_blank">使用try…catch的JavaScript错误处理</a></li></ul><p id="ec8a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lu">更多内容请看</em><a class="ae jz" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="lu">plain English . io</em></strong></a></p></div></div>    
</body>
</html>