<html>
<head>
<title>How to Display Contacts using FlatList in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中使用FlatList显示联系人</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-display-contacts-using-flatlist-in-react-native-a0a558602144?source=collection_archive---------1-----------------------#2021-08-13">https://javascript.plainenglish.io/how-to-display-contacts-using-flatlist-in-react-native-a0a558602144?source=collection_archive---------1-----------------------#2021-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/1ba2820af32ba898901e619d48c42847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G72tUUobAoF-uD0WhmYUCg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Contact list (<a class="ae kc" href="https://www.justinmind.com/blog/prototyping-a-mobile-contact-list-5-ui-design-tips/" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><h1 id="b49c" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">介绍</h1><p id="2f9d" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这篇文章中，我将带您了解在React本地应用程序中显示大型联系人列表的过程。有很多例子可以说明如何做到这一点，但这篇文章应该是真实应用程序场景中联系人列表非常大的完整例子。我将在这篇文章中讲述以下内容:</p><ul class=""><li id="001a" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">获取并显示设备中的所有联系人</li><li id="1884" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">使用Redux在本地缓存联系人列表</li><li id="2f29" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">使用<code class="fe mp mq mr ms b">FlatList</code>,仅加载屏幕上当前可见的元素。它允许你加载一个大的联系人列表，而不用担心性能。</li></ul><h1 id="03bc" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">先决条件</h1><p id="59b8" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在我们进入代码之前，您需要安装几个npm包，并为Android和iOS设置读取联系人权限。</p><h2 id="2072" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">安装NPM软件包</h2><p id="8489" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">安装这些用于获取联系人并将其保存在本地存储中的包。</p><pre class="nf ng nh ni gt nj ms nk nl aw nm bi"><span id="6e12" class="mt ke iq ms b gy nn no l np nq">npm install react-native-contacts react-redux redux-persist</span></pre><h2 id="4987" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">更新权限</h2><p id="bc41" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated"><strong class="ld ir">安卓</strong></p><p id="2d6c" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">更新<code class="fe mp mq mr ms b">AndroidManifest.xml</code>以添加<code class="fe mp mq mr ms b">READ_CONTACTS</code>权限。</p><pre class="nf ng nh ni gt nj ms nk nl aw nm bi"><span id="cc5c" class="mt ke iq ms b gy nn no l np nq">&lt;uses-permission android:name="android.permission.READ_CONTACTS" /&gt;</span></pre><p id="20cf" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated"><strong class="ld ir"> iOS </strong></p><p id="d6be" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">更新iOS app文件夹中的<code class="fe mp mq mr ms b">Info.plist</code>添加以下键值。</p><pre class="nf ng nh ni gt nj ms nk nl aw nm bi"><span id="0e24" class="mt ke iq ms b gy nn no l np nq">&lt;key&gt;NSContactsUsageDescription&lt;/key&gt;<br/>&lt;string&gt;This app requires access to the contact list&lt;/string&gt;</span></pre><p id="d9d9" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">在这篇文章中，我们将使用<code class="fe mp mq mr ms b">react-native-contacts</code> npm包从设备中获取联系人。有关如何配置软件包的更多详细说明，请参考他们的文档。</p><div class="nu nv gp gr nw nx"><a href="https://github.com/morenoh149/react-native-contacts" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">GitHub-morenoh 149/React-Native-Contacts:React本地联系人</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">要投稿，请阅读CONTRIBUTING.md。在stackoverflow上提问，而不是在问题跟踪器上提问。getAll是一个数据库…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol jw nx"/></div></div></a></div><h1 id="7cac" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">反应组分</h1><p id="4275" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们为联系人<code class="fe mp mq mr ms b">Avatar</code>和<code class="fe mp mq mr ms b">ListItem</code>创建单独的组件，我们将在稍后实现联系人列表页面时使用它们。</p><h2 id="90f8" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">为用户头像创建一个反应组件</h2><p id="a834" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">只需用下面的代码片段创建一个新的<code class="fe mp mq mr ms b">Avatar.js</code>文件来渲染联系人头像。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="9d02" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">为ListItem创建React组件</h2><p id="cad7" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，让我们创建一个<code class="fe mp mq mr ms b">ListItem</code>组件，它将用于呈现列表中的联系人项目。您可以修改组件以满足应用程序的要求。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="681e" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">现在，我们已经创建了助手组件，让我们在开始联系人列表页面的实际实现之前完成redux设置。</p><h1 id="4d81" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">Redux设置</h1><p id="1dff" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">联系人需要几秒钟才能从设备中获取，因此最好获取一次，将其保存在应用程序存储中，并定期同步。</p><p id="6eb4" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">为了存储联系人，我们将使用<code class="fe mp mq mr ms b">Redux</code>和<code class="fe mp mq mr ms b">Redux-persist</code>。按照以下步骤，设置redux动作，减少和存储。</p><h2 id="b086" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">创建Redux操作</h2><p id="5060" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">首先，让我们创建一个redux动作来同步联系人。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="1fc8" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">创建一个Redux Reducer</h2><p id="6e6e" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，添加一个通过更新<code class="fe mp mq mr ms b">state</code>来处理<code class="fe mp mq mr ms b">SYNC_CONTACTS</code>动作的<code class="fe mp mq mr ms b">contactsReducer</code>。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="cef6" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">根部减速器</h2><p id="0e63" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，让我们创建一个根reducer，它可以用来在应用程序中组合多个reducer。在这个示例中，我们只有一个减速器，但是将来您可能想要添加多个减速器，以便可以预先设置它。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="309e" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">Redux持久存储</h2><p id="9652" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后，创建一个<code class="fe mp mq mr ms b">store</code>和一个<code class="fe mp mq mr ms b">persistedStore</code>，它们使用我们上面创建的root reducer。我们将<code class="fe mp mq mr ms b">AsyncStorage</code>用于持久化，它将使用应用程序的本地存储来保存应用程序会话间的状态。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h1 id="9828" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">实施联系人列表页面</h1><p id="a7da" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">现在我们有了助手组件和redux设置，是时候最终实现联系人列表页面了。</p><h2 id="3cc7" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">在联系人列表页面中使用Redux</h2><p id="c968" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">让我们创建一个准系统，联系人列表类组件，用于同步和显示联系人。注意，我们使用<code class="fe mp mq mr ms b">mapStateToProps</code>和<code class="fe mp mq mr ms b">mapDispatchToProps</code>来连接Redux。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="d7eb" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">检查联系人权限</h2><p id="acca" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">接下来，让我们实现<code class="fe mp mq mr ms b">syncContacts</code>方法，它将检查权限并加载联系人。我们只需要在Android上进行明确的权限检查。iOS会自动处理它，如果尚未授予权限，会提示用户授予权限。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="8ae9" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">获取和加载联系人</h2><p id="b465" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">我们刚刚实现的<code class="fe mp mq mr ms b">syncContacts</code>方法调用<code class="fe mp mq mr ms b">loadContacts</code>方法从设备中获取联系人。</p><p id="f22f" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">我们发出一个<code class="fe mp mq mr ms b">Contacts.getAll</code>调用来获取联系人，然后整理结果，只保留相关信息。查看npm包的<a class="ae kc" href="https://github.com/morenoh149/react-native-contacts#example-contact-record" rel="noopener ugc nofollow" target="_blank">文档</a>以查看样本联系项目。</p><p id="0b6f" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">一旦获取了联系人，我们调用<code class="fe mp mq mr ms b">syncContacts</code> redux动作，这将触发reducer更新状态。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="1a7c" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">使用平面列表呈现联系人</h2><p id="5e4c" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后，让我们在UI上呈现联系人。我们将使用平面列表来显示联系人，而不是使用<code class="fe mp mq mr ms b">ScrollView</code>,因为它在处理大型列表时更有效。它支持拉刷新，滚动加载和许多其他很酷的功能，可以用来进一步定制列表。查看<a class="ae kc" href="https://reactnative.dev/docs/flatlist" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多详情。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="c24d" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">注意，我们使用了一个助手方法<code class="fe mp mq mr ms b">getAvatarInitials</code>作为联系人的占位符，它不包含缩略图。下面是该方法的代码。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><h2 id="aa5f" class="mt ke iq bd kf mu mv dn kj mw mx dp kn lm my mz kr lq na nb kv lu nc nd kz ne bi translated">在应用程序中使用持久存储</h2><p id="bd64" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">最后，让我们在<code class="fe mp mq mr ms b">App.js</code>文件中连接持久存储，并在其中呈现<code class="fe mp mq mr ms b">ContactList</code>组件。</p><figure class="nf ng nh ni gt jr"><div class="bz fp l di"><div class="om on l"/></div></figure><p id="8344" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">注意:</p><ul class=""><li id="15c5" class="lz ma iq ld b le mb li mc lm md lq me lu mf ly mg mh mi mj bi translated">我们将<code class="fe mp mq mr ms b">react-navigation</code>和<code class="fe mp mq mr ms b">react-native-paper</code>一起用于导航和应用程序栏，但它是完全可选的。如果你对集成这些库感兴趣，可以看看这个教程。</li><li id="3a63" class="lz ma iq ld b le mk li ml lm mm lq mn lu mo ly mg mh mi mj bi translated">我们将<code class="fe mp mq mr ms b">persistor</code>传递给<code class="fe mp mq mr ms b">PersistGate</code>，它将为我们连接持久存储。</li></ul><p id="b8a3" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">就是这样。运行应用程序，看看神奇！联系人列表应该显示在你的应用程序中，它应该工作得相当顺利。<code class="fe mp mq mr ms b">ListItem</code>组件可以随意定制。这里有一个这样的定制截图。</p><figure class="nf ng nh ni gt jr gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/83ac9a57245e382fa6e0739cc63715c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*SPWAVwrufKrplLqbGo6xoA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Contact List using React Native</figcaption></figure><h1 id="397c" class="kd ke iq bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">结论</h1><p id="7ee2" class="pw-post-body-paragraph lb lc iq ld b le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly ij bi translated">在这篇文章中，我们学习了如何在react-native应用程序中显示一个大的联系人列表，并在本地缓存条目以实现快速重载。Github上有完整的源代码可供参考。感觉感觉分叉/克隆应用程序以获得一个工作解决方案，您可以使用它作为您的应用程序的入门模板。</p><div class="nu nv gp gr nw nx"><a href="https://github.com/bakshiutkarsha/react-contacts-flat-list" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd ir gy z fp oc fr fs od fu fw ip bi translated">GitHub-bakshiutkarsha/react-联系人-平面列表</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">在GitHub上创建一个帐户，为bakshiutkarsha/react-contacts-flat-list开发做出贡献。</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="op l oi oj ok og ol jw nx"/></div></div></a></div><p id="ddb7" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">考虑成为中级会员<a class="ae kc" href="https://utkarshabakshi.medium.com/membership" rel="noopener">继续阅读我所有的优质文章以及数千篇其他故事。</a></p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="9391" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated">你可以在这个<a class="ae kc" href="https://utkarshabakshi.medium.com/list/react-native-development-0d5f690f6585" rel="noopener">列表</a>中找到我关于React Native development的其他文章。</p></div><div class="ab cl oq or hu os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="ij ik il im in"><p id="574c" class="pw-post-body-paragraph lb lc iq ld b le mb lg lh li mc lk ll lm nr lo lp lq ns ls lt lu nt lw lx ly ij bi translated"><em class="ox">更多内容看</em> <a class="ae kc" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ir"> <em class="ox">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>