<html>
<head>
<title>Vue Konva — Saving and Loading Canvas and Transform Shapes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue Konva —保存和加载画布和变换形状</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/vue-konva-saving-and-loading-canvas-and-transform-shapes-79e7ec7f9d4c?source=collection_archive---------13-----------------------#2021-01-30">https://javascript.plainenglish.io/vue-konva-saving-and-loading-canvas-and-transform-shapes-79e7ec7f9d4c?source=collection_archive---------13-----------------------#2021-01-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8d9f63f0617b62b6aea7299e07ed27d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gDjkOiQtNjM4Re92"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@ajk_th?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Kovacs</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9671" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">借助Vue Konva库，我们可以在Vue应用程序中更轻松地使用HTML画布。</p><p id="f6bd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Vue Konva来简化Vue应用程序中的HTML画布。</p><h1 id="d1e0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">保存和载入画布</h1><p id="e0aa" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以很容易地保存画布内容，这样当我们重新加载页面时它将被保留。</p><p id="c02b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="15f1" class="mn lc iq mj b gy mo mp l mq mr">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;a href="."&gt;Reload the page&lt;/a&gt;.<br/>    &lt;v-stage ref="stage" :config="stageSize" @click="handleClick"&gt;<br/>      &lt;v-layer ref="layer"&gt;<br/>        &lt;v-circle<br/>          v-for="item in list"<br/>          :key="item.id"<br/>          :config="{<br/>            x: item.x,<br/>            y: item.y,<br/>            radius: 50,<br/>            fill: 'green',<br/>          }"<br/>        &gt;&lt;/v-circle&gt;<br/>      &lt;/v-layer&gt;<br/>      &lt;v-layer ref="dragLayer"&gt;&lt;/v-layer&gt;<br/>    &lt;/v-stage&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="98a7" class="mn lc iq mj b gy ms mp l mq mr">&lt;script&gt;<br/>const width = window.innerWidth;<br/>const height = window.innerHeight;</span><span id="8c74" class="mn lc iq mj b gy ms mp l mq mr">export default {<br/>  data() {<br/>    return {<br/>      list: [{ x: 100, y: 100, radius: 50, fill: "blue" }],<br/>      stageSize: {<br/>        width: width,<br/>        height: height,<br/>      },<br/>    };<br/>  },<br/>  methods: {<br/>    handleClick(evt) {<br/>      const stage = evt.target.getStage();<br/>      const pos = stage.getPointerPosition();<br/>      this.list.push(pos);<br/>      this.save();<br/>    },</span><span id="b7e0" class="mn lc iq mj b gy ms mp l mq mr">    load() {<br/>      const data = localStorage.getItem("storage") || "[]";<br/>      this.list = JSON.parse(data);<br/>    },</span><span id="e2a4" class="mn lc iq mj b gy ms mp l mq mr">    save() {<br/>      localStorage.setItem("storage", JSON.stringify(this.list));<br/>    },<br/>  },<br/>  mounted() {<br/>    this.load();<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="f767" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有<code class="fe mt mu mv mj b">handleClick</code>方法，当我们点击舞台时，它会添加一个圆。</p><p id="9d72" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">list</code> reactive属性有一个要渲染的圆形列表。</p><p id="5b4d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在<code class="fe mt mu mv mj b">save</code>方法中，我们通过将<code class="fe mt mu mv mj b">list</code>值保存到本地存储中来保存画布。</p><p id="1f48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以通过解析将它载入<code class="fe mt mu mv mj b">load</code>方法。</p><p id="ae66" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">模板中的<code class="fe mt mu mv mj b">v-for</code>加载了<code class="fe mt mu mv mj b">list</code>反应属性以重新创建圆。</p><h1 id="5ffe" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">拖放</h1><p id="3e70" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Vue Konva轻松添加拖放功能。</p><p id="e05a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们所要做的就是在我们的形状中监听<code class="fe mt mu mv mj b">dragstart</code>和<code class="fe mt mu mv mj b">dragend</code>事件。</p><p id="cfde" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dd18" class="mn lc iq mj b gy mo mp l mq mr">&lt;template&gt;<br/>  &lt;v-stage ref="stage" :config="stageSize"&gt;<br/>    &lt;v-layer ref="layer"&gt;<br/>      &lt;v-circle<br/>        @dragstart="handleDragStart"<br/>        @dragend="handleDragEnd"<br/>        :config="{<br/>          x: 200,<br/>          y: 200,<br/>          radius: 70,<br/>          draggable: true,<br/>          fill: isDragging ? 'green' : 'black',<br/>        }"<br/>      /&gt;<br/>    &lt;/v-layer&gt;<br/>  &lt;/v-stage&gt;<br/>&lt;/template&gt;</span><span id="f987" class="mn lc iq mj b gy ms mp l mq mr">&lt;script&gt;<br/>const width = window.innerWidth;<br/>const height = window.innerHeight;</span><span id="d6cc" class="mn lc iq mj b gy ms mp l mq mr">export default {<br/>  data() {<br/>    return {<br/>      stageSize: {<br/>        width,<br/>        height,<br/>      },<br/>      isDragging: false,<br/>    };<br/>  },<br/>  methods: {<br/>    handleDragStart() {<br/>      this.isDragging = true;<br/>    },<br/>    handleDragEnd() {<br/>      this.isDragging = false;<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="558f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在拖动时设置了<code class="fe mt mu mv mj b">isDragging</code>反应属性。</p><p id="cf9e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这会改变填充。</p><p id="0cdd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们将<code class="fe mt mu mv mj b">draggable</code>属性设置为<code class="fe mt mu mv mj b">true</code>以使圆可拖动。</p><h1 id="fea0" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">调整形状大小</h1><p id="4129" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe mt mu mv mj b">v-transformer</code>组件轻松调整形状的大小。</p><p id="2a6a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="5dea" class="mn lc iq mj b gy mo mp l mq mr">&lt;template&gt;<br/>  &lt;v-stage<br/>    ref="stage"<br/>    :config="stageSize"<br/>    <a class="ae kc" href="http://twitter.com/mousedown" rel="noopener ugc nofollow" target="_blank">@mousedown</a>="handleStageMouseDown"<br/>    <a class="ae kc" href="http://twitter.com/touchstart" rel="noopener ugc nofollow" target="_blank">@touchstart</a>="handleStageMouseDown"<br/>  &gt;<br/>    &lt;v-layer ref="layer"&gt;<br/>      &lt;v-circle<br/>        v-for="item in circles"<br/>        :key="item.id"<br/>        :config="item"<br/>        <a class="ae kc" href="http://twitter.com/transformend" rel="noopener ugc nofollow" target="_blank">@transformend</a>="handleTransformEnd"<br/>      /&gt;<br/>      &lt;v-transformer ref="transformer" /&gt;<br/>    &lt;/v-layer&gt;<br/>  &lt;/v-stage&gt;<br/>&lt;/template&gt;</span><span id="c03d" class="mn lc iq mj b gy ms mp l mq mr">&lt;script&gt;<br/>import Konva from "konva";<br/>const width = window.innerWidth;<br/>const height = window.innerHeight;</span><span id="3cb7" class="mn lc iq mj b gy ms mp l mq mr">export default {<br/>  data() {<br/>    return {<br/>      stageSize: {<br/>        width: width,<br/>        height: height,<br/>      },<br/>      circles: [<br/>        {<br/>          rotation: 0,<br/>          x: 60,<br/>          y: 60,<br/>          width: 100,<br/>          height: 100,<br/>          scaleX: 1,<br/>          scaleY: 1,<br/>          fill: "red",<br/>          name: "circ1",<br/>          draggable: true,<br/>        },<br/>        {<br/>          rotation: 0,<br/>          x: 150,<br/>          y: 150,<br/>          width: 100,<br/>          height: 100,<br/>          scaleX: 1,<br/>          scaleY: 1,<br/>          fill: "green",<br/>          name: "circ2",<br/>          draggable: true,<br/>        },<br/>      ],<br/>      selectedShapeName: "",<br/>    };<br/>  },<br/>  methods: {<br/>    handleTransformEnd(e) {<br/>      const rect = this.circles.find((r) =&gt; r.name === this.selectedShapeName);<br/>      rect.x = e.target.x();<br/>      rect.y = e.target.y();<br/>      rect.rotation = e.target.rotation();<br/>      rect.scaleX = e.target.scaleX();<br/>      rect.scaleY = e.target.scaleY();<br/>      rect.fill = Konva.Util.getRandomColor();<br/>    },<br/>    handleStageMouseDown(e) {<br/>      if (e.target === e.target.getStage()) {<br/>        this.selectedShapeName = "";<br/>        this.updateTransformer();<br/>        return;<br/>      }</span><span id="751f" class="mn lc iq mj b gy ms mp l mq mr">const clickedOnTransformer =<br/>        e.target.getParent().className === "Transformer";<br/>      if (clickedOnTransformer) {<br/>        return;<br/>      }<br/>      const name = e.target.name();<br/>      const rect = this.circles.find((r) =&gt; r.name === name);<br/>      if (rect) {<br/>        this.selectedShapeName = name;<br/>      } else {<br/>        this.selectedShapeName = "";<br/>      }<br/>      this.updateTransformer();<br/>    },<br/>    updateTransformer() {<br/>      const transformerNode = this.$refs.transformer.getNode();<br/>      const stage = transformerNode.getStage();<br/>      const { selectedShapeName } = this;</span><span id="4716" class="mn lc iq mj b gy ms mp l mq mr">      const selectedNode = stage.findOne(`.${selectedShapeName}`);<br/>      if (selectedNode === transformerNode.node()) {<br/>        return;<br/>      }</span><span id="aedf" class="mn lc iq mj b gy ms mp l mq mr">      if (selectedNode) {<br/>        transformerNode.nodes([selectedNode]);<br/>      } else {<br/>        transformerNode.nodes([]);<br/>      }<br/>      transformerNode.getLayer().batchDraw();<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="8853" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe mt mu mv mj b">mousedown</code>处理程序开始，当我们单击形状时，它被调用。</p><p id="ce2d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">handleStageMouseDown</code>方法是<code class="fe mt mu mv mj b">mousedown</code>处理程序。</p><p id="6a42" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">getStage</code>方法得到状态。</p><p id="1396" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们找到了阶段，那么我们调用<code class="fe mt mu mv mj b">updateTransformer</code>来删除任何选择</p><p id="e0de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在那之后，我们得到了州名。</p><p id="91dd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">updateTransformer</code>来选择形状。</p><p id="2dd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们拖动手柄时，就会调用<code class="fe mt mu mv mj b">handleTransformEnd</code>方法。</p><p id="a8fd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们从<code class="fe mt mu mv mj b">e</code>参数中获取所有事件数据，并更新通过名称找到的对象。</p><h1 id="8102" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="f10e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以保存和加载画布，并用Vue Konva变换形状。</p></div></div>    
</body>
</html>