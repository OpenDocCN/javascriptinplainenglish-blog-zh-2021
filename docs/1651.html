<html>
<head>
<title>Using GraphQL Code Generator with Apollo-Server and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将GraphQL代码生成器与Apollo-Server和TypeScript一起使用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-graphql-code-generator-with-apollo-server-and-typescript-37e4201015d1?source=collection_archive---------7-----------------------#2021-04-09">https://javascript.plainenglish.io/using-graphql-code-generator-with-apollo-server-and-typescript-37e4201015d1?source=collection_archive---------7-----------------------#2021-04-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="a1d0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GraphQL代码生成器可以改变您编写GraphQL代码的方式。让我们通过在Apollo中设置一个基于TypeScript的GraphQL服务器来看看使用它是多么容易。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/ff0b3e294174db6bb9cebb0827362974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*DMAJtQPZIRbK64Bfc7ZvaA.png"/></div></figure><p id="cf8c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">GraphQL代码生成器是编写基于GraphQL的代码(包括服务器端和客户端)的真正游戏规则改变者。在本文中，我们将学习如何在Apollo中利用GraphQL代码生成器。在本文中，我们将通过为我们的解析器生成类型来使用它，使我们能够以最小的努力编写类型安全的解析器。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="6512" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">让我们建立我们的项目</h1><p id="dc90" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">我们需要做的第一件事是建立一个新的节点项目。继续操作，打开终端/命令提示符(取决于操作系统)并导航到您希望项目存在的位置。运行以下命令为您的项目创建一个新文件夹。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="c2be" class="mf ky in mb b gy mg mh l mi mj">mkdir code-gen-tutorial</span></pre><p id="a4b1" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">之后，继续前进并导航到新文件夹。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="5cae" class="mf ky in mb b gy mg mh l mi mj">cd code-gen-tutorial</span></pre><p id="9fc5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦进入我们的文件夹，我们将初始化一个新项目。(我将使用npm命令，但是如果您愿意，可以随意使用yarn)。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="0223" class="mf ky in mb b gy mg mh l mi mj">npm init -y</span></pre><p id="bf49" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们的项目已经初始化，是时候安装我们需要的包了。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="fcf3" class="mf ky in mb b gy mg mh l mi mj">npm install graphql apollo-server</span></pre><p id="529f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要安装一些开发依赖。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="f98f" class="mf ky in mb b gy mg mh l mi mj">npm install --save-dev @graphql-codegen/cli ts-node-dev typescript</span></pre><p id="63e7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随着我们的项目设置和包的安装，现在是时候设置GraphQL代码生成器了。</p><p id="955f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将不得不运行下面的命令，并为它选择一些预置。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="80eb" class="mf ky in mb b gy mg mh l mi mj">npx graphql-codegen init</span></pre><p id="c22f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要确保选择以下预设。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/dec4218811416c297f5e67f6e61059ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SsZUHdo1UGycsdbSJuddeQ.png"/></div></div></figure><p id="b1c0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">运行该命令后，我们现在必须运行install命令来安装添加到package.json文件中的附加包。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="58a2" class="mf ky in mb b gy mg mh l mi mj">npm install</span></pre><p id="066d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这些设置步骤已经完成，现在是时候在您选择的代码编辑器中打开我们的项目了。我将使用VS代码，但是任何支持TypeScript/JavaScript的代码编辑器都可以。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="4d3a" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">让我们开始编码吧</h1><p id="9d44" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">我们将向项目的根目录添加三个文件。第一个称为<strong class="jm io"> app.ts </strong>，这是我们的服务器将被创建和运行的地方。第二个名为<strong class="jm io"> typeDefs.ts </strong>，代码生成器将使用这个文件根据其中的模式生成TypeScript类型。第三个文件叫做<strong class="jm io"> resolvers.ts </strong>，这是我们的GraphQL服务器的解析器所在的地方。下面是迄今为止我们的项目结构应该是什么样子的截图。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/bf036ece77ff517dbb734989a20544bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*fqzwFsPSBEm5CVzKOR9Miw.png"/></div></figure><h2 id="c3fc" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">添加运行代码的脚本</h2><p id="df4c" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在我们的项目中，我们首先要从<strong class="jm io"> package.json </strong>文件开始。我们将添加一个利用<em class="nb"> ts-node-dev </em>的脚本，这是我们之前安装的包之一。本质上，它所做的是为TypeScript项目创建一个热重装开发服务器。下面是我们在第7 行添加了<em class="nb"> dev </em>脚本后的<strong class="jm io"> package.json </strong>文件的样子。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><h2 id="980e" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">设置Apollo服务器</h2><p id="1620" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">既然我们已经添加了运行服务器的脚本，那么我们需要一个服务器来运行也就说得通了。幸运的是，<em class="nb"> Apollo-Server </em>让这个过程变得非常简单。我们将把下面的代码添加到我们的<strong class="jm io"> app.ts </strong>文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="4c57" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是我们的<strong class="jm io"> app.ts </strong>文件所需的全部代码。当然，我们还不能运行，因为<strong class="jm io">行3 </strong>上的typeDefs和resolvers还没有定义。这就是我们接下来要做的，我们将看到GraphQL代码生成器的神奇之处。</p><h2 id="8896" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">为GraphQL代码生成器创建模式</h2><p id="20f2" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">为了简单起见，我们将创建一个超级基本模式。我将制作一个模式，返回一个假的待办事项列表。下面是我的模式的代码看起来会是什么样子，但请随意试验。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="db47" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">有了我们的模式，是时候进入GraphQL代码生成器发挥其魔力的部分了。</p><h2 id="6cfa" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">使用GraphQL代码生成器</h2><p id="109c" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在我们生成文件之前，我们需要对<strong class="jm io"> codegen.yml </strong>文件做一些小的修改。我将删除显示(<strong class="jm io"> documents: null </strong>)的行，因为我们在这个项目中没有任何需要查看的文档。此外，我将添加一个配置选项，在使用Apollo-Server时需要该选项来正确生成类型(我们需要将<em class="nb"> useIndexSignature </em>设置为true)。下面是<strong class="jm io"> codegen.yml </strong>文件的代码。</p><p id="8cbe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nb">请注意，对于YAML文件，空白非常重要。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="96a4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们的配置文件已经修改为可以与Apollo-Server一起工作，是时候生成我们的TypeScript类型了。为此，我们只需运行以下命令。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="623d" class="mf ky in mb b gy mg mh l mi mj">npm run generate</span></pre><p id="403c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果一切顺利，我们应该会看到在项目的根目录下生成一个名为<strong class="jm io"> graphql.ts </strong>的新文件。这个文件将为我们的解析器提供所有类型，允许我们基于我们的GraphQL模式编写类型安全的解析器。它应该看起来像下面的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="729f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在已经为解析器生成了类型，我们只剩下最后一件事要做了。</p><h2 id="45b0" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">为我们的GraphQL服务器创建解析器</h2><p id="a311" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">感谢我们刚刚使用GraphQL代码生成器所做的事情，它将使我们的代码更不容易出错，并且由于我们的代码编辑器的自动完成和错误检查，确实更容易编写。下面是我们的解析器的代码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="1622" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<strong class="jm io">第3行，</strong>你会注意到我们将解析器的类型设置为<em class="nb">解析器</em>。这个类型来自我们生成的名为<strong class="jm io"> graphql.ts </strong>的类型文件。在这里将我们的类型设置为<em class="nb">解析器</em>将确保我们的解析器必须按照我们在模式中描述的方式来构造。如果我们不这样做，TypeScript将抛出错误，这正是我们想要的。</p><p id="ebbb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">下面是代码编辑器中自动完成和错误检查的演示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/f70f8c790735be406ac3b6494525f5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*AQIA2TX7IkZh19vLQ5MWdw.gif"/></div></figure><p id="14c4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">由于GraphQL代码生成器的帮助，我们现在已经成功地创建了解析器，只剩下最后一步了。</p><h2 id="2e46" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">启动我们的GraphQL服务器</h2><p id="319b" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">随着我们的<em class="nb">解析器</em>和<em class="nb">类型定义</em>现在被定义在单独的文件中，代码中唯一要做的事情就是将它们放入我们的<strong class="jm io"> app.ts </strong>，如下面的代码所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="27a7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">仅此而已。我们现在有了一个工作的GraphQL服务器。现在剩下要做的就是在命令行中运行下面的命令，然后在web浏览器中导航到<a class="ae nf" href="http://localhost:4000" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">http://localhost:4000</strong></a>来启动它。</p><pre class="kj kk kl km gt ma mb mc md aw me bi"><span id="e84e" class="mf ky in mb b gy mg mh l mi mj">npm run dev</span></pre><p id="bdc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">导航到您的服务器后，您应该能够查询我们的假待办事项列表，如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ng"><img src="../Images/2fcfeb37d1c4423164d7a9ad135c80a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVgcxYy4d-lSDII5dLel_A.png"/></div></div></figure></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h1 id="0357" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">结论</h1><p id="a13b" class="pw-post-body-paragraph jk jl in jm b jn lv jp jq jr lw jt ju jv lx jx jy jz ly kb kc kd lz kf kg kh ig bi translated">在编写API时，GraphQL是一个有利的工具。当在TypeScript中使用它时，编写起来可能会令人生畏或单调乏味，因为必须编写大量额外的代码(样板文件)，但多亏了GraphQL Code Generator这样的工具，编写所有这些额外的代码已经成为过去。</p><p id="5b80" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我希望你喜欢这个小教程，并希望听到你的意见。我很乐意在这方面做更多的教程，这样我们可以使用GraphQL做更深入的项目。</p></div><div class="ab cl kq kr hr ks" role="separator"><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv kw"/><span class="kt bw bk ku kv"/></div><div class="ig ih ii ij ik"><h2 id="08da" class="mf ky in bd kz mq mr dn ld ms mt dp lh jv mu mv ll jz mw mx lp kd my mz lt na bi translated">参考</h2><div class="nh ni gp gr nj nk"><a href="https://www.apollographql.com/docs/apollo-server/" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">阿波罗服务器简介</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">Apollo Server是一个开源的、符合规范的GraphQL服务器，它与任何GraphQL客户端兼容，包括…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.apollographql.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ko nk"/></div></div></a></div><div class="nh ni gp gr nj nk"><a href="https://www.graphql-code-generator.com/docs/getting-started/index" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">什么是GraphQL代码生成器？GraphQL代码生成器</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">GraphQL代码生成器是一个CLI工具，它可以从GraphQL模式中生成类型脚本类型。当我们开发一个…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.graphql-code-generator.com</p></div></div></div></a></div><div class="nh ni gp gr nj nk"><a href="https://www.graphql-code-generator.com/docs/plugins/typescript-resolvers#integration-with-apollo-server" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab fo"><div class="nm ab nn cl cj no"><h2 class="bd io gy z fp np fr fs nq fu fw im bi translated">类型脚本解析器| GraphQL代码生成器</h2><div class="nr l"><h3 class="bd b gy z fp np fr fs nq fu fw dk translated">这个插件为GraphQL API的解析函数生成类型脚本签名。你可以使用这个插件来…</h3></div><div class="ns l"><p class="bd b dl z fp np fr fs nq fu fw dk translated">www.graphql-code-generator.com</p></div></div></div></a></div><p id="6ecd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="nb">更多内容请看</em><a class="ae nf" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="nb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>