<html>
<head>
<title>Build a Snippets App with Next.js, FaunaDB, Tailwind CSS &amp; Auth0</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Next.js、FaunaDB、Tailwind CSS和Auth0构建Snippets应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-snippets-app-with-nextjs-faunadb-tailwind-css-auth0-413c52273ba9?source=collection_archive---------3-----------------------#2021-05-05">https://javascript.plainenglish.io/build-a-snippets-app-with-nextjs-faunadb-tailwind-css-auth0-413c52273ba9?source=collection_archive---------3-----------------------#2021-05-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/02f1c14a2d819a8f72236fa5e87600b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*42tQsrtP5TpiN3tIrwkGQg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">FaunaDB</figcaption></figure><p id="960a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这篇文章中，我们将在Next.js中构建一个Snippet应用程序。我们将存储和检索来自FaunaDB的数据，并在项目中使用Tailwind CSS。我们还将在项目中使用Auth0的强大认证服务</p><p id="f2c0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，打开您的终端，使用下面的命令创建一个新的Next.js应用程序。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8ad5" class="lg lh in lc b gy li lj l lk ll">npx create-next-app snippet-app-nextjs</span></pre><p id="43e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，按照说明，切换到新创建的文件夹。我也用VS代码打开了这个项目。之后，运行<code class="fe lm ln lo lc b"><strong class="kb io">npm run dev</strong></code>启动项目。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lp"><img src="../Images/ba02446c9ee8c039b43693d4e14ae1b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l04CJ9Xt6GCIiJJeG7esug.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">config</figcaption></figure><p id="df43" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是在继续之前，我们将由npm安装所需的软件包。这里，我们为数据库安装了FaunaDB，为表单验证安装了react-hook-form，为实时获取数据安装了SWR。你可以在这里阅读更多关于SWR的信息。</p><p id="8e28" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，打开您的终端并安装软件包。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="0cea" class="lg lh in lc b gy li lj l lk ll">npm i faunadb react-hook-form swr</span></pre><p id="350d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们还将在项目中设置Tailwind CSS。因此，打开终端并安装下面的依赖项。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="3e0e" class="lg lh in lc b gy li lj l lk ll">npm install --save-dev tailwindcss postcss-preset-env postcss</span></pre><p id="7873" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下面是初始化Tailwind运行的下一个命令。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="7266" class="lg lh in lc b gy li lj l lk ll">npx tailwindcss init</span></pre><p id="5863" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">它会在我们的根目录下创建一个<strong class="kb io"> tailwind.config.js </strong>文件。之后，在根目录下创建一个<strong class="kb io"> postcss.config.js </strong>文件，并添加以下代码。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="8a84" class="lg lh in lc b gy li lj l lk ll">module.exports = {<br/>    plugins: ['tailwindcss', 'postcss-preset-env'],<br/>}</span></pre><p id="c41a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">最后，我们需要转到<strong class="kb io"> styles </strong>文件夹中的<strong class="kb io"> globals.css </strong>文件，删除所有内容，并为tailwind添加以下内容。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2156" class="lg lh in lc b gy li lj l lk ll">@tailwind base;<br/>@tailwind components;<br/>@tailwind utilities;</span><span id="eeb6" class="lg lh in lc b gy lr lj l lk ll">body {<br/>    margin: 0;<br/>    padding: 0;<br/>}</span></pre><p id="57fb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">之后，更新<strong class="kb io">页面</strong>文件夹中的<strong class="kb io"> _app.js </strong>文件，如下所示。这里，我们使用了所有的顺风CSS元素。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="2071" class="lg lh in lc b gy li lj l lk ll">import '../styles/globals.css'</span><span id="51e3" class="lg lh in lc b gy lr lj l lk ll">function MyApp({ Component, pageProps }) {<br/>  return (<br/>    &lt;div className="bg-yellow-600 w-full p-10 min-h-screen"&gt;<br/>        &lt;div className="max-w-2xl mx-auto"&gt;<br/>            &lt;Component {...pageProps} /&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span><span id="4d2a" class="lg lh in lc b gy lr lj l lk ll">export default MyApp</span></pre><p id="d07c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，也删除<strong class="kb io"> pages </strong>文件夹中<strong class="kb io"> index.js </strong>中的所有内容，并更新为以下内容。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f398" class="lg lh in lc b gy li lj l lk ll">import Head from 'next/head'<br/>import Link from 'next/link';</span><span id="7ed9" class="lg lh in lc b gy lr lj l lk ll">export default function Home() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Head&gt;<br/>        &lt;title&gt;Snippet App&lt;/title&gt;<br/>        &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>      &lt;/Head&gt;<br/>      &lt;main&gt;<br/>        &lt;div className="my-12"&gt;<br/>          &lt;h1 className="text-red-100 text-2xl"&gt;<br/>            TheWebDev Code Snippets<br/>          &lt;/h1&gt;<br/>          &lt;p className="text-red-200"&gt;<br/>            Create and browse snippets in Web Development!<br/>          &lt;/p&gt;<br/>          &lt;Link href="/new"&gt;<br/>            &lt;a className="mt-3 inline-block bg-yellow-800 hover:bg-yellow-900 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"&gt;<br/>              Create a Snippet!<br/>            &lt;/a&gt;<br/>          &lt;/Link&gt;<br/>        &lt;/div&gt;<br/>      &lt;/main&gt;<br/>    &lt;/div&gt;<br/>  )<br/>}</span></pre><p id="3616" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们现在将在本地主机中看到这个漂亮的页面，带有一个按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ls"><img src="../Images/f727b80e52a39494f5e5abc6a1422e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qp9ceJeGWyxImeO76LMRbw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">localhost</figcaption></figure><p id="55a3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在前进之前，我们将建立FaunaDB。所以，去fauna.com报名吧。注册后，您将被带到这个屏幕，在这里您需要点击<strong class="kb io">新建数据库</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lt"><img src="../Images/28a69624c4089e9f1b9dad2f0ccb9507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nEveYpj2bpuonVAaYNzcuw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Database</figcaption></figure><p id="2fd9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，我们需要给数据库一个名称。我将它命名为<strong class="kb io">片段-应用程序-动物群</strong>。之后，点击保存按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/1800a3687c14ca6ddaf7862e4f2df858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*abjtKhvXisTxFAk_DrJnzg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Database name</figcaption></figure><p id="6beb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一个屏幕上，点击<strong class="kb io">新收藏</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/19daa2c373a4cfa13626a106f7a4696a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*alvqmEjc1j93otnXlHvt9Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">New Collection</figcaption></figure><p id="2165" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这里，我将集合名称命名为<strong class="kb io">片段</strong>，并点击<strong class="kb io">保存</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/c7ef7586498501f984bfa45c48dc6551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9RCZD8jrFLgtfE_NNeQ6A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">snippets</figcaption></figure><p id="8a54" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将首先从数据库创建一个文档，然后将逻辑移到前端。所以，点击<strong class="kb io">新建文档</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/8ba5e607e0416d3c01322da1fc579741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOfacF0zTf4uv-nVsjKULg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">New Document</figcaption></figure><p id="1074" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一个窗口中，我们将有一个编辑器，在这里我们将以JSON格式给出数据。稍后，我们将从前端发送这些数据。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/9845282607076190c00221067d979e58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L-ree3eB0rglsitrV5ijlg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Editor</figcaption></figure><p id="e2b4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，在Collection -&gt; Snippet中，我们可以看到我们的文档。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/7255cc06fa9e2a260117ccb75146069c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frib-Q_vGRH25FkiwfJCpw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Document</figcaption></figure><p id="56eb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来我们需要设置API键。所以，点击<strong class="kb io">安全</strong>标签，然后点击<strong class="kb io">新钥匙</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/8582ec6f3a101e78519849284778540b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJhS2qvEJSQ3cBcnEbhaQw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">NEW KEY</figcaption></figure><p id="70fb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一个屏幕中，从角色下拉列表中，单击<strong class="kb io">服务器</strong>，然后命名为<strong class="kb io"> snippet_app_key </strong>。然后点击<strong class="kb io">保存</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/9a0d11809b18c374994dd6c87b62ed5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxfljvcwtI4aoEbyqjEYOA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">snippet key</figcaption></figure><p id="15f1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下一个屏幕将给出我们需要复制的API密钥，因为它不会再次显示。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lx"><img src="../Images/7dac3d82a8dde4d2540b76ed959bd0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*njbcLjKocJWi6QMC1ih-xw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Secret Key</figcaption></figure><p id="1924" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，回到我们的代码中，在根目录中创建一个文件. env.local，并将密钥添加到变量FAUNA_SECRET中。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/651f14d42f4c66679b66856112d4a198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-cqRmhLqvC3EqfDO7Eh2Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">.env.local</figcaption></figure><p id="0fd0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在将我们的FaunaDB连接到前端代码之前，我们将添加文件来显示它。</p><p id="1913" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在根目录下创建一个<strong class="kb io"> components </strong>文件夹，并在其中创建一个文件<strong class="kb io"> Snippet.js </strong>。把下面的内容放进去。</p><p id="f4fe" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在这里，我们将获得片段道具，其中我们将显示名称、语言和描述。我们将代码传递给另一个组件<strong class="kb io">代码</strong>。</p><p id="b7b5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们还展示了一个编辑和删除按钮。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="7385" class="lg lh in lc b gy li lj l lk ll">import React from 'react';<br/>import Code from './Code';<br/>import Link from 'next/link';</span><span id="560e" class="lg lh in lc b gy lr lj l lk ll">export default function Snippet({ snippet }) {</span><span id="fc29" class="lg lh in lc b gy lr lj l lk ll">const deleteSnippet = async () =&gt; {<br/>    };<br/>    <br/>    return (<br/>        &lt;div className="bg-gray-100 p-4 rounded-md my-2 shadow-lg"&gt;<br/>            &lt;div className="flex items-center justify-between mb-2"&gt;<br/>                &lt;h2 className="text-xl text-gray-800 font-bold"&gt;<br/>                    {snippet.data.name}<br/>                &lt;/h2&gt;<br/>                &lt;span className="font-bold text-xs text-red-800 px-2 py-1 rounded-lg "&gt;<br/>                    {snippet.data.language}<br/>                &lt;/span&gt;<br/>            &lt;/div&gt;<br/>            &lt;p className="text-gray-900 mb-4"&gt;{snippet.data.description}&lt;/p&gt;<br/>            &lt;Code code={snippet.data.code} /&gt;<br/>            &lt;Link href={`/edit/${snippet.id}`}&gt;<br/>                &lt;a className="text-gray-800 mr-2"&gt;Edit&lt;/a&gt;<br/>            &lt;/Link&gt;<br/>            &lt;button onClick={deleteSnippet} className="text-gray-800 mr-2"&gt;<br/>                Delete<br/>            &lt;/button&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="a91b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在同一个文件夹中创建一个文件<strong class="kb io"> Code.js </strong>，并在其中添加以下内容。这里，我们将显示单击按钮时的代码。我们还有一个复制功能，将代码复制到剪贴板。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="76e8" class="lg lh in lc b gy li lj l lk ll">import React, { useState } from 'react';</span><span id="d6d5" class="lg lh in lc b gy lr lj l lk ll">export default function Code({ code }) {<br/>    const [showCode, setShowCode] = useState(false);<br/>    const [copyText, setCopyText] = useState('Copy');<br/>    const copyCode = async () =&gt; {<br/>        await navigator.clipboard.writeText(code);<br/>        setCopyText('✅ Copied!');<br/>        setTimeout(() =&gt; {<br/>            setCopyText('Copy');<br/>        }, 1000);<br/>    };<br/>    <br/>    return (<br/>        &lt;div&gt;<br/>            &lt;button<br/>                className="bg-red-800 text-xs hover:bg-red-900 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mb-2"<br/>                type="submit"<br/>                onClick={() =&gt; setShowCode(!showCode)}<br/>            &gt;<br/>                {showCode ? 'Hide the Code' : 'Show the Code 👇'}<br/>            &lt;/button&gt;<br/>            {showCode &amp;&amp; (<br/>                &lt;div className="relative"&gt;<br/>                    &lt;pre className="text-gray-800 bg-gray-300 rounded-md p-2"&gt;<br/>                        {code}<br/>                    &lt;/pre&gt;</span><span id="b535" class="lg lh in lc b gy lr lj l lk ll">&lt;button<br/>                        className="bg-gray-500 text-xs hover:bg-gray-600 text-white font-bold py-1 px-2 rounded focus:outline-none focus:shadow-outline mb-2 absolute top-0 right-0 transform -translate-x-1 translate-y-1"<br/>                        type="submit"<br/>                        onClick={copyCode}<br/>                    &gt;<br/>                        {copyText}<br/>                    &lt;/button&gt;<br/>                &lt;/div&gt;<br/>            )}<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="e74d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，使用Next.js，我们也可以使用服务器端路由代码，就像我们在Node.js中所做的一样。因此，在<strong class="kb io"> pages- &gt; api </strong>文件夹中，创建一个新文件<strong class="kb io"> snippets.js </strong>并在其中添加以下内容。我们将很快在其中创建API端点。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="7912" class="lg lh in lc b gy li lj l lk ll">import { getSnippets } from '../../utils/Fauna';<br/>export default async function handler(req, res) {<br/>    if (req.method !== 'GET') {<br/>        return res.status(405);<br/>    }</span><span id="9a32" class="lg lh in lc b gy lr lj l lk ll">try {<br/>        <br/>    } catch (err) {<br/>        console.error(err);<br/>        res.status(500).json({ msg: 'Something went wrong.' });<br/>    }<br/>}</span></pre><p id="a0c9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，是时候将我们的前端连接到FaunaDB了。因此，在根目录下创建一个文件夹<strong class="kb io"> utils </strong>并在其中创建一个文件<strong class="kb io"> Fauna.js </strong>。把下面的内容放进去。</p><p id="e951" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里，我们首先进行所需的导入，然后，我们有一个<strong class="kb io"> getSnippets </strong>函数。在该函数中，我们首先遍历我们之前创建的集合<strong class="kb io">片段</strong>，并获取<strong class="kb io">数据</strong>变量中的所有内容。</p><p id="07e3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们需要从ref中提取每个片段的id，所以我们通过它映射并更改它。最后，我们导出getSnippets函数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="67b9" class="lg lh in lc b gy li lj l lk ll">const faunadb = require('faunadb');<br/>const faunaClient = new faunadb.Client({ secret: process.env.FAUNA_SECRET });<br/>const q = faunadb.query;</span><span id="f3c5" class="lg lh in lc b gy lr lj l lk ll">const getSnippets = async () =&gt; {<br/>    const { data } = await faunaClient.query(<br/>        q.Map(<br/>            q.Paginate(q.Documents(q.Collection('snippets'))),<br/>            q.Lambda('ref', q.Get(q.Var('ref')))<br/>        )<br/>    );</span><span id="e0e1" class="lg lh in lc b gy lr lj l lk ll">const snippets = data.map(snippet =&gt; {<br/>        snippet.id = snippet.ref.id;<br/>        delete snippet.ref;<br/>        return snippet;<br/>    });</span><span id="579a" class="lg lh in lc b gy lr lj l lk ll">return snippets;<br/>};</span><span id="f2ea" class="lg lh in lc b gy lr lj l lk ll">module.exports = {<br/>    getSnippets,<br/>};</span></pre><p id="46e1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将通过调用<strong class="kb io"> getSnippets </strong>()并返回<strong class="kb io"> snippets </strong>数组来更新<strong class="kb io"> snippets.js </strong>文件中的代码。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lz"><img src="../Images/b5cf6f81fabe3841ba261edfc7fcec92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OWK-RDsnKcmWfScCpeoeQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">snippets.js</figcaption></figure><p id="8bb6" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，我们将更新我们的<strong class="kb io"> index.js </strong>页面，使用<strong class="kb io"> SWR </strong>获取所有代码片段。在这里，我们使用<strong class="kb io"> useSWR </strong>钩子来调用<strong class="kb io"> /api/snippets </strong>端点并获取snippets数组。之后，我们对其进行映射，并将其传递给我们之前创建的<strong class="kb io">片段</strong>组件。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ma"><img src="../Images/ab47de3af80039937fd4fe979e683f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-A8PKBqIZ87J5gtILRu1sQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">index.js</figcaption></figure><p id="5abe" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们的主页显示我们的片段已经从FaunaDB数据库中获取。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mb"><img src="../Images/392a24c9a4bf453f300b726211670934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RPNBsswabNUI7C8HQxu16A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">FaunaDB data</figcaption></figure><p id="b790" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将添加创建代码片段的功能。我们将首先在<strong class="kb io">动物群. js </strong>文件中创建一个新函数<strong class="kb io"> createSnippet </strong>。它将在FaunaDB中添加一个包含值代码、语言、描述和名称的新代码片段。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/1c2140f4d31760eca839168b2b1931e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uk2rhMGt12v8z8Y3YDwNg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Fauna.js</figcaption></figure><p id="c8c5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，在<strong class="kb io"> api </strong>文件夹中创建一个文件<strong class="kb io"> createSnippet.js </strong>，并在其中添加以下内容。它与我们的<strong class="kb io"> snippets.js </strong>文件非常相似，但是用于调用<strong class="kb io"> createSnippet </strong>函数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="c997" class="lg lh in lc b gy li lj l lk ll">import { createSnippet } from '../../utils/Fauna';</span><span id="d11a" class="lg lh in lc b gy lr lj l lk ll">export default async function handler(req, res) {<br/>    const { code, language, description, name } = req.body;<br/>    if (req.method !== 'POST') {<br/>        return res.status(405).json({ msg: 'Method not allowed' });<br/>    }</span><span id="c7d6" class="lg lh in lc b gy lr lj l lk ll">try {<br/>        const createdSnippet = await createSnippet(code, language, description, name);<br/>        return res.status(200).json(createdSnippet);<br/>    } catch (err) {<br/>        console.error(err);<br/>        res.status(500).json({ msg: 'Something went wrong.' });<br/>    }<br/>}</span></pre><p id="91f4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们需要显示一个表单来接收用户的输入，并为此在<strong class="kb io"> pages </strong>文件夹中创建一个新文件<strong class="kb io"> new.js </strong>。把下面的内容放进去。它只是调用了我们接下来将创建的组件SnippetForm。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="f8fd" class="lg lh in lc b gy li lj l lk ll">import Head from 'next/head';<br/>import SnippetForm from '../components/SnippetForm';</span><span id="39e5" class="lg lh in lc b gy lr lj l lk ll">export default function Home() {<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;Head&gt;<br/>                &lt;title&gt;Create Next Snippet&lt;/title&gt;<br/>                &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>            &lt;/Head&gt;</span><span id="eb63" class="lg lh in lc b gy lr lj l lk ll">&lt;main className="max-w-lg mx-auto"&gt;<br/>                &lt;h1 className="text-red-100 text-2xl mb-4"&gt;New Snippet&lt;/h1&gt;<br/>                &lt;SnippetForm /&gt;<br/>            &lt;/main&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="72b5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，在<strong class="kb io"> components </strong>文件夹中创建一个文件<strong class="kb io"> SnippetForm.js </strong>，并将以下内容放入其中。我们在其中使用了包<strong class="kb io"> react-hook-form </strong>，这对于维护表单状态和进行验证非常有用。</p><p id="7b53" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">把下面的内容放进去。这里，我们在react-hook-form的帮助下创建一个表单。注意，我们已经使用了来自react-hook-form的<strong class="kb io">寄存器</strong>、<strong class="kb io">句柄</strong>。</p><p id="d860" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">注册代码用于每个字段，我们需要用表单中的<strong class="kb io"> handleSubmit </strong>包装我们的函数createSnippet。</p><p id="d6ce" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在createSnippet函数中，我们将向之前创建的/api/createSnippet发送一个POST请求，并将代码、语言、描述、名称作为主体发送。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="dc20" class="lg lh in lc b gy li lj l lk ll">import React from 'react';<br/>import { useForm } from 'react-hook-form';<br/>import { useRouter } from 'next/router';<br/>import Link from 'next/link';</span><span id="ee94" class="lg lh in lc b gy lr lj l lk ll">export default function SnippetForm() {<br/>    const {register, handleSubmit} = useForm();<br/>    const router = useRouter();</span><span id="26cb" class="lg lh in lc b gy lr lj l lk ll">const createSnippet = async (data) =&gt; {<br/>        const { code, language, description, name } = data;<br/>        try {<br/>            await fetch('/api/createSnippet', {<br/>                method: 'POST',<br/>                body: JSON.stringify({ code, language, description, name }),<br/>                headers: { 'Content-Type': 'application/json'}<br/>            })<br/>            router.push('/');<br/>        } catch (err) {<br/>            console.error(err);<br/>        }<br/>    };</span><span id="e6af" class="lg lh in lc b gy lr lj l lk ll">return (<br/>        &lt;form onSubmit={handleSubmit(createSnippet)}&gt;<br/>            &lt;div className="mb-4"&gt;<br/>                &lt;label<br/>                    className="block text-red-100 text-sm font-bold mb-1"<br/>                    htmlFor="name"<br/>                &gt;<br/>                    Name<br/>                &lt;/label&gt;<br/>                &lt;input<br/>                    type="text"<br/>                    id="name"<br/>                    name="name"<br/>                    className="w-full border bg-white rounded px-3 py-2 outline-none text-gray-700"<br/>                    {...register('name', { required: true })}<br/>                /&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="mb-4"&gt;<br/>                &lt;label<br/>                    className="block text-red-100 text-sm font-bold mb-1"<br/>                    htmlFor="language"<br/>                &gt;<br/>                    Language<br/>                &lt;/label&gt;<br/>                &lt;select<br/>                    id="language"<br/>                    name="language"<br/>                    className="w-full border bg-white rounded px-3 py-2 outline-none text-gray-700"<br/>                    {...register('language', { required: true })}<br/>                &gt;<br/>                    &lt;option className="py-1"&gt;JavaScript&lt;/option&gt;<br/>                    &lt;option className="py-1"&gt;HTML&lt;/option&gt;<br/>                    &lt;option className="py-1"&gt;CSS&lt;/option&gt;<br/>                &lt;/select&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="mb-4"&gt;<br/>                &lt;label<br/>                    className="block text-red-100 text-sm font-bold mb-1"<br/>                    htmlFor="description"<br/>                &gt;<br/>                    Description<br/>                &lt;/label&gt;<br/>                &lt;textarea<br/>                    name="description"<br/>                    id="description"<br/>                    rows="3"<br/>                    className="resize-none w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none"<br/>                    placeholder="What does the snippet do?"<br/>                    {...register('description', { required: true })}<br/>                &gt;&lt;/textarea&gt;<br/>            &lt;/div&gt;<br/>            &lt;div className="mb-4"&gt;<br/>                &lt;label<br/>                    className="block text-red-100 text-sm font-bold mb-1"<br/>                    htmlFor="code"<br/>                &gt;<br/>                    Code<br/>                &lt;/label&gt;<br/>                &lt;textarea<br/>                    name="code"<br/>                    id="code"<br/>                    rows="10"<br/>                    className="resize-none w-full px-3 py-2 text-gray-700 border rounded-lg focus:outline-none"<br/>                    placeholder="ex. console.log('helloworld')"<br/>                    {...register('code', { required: true })}<br/>                &gt;&lt;/textarea&gt;<br/>            &lt;/div&gt;<br/>            &lt;button<br/>                className="bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2"<br/>                type="submit"<br/>            &gt;<br/>                Save<br/>            &lt;/button&gt;<br/>            &lt;Link href="/"&gt;<br/>                &lt;a className="mt-3 inline-block bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2"&gt;<br/>                    Cancel<br/>                &lt;/a&gt;<br/>            &lt;/Link&gt;<br/>        &lt;/form&gt;<br/>    );<br/>}</span></pre><p id="1843" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在主页上，当我们单击“创建片段”按钮时，我们将被带到下面的表单，我们可以在其中填写数据。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/4ac0c2386dd4be360c3b6671cd7ecd6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*naEIKOYKPiSO5VIN479CvA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Data fill</figcaption></figure><p id="005c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">单击保存按钮后，我们将返回主页，我们的代码片段已被添加。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi me"><img src="../Images/260d61e039c358250441c516ceae09d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_l5szBX1GMtQB-bSPxmT0A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Snippet added</figcaption></figure><p id="adcc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将在应用程序中添加更新功能。所以，再次转到<strong class="kb io"> Fauna.js </strong>文件，添加两个新函数<strong class="kb io"> updateSnippet </strong>和<strong class="kb io"> getSnippetById </strong>，类似于createSnippet。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mf"><img src="../Images/e869104fc12c78c424b0076f05a0c746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ajpc8dnQaBgRxKGS2CFJQ.png"/></div></div></figure><p id="9788" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，在<strong class="kb io"> api </strong>文件夹中创建一个文件<strong class="kb io"> updateSnippet.js </strong>，并在其中添加以下内容。它与我们的createSnippet.js文件非常相似，但是用于调用<strong class="kb io"> updateSnippet </strong>函数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="a024" class="lg lh in lc b gy li lj l lk ll">import { updateSnippet } from '../../utils/Fauna';</span><span id="1a12" class="lg lh in lc b gy lr lj l lk ll">export default async function handler(req, res) {<br/>    if (req.method !== 'PUT') {<br/>        return res.status(405).json({ msg: 'Method not allowed' });<br/>    }<br/>    const { id, code, language, description, name } = req.body;</span><span id="8e82" class="lg lh in lc b gy lr lj l lk ll">try {<br/>        const updated = await updateSnippet(id, code, language, description, name);<br/>        return res.status(200).json(updated);<br/>    } catch (err) {<br/>        console.error(err);<br/>        res.status(500).json({ msg: 'Something went wrong.' });<br/>    }<br/>}</span></pre><p id="892c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们需要创建一个动态路由，当用户单击编辑链接时将调用它。因此，在<strong class="kb io">页面的</strong>文件夹中创建一个文件夹编辑和一个文件<strong class="kb io"> [id]。js </strong>在里面。</p><p id="88be" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">把下面的内容放进去。这里，我们使用getSnippetById来获取片段数据，然后将其传递给SnippetForm组件。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="1591" class="lg lh in lc b gy li lj l lk ll">import Head from 'next/head';<br/>import { getSnippetById } from '../../utils/Fauna';<br/>import SnippetForm from '../../components/SnippetForm';</span><span id="2db4" class="lg lh in lc b gy lr lj l lk ll">export default function Home({ snippet }) {<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;Head&gt;<br/>                &lt;title&gt;Update Next Snippet&lt;/title&gt;<br/>                &lt;link rel="icon" href="/favicon.ico" /&gt;<br/>            &lt;/Head&gt;</span><span id="03c9" class="lg lh in lc b gy lr lj l lk ll">&lt;main className="max-w-lg mx-auto"&gt;<br/>                &lt;h1 className="text-red-100 text-2xl mb-4"&gt;Update Snippet&lt;/h1&gt;<br/>                &lt;SnippetForm snippet={snippet} /&gt;<br/>            &lt;/main&gt;<br/>        &lt;/div&gt;<br/>    );<br/>}</span><span id="86c5" class="lg lh in lc b gy lr lj l lk ll">export async function getServerSideProps(context) {<br/>    try {<br/>        const id = context.params.id;<br/>        const snippet = await getSnippetById(id);</span><span id="5aef" class="lg lh in lc b gy lr lj l lk ll">return {<br/>            props: { snippet },<br/>        };<br/>    } catch (error) {<br/>        console.error(error);<br/>        context.res.statusCode = 302;<br/>        context.res.setHeader('Location', `/`);<br/>        return { props: {} };<br/>    }<br/>}</span></pre><p id="616e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，我们将在我们的<strong class="kb io"> SnippetForm.js </strong>文件中添加编辑功能。这里，我们首先取道具片段。之后，在useForm钩子中，如果我们获得了代码片段属性，我们将获取默认值。</p><p id="1d27" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在表单的<strong class="kb io"> onSumbit </strong>中，我们再次检查snippet prop是否存在，如果存在，调用<strong class="kb io"> updateSnippet </strong>。否则，我们将调用<strong class="kb io">create snipet</strong>。</p><p id="3672" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> updateSnippet </strong>与<strong class="kb io"> createSnippet </strong>非常相似，只是我们做了一个PUT调用并传递了id。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/2cd9650c0980fe404c2ff83cf006bad2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_J-ZVkpZUJiPQ7GJ0nN2A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">SnippetForm.js</figcaption></figure><p id="2196" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，编辑一些东西并保存在localhost中，它将正常工作。现在，我们将添加删除某些内容的逻辑。</p><p id="6ec1" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，再次转到<strong class="kb io"> Fauna.js </strong>文件并添加一个新函数deleteSnippet，它类似于前面的函数。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/6db0e93d6fab034ba5ed6a6a609f4110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jjEf_d1VuyfJUMgUuVffoQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Fauna.js</figcaption></figure><p id="f358" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，在<strong class="kb io"> api </strong>文件夹中创建一个文件<strong class="kb io"> deleteSnippet.js </strong>，并在其中添加以下内容。它与我们的<strong class="kb io"> createSnippet.js </strong>文件非常相似，但是用于调用<strong class="kb io"> deleteSnippet </strong>函数。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="6573" class="lg lh in lc b gy li lj l lk ll">import { deleteSnippet } from '../../utils/Fauna';</span><span id="4477" class="lg lh in lc b gy lr lj l lk ll">export default async function handler(req, res) {<br/>    if (req.method !== 'DELETE') {<br/>        return res.status(405).json({ msg: 'Method not allowed' });<br/>    }</span><span id="ae69" class="lg lh in lc b gy lr lj l lk ll">const { id } = req.body;<br/>    try {<br/>        const deleted = await deleteSnippet(id);<br/>        return res.status(200).json(deleted);<br/>    } catch (err) {<br/>        console.error(err);<br/>        res.status(500).json({ msg: 'Something went wrong.' });<br/>    }<br/>}</span></pre><p id="704a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在我们的<strong class="kb io"> Snippet.js </strong>文件中，我们将在<strong class="kb io"> deleteSnippet </strong>函数中添加删除代码片段的逻辑。我们现在也得到一个新道具<strong class="kb io"> snippetDeleted </strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/4992956e656b5674e0260f50cb488fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZdEUqi1mHTW4oGFBFDfEQw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Snippet.js</figcaption></figure><p id="9587" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将从<strong class="kb io"> index.js </strong>文件中传递prop <strong class="kb io"> snippetDeleted </strong>。道具触发一个<strong class="kb io">突变</strong>，从服务器重新获取数据。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/269320beb260fbe1a30b7ef9ec256794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JRfQx608TDvex_L3IbpB7w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">index.js</figcaption></figure><p id="0c76" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">所以，现在我们的删除功能也工作了。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lu"><img src="../Images/c210eaabe93c98abdabc20659eb3254d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jXzVJKppM7U_gcBEXgLhsA.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Edit and delete</figcaption></figure><p id="68e4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将使用Auth0在我们的应用程序中添加受保护的路由和身份验证。所以，去https://auth0.com/<a class="ae lq" href="https://auth0.com/" rel="noopener ugc nofollow" target="_blank">和</a>报名吧。</p><p id="6ae7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">登录后，将鼠标悬停在右侧菜单上，然后点击<strong class="kb io">应用程序选项卡</strong>，并再次点击<strong class="kb io">应用程序</strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/bd019381f770441511a9696af70ab638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNN3BzBETzoT9sOBEkd0yw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Applications</figcaption></figure><p id="64b3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一个屏幕上，点击<strong class="kb io">创建应用</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/b1c6fe2a93a6a713cc1d5e44dec9c8db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzaUln4UEepIC3LySvGZhQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create Application</figcaption></figure><p id="41d7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在下一个屏幕上，给应用起一个名字，如<strong class="kb io">动物-nextjs-auth </strong>，选择<strong class="kb io">常规网络应用</strong>，点击<strong class="kb io">创建</strong>按钮。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/9cc96ae75e8d129bd3e788e61f44317b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dxu8_OGEHTOJhu1FEnobRw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create Application</figcaption></figure><p id="abc8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">下一个屏幕将显示我们所有的秘密，这是我们的应用程序所需的。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/14d270d9337909e75ab6d375ffca2f29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mECJIyAsbQKhxk4xjQp_cw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Secrets</figcaption></figure><p id="c473" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们为NextJS使用auth0包，指令在<a class="ae lq" href="https://github.com/auth0/nextjs-auth0" rel="noopener ugc nofollow" target="_blank">这个</a>链接中。所以，按照说明，复制<strong class="kb io"> .env.local </strong>文件中的secrests。另外，请注意<strong class="kb io"> AUTH0_SECRET </strong>可以是任何字符串。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/b0f954dc271dd31bca54f618099017d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gj9HjLNfeqgCjQkDBZJS9Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">.env.local</figcaption></figure><p id="aec3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，再次回到Auth0 URL并向下滚动一点，添加<strong class="kb io">允许的回拨URL</strong>和<strong class="kb io">允许的注销URL</strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/31b1cfdda64ff98fff15fc0e0886c262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8TDlUs0XJCPEG4PVGmhjNQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Auth0</figcaption></figure><p id="2de0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在继续之前，打开您的终端并安装Next.js的auth0包。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="ebb6" class="lg lh in lc b gy li lj l lk ll">npm install @auth0/nextjs-auth0</span></pre><p id="3191" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在<strong class="kb io"> api </strong>文件夹中创建一个新文件夹<strong class="kb io"> auth </strong>和一个文件<strong class="kb io"> […auth0】。js </strong>在里面。把下面的内容放进去。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mo"><img src="../Images/52065612d9a95b9c4f1a9c7ac9872482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gj-SAZGjtvvtiKCe6mmSUw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">[…auth0].js</figcaption></figure><p id="939b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们需要用<strong class="kb io"> UserProvider </strong>包装<strong class="kb io"> _app.js </strong>文件中的所有内容。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/1b428a8d2d114de305f75aa6d84563a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLGrJF5Hiy07o7YdyK1k9w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">_app.js</figcaption></figure><p id="1c4e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们将显示导航栏中的登录链接。因此，在<strong class="kb io">组件</strong>文件夹中创建一个文件<strong class="kb io"> Navbar.js </strong>，并在其中添加以下内容。这里，我们使用变量<strong class="kb io"> user </strong>，从auth0的useUser钩子加载。</p><p id="bf2f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">根据这个值，我们显示一个登录或注销按钮。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="71f6" class="lg lh in lc b gy li lj l lk ll">import Link from 'next/link';<br/>import { useUser } from '@auth0/nextjs-auth0';</span><span id="c707" class="lg lh in lc b gy lr lj l lk ll">const Navbar = () =&gt; {<br/>    const { user, isLoading } = useUser();</span><span id="f2b1" class="lg lh in lc b gy lr lj l lk ll">return (<br/>        &lt;nav&gt;<br/>            &lt;Link href="/"&gt;<br/>                &lt;a className="text-2xl mb-2 block text-center text-red-200 uppercase"&gt;<br/>                    TheWebDev Snippets<br/>                &lt;/a&gt;<br/>            &lt;/Link&gt;<br/>            &lt;div className="space-x-3 m-x-auto mb-6 flex justify-center"&gt;<br/>                {!isLoading &amp;&amp; !user &amp;&amp; (<br/>                    &lt;Link href="/api/auth/login"&gt;<br/>                        &lt;a className="text-red-100 hover:underline"&gt;Login&lt;/a&gt;<br/>                    &lt;/Link&gt;<br/>                )}<br/>                {!isLoading &amp;&amp; user &amp;&amp; (<br/>                    &lt;&gt;<br/>                    &lt;span className="text-red-100"&gt;Hello {user.name}&lt;/span&gt;<br/>                    &lt;Link href="/api/auth/logout"&gt;<br/>                        &lt;a className="text-red-100 hover:underline"&gt;<br/>                            Logout<br/>                            &lt;/a&gt;<br/>                    &lt;/Link&gt;<br/>                    &lt;/&gt;<br/>                )}<br/>            &lt;/div&gt;<br/>        &lt;/nav&gt;<br/>    )<br/>}</span><span id="b79c" class="lg lh in lc b gy lr lj l lk ll">export default Navbar</span></pre><p id="aae9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，将这个导航条组件包含在<strong class="kb io"> _app.js </strong>文件中。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mq"><img src="../Images/cfdde5289d13edbd4bf5c9d129295843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZsBD2qECTP2FN7k2Y5B_A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">_app.js</figcaption></figure><p id="7744" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在localhost中，我们将看到登录按钮。点击登录按钮，我们将得到下面的弹出窗口，其中有选择<strong class="kb io">继续与谷歌</strong>或通过一个Auth0帐户登录。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/1a7ba5597b8925d2d15eb115b1bcbcc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XhIL3vqFCxA3cXyb-y-h9g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Login</figcaption></figure><p id="8a7f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我已经用我的谷歌帐户登录，并回到应用程序，现在，我们可以看到注销链接以及你好用户名。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ls"><img src="../Images/f387b905b847b5c74f0f12bc696736c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e-sBddPFcUvO_nq0fGub4Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">localhost</figcaption></figure><p id="7664" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们只想展示创建一个代码片段！按钮，如果用户已登录。因此，为此，在<strong class="kb io">组件</strong>文件夹中，创建一个文件<strong class="kb io"> Header.js </strong>并将以下内容放入其中。</p><p id="8584" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这里，我们再次使用了<strong class="kb io">用户</strong>钩子，并将从中获取<strong class="kb io">用户</strong>和<strong class="kb io">正在加载的</strong>。现在，如果用户在场，我们将显示<strong class="kb io">创建片段！</strong>按钮或者<strong class="kb io">登录创建代码片段！</strong>按钮。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="e4db" class="lg lh in lc b gy li lj l lk ll">import { useUser } from '@auth0/nextjs-auth0';<br/>import Link from 'next/link';</span><span id="ee2c" class="lg lh in lc b gy lr lj l lk ll">const Header = ({ title, subtitle }) =&gt; {<br/>    const { user, isLoading } = useUser();</span><span id="c3e1" class="lg lh in lc b gy lr lj l lk ll">return (<br/>        &lt;header className="my-12"&gt;<br/>            &lt;h1 className="text-red-100 text-2xl"&gt;{title}&lt;/h1&gt;<br/>            {subtitle &amp;&amp; &lt;p className="text-red-100"&gt;{subtitle}&lt;/p&gt;}</span><span id="4235" class="lg lh in lc b gy lr lj l lk ll">{!isLoading &amp;&amp; user &amp;&amp; (<br/>                &lt;Link href="/new"&gt;<br/>                    &lt;a className="mt-3 inline-block bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"&gt;<br/>                        Create a Snippet!<br/>                    &lt;/a&gt;<br/>                &lt;/Link&gt;<br/>            )}<br/>            {!isLoading &amp;&amp; !user &amp;&amp; (<br/>                &lt;Link href="/api/auth/login"&gt;<br/>                    &lt;a className="mt-3 inline-block bg-red-800 hover:bg-red-900 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline"&gt;<br/>                        Login to Create Snippets!<br/>                    &lt;/a&gt;<br/>                &lt;/Link&gt;<br/>            )}<br/>        &lt;/header&gt;<br/>    )<br/>}</span><span id="63a2" class="lg lh in lc b gy lr lj l lk ll">export default Header</span></pre><p id="0464" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在<strong class="kb io"> index.js </strong>中，我们使用了<strong class="kb io"> Header </strong>组件，并将<strong class="kb io">标题</strong>和<strong class="kb io">副标题</strong>传递给它。我们还从这里删除了相同的代码。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ms"><img src="../Images/b3e76f5ea29f68e83979e8380564dc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMsQFQ1XtoGRB46Lp0if1g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">index.js</figcaption></figure><p id="3de9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们有一个问题，即使我们没有登录，我们也可以去路由<a class="ae lq" href="http://localhost:3000/new" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/new</a>。所以，我们需要保护这条路线。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/9f433f162b0dd27ffd80e6277582961f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4gi4zwiRA_egYWm2gutnAw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Not logged in</figcaption></figure><p id="c747" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">使用auth0，我们可以通过用PageAuthRequired导入并从页面导出来非常容易地保护一个路由，在我们的例子中是<strong class="kb io"> new.js </strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/c4c2ead77d805f6bfb1dc5266aadb834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S7KDqEo2m14CfDZMb8YYXQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">new.js</figcaption></figure><p id="173f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，如果您在没有登录的情况下直接尝试前往链接<a class="ae lq" href="http://localhost:3000/new" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/new</a>，它会将您重定向到auth0的登录页面。</p><p id="59e8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，我们还将有一个用户与每个代码片段相关联。所以，我们需要更新<strong class="kb io"> createSnippet.js </strong>文件。在这里，我们首先从auth0导入带有所需授权的、<strong class="kb io"> getSession </strong>的<strong class="kb io">。</strong></p><p id="3007" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，用<strong class="kb io"> withApiAuthRequired </strong>包装整个函数，因为它是一个高阶函数。接下来，在函数内部，我们将获取<strong class="kb io"> userId </strong>，并将其传递给<strong class="kb io">createdsnipet</strong>。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mu"><img src="../Images/867b973d8b5f45fef462a8344ea4661f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVugCD2SypNwJrzcVEZ57Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">createSnippet.js</figcaption></figure><p id="7cc5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，在<strong class="kb io"> Fauna.js </strong>文件中，在我们的<strong class="kb io"> createSnippet </strong>函数中，我们必须包含userId。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/899996992054f3082e95e6eb523e9842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bEp4Qb2M4AMSP6CKujTU6w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Fauna.js</figcaption></figure><p id="7276" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，返回FaunaDB仪表板并删除所有文档，因为它们是在没有userId的情况下创建的。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/7333bbcf76bc77a735dd31b2efd03370.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zplCjhsKpKiS3F2KZCj2EQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Deleting</figcaption></figure><p id="f0cb" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我已经创建了一个新的代码片段，在faunaDB文档中，它现在也包含了userId。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/6661706c562b8d0c04266fc30ddc6fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9vttBllf6zLb0jhxYnF9HA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">userID</figcaption></figure><p id="9b39" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们将做类似的事情来更新代码片段，只有登录的用户才能编辑代码片段。所以，在<strong class="kb io">【id】。js </strong>文件首先用PageAuthRequired 导入<strong class="kb io">，然后用它包装<strong class="kb io"> getServerSideProps </strong>。</strong></p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mv"><img src="../Images/b8a8d927c356343a8151229665b8164e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vpvtypEBRglNYvAEY5D5XQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">[id].js</figcaption></figure><p id="5bb2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，如果您没有登录并直接转到类似<a class="ae lq" href="http://localhost:3000/edit/297708572934930951" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/edit/297708572934930951</a>的路由，您将被重定向到auth0身份验证页面。</p><p id="3daf" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们还需要保护路由上的身份验证，否则有人可以从Postman发送请求并使用它。</p><p id="6d55" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们还需要确保只有创建代码片段的用户才能更新它。删除也是如此。</p><p id="8648" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在<strong class="kb io"> updateSnippet.js </strong>文件中，我们首先从auth0导入带有piAuthRequired 、<strong class="kb io"> getSession </strong>的<strong class="kb io">。我们还导入了<strong class="kb io"> getSnippetById </strong>。</strong></p><p id="8262" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，用<strong class="kb io"> withApiAuthRequired </strong>包装整个函数，并检查用户是否是代码片段的所有者。如果他不是所有者，我们只是返回记录未找到消息。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mw"><img src="../Images/cb03d7d13b313ae09ebe983c6226cacc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKvzjvPSwMzEha8ufciy1w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">updateSnippet.js</figcaption></figure><p id="1e6c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们将在<strong class="kb io"> deleteSnippet.js </strong>文件中添加一个类似的逻辑。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mt"><img src="../Images/40eb29e5aa76176f872f0f3e88aaae99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WM5r4lN_EaWL6cmI5uhaCg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">deleteSnippet.js</figcaption></figure><p id="c45c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我们可以在登录后进行编辑和删除。但是我们希望只向它所属的用户显示编辑和删除按钮。</p><p id="4957" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">因此，在<strong class="kb io"> Snippet.js </strong>文件中，我们将使用useUser钩子中的user元素。然后，我们检查登录用户是否与代码片段创建用户是同一用户。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ly"><img src="../Images/b417e1838c088f6d380541aaf09365bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5D1ULnxF9k6EClKAd1jQYA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Snippet.js</figcaption></figure><p id="e2d8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在，我使用不同的Google帐户登录，创建了一个代码片段，并且只能编辑和删除这个代码片段，而不能编辑和删除其他用户创建的代码片段。</p><figure class="kx ky kz la gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi md"><img src="../Images/ed3e3ac0487963b1d97e1b58cd58d057.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4AU41DPjM_JE9NRa1cVdXA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Logged in</figcaption></figure><p id="441f" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这完成了我们的Snippet应用程序。你可以在这里找到相同<a class="ae lq" href="https://github.com/nabendu82/snippet-app-nextjs" rel="noopener ugc nofollow" target="_blank">的代码</a>。</p><p id="2408" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="mx">更多内容看</em><a class="ae lq" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="mx">plain English . io</em></strong></a></p></div></div>    
</body>
</html>