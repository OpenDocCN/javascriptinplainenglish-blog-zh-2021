<html>
<head>
<title>Should I use Monkey Patching in JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中应该用猴子打补丁吗？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/should-i-use-monkey-patching-in-javascript-804066c9a52c?source=collection_archive---------5-----------------------#2021-05-22">https://javascript.plainenglish.io/should-i-use-monkey-patching-in-javascript-804066c9a52c?source=collection_archive---------5-----------------------#2021-05-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6261" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">猴子补丁展示了JavaScript的灵活性以及它的一些危险</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ca56129c148cfc9799495e259b220637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xM0vdlzgFziLtjxD5jAWnQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photograph from Jamie Haughton at Unsplash, Illustration by David Fekke</figcaption></figure><p id="6976" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">Monkey Patching是JavaScript中用自己的函数替换JavaScript对象中的函数的功能。这可以派上用场，但也很危险。JavaScript的优势之一是它能够轻松地修改对象和模块。这也使得引入新的错误变得相当容易。</p><p id="2c87" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这种功能也可以在Objective-C和Swift等语言中找到，在这些语言中，开发人员可以使用一种称为“方法切换”的运行时功能来交换他们类中方法的功能。</p><p id="32d9" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了演示这个功能，我们可以创建一个具有简单add函数的对象。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="72e2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然后我们可以实例化这个对象，并在我们的对象上调用<code class="fe lt lu lv lw b">add</code>函数。</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="e1eb" class="mb mc iq lw b gy md me l mf mg">const MathObject = new SimpleMathObject();<br/>const result = MathObject.add(1, 2);<br/>console.log(`Result of 1 + 2 = ${result}`);<br/>// Output: Result of 1 + 2 = 3</span></pre><h1 id="53f5" class="mh mc iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">添加猴子补丁</h1><p id="e0f0" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">要给我们的对象添加一个猴子补丁，我们只需要给实例化对象上的<code class="fe lt lu lv lw b">add</code>函数分配一个新函数。我们需要得到一个对原始函数的引用，这样我们就可以在我们的新函数中继续使用它，或者可能在我们完成修补后将它重新分配给对象。</p><p id="f9f8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们现在可以添加我们自己版本的<code class="fe lt lu lv lw b">add</code>功能，而不必改变<code class="fe lt lu lv lw b">SimpleMathObject</code>的原始版本。如果我们需要给这个对象注入一些新的功能，这可能是有用的。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="703d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">使用<code class="fe lt lu lv lw b">class</code> <a class="ae nd" href="https://fek.io/blog/why-you-should-not-use-classes-in-java-script/" rel="noopener ugc nofollow" target="_blank">关键字</a>或<a class="ae nd" href="https://fek.io/blog/crockford-objects-in-java-script/" rel="noopener ugc nofollow" target="_blank">对象原型</a>的一个问题是会让你的对象对这种类型的操作敞开大门。如果你不希望你的函数被猴子打补丁，有一些方法可以防止这种类型的执行发生在你的代码中。实现这一点的一种方法是在返回对象时使用工厂函数和<code class="fe lt lu lv lw b">Object.freeze</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="7187" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，如果您试图用自己的函数替换<code class="fe lt lu lv lw b">add</code>函数，就像下面的例子，JavaScript引擎将抛出一个TypeError</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lr ls l"/></div></figure><p id="07a2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">尝试执行这段代码时出现的错误应该类似于下面的错误。</p><pre class="kg kh ki kj gt lx lw ly lz aw ma bi"><span id="91e1" class="mb mc iq lw b gy md me l mf mg">TypeError: Cannot assign to read only property 'add' of object '#&lt;Object&gt;' at file:///Users/davidfekke/Documents/monkeypatch/monkey.js:39:23</span></pre><h1 id="7f1c" class="mh mc iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">结论</h1><p id="2414" class="pw-post-body-paragraph kv kw iq kx b ky my jr la lb mz ju ld le na lg lh li nb lk ll lm nc lo lp lq ij bi translated">猴子补丁是JavaScript中一个非常强大的概念。您可以使用向现有的库或模块中添加方面或注入新功能。它也可能是危险的。但是如果你不希望你的代码被猴子修补，你可以使用Object.freeze使你的对象只读。</p><p id="d8b5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您当然可以在您的JavaScript应用程序中使用这个特性，但是要注意，如果您忘记了这个更改，那么当您更改一个对象的默认功能时，可能会产生意想不到的行为。或者更糟的是，下一个开发您的代码的开发人员没有意识到这种变化。</p><p id="a557" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ne">最初发布于</em><a class="ae nd" href="https://fek.io/blog/should-i-use-monkey-patching-in-java-script/" rel="noopener ugc nofollow" target="_blank"><em class="ne">https://fek . io</em></a><em class="ne">。</em></p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ls l"/></div></figure><p id="19b7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ne">更多内容请看</em><a class="ae nd" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir"><em class="ne">plain English . io</em></strong></a></p></div></div>    
</body>
</html>