<html>
<head>
<title>The Most Minimalist Next.js TODO App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最简约的Next.js TODO应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-most-minimalist-next-js-todo-app-e7b28c80264?source=collection_archive---------13-----------------------#2021-07-09">https://javascript.plainenglish.io/the-most-minimalist-next-js-todo-app-e7b28c80264?source=collection_archive---------13-----------------------#2021-07-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="681b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何构建一个极简的基于Next.js的无服务器TODO应用？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/2018f93099ac2f22bd54b2c415ae19fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6gVBgsXN0tCr_S9aVYDYA.png"/></div></div></figure><p id="2dc2" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在本文中，我们将构建一个基于Next.js的无服务器TODO应用程序。我们会尽量做到极简。它不会有任何数据库连接。除了Next.js之外，它不会有任何额外的依赖项，也不会有任何按钮。此外，<code class="fe lk ll lm ln b">minimalism</code>很酷，很干净，我喜欢它，因为我是一个懒惰的开发者:)</p><h1 id="6960" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">为什么我们要避免数据库连接？</h1><p id="a4a1" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">Next.js是一个现代框架，它使前端开发人员能够开发全栈应用程序。对于Next.js开发人员来说，无服务器函数在简化后端开发方面有着重要的作用。您可能知道，无服务器函数不喜欢数据库连接，因为它们具有无状态的特性。参见<a class="ae ml" href="https://stackoverflow.com/questions/63208960/vercel-creates-new-db-connection-for-every-request" rel="noopener ugc nofollow" target="_blank">这里的</a>和<a class="ae ml" href="https://blog.upstash.com/serverless-database-connections" rel="noopener ugc nofollow" target="_blank">这里的</a>作为无服务器功能内部数据库连接问题的例子。</p><h1 id="926c" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">休息是一个答案</h1><p id="22f3" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">REST允许客户端和服务器在没有会话信息的情况下进行通信。这种无状态性及其简单的本质使得REST成为无服务器环境的完美通信协议。我们将使用REST访问<a class="ae ml" href="https://upstash.com/" rel="noopener ugc nofollow" target="_blank">upshosh Redis</a>。</p><h1 id="5b34" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">项目堆栈</h1><ul class=""><li id="27db" class="mm mn in kq b kr mg ku mh kx mo lb mp lf mq lj mr ms mt mu bi translated">前端:<a class="ae ml" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a></li><li id="c7de" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">后端:<a class="ae ml" href="https://vercel.com/docs/serverless-functions/introduction" rel="noopener ugc nofollow" target="_blank"> Vercel函数</a></li><li id="9ed7" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">数据库:<a class="ae ml" href="https://upstash.com/" rel="noopener ugc nofollow" target="_blank">用<a class="ae ml" href="https://docs.upstash.com/features/restapi" rel="noopener ugc nofollow" target="_blank"> REST API </a>更新Redis </a></li></ul><p id="7141" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">看演示:<a class="ae ml" href="https://nextjs-todo-zeta.vercel.app/" rel="noopener ugc nofollow" target="_blank">https://nextjs-todo-zeta.vercel.app/</a></p><p id="6550" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">参见代码:<a class="ae ml" href="https://github.com/upstash/examples/tree/master/nextjs-todo" rel="noopener ugc nofollow" target="_blank">https://github.com/upstash/examples/tree/master/nextjs-todo</a></p><h1 id="0d51" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">项目设置</h1><p id="29bd" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">创建一个Next.js应用:<code class="fe lk ll lm ln b">npx create-next-app</code></p><p id="419d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在AWS-US-EAST-1区域创建一个<a class="ae ml" href="https://console.upstash.com" rel="noopener ugc nofollow" target="_blank">upsh Redis数据库</a>，并复制其余的URL和令牌。</p><p id="2e2a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">该项目将是一个具有3个API端点的单页应用程序:</p><ul class=""><li id="cdda" class="mm mn in kq b kr ks ku kv kx na lb nb lf nc lj mr ms mt mu bi translated">pages/api/list.js:列出待办事项。</li><li id="ff76" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">pages/api/add.js:添加TODO项。</li><li id="c891" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">pages/api/remove.js:删除TODO项。</li></ul><h1 id="e1b1" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">代码</h1><p id="bdde" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">添加pages/api/list.js，如下所示:</p><pre class="kd ke kf kg gt nd ln ne nf aw ng bi"><span id="7094" class="nh lp in ln b gy ni nj l nk nl">export default async (req, res) =&gt; {<br/>   const token = "REPLACE_YOUR_TOKEN";<br/>   const url = "<a class="ae ml" href="https://REPLACE_YOUR_ENDPOINT/lrange/todo/0/100?_token=" rel="noopener ugc nofollow" target="_blank">https://REPLACE_YOUR_ENDPOINT/lrange/todo/0/100?_token=</a>" + token;</span><span id="9414" class="nh lp in ln b gy nm nj l nk nl">return fetch(url)<br/>       .then(r =&gt; r.json())<br/>       .then(data =&gt; {<br/>           let result = JSON.stringify(data.result)<br/>           return res.status(200).json(result)<br/>       })<br/>}</span></pre><p id="94b1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">添加pages/api/add.js，如下所示:</p><pre class="kd ke kf kg gt nd ln ne nf aw ng bi"><span id="572b" class="nh lp in ln b gy ni nj l nk nl">export default async (req, res) =&gt; {<br/>   if(!req.query.todo) {<br/>       return res.status(400).send("todo parameter required.")<br/>   }<br/>   let todo = encodeURI(req.query.todo)</span><span id="3bbe" class="nh lp in ln b gy nm nj l nk nl">const token = "REPLACE_YOUR_TOKEN";<br/>   const url = "<a class="ae ml" href="https://REPLACE_YOUR_ENDPOINT/lpush/todo/" rel="noopener ugc nofollow" target="_blank">https://REPLACE_YOUR_ENDPOINT/lpush/todo/</a>" + todo + "?_token=" + token;</span><span id="4b08" class="nh lp in ln b gy nm nj l nk nl">return fetch(url)<br/>       .then(r =&gt; r.json())<br/>       .then(data =&gt; {<br/>           let result = JSON.stringify(data.result)<br/>           return res.status(200).json(result)<br/>       })<br/>}</span></pre><p id="b841" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如下所示添加pages/api/remove.js:</p><pre class="kd ke kf kg gt nd ln ne nf aw ng bi"><span id="e51d" class="nh lp in ln b gy ni nj l nk nl">export default async (req, res) =&gt; {<br/>   if(!req.query.todo) {<br/>       return res.status(400).send("todo parameter required.")<br/>   }<br/>   let todo = encodeURI(req.query.todo)</span><span id="514d" class="nh lp in ln b gy nm nj l nk nl">const token = "REPLACE_YOUR_TOKEN";<br/>   const url = "<a class="ae ml" href="https://REPLACE_YOUR_ENDPOINT/lrem/todo/1/" rel="noopener ugc nofollow" target="_blank">https://REPLACE_YOUR_ENDPOINT/lrem/todo/1/</a>" + todo + "?_token=" + token;</span><span id="8b29" class="nh lp in ln b gy nm nj l nk nl">return fetch(url)<br/>       .then(r =&gt; r.json())<br/>       .then(data =&gt; {<br/>           let result = JSON.stringify(data.result)<br/>           return res.status(200).json(result)<br/>       })<br/>}</span></pre><p id="5705" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">更新pages/index.js，如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nn no l"/></div></figure><p id="748f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如您所见，这是一个使用钩子的基本React应用程序。我们有3个与API交互的方法:addTodo、removeTodo和loadTodos。</p><p id="5883" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，在这里将styles/Home.module.css文件更新为<a class="ae ml" href="https://github.com/upstash/examples/blob/master/nextjs-todo/styles/Home.module.css" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="0da9" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">运行和部署</h1><p id="7eed" class="pw-post-body-paragraph ko kp in kq b kr mg jo kt ku mh jr kw kx mi kz la lb mj ld le lf mk lh li lj ig bi translated">使用<code class="fe lk ll lm ln b">npm run dev</code>在本地运行您的项目。如果一切正常，您可以通过运行项目文件夹中的<code class="fe lk ll lm ln b">vercel</code>来部署您的项目。Vercel将为您的API函数创建无服务器函数。Vercel函数的默认区域是US-EAST-1，这就是为什么我们在同一个区域创建数据库。</p><h1 id="a235" class="lo lp in bd lq lr ls lt lu lv lw lx ly jt lz ju ma jw mb jx mc jz md ka me mf bi translated">笔记</h1><ul class=""><li id="9980" class="mm mn in kq b kr mg ku mh kx mo lb mp lf mq lj mr ms mt mu bi translated">将数据库令牌保存在<a class="ae ml" href="https://vercel.com/docs/environment-variables" rel="noopener ugc nofollow" target="_blank"> Vercel环境变量</a>中更安全。</li><li id="8875" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">为了提高性能，最好将无服务器功能和Redis数据库放在同一区域。</li><li id="e378" class="mm mn in kq b kr mv ku mw kx mx lb my lf mz lj mr ms mt mu bi translated">我们可以使用Redis客户端来代替REST API。但是正如我之前提到的，数据库连接会导致无服务器函数内部的问题。此外，请注意，我们没有看到Upstash REST API和native API之间的主要性能差异。</li></ul><p id="a2bb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">用<code class="fe lk ll lm ln b">npm run dev</code>在本地运行你的项目。如果一切正常，您可以通过运行项目文件夹中的<code class="fe lk ll lm ln b">vercel</code>来部署您的项目。Vercel将为您的API函数创建无服务器函数。Vercel函数的默认区域是US-EAST-1，这就是为什么我们在同一个区域创建数据库。</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="c2fb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nw">原载于2021年7月9日</em><a class="ae ml" href="https://blog.upstash.com/nextjs-todo" rel="noopener ugc nofollow" target="_blank"><em class="nw">https://blog.upstash.com</em></a><em class="nw">。</em></p><p id="f8e8" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nw">更多内容请看</em><a class="ae ml" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>