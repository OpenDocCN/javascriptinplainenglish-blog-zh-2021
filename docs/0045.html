<html>
<head>
<title>Why you should never use ‘npm install’ in your CI/CD pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么永远不应该在CI/CD管道中使用“npm install”</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/why-you-should-never-use-npm-install-in-your-ci-cd-pipelines-da0b89346d8d?source=collection_archive---------2-----------------------#2021-01-04">https://javascript.plainenglish.io/why-you-should-never-use-npm-install-in-your-ci-cd-pipelines-da0b89346d8d?source=collection_archive---------2-----------------------#2021-01-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="bafd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用非常简单的术语解释何时使用<code class="fe kl km kn ko b">npm ci</code>和<code class="fe kl km kn ko b">npm install</code>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/4a1b75d3e6e7c9cc65178f83ba0c0cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*27j5O6FSbZB11Ki_"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Photo by <a class="ae lf" href="https://unsplash.com/@cookiethepom" rel="noopener ugc nofollow" target="_blank">Cookie the Pom</a> on <a class="ae lf" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><p id="9e48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当开始一个新项目或克隆一个现有项目时，大多数人运行<code class="fe kl km kn ko b">npm install</code>或简写版本<code class="fe kl km kn ko b">npm i</code>，这很好。但是很有可能你已经无意中发现了一个叫做<code class="fe kl km kn ko b">npm ci</code>的类似命令。</p><p id="0b56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我经常在常规的CI/CD管道中看到<code class="fe kl km kn ko b">npm install</code>命令。起初听起来不错的东西可能会导致相当多的问题。<code class="fe kl km kn ko b">npm ci</code>命令中的<code class="fe kl km kn ko b">ci</code>代表“<em class="ln">全新安装”</em>或者如果对您有帮助，您也可以使用<em class="ln">“持续集成”</em>。因此，很明显，在您的管道中应该优先使用<code class="fe kl km kn ko b">npm install</code>。但是在你盲目听从我的建议，在你所有的管道中使用<code class="fe kl km kn ko b">npm ci</code>之前，让我们快速检查一下有什么不同。</p><p id="1f13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">尽管下面的定义并不完全符合NPM的官方文档，我还是试图用包含最常见用例的超级简单的术语来解释它们。</p><h2 id="39ae" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">npm安装</h2><p id="e9ad" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">它用于向您的<code class="fe kl km kn ko b">package.json</code>和<code class="fe kl km kn ko b">package-lock.json</code>添加依赖项，从而修改您的依赖项并将其安装到您的机器上。这对于开发来说绝对没问题，但是它不应该在您的管道中发生。你<strong class="jp ir">不想在你的管道中添加/修改任何文件。</strong></p><h2 id="7d81" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">npm ci</h2><p id="d52e" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">该命令仅依赖于<code class="fe kl km kn ko b">package.json</code>和<code class="fe kl km kn ko b">package-lock.json</code>中列出的依赖定义，并安装它们。但是它不会对你的文件做任何修改。另外，如果两个JSON文件中的定义没有100%一致，这个命令会抛出一个错误，这也意味着<strong class="jp ir">锁文件必须存在</strong>。因此，请务必将它添加到您的VCS中。除此之外，顾名思义，它会进行“全新安装”，这意味着任何现有的<code class="fe kl km kn ko b">node_modules</code>文件夹都会被删除。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="86ad" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">好吧，但是为什么这很重要？</h2><p id="935e" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">其实挺简单的。每当您启动CI/CD管道时，您都不希望由于不匹配的<code class="fe kl km kn ko b">package*.json</code>文件而导致任何不一致，这可能会导致与您本地的代码库不同。此外，您不希望在使用已经填充的<code class="fe kl km kn ko b">node_modules</code>文件夹时出现任何副作用。</p><p id="b04a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想象一下，如果你的开发人员只提交了<code class="fe kl km kn ko b">package.json</code>而没有提交<code class="fe kl km kn ko b">package-lock.json</code>会发生什么。如果JSON文件不再对齐，管道将不能确定现在使用哪个包。此外，管道可能会突然使用开发人员本地机器上没有的一些包，因此典型的<em class="ln">“但它在我的机器上工作”</em>可能会再次出现。</p><p id="ac7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您在CI/CD管道中想要的是不受任何副作用影响的高度一致、可重复的步骤。因此，运行特定管道的频率并不重要。当提供相同的参数(可选)时，它应该总是产生相同的结果，不管它是林挺、构建、测试还是部署您的软件。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><h2 id="952d" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">结论</h2><p id="d600" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我希望我能向您展示为什么在您的管道中使用<code class="fe kl km kn ko b">npm ci</code>命令和使用“普通”<code class="fe kl km kn ko b">npm install</code>引用是如此的重要。</p><p id="6bd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总结一下:</p><ul class=""><li id="e9d5" class="mm mn iq jp b jq jr ju jv jy mo kc mp kg mq kk mr ms mt mu bi translated">当你在本地机器上工作并想要安装/添加/修改依赖项时，使用<code class="fe kl km kn ko b">npm install</code>。</li><li id="d7ef" class="mm mn iq jp b jq mv ju mw jy mx kc my kg mz kk mr ms mt mu bi translated">当您在CI/CD管道上运行并希望提供可重复步骤的一致性时，请使用<code class="fe kl km kn ko b">npm ci</code>。</li></ul><p id="c8bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您花时间阅读我的文章。</p><h2 id="77ac" class="lo lp iq bd lq lr ls dn lt lu lv dp lw jy lx ly lz kc ma mb mc kg md me mf mg bi translated">你想联系吗？</h2><p id="6350" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">如果你想联系我，请在LinkedIn上联系我。</p><p id="c598" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另外，请随意查看我的书籍推荐📚。</p></div><div class="ab cl lg lh hu li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="ij ik il im in"><div class="kq kr ks kt gt na"><a href="https://mr-pascal.medium.com/my-book-recommendations-4b9f73bf961b" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">我的书籍推荐</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">在接下来的章节中，你可以找到我对所有日常生活话题的书籍推荐，它们对我帮助很大。</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no kz na"/></div></div></a></div><div class="np nq gp gr nr na"><a href="https://mr-pascal.medium.com/membership" rel="noopener follow" target="_blank"><div class="nb ab fo"><div class="nc ab nd cl cj ne"><h2 class="bd ir gy z fp nf fr fs ng fu fw ip bi translated">通过我的推荐链接加入Medium—Pascal Zwikirsch</h2><div class="nh l"><h3 class="bd b gy z fp nf fr fs ng fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ni l"><p class="bd b dl z fp nf fr fs ng fu fw dk translated">mr-pascal.medium.com</p></div></div><div class="nj l"><div class="ns l nl nm nn nj no kz na"/></div></div></a></div></div></div>    
</body>
</html>