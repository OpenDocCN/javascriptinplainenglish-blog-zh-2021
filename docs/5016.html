<html>
<head>
<title>How to Manage Object in Angular FormControl</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在角度窗体控件中管理对象</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-manage-object-in-angular-formcontrol-1fe6ce45364d?source=collection_archive---------4-----------------------#2021-10-11">https://javascript.plainenglish.io/how-to-manage-object-in-angular-formcontrol-1fe6ce45364d?source=collection_archive---------4-----------------------#2021-10-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="33d2" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何管理FormControl中的对象并处理输入的转换</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/40fd63960d5484f2f5a73de093de6ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCllHu5dxT7ITPPLPgkTeA.jpeg"/></div></div></figure></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><p id="212f" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">通常我们将<code class="fe lr ls lt lu b">FormControl</code>与<code class="fe lr ls lt lu b">string</code>或<code class="fe lr ls lt lu b">boolean</code>类型一起使用，因此它只管理简单的值。但是如果我们想要管理的不仅仅是原始数据类型呢？我们可以做到这一点，让我们看看怎么做。</p><p id="0a20" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">例如，在本教程中，我们将学习如何从同一个表单控件中获取国家代码和数字作为单独的实体，我们还将为其创建自定义输入，以处理UI和值之间的转换。</p><h1 id="0b15" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">电话课</h1><p id="b821" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated">假设我们有一个<code class="fe lr ls lt lu b">Telephone</code>类，它将保存相关的值:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="203f" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">接下来，让我们拿一个我们想要保持<code class="fe lr ls lt lu b">Telephone</code>的<code class="fe lr ls lt lu b">input[type=tel]</code>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f931" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">注意我们是如何在<code class="fe lr ls lt lu b">FormControl</code>中初始化新的<code class="fe lr ls lt lu b">Telephone</code>类的:</p><p id="e191" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在让我们来看看输出:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/b4a61ffa3288f75a7f145ae81a351746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*umdEtaz5Epwe7cTP"/></div></figure><p id="2265" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">您将注意到的第一件事是<code class="fe lr ls lt lu b">input</code>在其值中显示了<code class="fe lr ls lt lu b">[object] [Object]</code>，因为它是对象的字符串表示(在我们的例子中，它是<code class="fe lr ls lt lu b">Telephone</code>类的成员)。为了修正<code class="fe lr ls lt lu b">input</code>的值，我们可以简单地在<code class="fe lr ls lt lu b">Telephone</code>类中提供<code class="fe lr ls lt lu b">toString()</code>方法。您可以在<a class="ae mv" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString" rel="noopener ugc nofollow" target="_blank"> MDN文档</a>上了解更多信息。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="22f4" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">第二件事是<code class="fe lr ls lt lu b">FormControl</code>的值最初具有期望的<code class="fe lr ls lt lu b">Telephone</code>的结构。</p><p id="12f3" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">但是，如果您修改<code class="fe lr ls lt lu b">input</code>，<code class="fe lr ls lt lu b">FormControl</code>的值将变为<code class="fe lr ls lt lu b">string</code>。我们需要处理从UI到<code class="fe lr ls lt lu b">FormControl</code>的值转换。</p><p id="2a98" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">为此，我们将使用<code class="fe lr ls lt lu b">CustomValueAccessor</code>为<code class="fe lr ls lt lu b">input[type=tel]</code>创建一个自定义输入指令。</p><h1 id="48c5" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">电话的自定义输入</h1><p id="683d" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated"><code class="fe lr ls lt lu b">InputTelDirective</code>指令的初始代码如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><blockquote class="mw mx my"><p id="9917" class="kv kw mz kx b ky kz jo la lb lc jr ld na lf lg lh nb lj lk ll nc ln lo lp lq ig bi translated">如果您是第一次接触<code class="fe lr ls lt lu b">ControlValueAccessor</code>，您可以在以下位置了解更多信息:<a class="ae mv" href="https://indepth.dev/posts/1055/never-again-be-confused-when-implementing-controlvalueaccessor-in-angular-forms" rel="noopener ugc nofollow" target="_blank">在以角度形式实现ControlValueAccessor时不要再感到困惑</a>和<a class="ae mv" href="https://indepth.dev/posts/1467/how-to-use-controlvalueaccessor-to-enhance-date-input-with-automatic-conversion-and-validation" rel="noopener ugc nofollow" target="_blank">如何使用ControlValueAccessor通过自动转换和验证来增强日期输入</a></p></blockquote><p id="2efc" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">对于这个例子，我们只关心<code class="fe lr ls lt lu b">writeValue</code>和<code class="fe lr ls lt lu b">registerOnChange</code>。简单来说，<code class="fe lr ls lt lu b">writeValue</code>用于将<code class="fe lr ls lt lu b">FormControl</code>的值转换为UI值，<code class="fe lr ls lt lu b">registerOnChange</code>用于将UI值转换为<code class="fe lr ls lt lu b">FormControl</code>的值。</p><h1 id="1140" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">从UI到<code class="fe lr ls lt lu b">FormControl</code>的转换</h1><p id="8236" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated">我们将假设用户将以这种形式输入值:<code class="fe lr ls lt lu b">+CC-XXXXXX</code>，其中连字符(-)之前的字符组合成国家代码，其余的是实际的联系号码。请注意，这并不是一个强有力的指令，只是我们可以从中开始学习的东西。</p><p id="390e" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">为了处理这个问题，让我们首先在<code class="fe lr ls lt lu b">input</code>事件上添加一个监听器:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="3f92" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">接下来，让我们修改一下<code class="fe lr ls lt lu b">registerOnChange</code>方法:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8c1e" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在让我们看看输出:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/0be1db16291c0cdc06e0f4d2c35f4a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*e3_TV_neMhD0vti2"/></div></figure><p id="1a5d" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">很好用！它将UI值转换为有效的<code class="fe lr ls lt lu b">FormControl</code>值，即<code class="fe lr ls lt lu b">Telephone</code>类的成员。</p><h1 id="4f7f" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">从<code class="fe lr ls lt lu b">FormControl</code>到UI的转换</h1><p id="78d3" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated">如果您试图通过<code class="fe lr ls lt lu b">FormControl</code>设置初始状态，它不会反映在<code class="fe lr ls lt lu b">input</code>上:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="52a8" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们修改<code class="fe lr ls lt lu b">writeValue</code>方法来处理上述问题:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d5c0" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在通过<code class="fe lr ls lt lu b">FormControl</code>设置的值将反映到<code class="fe lr ls lt lu b">input</code>。</p><h1 id="8619" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">确认</h1><p id="03e7" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated">现在我们将添加验证部分，以便输入支持开箱即用的验证。</p><p id="138f" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我们将首先在提供者中添加<code class="fe lr ls lt lu b">NG_VALIDATORS</code>:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="dcb1" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">接下来，我们将在<code class="fe lr ls lt lu b">Telephone</code>类中添加<code class="fe lr ls lt lu b">isValid</code>方法来检查有效性:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="f56f" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">最后，我们将实现<code class="fe lr ls lt lu b">Validator</code>接口并添加<code class="fe lr ls lt lu b">validate</code>方法:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="9e06" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们修改模板以利用验证:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d43d" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">现在让我们看看输出:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/893d01e16c16119b28c21abef228bc2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*H32lzP0vafRuYLkQ"/></div></figure><h1 id="2638" class="lv lw in bd lx ly lz ma mb mc md me mf jt mg ju mh jw mi jx mj jz mk ka ml mm bi translated">结论</h1><p id="c402" class="pw-post-body-paragraph kv kw in kx b ky mn jo la lb mo jr ld le mp lg lh li mq lk ll lm mr lo lp lq ig bi translated">我们学习了如何管理<code class="fe lr ls lt lu b">FormControl</code>中的对象，并使用<code class="fe lr ls lt lu b">ControlValueAccessor</code>来处理转换。</p><p id="10d4" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">指令的完整代码如下所示:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="c82d" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">我还为上面的所有代码创建了一个<a class="ae mv" href="https://github.com/shhdharmen/multi-value-form-control" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。</p></div><div class="ab cl ko kp hr kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ig ih ii ij ik"><p id="5a69" class="pw-post-body-paragraph kv kw in kx b ky kz jo la lb lc jr ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated"><em class="mz">原发布于</em><a class="ae mv" href="https://indepth.dev/tutorials/angular/object-in-formcontrol" rel="noopener ugc nofollow" target="_blank">https://indepth . dev</a><em class="mz">。</em></p></div></div>    
</body>
</html>