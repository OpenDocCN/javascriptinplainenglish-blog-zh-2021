<html>
<head>
<title>Create a React Horizontal Stacked Bar Chart with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Visx库创建一个React水平堆积条形图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-react-horizontal-stacked-bar-chart-with-the-visx-library-fd6afe2cabdd?source=collection_archive---------12-----------------------#2021-03-28">https://javascript.plainenglish.io/create-a-react-horizontal-stacked-bar-chart-with-the-visx-library-fd6afe2cabdd?source=collection_archive---------12-----------------------#2021-03-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ac1477f200e661461403f4a3d09b31b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dm6c408J-0Cmg1V_"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@cocktailbart?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Johann Trasch</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="34b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx是一个库，让我们可以轻松地将图形添加到React应用程序中。</p><p id="5429" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将水平堆积条形图添加到React应用程序中。</p><h1 id="3ecb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/axis @visx/grid @visx/group @visx/legend @visx/mock-data @visx/responsive @visx/scale @visx/shape @visx/tooltip</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="4761" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">创建图表</h1><p id="04ad" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过添加模块提供的项目来创建图表。</p><p id="7bc9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们使用来自<code class="fe ms mt mu mj b">@visx/mock-data</code>模块的数据。</p><p id="7fee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了创建水平堆叠条形图，我们编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dee6" class="mn lc iq mj b gy mo mp l mq mr">import React from "react";<br/>import { BarStackHorizontal } from "@visx/shape";<br/>import { Group } from "@visx/group";<br/>import { AxisBottom, AxisLeft } from "@visx/axis";<br/>import cityTemperature from "@visx/mock-data/lib/mocks/cityTemperature";<br/>import { scaleBand, scaleLinear, scaleOrdinal } from "@visx/scale";<br/>import { timeParse, timeFormat } from "d3-time-format";<br/>import { Tooltip, defaultStyles, useTooltip } from "@visx/tooltip";<br/>import { LegendOrdinal } from "@visx/legend";</span><span id="0763" class="mn lc iq mj b gy mv mp l mq mr">const purple1 = "#6c5efb";<br/>const purple2 = "#c998ff";<br/>export const purple3 = "#a44afe";<br/>export const background = "#eaedff";<br/>const defaultMargin = { top: 40, left: 50, right: 40, bottom: 100 };<br/>const tooltipStyles = {<br/>  ...defaultStyles,<br/>  minWidth: 60,<br/>  backgroundColor: "rgba(0,0,0,0.9)",<br/>  color: "white"<br/>};</span><span id="abba" class="mn lc iq mj b gy mv mp l mq mr">const data = cityTemperature.slice(0, 12);<br/>const keys = Object.keys(data[0]).filter((d) =&gt; d !== "date");</span><span id="f453" class="mn lc iq mj b gy mv mp l mq mr">const temperatureTotals = data.reduce((allTotals, currentDate) =&gt; {<br/>  const totalTemperature = keys.reduce((dailyTotal, k) =&gt; {<br/>    dailyTotal += Number(currentDate[k]);<br/>    return dailyTotal;<br/>  }, 0);<br/>  allTotals.push(totalTemperature);<br/>  return allTotals;<br/>}, []);</span><span id="fce4" class="mn lc iq mj b gy mv mp l mq mr">const parseDate = timeParse("%Y-%m-%d");<br/>const format = timeFormat("%b %d");<br/>const formatDate = (date) =&gt; format(parseDate(date));</span><span id="4e9b" class="mn lc iq mj b gy mv mp l mq mr">const getDate = (d) =&gt; d.date;<br/>const temperatureScale = scaleLinear({<br/>  domain: [0, Math.max(...temperatureTotals)],<br/>  nice: true<br/>});<br/>const dateScale = scaleBand({<br/>  domain: data.map(getDate),<br/>  padding: 0.2<br/>});<br/>const colorScale = scaleOrdinal({<br/>  domain: keys,<br/>  range: [purple1, purple2, purple3]<br/>});</span><span id="46b1" class="mn lc iq mj b gy mv mp l mq mr">let tooltipTimeout;</span><span id="3b1c" class="mn lc iq mj b gy mv mp l mq mr">const Example = ({ width, height, events = false, margin = defaultMargin }) =&gt; {<br/>  const {<br/>    tooltipOpen,<br/>    tooltipLeft,<br/>    tooltipTop,<br/>    tooltipData,<br/>    hideTooltip,<br/>    showTooltip<br/>  } = useTooltip();<br/>  const xMax = width - margin.left - margin.right;<br/>  const yMax = height - margin.top - margin.bottom;</span><span id="dd34" class="mn lc iq mj b gy mv mp l mq mr">temperatureScale.rangeRound([0, xMax]);<br/>  dateScale.rangeRound([yMax, 0]);</span><span id="9128" class="mn lc iq mj b gy mv mp l mq mr">return width &lt; 10 ? null : (<br/>    &lt;div&gt;<br/>      &lt;svg width={width} height={height}&gt;<br/>        &lt;rect width={width} height={height} fill={background} rx={14} /&gt;<br/>        &lt;Group top={margin.top} left={margin.left}&gt;<br/>          &lt;BarStackHorizontal<br/>            data={data}<br/>            keys={keys}<br/>            height={yMax}<br/>            y={getDate}<br/>            xScale={temperatureScale}<br/>            yScale={dateScale}<br/>            color={colorScale}<br/>          &gt;<br/>            {(barStacks) =&gt;<br/>              barStacks.map((barStack) =&gt;<br/>                barStack.bars.map((bar) =&gt; (<br/>                  &lt;rect<br/>                    key={`barstack-horizontal-${barStack.index}-${bar.index}`}<br/>                    x={bar.x}<br/>                    y={bar.y}<br/>                    width={bar.width}<br/>                    height={bar.height}<br/>                    fill={bar.color}<br/>                    onClick={() =&gt; {<br/>                      if (events) alert(`clicked: ${JSON.stringify(bar)}`);<br/>                    }}<br/>                    onMouseLeave={() =&gt; {<br/>                      tooltipTimeout = window.setTimeout(() =&gt; {<br/>                        hideTooltip();<br/>                      }, 300);<br/>                    }}<br/>                    onMouseMove={() =&gt; {<br/>                      if (tooltipTimeout) clearTimeout(tooltipTimeout);<br/>                      const top = bar.y + margin.top;<br/>                      const left = bar.x + bar.width + margin.left;<br/>                      showTooltip({<br/>                        tooltipData: bar,<br/>                        tooltipTop: top,<br/>                        tooltipLeft: left<br/>                      });<br/>                    }}<br/>                  /&gt;<br/>                ))<br/>              )<br/>            }<br/>          &lt;/BarStackHorizontal&gt;<br/>          &lt;AxisLeft<br/>            hideAxisLine<br/>            hideTicks<br/>            scale={dateScale}<br/>            tickFormat={formatDate}<br/>            stroke={purple3}<br/>            tickStroke={purple3}<br/>            tickLabelProps={() =&gt; ({<br/>              fill: purple3,<br/>              fontSize: 11,<br/>              textAnchor: "end",<br/>              dy: "0.33em"<br/>            })}<br/>          /&gt;<br/>          &lt;AxisBottom<br/>            top={yMax}<br/>            scale={temperatureScale}<br/>            stroke={purple3}<br/>            tickStroke={purple3}<br/>            tickLabelProps={() =&gt; ({<br/>              fill: purple3,<br/>              fontSize: 11,<br/>              textAnchor: "middle"<br/>            })}<br/>          /&gt;<br/>        &lt;/Group&gt;<br/>      &lt;/svg&gt;<br/>      &lt;div<br/>        style={{<br/>          position: "absolute",<br/>          top: margin.top / 2 - 10,<br/>          width: "100%",<br/>          display: "flex",<br/>          justifyContent: "center",<br/>          fontSize: "14px"<br/>        }}<br/>      &gt;<br/>        &lt;LegendOrdinal<br/>          scale={colorScale}<br/>          direction="row"<br/>          labelMargin="0 15px 0 0"<br/>        /&gt;<br/>      &lt;/div&gt;<br/>      {tooltipOpen &amp;&amp; tooltipData &amp;&amp; (<br/>        &lt;Tooltip top={tooltipTop} left={tooltipLeft} style={tooltipStyles}&gt;<br/>          &lt;div style={{ color: colorScale(tooltipData.key) }}&gt;<br/>            &lt;strong&gt;{tooltipData.key}&lt;/strong&gt;<br/>          &lt;/div&gt;<br/>          &lt;div&gt;{tooltipData.bar.data[tooltipData.key]}℉&lt;/div&gt;<br/>          &lt;div&gt;<br/>            &lt;small&gt;{formatDate(getDate(tooltipData.bar.data))}&lt;/small&gt;<br/>          &lt;/div&gt;<br/>        &lt;/Tooltip&gt;<br/>      )}<br/>    &lt;/div&gt;<br/>  );<br/>};</span><span id="317d" class="mn lc iq mj b gy mv mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="846e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe ms mt mu mj b">purple</code>、<code class="fe ms mt mu mj b">purple2</code>和<code class="fe ms mt mu mj b">purple3</code>变量来设置条形的颜色。</p><p id="7d39" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">background</code>有背景色。</p><p id="f1ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">defaultMargin</code>为图表留有页边距。</p><p id="ca8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有工具提示的样式。</p><p id="2b47" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">data</code>有条形的数据。</p><p id="b835" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">keys</code>有y轴的数据。</p><p id="8b04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们计算<code class="fe ms mt mu mj b">temperatureTotals</code>，以便确定x轴的最大值。</p><p id="5747" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们使用<code class="fe ms mt mu mj b">parseDate</code>和<code class="fe ms mt mu mj b">format</code>函数来解析数据中的日期，并将它们格式化以显示在y轴上。</p><p id="2503" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们为x轴创建<code class="fe ms mt mu mj b">temperatureScale</code>。</p><p id="6609" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">dateScale</code>为y轴。</p><p id="dd2c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">colorScale</code>用于堆叠的棒材。</p><p id="73ca" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们创建<code class="fe ms mt mu mj b">Example</code>组件来添加图表。</p><p id="af1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe ms mt mu mj b">useTooltip</code>钩子来返回一个对象，让我们呈现工具提示来显示数据值。</p><p id="2e0e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">BarStackHorizontal</code>组件具有用于水平堆叠条的容器。</p><p id="6e29" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将比例设置为<code class="fe ms mt mu mj b">xScale</code>和<code class="fe ms mt mu mj b">yScale</code>道具的值。</p><p id="da52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">color</code>设置色阶。</p><p id="0283" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">BarStackHorizontal</code>组件的子组件中，我们为条形渲染矩形。</p><p id="8eaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是我们添加<code class="fe ms mt mu mj b">onMouseMove</code>道具的地方，当我们移动鼠标时，它会显示带有条形数据的工具提示。</p><p id="23a6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当鼠标离开工具栏时，我们调用<code class="fe ms mt mu mj b">hideTooltip</code>来隐藏工具提示。</p><p id="a169" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">AxisLeft</code>有y轴，显示日期。</p><p id="de93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe ms mt mu mj b">AxisBottom</code>具有带温度数据的x轴。</p><p id="2c83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们为带有<code class="fe ms mt mu mj b">LegendOrdinal</code>组件的条形添加图例。</p><p id="2f93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">并且<code class="fe ms mt mu mj b">Tooltip</code>组件有工具提示。</p><h1 id="1e99" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="0815" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用Visx库在React应用程序中添加水平堆叠条形图。</p><p id="3ee4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p><p id="860d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容请看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>