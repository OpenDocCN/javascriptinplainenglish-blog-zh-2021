<html>
<head>
<title>Understanding Hooks Part 3— useState</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">理解钩子第3部分——使用状态</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/hooks-part-3-usestate-26a622bbe462?source=collection_archive---------12-----------------------#2021-05-09">https://javascript.plainenglish.io/hooks-part-3-usestate-26a622bbe462?source=collection_archive---------12-----------------------#2021-05-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="9046" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">传说中的React钩子背后是什么？有时候，我会想。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8e42cee1f7d92219ceebab9b4725eb57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FLKP6AXotB79tG2MHWeheA.jpeg"/></div></div></figure><p id="4c6c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在<a class="ae ku" href="https://windmaomao.medium.com/hooks-part-2-useeffect-2fa1a377c124" rel="noopener">第二部分</a> , <code class="fe kv kw kx ky b">useEffect</code>及其所有用法都被详细考察了。在第3部分中，我们将继续深入探讨<code class="fe kv kw kx ky b">useState</code>。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="24e8" class="ld le in ky b gy lf lg l lh li">function Component() {<br/>  const [<strong class="ky io">value</strong>, <strong class="ky io">setValue</strong>] = useState(<strong class="ky io">initialValue</strong>);<br/>  ...<br/>  return (&lt;div /&gt;)<br/>}</span></pre><p id="c442" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用初始值初始化<code class="fe kv kw kx ky b">state</code>。需要时，通过调用<code class="fe kv kw kx ky b">setState</code>通知<code class="fe kv kw kx ky b">Element</code>新值。</p><h2 id="08d9" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">价值</h2><p id="875d" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">提供的<code class="fe kv kw kx ky b">value</code>可以直接用于<code class="fe kv kw kx ky b">Component</code>定义。并且它可以被进一步发送到子组件中。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="bcdf" class="ld le in ky b gy lf lg l lh li">function Component() {<br/>  const [<strong class="ky io">value</strong>, <strong class="ky io">setValue</strong>] = <strong class="ky io">useState</strong>(<strong class="ky io">initialValue</strong>)<br/>  const onChange = e =&gt; {<br/>    <strong class="ky io">setValue</strong>(e.target.value)<br/>  }<br/>  return (<br/>    &lt;&gt;<br/>      value: {value}<br/>      &lt;input value={<strong class="ky io">value</strong>} onChange={onChange} /&gt;<br/>      &lt;ChildComponent value={<strong class="ky io">value</strong>} /&gt;<br/>    &lt;/&gt;<br/>  )<br/>}</span></pre><p id="3cc7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该值可以是简单的数字和字符串，也可以是复杂的对象，实际上可以是Javascript中的任何内容。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="7582" class="ld le in ky b gy lf lg l lh li">const [<strong class="ky io">value</strong>] = useState({ <strong class="ky io">name</strong>, <strong class="ky io">func</strong>, ...<strong class="ky io">anything</strong> })</span></pre><h2 id="7192" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">设置值</h2><p id="d7f9" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">用<code class="fe kv kw kx ky b">setValue</code>替换该值。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="3eaa" class="ld le in ky b gy lf lg l lh li">setValue(name)<br/>// replace property name<br/>setValue({ ...value, name })<br/>// append to array<br/>setValue([ ...values, { name })</span></pre><p id="0226" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果值需要在设置前解析，可以用函数代替。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="8726" class="ld le in ky b gy lf lg l lh li">const reducer = prev =&gt; prev + 1<br/><strong class="ky io">setValue</strong>(reducer)</span></pre><p id="9732" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可能想要使用一个函数的原因之一是它可能依赖于先前的值，就像一个<code class="fe kv kw kx ky b">reducer</code>。或者以后再解决，作为一个懒值。</p><p id="44ce" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦设置了新值，它就会请求<code class="fe kv kw kx ky b">Element</code>进行更新。在下一个周期，用户界面将反映这一变化。</p><h2 id="0764" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">更新</h2><p id="a20f" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated"><code class="fe kv kw kx ky b">setValue</code>请求主机元素更新的事实。为了让其他组件使用它，可以通过<code class="fe kv kw kx ky b">props</code>传递给其他组件。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="1ff7" class="ld le in ky b gy lf lg l lh li">function Component() {<br/>  const [, <strong class="ky io">setValue</strong>] = <strong class="ky io">useState</strong>(0)<br/>  return &lt;ChildComponent setValue={set<strong class="ky io">Value</strong>} /&gt;<br/>}</span></pre><p id="f20b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这个函数可以被传递，传递给一个父母，传递给一个孩子，传递给一个<code class="fe kv kw kx ky b">context</code>，甚至被收集为<code class="fe kv kw kx ky b">updates</code>。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="b3f0" class="ld le in ky b gy lf lg l lh li">const updates = [setValue1, setValue2, ...]<br/>updates.forEach(set =&gt; { set(value) })</span></pre><h2 id="91f1" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated"><em class="mf">原始的</em></h2><p id="ab0c" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated"><code class="fe kv kw kx ky b">value</code>可以是<em class="mg">原语</em>类型，如1或“字符串”。如果您需要传递这个值，特别是在一些延迟的时间，请记住这个值不是未来的证据。</p><pre class="kj kk kl km gt kz ky la lb aw lc bi"><span id="c5ef" class="ld le in ky b gy lf lg l lh li">const [value, setValue] = useState(0)<br/>const doSomethingAboutIt = v =&gt; { <br/>  setTimeout(() =&gt; { console.log(v) }, 10000) <br/>}<br/>doSomethingAboutIt(<strong class="ky io">value</strong>)</span></pre><p id="467d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe kv kw kx ky b">v</code>并不总是指向当前的<code class="fe kv kw kx ky b">value</code>，因为<code class="fe kv kw kx ky b">Component</code>可能已经被渲染了多次，每次渲染都会分配一个新的<code class="fe kv kw kx ky b">value.</code>副本</p><h2 id="05d2" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">笔记</h2><p id="f985" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated">在每个渲染中都运行一个钩子。第一次运行时设置一次<code class="fe kv kw kx ky b">useState</code>的初始值。在每次渲染过程中，会将该值与以前的版本进行比较。如果检测到变化，则接受新值。然而，这种情况不会发生在<code class="fe kv kw kx ky b">setValue</code>功能上，该功能在第一次运行时被设置，此后被(重新)使用。</p><p id="c0fe" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">该值可以是一个新的实例。</strong>初始值和设定函数都不是。</p><h2 id="16cd" class="ld le in bd lj lk ll dn lm ln lo dp lp jv lq lr ls jz lt lu lv kd lw lx ly lz bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="191e" class="pw-post-body-paragraph jk jl in jm b jn ma jp jq jr mb jt ju jv mc jx jy jz md kb kc kd me kf kg kh ig bi translated"><code class="fe kv kw kx ky b">useState</code>分配一个值，并允许设置该值以请求元素更新。它还允许在设置值时使用函数。该值可以是没有引用跟踪的原始值。</p><h1 id="dbe7" class="mh le in bd lj mi mj mk lm ml mm mn lp mo mp mq ls mr ms mt lv mu mv mw ly mx bi translated">索引</h1><ul class=""><li id="ea2d" class="my mz in jm b jn ma jr mb jv na jz nb kd nc kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/hook-myth-from-react-9495aa8ad7af" rel="noopener">第一部分，元素</a></li><li id="b432" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/hooks-part-2-useeffect-2fa1a377c124" rel="noopener">第二部分，使用效果</a></li><li id="29a3" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated">第3部分，使用状态你在这里</li><li id="9db9" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-4-hook-c7a8c7185f4e" rel="noopener">第四部分，挂钩</a></li><li id="9cce" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-5-custom-hook-985b83c8bfea" rel="noopener">第5部分，自定义挂钩</a></li><li id="0264" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-6-usecontext-7ece0c0818e3" rel="noopener">第6部分，使用上下文</a></li><li id="b989" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-7-state-management-84ff636834a7" rel="noopener">第七部分，状态管理</a></li><li id="f277" class="my mz in jm b jn nh jr ni jv nj jz nk kd nl kh nd ne nf ng bi translated"><a class="ae ku" href="https://windmaomao.medium.com/understanding-hooks-part-8-four-body-problem-8f70b212356d" rel="noopener">第八部，四体问题</a></li></ul><p id="fcb4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mg">更多内容请看</em><a class="ae ku" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mg">plain English . io</em></a></p></div></div>    
</body>
</html>