<html>
<head>
<title>Twitch Customization Level OMEGA: Make Your Chatbot Report your League of Legends Rank — Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Twitch定制等级OMEGA:让你的聊天机器人报告你的英雄联盟等级——第二部分</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/twitch-customization-level-omega-part-2-d91697bce4c2?source=collection_archive---------5-----------------------#2021-09-14">https://javascript.plainenglish.io/twitch-customization-level-omega-part-2-d91697bce4c2?source=collection_archive---------5-----------------------#2021-09-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="e14c" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">推趣</h2><div class=""/><div class=""><h2 id="b174" class="pw-subtitle-paragraph jt iw in bd b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk dk translated">让你的聊天机器人报告你的英雄联盟排名从Riot的API一个现有的tmi.js | Node.js聊天机器人</h2></div><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7ee1ff79f553c2da3fbc1e782d630a0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mElAu8XiZTYRWg7yC1eHZA.png"/></div></div></figure><p id="ee94" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在这篇文章中，我将向你展示如何让一个<a class="ae lt" href="https://tmijs.com/" rel="noopener ugc nofollow" target="_blank"> tmi.js </a>机器人(比如我们在上一篇文章中构建的那个)向你的Twitch聊天报告你的英雄联盟等级、等级和LP。</p><p id="44cd" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">为此，我们将使用异步函数来查询<a class="ae lt" href="https://developer.riotgames.com/" rel="noopener ugc nofollow" target="_blank"> Riot的(免费)开发者API </a>以获取您的排名信息。</p><p id="2c94" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">接下来，我们将设置我们的tmi.js机器人，用<code class="fe lu lv lw lx b">!rank </code>命令将这些查询的结果发送到我们的Twitch聊天。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="f282" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated"><code class="fe lu lv lw lx b">Part 2 of x</code></h2><p id="9e3e" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">这是Twitch定制系列的一部分。</p><p id="9005" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在本系列中，我假设您已经阅读了早期的文章。</p><p id="4575" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">但是，如果您有一个运行在Node.js服务器上的现有tmi.js聊天机器人，我们在这里写的应该很容易适合您现有的代码。</p><ul class=""><li id="0d9f" class="nc nd in kz b la lb ld le lg ne lk nf lo ng ls nh ni nj nk bi translated"><a class="ae lt" href="https://medium.com/@thompsonplyler/twitch-customization-level-omega-part-1-writing-your-own-twitch-bot-with-node-js-and-tmi-js-f5e724737829" rel="noopener"> Twitch定制级别OMEGA —第1部分:用Node.js和tmi.js编写自己的Twitch机器人</a></li></ul></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="c34f" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">或者你可以…</h2><p id="2d0c" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">本文的重点是提供一种有趣的方法来处理需要密钥的外部API请求，并将该请求的结果打包到Twitch聊天室中。</p><p id="f1bf" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">虽然我们为此使用了Riot的开发者API，但如果你想要的只是一个自动工具来显示你的英雄联盟排名，我建议你使用这些预打包的解决方案之一:</p><p id="9335" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">1.)可以使用<a class="ae lt" href="https://nightbot.tv/" rel="noopener ugc nofollow" target="_blank"> Nightbot </a>上的内置宏。我不会详细说明如何做到这一点，但是简单地说，要获得你的英雄联盟等级，可以使用消息<code class="fe lu lv lw lx b">$(leagueoflegends your_summoner_name your_region).</code>定制一个<a class="ae lt" href="https://nightbot.tv/" rel="noopener ugc nofollow" target="_blank"> Nightbot </a>命令:不需要Node.js</p><p id="2ecf" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">2.)还有一个非常酷的小工具，你可以添加到OBS或OBS Studio，名为<a class="ae lt" href="https://lobobot.com/" rel="noopener ugc nofollow" target="_blank"> Lobo Bot </a>，它可以让你在流视频上显示实时更新的动态图形。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/274d55c4a286307e73f242093cc236a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*8-yX6UF0GzGQrYC87UWDtg.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">Lobo Bot</figcaption></figure><p id="de88" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">3.)最后，有一个非常有用的聊天机器人叫做<a class="ae lt" href="https://lolrankbot.com/" rel="noopener ugc nofollow" target="_blank"> LoLRankBot </a>，我从来没有用过，但它似乎以一种基本上是交钥匙的方式提供了我们将要到达这里的所有信息。如果你使用了LoLRankBot并且讨厌它，请告诉我，我会把它从这个列表中删除！</p><p id="5e07" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们都是为了更聪明地工作，而不是更努力地工作，所以如果你只是想在你的流或聊天中显示你的英雄联盟排名，我希望上述服务能满足你的需求。</p><p id="00f1" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">所以我们结束了，对吗？</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/d470db8f6308e0e4d48b7c3d455973bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*bW4Hr2_FAK4pN-Af"/></div></div></figure><p id="6048" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">当然不是！</p><p id="aa11" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">如果你想解开Riot给我们的所有酷数据，比如在<a class="ae lt" href="http://op.gg" rel="noopener ugc nofollow" target="_blank"> op.gg </a>、<a class="ae lt" href="http://u.gg" rel="noopener ugc nofollow" target="_blank"> u.gg </a>和<a class="ae lt" href="https://mobalytics.gg/" rel="noopener ugc nofollow" target="_blank"> Mobalytics </a>的难以置信的分析工具，这是最好的开始。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="987d" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">不是我，是你</h2><p id="1ae9" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">在第一篇文章中，我提到我使用了一个<a class="ae lt" href="https://guides.rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Ruby on Rails </a>后端来处理对Riot的API的请求。这源于我最初开始处理Riot的API以将游戏信息写入ReactJS前端的事实。这意味着我需要通过后端屏蔽对riot API的请求，老实说，我使用了Rails后端，因为我喜欢使用Rails，我是❤️·鲁比，我可以非常快速地编写Rails API。</p><p id="52d1" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">尽管本系列的既定目标是提供关于我如何制作高度模块化的Twitch频道的信息，但说实话:整个Rails后端对于这个项目来说是多余的。</p><p id="bddd" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我将在本系列的后面回到Rails，但是现在，由于本教程假设您已经为我们的tmi.js聊天机器人运行了Node.js服务器，这意味着我们可以使用现有的聊天机器人来请求和提供我们从Riot的API请求的信息。</p></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="5523" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">步骤0 —依赖关系</h2><p id="77ac" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">如果您是从本系列的第一篇文章开始的，我们要添加到项目中的唯一库是<code class="fe lu lv lw lx b">node-fetch</code>，让我们在Node.js项目中使用<a class="ae lt" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>。</p><p id="ce01" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lu lv lw lx b">npm install node-fetch --save</code></p><h2 id="07de" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">步骤1 —获取您的Riot开发人员API密钥</h2><p id="abcd" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">从Riot获取密钥的过程非常简单。用电子邮件地址注册。</p><p id="1ede" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">在你注册并登录后，你将能够通过点击开发者主页上的<a class="ae lt" href="https://developer.riotgames.com" rel="noopener ugc nofollow" target="_blank">https://developer.riotgames.com</a>按钮获得你的开发API密匙。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nr"><img src="../Images/6aaa201561163fb4cf847fe0133c47da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uwBDnX_deOI4NwzX_cInZQ.png"/></div></div></figure><p id="0da1" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">Riot为第三方开发者提供了很多工具，其中大部分在<a class="ae lt" href="https://developer.riotgames.com/docs/portal" rel="noopener ugc nofollow" target="_blank">他们的文档</a>中有很好的解释。在这里，您可以探索如何访问客户端API，它处理英雄联盟客户端前端，或者您可以学习如何使用游戏内API，它为正在进行的游戏提供实时客户端数据。你还可以访问Riot的其他游戏的不同API，如《T4》、《神秘传说》和《Valorant》。探索不同的选择可能会激发你的创造力，所以一定要四处看看！</p><p id="7049" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">需要注意的一点是<strong class="kz ix"> Riot起初只为想要访问其API的人提供开发者密钥。</strong>这些开发者密钥必须每24小时手动更新一次。您可以为您项目申请一个永久的生产密钥(它也有一个更高的请求率的阈值)，但是要做好长期等待的准备，而且不是每个项目都可以申请生产密钥。</p><p id="597c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们需要两样东西来从Riot API端点获取我们的排名。</p><ol class=""><li id="d210" class="nc nd in kz b la lb ld le lg ne lk nf lo ng ls ns ni nj nk bi translated">您的API密钥，我们将把它放在。我们根目录下的env文件。</li><li id="e266" class="nc nd in kz b la nt ld nu lg nv lk nw lo nx ls ns ni nj nk bi translated">我们想要的端点来报告我们的等级。</li></ol><p id="0946" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">所有Riot API端点都遵循相同的命名系统。端点URL的第一部分对应于我们正在查询的帐户所在的地区:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/26146eae822afd6c85eada5c7fe591a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*72XvzsMqJeLu-7EJ7jFvXg.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">regional prefixes for LoL API endpoints</figcaption></figure><p id="fd41" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">接下来是URI的其他地方，以获取我们需要的信息。</p><p id="6a03" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">(顺便说一下，该表来自文档。)</p><p id="ca1f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">由于英雄联盟在世界各地都有服务器，您可以构建一个应用程序，让您的用户查询不同的地区，但对于我们的简单应用程序，我们将查询北美地区的用户。</p><p id="2f94" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">此外，要请求关于召唤师等级的信息，我们不能只给Riot API我们的召唤师名称。相反，我们必须首先找到与他们的帐户相关联的唯一召唤师ID，并使用<em class="nz">来查询所述召唤师的等级。</em></p><p id="9825" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">因此，我们需要从英雄联盟开发者API返回我们的等级的两个端点是:</p><p id="ebde" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lu lv lw lx b"><a class="ae lt" href="https://na1.api.riotgames.com" rel="noopener ugc nofollow" target="_blank">https://na1.api.riotgames.com</a><a class="ae lt" href="https://developer.riotgames.com/apis#summoner-v4/GET_getBySummonerName" rel="noopener ugc nofollow" target="_blank">/lol/summoner/v4/summoners/by-name/{summonerName}</a></code></p><p id="fe47" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这将返回我们需要的召唤师ID，并且</p><p id="ec5c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><code class="fe lu lv lw lx b"><a class="ae lt" href="https://na1.api.riotgames.com" rel="noopener ugc nofollow" target="_blank">https://na1.api.riotgames.com</a><a class="ae lt" href="https://developer.riotgames.com/apis#league-v4/GET_getLeagueEntriesForSummoner" rel="noopener ugc nofollow" target="_blank">/lol/league/v4/entries/by-summoner/{encryptedSummonerId}</a></code></p><p id="c22d" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这将返回我们需要的关于那个召唤师的信息。</p><h2 id="1aeb" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">步骤2—在聊天机器人中检索API信息</h2><p id="3817" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">我们在index.js文件中编写的tmi.js bot的当前代码如下所示:</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="ef05" class="mf mg in lx b gy oe of l og oh">const tmi = require('tmi.js');<br/>require('dotenv').config({path: __dirname + '/.env'})</span><span id="4723" class="mf mg in lx b gy oi of l og oh">const client = new tmi.Client({<br/>  connection: {<br/>    secure: true,<br/>    reconnect: true<br/>  },<br/>  identity: {<br/>    username: 'literally_anything_without_a_space',<br/>    password: `${process.env.PUBSUBPASSWORD}`<br/>},<br/>  channels: [ 'your_channel_name' ]<br/>});</span><span id="10fb" class="mf mg in lx b gy oi of l og oh">client.connect();</span><span id="f979" class="mf mg in lx b gy oi of l og oh">client.on('message', (channel, tags, message, self) =&gt; {<br/>  if(self) return;</span><span id="7164" class="mf mg in lx b gy oi of l og oh">if(message.toLowerCase() === '!marco') {<br/>    client.say(channel, `Polo!`);<br/>  }<br/>}</span></pre><p id="d2d0" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">为了将bot连接到Riot API，我们将把我们的节点获取库添加到bot，然后我们将把我们的Riot API密钥复制到我们的。环境文件。</p><p id="4c1a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">所以我们的<code class="fe lu lv lw lx b">index.js</code>的顶部现在看起来像这样:</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="bcc5" class="mf mg in lx b gy oe of l og oh">const tmi = require('tmi.js');<br/>// require the node-fetch library<br/>const fetch = require('node-fetch')<br/>require('dotenv').config({path: __dirname + '/.env'})</span></pre><p id="331e" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">我们的<code class="fe lu lv lw lx b">.env</code>文件将如下所示:</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="0b4c" class="mf mg in lx b gy oe of l og oh">PUBSUBPASSWORD=oauth:topsecretstuff<br/>API_KEY=RGAPI-more-top-secret-stuff</span></pre><p id="60f5" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">(在上一篇文章中，我们讨论了添加。env到你的。gitignore文件，这样您就不会意外地在公共存储库中暴露您的API密钥。如果你不清楚如何做到这一点，请参阅我在上一篇文章中的说明。)</p><p id="8e00" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">接下来，我们将添加Fetch请求来查询Riot API。在早期，下面的代码会有一堆。then()表达式来处理Fetch承诺，在<em class="nz">之前，我们必须使用<a class="ae lt" href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest" rel="noopener ugc nofollow" target="_blank">笨拙的XHR语法。</a></em></p><p id="37a4" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">幸运的是，我是在2021年末写这篇文章的，我们有幸拥有async/await语法来处理异步函数。</p><p id="ad5a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">对于您的代码，用适当的值替换<code class="fe lu lv lw lx b">YOUR_SUMMONER_NAME </code>。</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="dcbd" class="mf mg in lx b gy oe of l og oh">// ...require modules<br/>// ...tmi.js "client.on('message', (channel, tags, message, self)" code<br/>// we will pass the channel variable to the rankFetch() function</span><span id="977d" class="mf mg in lx b gy oi of l og oh">const rankFetch = async (channel) =&gt; {</span><span id="2ab8" class="mf mg in lx b gy oi of l og oh">// first endpoint to acquire summoner id<br/> <br/>const accountUrl = `https://na1.api.riotgames.com/lol/summoner/v4/summoners/by-name/INSERT_SUMMONER_NAME?api_key=${process.env.API_KEY}`</span><span id="a8c0" class="mf mg in lx b gy oi of l og oh">let result = <em class="nz">await</em> fetch(accountUrl)</span><span id="4ade" class="mf mg in lx b gy oi of l og oh">// we select the "id" from the numerous possible return values.</span><span id="5081" class="mf mg in lx b gy oi of l og oh">const id = JSON.parse(<em class="nz">await</em> result.text()).id</span><span id="d55f" class="mf mg in lx b gy oi of l og oh">// second endpoint where we use the id we just obtained<br/>// note the template literal where we insert the ${id} into<br/>// our request as part of our parameters</span><span id="28ee" class="mf mg in lx b gy oi of l og oh">const rankUrl = <em class="nz">await</em> `https://na1.api.riotgames.com/lol/league/v4/entries/by-summoner/${id}?api_key=${process.env.API_KEY}`</span><span id="c79b" class="mf mg in lx b gy oi of l og oh">result = <em class="nz">await</em> fetch(rankUrl)</span><span id="de79" class="mf mg in lx b gy oi of l og oh">// the data comes back as text from Riot, so we have to JSON.parse()<br/>// to use it like a JavaScript object.</span><span id="d37b" class="mf mg in lx b gy oi of l og oh">data = JSON.parse(<em class="nz">await</em> result.text())</span><span id="a467" class="mf mg in lx b gy oi of l og oh">// pass the information to a function that will report it to the chatbot</span><span id="4458" class="mf mg in lx b gy oi of l og oh">rankSpeak(channel,data)</span><span id="1fc9" class="mf mg in lx b gy oi of l og oh">}</span><span id="08c9" class="mf mg in lx b gy oi of l og oh">// the function that reports to the chatbot, eventually...<br/>const rankSpeak = (channel,data) =&gt; {</span><span id="874c" class="mf mg in lx b gy oi of l og oh">console.log(channel)<br/>console.log(data)</span><span id="7b3a" class="mf mg in lx b gy oi of l og oh">}</span></pre><p id="295c" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">用<code class="fe lu lv lw lx b">node index.js</code>启动你的聊天机器人。</p><p id="8226" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">当您从fetch请求中<code class="fe lu lv lw lx b">console.log</code>数据时，您应该在您的终端中看到类似这样的内容:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/5c926e814807d59e7315e1379b8b1fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*U-jmphQQ7oPlYQNQt0xG6A.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">Example data from loltyler1’s account</figcaption></figure><p id="2237" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">从这里开始，我们将采用<code class="fe lu lv lw lx b">summonerName</code>、<code class="fe lu lv lw lx b">tier</code>、<code class="fe lu lv lw lx b">rank</code>和<code class="fe lu lv lw lx b">leaguePoints </code>值，但是您可以看到这里有更多的内容。</p><p id="7aa1" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><em class="nz">奖金分配:这超出了本文的范围，但是对于您自己的项目，您可以考虑使用</em> <code class="fe lu lv lw lx b"><em class="nz">wins </em></code> <em class="nz">和</em> <code class="fe lu lv lw lx b"><em class="nz">losses </em></code> <em class="nz">值来报告您的胜率！</em></p><p id="ff3a" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">现在我们知道了我们正在rankSpeak函数中处理哪种类型的数据，我们将添加以下代码:</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="2fe0" class="mf mg in lx b gy oe of l og oh">const rankSpeak = (channel,data) =&gt; {</span><span id="ace5" class="mf mg in lx b gy oi of l og oh">// object destructuring of data<br/>// the data from the Riot endpoint always comes as an array,<br/>// so for something like this, we have to grab the first item.</span><span id="bff9" class="mf mg in lx b gy oi of l og oh">const {summonerName, tier, rank, leaguePoints} = data[0]</span><span id="95ff" class="mf mg in lx b gy oi of l og oh">// make tmi.js talk<br/>client.say(channel, `${summonerName} is currently ${tier} ${rank} with ${leaguePoints} LP.`);</span><span id="2d9f" class="mf mg in lx b gy oi of l og oh">}</span></pre><p id="7bd1" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">这应该可以了！让我们再来一次<code class="fe lu lv lw lx b">node index.js</code>，然后…</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/9267854ef4269d3c3bcbac0caafb15f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*QrgHSaEAX110MQ22va1mMg.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">Eureka!</figcaption></figure><p id="a114" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated">对于我的副本/粘贴者，我们最终的<code class="fe lu lv lw lx b">index.js </code>文件在没有注释的情况下是什么样子:</p><pre class="km kn ko kp gt oa lx ob oc aw od bi"><span id="6b23" class="mf mg in lx b gy oe of l og oh">const tmi = require('tmi.js');<br/>const fetch = require('node-fetch')<br/>require('dotenv').config({path: __dirname + '/.env'})</span><span id="8622" class="mf mg in lx b gy oi of l og oh">const client = new tmi.Client({</span><span id="019f" class="mf mg in lx b gy oi of l og oh">connection: {<br/> secure: true,<br/> reconnect: true<br/>},<br/>identity: {<br/> username: 'literally_anything',<br/> password: `${process.env.PUBSUBPASSWORD}`<br/>},</span><span id="e251" class="mf mg in lx b gy oi of l og oh">channels: [ 'channel_name' ]</span><span id="3a1a" class="mf mg in lx b gy oi of l og oh">});</span><span id="adbd" class="mf mg in lx b gy oi of l og oh">client.connect();</span><span id="424a" class="mf mg in lx b gy oi of l og oh">client.on('message', (channel, tags, message, self) =&gt; {</span><span id="f029" class="mf mg in lx b gy oi of l og oh"><em class="nz">if</em>(self) <em class="nz">return</em>;</span><span id="7396" class="mf mg in lx b gy oi of l og oh"><em class="nz">if</em>(message.toLowerCase() === '!marco') {<br/> client.say(channel, `Polo!`);<br/>}</span><span id="989d" class="mf mg in lx b gy oi of l og oh"><em class="nz">if</em> (message.toLowerCase() === '!rank') {<br/> rankFetch(channel)<br/>}</span><span id="28ec" class="mf mg in lx b gy oi of l og oh">});</span><span id="005f" class="mf mg in lx b gy oi of l og oh">const rankFetch = async (channel) =&gt; {<br/>const accountUrl = `https://na1.api.riotgames.com/lol/summoner/v4/summoners/by-name/Mammothman65?api_key=${process.env.API_KEY}`</span><span id="94c7" class="mf mg in lx b gy oi of l og oh">let result = <em class="nz">await</em> fetch(accountUrl)</span><span id="a58e" class="mf mg in lx b gy oi of l og oh">const id = JSON.parse(<em class="nz">await</em> result.text()).id</span><span id="0ee1" class="mf mg in lx b gy oi of l og oh">const rankUrl = <em class="nz">await</em> `https://na1.api.riotgames.com/lol/league/v4/entries/by-summoner/${id}?api_key=${process.env.API_KEY}`</span><span id="cccc" class="mf mg in lx b gy oi of l og oh">result = <em class="nz">await</em> fetch(rankUrl)</span><span id="f03b" class="mf mg in lx b gy oi of l og oh">data = JSON.parse(<em class="nz">await</em> result.text())</span><span id="e745" class="mf mg in lx b gy oi of l og oh">rankSpeak(channel, data)</span><span id="7f1b" class="mf mg in lx b gy oi of l og oh">}</span><span id="1873" class="mf mg in lx b gy oi of l og oh">const rankSpeak = (channel,data) =&gt; {</span><span id="4a0b" class="mf mg in lx b gy oi of l og oh">const {summonerName, tier, rank, leaguePoints} = data[0]</span><span id="22d3" class="mf mg in lx b gy oi of l og oh">client.say(channel, `${summonerName} is currently ${tier} ${rank} with ${leaguePoints} LP.`);</span><span id="8c84" class="mf mg in lx b gy oi of l og oh">}</span></pre></div><div class="ab cl ly lz hr ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ig ih ii ij ik"><h2 id="de25" class="mf mg in bd mh mi mj dn mk ml mm dp mn lg mo mp mq lk mr ms mt lo mu mv mw it bi translated">然后</h2><p id="c2b6" class="pw-post-body-paragraph kx ky in kz b la mx jx lc ld my ka lf lg mz li lj lk na lm ln lo nb lq lr ls ig bi translated">在本系列的下一篇文章中，我将向您展示如何使用本地Websockets服务器来连接您的tmi.js chatbot和OBS Studio / Streamlabs OBS，以在您的流上显示动态内容，例如用户提示的电影。</p><p id="c09f" class="pw-post-body-paragraph kx ky in kz b la lb jx lc ld le ka lf lg lh li lj lk ll lm ln lo lp lq lr ls ig bi translated"><em class="nz">更多内容看</em><a class="ae lt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kz ix"><em class="nz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>