<html>
<head>
<title>The React UseEffect Hook Explained With Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React UseEffect挂钩举例说明</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-react-useeffect-hook-explained-with-examples-95259b3ac89f?source=collection_archive---------7-----------------------#2021-03-13">https://javascript.plainenglish.io/the-react-useeffect-hook-explained-with-examples-95259b3ac89f?source=collection_archive---------7-----------------------#2021-03-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a991" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">通过实例了解React useEffect。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f723824a69ed859b6d5bfee2af828516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UOyyfMsPmPXNX5phaBevKQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image created with ❤️️ By <a class="ae kv" href="https://mehdiouss315.medium.com/" rel="noopener">author.</a></figcaption></figure><h1 id="73ff" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">介绍</h1><p id="0f99" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钩子<code class="fe mk ml mm mn b">useEffect</code>是你必须知道的重要反应钩子之一。每当发生变化时，它允许您在功能组件中执行副作用。因此，使用<code class="fe mk ml mm mn b">useEffect</code>钩子，您可以在React中做很多事情，比如获取数据、使用DOM等等。</p><p id="afa0" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在本文中，我们将通过一些实际例子来学习React中的UseEffect钩子。让我们开始吧。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="85c5" class="kw kx iq bd ky kz na lb lc ld nb lf lg jw nc jx li jz nd ka lk kc ne kd lm ln bi translated">如何使用UseEffect？</h1><p id="6b0d" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钩子<code class="fe mk ml mm mn b">useEffect</code>接受两个参数。第一个是强制的，是回调函数。另一方面，第二个参数(值数组或空数组)是可选的，当我们希望钩子在应用程序中呈现特定值之后运行时，我们会使用它。</p><p id="3ee4" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">要开始使用钩子<code class="fe mk ml mm mn b">useEffect</code>，首先需要从React包中导入它。</p><p id="574d" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="be82" class="nj kx iq mn b gy nk nl l nm nn">import React, <strong class="mn ir">{ useEffect }</strong> from 'react';</span></pre><p id="7cee" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">之后，您现在可以毫无问题地在您的功能组件中使用钩子了。</p><p id="3f3e" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">当你的应用程序更新时，你想做些什么，那么你应该使用<code class="fe mk ml mm mn b">useEffect</code>。下面的例子访问DOM来改变带有<code class="fe mk ml mm mn b">useEffect</code>的正文的背景:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="4396" class="nj kx iq mn b gy nk nl l nm nn"><strong class="mn ir">useEffect</strong>(<strong class="mn ir">()=&gt;{</strong><br/>  document.body.style.background = "black";<br/><strong class="mn ir">}</strong>);</span></pre><p id="608b" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">函数<code class="fe mk ml mm mn b">useEffect</code>将一个回调函数作为其第一个参数。该回调函数将在每次重新渲染时执行。如果你不想在每次重新渲染后都执行它，那么你必须添加第二个参数(空数组)。</p><p id="351f" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">下面是一个例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="7382" class="nj kx iq mn b gy nk nl l nm nn"><strong class="mn ir">useEffect</strong>(<strong class="mn ir">()=&gt;{</strong><br/>  document.body.style.background = "blue";<br/><strong class="mn ir">},[]</strong>);</span></pre><p id="27cc" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在这种情况下，回调函数只会在组件呈现时运行一次。</p><p id="2aec" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">当组件中的某个特定值发生变化时，我们也可以产生副作用。</p><p id="2003" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="4e6f" class="nj kx iq mn b gy nk nl l nm nn"><strong class="mn ir">useEffect</strong>(<strong class="mn ir">()=&gt;{</strong><br/>  <!-- -->console.log('Only run on name change')<br/><strong class="mn ir">},[name]</strong>);</span></pre><p id="72d8" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">在上面的例子中，只有当值<code class="fe mk ml mm mn b">name</code>渲染或改变时，回调才会运行，副作用才会被执行。</p><h1 id="75c2" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">清理功能</h1><p id="adce" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">当您的应用程序需要定义许多副作用时，那么您将不得不使用一个清理函数来清理发生的每个副作用。否则，会影响应用程序的性能。</p><p id="5c37" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">让我们举一个简单的例子，当用户调整页面大小时，您将拥有一个以像素为单位显示屏幕宽度的网页。为此，我们需要一个resize事件。</p><p id="46af" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">下面是一个例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="17d1" class="nj kx iq mn b gy nk nl l nm nn">import { useState, useEffect } from "react";<br/>import ReactDOM from "react-dom";</span><span id="27e5" class="nj kx iq mn b gy no nl l nm nn">const App = () =&gt;{</span><span id="acf1" class="nj kx iq mn b gy no nl l nm nn">const [screenWidth, setScreenWidth] = useState(window.innerWidth);</span><span id="d55e" class="nj kx iq mn b gy no nl l nm nn"><strong class="mn ir">useEffect(()=&gt;{<br/>    window.addEventListener("resize", ()=&gt;{<br/>      setScreenWidth(window.innerWidth);<br/>    });</strong></span><span id="e97d" class="nj kx iq mn b gy no nl l nm nn"><strong class="mn ir">    </strong>// Return the cleanup function which cleans the effect(event).<strong class="mn ir"><br/>    return ()=&gt;{<br/>      window.removeEventListener("resize", ()=&gt;{<br/>        setScreenWidth(window.innerWidth);<br/>      });<br/>    }<br/>  });</strong></span><span id="30c9" class="nj kx iq mn b gy no nl l nm nn">return &lt;&gt;<br/>  &lt;div&gt;{screenWidth}&lt;/div&gt;<br/>  &lt;/&gt;</span><span id="fae2" class="nj kx iq mn b gy no nl l nm nn">}</span><span id="f686" class="nj kx iq mn b gy no nl l nm nn">const rootElement = document.getElementById("root");<br/>ReactDOM.render(&lt;App /&gt;,<br/>  rootElement<br/>);</span></pre><p id="4c77" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">正如你在上面看到的，我们使用了状态钩子来更新屏幕宽度。然后，我们使用效果挂钩<code class="fe mk ml mm mn b">useEffect</code>来执行resize事件，该事件允许在浏览器中调整页面大小时更新屏幕宽度。</p><p id="a7cb" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">清理函数在回调函数中返回，它允许我们在事件发生后移除它们。</p><h1 id="73a4" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">使用UseEffect提取数据</h1><p id="a6e2" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">钩子<code class="fe mk ml mm mn b">useEffect</code>的另一个副作用是从API获取数据。您可以像使用普通JavaScript一样获取数据，如果您使用<code class="fe mk ml mm mn b">.then()</code>和<code class="fe mk ml mm mn b">catch()</code>来处理返回的承诺，您只需要在钩子<code class="fe mk ml mm mn b">useEffect</code>的回调函数中这样做。</p><p id="e784" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">下面是一个从GitHub API获取用户数据的例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="337d" class="nj kx iq mn b gy nk nl l nm nn">const App = ()=&gt;{<br/> // The API URL.<br/> const APIurl = '<a class="ae kv" href="https://api.github.com/users'" rel="noopener ugc nofollow" target="_blank">https://api.github.com/users'</a>;<br/> <br/>// useState.<br/> const [users, setUsers] = useState([]);<br/> <br/>// useEffect.<br/> useEffect(()=&gt;{<br/>  fetch(APIurl)<br/>   .then(res =&gt; res.json())<br/>   .then(data =&gt; setUsers(data));<br/>},[]);</span><span id="36b6" class="nj kx iq mn b gy no nl l nm nn">return(<br/>&lt;&gt;<br/> &lt;ul&gt;<br/> {users.map(user =&gt; (<br/>  &lt;li key={user.id}&gt;{user.login}&lt;/li&gt;<br/> ))}<br/> &lt;/ul&gt;<br/>&lt;/&gt;<br/>)<br/>}</span></pre><p id="c1d5" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">如果你使用async/await，那么你必须创建一个单独的函数，因为效果回调是匿名的，不能是异步的。</p><p id="8244" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">这里有一个例子:</p><pre class="kg kh ki kj gt nf mn ng nh aw ni bi"><span id="c708" class="nj kx iq mn b gy nk nl l nm nn">const App = ()=&gt;{<br/>// The API URL.<br/>  const APIurl = 'https://api.github.com/users';</span><span id="a2a6" class="nj kx iq mn b gy no nl l nm nn">// useState.<br/>  const [users, setUsers] = useState([]);</span><span id="e5e6" class="nj kx iq mn b gy no nl l nm nn">// useEffect.<br/>  <strong class="mn ir">useEffect</strong>(()=&gt;{<br/>    <strong class="mn ir">getUser()</strong>;}<br/>    ,[]);</span><span id="8779" class="nj kx iq mn b gy no nl l nm nn">// Separate function.<br/>  <strong class="mn ir">async</strong> function <strong class="mn ir">getUser</strong>() {<br/>    const response = <strong class="mn ir">await</strong> fetch(APIurl);<br/>    const data = <strong class="mn ir">await</strong> response.json();<br/>    <strong class="mn ir">setUsers</strong>(data);<br/>  }return(<br/>    &lt;&gt;<br/>    &lt;ul&gt;<br/>      {users.map(user =&gt; (<br/>        &lt;li key={user.id}&gt;{user.login}&lt;/li&gt;<br/>      ))}<br/>    &lt;/ul&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span></pre><p id="e5d9" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">正如你在上面看到的，这就是如何用<code class="fe mk ml mm mn b">useEffect</code>获取数据。它类似于普通的JavaScript，你只是使用了效果钩子。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="4c70" class="kw kx iq bd ky kz na lb lc ld nb lf lg jw nc jx li jz nd ka lk kc ne kd lm ln bi translated">结论</h1><p id="9865" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><code class="fe mk ml mm mn b">useEffect</code>是你在处理React时需要了解的最重要的钩子。它允许您轻松地在功能组件中添加特性和执行副作用。</p><p id="785d" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated">感谢您阅读这篇文章。希望你觉得有用。</p><p id="0164" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><strong class="lq ir">延伸阅读</strong></p><div class="np nq gp gr nr ns"><a rel="noopener  ugc nofollow" target="_blank" href="/conditional-rendering-in-react-with-examples-eb6ae6ac981e"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">反应示例中的条件呈现</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">通过实例了解React中的条件渲染。</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ob l"><div class="oc l od oe of ob og kp ns"/></div></div></a></div><p id="8fc9" class="pw-post-body-paragraph lo lp iq lq b lr mo jr lt lu mp ju lw lx mq lz ma mb mr md me mf ms mh mi mj ij bi translated"><em class="oh">如果你对JavaScript和web开发相关的更有用的内容感兴趣，可以</em> <a class="ae kv" href="https://mehdiouss.ck.page/" rel="noopener ugc nofollow" target="_blank"> <em class="oh">订阅</em> </a> <em class="oh">我的简讯。</em></p></div></div>    
</body>
</html>