<html>
<head>
<title>How to Send and Read Emails Using Node.js the Easiest Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Node.js以最简单的方式发送和阅读电子邮件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-send-and-read-emails-using-node-js-the-easiest-way-48e137ea8eb4?source=collection_archive---------0-----------------------#2021-12-31">https://javascript.plainenglish.io/how-to-send-and-read-emails-using-node-js-the-easiest-way-48e137ea8eb4?source=collection_archive---------0-----------------------#2021-12-31</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="650a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用Nodemailer发送电子邮件，使用IMAP库阅读。</h2></div><p id="6463" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">嗨，伙计们，这篇文章介绍了发送电子邮件，然后使用两种不同的服务阅读它们。对于发送电子邮件，我将使用Nodemailer，对于阅读/解析电子邮件，我将使用IMAP库。现在让我们进入流程。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/77de529daff1789547fd32b344b608d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hB7aO16V0iuKu6Z5"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@hostreviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Stephen Phillips - Hostreviews.co.uk</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="dafe" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">步骤1:设置发送和接收邮件的配置。</h1><p id="2325" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">我创建了一个config.js文件来存储这两个服务的配置对象。文件代码非常简单，看起来像。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="2236" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">步骤2:设置电子邮件发送服务</h1><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="f590" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要通过node-mailer发送邮件，我们需要创建一个transporter对象，其配置在config对象中定义，如前所示。它主要关注4个参数，即</p><ol class=""><li id="3b90" class="mo mp in ke b kf kg ki kj kl mq kp mr kt ms kx mt mu mv mw bi translated">发件人//发件人</li><li id="ab4d" class="mo mp in ke b kf mx ki my kl mz kp na kt nb kx mt mu mv mw bi translated">收件人//发送至，可以是收件人数组</li><li id="1388" class="mo mp in ke b kf mx ki my kl mz kp na kt nb kx mt mu mv mw bi translated">主题//邮件主题</li><li id="63ba" class="mo mp in ke b kf mx ki my kl mz kp na kt nb kx mt mu mv mw bi translated">HTML//HTML主体(如果有模板的话)</li><li id="4481" class="mo mp in ke b kf mx ki my kl mz kp na kt nb kx mt mu mv mw bi translated">text //您要发送的文本(也可以与HTML一起使用)</li></ol><p id="4a06" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">邮件发出后，我们会在文章末尾打印详细信息和交叉验证结果的时间。</p><h1 id="b51e" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">步骤3:创建邮件阅读服务</h1><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="3f20" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个文件解释起来相当复杂。我会尽力解释这里发生的事情。</p><blockquote class="nc nd ne"><p id="433a" class="kc kd nf ke b kf kg jo kh ki kj jr kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated">第5行的readMail函数是imap服务的包装器，它本身使用回调。文档中的代码很难理解。为了更好的可读性，我将其转换为使用异步await语法。</p><p id="25f8" class="kc kd nf ke b kf kg jo kh ki kj jr kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated">当该函数启动时，我们试图与我们传递的邮件配置建立连接。如果连接成功，我们打印信息。否则，它会捕获块并打印错误。</p><p id="30d9" class="kc kd nf ke b kf kg jo kh ki kj jr kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated">第10行的searchCriteria用于确定我们正在查看的邮件类型。它可能是可见的，也可能是不可见的，同时你可以传递一个自定义配置，比如</p></blockquote><pre class="kz la lb lc gt nj nk nl nm aw nn bi"><span id="735c" class="no lq in nk b gy np nq l nr ns">const searchCriteria = [ 'UNSEEN', ['SINCE', 'May 20, 2021']<br/>// Meaning to fetch all the mails unread emails since May 20, 2021</span></pre><blockquote class="nc nd ne"><p id="c53a" class="kc kd nf ke b kf kg jo kh ki kj jr kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated">获取选项定义了我们希望过滤的电子邮件内容。对于我的例子，我包括了标题和文本部分。markSeen设置为true时将获取未读邮件(如果searchCriteria不可见)，然后将它们标记为已读。</p><p id="e5b9" class="kc kd nf ke b kf kg jo kh ki kj jr kk ng km kn ko nh kq kr ks ni ku kv kw kx ig bi translated">第15行的结果返回了大量需要解析的数据。第15行之后的代码完全取决于您要搜索的内容。您可以使用regex提取相关数据，但它可能并不总是有效。</p></blockquote><p id="0e65" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为我在第15行后提到过，你需要一个自定义代码功能来定位你正在寻找的邮件的确切部分。我瞄准了邮件的文本，以便我们可以验证我们发送的内容和我们收到的内容。</p><p id="7c32" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">给定搜索条件和fetchOptions，这就是阅读邮件所需做的全部工作。</p><h1 id="d593" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">步骤4:组装所有模块</h1><p id="94f8" class="pw-post-body-paragraph kc kd in ke b kf mh jo kh ki mi jr kk kl mj kn ko kp mk kr ks kt ml kv kw kx ig bi translated">因此，在这一部分，出于演示的目的，我将简单地发送一封邮件，等待10秒钟，并尝试阅读已发送的邮件。主app.js文件也非常简单。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="6ffb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后让我们看看输出</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi nt"><img src="../Images/a8cac1056415ce8d290b86a2d58cd9b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*2kJjZq-2DcApbNiKL_JWHA.png"/></div></div></figure><p id="bfa8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请注意执行程序流的时间段。</p><p id="c965" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">邮件是在21点15分13秒发出的</p><p id="98e3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">程序将等待的信息在21点15分16秒到达</p><p id="38e1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">超时后，在21:15:26 [10秒] <br/>开始获取详细信息，在21:15:29 [3秒]连接成功</p><p id="d8de" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">程序完全按照提到的那样工作。最后需要注意的是，我使用了一个名为html-to-text的库来将html转换成文本。这就是阅读和发送邮件有多简单。对于其他信息，这里有一些可能对你有用的链接。</p><p id="4832" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> <em class="nf">链接到完整代码</em> </strong></p><div class="nu nv gp gr nw nx"><a href="https://github.com/akshay271703/node-email-read-send" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">GitHub-akshay 271703/节点-电子邮件-阅读-发送</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">github.com</p></div></div><div class="og l"><div class="oh l oi oj ok og ol li nx"/></div></div></a></div><p id="74f7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"><em class="nf">IMAP包</em> </strong></p><div class="nu nv gp gr nw nx"><a href="https://www.npmjs.com/package/imap" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">交互邮件访问协议</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">node-imap是node.js的imap客户端模块。这个模块不执行任何魔法，比如自动解码…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.npmjs.com</p></div></div><div class="og l"><div class="om l oi oj ok og ol li nx"/></div></div></a></div><p id="f268" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"><em class="nf">node mailer包</em> </strong></p><div class="nu nv gp gr nw nx"><a href="https://nodemailer.com/about/" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">节点邮件程序</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">Nodemailer是Node.js应用程序的一个模块，可以轻松发送电子邮件。该项目始于…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">nodemailer.com</p></div></div><div class="og l"><div class="on l oi oj ok og ol li nx"/></div></div></a></div><p id="e13c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"><em class="nf">html转文本包</em> </strong></p><div class="nu nv gp gr nw nx"><a href="https://www.npmjs.com/package/html-to-text" rel="noopener  ugc nofollow" target="_blank"><div class="ny ab fo"><div class="nz ab oa cl cj ob"><h2 class="bd io gy z fp oc fr fs od fu fw im bi translated">html到文本</h2><div class="oe l"><h3 class="bd b gy z fp oc fr fs od fu fw dk translated">先进的转换器，解析HTML并返回美丽的文字。内联和块级标记。具有列跨度的表格和…</h3></div><div class="of l"><p class="bd b dl z fp oc fr fs od fu fw dk translated">www.npmjs.com</p></div></div><div class="og l"><div class="oo l oi oj ok og ol li nx"/></div></div></a></div><p id="e037" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="nf">更多内容看</em> <a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nf">说白了就是</em> </a> <em class="nf">。报名参加我们的</em> <a class="ae lo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <em class="nf">免费每周简讯</em> </a> <em class="nf">。在我们的</em> <a class="ae lo" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <em class="nf">社区不和谐</em> </a> <em class="nf">获得独家获得写作机会和建议。</em></p></div></div>    
</body>
</html>