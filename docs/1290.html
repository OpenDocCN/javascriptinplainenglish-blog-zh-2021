<html>
<head>
<title>Add a Map View into Our React App with the Visx Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Visx库将地图视图添加到React应用程序中</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/add-a-map-view-into-our-react-app-with-the-visx-library-e252772ae1cf?source=collection_archive---------21-----------------------#2021-03-17">https://javascript.plainenglish.io/add-a-map-view-into-our-react-app-with-the-visx-library-e252772ae1cf?source=collection_archive---------21-----------------------#2021-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f3cac7d363e65ded211fdcdd77f98a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aYGSdSFYZZAWLd7w"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@iambrettzeck?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Zeck</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="731a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Visx是一个库，让我们可以轻松地将图形添加到React应用程序中。</p><p id="ee07" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用它将地图视图添加到React应用程序中</p><h1 id="396e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装所需的软件包</h1><p id="2968" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须安装一些模块来创建地图。</p><p id="61e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="89df" class="mn lc iq mj b gy mo mp l mq mr">npm i @visx/geo @visx/responsive @visx/scale @visx/zoom</span></pre><p id="8e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">安装软件包。</p><h1 id="ec44" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">添加地图</h1><p id="89d5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过编写以下内容来添加地图:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="a6b7" class="mn lc iq mj b gy mo mp l mq mr">import React, { useState } from "react";<br/>import * as topojson from "topojson-client";<br/>import { scaleQuantize } from "@visx/scale";<br/>import { CustomProjection, Graticule } from "@visx/geo";<br/>import { Projection } from "@visx/geo/lib/types";<br/>import { Zoom } from "@visx/zoom";<br/>import {<br/>  geoConicConformal,<br/>  geoTransverseMercator,<br/>  geoNaturalEarth1,<br/>  geoConicEquidistant,<br/>  geoOrthographic,<br/>  geoStereographic<br/>} from "d3-geo";<br/>import topology from "./world-topo.json";</span><span id="6d7a" class="mn lc iq mj b gy ms mp l mq mr">export const background = "#252b7e";<br/>const purple = "#201c4e";<br/>const PROJECTIONS = {<br/>  geoConicConformal,<br/>  geoTransverseMercator,<br/>  geoNaturalEarth1,<br/>  geoConicEquidistant,<br/>  geoOrthographic,<br/>  geoStereographic<br/>};</span><span id="9e37" class="mn lc iq mj b gy ms mp l mq mr">const world = topojson.feature(topology, topology.objects.units);<br/>const color = scaleQuantize({<br/>  domain: [<br/>    Math.min(...world.features.map((f) =&gt; f.geometry.coordinates.length)),<br/>    Math.max(...world.features.map((f) =&gt; f.geometry.coordinates.length))<br/>  ],<br/>  range: [<br/>    "#019ece",<br/>    "#f4448b",<br/>    "#fccf35",<br/>    "#82b75d",<br/>    "#b33c88",<br/>    "#fc5e2f",<br/>    "#f94b3a",<br/>    "#f63a48",<br/>    "#dde1fe",<br/>    "#8993f9",<br/>    "#b6c8fb",<br/>    "#65fe8d"<br/>  ]<br/>});</span><span id="f2b5" class="mn lc iq mj b gy ms mp l mq mr">function Example({ width, height, events = true }: GeoCustomProps) {<br/>  const [projection, setProjection] = useState("geoConicConformal");</span><span id="97a6" class="mn lc iq mj b gy ms mp l mq mr">  const centerX = width / 2;<br/>  const centerY = height / 2;<br/>  const initialScale = (width / 630) * 100;</span><span id="0a35" class="mn lc iq mj b gy ms mp l mq mr">  return width &lt; 10 ? null : (<br/>    &lt;&gt;<br/>      &lt;Zoom<br/>        width={width}<br/>        height={height}<br/>        scaleXMin={100}<br/>        scaleXMax={1000}<br/>        scaleYMin={100}<br/>        scaleYMax={1000}<br/>        transformMatrix={{<br/>          scaleX: initialScale,<br/>          scaleY: initialScale,<br/>          translateX: centerX,<br/>          translateY: centerY,<br/>          skewX: 0,<br/>          skewY: 0<br/>        }}<br/>      &gt;<br/>        {(zoom) =&gt; (<br/>          &lt;div className="container"&gt;<br/>            &lt;svg<br/>              width={width}<br/>              height={height}<br/>              className={zoom.isDragging ? "dragging" : undefined}<br/>            &gt;<br/>              &lt;rect<br/>                x={0}<br/>                y={0}<br/>                width={width}<br/>                height={height}<br/>                fill={background}<br/>                rx={14}<br/>              /&gt;<br/>              &lt;CustomProjection<br/>                projection={PROJECTIONS[projection]}<br/>                data={world.features}<br/>                scale={zoom.transformMatrix.scaleX}<br/>                translate={[<br/>                  zoom.transformMatrix.translateX,<br/>                  zoom.transformMatrix.translateY<br/>                ]}<br/>              &gt;<br/>                {(customProjection) =&gt; (<br/>                  &lt;g&gt;<br/>                    &lt;Graticule<br/>                      graticule={(g) =&gt; customProjection.path(g) || ""}<br/>                      stroke={purple}<br/>                    /&gt;<br/>                    {customProjection.features.map(({ feature, path }, i) =&gt; (<br/>                      &lt;path<br/>                        key={`map-feature-${i}`}<br/>                        d={path || ""}<br/>                        fill={color(feature.geometry.coordinates.length)}<br/>                        stroke={background}<br/>                        strokeWidth={0.5}<br/>                        onClick={() =&gt; {<br/>                          if (events)<br/>                            alert(<br/>                              `Clicked: ${feature.properties.name} (${feature.id})`<br/>                            );<br/>                        }}<br/>                      /&gt;<br/>                    ))}<br/>                  &lt;/g&gt;<br/>                )}<br/>              &lt;/CustomProjection&gt;<br/>              &lt;rect<br/>                x={0}<br/>                y={0}<br/>                width={width}<br/>                height={height}<br/>                rx={14}<br/>                fill="transparent"<br/>                onTouchStart={zoom.dragStart}<br/>                onTouchMove={zoom.dragMove}<br/>                onTouchEnd={zoom.dragEnd}<br/>                onMouseDown={zoom.dragStart}<br/>                onMouseMove={zoom.dragMove}<br/>                onMouseUp={zoom.dragEnd}<br/>                onMouseLeave={() =&gt; {<br/>                  if (zoom.isDragging) zoom.dragEnd();<br/>                }}<br/>              /&gt;<br/>            &lt;/svg&gt;<br/>            {events &amp;&amp; (<br/>              &lt;div className="controls"&gt;<br/>                &lt;button<br/>                  className="btn btn-zoom"<br/>                  onClick={() =&gt; zoom.scale({ scaleX: 1.2, scaleY: 1.2 })}<br/>                &gt;<br/>                  +<br/>                &lt;/button&gt;<br/>                &lt;button<br/>                  className="btn btn-zoom btn-bottom"<br/>                  onClick={() =&gt; zoom.scale({ scaleX: 0.8, scaleY: 0.8 })}<br/>                &gt;<br/>                  -<br/>                &lt;/button&gt;<br/>                &lt;button className="btn btn-lg" onClick={zoom.reset}&gt;<br/>                  Reset<br/>                &lt;/button&gt;<br/>              &lt;/div&gt;<br/>            )}<br/>          &lt;/div&gt;<br/>        )}<br/>      &lt;/Zoom&gt;<br/>      &lt;label&gt;<br/>        projection:{" "}<br/>        &lt;select onChange={(event) =&gt; setProjection(event.target.value)}&gt;<br/>          {Object.keys(PROJECTIONS).map((projectionName) =&gt; (<br/>            &lt;option key={projectionName} value={projectionName}&gt;<br/>              {projectionName}<br/>            &lt;/option&gt;<br/>          ))}<br/>        &lt;/select&gt;<br/>      &lt;/label&gt;<br/>      &lt;style jsx&gt;{`<br/>        .container {<br/>          position: relative;<br/>        }<br/>        svg {<br/>          cursor: grab;<br/>        }<br/>        svg.dragging {<br/>          cursor: grabbing;<br/>        }<br/>        .btn {<br/>          margin: 0;<br/>          text-align: center;<br/>          border: none;<br/>          background: #dde1fe;<br/>          color: #222;<br/>          padding: 0 4px;<br/>          border-top: 1px solid #8993f9;<br/>        }<br/>        .btn-lg {<br/>          font-size: 12px;<br/>          line-height: 1;<br/>          padding: 4px;<br/>        }<br/>        .btn-zoom {<br/>          width: 26px;<br/>          font-size: 22px;<br/>        }<br/>        .btn-bottom {<br/>          margin-bottom: 1rem;<br/>        }<br/>        .controls {<br/>          position: absolute;<br/>          bottom: 20px;<br/>          right: 15px;<br/>          display: flex;<br/>          flex-direction: column;<br/>          align-items: flex-end;<br/>        }<br/>        label {<br/>          font-size: 12px;<br/>        }<br/>      `}&lt;/style&gt;<br/>    &lt;/&gt;<br/>  );<br/>}</span><span id="9382" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div className="App"&gt;<br/>      &lt;Example width={500} height={300} /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="3e3a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">world-topo.json</code>可在<a class="ae kc" href="https://codesandbox.io/s/github/airbnb/visx/tree/master/packages/visx-demo/src/sandboxes/visx-geo-custom?file=/world-topo.json" rel="noopener ugc nofollow" target="_blank">https://code sandbox . io/s/github/Airbnb/visx/tree/master/packages/visx-demo/src/sandboxes/visx-geo-custom？file=/world-topo.json </a></p><p id="938e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了<code class="fe mt mu mv mj b">background</code>和<code class="fe mt mu mv mj b">purple</code>来为地图添加颜色。</p><p id="5a6b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">PROJECTIONS</code>拥有可用的地图视图类型。</p><p id="4ca2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过用JSON调用<code class="fe mt mu mv mj b">topojson.feature</code>方法将数据转换成可以显示的东西。</p><p id="36d6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">scaleQuantize</code>方法让我们给地图上的国家添加颜色。</p><p id="fe0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe mt mu mv mj b">Example</code>组件中，我们有<code class="fe mt mu mv mj b">projection</code>状态来显示给定投影类型的地图。</p><p id="02a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe mt mu mv mj b">centerX</code>和<code class="fe mt mu mv mj b">centerY</code>变量设置中心坐标。</p><p id="13a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe mt mu mv mj b">initialScale</code>变量设置为初始缩放级别。</p><p id="97bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了显示地图，我们添加了<code class="fe mt mu mv mj b">Zoom</code>组件来添加缩放。</p><p id="f746" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在它的渲染道具中，我们添加了<code class="fe mt mu mv mj b">CustomProjection</code>组件来添加地图。</p><p id="3f5d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe mt mu mv mj b">Graticule</code>组件让我们在地图上添加网格线。</p><p id="d6ee" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在此之下，我们添加矩形，让我们用触摸和鼠标处理程序拖动平移地图。</p><p id="8af4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在它下面，我们添加了按钮来添加缩放和重置缩放功能。</p><p id="ae50" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们添加选择下拉菜单，让我们通过改变<code class="fe mt mu mv mj b">projection</code>状态来选择项目。</p><p id="5fd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe mt mu mv mj b">CustomProjection</code>组件中使用了它。</p><p id="e49a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们为地图添加样式。</p><h1 id="f465" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="a8fc" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以添加一个带有Visx库可用组件的地图视图。</p><p id="005e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p><p id="b688" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mw">更多内容看</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="mw">plain English . io</em></strong></a></p></div></div>    
</body>
</html>