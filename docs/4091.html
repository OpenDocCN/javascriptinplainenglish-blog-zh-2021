<html>
<head>
<title>Schedule Background Tasks in React Native App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React本机应用中计划后台任务</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/scheduled-background-task-in-react-native-app-6f1f02a0faa7?source=collection_archive---------0-----------------------#2021-08-15">https://javascript.plainenglish.io/scheduled-background-task-in-react-native-app-6f1f02a0faa7?source=collection_archive---------0-----------------------#2021-08-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2984" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何在React本机应用程序中调度定期后台任务</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a371ef99e61d4429f7d1e31c5c2b007f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_5QLEin581pu_83S2gbM8w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source (<a class="ae kv" href="https://www.progress.com/blogs/the-react-native-sdk-for-kinvey-is-now-available" rel="noopener ugc nofollow" target="_blank">link</a>)</figcaption></figure><p id="745f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将带您了解在React本地应用程序中创建后台任务的过程。目标是拥有一个定期运行的调度作业，即使在应用程序关闭时也能执行一些任务。</p><p id="f290" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在开始之前，我们先讨论一下后台作业的局限性:</p><ul class=""><li id="7b11" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated">任何UI交互都是不可能的，因此所有执行的代码都应该存在于任何React组件之外。</li><li id="e03b" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">两个作业之间的最短持续时间为15分钟。</li><li id="f41c" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">任务执行的确切时间是不可预测的。</li><li id="c05a" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">对于Android，当应用程序在前台时，任务不会运行。</li><li id="f7e4" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">对于iOS，用户手动关闭应用程序后，后台获取将不会继续运行。</li><li id="1c24" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">模拟器中不会安排后台任务。</li></ul><p id="2460" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们直接进入代码，看看如何建立一个基本的工作流。我们将使用<a class="ae kv" href="https://github.com/jamesisaac/react-native-background-task" rel="noopener ugc nofollow" target="_blank">react-native-background-task</a>库进行后台作业。</p><h2 id="1627" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">步骤1:安装NPM软件包</h2><p id="e101" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">运行以下命令来安装NPM软件包。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="1c52" class="mg mh iq nf b gy nj nk l nl nm">npm install react-native-background-task --save</span></pre><p id="2628" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">RN≥60时，应该会自动链接，但对于Android，需要额外的手动步骤。在<code class="fe nn no np nf b">MainApplication.java</code>文件的<code class="fe nn no np nf b">onCreate</code>方法中添加下面一行。</p><pre class="kg kh ki kj gt ne nf ng nh aw ni bi"><span id="0833" class="mg mh iq nf b gy nj nk l nl nm">import com.jamesisaac.rnbackgroundtask.BackgroundTaskPackage;</span><span id="9b85" class="mg mh iq nf b gy nq nk l nl nm">@Override<br/>public void onCreate() {<br/>  ...<br/>  BackgroundTaskPackage.useContext(this);<br/>}</span></pre><h2 id="96d1" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">步骤2:为您的后台任务实现该方法</h2><p id="c257" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">接下来，为<code class="fe nn no np nf b">task.js</code>创建一个单独的文件，并为你的后台任务创建一个实现逻辑的函数。如果需要在作业中使用redux状态，可以导入存储并获得如下所示的状态。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="90b3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">注意:</strong> store是您的redux-store的实例。</p><h2 id="7567" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">步骤3:定义后台任务</h2><p id="52f2" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">在<code class="fe nn no np nf b">App.js</code>之外的<code class="fe nn no np nf b">App</code>组件定义你的后台任务。我们使用前面定义的<code class="fe nn no np nf b">backgroundSync</code>方法在任务内部调用。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="b534" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">步骤4:计划后台任务</h2><p id="5962" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">最后，让我们从app组件内部调度后台任务。请注意，我们没有为任务提供任何标识符(例如名称或id ),因此我们可以用这种方法定义一个后台任务。在本例中，我们计划每30分钟运行一次作业。最短可以是15分钟。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><h2 id="058f" class="mg mh iq bd mi mj mk dn ml mm mn dp mo lf mp mq mr lj ms mt mu ln mv mw mx my bi translated">奖励:检查后台任务的状态</h2><p id="7a69" class="pw-post-body-paragraph kw kx iq ky b kz mz jr lb lc na ju le lf nb lh li lj nc ll lm ln nd lp lq lr ij bi translated">您还可以检查您的后台任务的状态，以确保一切工作顺利。在这个方法中，您可以处理失败场景，以触发一个分析事件来收集关于失败的信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="6539" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这里有一个完整的例子，展示了在定义了上述方法之后，App.js可能的样子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="fb8a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">就这样，您现在应该已经为您的应用程序配置了一个后台作业。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="25b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章对你有用。请在评论中让我知道你的想法。考虑成为中级会员<a class="ae kv" href="https://utkarshabakshi.medium.com/membership" rel="noopener">继续阅读我所有的优质文章以及1000多个其他故事。</a></p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="9391" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以在这个<a class="ae kv" href="https://utkarshabakshi.medium.com/list/react-native-development-0d5f690f6585" rel="noopener">列表</a>中找到我关于React原生开发的其他文章。</p></div><div class="ab cl nt nu hu nv" role="separator"><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny nz"/><span class="nw bw bk nx ny"/></div><div class="ij ik il im in"><p id="417a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oa">更多内容尽在</em><a class="ae kv" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="oa">plain English . io</em></strong></a></p></div></div>    
</body>
</html>