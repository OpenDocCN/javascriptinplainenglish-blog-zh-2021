<html>
<head>
<title>The Worst Mistake I Made As A Programmer Two Decades Ago</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">二十年前，作为一名程序员，我犯的最严重的错误</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/the-worst-mistake-i-made-as-a-programmer-two-decades-ago-1e749964a9fb?source=collection_archive---------18-----------------------#2021-12-07">https://javascript.plainenglish.io/the-worst-mistake-i-made-as-a-programmer-two-decades-ago-1e749964a9fb?source=collection_archive---------18-----------------------#2021-12-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="43fd" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">当我们找到问题的根源时，我正处于困境中。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/eb092f87e1e2133097ace5304fc23088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t98a2M93q_CVFU2I"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ben White</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2eab" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">先说编程问题，然后我会设定bug出现并产生严重后果的特定场景。</p><p id="d4f0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，关于并发编程的一些信息。在同一个程序中并行执行几个过程通常是有用的，甚至是必要的。</p><p id="5ad9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">通常，这些被称为活动的治疗并不是完全独立的。通常，在执行不同的活动时，必须遵守一定的时间限制。其他活动共享某些信息也很常见。</p><p id="a076" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">随着这些信息的不断发展，必须并行写入和读取。这就产生了数据一致性的问题。的确，如果两个活动并行修改相同的数据，那么数据的最终值会是多少？</p><p id="9863" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">即使单个活动改变了数据的值，并且一个或多个活动读取了该数据，如果所述数据是复合的，也就是说，如果它包括几个子数据(如果您愿意，也可以是几个子值)，则可能会出现一致性问题。</p><p id="d2ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">实际上，假设修改数据的活动在读取数据的同时开始改变子值。在这种情况下，该活动将具有不一致的数据，因为只有它的一部分子值将被改变，修改操作不是原子的。</p><p id="e0dd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这听起来很复杂吗？嗯，实际上，是的。并发编程是强大的，通常是良好性能的必要条件，但它是一件棘手的事情——坦白地说，做起来很有趣，但那是另一个话题。</p><p id="24bc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用各种工具来适当地管理活动的调度和对共享数据的访问，例如信号量和互斥体。在不涉及太多技术细节的情况下，我们可以粗略地说，必须拥有一个互斥体来访问数据。</p><p id="a451" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，必须访问数据的活动将请求获得互斥体。一旦获得这个互斥体，就不会有其他活动访问该数据。因此，一方面，数据修改将是原子性的，另一方面，读取将不会受到并发写入的干扰。</p><h2 id="dae9" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">好了，现在是窃听器。</h2><p id="a36d" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">作为移植一个相对较大的软件(大约一百万行代码，包括注释)的一部分，我必须使用共享数据修改一个过程。这些数据受到互斥体的保护。问题是，由于计划的压力，我看过程有点太快，没有看到它使用了互斥。</p><p id="e389" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我看来，代码(不是我的)是C语言的，而且相对复杂(通过宏处理互斥体，不酷)。我所做的修改确实获取了互斥体(从另一段代码中复制并粘贴),但没有释放它。</p><p id="b930" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，所有其他活动都无法再访问这些数据。因此，它们被阻塞了——这是一个基本错误，通常应该在测试过程中发现。</p><p id="700d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">测试这个系统并不容易。计划的压力很大，这个bug没有被注意到，特别是因为系统必须负载很重才会出现bug；在低负载或正常负载下，错误不会出现。</p><h2 id="a75a" class="lp lq in bd lr ls lt dn lu lv lw dp lx lc ly lz ma lg mb mc md lk me mf mg mh bi translated">现在的语境。</h2><p id="dbe0" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">客户是一家出版社。当时它是我们公司最大的客户之一。他们的业务是出售信息。它在世界上几乎每个发达国家都有办事处或至少有记者。</p><p id="1db9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">问题中的系统是一个编辑系统，一种机构的IT骨干。他接收记者起草的新闻报道，并负责在全世界分发、处理、存档等工作。</p><p id="34ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">移植是在2001年进行的，历时几个月。实际上是从2001年6月到7月左右开始的。有关的修改是在2001年8月底进行的。</p><p id="1fa1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我不知道你是否记得，但是大约在2001年9月，在美国发生了一些事情，引起了很多人的兴趣。我说的当然是911袭击。显然，新闻机构都很紧张，法新社和其他媒体一样。该机构发布的新闻数量突然以地狱般的速度增长……直到错误被触发并阻塞了编辑系统，因为没有任何活动可以访问这些宝贵的数据！</p><p id="4682" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这场灾难的辉煌。该机构不得不通过其他系统来制作新闻稿，但在重组之前浪费了宝贵的时间。听说法新社的CEO给编辑系统的控制室打电话，想知道这是哪里。这都是我的错，没有仔细看看这个程序是如何工作的。我可以告诉你，当我们找到问题的根源时，我是在我的小鞋里。</p><p id="3d45" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="mn">更多内容看</em> <strong class="kv io"> <em class="mn"> </em> </strong> <a class="ae ks" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mn">说白了. io </em> </strong> </a> <strong class="kv io"> <em class="mn">。</em> </strong> <em class="mn">报名参加我们的</em> <a class="ae ks" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="mn">免费每周简讯点击这里</em> </strong> </a> <strong class="kv io"> <em class="mn">。</em> </strong></p></div></div>    
</body>
</html>