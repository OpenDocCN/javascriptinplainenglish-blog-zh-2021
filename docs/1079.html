<html>
<head>
<title>Property Descriptors in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的属性描述符</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/property-descriptors-in-javascript-1335249b54a7?source=collection_archive---------13-----------------------#2021-03-06">https://javascript.plainenglish.io/property-descriptors-in-javascript-1335249b54a7?source=collection_archive---------13-----------------------#2021-03-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/aab38d416018a2da618626b41d28fea4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFNTiWe5wRCd7WyNY5L3eQ.jpeg"/></div></div></figure><p id="d04e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JavaScript是一种动态编程语言。这对于灵活性来说非常好，但是它会使代码变得非常脆弱，因为检查直到运行时才会发生。</p><p id="89c2" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所说的灵活性是一把双刃剑。一方面，它给了开发人员很大的自由，但另一方面，它可能会导致意想不到的行为，并增加试图跟踪实际情况的认知负荷。</p><p id="e314" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这篇文章中，我们将看看<strong class="jx io">属性描述符</strong>——ES5中引入的一个特性，它可以帮助控制(甚至扩展)行为，并在这个疯狂、动态的世界中提供一点秩序，我们JavaScript开发者称之为家。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="12ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">属性描述符分为两类:<strong class="jx io">数据描述符</strong>和<strong class="jx io">访问器描述符</strong>。这两种类型的描述符都是一个可以用6个可选键配置的对象，在本文中，我们将把它们都包含进来。这是介绍本文主题的绝佳机会…</p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="81e3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我为本文编写的代码使用了<a class="ae lg" href="https://pokeapi.co/" rel="noopener ugc nofollow" target="_blank">神奇宝贝Api </a>，这是一个非常棒的免费Api，提供了像我这样的神奇宝贝书呆子可能需要的所有信息！(免责声明:这不是一个赞助帖子，我只是喜欢神奇宝贝。)</p><p id="3e8d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不管怎样，回到正题</p><p id="83e0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">根据<a class="ae lg" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" rel="noopener ugc nofollow" target="_blank"> MDN </a>:</p><blockquote class="lh li lj"><p id="6e9b" class="jv jw lk jx b jy jz ka kb kc kd ke kf ll kh ki kj lm kl km kn ln kp kq kr ks ig bi translated"><em class="in">数据描述符</em>是具有值的属性，该值可以是可写的，也可以是不可写的。<em class="in">访问器描述符</em>是由getter-setter函数对描述的属性。描述符必须是这两种风格之一；不可能两者兼得。</p></blockquote><p id="2ea0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果只是阅读这篇文章对你来说没有多大意义，你并不孤单。直到我开始钻研代码，它才真正引起我的共鸣。</p><p id="ab45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们给出可选键的基本定义:</p><p id="5985" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">可枚举(boolean): </strong>属性会在枚举过程中显示出来例如<code class="fe lo lp lq lr b">for(key in &lt;yourObject&gt;){...}</code> <br/> <strong class="jx io">可写(boolean): </strong>属性值是否可以被赋予不同的值<br/> <strong class="jx io">可配置(boolean): </strong>属性描述符可以被修改和/或删除<br/> <strong class="jx io">值(任何有效的JS值):</strong>将对象的值设置为<strong class="jx io"> <br/> get(函数):</strong>本的返回值</p><p id="7e30" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你想了解更多关于可用于配置属性描述符的键的信息，你可以在MDN文档<a class="ae lg" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty#description" rel="noopener ugc nofollow" target="_blank">这里</a>了解更多。</p><h1 id="7e96" class="ls lt in bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">实际例子</h1><p id="3fc0" class="pw-post-body-paragraph jv jw in jx b jy mq ka kb kc mr ke kf kg ms ki kj kk mt km kn ko mu kq kr ks ig bi translated">在下面的代码中，我们定义了一个<code class="fe lo lp lq lr b">pokemonApi</code>对象，该对象使用<a class="ae lg" href="https://www.npmjs.com/package/node-fetch" rel="noopener ugc nofollow" target="_blank"> node-fetch </a>模块调用PokéApi来检索关于特定神奇宝贝的信息。</p><p id="5fc7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如您可能已经猜到的那样，这个示例设计为使用NodeJS运行服务器端。</p><p id="456b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以在这里克隆回购<a class="ae lg" href="https://github.com/Adam-Reeves/PropertyDescriptorsDemo" rel="noopener ugc nofollow" target="_blank">并简单地运行<code class="fe lo lp lq lr b">yarn install &amp;&amp; yarn start</code>来查看运行中的代码。</a></p><figure class="la lb lc ld gt jo"><div class="bz fp l di"><div class="mv lf l"/></div></figure><p id="0738" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是时候打破它了🔨</p><ol class=""><li id="190e" class="mw mx in jx b jy jz kc kd kg my kk mz ko na ks nb nc nd ne bi translated">首先我们定义了<code class="fe lo lp lq lr b">makeGetRequest</code>函数，它使用基本URI和指定的资源发出获取请求，将其转换成JSON并打印出来。</li><li id="f842" class="mw mx in jx b jy nf kc ng kg nh kk ni ko nj ks nb nc nd ne bi translated">我们构造<code class="fe lo lp lq lr b">pokemonApi</code>对象(使用对象字面语法),这将是任何客户端代码与我们的API交互的方式。</li><li id="5378" class="mw mx in jx b jy nf kc ng kg nh kk ni ko nj ks nb nc nd ne bi translated">到好东西上！使用<code class="fe lo lp lq lr b">Object.defineProperty(...)</code>，我们说对于<code class="fe lo lp lq lr b">pokemonApi</code>上的<code class="fe lo lp lq lr b">headers</code>属性，我们想要将<code class="fe lo lp lq lr b">enumerable</code>、<code class="fe lo lp lq lr b">writable</code>和<code class="fe lo lp lq lr b"> configurable</code>设置为假。如果像这种情况下指定的属性已经存在，<code class="fe lo lp lq lr b">Object.defineProperty()</code>将修改现有的属性。</li><li id="f0c9" class="mw mx in jx b jy nf kc ng kg nh kk ni ko nj ks nb nc nd ne bi translated">我们为<code class="fe lo lp lq lr b">pokemonApi.pokemonName.</code> <br/>定义了一个getter和setter函数。<code class="fe lo lp lq lr b">get()</code>函数首先检查<code class="fe lo lp lq lr b">_pokemonName</code>是否为真值，然后调用<code class="fe lo lp lq lr b">PokéApi</code>来检索关于<code class="fe lo lp lq lr b">_pokemonName</code>中设置的神奇宝贝的信息。注意:我们必须使用<code class="fe lo lp lq lr b">call()</code>函数来确保<code class="fe lo lp lq lr b">this</code>被正确绑定。关于这方面的更多信息，请参见我上一篇关于JS绑定的文章。<br/> <code class="fe lo lp lq lr b">set()</code>将赋值操作的值作为参数<code class="fe lo lp lq lr b">pokemonName</code>赋值给<code class="fe lo lp lq lr b">_pokemonName</code>。</li></ol><p id="b8f8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将<code class="fe lo lp lq lr b">pokemonName</code>的getter和setter重定向到<code class="fe lo lp lq lr b">_pokemonName</code>以防止一个不明显的问题。</p><p id="3377" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们的二传手看起来像这样:</p><pre class="la lb lc ld gt nk lr nl nm aw nn bi"><span id="52b7" class="no lt in lr b gy np nq l nr ns">set(pokemonName) {<br/>      pokemonApi.pokemonName = pokemonName;<br/>  }</span></pre><p id="0f4e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当我们不断更新setter的值时，我们最终会递归地调用它，直到用尽调用堆栈上的空间。</p><p id="b499" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">5.类似于步骤3，除了我们使用<code class="fe lo lp lq lr b">Object.defineProperties(...)</code>通过一个函数调用来设置多个属性。</p><p id="2f45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">6.我们将<code class="fe lo lp lq lr b">'charizard'</code>赋值给<code class="fe lo lp lq lr b">pokemonApi.pokemonName</code>，这将调用我们定义的<code class="fe lo lp lq lr b">set('charizard')</code>函数并将<code class="fe lo lp lq lr b">_pokemonName</code>设置为<code class="fe lo lp lq lr b">'charizard'</code>。</p><p id="f998" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">7.最后，我们调用针对<code class="fe lo lp lq lr b">pokemonApi.pokemonName</code>定义的<code class="fe lo lp lq lr b">get()</code>函数，该函数包装了对PokéApi的调用，因此我们获得了最初3个启动器的最佳性能……charizard🔥</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><h1 id="8fe0" class="ls lt in bd lu lv nt lx ly lz nu mb mc md nv mf mg mh nw mj mk ml nx mn mo mp bi translated">结束语</h1><p id="911c" class="pw-post-body-paragraph jv jw in jx b jy mq ka kb kc mr ke kf kg ms ki kj kk mt km kn ko mu kq kr ks ig bi translated">虽然您在日常生活中可能不需要太担心属性描述符，但它们绝对有自己的使用案例。</p><p id="f93d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">出于好玩，这里有一个我从示例代码中使用的节点获取库中提取的示例:</p><pre class="la lb lc ld gt nk lr nl nm aw nn bi"><span id="a1f9" class="no lt in lr b gy np nq l nr ns">Object.defineProperties(<br/> Headers.prototype,<br/> ['get', 'entries', 'forEach', 'values'].reduce((result, property)               =&gt; {<br/>     result[property] = {enumerable: true};<br/>     return result;<br/>    }, {})<br/>);</span></pre><p id="a5e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这是在几个属性上设置<code class="fe lo lp lq lr b">enumerable: true</code>的一种非常简洁的方式。</p><p id="f48d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">reduce函数返回:</p><pre class="la lb lc ld gt nk lr nl nm aw nn bi"><span id="940c" class="no lt in lr b gy np nq l nr ns">{<br/>  entries: {enumerable: true}<br/>  forEach: {enumerable: true}<br/>  get: {enumerable: true}<br/>  values: {enumerable: true}<br/>}</span></pre><p id="f4a6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这作为参数之一传递给<code class="fe lo lp lq lr b">Object.defineProperties(...)</code>，从而设置属性描述符。</p></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="cc5c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们做到了！我希望这篇文章能让您对属性描述符的工作原理有更多的了解。</p><p id="20ec" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一如既往，如果您有任何问题、意见、建议等，请随时联系我们。</p><p id="c533" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">快乐黑客👩‍💻</p></div></div>    
</body>
</html>