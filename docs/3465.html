<html>
<head>
<title>Publish a TypeScript Package with GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发布带有GitHub操作的TypeScript包</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/publishing-a-typescript-npm-package-with-github-actions-7f6486e7da95?source=collection_archive---------5-----------------------#2021-07-13">https://javascript.plainenglish.io/publishing-a-typescript-npm-package-with-github-actions-7f6486e7da95?source=collection_archive---------5-----------------------#2021-07-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2d94" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">是的。没有理由不自动化这一点。</h2></div><p id="d71b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将功能分离到npm包中是模块化应用程序的好方法。另外，如果你决定让它公开，你将会因为回馈开源而获得额外的因果积分。</p><p id="9eef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您的代码存在于Github存储库中，那么发布到npm注册表将变得前所未有的简单。通过工作流和秘密管理，Github可以让您自动化整个过程。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/849523c2878bf7d9b794b743c82601a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ssu2F1HyBLciTeq6UphSQQ.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">This is what it feels like not to automate. <a class="ae lr" href="https://www.pexels.com/de-de/@karolina-grabowska?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Karolina Grabowska</a> von <a class="ae lr" href="https://www.pexels.com/de-de/foto/mann-hand-haus-gesichtslos-4498142/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><h1 id="08c5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">设置项目</h1><p id="57d6" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">由于每个npm项目本身在技术上是一个包，所以没有什么特别的东西需要你去关注。</p><p id="7702" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，您希望确保您选择的TypeScript和测试库是混合的(我在这里使用jest，但是<a class="ae lr" href="https://freddixx.medium.com/nodejs-testing-with-jest-vs-mocha-on-typescript-in-2021-7bffc28a4379" rel="noopener">选择您喜欢的</a>)。</p><p id="7522" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因为，你知道，毕竟，我们想成为优秀的开发人员，并且已经输入和测试了代码。你知道该怎么做。</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="09c2" class="mu lt iq mq b gy mv mw l mx my">yarn init -y<br/>yarn add --dev typescript jest ts-jest @types/jest</span></pre><p id="6621" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完成后，用默认配置快速初始化TypeScript:</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="2de5" class="mu lt iq mq b gy mv mw l mx my">yarn tsc --init</span></pre><p id="eb01" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打开您新生成的<code class="fe mz na nb mq b">tsconfig.json</code>，并如下调整您的设置，以确保代码文件被编译为<code class="fe mz na nb mq b">./lib</code>，并且您从循环中排除了那个文件夹以及测试和<code class="fe mz na nb mq b">node_modules</code>。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="176c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">就是这样。你的项目准备好了。您需要做的就是像平常一样添加代码，并确保导出它。</p><h1 id="6720" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">让您的代码准备好打包</h1><p id="43e2" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">在我介绍您的文件应该是什么样子之前，让我们花一点时间检查一下您的<code class="fe mz na nb mq b">package.json</code>。</p><p id="1e04" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">正如你可能已经猜到的，这将是你的包的入口点，它包含了一些你真的想得到正确的配置，以确保顺利航行。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ne nd l"/></div></figure><p id="e05f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些区段是<code class="fe mz na nb mq b">name</code>、<code class="fe mz na nb mq b">main</code>、<code class="fe mz na nb mq b">types</code>、<code class="fe mz na nb mq b">scripts</code>和<code class="fe mz na nb mq b">files</code>。以下是一个与上述<code class="fe mz na nb mq b">tsconfig.json</code>相对应的示例:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">An example package.json for a TypeScript npm package.</figcaption></figure><p id="6b22" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">无需深入细节，以下是您应该注意的几点:</p><ul class=""><li id="a78e" class="nf ng iq kh b ki kj kl km ko nh ks ni kw nj la nk nl nm nn bi translated"><code class="fe mz na nb mq b">name</code>需要独一无二。光有你的Github用户名下是不够的。如果具有该名称的包已经存在，您将无法发布它(除非它被限定了范围)。</li><li id="0073" class="nf ng iq kh b ki no kl np ko nq ks nr kw ns la nk nl nm nn bi translated"><code class="fe mz na nb mq b">main</code>和<code class="fe mz na nb mq b">types</code>支持一个文件。所以要确保从一个地方导出所有的功能。</li><li id="d470" class="nf ng iq kh b ki no kl np ko nq ks nr kw ns la nk nl nm nn bi translated">属性描述了当你的包被安装时，哪些文件将被包含。我的例子将所有内容都限制在<code class="fe mz na nb mq b">lib</code>文件夹中。我强烈建议你把它们都放在一个地方。</li><li id="1801" class="nf ng iq kh b ki no kl np ko nq ks nr kw ns la nk nl nm nn bi translated">最后，整理你的<code class="fe mz na nb mq b">scripts</code>。您希望在发布期间构建并测试您的包。这只会让你的生活更轻松。</li></ul><p id="3281" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也就是说，您的<code class="fe mz na nb mq b">src/index.ts</code>文件可以像这样简单:</p><pre class="lc ld le lf gt mp mq mr ms aw mt bi"><span id="58a4" class="mu lt iq mq b gy mv mw l mx my">import { Queue } from './queue';</span><span id="2521" class="mu lt iq mq b gy nt mw l mx my">export { Queue };</span></pre><p id="666e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">TypeScript将足够聪明地完成剩下的工作，并收集所有的定义以及所需文件的剩余部分:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/29932d4bd8616ac9c5d2ee2046c56c7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*vfFg6024ErJpZHJDBfletQ.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Et voila: The build output.</figcaption></figure><p id="1780" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦你上传你的代码到Github(或任何其他类似的DVCS)，你只剩下发布部分——你是一个好的开发者——你将完全自动化。</p><h1 id="2c3c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">获取Github机密的npm令牌</h1><p id="1b4f" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">npm软件包注册中心唯一需要的就是一个授权令牌。它将验证您的身份并在发布过程中使用。</p><p id="7d6a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您还没有这样做，请前往<a class="ae lr" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank">npmjs.com</a>创建一个帐户。</p><p id="4aae" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在您的帐户设置中，转到<strong class="kh ir">访问令牌</strong>并生成一个新令牌。确保选择“自动化”作为类型:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nv"><img src="../Images/fd92abcd4e667acb254646ef122e81e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CONLZE5XUNmwy-z9IxRJrw.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Don’t pick 1 or 3. Two is just right.</figcaption></figure><p id="be9f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将该令牌复制到某个地方，这样它就不会丢失，并导航到您的存储库设置(不要与您的Github用户帐户设置混淆)。</p><p id="f834" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来发生的事情将确保我们新生成的令牌将保持良好的保密性。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ne nd l"/></div></figure><p id="e26d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查找secrets部分并添加一个<strong class="kh ir">新的存储库秘密</strong>。将其命名为<code class="fe mz na nb mq b">NPM_TOKEN</code>，粘贴您之前复制的生成令牌，并点击<strong class="kh ir">添加秘密</strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8f41cde87fc3722fe86710baba766694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*dKl8qwkoNErI3o69RULpkA.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Here it is. Your npm token stored on Github.</figcaption></figure><p id="480a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，您的npm令牌被安全地加密并以其别名存储在Github Secrets上。</p><p id="dc4a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从现在起，你可以在任何脚本中引用它，而不必硬编码，从而向互联网上的任何人公开。</p><p id="dd2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">很漂亮，不是吗？</p><p id="4a0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">随着秘密的消失，让我们继续这个过程的最后一步，看看我们如何在这个过程中加入一些自动化。</p><h1 id="8f1c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">发布带有Github操作的npm包</h1><p id="c7bf" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">快到了。发布我们的npm包的最后一步是Github操作设置。</p><p id="52ee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">转到Github库的<em class="nx">动作</em>部分。如果您已经定义了现有的工作流，您可以直接打开一个新的工作流。如果这是您的第一个，请从登录页面选择<strong class="kh ir">自行设置工作流</strong>。</p><p id="9c6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于工作流只不过是模板化的yaml文件，您可以直接复制这个示例，它应该可以开箱即用:</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="3bce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如您所见，该工作流程在每次推送至master时执行，包括五个基本步骤。</p><p id="cf92" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除了检查代码和设置节点之外，它还运行预定义的<a class="ae lr" href="https://github.com/marketplace/actions/npm-publish" rel="noopener ugc nofollow" target="_blank">JS-dev tools/NPM-publish @ v1</a>动作，为您完成发布(假设您为它提供了令牌)。</p><p id="a3e9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">除此之外，我们确保项目实际上正在构建，以便生成包的文件。如果我们愿意，这也是调用<code class="fe mz na nb mq b">run: yarn test</code>的地方。</p><h1 id="0864" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">包发布:就这么简单。</h1><p id="06a4" class="pw-post-body-paragraph kf kg iq kh b ki mk jr kk kl ml ju kn ko mm kq kr ks mn ku kv kw mo ky kz la ij bi translated">保存文件并将更新推送到主服务器后，工作流将自动执行并将您的软件包发布到npm注册表。</p><p id="895b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要忘记增加您的<code class="fe mz na nb mq b">package.json</code>中的版本号，否则，操作将退出工作流运行而不发布。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ny"><img src="../Images/731f9c6ec69e7314551764568b2e7597.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XUR0lGF0mzT65V1RvVPREA.png"/></div></div></figure><p id="05db" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了所有这些设置，您就可以依靠Github Actions来发布您的包了。</p><p id="bc2c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">那很容易，不是吗？</p></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="69ef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nx">嗨，我是弗里德里希！我在工作中是一名经理和开发人员，在家里是一名业余爱好者——厨师、音乐家、数据和语言爱好者。可以在</em><a class="ae lr" href="https://bit.ly/3m0DXaT" rel="noopener ugc nofollow" target="_blank"><em class="nx">LinkedIn</em></a><em class="nx">上找我。</em></p><p id="0675" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nx">更多内容请看</em><a class="ae lr" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kh ir"><em class="nx">plain English . io</em></strong></a></p></div></div>    
</body>
</html>