<html>
<head>
<title>Develop Cross-platform Mobile Apps for IoT devices: An Easy Starter’s Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为物联网设备开发跨平台移动应用:简易入门指南</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/develop-cross-platform-mobile-apps-for-iot-devices-an-easy-starters-guide-bb9c01da9d87?source=collection_archive---------9-----------------------#2021-10-06">https://javascript.plainenglish.io/develop-cross-platform-mobile-apps-for-iot-devices-an-easy-starters-guide-bb9c01da9d87?source=collection_archive---------9-----------------------#2021-10-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1431" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">使用React Native、Firebase和Google Sheets为物联网设备构建移动应用。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/008686aa390e0e3cd18b1c5991383573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VZjyVLLYnDv5vZPRVJEosg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Created by the author</figcaption></figure><p id="c6e7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">物联网已经渗透到生活的几乎所有领域。它对住宅建设、医疗保健、物流和环境保护有着最重要的影响。你可以在我的专利项目<a class="ae lo" href="https://www.poojitagarg.com/smart-glove-for-physiotherapists" rel="noopener ugc nofollow" target="_blank">这里</a>探索医疗保健领域的一个这样的用例。在从事这个项目的过程中，我花了大量时间寻找为支持物联网的设备创建完美移动应用的方法。经过一番努力，花了大量时间阅读博客，观看了大量youtube视频，我终于设计出了一种创建完美移动应用程序的好方法，我将在这篇博客中分享它的基本原理。</p><p id="cef7" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">本教程将帮助您开发一个基本的React-Native移动应用程序，该应用程序能够通过Wi-Fi从您的物联网设备获取传感器读数，并将它们保存在Google sheets上以供将来检索。该指南基于应用程序开发及其与后端和云数据库的集成，因此，编码硬件(Arduino和Wi-Fi模块)的步骤可以在详细的<a class="ae lo" href="https://create.arduino.cc/projecthub/pulasthi-Narada/connecting-esp8266-to-firebase-to-send-receive-data-4adf66" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="fe5b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">让我们开始吧！为简单起见，我们将以一个<strong class="ku io">温度和湿度传感器系统</strong>为例，我们需要通过我们的应用程序查看和保存温度和湿度读数。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="3875" class="lu lv in lq b gy lw lx l ly lz"><strong class="lq io">· </strong><a class="ae lo" href="#9dc7" rel="noopener ugc nofollow"><strong class="lq io">Setup real-time database with Firebase</strong></a><br/>  ∘ <a class="ae lo" href="#8af8" rel="noopener ugc nofollow"><em class="ma">Step 1:</em> Creating an account and adding a project on Firebase</a><br/>  ∘ <a class="ae lo" href="#d808" rel="noopener ugc nofollow"><em class="ma">Step 2:</em> Add a real-time database to your project</a><br/>  ∘ <a class="ae lo" href="#e554" rel="noopener ugc nofollow"><em class="ma">Step 3: </em>creating nodes for your data in the real-time database</a></span><span id="9707" class="lu lv in lq b gy mb lx l ly lz"><strong class="lq io">· </strong><a class="ae lo" href="#08bb" rel="noopener ugc nofollow"><strong class="lq io">Connecting the React-Native app to firebase to view data on app</strong></a><br/>  ∘ <a class="ae lo" href="#a689" rel="noopener ugc nofollow"><em class="ma">Step 1:</em> Create a new React Native project</a><br/>  ∘ <a class="ae lo" href="#90a5" rel="noopener ugc nofollow"><em class="ma">Step 2:</em> Setup firebase in the app</a><br/>  ∘ <a class="ae lo" href="#a6d2" rel="noopener ugc nofollow"><em class="ma">Step 3:</em> Create a Firebase event listener</a></span><span id="3a80" class="lu lv in lq b gy mb lx l ly lz"><strong class="lq io">· </strong><a class="ae lo" href="#2e83" rel="noopener ugc nofollow"><strong class="lq io">Saving data to Google Sheets using Google’s Apps Script</strong></a><br/>  ∘ <a class="ae lo" href="#612a" rel="noopener ugc nofollow"><em class="ma">Step 1:</em> Create a Google Sheet for the project</a><br/>  ∘ <a class="ae lo" href="#a788" rel="noopener ugc nofollow"><em class="ma">Step 2:</em> Create Apps Script project</a><br/>  ∘ <a class="ae lo" href="#8592" rel="noopener ugc nofollow"><em class="ma">Step 3:</em> Create a function in the mobile app to save readings</a></span><span id="195e" class="lu lv in lq b gy mb lx l ly lz"><strong class="lq io">· </strong><a class="ae lo" href="#d932" rel="noopener ugc nofollow"><strong class="lq io">Conclusion</strong></a><br/>  ∘ <a class="ae lo" href="#09ae" rel="noopener ugc nofollow">Resources</a></span></pre><h1 id="9dc7" class="mc lv in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">用Firebase设置实时数据库</h1><p id="d1bc" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">Firebase是一个后端即服务(Baas ),可以用来创建一个最小可行产品(MVP ),保持低成本并快速构建应用原型。Firebase被谷歌收购，有一个健康活跃的社区。它为构建、发布、监控和分析应用程序提供了广泛的产品和解决方案。在本教程中，我们将使用Firebase的<em class="ma">实时数据库</em>作为我们的物联网设备和移动应用程序之间的桥梁。</p><h2 id="8af8" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤1:在Firebase上创建一个帐户并添加一个项目</h2><p id="bae3" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">你可以使用你的谷歌账户登录Firebase，然后进入“控制台”。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/10f312842a7e845d2c6755faf6fbaa8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IEHY8wEEChAryUV1WaO7zw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Firebase console (Image by author)</figcaption></figure><p id="3b2b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">点击“添加项目”,通过几个简单的步骤开始您的新firebase项目。</p><h2 id="d808" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤2:向项目中添加实时数据库</h2><p id="e228" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">单击左侧菜单中的“实时数据库”。通过添加您的位置和安全规则来创建新的实时数据库。<a class="ae lo" href="https://firebase.google.com/docs/rules/basics#realtime-database" rel="noopener ugc nofollow" target="_blank"> Firebase安全规则</a>允许您控制对存储数据的访问。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/9e9a15fbb4ef617b52df9cb4e9b52de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ocp7IjPoZVlgNx5sppkHnA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Choosing ‘Realtime Database’ from the left menu (Image by author)</figcaption></figure><p id="1d0f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">为了原型化我们的应用程序，我们将从“测试模式”开始。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/a832e90d5af8b7f532ff57e20c606f2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zw85cp2DbzYZUPTVCmoEdg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Start the real-time database in ‘test mode.’ (Image by author)</figcaption></figure><h2 id="e554" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤3:为实时数据库中的数据创建节点</h2><p id="2075" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">与SQL数据库不同，Firebase实时数据库以JSON树的形式存储数据，没有表或记录。数据作为一个节点添加到现有的JSON树中，并带有一个惟一的键。你可以在这里阅读更多关于数据库<a class="ae lo" href="https://firebase.google.com/docs/database/web/structure-data" rel="noopener ugc nofollow" target="_blank">的结构。一个空白的实时数据库应该是这样的。</a></p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/71a980dc618ec78da5a421b2b9de613f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ai-iwTRwwGCjL9rRyE8Vuw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Blank real-time database (Image by author)</figcaption></figure><p id="2b86" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">您可以通过单击“+”号添加带有名称和默认值的新节点。为了让硬件访问实时数据库，我们必须确保数据库的读取和写入规则都设置为“真”(如果还没有设置的话)。可以通过单击“规则选项卡”来查看规则。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/dbf47051590f047bd18851b611fb8d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jwi-nJFfJ8I8iSECYSbdsg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Setting read and write rules to ‘true’ (Image by author)</figcaption></figure><p id="7902" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在添加了湿度和温度两个节点并将它们的值分别初始化为‘0’之后，我们的数据库看起来会像这样。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/dc0319fe7319809007393c7d5577b31c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucGQY8ghqTRSniiBqnqFxw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Firebase real-time database with desired nodes (Image by author)</figcaption></figure><h1 id="08bb" class="mc lv in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">将React-Native应用程序连接到firebase以查看应用程序上的数据</h1><p id="4568" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">这一部分将创建一个简单的React-Native应用程序来显示我们的两个传感器读数。如果是第一次设置React原生开发环境，请参考<a class="ae lo" href="https://reactnative.dev/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> React原生官方文档</a>。</p><h2 id="a689" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤1:用VS代码或者任何你喜欢的编辑器创建一个新的React原生项目。</h2><p id="2c7f" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">对于本教程，我们将使用<a class="ae lo" href="https://expo.dev/" rel="noopener ugc nofollow" target="_blank"> Expo </a>来构建和部署我们的应用程序。Expo是一个开源平台，使用JavaScript和React Native为Android、iOS和web制作通用的原生应用程序。在终端中使用以下代码安装Expo CLI。我们将在React-Native项目的“App.js”文件中编写所有代码。</p><p id="1961" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe nl nm nn lq b">npm install --global expo-cli</code></p><h2 id="90a5" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤2:在应用程序中设置Firebase</h2><p id="5849" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">要在我们的应用程序中使用Firebase，我们需要在终端中使用下面的命令安装<code class="fe nl nm nn lq b">firebase</code>库。</p><p id="596b" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><code class="fe nl nm nn lq b">npm install firebase</code></p><p id="417e" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">安装后，我们可以通过以下三个简单的步骤在应用程序中设置Firebase。第一，您应该使用<code class="fe nl nm nn lq b">import * as firebase from “firebase”;</code>在代码中导入firebase；第二，使用下面的代码基于您的firebase实时数据库的配置创建一个Firebase配置变量。这些配置可以在Firebase项目控制台左侧菜单中的“项目设置”中找到。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="2702" class="lu lv in lq b gy lw lx l ly lz"> const firebaseConfig = {<br/> apiKey: "XXX",<br/> authDomain: "XXX",<br/> databaseURL: "XXX",<br/> projectId:"XXX",<br/> storageBucket: "XXX",<br/> };</span></pre><p id="e18f" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">第三，您必须使用<code class="fe nl nm nn lq b">firebase.initializeApp(firebaseConfig);</code>初始化firebase配置参数</p><h2 id="a6d2" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤3:创建Firebase事件侦听器</h2><p id="2fba" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">在这一步中，我们将首先使用<code class="fe nl nm nn lq b">this.state.mUserRef = firebase.database().ref();</code>定义一个数据库引用，这里我们引用数据库中的完整数据，并将其存储在变量<code class="fe nl nm nn lq b">mUserRef</code>中。</p><p id="cd98" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，我们必须在先前生成的数据库引用上创建一个事件监听器，以监视特定Firebase节点中的更改。在我们的例子中，每当新数据被添加到我们的数据库引用中时，监听器会自动向应用程序提供更新的数据，称为<code class="fe nl nm nn lq b">snapshot</code>。你可以在这里了解更多这样的事件处理程序<a class="ae lo" href="https://firebase.google.com/docs/database/admin/retrieve-data#node.js" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9512" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">在代码的后面，我们从实时数据的<code class="fe nl nm nn lq b">snapshot</code> <em class="ma"> </em>中获取温度和湿度的firebase变量的值到两个本地变量<code class="fe nl nm nn lq b">data_1</code>和<code class="fe nl nm nn lq b">data_2</code>。之后，我们使用下面的代码设置React本机状态对象<code class="fe nl nm nn lq b">temperature</code>和<code class="fe nl nm nn lq b">humidity </code>的状态，我们已经用各自的值初始化了它们。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="9c8b" class="lu lv in lq b gy lw lx l ly lz"> this.state.mUserRef.on(“value”, function (snapshot) {<br/>       let data_1 = snapshot.val().temprature;<br/>       let data_2 = snapshot.val().humidity; that.setState({<br/>       temprature: data_1,<br/>       humidity: data_2,<br/> });<br/> });</span></pre><h1 id="2e83" class="mc lv in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated">使用Google的应用程序脚本将数据保存到Google Sheets</h1><p id="194b" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated"><a class="ae lo" href="https://www.google.com/sheets/about/" rel="noopener ugc nofollow" target="_blank"> Google Sheets </a>是一个电子表格程序，是Google提供的免费的基于网络的Google Docs编辑器套件的一部分。我们将使用Google Sheets作为我们的云数据库来存储我们的传感器读数。</p><p id="f2c4" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><a class="ae lo" href="https://developers.google.com/apps-script" rel="noopener ugc nofollow" target="_blank"> Apps Script </a>是Google开发的一个脚本平台，用于Google Workspace平台中的轻量级应用开发。Apps Script是一个平台，允许用户通过JavaScript派生的脚本语言来扩展谷歌的在线产品G套件。我们将使用应用程序脚本来自动添加我们的谷歌电子表格与添加的时间戳读数。</p><h2 id="612a" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤1:为项目创建一个Google Sheet作为云存储</h2><p id="ed53" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">转到Google Sheets，用您的Google帐户登录。创建一个新的电子表格，并添加三列来记录<strong class="ku io">日期</strong>、<strong class="ku io">温度</strong>和<strong class="ku io">湿度</strong>。您的工作表看起来会像这样</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/4e22cbdde43829a4e7fa43ed853d0068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwsSmGAbURU1pSxIL4Zx9w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Blank google sheet with desired columns (Image by author)</figcaption></figure><h2 id="a788" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">步骤2:创建一个Apps脚本项目，在Google Sheets和React Native app之间创建一个连接。</h2><p id="380d" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">要使用Apps脚本，首先使用您的Google帐户登录<a class="ae lo" href="https://www.google.com/script/start/" rel="noopener ugc nofollow" target="_blank"> Apps脚本</a>，点击“新建项目”创建一个新项目。我们将使用<code class="fe nl nm nn lq b">SpreadsheetApp.openByUrl</code>它连接我们之前创建的Google电子表格，通过使用它的<strong class="ku io"> URL </strong>连接到我们的应用程序脚本项目，并在变量<code class="fe nl nm nn lq b">spreadsheet</code>中引用它。要复制<strong class="ku io"> URL </strong>，<strong class="ku io"> </strong>到浏览器顶部，点击地址栏选择整个<strong class="ku io"> URL </strong>。</p><p id="6ad1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后，我们使用<code class="fe nl nm nn lq b">spreadsheet</code>变量来获取电子表格的特定工作表，即‘sheet 1’。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="67c2" class="lu lv in lq b gy lw lx l ly lz">// fetch spreadsheet using its URL<br/>var spreadsheet = SpreadsheetApp.openByUrl({<strong class="lq io">URL</strong>});</span><span id="9c95" class="lu lv in lq b gy mb lx l ly lz">// reference the particular sheet in the sheet variable<br/>var sheet= spreadsheet.getSheetByName("Sheet1");</span></pre><p id="5d69" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">现在，我们用参数<code class="fe nl nm nn lq b">e</code>创建一个doPost()函数，稍后我们将引用我们从移动应用程序的Post请求中收到的数据。我们使用Date()函数给变量<code class="fe nl nm nn lq b">date</code>分配时间戳。稍后，我们将参数解析成<code class="fe nl nm nn lq b">e.parameter</code>以获得<code class="fe nl nm nn lq b">temperature</code>和<code class="fe nl nm nn lq b">humidity</code>变量的值。此外，我们使用appendRow()函数并传递一个变量列表，我们需要将这些变量添加到Google sheet中。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="2ae6" class="lu lv in lq b gy lw lx l ly lz">function doPost(e){<br/>var date = new Date();<br/>var temperature = e.parameter.temp;<br/>var humidity = e.parameter.hum;<br/>sheet.appendRow([date,temp,hum]);<br/>return ContentService.createTextOutput(“Success”).setMimeType(ContentService.MimeType.TEXT); }</span></pre><p id="1fd6" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们使用<a class="ae lo" href="https://developers.google.com/apps-script/guides/content" rel="noopener ugc nofollow" target="_blank"> ContentService </a>来指示我们的数据保存成功，并使用createTextOuput中的字符串“Success”作为指示符。我们将mime类型设置为<code class="fe nl nm nn lq b">ContentService.MimeType.TEXT</code>，以成功地将我们的响应发送到我们的应用程序中的调用函数。你可以在下面找到完整的应用程序脚本代码。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="f226" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">保存后，我们将把项目部署为web应用程序。我们的web应用程序生成的URL将在稍后的应用程序代码中用于向我们的应用程序脚本代码发出POST请求。使用以下步骤将应用程序脚本项目部署为web应用程序。</p><ol class=""><li id="b2b8" class="nr ns in ku b kv kw ky kz lb nt lf nu lj nv ln nw nx ny nz bi translated">在脚本项目的右上方，点击<strong class="ku io">部署</strong> &gt; <strong class="ku io">新建部署</strong>。</li><li id="43bf" class="nr ns in ku b kv oa ky ob lb oc lf od lj oe ln nw nx ny nz bi translated">在“选择类型”旁边，单击启用部署类型设置&gt;<strong class="ku io"> Web应用程序</strong>。</li><li id="d19b" class="nr ns in ku b kv oa ky ob lb oc lf od lj oe ln nw nx ny nz bi translated">在“部署配置”下的字段中输入有关您的web应用程序的信息</li><li id="158c" class="nr ns in ku b kv oa ky ob lb oc lf od lj oe ln nw nx ny nz bi translated">点击<strong class="ku io">部署</strong>。</li><li id="e6d1" class="nr ns in ku b kv oa ky ob lb oc lf od lj oe ln nw nx ny nz bi translated">复制URL并保存以备后用。</li></ol><p id="5101" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="ma">注意:</em> </strong> <em class="ma">您应该确保，对于要由我们的移动应用程序访问的应用程序脚本web应用程序，在部署应用程序时，应将“有权访问的人”列标记为“任何人”</em></p><h2 id="8592" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">第三步:在手机应用程序中创建一个功能，将读数保存到谷歌工作表中</h2><p id="64be" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">我们将从在React-Native代码中创建一个名为<code class="fe nl nm nn lq b">saveReadings()</code>的函数开始。我们将使用'<a class="ae lo" href="https://www.npmjs.com/package/form-data" rel="noopener ugc nofollow" target="_blank">表单-数据'</a>库来创建可读的“多部分/表单-数据”流，用于向其他web应用程序提交表单和文件上传。在我们的例子中，我们将使用表单数据来发送温度和湿度值。要安装表单数据库，使用项目终端<code class="fe nl nm nn lq b">npm install form-data</code>中的代码，并使用<code class="fe nl nm nn lq b">import FormData from “form-data”;</code>将其导入到您的代码中</p><p id="4d53" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">接下来，我们将创建一个“FormData”类型的变量<code class="fe nl nm nn lq b">bodyData</code>。我们将为变量<code class="fe nl nm nn lq b">bodyData</code>添加我们之前设置的<code class="fe nl nm nn lq b">temperature</code>和<code class="fe nl nm nn lq b">humidity</code> <em class="ma"> </em>的状态数据值，同时使用<code class="fe nl nm nn lq b">temp</code>和<code class="fe nl nm nn lq b">hum</code>作为名称，以便在稍后作为参数传递时识别这些变量。</p><p id="978d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><strong class="ku io"> <em class="ma">注意:</em> </strong> <em class="ma">确保变量“temp”和“hum”应该与在Apps脚本中使用e.parameter解析参数时使用的变量相同。</em></p><p id="71ce" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">然后，我们将使用React-Native的<a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API" rel="noopener ugc nofollow" target="_blank"> Fetch API </a>将我们的移动应用程序连接到我们的应用程序脚本的远程URL。我们使用fetch()函数发出POST请求，并在其主体中传递我们的<code class="fe nl nm nn lq b">bodyData</code>。Fetch方法将返回一个<a class="ae lo" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" rel="noopener ugc nofollow" target="_blank">承诺</a>，我们可以使用<code class="fe nl nm nn lq b">.then</code>得到它，并在变量<em class="ma"> res </em>中捕捉响应。稍后，我们使用<em class="ma"> res </em>变量进行检查，通过使用<a class="ae lo" href="https://reactnative.dev/docs/alert" rel="noopener ugc nofollow" target="_blank"> Alert </a>创建具有指定标题和消息的警告对话框来警告用户保存是否成功。</p><p id="0e85" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">下面给出了saveReadings()函数的完整代码。</p><pre class="kd ke kf kg gt lp lq lr ls aw lt bi"><span id="4626" class="lu lv in lq b gy lw lx l ly lz">saveReadings = () =&gt; {<br/> <br/> var bodyData = new FormData();<br/> bodyData.append(“temp”, this.state.temprature);<br/> bodyData.append(“hum”, this.state.humidity);</span><span id="9906" class="lu lv in lq b gy mb lx l ly lz"> fetch(<br/> “{<strong class="lq io">URL</strong>}",<br/> <br/> {<br/> method: “POST”,<br/> body: bodyData,<br/> }<br/> )<br/> .then((response) =&gt; response.text())<br/> .then((res) =&gt; {<br/> <br/> if (res == “Success”) {<br/> Alert.alert(“Great!”, “readings saved”, [{ text: “done” }]);<br/> }<br/> })<br/> .catch((e) =&gt; {<br/> console.log(e);<br/> });<br/> <br/> };</span></pre><p id="02b1" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">我们将调用这个saveReadings()函数。下面给出了react-native应用程序的完整代码，包括使用的样式表和呈现组件。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="e219" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">使用<code class="fe nl nm nn lq b">expo start</code>运行移动应用程序。您将被重定向到远程expo服务器，在那里您可以扫描生成的二维码以使用手机上的应用程序。您的应用程序看起来会像这样。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi of"><img src="../Images/0af679697afd78d7ec7ac48ef400b179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*oEWIt4I84B1iNnezMLRTNg.gif"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">The final mobile application view</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nj"><img src="../Images/40f0ad30eefcae24d7a616ddde84477f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T4zsbPoiZq3SG3bVtCruA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">View of Google Sheets after saving some values</figcaption></figure><p id="b214" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">本教程到此为止。我希望这能帮助你开始物联网设备的应用程序开发，并帮助你使用它创建许多令人敬畏的“智能”项目:)</p><h1 id="d932" class="mc lv in bd md me mf mg mh mi mj mk ml jt mm ju mn jw mo jx mp jz mq ka mr ms bi translated"><strong class="ak">结论</strong></h1><p id="2996" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated">在本教程中，我们学习了如何在用于物联网设备的任何应用的三个基本组件之间创建基本连接，即实时后端、移动应用开发和云存储。在为基础服务的同时，这些连接可以根据特定的用例进行扩展，以包含更广泛和更复杂的功能。</p><p id="537d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">最后，如果您正在开发包含敏感逻辑的商业React原生应用程序，请不要忘记特别注意。您可以了解更多关于安全方面的信息，以保护您的react原生应用程序免受代码窃取、篡改和逆向工程<a class="ae lo" href="https://medium.com/simform-engineering/security-aspects-to-consider-for-a-react-native-application-95556f0e4244" rel="noopener">点击这里</a>。</p><p id="597d" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated">感谢阅读。编码快乐！</p><h2 id="09ae" class="lu lv in bd md my mz dn mh na nb dp ml lb nc nd mn lf ne nf mp lj ng nh mr ni bi translated">资源</h2><p id="ad69" class="pw-post-body-paragraph ks kt in ku b kv mt jo kx ky mu jr la lb mv ld le lf mw lh li lj mx ll lm ln ig bi translated"><a class="ae lo" href="https://github.com/poojitagarg/iot_app_dev" rel="noopener ugc nofollow" target="_blank">完整代码实现</a></p><p id="99f8" class="pw-post-body-paragraph ks kt in ku b kv kw jo kx ky kz jr la lb lc ld le lf lg lh li lj lk ll lm ln ig bi translated"><em class="ma">更多内容请看</em><a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ku io"><em class="ma">plain English . io</em></strong></a></p></div></div>    
</body>
</html>