<html>
<head>
<title>Coding Adventure: PositiveNumber in TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编码冒险:TypeScript中的PositiveNumber</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/coding-adventure-positivenumber-in-typescript-8c642c17bc76?source=collection_archive---------0-----------------------#2021-11-25">https://javascript.plainenglish.io/coding-adventure-positivenumber-in-typescript-8c642c17bc76?source=collection_archive---------0-----------------------#2021-11-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><h2 id="e2d6" class="il im in bd b dl io ip iq ir is it dk iu translated" aria-label="kicker paragraph">编码冒险</h2><div class=""/><p id="5fff" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">你能做一个正数类型吗？了解如何为您的TypeScript类型编写高级规则。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/bc675716b9df9176b481560accc03026.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5chMCgUSBS7XfVCi1R0qLQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Can you make a PositiveNumber type?</figcaption></figure><h1 id="0ea9" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">你会做正数吗？</h1><p id="2502" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">在使用TypeScript的第一天，我学习了像数字、字符串和布尔这样的基本类型。但是我很失望没有找到<code class="fe mk ml mm mn b">PositiveNumber</code>。</p><p id="0741" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">没有这么基本和有用的类型，我怎么能写出我的类型安全程序呢？我想要的东西就像上面的图片。</p><p id="5b10" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">在学习了6个月的打字技巧后，我终于可以做我的PositiveNumber了。今天，我邀请您参与这次编码冒险。</p><h1 id="e686" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">正数=数字</h1><p id="2dcc" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">非常简单明了。然而，行不通。我们能做得更好吗？</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/20631edb73d63e25393c714edb2c3f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDUsv4RRszZiS0lRkXMPSQ.png"/></div></div></figure><h1 id="08e7" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">对于正数，我们需要运行时检查</h1><p id="70e1" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">为了检查数字符号，我们需要一个运行时值检查来确定。有一种方法可以在编译时在TypeScipt中实现，这是一种将数字转换为字符串并检查第一个字符的巧妙方法，但是这20行TS魔术并不实用。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mo"><img src="../Images/9f8b1dea72a9289ffd7caa7d28f7f5ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdqeZoZIZfqw7FEck9JkPQ.png"/></div></div></figure><p id="6f1c" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">positiveNumberSchema()会将任何数字转换为PositiveNumber。如果数字不是正数，assert()将抛出异常。</p><p id="83d8" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">好多了，但是我们仍然没有红色的曲线:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mp"><img src="../Images/91e69e5b2da90ed8f0ece974e025ba85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YckEFkuAqOpaFmf1sbVCAA.png"/></div></div></figure><p id="90c2" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">positiveNumberSchema(-1)将在运行时抛出异常。然而，对于f(-2)，我们仍然没有得到错误。我们在f(x)中的x仍然可以是负数。让我们修复它，并添加<strong class="jv ix">品牌</strong>。</p><h1 id="c8d4" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">对于正数，我们需要品牌</h1><p id="ba93" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">我们将我们的正数定义为数字+_ _品牌。这是一个很酷的打字技巧！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mq"><img src="../Images/66a55a104a94ef9d024aaf7ed54f6847.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDuzVs3EHNcC2T2S9E0pPA.png"/></div></div></figure><p id="3048" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">现在我们不能将任何数字转换成正数。检查这个:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/3e4c332a3879ba0b1420407e500b60ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D5RCu9hM6Gr-ASxNcwKhoA.png"/></div></div></figure><p id="daf3" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">positiveNumberSchema()返回PositiveNumber，所以我们可以调用f()而不会出错。但是-2只是一个数字，它没有品牌<code class="fe mk ml mm mn b">{__brand: ‘PositiveNumber’}</code>。因为品牌部分丢失，TypeScript报错:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ms"><img src="../Images/cf884cc4f58e590bffc7d7f97bb8f436.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mLamZMOiOe7DExVqdzZP9w.png"/></div></div></figure><p id="2cbd" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">但是我们可以在positiveNumberSchema() tho中找到同样的错误:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/0980e19011ce64b17d95856b71c81d3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mmdx8fvneB6fNbA_g2G-lA.png"/></div></div></figure><p id="eb7f" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">用“as”造型可以很容易地解决这个问题:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/7601dfc3f989220d4a2bf86629a5a569.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kI4MZGCG0CWIiVfH98cMXw.png"/></div></div></figure><p id="f12f" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">让我们检查一下当前的结果</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mr"><img src="../Images/35f5b873a631fb5242f42cadbefeb71d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzFPC0cWlSe27Ug5W7LiyA.png"/></div></div></figure><p id="c07b" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">现在我们可以100%确定，除非有人使用“as”强制转换，否则f()将以正数被调用。</p><p id="0a7f" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我们甚至可以组合我们的函数，不需要反复检查数字是否为正数。所有的检查都发生在程序的边界上。f()和f2()保证用正数调用:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/376c230e7c39648ff2ec6c9eaaad3afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s37jATis8r4j7KlmeYqkFg.png"/></div></div></figure><h1 id="c7a8" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">将any转换为正数</h1><p id="ca66" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">通常，节点/快速路线参数和数据库查询结果具有“任意”或“未知”类型。如果我告诉你positiveNumberSchema()可以被修改来接收任何类型，会怎么样？</p><p id="2954" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">当您的程序从外部接收输入时，这很有用:节点/快速路由调用或数据库查询结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/97792295e42ef0133fb062cda11fff0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FN0rpVJtMUGc2bKlU2aoKQ.png"/></div></div></figure><p id="0ffc" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我们可以想出很酷的规则，比如从用户输入中去掉空格，将字符串转换成数字。或者我们可以将true转换为1。但是如果我们不能将输入转换成正数，我们将抛出一个异常:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mu"><img src="../Images/21f34d04daed0844f9144175a1d45768.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0XaS52MhUshE4dnhUQxVXQ.png"/></div></div></figure><p id="702d" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">让我们使用pipe()组合重写positiveNumberSchema():</p><ul class=""><li id="325a" class="mv mw in jv b jw jx ka kb ke mx ki my km mz kq na nb nc nd bi translated">我将为我的管道使用“lodash/fp”模块()</li><li id="7296" class="mv mw in jv b jw ne ka nf ke ng ki nh km ni kq na nb nc nd bi translated">refine()是assert()的包装器，所以我们可以用pipe()链接它</li><li id="4d21" class="mv mw in jv b jw ne ka nf ke ng ki nh km ni kq na nb nc nd bi translated">hasBrand()是“as”造型的包装器，所以我们可以用pipe()链接它</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nj"><img src="../Images/db3bcb1a2aa8d6d7474c4ee3c36795f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hH9xDK6GeWHOwrZkmkifSQ.png"/></div></div></figure><p id="0a88" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">基本上，从positiveNumberSchema()返回的任何值都是正数。我们可以重写正数类型定义:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nj"><img src="../Images/889704cbd35eadf40d0664d17b9a43be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S5l5KxDqfIjHMeQ_EXqRYQ.png"/></div></div></figure><h1 id="f359" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">将正数转换为价格</h1><p id="55a6" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">但是我们可以更深入。</p><p id="b98f" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">如果你正在做一个交易应用程序的后台，你的用户可以输入价格。您还将价格存储在数据库中。你所有的价格都是美元。诀窍是，您的价格应该是正数，并且只支持逗号后的2位数:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nk"><img src="../Images/666b28f0d1d912a2eeb91b4007071fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DwqV0iyqWvW-ZidFH_fkFQ.png"/></div></div></figure><p id="a94a" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我们可以将价格类型定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nl"><img src="../Images/035693829e8bdbe760c8ad5d4f0ea06e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YTpVdqxfvhecGutfRXe6mw.png"/></div></div></figure><p id="8e2d" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">现在，每个将接收Pirce作为输入的函数都将保证价格为正，并四舍五入到逗号后的两位数。</p><p id="f049" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">你可以构建你的域名逻辑<code class="fe mk ml mm mn b">sellProduct(price: Price)</code>,而不用担心用户会把负数作为销售价格。</p><p id="4afc" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">如果某个用户在某个web表单上为价格写了一个负数，他会得到一个错误。如果他在逗号后用空格和更多的数字写价格，它将被规范化为正确的价格。</p><p id="1e93" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">多酷啊。</p><h1 id="7963" class="lh li in bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">结论</h1><p id="1c1d" class="pw-post-body-paragraph jt ju in jv b jw mf jy jz ka mg kc kd ke mh kg kh ki mi kk kl km mj ko kp kq ig bi translated">我希望现在您看到了TypeScript模式是多么强大。它们允许您定义高级类型，如正数或价格。你不再局限于基本的数字/字符串/布尔。</p><p id="d300" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">但这只是冰山一角。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nl"><img src="../Images/b213d5747a8494ed8b13dea8d6ef20fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUtCaYlb96FykvJXzsY7bA.png"/></div></div></figure><p id="8469" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated">我希望你喜欢这篇文章，你今天会觉得更有灵感。再见。</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><p id="f6d3" class="pw-post-body-paragraph jt ju in jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ig bi translated"><em class="nt">更多内容尽在</em> <a class="ae nu" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jv ix"> <em class="nt">说白了. io </em> </strong> </a> <em class="nt">。报名参加我们的</em> <a class="ae nu" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jv ix"> <em class="nt">免费每周简讯这里</em> </strong> </a> <strong class="jv ix"> <em class="nt">。</em> </strong></p></div></div>    
</body>
</html>