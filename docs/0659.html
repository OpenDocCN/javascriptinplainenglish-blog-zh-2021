<html>
<head>
<title>Preact — Side Effect Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预防—副作用挂钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/preact-side-effect-hooks-793583695a90?source=collection_archive---------12-----------------------#2021-02-10">https://javascript.plainenglish.io/preact-side-effect-hooks-793583695a90?source=collection_archive---------12-----------------------#2021-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/8b0e356f5ab50c709e50f2001e98c007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C8UlP1ZRo3c1Q9kQ"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@_louisreed?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Louis Reed</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="edf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Preact是一个前端web框架，类似于react。</p><p id="cee5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它比React小，也不复杂。</p><p id="ced6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始使用Preact进行前端开发。</p><h1 id="5795" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用效果</h1><p id="e46e" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们使用<code class="fe me mf mg mh b">useEffect</code>钩子来提交副作用。</p><p id="170d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="52ab" class="mq lc iq mh b gy mr ms l mt mu">import { render } from "preact";<br/>import { useEffect } from "preact/hooks";</span><span id="d050" class="mq lc iq mh b gy mv ms l mt mu">function PageTitle({ title }) {<br/>  useEffect(() =&gt; {<br/>    document.title = title;<br/>  }, [title]);</span><span id="5959" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;h1&gt;{title}&lt;/h1&gt;;<br/>}</span><span id="0872" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;PageTitle title="hello world" /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}<br/>if (typeof window !== "undefined") {<br/>  render(&lt;App /&gt;, document.getElementById("root"));<br/>}</span></pre><p id="aaa0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有带<code class="fe me mf mg mh b">title</code>道具的<code class="fe me mf mg mh b">PageTitle</code>组件。</p><p id="42d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用<code class="fe me mf mg mh b">useEffect</code>钩子的第二个参数来观察它的值。</p><p id="7281" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将<code class="fe me mf mg mh b">document.title</code>设置为<code class="fe me mf mg mh b">title</code>道具的值。</p><p id="0689" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以在装载组件时使用它来监听事件，在卸载组件时解除事件处理程序的绑定。</p><p id="e73d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1a33" class="mq lc iq mh b gy mr ms l mt mu">import { render } from "preact";<br/>import { useEffect, useState } from "preact/hooks";</span><span id="302a" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  const [width, setWidth] = useState(0);</span><span id="4e31" class="mq lc iq mh b gy mv ms l mt mu">  function onResize() {<br/>    setWidth(window.innerWidth);<br/>  }</span><span id="2c28" class="mq lc iq mh b gy mv ms l mt mu">  useEffect(() =&gt; {<br/>    window.addEventListener("resize", onResize);<br/>    return () =&gt; window.removeEventListener("resize", onResize);<br/>  }, []);</span><span id="d23f" class="mq lc iq mh b gy mv ms l mt mu">  return &lt;div&gt;Window width: {width}&lt;/div&gt;;<br/>}<br/>if (typeof window !== "undefined") {<br/>  render(&lt;App /&gt;, document.getElementById("root"));<br/>}</span></pre><p id="85f5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们用<code class="fe me mf mg mh b">width</code>状态来设置窗口的宽度。</p><p id="9a25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">onResize</code>调用<code class="fe me mf mg mh b">setWidth</code>设置宽度。</p><p id="8819" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe me mf mg mh b">useEffect</code>钩子中，我们调用<code class="fe me mf mg mh b">window.addEventListener</code>来监听<code class="fe me mf mg mh b">resize</code>事件。</p><p id="0e73" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们卸载组件时，我们返回回调来删除监听器。</p><p id="7a27" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们在<code class="fe me mf mg mh b">div</code>中显示<code class="fe me mf mg mh b">width</code>。</p><p id="9c02" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们调整窗口大小时，我们会看到宽度数字的变化。</p><h1 id="52ef" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">useLayoutEffect</h1><p id="781b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><code class="fe me mf mg mh b">useLayoutEffect</code>与<code class="fe me mf mg mh b">useEffect</code>具有相同的签名，但是一旦组件不同，浏览器有机会绘制时，它就会启动。</p><h1 id="39e8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">useErrorBoundary</h1><p id="429f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">当子组件抛出错误时，<code class="fe me mf mg mh b">useErrorBoundary</code>钩子让我们捕捉错误。</p><p id="78f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以用这个钩子抓住它们。</p><p id="b871" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="da38" class="mq lc iq mh b gy mr ms l mt mu">import { render } from "preact";<br/>import { useErrorBoundary } from "preact/hooks";</span><span id="dd94" class="mq lc iq mh b gy mv ms l mt mu">const Child = () =&gt; {<br/>  if (Math.random() &lt; 0.5) {<br/>    throw new Error("error");<br/>  }<br/>  return &lt;p&gt;child&lt;/p&gt;;<br/>};</span><span id="ed0f" class="mq lc iq mh b gy mv ms l mt mu">const Parent = ({ children }) =&gt; {<br/>  const [error, resetError] = useErrorBoundary();</span><span id="4c2b" class="mq lc iq mh b gy mv ms l mt mu">  if (error) {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;p&gt;{error.message}&lt;/p&gt;<br/>        &lt;button onClick={resetError}&gt;Try again&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  } else {<br/>    return &lt;div&gt;{children}&lt;/div&gt;;<br/>  }<br/>};</span><span id="a985" class="mq lc iq mh b gy mv ms l mt mu">export default function App() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;Parent&gt;<br/>        &lt;Child /&gt;<br/>      &lt;/Parent&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}<br/>if (typeof window !== "undefined") {<br/>  render(&lt;App /&gt;, document.getElementById("root"));<br/>}</span></pre><p id="897b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有随机抛出错误的<code class="fe me mf mg mh b">Child</code>组件。</p><p id="043d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还有<code class="fe me mf mg mh b">Parent</code>组件，如果子组件中没有抛出错误，它就会呈现子组件。</p><p id="ad94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果子组件中有错误抛出，那么我们显示错误并显示一个按钮，当我们单击它时运行<code class="fe me mf mg mh b">resetError</code>功能。</p><p id="cf91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">resetError</code>重新安装组件。</p><p id="af94" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以当我们在<code class="fe me mf mg mh b">Child</code>中出现错误时，我们可以点击重试来刷新子组件。</p><h1 id="d153" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="4218" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">useEffect</code>钩子来产生副作用。</p><p id="ee0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以使用<code class="fe me mf mg mh b">useErrorBoundary</code>钩子来捕捉子组件引发的错误。</p><p id="d92e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>