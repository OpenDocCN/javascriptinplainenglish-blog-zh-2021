<html>
<head>
<title>How to Test a Sitemap with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Cypress测试一个站点地图</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-test-a-sitemap-with-cypress-31b99cccd600?source=collection_archive---------5-----------------------#2021-09-24">https://javascript.plainenglish.io/how-to-test-a-sitemap-with-cypress-31b99cccd600?source=collection_archive---------5-----------------------#2021-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4639" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">测试一个站点地图需要两个简单的步骤:读取XML和检查链接！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/85f05c649c8f7b696b199736646a8dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ka2MUlJUtpc6kkTqk91DHQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/tree/main/examples/sitemap" rel="noopener ugc nofollow" target="_blank">https://github.com/riccardogiorato/cypress-for-everything/tree/main/examples/sitemap</a></figcaption></figure><h2 id="74ec" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">为什么要为网站地图做E2E测试？</h2><p id="7664" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">构建E2E可以很好地为用户操作服务，但是有时候构建一个快速测试也可以帮助你通过构建你自己的“虚拟版本”来节省大量时间。</p><p id="8b64" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">测试一个站点地图可以让你检查你的网站的每一次构建或改变是否所有的页面都正确地生成或编译了不同的页面。</p><p id="e37b" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">对于本教程，我们选择使用Cypress.io，因为它是网络上最常用的E2E工具之一。</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="e111" class="mx kx iq bd ky my mz na lb nb nc nd le jw ne jx li jz nf ka lm kc ng kd lq nh bi translated">1.读取sitemap.xml</h1><p id="8cb4" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">从sitemap.xml文件中获取所有URL的数组，并解析它以获取所有完整的链接！</p><p id="62e5" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们需要发出一个“cy.request ”,基本上是对sitemap XML文件的一个简单的HTTP请求。然后我们获取响应，用cypress解析它，得到所有不同的“loc”项，每个项都是一个单独的页面。</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="5c13" class="kw kx iq nj b gy nn no l np nq">let urls = [];<br/>  before(() =&gt; {<br/>    cy.request({<br/>      url: "<a class="ae kv" href="https://www.vercel.com/sitemap.xml" rel="noopener ugc nofollow" target="_blank">https://www.vercel.com/sitemap.xml</a>",<br/>      headers: {<br/>        "Content-Type": "text/xml; charset=utf-8",<br/>        "user-agent":<br/>          "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36",<br/>      },<br/>    })<br/>      .as("sitemap")<br/>      .then((response) =&gt; {<br/>        urls = Cypress.$(response.body)<br/>          .find("loc")<br/>          .toArray()<br/>          .map((el) =&gt; el.innerText);<br/>      });<br/>  });</span></pre></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="4fe4" class="mx kx iq bd ky my mz na lb nb nc nd le jw ne jx li jz nf ka lm kc ng kd lq nh bi translated">2.检查网址</h1><p id="1764" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">现在你需要扫描整个链接列表，检查它们是否有效！我们准备了两种可能性:</p><ul class=""><li id="f1b1" class="nr ns iq lu b lv ml ly mm lf nt lj nu ln nv mk nw nx ny nz bi translated"><a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/blob/main/examples/sitemap/cypress/integration/sitemap-fast.ts" rel="noopener ugc nofollow" target="_blank">快速检查</a>:快速检查站点地图，只检查来自服务器的200个响应页面URL。✨</li><li id="c3d4" class="nr ns iq lu b lv oa ly ob lf oc lj od ln oe mk nw nx ny nz bi translated"><a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/blob/main/examples/sitemap/cypress/integration/sitemap-slow.ts" rel="noopener ugc nofollow" target="_blank">慢速检查</a>:检查整个页面是否已加载完毕，等待JavaScript加载。✨</li></ul><h2 id="37dd" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">慢速检查</h2><p id="7d27" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">为了进行完整的检查，我们需要检查URL是否有效。</p><p id="c995" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">我们将使用“cy.visit”，该命令将加载页面，并等待页面JavaScript完全加载。这将导致更慢的测试，因为每个页面都需要完全加载！</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="255c" class="kw kx iq nj b gy nn no l np nq">it("should succesfully load each url in the sitemap", () =&gt; {<br/>    urls.forEach((url) =&gt; {<br/>      cy.visit(url);<br/>    });<br/>  });</span></pre><h2 id="a227" class="kw kx iq bd ky kz la dn lb lc ld dp le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">快速检查</h2><p id="a08b" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">使用cy.visit检查站点地图的缺页可能要花很长时间！如果我们想更快地检查呈现的页面，我们只需在请求页面时检查服务器的响应。如果服务器发回200响应，我们继续下一页！</p><pre class="kg kh ki kj gt ni nj nk nl aw nm bi"><span id="8459" class="kw kx iq nj b gy nn no l np nq">it("should succesfully load each url in the sitemap", () =&gt; {<br/>    urls.forEach((url) =&gt; {<br/>      cy.request({<br/>        url: url,<br/>        headers: {<br/>          "Content-Type": "text/html",<br/>          accept: "*/*",<br/>          "user-agent":<br/>            "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.131 Safari/537.36",<br/>        },<br/>      }).then((resp) =&gt; {<br/>        expect(resp.status).to.eq(200);<br/>      });<br/>    });<br/>  });</span></pre></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="c9ad" class="mx kx iq bd ky my mz na lb nb nc nd le jw ne jx li jz nf ka lm kc ng kd lq nh bi translated">结论</h1><p id="6a21" class="pw-post-body-paragraph ls lt iq lu b lv lw jr lx ly lz ju ma lf mb mc md lj me mf mg ln mh mi mj mk ij bi translated">构建E2E测试没有对错之分。您应该关心的唯一事情是构建一个适当的测试来自动化您的手动操作。</p><p id="172a" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">有了这个教程，我们再也不需要检查站点地图了，因为我们将有一个测试来自动检查每次Cypress运行中的所有页面！</p><p id="e763" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated">更少的时间做手工测试，更多的时间享受构建其他东西的乐趣！<br/>请在评论中告诉我们你希望看到哪种考试！</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><h1 id="b280" class="mx kx iq bd ky my mz na lb nb nc nd le jw ne jx li jz nf ka lm kc ng kd lq nh bi translated">资源</h1><ul class=""><li id="b5eb" class="nr ns iq lu b lv lw ly lz lf of lj og ln oh mk nw nx ny nz bi translated">Sitemap慢速校验码:<a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/blob/main/examples/sitemap/cypress/integration/sitemap-slow.ts" rel="noopener ugc nofollow" target="_blank"> sitemap-slow.ts </a></li><li id="58a7" class="nr ns iq lu b lv oa ly ob lf oc lj od ln oe mk nw nx ny nz bi translated">Sitemap快速检查代码:<a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/blob/main/examples/sitemap/cypress/integration/sitemap-fast.ts" rel="noopener ugc nofollow" target="_blank"> sitemap-fast.ts </a></li><li id="1802" class="nr ns iq lu b lv oa ly ob lf oc lj od ln oe mk nw nx ny nz bi translated">柏树示例目录:<a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything#examples" rel="noopener ugc nofollow" target="_blank">柏树万能#示例</a></li><li id="e693" class="nr ns iq lu b lv oa ly ob lf oc lj od ln oe mk nw nx ny nz bi translated">站点地图示例:<a class="ae kv" href="https://github.com/riccardogiorato/cypress-for-everything/tree/main/examples/sitemap" rel="noopener ugc nofollow" target="_blank">柏树代表一切/树/主/示例/站点地图</a></li></ul><p id="5d10" class="pw-post-body-paragraph ls lt iq lu b lv ml jr lx ly mm ju ma lf mn mc md lj mo mf mg ln mp mi mj mk ij bi translated"><em class="oi">更多内容请看</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="lu ir"><em class="oi">plain English . io</em></strong></a></p></div></div>    
</body>
</html>