<html>
<head>
<title>Simplify Error Handling in Express Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化Express应用程序中的错误处理</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/simplifying-error-handling-in-express-apps-82e052bd9c31?source=collection_archive---------5-----------------------#2021-09-04">https://javascript.plainenglish.io/simplifying-error-handling-in-express-apps-82e052bd9c31?source=collection_archive---------5-----------------------#2021-09-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/284b3e9bbcaeb56803167edc4bb0aafb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bifJDYC9NVrdZFLUB4qmjQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by Alex Chambers <a class="ae jz" href="https://unsplash.com/@alexchambers" rel="noopener ugc nofollow" target="_blank">@alexchambers</a> on <a class="ae jz" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="45ec" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你好世界！本文讨论了Express中的错误处理。你知道错误的障碍，以及它们如何化解我们想要实现的目标。但幸运的是，我将用最简单的术语解释如何在运行路线处理器和中间件时处理express应用程序中的潜在错误。那么，让我们开始吧。</p><p id="0247" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">错误处理到底是什么，我们为什么要关心它？嗯，我们应该注意可能的错误，因为我们想优雅地终止我们的程序，而不是在用户面前出现一个T2的红色大错误。如果事情没有按照我们预期的方式发生，我们希望有一个<em class="ky">计划</em> <em class="ky"> B、</em>。出错是我们的程序中最常见的事情，因为相信我，最终使用你的程序的用户会找到1000+1种方法使它崩溃(不是故意的，但你知道)。因此，作为优秀的程序员，我们应该在部署代码之前预先考虑并处理它们。</p><p id="09cd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">通过错误处理，express捕获<em class="ky">同步</em>和<em class="ky">异步</em>错误，并通过在每种情况下执行我们告诉它的操作来优雅地终止我们的程序。</p><p id="9a13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Luckily Express附带了一个<em class="ky">默认错误处理程序</em>，所以您可以马上开始！</p><h1 id="8cc0" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">快速默认错误处理程序。</h1><p id="e25d" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">考虑以下情况:</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mc"><img src="../Images/d33e2bd1f84e7e584c6f9b41908b51f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KStBGf8kDSCFISpKGzu2g.jpeg"/></div></div></figure><p id="d724" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在上面的例子中，我定义了一个愚蠢的<em class="ky"> '/cat' </em>路由，但是一旦用户转到<a class="ae jz" href="http://localhost:3000/cat" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/cat</a>，用户将面临一个错误，因为“cat”未定义，而我<em class="ky">没有处理这个错误。由于错误未被捕获，express将在<em class="ky">内置错误处理程序</em>的帮助下处理它，并将发送错误对象作为响应。</em></p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mh"><img src="../Images/248acd9363657e7d1e0d8ab26a964a2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYCi8WdmpUU3Ysh4kTNyxg.jpeg"/></div></div></figure><h1 id="12fb" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">Express中的自定义错误处理程序。</h1><p id="42bf" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">我们<em class="ky">不希望</em>向用户显示令人讨厌的堆栈跟踪，对吗？我们通常会提供一个404页面或一些像样的页面，将隐藏一个错误发生的事实。那么我们应该如何着手呢？嗯，我们可以定义自己的错误处理程序，以我们想要的方式处理错误。</p><p id="5cf4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个<em class="ky">定制错误处理中间件</em>看起来像任何其他典型的中间件，除了我们必须传入4个参数<em class="ky">而不是3个参数的</em>。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/d4d36e00bc1528210f7c2d3ca958d621.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUf5qSoyUDb9gozfI3kemQ.jpeg"/></div></div></figure><p id="b703" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我已经对传入的错误对象进行了分解，提取出了T2的错误消息和T4的错误状态，我还为它们提供了默认值，以防它们没有值。然后，作为响应，发送状态为的消息。这是一个自定义错误处理程序的简单示例。注意回调中额外的'<em class="ky"> err </em>'参数。当错误从我们代码的任何地方抛出时，它捕捉传递的错误对象，我们可以用任何我们想要的方式来处理错误。</p><p id="2a36" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此外，值得一提的是，您应该在所有其他的<em class="ky"> app.use() </em>之后，在<em class="ky">末端定义自定义错误处理程序，因为在Express中您放置它们的顺序非常重要。</em></p><p id="eaf2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在已经定义了一个错误处理程序，如果我们再次点击<em class="ky"> '/cat' </em> route，下面是我们将得到的结果。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/427b012bd04adae52c001b284e80f3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJmsrn7aJe9v08oxTB1gnw.jpeg"/></div></div></figure><p id="6b47" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如你所见，我们已经成功处理了覆盖默认行为的错误<em class="ky">。当然，除了发送错误信息之外，你还可以做更多的事情。但是你说的没错。</em></p><p id="3b57" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您想在处理完错误后点击默认的错误处理程序，您需要做的就是将error对象传递给next()，它将跳过链中所有剩余的处理程序并调用默认的处理程序。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mk"><img src="../Images/97e7dd972daa8b90b161fd01061bc00d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S9J08K7Y-hlcy-lz823v3Q.jpeg"/></div></div></figure><h1 id="fb31" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">定义我们自己的错误类。</h1><p id="c82f" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">我们也可以定义自己的错误类。考虑下面的例子。</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ml"><img src="../Images/03caf5ea85281aa6e4ecc09c65159b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gqak745HZnlC0fhWZm5ntA.jpeg"/></div></div></figure><p id="5dcd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以这样做，</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/ce8a4b5641f408b8c888412f619153c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wIHaxzpOP-m5iuikQGRHGQ.jpeg"/></div></div></figure><p id="ad9d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这是一个简单的RESTful路径，使用产品的'<em class="ky"> id </em>'来获取产品细节，并显示在编辑表单中。如果你不太明白这段代码在做什么，不要担心。我想到这个是因为前面的例子太蹩脚了。底线是，如果没有找到id为<em class="ky"> id为</em>的产品，您可以使用上面的类来抛出错误。你可以像我一样传递一个定制的信息，并附上你想要的状态码，在这种情况下<em class="ky"> 404 </em>是非常明智的。</p><p id="ed89" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，这个错误将被我们定义的错误处理程序捕获，并将发送error . message((<em class="ky">No Product Found</em>’)和error.status( <em class="ky"> 404 </em>)作为响应。</p><p id="66ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们看另一个例子:</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/97d6edcc17caeccabdf14ec5b8d62a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1O2bT3vZuAXOgk-Zdkk9uw.jpeg"/></div></div></figure><p id="56c6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里我们有一个基本上无用的路由'<em class="ky"> /admin </em>'，它会拒绝任何带有消息的访问。但它很好地说明了这一点。如果向<a class="ae jz" href="http://localhost:3000/admin" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/admin</a>发出GET请求，它将向错误处理程序传递一个带有消息和403禁止状态的错误对象。并且错误处理程序将从那里接收作业以发送适当的响应，在这种情况下，</p><figure class="md me mf mg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mj"><img src="../Images/6fc9e47f43ddb9c9a70c516cb16be855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Xtc0bJB-U4wnDvk3qFFEg.jpeg"/></div></div></figure></div><div class="ab cl mo mp hr mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ig ih ii ij ik"><p id="bfa2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我知道这有点拗口，但正如人们所说，熟能生巧。所以尝试用Express将错误处理添加到基本的CRUD应用程序中，我相信它最终会变得很有意义。编码快乐！</p><p id="7e87" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ky">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="ky">plain English . io</em></strong></a></p></div></div>    
</body>
</html>