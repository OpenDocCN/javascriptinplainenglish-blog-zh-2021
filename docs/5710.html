<html>
<head>
<title>A Practical Use for Bitmasks in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中位掩码的实际应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/a-practical-use-for-bitmasks-in-javascript-a96a24d743ad?source=collection_archive---------3-----------------------#2021-12-02">https://javascript.plainenglish.io/a-practical-use-for-bitmasks-in-javascript-a96a24d743ad?source=collection_archive---------3-----------------------#2021-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/0406f2d551aac87ca42fc07c3c6f113a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QRMPny9g9mP9ADSvaYzung.jpeg"/></div></div></figure><p id="e2db" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">位掩码非常适合将多个真/假标志组合成一个值。</p><p id="2273" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">在计算机科学中，掩码或位掩码是用于按位操作的数据，尤其是在位字段中。使用掩码，一个字节中的多个位可以在一次按位操作中设置为开、关或从开反转为关。</em></p><p id="f543" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在本文中，我将重点介绍如何使用位掩码来减少数据库中条目的大小。</p><p id="f895" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">使用<a class="ae kx" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators#binary_bitwise_operators" rel="noopener ugc nofollow" target="_blank">位操作符</a>来管理位掩码，这种操作符很少见，可能会让经验不足的开发人员感到困惑。ESLint甚至有一个<a class="ae kx" href="https://eslint.org/docs/rules/no-bitwise" rel="noopener ugc nofollow" target="_blank">默认设置</a>来阻止你使用它们。使用的基本原理是位运算符看起来更像是错别字而不是实际特征。</p><p id="f633" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是，如果使用正确，它们会对数据库的大小、速度和可伸缩性产生巨大的影响，从长远来看，这可以为您节省大量资金。</p><p id="d849" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我将展示一种使用位掩码来存储和管理用户状态的常用方法。</p><p id="1b0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">型号</strong></p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="763f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">状态中的每个值(除了0)都是2的递增幂。2的幂非常重要，因为每个值都代表二进制数中的一位。</p><p id="7367" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以将状态值水平放置，最高值放在开始处，这样就可以直观地看到这一点。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="c699" class="lj lk iq lf b gy ll lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   0        |        0         |      0         |   0   |   0    </span></pre><p id="8a65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">随着用户状态的改变，打开或关闭每个相应的位，并存储整数值。</p><p id="4497" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">示例:仅启用双因素身份认证的活跃用户</strong></p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="222c" class="lj lk iq lf b gy ll lm l ln lo">Bianry Visual Layout</span><span id="3d9b" class="lj lk iq lf b gy lp lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   1        |        0         |      0         |   0   |   1</span><span id="5d12" class="lj lk iq lf b gy lp lm l ln lo">Users Table</span><span id="ee73" class="lj lk iq lf b gy lp lm l ln lo">id               status   <br/>----------------|-----------</span><span id="1e18" class="lj lk iq lf b gy lp lm l ln lo">1                17 -&gt; 10001</span></pre><p id="1d36" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在数据库中将状态存储为整数，但在应用程序中将其视为二进制数。</p><p id="f3b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个位掩码中最多可以存储32个真/假标志。如果需要添加另一个状态值，只需将其添加到枚举的末尾。您不必在数据库中添加另一列。</p><p id="7cde" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">接下来，我将通过一些例子来说明如何管理位掩码值。</p><p id="e56f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">创建用户</strong></p><p id="28ef" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首次创建用户时，只需设置活动状态。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="f38f" class="lj lk iq lf b gy ll lm l ln lo">const user: IUser = {</span><span id="9cec" class="lj lk iq lf b gy lp lm l ln lo">  status: Status.ACTIVE</span><span id="ed63" class="lj lk iq lf b gy lp lm l ln lo">  ...other user stuff<br/>}</span><span id="caa6" class="lj lk iq lf b gy lp lm l ln lo">db.set(user)</span></pre><p id="88c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">存储值</strong></p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="2f67" class="lj lk iq lf b gy ll lm l ln lo">Bianry Visual Layout</span><span id="21d8" class="lj lk iq lf b gy lp lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   0        |        0         |      0         |   0   |   1</span><span id="da02" class="lj lk iq lf b gy lp lm l ln lo">Users Table</span><span id="71a7" class="lj lk iq lf b gy lp lm l ln lo">id               status   <br/>----------------|-----------</span><span id="72ae" class="lj lk iq lf b gy lp lm l ln lo">1                1 -&gt; 00001</span></pre><p id="c356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">打开支付标志</strong></p><p id="145d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户已经提供了他们的支付信息。要将一个位翻转到其开状态，使用<code class="fe lq lr ls lf b">|=</code>操作符。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="02df" class="lj lk iq lf b gy ll lm l ln lo">db.update({ status: (user.status |= Status.PAYMENT_VERIFIED) })</span></pre><p id="d009" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">存储值</strong></p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="cf8a" class="lj lk iq lf b gy ll lm l ln lo">Bianry Visual Layout</span><span id="0c33" class="lj lk iq lf b gy lp lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   0        |        1         |      0         |   0   |   1</span><span id="ff14" class="lj lk iq lf b gy lp lm l ln lo">Users Table</span><span id="2e17" class="lj lk iq lf b gy lp lm l ln lo">id               status   <br/>----------------|-----------</span><span id="3781" class="lj lk iq lf b gy lp lm l ln lo">1                9 -&gt; 01001</span></pre><p id="e35e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">打开电子邮件验证标志</strong></p><p id="fb7d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户已经验证了他们的电子邮件。使用与之前相同的<code class="fe lq lr ls lf b">|=</code>操作符，只是改变状态值。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="c07e" class="lj lk iq lf b gy ll lm l ln lo">db.update({ status: (user.status |= Status.EMAIL_VERIFIED) })</span></pre><p id="8ec4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">存储值</strong></p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="0920" class="lj lk iq lf b gy ll lm l ln lo">Bianry Visual Layout</span><span id="e05d" class="lj lk iq lf b gy lp lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   0        |        1         |      1         |   0   |   1</span><span id="b37b" class="lj lk iq lf b gy lp lm l ln lo">Users Table</span><span id="4ce6" class="lj lk iq lf b gy lp lm l ln lo">id               status   <br/>----------------|-----------</span><span id="7e1c" class="lj lk iq lf b gy lp lm l ln lo">1                13 -&gt; 01101</span></pre><p id="b489" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">关闭标志</strong></p><p id="1011" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户的付款方式已被删除。要翻转一点回到关闭状态，使用<code class="fe lq lr ls lf b">&amp;= ~</code>操作符。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="ca94" class="lj lk iq lf b gy ll lm l ln lo">db.update({ status: (user.status &amp;= ~Status.PAYMENT_VERIFIED) })</span></pre><p id="ff46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">存储值</strong></p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="9dfa" class="lj lk iq lf b gy ll lm l ln lo">Bianry Visual Layout</span><span id="0fa0" class="lj lk iq lf b gy lp lm l ln lo">TFA_ENABLED | PAYMENT_VERIFIED | EMAIL_VERIFIED | ADMIN | ACTIVE <br/>-----------------------------------------------------------------<br/>   0        |        0         |      1         |   0   |   1</span><span id="4499" class="lj lk iq lf b gy lp lm l ln lo">Users Table</span><span id="72ad" class="lj lk iq lf b gy lp lm l ln lo">id               status   <br/>----------------|-----------</span><span id="cd56" class="lj lk iq lf b gy lp lm l ln lo">1                5 -&gt; 00101</span></pre><p id="4610" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">切换标志开/关</strong></p><p id="36b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">或者，您可以用<code class="fe lq lr ls lf b">^=</code>操作符打开或关闭一点</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="6d5e" class="lj lk iq lf b gy ll lm l ln lo">db.update({ status: (user.status ^= Status.PAYMENT_VERIFIED) })</span></pre><p id="3f86" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">检查标志</strong></p><p id="ae4d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">用户请求了一个只付费的功能。要检查它们的状态是否设置了PAYMENT_VERIFIED标志，请使用<code class="fe lq lr ls lf b">&amp;</code>操作符。</p><pre class="ky kz la lb gt le lf lg lh aw li bi"><span id="c1f5" class="lj lk iq lf b gy ll lm l ln lo">// helper function to check any flag<br/>const isFlagSet = (actual: number, expected: number): boolean = {</span><span id="cd0e" class="lj lk iq lf b gy lp lm l ln lo">  const flag = actual &amp; expected;</span><span id="5ee2" class="lj lk iq lf b gy lp lm l ln lo">  return flag === expected;</span><span id="b641" class="lj lk iq lf b gy lp lm l ln lo">};</span><span id="f193" class="lj lk iq lf b gy lp lm l ln lo">const user = db.users.find(id)</span><span id="345c" class="lj lk iq lf b gy lp lm l ln lo">const hasPayment = isFlagSet(user.status, Status.PAYMENT_VERIFIED)</span></pre><p id="147a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这些例子能帮助那些对在自己的应用程序中使用位掩码感兴趣的人。他们可能需要一点时间来适应，但好处是显而易见的。</p><p id="b41f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="kw">更多内容看</em> <a class="ae kx" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="ka ir"> <em class="kw">说白了就是</em> </strong> </a> <strong class="ka ir"> <em class="kw">。</em> </strong> <em class="kw">报名参加我们的</em><strong class="ka ir"><em class="kw"/></strong><a class="ae kx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"><em class="kw">免费每周简讯点击这里</em> </strong> </a> <strong class="ka ir"> <em class="kw">。</em> </strong></p></div></div>    
</body>
</html>