<html>
<head>
<title>Simplifying Middleware in Express for Newbies and Pros Alike</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为新手和专业人士简化Express中的中间件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/simplifying-middleware-in-expressjs-baad2d6595f3?source=collection_archive---------8-----------------------#2021-08-29">https://javascript.plainenglish.io/simplifying-middleware-in-expressjs-baad2d6595f3?source=collection_archive---------8-----------------------#2021-08-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3fc2e769bd11475e2a2299b85803adff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0-Nqr2rIDCojCYio"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@jstrippa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">James Harrison</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="48c4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在编写Express应用程序时，最重要的是真正理解<strong class="kc io">中间件</strong>的概念，因为它们是构建Express应用程序的构件。尽管很多开发人员在Express项目中实现了这个概念，但是很多人仍然没有完全理解这个概念。</p><p id="4d4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我将尽最大努力用最简单的类比来解释中间件，以便新手和有经验的开发人员更好地理解它。</p><h1 id="ade8" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">秘书的比喻</strong></h1><figure class="lx ly lz ma gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lw"><img src="../Images/47e7ffc52e3a253d667fc083f86ca0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEoeGsOsRdu21AeZK02rGQ.png"/></div></div></figure><p id="6946" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">正如在大多数拥有标准组织文化的现代企业中所看到的那样，在最高管理层的右边是一位可靠的<strong class="kc io">秘书</strong>。</p><p id="0f02" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">向公司高层管理人员提出的任何要求都必须通过<strong class="kc io">秘书</strong>。各组织秘书的主要日常职责是<strong class="kc io">沟通</strong>和<strong class="kc io">通信</strong>。向最高管理层提出的请求通常要经过秘书，秘书分析信息并寻找最合适的方法来传递信息。</p><p id="1137" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对提交给部长的信息进行分析和审查，以发现不符合某些政策的情况。此外，秘书执行其他任务，如文件，复制信息和许多其他程序，可能会增加有关组织。因此，发送给组织的任何信息/请求很少会不经过这一流程。</p><p id="4d37" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，当高层管理人员对员工或公众作出回应时，秘书在其中发挥作用。他/她(秘书)通常以接收者能很快理解的最佳方式传递信息。</p><p id="fbac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这个场景中，我们可以看到秘书基本上充当了中间人<strong class="kc io">的角色</strong>，高层管理人员的所有请求和响应都是向其发出的。</p><p id="2d13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总之，<strong class="kc io">Express</strong>M<strong class="kc io">iddleware</strong>可以表示为<strong class="kc io">秘书，它们采用回调函数的形式，所有HTTP客户端请求和服务器响应都由回调函数完成。</strong>与类比相反，一个客户端请求中可以出现不止一个中间件。</p></div><div class="ab cl mb mc hr md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ig ih ii ij ik"><p id="a37c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">故事讲完了。</p><p id="3594" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">基本示例:</p><pre class="lx ly lz ma gt mi mj mk ml aw mm bi"><span id="2e24" class="mn kz in mj b gy mo mp l mq mr">const express = require ('express');<br/>const app = express();</span><span id="81d2" class="mn kz in mj b gy ms mp l mq mr">middle1(req, res, next) =&gt; {<br/>      console.log('You have made a request')<br/>}</span><span id="453a" class="mn kz in mj b gy ms mp l mq mr">app.get('/', middle1)</span></pre><p id="fdfc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">举例说明上面的代码，函数middle1将作为一个中间件，所有对服务器的GET请求都将通过它。因此，对于所有GET请求，<em class="mt">‘您发出了请求’</em>将被记录在控制台中。</p><p id="c479" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">另一个有用的比较是，Express中间件充当每个客户端向服务器发出的请求的功能层。</p></div><div class="ab cl mb mc hr md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ig ih ii ij ik"><h1 id="37e4" class="ky kz in bd la lb mu ld le lf mv lh li lj mw ll lm ln mx lp lq lr my lt lu lv bi translated"><strong class="ak">定义。</strong></h1><p id="7798" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">因此，最可靠的定义(来自明确的官方文件)是:</p><blockquote class="ne nf ng"><p id="675c" class="ka kb mt kc b kd ke kf kg kh ki kj kk nh km kn ko ni kq kr ks nj ku kv kw kx ig bi translated"><strong class="kc io"> <em class="in">中间件</em> </strong>函数是访问<a class="ae jz" href="https://expressjs.com/en/4x/api.html#req" rel="noopener ugc nofollow" target="_blank">请求对象</a>(<code class="fe nk nl nm mj b">req</code>)<a class="ae jz" href="https://expressjs.com/en/4x/api.html#res" rel="noopener ugc nofollow" target="_blank">响应对象</a> ( <code class="fe nk nl nm mj b">res</code>)以及应用程序请求-响应周期中的下一个中间件函数的函数。下一个中间件功能通常用一个名为<code class="fe nk nl nm mj b">next</code>的变量来表示。</p></blockquote><h1 id="91ef" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated"><strong class="ak">Express中中间件的类别</strong></h1><p id="18e6" class="pw-post-body-paragraph ka kb in kc b kd mz kf kg kh na kj kk kl nb kn ko kp nc kr ks kt nd kv kw kx ig bi translated">在处理express中间件时，需要理解3个主要类别。这些类别是:</p><ol class=""><li id="3012" class="nn no in kc b kd ke kh ki kl np kp nq kt nr kx ns nt nu nv bi translated"><strong class="kc io">应用级中间件:</strong></li></ol><p id="3f94" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它们表示通过使用app.use和app.method()绑定到app对象的中间件。</p><p id="d7c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">app.use将包含所有请求，而app.method将特定于请求类型。(获取、发布、删除和放置)。</p><p id="86d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">例如:</strong></p><pre class="lx ly lz ma gt mi mj mk ml aw mm bi"><span id="c00b" class="mn kz in mj b gy mo mp l mq mr">const express = require('express')<br/>const app = express()</span><span id="d733" class="mn kz in mj b gy ms mp l mq mr">//for all requests made<br/>app.use(function (req, res, next) {<br/>  console.log('I am an application level middleware')<br/>  next()<br/>})</span></pre><p id="367f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io"> 2。路由器级中间件:</strong></p><p id="d21a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">与应用级中间件相同，但主要区别在于它被绑定到Express路由器的一个实例。</p><p id="053b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">例如:</strong></p><pre class="lx ly lz ma gt mi mj mk ml aw mm bi"><span id="58f5" class="mn kz in mj b gy mo mp l mq mr">const express = require('express')<br/>const app = express()<br/>const router = express.Router()</span><span id="28c5" class="mn kz in mj b gy ms mp l mq mr">// this example is respective only to get requests<br/>router.get('/user/:id',(function (req, res, next) {<br/>  console.log('Time:', Date.now())<br/>  next()<br/>})</span></pre><p id="e388" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">3 <strong class="kc io">。错误处理中间件</strong></p><p id="d528" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">与其他中间件功能的工作方式相同，只是它有4个参数。</p><p id="cbde" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">例如:</strong></p><pre class="lx ly lz ma gt mi mj mk ml aw mm bi"><span id="a599" class="mn kz in mj b gy mo mp l mq mr">app.use(function (err, req, res, next) {<br/>  console.error(err.stack)<br/>  res.status(500).send('Something broke!')<br/>})</span></pre></div><div class="ab cl mb mc hr md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ig ih ii ij ik"><p id="4891" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好了，希望这有助于更好地简要解释<strong class="kc io"> Express </strong>中间件<strong class="kc io">的概念。关于Express中中间件的更深入的解释，我建议您阅读官方文档:</strong></p><div class="nw nx gp gr ny nz"><a href="https://expressjs.com/en/guide/using-middleware.html" rel="noopener  ugc nofollow" target="_blank"><div class="oa ab fo"><div class="ob ab oc cl cj od"><h2 class="bd io gy z fp oe fr fs of fu fw im bi translated">使用中间件</h2><div class="og l"><h3 class="bd b gy z fp oe fr fs of fu fw dk translated">Express是一个路由和中间件web框架，它有自己的最小功能:Express应用程序是…</h3></div><div class="oh l"><p class="bd b dl z fp oe fr fs of fu fw dk translated">expressjs.com</p></div></div><div class="oi l"><div class="oj l ok ol om oi on jt nz"/></div></div></a></div><p id="508d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读。</p><p id="4d56" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mt">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mt">plain English . io</em></strong></a></p></div></div>    
</body>
</html>