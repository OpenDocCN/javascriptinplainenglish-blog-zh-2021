<html>
<head>
<title>How to Mock a Single Function from a Module with Jest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Jest模拟模块中的单个函数</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-mock-a-single-function-from-a-module-with-jest-8f9994bf9410?source=collection_archive---------3-----------------------#2021-08-16">https://javascript.plainenglish.io/how-to-mock-a-single-function-from-a-module-with-jest-8f9994bf9410?source=collection_archive---------3-----------------------#2021-08-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="4427" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">用Jest嘲笑整个模块很容易。但是，如果您只想模仿模块中的一些功能，该怎么办呢？</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/13aa8bd539062173b7f543dca2a3e7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k3WoA1DWcjHvRi4e"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@thoughtcatalog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thought Catalog</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7c8e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Jest是一个很好的JavaScript(或TypeScript)测试框架。它提供了许多功能和大量关于如何使用它们的指南(有例子)。</p><p id="6806" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">想要创建一个模拟函数并将其作为回调传递给正在测试的组件吗？当然可以！如果愿意，您甚至可以给它一个定制的模拟实现。</p><p id="bbbc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">需要模拟整个模块或库吗？这只需要一行代码。您还可以为这些应用程序提供定制的模拟实现。您甚至可以为一个对象的特定方法创建模拟。</p><p id="32ce" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，当指南中有50个不同的例子似乎涵盖了天底下除了您正在寻找的用例之外的所有内容时，您知道那种感觉吗？好吧，这可能有点戏剧性的解释，但你得到了要点。</p><p id="2f2f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果您不想模拟整个模块或库，该怎么办？如果你只想模仿它的一个功能呢？还是几个精选的？</p><p id="178a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我花了相当长的时间来整理正确的谷歌查询。因此，这里有一个简短的指南，以防你最终陷入同样的困境。(是的，一旦我知道要找什么，我也设法在官方文档中找到了一个例子。)</p><h1 id="466b" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">模仿单一功能</h1><p id="f279" class="pw-post-body-paragraph kt ku in kv b kw mi jo ky kz mj jr lb lc mk le lf lg ml li lj lk mm lm ln lo ig bi translated">有三个简单(也有点混乱)的步骤，只模仿一个模块的一个函数，将其余的函数保留为默认实现。</p><ol class=""><li id="4bc6" class="mn mo in kv b kw kx kz la lc mp lg mq lk mr lo ms mt mu mv bi translated">为整个模块创建一个模拟。</li><li id="a718" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">告诉模仿者对所有事情都使用实际(非模仿的)实现。</li><li id="05ac" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo ms mt mu mv bi translated">模仿模仿者想要的功能。</li></ol><p id="ae52" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有点绕口令，不是吗？但是语法非常简单，每个步骤只需要一行代码。</p><p id="6307" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，使用<code class="fe nb nc nd ne b">jest.mock</code>函数创建一个模块的模拟。与<code class="fe nb nc nd ne b">import</code>语句一样，<code class="fe nb nc nd ne b">mock</code>函数接受一个字符串，该字符串表示本地模块的路径或您想要模仿的库的名称。在示例中，我将把它称为<code class="fe nb nc nd ne b">path</code>。</p><p id="f4a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，使用<code class="fe nb nc nd ne b">jest.requireActual</code>函数告诉mock使用模块中所有东西的真实实现。您应该传入在<code class="fe nb nc nd ne b">mock</code>函数中传递的表示路径或名称的相同字符串。</p><p id="7648" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在您传递实际实现的需求之后，您可以覆盖您想要模仿的函数的实现。您只需列出函数名，并给它赋值<code class="fe nb nc nd ne b">jest.fn()</code>。</p><p id="9855" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nb nc nd ne b">jest.fn()</code>将创建一个空的实现，但是您可以覆盖它以获取参数并拥有一个自定义的返回值。</p><p id="055f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下面是您需要在测试中编写的三行代码，以使它正常工作。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="bb1f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在Jest的新版本中，您可能需要将<code class="fe nb nc nd ne b">jest.requireActual</code>的结果存储在一个变量中，然后使用spread运算符，如下所示。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="0dd7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这就是全部了。感谢您的阅读！</p><h1 id="5f54" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">资源</h1><ul class=""><li id="de92" class="mn mo in kv b kw mi kz mj lc nh lg ni lk nj lo nk mt mu mv bi translated">来帮忙的StackOverflow问题(我终于找到了):<a class="ae ks" href="https://stackoverflow.com/questions/59312671/mock-only-one-function-from-module-but-leave-rest-with-original-functionality" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/59312671/mock-only-one-function-from-module-but-leave-rest-with-original-functionality</a></li><li id="9da1" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo nk mt mu mv bi translated">笑话文档:【https://jestjs.io/ T4】</li><li id="3e65" class="mn mo in kv b kw mw kz mx lc my lg mz lk na lo nk mt mu mv bi translated">包含此示例的<code class="fe nb nc nd ne b">requireActual</code>的Jest文档:<a class="ae ks" href="https://jestjs.io/docs/jest-object#jestrequireactualmodulename" rel="noopener ugc nofollow" target="_blank">https://jest js . io/docs/jest-object # jestrequirectalmodulename</a></li></ul><p id="83d8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp">更多内容请看</em><a class="ae ks" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="kv io"><em class="lp">plain English . io</em></strong></a></p></div></div>    
</body>
</html>