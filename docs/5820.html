<html>
<head>
<title>How to Create Global Variables in TypeScript with Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Node.js在TypeScript中创建全局变量</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-create-global-variables-in-typescript-with-node-js-9ca24f648991?source=collection_archive---------2-----------------------#2021-12-12">https://javascript.plainenglish.io/how-to-create-global-variables-in-typescript-with-node-js-9ca24f648991?source=collection_archive---------2-----------------------#2021-12-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/893246106f44ac09ff4f4cece6c44876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hy4Je0qslH_8SauYd5lzmw.jpeg"/></div></div></figure><p id="3866" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此时，你可能知道Node.js版本16已经移除了<code class="fe kt ku kv kw b">NodeJS.Global</code>而支持<code class="fe kt ku kv kw b">globalThis</code>，正因为如此，现在创建全局变量可能有点棘手(查看这个<a class="ae kx" href="https://github.com/DefinitelyTyped/DefinitelyTyped/pull/53669" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多信息)。</p><h2 id="1c1e" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">我们是如何在Node.js 14 ≤中创建全局变量的？</h2><p id="4ce6" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">嗯，这很简单，我们只需要从<code class="fe kt ku kv kw b">NodeJS.Global</code>出发<code class="fe kt ku kv kw b">extend</code>。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="fb26" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后我们必须声明一个全局变量，就像魔术一样，我们的全局变量在任何地方都是可用的。</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h2 id="0726" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">我们如何在Node.js 16 ≥中创建全局变量？</h2><p id="2939" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">现在，我们只需要在全局命名空间中声明类型、接口或变量，为了实现这一点，我们必须创建一个<code class="fe kt ku kv kw b">.d.ts</code>文件，请看这个例子:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="9dce" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这里我们声明了一个全局变量、接口和类型，这样，它们在我们的项目中随处可见。而且是的，很遗憾，我们必须使用<code class="fe kt ku kv kw b">var</code>，否则，它将无法工作。到目前为止，一切都很好，现在如果我们想让TypeScript识别我们的全局变量、接口和类型，我们必须创建一个<code class="fe kt ku kv kw b">@types</code>文件夹，并将我们的<code class="fe kt ku kv kw b">.d.ts</code>文件放在那里。</p><p id="abdb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是，这种方法主要用于声明全局变量，如果只需要声明全局接口或类型，甚至还有更简单的方法。让我们假设你想定义一个自定义DTO作为一个接口，因为DTO可以用在很多地方，你可能会发现将其声明为一个全局接口或类型很有用。你怎么能这样？嗯，你只需要在你的<code class="fe kt ku kv kw b">@types</code>文件夹中创建一个<code class="fe kt ku kv kw b">d.ts</code>文件，让我们想象你的d to代表一个用户如下:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="003e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以你只需要在你的<code class="fe kt ku kv kw b">@types</code>文件夹中创建一个文件，比如说<code class="fe kt ku kv kw b">user.d.ts</code>，就可以了。现在，您的DTO是全球可用的，但是您甚至可以通过创建一个<code class="fe kt ku kv kw b">dto</code>文件夹并将您所有的dto放在那里来改进这种方法，然后，如果您需要它，您可以为您的类型或接口创建一个新文件夹。</p><h2 id="3b0a" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">注意</h2><p id="ab27" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果不需要从外部包导入类型，这种更简单的方法非常有用。如果您想从外部包中导入一个类型，您可能会遇到一些问题。例如:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="9299" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因为我正在导入一个特定类型的<code class="fe kt ku kv kw b">mqtt</code>包，我的全局类型<code class="fe kt ku kv kw b">Route</code>将不会被检测到。这个问题有两个解决方案。第一个是把<code class="fe kt ku kv kw b">Route</code>接口放在<code class="fe kt ku kv kw b">global</code>里面，如下所示:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="bd66" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不使用全局变量也可以使用另一种方法:</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="ma mb l"/></div></figure><h2 id="52fc" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">初始化变量呢？</h2><p id="5763" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">正如我上面几行所说，你可以声明全局变量，不幸的是你不能初始化它们，为什么？因为那些是类型定义文件，<code class="fe kt ku kv kw b">.d.ts</code>文件。这意味着，你只能在那里定义事物。</p><p id="a4d3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，我发现了一个你可能会觉得有用的方法，假设你想在某个文件中使用<code class="fe kt ku kv kw b">globalString</code>。首先，你必须初始化你的全局变量，我建议你在你的应用程序的入口点做(只是为了有条理)，它看起来会像这样:</p><pre class="lw lx ly lz gt mc kw md me aw mf bi"><span id="0ed2" class="ky kz in kw b gy mg mh l mi mj">// entryPoint.ts<br/>global.globalString = 'Hi mom, I am global'</span></pre><p id="2977" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，您可以使用<code class="fe kt ku kv kw b">globalString</code>(不带全局)来访问您的全局变量，例如:</p><pre class="lw lx ly lz gt mc kw md me aw mf bi"><span id="b64d" class="ky kz in kw b gy mg mh l mi mj">// some/other/ts/file.ts<br/>console.log({ globalString })</span></pre><h2 id="2875" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">自定义类型文件夹</h2><p id="4d22" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">如果我们想要一个自定义位置，我们必须将它添加到我们的<code class="fe kt ku kv kw b">tsconfig.json</code>中的<code class="fe kt ku kv kw b">typeRoots</code>数组中。类似于:</p><pre class="lw lx ly lz gt mc kw md me aw mf bi"><span id="14e5" class="ky kz in kw b gy mg mh l mi mj">{<br/>  ...<br/>  "compilerOptions": {<br/>    ...<br/>    "typeRoots": ["path/to/our/global/variables.d.ts"],<br/>    ...<br/>  }<br/>}</span></pre><p id="0e1b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您使用<code class="fe kt ku kv kw b">ts-node</code>来运行您的项目，您必须在您的<code class="fe kt ku kv kw b">tsconfig.json</code>文件中添加文件选项，或者遵循本<a class="ae kx" href="https://github.com/TypeStrong/ts-node#missing-types" rel="noopener ugc nofollow" target="_blank">指南</a>。就个人而言，我更喜欢第一种选择，因为它更简单:</p><pre class="lw lx ly lz gt mc kw md me aw mf bi"><span id="f3bc" class="ky kz in kw b gy mg mh l mi mj">{<br/>  ...<br/>  "ts-node": {<br/>    "files": true<br/>  },<br/>  ...<br/>}</span></pre><p id="3f55" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">就是这样，你的全局变量、接口、类型随处可用！</p><h2 id="848b" class="ky kz in bd la lb lc dn ld le lf dp lg kg lh li lj kk lk ll lm ko ln lo lp lq bi translated">警告！</h2><p id="cb0b" class="pw-post-body-paragraph jv jw in jx b jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks ig bi translated">在这一点上，你被赋予了巨大的权力。还有…</p><blockquote class="mk ml mm"><p id="32ff" class="jv jw mn jx b jy jz ka kb kc kd ke kf mo kh ki kj mp kl km kn mq kp kq kr ks ig bi translated">权力越大，责任越大。<br/>——本大叔。</p></blockquote><p id="db7f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">你必须尽可能避免使用全局变量</strong>，因为它会把你逼到<a class="ae kx" href="https://en.wikipedia.org/wiki/Spaghetti_code" rel="noopener ugc nofollow" target="_blank">意大利面条代码</a>。记住，它们是<strong class="jx io">变量</strong>，它们可以<strong class="jx io">改变</strong>，所以要非常小心。如果不需要用，就不要用。你可能会发现这个问题很有用。</p><p id="881e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，有空的话，看看我的npm CLI工具，<a class="ae kx" href="https://www.npmjs.com/package/@anthonylzq/simba.js" rel="noopener ugc nofollow" target="_blank"> simba.js </a>。它有点像<a class="ae kx" href="https://create-react-app.dev/" rel="noopener ugc nofollow" target="_blank"> cra </a>，但用于后端开发。它使用MongoDB、Express和TypeScript。只需一个简单的命令，您就可以让服务器运行一些您可能会觉得有用的端点。</p><p id="b31f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">编码快乐！</p><p id="6062" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mn">更多内容看</em> <a class="ae kx" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mn">说白了就是</em> </strong> </a> <strong class="jx io"> <em class="mn">。</em> </strong> <em class="mn">报名参加我们的</em> <a class="ae kx" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> <em class="mn">免费每周简讯点击这里</em> </strong> </a> <strong class="jx io"> <em class="mn">。</em> </strong></p></div></div>    
</body>
</html>