<html>
<head>
<title>Use Python or JavaScript to Send Your Events and Logs to Telegram via their Chatbot API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python或JavaScript通过它们的Chatbot API将您的事件和日志发送到Telegram</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/use-python-or-javascript-to-send-your-events-and-logs-to-telegram-via-their-chatbot-api-57f407f2c7e3?source=collection_archive---------6-----------------------#2021-11-09">https://javascript.plainenglish.io/use-python-or-javascript-to-send-your-events-and-logs-to-telegram-via-their-chatbot-api-57f407f2c7e3?source=collection_archive---------6-----------------------#2021-11-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/c48cab0f10733960076f0a0d90827bc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzioGdLTCW0jOEDn28kMMQ.png"/></div></div></figure><p id="370b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在我看来，Telegram拥有最好的聊天机器人API。他们所创造的东西非常容易使用，但却有着难以置信的强大功能。多年来，我已经用它做了几十个小项目。他们API的一个突出用例是从我的应用程序和项目中给我自己发送事件和日志。</p><p id="195d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">考虑这个例子；你正在开发一个新项目，你可能需要抓取成百上千的网页或任何其他类似的长期运行的任务。您可以将这个脚本部署到一个VM，或者您的机器上，让它运行一两天。但是，你通常如何检查进度？您是否通过ssh连接到虚拟机，找到正确的tmux会话，并读取日志？如果你想离开家，没有电脑怎么办？嗯，这是那些让我思考的情况之一…“嗯，如果我可以使用电报作为远程输出呢？”我的意思是，API非常非常容易使用，我所需要做的就是向他们的端点发出HTTP请求，为什么不呢？</p><p id="58bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这只是我发现将事件推给自己很方便的几十个例子之一，从那以后，我在许多不同的项目中使用它来更新自己的用户行为、产品销售甚至股票价格。所以在这篇博文中，我将讲述如何设置你的第一个聊天机器人，以及如何通过Python或JavaScript向你自己发送事件:)</p><h2 id="0ca2" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">注册一个电报聊天机器人。</h2><p id="ad3a" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">好的，第一步是在Telegram上给<a class="ae lr" href="https://t.me/botfather" rel="noopener ugc nofollow" target="_blank"> @botfather </a>发消息，创建你的第一个聊天机器人！这个过程非常简单，你可以在下面的截图中看到。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/aff360ed5513dbd69ca4b9d4ea7b3c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1l9X4IioSxQuTSwkiuec0A.png"/></div></div></figure><p id="8b46" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们复制API令牌并将其添加到我们的环境变量中。当然，您可以跳过这个过程，直接将其添加到您的代码中。此外，确保这个令牌是私有的！写完这篇文章后，我将撤销我的。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="6da7" class="kt ku in lx b gy mb mc l md me">export BOT_TOKEN=2104030722:AAGdY_FeAFqvriecqv3lhissc-uG4t0arL4</span></pre><h2 id="8ce9" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">查找您的电报聊天Id</h2><p id="19b9" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">好了，在动手编写代码之前，我们还有一步要做。谢天谢地，这个很简单，我们必须在Telegram中找到我们的<strong class="jx io"> chat_id </strong>，有多种方法可以找到它。我将使用聊天机器人API来找出我的<strong class="jx io">聊天id </strong>。</p><p id="dac0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以，打开我们刚刚创建的聊天机器人，给它发送消息；什么都有可能。然后，使用您的浏览器或邮递员，用您的API令牌向以下URL发出get请求，它应该会告诉您您的<strong class="jx io"> chat_id </strong>。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="bf65" class="kt ku in lx b gy mb mc l md me">// template<br/><a class="ae lr" href="https://api.telegram.org/bot" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot</a>&lt;BOT_TOKEN&gt;/getUpdates</span><span id="d35f" class="kt ku in lx b gy mf mc l md me">// how mine looks like with my bot token<br/><a class="ae lr" href="https://api.telegram.org/bot2104030722:AAGdY_FeAFqvriecqv3lhissc-uG4t0arL4/getUpdates" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot2104030722:AAGdY_FeAFqvriecqv3lhissc-uG4t0arL4/getUpdates</a></span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mg"><img src="../Images/59daf13ae24e6380186cf736defcfd66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qPnpzDX_DGK3nmL-H-LOpQ.png"/></div></div></figure><p id="fb1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">正如你在截图中看到的，你可以通过下面的路径<strong class="jx io">result[]message . chat . id</strong>看到你的<strong class="jx io"> chat_id </strong>。复制并再次将其添加到您的环境变量中，或者直接粘贴到代码中。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="0c92" class="kt ku in lx b gy mb mc l md me">export CHAT_ID=&lt;MY_CHAT_ID&gt;</span></pre><p id="adbb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">好了，这就是我们对Telegram所做的全部工作。让我们写一些代码。在这篇文章中，我将提供一个Python和JavaScript的例子，所以可以随意跳到你喜欢的那一个。</p><h2 id="e0c6" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">通过Python发布事件</h2><p id="a497" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">首先，让我们访问我们的环境变量并将它们赋给变量</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="6ea6" class="kt ku in lx b gy mb mc l md me">import os</span><span id="b8cc" class="kt ku in lx b gy mf mc l md me">BOT_TOKEN = os.environ.get('BOT_TOKEN')<br/>CHAT_ID = os.environ.get('CHAT_ID')</span></pre><p id="3b8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我将使用<a class="ae lr" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank">请求</a>包来处理我的HTTP请求。因此，让我们也通过运行下面的命令来安装PyPi。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="f1cb" class="kt ku in lx b gy mb mc l md me">pip install requests</span></pre><p id="589a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">厉害！现在让我们定义一个将事件发送到Telegram的方法。我们将称它为<strong class="jx io"> send_message </strong>，它需要接受一个消息字符串。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="eae8" class="kt ku in lx b gy mb mc l md me">def send_message(msg):</span></pre><p id="d2c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然后，我们将添加Telegram的发送消息端点，并通过我们的bot令牌填充它。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="a89c" class="kt ku in lx b gy mb mc l md me">url = f”https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"</span></pre><p id="e3f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，让我们定义需要发送到Telegram的URL参数。我们需要一个chat_id和文本，现在，我们应该都准备好了。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="44b4" class="kt ku in lx b gy mb mc l md me">params = { “chat_id”: CHAT_ID, “text”: msg }</span></pre><p id="2768" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，我们将导入请求并发出GET请求，然后传入我们的URL参数。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="af90" class="kt ku in lx b gy mb mc l md me">requests.get(url, params=params)</span></pre><p id="911b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">将这些放在一起，我们的方法应该如下所示。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="e969" class="kt ku in lx b gy mb mc l md me">import requests</span><span id="6590" class="kt ku in lx b gy mf mc l md me">def send_message(msg):<br/>   url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"<br/>   params = { "chat_id": CHAT_ID, "text": msg }<br/>   requests.get(url, params=params)</span></pre><p id="c77c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">差不多就是这样:)现在我们可以通过电报向自己发送任何事件。还记得爬虫的工作吗？假设我们想要发送定期进度。我们可以这样做:</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="297c" class="kt ku in lx b gy mb mc l md me">send_message(“🔥 Crawling progress: 56% done”)</span></pre><p id="473e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一旦我们运行我们的代码，如果一切顺利，我们应该看到这样的东西。多酷啊。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/91fd5b5f9e8d9ae598914a6b4ccc9224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gVLkkUAGCGER6JuU3QGpnQ.png"/></div></div></figure><h2 id="6e6f" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">通过JavaScript发布事件</h2><p id="1117" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">好，我们用JavaScript重复同样的过程。首先，让我们访问我们的环境变量，并将它们设置为变量。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="5a6a" class="kt ku in lx b gy mb mc l md me">const BOT_TOKEN = process.env.BOT_TOKEN<br/>const CHAT_ID = process.env.CHAT_ID</span></pre><p id="dd62" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">接下来，我将使用<a class="ae lr" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>包来处理我的HTTP请求。您可以通过运行以下命令，通过NPM安装。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="cd1f" class="kt ku in lx b gy mb mc l md me">npm i axios</span></pre><p id="306a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，让我们定义我们的sendMessage方法。它需要将我们的字符串消息作为参数。然后我们将添加端点URL，并通过我们的<strong class="jx io"> BOT_TOKEN </strong>填充它。接下来，我们来定义一下Telegram需要的我们的URL参数；<strong class="jx io"> chat_id </strong>和<strong class="jx io">文本</strong>。最后，我们可以通过Axios发出get请求，并传入我们的参数。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="079e" class="kt ku in lx b gy mb mc l md me">import axios from 'axios';</span><span id="59fb" class="kt ku in lx b gy mf mc l md me">const BOT_TOKEN = process.env.BOT_TOKEN<br/>const CHAT_ID = process.env.CHAT_ID</span><span id="5b7d" class="kt ku in lx b gy mf mc l md me">async function sendMessage(message) {<br/>    const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`<br/>    const params = { chat_id: CHAT_ID, text: message }<br/>    await axios.get(url, { params: params })<br/>}</span></pre><p id="f447" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">差不多就是这样！让我们也试试这个。</p><pre class="ls lt lu lv gt lw lx ly lz aw ma bi"><span id="326a" class="kt ku in lx b gy mb mc l md me">await sendMessage("💰 New user signed up")</span></pre><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0673b133fd3c82cb8ff32351a305d617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CmoNY3Be9OkHHywCop23LA.png"/></div></div></figure><p id="e126" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">差不多就是这样！通过添加这几行，我们得到了另一个几乎可以用于任何事情的超能力！</p><p id="b8a4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我写过一篇类似的用不和代替电报的文章。如果你感兴趣，可以通过下面的链接查看:)</p><div class="mh mi gp gr mj mk"><a href="https://sh4yan.medium.com/how-to-send-your-events-and-logs-to-discord-via-python-or-javascript-6be2859234c2" rel="noopener follow" target="_blank"><div class="ml ab fo"><div class="mm ab mn cl cj mo"><h2 class="bd io gy z fp mp fr fs mq fu fw im bi translated">如何通过Python或JavaScript将您的事件和日志发送到discord。</h2><div class="mr l"><h3 class="bd b gy z fp mp fr fs mq fu fw dk translated">在我的软件开发生涯中，有很多次我想得到即时更新和提醒，当…</h3></div><div class="ms l"><p class="bd b dl z fp mp fr fs mq fu fw dk translated">sh4yan.medium.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my jt mk"/></div></div></a></div><p id="b628" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mz">更多内容请看</em><a class="ae lr" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mz">plain English . io</em></strong></a></p></div></div>    
</body>
</html>