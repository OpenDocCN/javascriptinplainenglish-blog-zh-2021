<html>
<head>
<title>How to Publish Your Custom React Hook on NPM in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在5分钟内在NPM上发布你的自定义反应钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-publish-your-custom-react-hook-on-npm-in-5-minutes-f3baed1f916d?source=collection_archive---------5-----------------------#2021-09-08">https://javascript.plainenglish.io/how-to-publish-your-custom-react-hook-on-npm-in-5-minutes-f3baed1f916d?source=collection_archive---------5-----------------------#2021-09-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fa0a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用rollup.js</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d4be299396555af1718633c37fd0e5fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGdSkAE87kDjaB7Kfz2GRA.png"/></div></div></figure><p id="767c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">反应钩很棒。他们让我们可以选择为我们需要的任何东西定制挂钩。有时候，你建造了非常有用的钩子——你想与世界分享它们。</p><p id="1917" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当你已经在查找如何发布NPM套餐时，你注意到:<br/>这可能有点困难。根据您想要发布的内容，需要进行一些配置。为了让事情变得简单，这里有一个在NPM上发布自定义React hook的指南。</p><h1 id="8851" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">编写自定义挂钩本身</h1><p id="bd77" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">因为，最后，你要自己写一个钩子，所以我们在这里给它一个简单快速的例子。每当组件更新时(包括挂载，如您所理解的useEffect ),控制台上会记录以下“钩子”。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><p id="9f8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我知道这绝对不是一个定制钩子的用例，但是它现在可以作为一个例子。使用它很简单:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="14ff" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">正在初始化我们的包</h1><p id="965f" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">让我们从不太好的部分开始。要在NPM上发布包，您需要一个帐户。它不花费任何东西。在这里自己报名<a class="ae mm" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="d74c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">当您创建帐户时(确保通过您收到的电子邮件确认您的电子邮件地址！)或者已经有了，在终端登录自己的账号:<code class="fe mn mo mp mq b">npm login</code>。</p><p id="e6c3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建我们的包像往常一样工作:创建一个新目录，运行<br/> <code class="fe mn mo mp mq b">npm init -y</code>。确保在package.json的<code class="fe mn mo mp mq b">name</code>字段中选择一个好的名称，然后在package.json中创建一个<code class="fe mn mo mp mq b">main</code>字段，指向绑定的文件。现在，我们使用“dist”目录中的<code class="fe mn mo mp mq b">index.js</code>——所以确保创建两个目录。package.json条目如下所示:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="202c" class="mv lo iq mq b gy mw mx l my mz">"main": "dist/index.js",</span></pre><h2 id="bf94" class="mv lo iq bd lp na nb dn lt nc nd dp lx la ne nf lz le ng nh mb li ni nj md nk bi translated">了解版本控制</h2><p id="6547" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">如您所见，package.json将您的包版本默认设置为1.0.0。</p><p id="5048" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每当您发布软件包的更新版本时，都需要增加版本。选择版本不是随机的——它背后有一个计划，你应该遵循:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/51352c812f7dae3659f7d24f1573c7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*zvKbY7uSiKk1EjwhHXzzWw.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">Source: <a class="ae mm" href="https://docs.npmjs.com/about-semantic-versioning" rel="noopener ugc nofollow" target="_blank">docs.npmjs.com</a></figcaption></figure><p id="ac89" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因此，在再次发布NPM软件包之前，请确保更改版本。对于第一次发布，版本<code class="fe mn mo mp mq b">1.0.0</code>是好的。</p><h1 id="13d2" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">为NPM打造包装</h1><p id="2665" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了将React Hooks代码转换成适合NPM的格式，我们使用了著名的rollup.js。文件结构现在应该如下所示:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="172e" class="mv lo iq mq b gy mw mx l my mz">.<br/>├── dist<br/>│ └── index.js<br/>├── package.json<br/>└── src<br/> └── index.js</span></pre><p id="8264" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要使用rollup，可以全局安装:<code class="fe mn mo mp mq b">npm install -g rollup</code>。然后，我们可以通过运行package.json脚本来使用它构建我们的包。因此，在package.json的脚本部分，添加:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="3abb" class="mv lo iq mq b gy mw mx l my mz">"build": "rollup src/index.js --file dist/index.js --format cjs"</span></pre><p id="c364" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">格式值“cjs”代表commonJS。这意味着我们使用现代导入/导出语法的React钩子代码被转换了。dist目录中的index.js，最终文件，将使用从Node中得知的<code class="fe mn mo mp mq b">require</code>和<code class="fe mn mo mp mq b">module.exports</code>语法。为了自动进行这种更改，我们使用Rollup。</p><p id="57fa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们写的想要发布的React钩子可以复制到src目录里面的index.js中。然后，您应该能够运行<code class="fe mn mo mp mq b">npm run build</code>，在dist/index.js中生成格式化的React Hook它应该如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mk ml l"/></div></figure><h1 id="3412" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">让我们发布这个包</h1><p id="85a5" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">最后一次检查是否一切就绪，可以发布了:</p><ul class=""><li id="77a6" class="nq nr iq kt b ku kv kx ky la ns le nt li nu lm nv nw nx ny bi translated">你在终端登录NPM了吗？</li><li id="1a45" class="nq nr iq kt b ku nz kx oa la ob le oc li od lm nv nw nx ny bi translated">dist-directory中是否存在index.js？</li><li id="0ecd" class="nq nr iq kt b ku nz kx oa la ob le oc li od lm nv nw nx ny bi translated">你是否在package.json中将<code class="fe mn mo mp mq b">"dist/index.js"</code>作为值提供给了<code class="fe mn mo mp mq b">"main"</code>？是否在package.json的<code class="fe mn mo mp mq b">"name"</code>字段中提供了名称？</li><li id="318c" class="nq nr iq kt b ku nz kx oa la ob le oc li od lm nv nw nx ny bi translated">你通过他们发给你的邮件确认你的NPM账户了吗？</li></ul><p id="b5f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果这三件事你都能回答是，那就可以发布包:<code class="fe mn mo mp mq b">npm publish --access public</code>。好了，你的包裹出版了！</p><h2 id="c2fd" class="mv lo iq bd lp na nb dn lt nc nd dp lx la ne nf lz le ng nh mb li ni nj md nk bi translated">测试包</h2><p id="1751" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">在您选择的React项目中，您可以安装您的Hook包。只需运行<code class="fe mn mo mp mq b">npm install &lt;your-package-name&gt;</code>。包名是通过package.json的<code class="fe mn mo mp mq b">"name"</code>字段定义的。</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="1e23" class="mv lo iq mq b gy mw mx l my mz">import useConsole from "&lt;your-package-name&gt;"</span><span id="b3ab" class="mv lo iq mq b gy oe mx l my mz">function App() {<br/>  useConsole()<br/>  ...<br/>}</span></pre><h1 id="60b7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">更新、提示和技巧</h1><p id="3a7e" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">为了发布包的新版本，您需要做三件事:</p><ol class=""><li id="30dd" class="nq nr iq kt b ku kv kx ky la ns le nt li nu lm of nw nx ny bi translated">用<code class="fe mn mo mp mq b">npm run build</code>重新运行构建过程</li><li id="353e" class="nq nr iq kt b ku nz kx oa la ob le oc li od lm of nw nx ny bi translated">更改package.json中的版本</li><li id="b66f" class="nq nr iq kt b ku nz kx oa la ob le oc li od lm of nw nx ny bi translated">运行<code class="fe mn mo mp mq b">npm publish</code></li></ol><p id="b728" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为了节省时间并获得更高的安全性，您可以组合使用其中的两个命令。通过在package.json中创建一个定制脚本，我们可以依次运行构建和发布包。通过这种方式，您可以确保在没有运行构建之前不会发布:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="aa90" class="mv lo iq mq b gy mw mx l my mz">"deploy": "npm run build &amp;&amp; npm publish"</span></pre><p id="bbfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">不使用<code class="fe mn mo mp mq b">npm publish</code>，现在，可以使用<code class="fe mn mo mp mq b">npm run deploy</code>。</p><h2 id="d807" class="mv lo iq bd lp na nb dn lt nc nd dp lx la ne nf lz le ng nh mb li ni nj md nk bi translated">链接你的GitHub和主页</h2><p id="802b" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">你肯定使用Git来管理你的包的代码。在GitHub上发布代码时，你可以从你的NPM站点链接到GitHub站点。NPM的每个好包装都使用这个:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi og"><img src="../Images/dde63dd4d083ae7193d971e531ea9a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*_mpbuQKtQBbuz21IUVWwow.png"/></div><figcaption class="nm nn gj gh gi no np bd b be z dk">Source: <a class="ae mm" href="https://www.npmjs.com/package/react" rel="noopener ugc nofollow" target="_blank">npmjs.com</a></figcaption></figure><p id="ad41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">要链接GitHub repo，请在package.json中引用它，如下所示:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="7b54" class="mv lo iq mq b gy mw mx l my mz">"repository": {<br/>  "type": "git",<br/>  "url": "https://github.com/&lt;username&gt;/&lt;repo-name&gt;"<br/>},</span></pre><p id="0b6a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如你的GitHub repo，你可以添加一个主页:</p><pre class="kg kh ki kj gt mr mq ms mt aw mu bi"><span id="b441" class="mv lo iq mq b gy mw mx l my mz">"homepage": "https://github.com/&lt;username&gt;/&lt;repo-name&gt;#readme"</span></pre><p id="7835" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最常见的方法是将你的GitHub README作为主页。</p><p id="cc8c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的阅读！</p><h2 id="a988" class="mv lo iq bd lp na nb dn lt nc nd dp lx la ne nf lz le ng nh mb li ni nj md nk bi translated"><a class="ae mm" href="https://twitter.com/louispetrik" rel="noopener ugc nofollow" target="_blank">在Twitter上找到我以了解最新消息:)</a></h2><p id="abc2" class="pw-post-body-paragraph kr ks iq kt b ku mf jr kw kx mg ju kz la mh lc ld le mi lg lh li mj lk ll lm ij bi translated">关于React挂钩的更多信息:</p><div class="oh oi gp gr oj ok"><a rel="noopener  ugc nofollow" target="_blank" href="/next-js-keep-state-7eb68984c54e"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">如何在Next.js中跨页面保持组件状态</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">使用会话存储&amp; useLayoutEffect</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="ot l"><div class="ou l ov ow ox ot oy kp ok"/></div></div></a></div><div class="oh oi gp gr oj ok"><a href="https://medium.com/codex/usestate-useref-react-9f2398606d51" rel="noopener follow" target="_blank"><div class="ol ab fo"><div class="om ab on cl cj oo"><h2 class="bd ir gy z fp op fr fs oq fu fw ip bi translated">使用useRef作为使用状态替换—下面是时间和原因</h2><div class="or l"><h3 class="bd b gy z fp op fr fs oq fu fw dk translated">useState挂钩可能是任何与在React.js中保存数据相关的挂钩</h3></div><div class="os l"><p class="bd b dl z fp op fr fs oq fu fw dk translated">medium.com</p></div></div><div class="ot l"><div class="oz l ov ow ox ot oy kp ok"/></div></div></a></div><p id="0082" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="pa">更多内容看</em><a class="ae mm" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kt ir"><em class="pa">plain English . io</em></strong></a></p></div></div>    
</body>
</html>