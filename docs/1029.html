<html>
<head>
<title>How to Build a ClubHouse clone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•å»ºç«‹ä¸€ä¸ªå…‹éš†çš„ä¿±ä¹éƒ¨ä¼šæ‰€</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://javascript.plainenglish.io/how-to-create-an-app-like-clubhouse-eeb2382da03e?source=collection_archive---------3-----------------------#2021-03-04">https://javascript.plainenglish.io/how-to-create-an-app-like-clubhouse-eeb2382da03e?source=collection_archive---------3-----------------------#2021-03-04</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="32d6" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">ç”¨Angular + Agora + Firebaseåˆ›å»ºä¸€ä¸ªç±»ä¼¼ClubHouseçš„åº”ç”¨ç¨‹åº</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/1a6a9c9bec7124d5bf868f0f0c4b58f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XMuBFw-6UyJCqAQY"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/@williamk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">William Krause</a> on <a class="ae kw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e977" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æœ€è¿‘å‡ å‘¨ï¼Œç½‘ç»œä¸Šå‡ºç°äº†è¶Šæ¥è¶Šå¤šå…³äºä¿±ä¹éƒ¨ä¼šæ‰€åº”ç”¨çš„æŠ€æœ¯ä¿¡æ¯ã€‚ä¸€äº›çˆ±å¥½è€…åˆ›å»ºäº†å¸¦æœ‰ä¼šæ‰€APIåº“çš„å­˜å‚¨åº“ï¼Œç”šè‡³å‘å¸ƒäº†éå®˜æ–¹çš„Androidåº”ç”¨ã€‚</p><p id="3f05" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å…¬ä¼—çš„å…´è¶£å’Œå¯ç”¨çš„ä¿¡æ¯ä½¿å¾—å»ºç«‹ä½ çš„è¯­éŸ³ç½‘ç»œæˆ–è€…è‡³å°‘çŸ¥é“å¦‚ä½•å®ç°å®ƒå˜å¾—å¾ˆæœ‰è¶£ã€‚</p><p id="1445" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•ä½¿ç”¨Agora.ioã€Angularå’ŒFirebaseå®ç°åŸºæœ¬åŠŸèƒ½ã€‚</p></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><p id="6017" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">Firebaseåªæ˜¯ä¸€ä¸ªä¾‹å­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•åç«¯æ¥å¤„ç†èº«ä»½éªŒè¯å’Œå­˜å‚¨ç©ºé—´</p><h1 id="2b7f" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">å…ˆå†³æ¡ä»¶</h1><ul class=""><li id="0b43" class="ms mt ir kz b la mu ld mv lg mw lk mx lo my ls mz na nb nc bi translated">åˆ›å»ºäº†firebaseé¡¹ç›®</li><li id="1984" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">å·²ç»åœ¨æ‚¨çš„æœºå™¨ä¸Šå®‰è£…äº†Node.js</li><li id="539f" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">å·²åœ¨å…¨çƒå®‰è£…<code class="fe ni nj nk nl b">@angular/cli</code></li><li id="4c4e" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">æ‚¨å¯¹å¦‚ä½•ä½¿ç”¨Firebaseæœ‰æ‰€äº†è§£</li></ul><h1 id="84cf" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">è®®ç¨‹</h1><ul class=""><li id="9c7d" class="ms mt ir kz b la mu ld mv lg mw lk mx lo my ls mz na nb nc bi translated">é¡¹ç›®åˆå§‹åŒ–</li><li id="e8ce" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">è¯æ˜</li><li id="9747" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">å®¢æˆ¿å¤§å ‚å’Œå®¢æˆ¿åˆ›å»º</li><li id="7376" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls mz na nb nc bi translated">è¯­éŸ³ç›´æ’­æµä¸€å¯¹å¤š(æœ€å¤š100ä¸‡å¬ä¼—)</li></ul><p id="6cb8" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–é¡¹ç›®ã€‚</p><p id="c548" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ‰“å¼€ç»ˆç«¯ï¼Œå¯¼èˆªåˆ°æ‰€éœ€çš„æ–‡ä»¶å¤¹å¹¶è¿è¡Œ:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="1b98" class="nq mb ir nl b gz nr ns l nt nu">ng new clubhouse</span></pre><p id="5a76" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç„¶åï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå¸¦è·¯çº¿çš„åŠŸèƒ½æ¨¡å—:</p><ol class=""><li id="626e" class="ms mt ir kz b la lb ld le lg nv lk nw lo nx ls ny na nb nc bi translated"><code class="fe ni nj nk nl b">ng generate module profile â€” route profile â€” module app.module</code></li><li id="6bb7" class="ms mt ir kz b la nd ld ne lg nf lk ng lo nh ls ny na nb nc bi translated"><code class="fe ni nj nk nl b">ng generate module rooms â€” route rooms â€” module app.module</code></li></ol><p id="dd52" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ¸…é™¤app.component.htmlï¼Œåªç•™ä¸‹ä¸€ä¸ªæ ‡è®°:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="a029" class="nq mb ir nl b gz nr ns l nt nu">&lt;router-outlet&gt;&lt;/router-outlet&gt;</span></pre><p id="3c54" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å‡ºå‘å‰å‰©ä¸‹çš„æœ€åä¸€ä»¶é‡è¦çš„äº‹â€”â€”@ angular/fireåº“ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="d941" class="nq mb ir nl b gz nr ns l nt nu">ng add <a class="ae kw" href="http://twitter.com/angular/fire" rel="noopener ugc nofollow" target="_blank">@angular/fire</a></span></pre><p id="3d6f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å°†Firebaseé…ç½®æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="324e" class="nq mb ir nl b gz nr ns l nt nu">export const environment = {<br/>  production: false,<br/>  <strong class="nl is">firebase: {<br/>    apiKey: â€˜&lt;your-key&gt;â€™,<br/>    authDomain: â€˜&lt;your-project-authdomain&gt;â€™,<br/>    databaseURL: â€˜&lt;your-database-URL&gt;â€™,<br/>    projectId: â€˜&lt;your-project-id&gt;â€™,<br/>    storageBucket: â€˜&lt;your-storage-bucket&gt;â€™,<br/>    messagingSenderId: â€˜&lt;your-messaging-sender-id&gt;â€™,<br/>    appId: â€˜&lt;your-app-id&gt;â€™,<br/>    measurementId: â€˜&lt;your-measurement-id&gt;â€™<br/>  }</strong><br/>};</span></pre><p id="f944" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¹¶åœ¨<code class="fe ni nj nk nl b">app.module.ts</code>ä¸­ä½¿ç”¨</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="3495" class="nq mb ir nl b gz nr ns l nt nu">imports: [<br/>  BrowserModule,<br/>  AppRoutingModule,<br/>  <strong class="nl is">AngularFireModule.initializeApp(environment.firebase)</strong><br/>]</span></pre><p id="b9f1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨æˆ‘ä»¬å‡†å¤‡å¥½ä½¿ç”¨æˆ‘ä»¬æœªæ¥çš„åº”ç”¨ç¨‹åºäº†=)</p><h1 id="e82a" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">è¯æ˜</h1><p id="d93e" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">Firebaseåº”ç”¨ç¨‹åºæœ‰è®¸å¤šä¸åŒçš„è®¤è¯æä¾›è€…ã€‚ä¸ºäº†ä½¿æœ¬æ•™ç¨‹ç®€å•ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªåŒ¿åæä¾›è€…ã€‚ä¸éœ€è¦ä»»ä½•ä¸å¿…è¦çš„åŠ¨ä½œã€‚</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oc"><img src="../Images/8070862ded974b90116d5a6d2013632f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhYkUFDELKpasMaxJEy1Gg.png"/></div></div></figure><p id="924c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä½†æ˜¯åœ¨æ‚¨çš„é¡¹ç›®ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„èº«ä»½éªŒè¯ã€‚</p><p id="1bb3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨<code class="fe ni nj nk nl b">app-routing.module.ts</code>ä¸­è®¾ç½®æˆ¿é—´æ¨¡å—ä¸ºé»˜è®¤è·¯çº¿ï¼Œå¹¶å¯ç”¨æˆæƒå®ˆå«ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="c2b2" class="nq mb ir nl b gz nr ns l nt nu">...<br/>import { AngularFireAuthGuard, redirectUnauthorizedTo } from '@angular/fire/auth-guard';</span><span id="7616" class="nq mb ir nl b gz od ns l nt nu"><strong class="nl is">const redirectUnauthorizedToLogin = () =&gt; redirectUnauthorizedTo(['profile']);</strong></span><span id="89f5" class="nq mb ir nl b gz od ns l nt nu">const routes: Routes = [<br/>  ...<br/>  {<br/>    path: 'rooms',<br/>    loadChildren: () =&gt;<br/>    import('./rooms/rooms.module').then((<em class="oe">m</em>) =&gt; <em class="oe">m</em>.RoomsModule),<br/>    <strong class="nl is">canActivate: [AngularFireAuthGuard],<br/>    data: { authGuardPipe: redirectUnauthorizedToLogin }</strong><br/>  },<br/>  <strong class="nl is">{<br/>    path: '**',<br/>    redirectTo: 'rooms'<br/>  }</strong><br/>];</span></pre><p id="5c94" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨ï¼Œæˆ‘ä»¬å°†åœ¨ä¸ªäººèµ„æ–™é¡µé¢ä¸Šæ·»åŠ ä¸€ä¸ªç®€å•çš„ç™»å½•æŒ‰é’®ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºå•ç‹¬çš„ç™»å½•/æ³¨å†Œ/ä¸ªäººèµ„æ–™é¡µé¢ã€‚ä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œç”¨ä¸€ä¸ªç™»å½•æŒ‰é’®å°±è¶³å¤Ÿäº†ã€‚</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj of"><img src="../Images/fa15a1df4c5cf0981556b5932efad2ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*GIuADMQU28yy01FJ8Owr_Q.png"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Profile component view</figcaption></figure><p id="35a6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">profile.component.html</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="30af" class="nq mb ir nl b gz nr ns l nt nu">&lt;p&gt;Hello ğŸ‘‹&lt;/p&gt;<br/>&lt;button (click)="login()"&gt;<br/>Login to Clubhouse<br/>&lt;/button&gt;</span></pre><p id="df67" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">é…ç½®æ–‡ä»¶.ç»„ä»¶. scss</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="eae9" class="nq mb ir nl b gz nr ns l nt nu">:host {<br/>  display: block;<br/>  text-align: center;<br/>  padding: 50px 0;<br/>}</span></pre><p id="4994" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å®ç°æˆåŠŸæ—¶é‡å®šå‘åˆ°æˆ¿é—´é¡µé¢çš„ç™»å½•æ–¹æ³•ã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="7969" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å•å‡»æµè§ˆå™¨ä¸­çš„ç™»å½•æŒ‰é’®ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨å°†è¢«é‡å®šå‘åˆ°æˆ¿é—´é¡µé¢ã€‚è¿™ä¸€æ¬¡auth guardå°†å…è®¸æˆ‘ä»¬æ‰“å¼€è¿™ä¸ªé¡µé¢ã€‚</p><h1 id="abf0" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">å®¢æˆ¿å¤§å ‚å’Œå®¢æˆ¿åˆ›å»º</h1><p id="92b7" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">åœ¨è¿™ä¸€é¡µï¼Œè®©æˆ‘ä»¬å±•ç¤ºå¸¦æœ‰å¯ç”¨æˆ¿é—´å’ŒæŒ‰é’®â€œå¼€å§‹ä¸€ä¸ªæˆ¿é—´â€çš„å¡ç‰‡ã€‚æˆ‘ä»¬å°†ä½¿ç”¨Firebaseå®æ—¶æ•°æ®åº“æ¥å­˜å‚¨æˆ¿é—´åˆ—è¡¨ã€‚</p><p id="1383" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å…è®¸ç”¨æˆ·è¯»å†™æ•°æ®åº“ã€‚åœ¨æµè§ˆå™¨æœç´¢æ§åˆ¶å°ä¸­æ‰“å¼€å¹¶è½¬åˆ°:<code class="fe ni nj nk nl b">Realtime database =&gt; Rules</code>ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="dc8c" class="nq mb ir nl b gz nr ns l nt nu">{<br/>  "rules": {<br/>    ".read": "auth != null",<br/>    ".write": "auth != null"<br/>  }<br/>}</span></pre><p id="c4a5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ‰“å¼€<code class="fe ni nj nk nl b">rooms.component.ts</code>ã€‚æˆ‘ä»¬å°†åœ¨è¿™é‡Œä½¿ç”¨ä¸€äº›ä¾èµ–é¡¹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­æä¾›å®ƒä»¬:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="23fe" class="nq mb ir nl b gz nr ns l nt nu">...<br/><strong class="nl is">import { AngularFireAuth } from '@angular/fire/auth';<br/>import { AngularFireDatabase } from '@angular/fire/database';<br/>import { Router } from '@angular/router';<br/>import { Observable } from 'rxjs';<br/>import { map, take, takeUntil } from 'rxjs/operators';</strong></span><span id="d967" class="nq mb ir nl b gz od ns l nt nu">...<br/>constructor(<br/>  <strong class="nl is">private <em class="oe">auth</em>: AngularFireAuth,<br/>  private <em class="oe">db</em>: AngularFireDatabase,<br/>  private <em class="oe">router</em>: Router</strong><br/>) {}</span><span id="1f98" class="nq mb ir nl b gz od ns l nt nu">...</span></pre><p id="9ac4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨æˆ‘ä»¬éœ€è¦ä¸€äº›å˜é‡æ¥å­˜å‚¨<code class="fe ni nj nk nl b">rooms</code>ã€<code class="fe ni nj nk nl b">subscriptions</code>å’Œ<code class="fe ni nj nk nl b">userId</code>ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="485b" class="nq mb ir nl b gz nr ns l nt nu"><strong class="nl is">export interface Irooms {<br/>  key?: string;<br/>  name: string;<br/>  host?: string;<br/>}</strong><br/>...</span><span id="4bc9" class="nq mb ir nl b gz od ns l nt nu">export class RoomsComponent implements OnInit {<br/>  <strong class="nl is">public $rooms: Observable&lt;Irooms[]&gt; | undefined;<br/>  public isRoomCreationShown = false;<br/>  private user: string | undefined;<br/>  private roomList = this.db.list&lt;Irooms&gt;('rooms');<br/>  private $destroy: Subject&lt;boolean&gt; = new Subject&lt;boolean&gt;();</strong></span><span id="ac13" class="nq mb ir nl b gz od ns l nt nu">  constructor(<br/>    private <em class="oe">auth</em>: AngularFireAuth,<br/>    private <em class="oe">db</em>: AngularFireDatabase,<br/>    private <em class="oe">router</em>: Router<br/>  ) {}</span></pre><p id="c30a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨ç»„ä»¶åˆå§‹åŒ–ä¸Šï¼Œæˆ‘ä»¬åº”è¯¥å»ºç«‹ä¸€ä¸ªå¯¹æ•°æ®åº“åˆ—è¡¨çš„è®¢é˜…- <code class="fe ni nj nk nl b">rooms</code>ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="1f5a" class="nq mb ir nl b gz nr ns l nt nu">ngOnInit(): void {<br/>  <strong class="nl is">this.$rooms = this.roomList.snapshotChanges().pipe(<br/>    map((action) =&gt;<br/>      action.map((c) =&gt; {<br/>        return {<br/>          ...(c.payload.val() as any),<br/>          key: c.payload.key<br/>        };<br/>      })<br/>    )<br/>  );</strong><br/>}</span></pre><p id="bc06" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å½“ç”¨æˆ·åˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–å®šä¹‰ä¸ºä¸»äººã€‚å½“ç„¶ï¼Œåœ¨ç”Ÿäº§ä¸­ï¼Œæœ€å¥½æ˜¯åœ¨äº‘åŠŸèƒ½ç«¯è¿›è¡Œï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè®©æˆ‘ä»¬ä¿æŒç®€å•ã€‚æˆ‘ä»¬å°†åœ¨åˆ›å»ºæˆ¿é—´æ—¶ä¸ºå½“å‰ç”¨æˆ·æä¾›è¯¦ç»†çš„UIDã€‚ä¸ºäº†æä¾›å®ƒï¼Œæˆ‘ä»¬éœ€è¦ä»firebaseç”¨æˆ·èº«ä»½éªŒè¯çŠ¶æ€ä¸­è·å–å®ƒã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="8a34" class="nq mb ir nl b gz nr ns l nt nu">ngOnInit(): void {<br/>  ...<br/>  <strong class="nl is">this.auth.authState.pipe(take(1)).subscribe({<br/>    next: (user) =&gt; {<br/>      this.user = user?.uid;<br/>    }<br/>  });</strong><br/>}</span></pre><p id="a6d2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ¿é—´éƒ¨åˆ†å¿«å®Œæˆäº†ã€‚æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æˆ¿é—´çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯¼èˆªç”¨æˆ·åˆ°æ‰€éœ€æˆ¿é—´çš„èƒ½åŠ›ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="9117" class="nq mb ir nl b gz nr ns l nt nu">public addRoom(nameInput: HTMLInputElement): void {<br/>  if (nameInput.value.length) {<br/>    this.roomList<br/>    .push({<br/>      name: nameInput.value,<br/>      host: this.user<br/>    })<br/>    .then((resp) =&gt; {<br/>       this.navigate(resp.key);<br/>    });<br/>  }<br/>  nameInput.value = '';<br/>  this.isRoomCreationShown = false;<br/>}</span><span id="1124" class="nq mb ir nl b gz od ns l nt nu">public navigate(roomId?: string | null): void {<br/>  this.router.navigate([`rooms/${roomId}`]);<br/>}</span></pre><p id="eef5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç”¨äºæ˜¾ç¤ºæˆ¿é—´åˆ—è¡¨å’Œåˆ›å»ºæˆ¿é—´çš„ç®€å•è¾“å…¥çš„æ¨¡æ¿ã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="c7bb" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¸¦æœ‰æ˜¾ç¤ºæˆ¿é—´åˆ›å»ºå½¢å¼çš„å°è¿‡æ¸¡çš„æ ·å¼ã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure></div><div class="ab cl lt lu hv lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ik il im in io"><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div class="gi gj oi"><img src="../Images/fa7be5765251109c8e000290ba87eb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*fqS8Or_XxN_mTRhoxWFWug.gif"/></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">I have no idea why typing is so slow on the gif ğŸŒ</figcaption></figure><p id="98d2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">â€œæˆ¿é—´â€ç»„ä»¶å·²ç»å®Œæˆï¼Œä¸‹é¢æ˜¯å®ƒåº”è¯¥çœ‹èµ·æ¥çš„æ ·å­ã€‚</p><p id="b4c5" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¾ˆç®€åŒ–ï¼Œä½†è¿™æ˜¯æ•™ç¨‹ï¼Œä¸æ˜¯çœŸå®é¡¹ç›®ã€‚æˆ‘ä¸å–œæ¬¢ä½¿ç”¨è¢«åŠ¨å½¢å¼ã€‚å¯¹äºç”Ÿäº§æ¥è¯´ï¼Œè¿˜æ˜¯ç”¨å®ƒä»¬æ¯”è¾ƒå¥½ã€‚</p><p id="b07b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¦‚æ‚¨æ‰€è§ï¼Œå½“æˆ‘ä»¬åˆ›å»ºæ–°æˆ¿é—´æ—¶ï¼Œæˆ‘ä»¬æ‰“å¼€äº†å¦ä¸€ä¸ªé¡µé¢ï¼Œè¯¥é¡µé¢å½“å‰æ˜¯ç©ºçš„ã€‚è¿™ä¸ªç»„ä»¶æ­¤åˆ»å¯¹ä½ æ¥è¯´æ˜¯ä¸å­˜åœ¨çš„ï¼Œæˆ‘ä»¬æ¥è¡¥å……ä¸€ä¸‹ã€‚</p><p id="75a4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨ç»ˆç«¯ä¸­è¿è¡Œ:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="de96" class="nq mb ir nl b gz nr ns l nt nu">ng g component rooms/room</span></pre><p id="6b35" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åˆ«å¿˜äº†å°†å®ƒæ·»åŠ åˆ°å®¢æˆ¿è·¯çº¿ä¸­:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="e962" class="nq mb ir nl b gz nr ns l nt nu">const routes: Routes = [<br/>  { path: '', component: RoomsComponent },<br/>  <strong class="nl is">{ path: ':id', component: RoomComponent }</strong><br/>];</span></pre><h1 id="ab0d" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">è¯­éŸ³ç›´æ’­ä¸€å¯¹å¤š</h1><p id="03e9" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">é¦–å…ˆåœ¨<a class="ae kw" href="https://www.agora.io/" rel="noopener ugc nofollow" target="_blank"> agora.io </a>æ³¨å†Œã€‚è¿™æ˜¯ä¸€ä¸ªSaaSåç«¯ï¼Œå®ƒä½äºä¿±ä¹éƒ¨åº”ç”¨ç¨‹åºçš„åé¢ã€‚å­¦ä¹ ç”¨çš„ä¸ç”¨æä¾›ä»»ä½•é“¶è¡Œå¡ã€‚</p><p id="bb70" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ¥ä¸‹æ¥ï¼Œç”¨npmå®‰è£…Agora SDK:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="44f2" class="nq mb ir nl b gz nr ns l nt nu">npm i agora-rtc-sdk</span></pre><p id="50e2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨è½¬åˆ°Agoraæ§åˆ¶å°= &gt;æ‰¾åˆ°æ‚¨çš„é¡¹ç›®= &gt;ç‚¹å‡»ç¼–è¾‘= &gt;å¤åˆ¶æ‚¨çš„åº”ç”¨ç¨‹åºidã€‚å°†å®ƒä½œä¸ºfirebase configæ—è¾¹çš„agoraAppIdæ’å…¥åˆ°environment.tsä¸­ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="369b" class="nq mb ir nl b gz nr ns l nt nu">export const environment = {<br/>  production: false,<br/>  firebase: {<br/>    apiKey: â€˜&lt;your-key&gt;â€™,<br/>    authDomain: â€˜&lt;your-project-authdomain&gt;â€™,<br/>    databaseURL: â€˜&lt;your-database-URL&gt;â€™,<br/>    projectId: â€˜&lt;your-project-id&gt;â€™,<br/>    storageBucket: â€˜&lt;your-storage-bucket&gt;â€™,<br/>    messagingSenderId: â€˜&lt;your-messaging-sender-id&gt;â€™,<br/>    appId: â€˜&lt;your-app-id&gt;â€™,<br/>    measurementId: â€˜&lt;your-measurement-id&gt;â€™<br/>  },<br/>  <strong class="nl is">agoraAppId: '&lt;your-agora-app-id&gt;'</strong><br/>};</span></pre><p id="07b4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½æ„å»ºæœ€åä¸€ä¸ªç»„ä»¶â€”â€”ä¸€ä¸ªæœ‰å®æ—¶æµçš„æˆ¿é—´ã€‚</p><p id="f0ee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">è¿™æ¬¡æˆ‘ä»¬å°†ä»æ¨¡æ¿å¼€å§‹ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåª’ä½“æ’­æ”¾å™¨çš„å®¹å™¨ã€‚é€šè¿‡è¿™ä¸ªæ’­æ”¾å™¨ï¼Œç”¨æˆ·å°†å¬åˆ°å£°éŸ³ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="60ab" class="nq mb ir nl b gz nr ns l nt nu">&lt;section class="room-content"&gt;<br/>    &lt;div #streamContainer&gt;&lt;/div&gt;<br/>    &lt;div class="users"&gt;<br/>        &lt;div class="user-card"<br/>             *ngFor="let user of $onlineList | async"&gt;<br/>            &lt;img [ngClass]="{'host': user.key === room?.host}"<br/>                 [src]="'<a class="ae kw" href="https://i.pravatar.cc/150?u='+user.key" rel="noopener ugc nofollow" target="_blank">https://i.pravatar.cc/150?u='+user.key</a>"<br/>                 alt=""&gt;<br/>            &lt;h4&gt;{{user?.displayName}}&lt;/h4&gt;<br/>        &lt;/div&gt;<br/>    &lt;/div&gt;<br/>&lt;/section&gt;<br/>&lt;section class="room-footer"&gt;<br/>    &lt;button class="btn leave-btn"<br/>            (click)="leaveRoom()"&gt;âœŒï¸ Leave quietly&lt;/button&gt;<br/>&lt;/section&gt;</span></pre><p id="3a46" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨è¿™ä¸ªæ¨¡æ¿ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªéƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªæ˜¯åŠ å…¥æˆ¿é—´çš„ç”¨æˆ·åˆ—è¡¨ã€‚ç¬¬äºŒéƒ¨åˆ†æœ‰ä¸€ä¸ªç¦»å¼€æˆ¿é—´çš„æŒ‰é’®ã€‚</p><p id="fcbe" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬ä½¿ç”¨åŒ¿åè®¤è¯ï¼Œæ²¡æœ‰ç”¨æˆ·åå’Œå¤´åƒï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¼šäº§ç”Ÿéšæœºçš„ç”¨æˆ·æ•°æ®ã€‚</p><p id="5e2f" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">è®©æˆ‘ä»¬æ·»åŠ æ ·å¼ï¼Œå®ƒä»¬å¾ˆç®€å•:</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="d32a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬å°†ç”¨ç»¿è‰²è¾¹æ¡†çªå‡ºæ˜¾ç¤ºæˆ¿é—´çš„ä¸»æŒäºº(æ¼”è®²è€…)ã€‚</p><p id="7b70" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬çš„ä¸‹ä¸€æ­¥æ˜¯ç»„ä»¶é€»è¾‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¼å…¥<code class="fe ni nj nk nl b">activatedRoute</code>å¹¶ä»è·¯ç”±ä¸­è·å–æˆ¿é—´idã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="0a7d" class="nq mb ir nl b gz nr ns l nt nu"><strong class="nl is">import { Router, ActivatedRoute } from '@angular/router';</strong></span><span id="e2ef" class="nq mb ir nl b gz od ns l nt nu">...<br/>constructor(<br/>  <strong class="nl is">private <em class="oe">activatedRoute</em>: ActivatedRoute,<br/>  private <em class="oe">route</em>: Router</strong><br/>) {}</span><span id="01b9" class="nq mb ir nl b gz od ns l nt nu">ngOnInit(): void {<br/>  <strong class="nl is">this.roomId = this.activatedRoute.snapshot.paramMap.get('id');</strong><br/>}</span></pre><p id="018e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥æœ€æœ‰è¶£çš„éƒ¨åˆ†â€”â€”å®æ—¶æµå®ç°ã€‚ä¸‹é¢æ˜¯åœ¨ä¸»æŒäººå’Œè§‚ä¼—ä¹‹é—´å¯åŠ¨ç›´æ’­æµçš„ä¸»è¦æ­¥éª¤çš„åºåˆ—å›¾ã€‚</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj oj"><img src="../Images/bf51531203979667029766e5ae32fc3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2tdx9h2nqGWSSwsZ"/></div></div></figure><h2 id="0898" class="nq mb ir bd mc ok ol dn mg om on dp mk lg oo op mm lk oq or mo lo os ot mq ou bi translated">åˆ›å»ºæœ¬åœ°å®¢æˆ·ç«¯</h2><p id="2ad5" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">ç„¶åæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–Agoraå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬åˆ›å»ºè¿™ä¸ªç§æœ‰æ–¹æ³•å¹¶åœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶è°ƒç”¨å®ƒã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="6042" class="nq mb ir nl b gz nr ns l nt nu">...<br/><strong class="nl is">import AgoraRTC from 'agora-rtc-sdk';<br/>import { environment } from 'src/environments/environment';</strong><br/>...</span><span id="b03a" class="nq mb ir nl b gz od ns l nt nu">ngOnInit(): void {<br/>    this.roomId = this.activatedRoute.snapshot.paramMap.get('id');<br/>    <strong class="nl is">this.initClient();</strong><br/>}</span><span id="4dcf" class="nq mb ir nl b gz od ns l nt nu"><strong class="nl is">private initClient(): void {<br/>  this.client = AgoraRTC.createClient({<br/>    mode: 'live',<br/>    codec: 'vp8'<br/>  });</strong></span><span id="6e9d" class="nq mb ir nl b gz od ns l nt nu"><strong class="nl is">  this.client.init(environment.agoraAppId);<br/>}</strong></span></pre><p id="aa78" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€å¯¹å¤šçš„æµï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code class="fe ni nj nk nl b">mode: 'live'</code>çš„åŸå› ï¼Œå› ä¸ºæˆ‘ä»¬å°†åªæ”¯æŒç°ä»£æµè§ˆå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨<code class="fe ni nj nk nl b">codec: vp8</code>ã€‚</p><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj ov"><img src="../Images/a26e9d3bb7b2582eb56f41ff1b20c441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X-Pl3Gxbo-6JAsfeQJBXZg.png"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Codec VP8 and H.264 browser support</figcaption></figure><h2 id="b185" class="nq mb ir bd mc ok ol dn mg om on dp mk lg oo op mm lk oq or mo lo os ot mq ou bi translated">è®¾ç½®ç”¨æˆ·è§’è‰²å¹¶åŠ å…¥é¢‘é“</h2><p id="c022" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">åœ¨åŠ å…¥æ¸ é“ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ£€æµ‹ç”¨æˆ·è§’è‰²ã€‚æ­£å¦‚æ‚¨æ‰€è®°å¾—çš„ï¼Œåœ¨ä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬åœ¨æˆ¿é—´ç»†èŠ‚ä¸­ä¿å­˜äº†ä½œä¸ºä¸»æœºçš„ç”¨æˆ·IDã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦ä»Firebase authçŠ¶æ€ä¸­è·å–å½“å‰ç”¨æˆ·IDï¼Œå¹¶å°†å…¶ä¸æˆ¿é—´ä¸»æœºè¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬å¯ä»¥åŒæ—¶åšã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="07fe" class="nq mb ir nl b gz nr ns l nt nu">private joinRoom(): void {<br/>  combineLatest([<br/>    this.auth.authState,<br/>    this.db.object&lt;Iroom&gt;(`rooms/${this.roomId}`).valueChanges()<br/>  ])<br/>    .pipe(take(1))<br/>    .subscribe({<br/>      next: ([user, room]) =&gt; {<br/>        this.user = user;<br/>        this.room = room;<br/>        this.isHost = this.user.uid === this.room.host;<br/>        this.client.setClientRole(this.isHost ? 'host' : 'audience');<br/>      }<br/>    });<br/>}</span></pre><p id="9e60" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä½ å¯èƒ½ä¼šç”¨è‡ªå·±çš„è§£å†³æ–¹æ¡ˆæ¥å–æ¶ˆè®¢é˜…observablesï¼Œè€Œä¸æ˜¯<code class="fe ni nj nk nl b">take(1)</code>ã€‚</p><p id="894d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨ngOnInité’©å­ä¸­è°ƒç”¨<code class="fe ni nj nk nl b">joinRoom()</code>ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="3e30" class="nq mb ir nl b gz nr ns l nt nu">ngOnInit(): void {<br/>    this.roomId = this.activatedRoute.snapshot.paramMap.get('id');<br/>    <!-- -->this.initClient();<br/>    <strong class="nl is">this.joinRoom();</strong><br/>}</span></pre><p id="db19" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ­¤å¤–ï¼Œå¯¹äºæˆ‘ä»¬çš„ä¿±ä¹éƒ¨åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦æ˜¾ç¤ºåŠ å…¥çš„äººçš„åˆ—è¡¨ã€‚è®©æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªè§’åº¦æœåŠ¡ï¼Œå¹¶é€šè¿‡åœ°å€å°†åŠ å…¥çš„ç”¨æˆ·å­˜å‚¨åœ¨å®æ—¶æ•°æ®åº“ä¸­:<code class="fe ni nj nk nl b">online/${roomID}</code>ã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="cb4a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å°†æ­¤æœåŠ¡å¯¼å…¥ç»„ä»¶ï¼Œå¹¶åœ¨è®¾ç½®ç”¨æˆ·è§’è‰²åç«‹å³ä½¿ç”¨å®ƒ:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="e163" class="nq mb ir nl b gz nr ns l nt nu">private joinRoom(): void {<br/>...</span><span id="c419" class="nq mb ir nl b gz od ns l nt nu">  next: ([user, room]) =&gt; {<br/>     ...<br/>     this.client.setClientRole(this.isHost ? 'host' : 'audience');</span><span id="630e" class="nq mb ir nl b gz od ns l nt nu">     <strong class="nl is">this.presenceService<br/>       .setPresenceOnline(<br/>         {<br/>           displayName: randomNames[Math.floor(Math.random() * randomNames.length)],<br/>           key: this.user.uid<br/>         },<br/>         this.roomId<br/>       )<br/>      .pipe(take(1))<br/>      .subscribe();</strong><br/>  }<br/>}</span></pre><p id="1cc3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ç”¨äº†éšæœºçš„åå­—ã€‚æ ¹æ®éœ€è¦åœ¨æŸå¤„å®šä¹‰ä¸€ä¸ªæ•°ç»„ğŸ˜Šã€‚å½“ç„¶ï¼Œåœ¨çœŸæ­£çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ åº”è¯¥ä»æ³¨å†Œç”¨æˆ·æ¡£æ¡ˆä¸­å–åå­—ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="6269" class="nq mb ir nl b gz nr ns l nt nu">const randomNames = [<br/>  'Sheryl Edie',<br/>  'Dalton Kincade',<br/>  'Nathan Laber',<br/>  'Carola Wilmot'<br/>];</span></pre><p id="ed83" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç†è®ºä¸Šï¼Œç›®å‰ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥åœ¨UIä¸Šçœ‹åˆ°åœ¨çº¿åˆ—è¡¨ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹ä¸åˆ°ï¼Œå› ä¸ºæ¨¡æ¿ä»ç„¶æœ‰ä¸€äº›æœªå®ç°çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†å¾ˆå¿«å®æ–½æ‰€æœ‰è¿™äº›æªæ–½ã€‚</p><p id="853d" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åŠ å…¥è¿™ä¸ªæµéå¸¸ç®€å•ï¼Œä½†æ˜¯éœ€è¦é¢å¤–çš„åŠ¨ä½œã€‚æˆ‘ä»¬éœ€è¦åœ¨åç«¯ç”Ÿæˆä»¤ç‰Œã€‚è¿™ä¸ªä»¤ç‰Œå–å†³äºAgoraå‘ç»™ä½ çš„è¯ä¹¦ã€‚ä¸ºäº†éªŒè¯æ¦‚å¿µï¼Œå¯ä»¥åœ¨<a class="ae kw" href="https://console.agora.io/" rel="noopener ugc nofollow" target="_blank"> agoraç®¡ç†é¢æ¿</a>ä¸­ç›´æ¥ç”Ÿæˆä¸´æ—¶ä»¤ç‰Œã€‚ç‚¹å‡»ç¼–è¾‘æ‚¨çš„é¡¹ç›®å¹¶æ‰¾åˆ°æŒ‰é’®<code class="fe ni nj nk nl b">generate temp token</code>ã€‚é”®å…¥é€šé“åâ€œdemoâ€(æˆ–ä»»ä½•å…¶ä»–åç§°ï¼Œä½†å°†å…¶ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™<code class="fe ni nj nk nl b">client.join()</code>å‡½æ•°)å¹¶å¤åˆ¶ç”Ÿæˆçš„ä»¤ç‰Œã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="450a" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">è®¾ç½®ç”¨æˆ·è§’è‰²åè°ƒç”¨<code class="fe ni nj nk nl b">joinStream</code>å‡½æ•°ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="ac37" class="nq mb ir nl b gz nr ns l nt nu">private joinRoom(): void {<br/>...</span><span id="5381" class="nq mb ir nl b gz od ns l nt nu">next: ([user, room]) =&gt; {<br/>    ...<br/>    this.presenceService<br/>     .setPresenceOnline(...)<br/>     .pipe(take(1))<br/>     .subscribe();</span><span id="2946" class="nq mb ir nl b gz od ns l nt nu">    <strong class="nl is">this.</strong><strong class="nl is">joinStream();</strong><br/>  }<br/>}</span></pre><h2 id="9ea4" class="nq mb ir bd mc ok ol dn mg om on dp mk lg oo op mm lk oq or mo lo os ot mq ou bi translated">åˆ›å»ºå’Œå‘å¸ƒæœ¬åœ°æµ</h2><p id="a6fc" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ¿é—´ç»„ä»¶ä¸­å®šä¹‰ä¸€äº›å˜é‡ã€‚æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ä½¿ç”¨å®ƒä»¬ã€‚</p><figure class="kh ki kj kk gu kl"><div class="bz fq l di"><div class="og oh l"/></div></figure><p id="92a9" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä¹‹å‰æˆ‘ä»¬ä½¿ç”¨äº†<code class="fe ni nj nk nl b">this.createLocalStream();</code>åŠŸèƒ½ã€‚æˆ‘ä»¬éœ€è¦å®æ–½å®ƒã€‚è¯¥å‡½æ•°åªèƒ½ç”±ä¸»æœºè°ƒç”¨ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="b347" class="nq mb ir nl b gz nr ns l nt nu">private createLocalStream(): void {<br/>  this.localStream = AgoraRTC.createStream(this.streamOptions);<br/>  // Initialize the local stream<br/>  this.localStream.init(() =&gt; {<br/>    this.client.publish(this.localStream, this.handleError);<br/>  }, this.handleError);<br/>}</span></pre><p id="98ea" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å¯¹äºé”™è¯¯å¤„ç†ï¼Œè®©æˆ‘ä»¬åšä¸€äº›ç®€å•çš„äº‹æƒ…:</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="d8a7" class="nq mb ir nl b gz nr ns l nt nu">private handleError(<em class="oe">err</em>: any): void {<br/>  console.error(<em class="oe">err</em>);<br/>}</span></pre><p id="08f3" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å“‡å“¦ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæœ¬åœ°æµï¼Œç°åœ¨æˆ‘ä»¬å¼€å§‹ä¸ºåŠ å…¥è€…å¹¿æ’­å®ƒã€‚ä½†æ˜¯ç»†æœ¨å·¥æ€ä¹ˆå¬å¾—è¿›å»å‘¢ï¼Ÿåªå‰©å‡ æ­¥äº†ã€‚</p><h2 id="077e" class="nq mb ir bd mc ok ol dn mg om on dp mk lg oo op mm lk oq or mo lo os ot mq ou bi translated">è®¢é˜…è¿œç¨‹æµ</h2><p id="3b9a" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">æˆ‘ä»¬éœ€è¦æ”¶å¬æ¥è‡ªAgora SDKçš„äº‹ä»¶ã€‚å½“æµå¼€å§‹æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ ‡ç­¾ï¼ŒSDKå°†åœ¨é‚£é‡Œæ’­æ”¾æµã€‚å½“æµç»“æŸæ—¶â€”â€”æˆ‘ä»¬éœ€è¦ç§»é™¤é‚£ä¸ªæ ‡ç­¾ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="0150" class="nq mb ir nl b gz nr ns l nt nu">private addStream(elementId): void {<br/> // Creates a new div for every stream<br/> const streamDiv = document.createElement('div');<br/> streamDiv.id = elementId;<br/> this.streamContainer.nativeElement.appendChild(streamDiv);<br/>}</span><span id="4809" class="nq mb ir nl b gz od ns l nt nu">private removeStream(elementId: string): void {<br/> const remoteDiv = document.getElementById(elementId);<br/> if (remoteDiv) {<br/>  remoteDiv?.parentNode?.removeChild(remoteDiv);<br/> }<br/>}</span></pre><p id="ae0b" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ç°åœ¨æˆ‘ä»¬èƒ½å¤Ÿç›‘å¬äº‹ä»¶ã€‚</p><p id="9ffe" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ·»åŠ æµæ—¶â€”ä¸ºç”¨æˆ·è®¢é˜…ä»¥æ”¶å¬å®ƒã€‚<br/>è®¢é˜…å»ºç«‹æ—¶â€”åœ¨UIä¸Šæ’­æ”¾ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="a68a" class="nq mb ir nl b gz nr ns l nt nu">private subscribeToStreamStart(): void {<br/> this.client.on('stream-added', (evt) =&gt; {<br/>   if (!this.localStreams.includes(evt.stream.getId())) {<br/>     this.client.subscribe(evt.stream, null, this.handleError);<br/>   }<br/> });</span><span id="5222" class="nq mb ir nl b gz od ns l nt nu"> // Play the remote stream when it is subsribed<br/> this.client.on('stream-subscribed', (evt) =&gt; {<br/>  const stream = evt.stream;<br/>  const streamId = String(stream.getId());<br/>  this.addStream(streamId);<br/>  stream.play(streamId);<br/> });<br/>}</span></pre><p id="2d81" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">åœ¨ngOnInitä¸­è°ƒç”¨subscribeToStreamStart()å‡½æ•°ã€‚</p><h2 id="be77" class="nq mb ir bd mc ok ol dn mg om on dp mk lg oo op mm lk oq or mo lo os ot mq ou bi translated">ç¦»å¼€é¢‘é“</h2><p id="4e73" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">ä¸ºäº†å–æ¶ˆè®¢é˜…æµï¼Œæˆ‘ä»¬éœ€è¦åšå‡ ä¹ç›¸åŒçš„äº‹æƒ…ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="2d49" class="nq mb ir nl b gz nr ns l nt nu">private subscribeToStreamStop(): void {<br/>    // Remove the corresponding view when a remote user unpublishes.<br/>    this.client.on('stream-removed', (evt) =&gt; {<br/>      const stream = evt.stream;<br/>      const streamId = String(stream.getId());<br/>      stream.close();<br/>      this.removeStream(streamId);<br/>    });<br/>    // Remove the corresponding view when a remote user leaves the channel.<br/>    this.client.on('peer-leave', (evt) =&gt; {<br/>      const stream = (evt as any).stream;<br/>      const streamId = String(stream.getId());<br/>      stream.close();<br/>      this.removeStream(streamId);<br/>    });<br/>  }</span></pre><p id="4e63" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æˆ‘ä»¬éœ€è¦åšçš„æœ€åä¸€ä»¶äº‹æ˜¯æ·»åŠ ç¦»å¼€ç©ºé—´åŠŸèƒ½ï¼Œå¹¶åœ¨ç»„ä»¶é”€æ¯æ—¶æ¸…é™¤æ‰€æœ‰å†…å®¹ã€‚</p><pre class="kh ki kj kk gu nm nl nn no aw np bi"><span id="4203" class="nq mb ir nl b gz nr ns l nt nu">ngOnDestroy(): void {<br/>  this.presenceService.setPresenceOffline(<br/>  { key: this.user.uid },<br/>    this.roomId<br/>  );<br/>  this.client.leave();<br/>}</span><span id="849d" class="nq mb ir nl b gz od ns l nt nu">public leaveRoom(): void {<br/>  if (this.localStream) {<br/>    this.localStream.stop();<br/>    this.localStream.close();<br/>  }<br/>  this.route.navigate(['/rooms']);<br/>}</span></pre><p id="6c4c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">æ­å–œä½ ï¼æˆ‘ä»¬å®Œäº†ï¼</p><p id="deb0" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">å®Œæ•´çš„åº”ç”¨ç¤ºä¾‹å¯åœ¨<a class="ae kw" href="https://github.com/Golosay/clubhouse-tutorial" rel="noopener ugc nofollow" target="_blank"> Github </a>ä¸Šè·å¾—ã€‚</p><h1 id="c74e" class="ma mb ir bd mc md me mf mg mh mi mj mk jx ml jy mm ka mn kb mo kd mp ke mq mr bi translated">ç»“è®º</h1><p id="90a5" class="pw-post-body-paragraph kx ky ir kz b la mu js lc ld mv jv lf lg nz li lj lk oa lm ln lo ob lq lr ls ik bi translated">æœ¬æ–‡ä¸­çš„ä»£ç ä»…ç”¨äºæ•™ç¨‹ç›®çš„ï¼Œå¹¶ä¸é€‚åˆç”Ÿäº§ï¼Œä½†è¶³ä»¥äº†è§£å¦‚ä½•å®ç°ä¸€å¯¹å¤šæµåª’ä½“åº”ç”¨ç¨‹åºã€‚</p><p id="c7c6" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">ä½ å¯ä»¥åœ¨Mediumä¸Šå…³æ³¨æˆ‘çš„æ›´å¤šç§‘æŠ€æ–‡ç« ï¼Œä¹Ÿå¯ä»¥åœ¨<a class="ae kw" href="https://twitter.com/golosay" rel="noopener ugc nofollow" target="_blank"> Twitter </a>ä¸Šæ‰¾åˆ°æˆ‘ã€‚</p></div></div>    
</body>
</html>