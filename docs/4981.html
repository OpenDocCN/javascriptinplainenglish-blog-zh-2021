<html>
<head>
<title>Make Get Request with Header to Render Image in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native中生成带有标题的Get请求以呈现图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/react-native-making-get-request-to-display-the-image-f75d4338c5e2?source=collection_archive---------6-----------------------#2021-10-08">https://javascript.plainenglish.io/react-native-making-get-request-to-display-the-image-f75d4338c5e2?source=collection_archive---------6-----------------------#2021-10-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="da26" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">React本地移动开发人员经常会有这样的需求，即必须通过发出get请求来完成图像渲染，该请求包含一些标头以提供额外的安全性。</p></div><div class="ab cl ki kj hr kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ig ih ii ij ik"><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/d9f45e19172b1772b9d6b43a789be29a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Uu2AwDfGNk-MrNCCl2WMA.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Soure — <a class="ae lf" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/</a></figcaption></figure><p id="b7ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">React native提供了通过网络调用渲染图像的灵活性，下面是解释它的最简单的代码片段。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="a226" class="ll lm in lh b gy ln lo l lp lq">&lt;Image  <br/>source={{    <br/>uri: 'https://reactjs.org/logo-og.png',<br/>method: 'POST',<br/>headers: <br/>{<br/>Pragma: 'no-cache'<br/>},<br/>body: 'Your Body goes here'  <br/>}} <br/>style={{ width: 400, height: 400 }}/&gt;</span></pre><p id="bc1e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您有任何自定义标头，如auth token、userId等，则在标头部分传递它，如果需要，您可以将请求类型更改为GET(如下所示)。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="dc66" class="ll lm in lh b gy ln lo l lp lq">&lt;Image  <br/>source={{    <br/>uri: 'https://reactjs.org/logo-og.png',<br/>method: 'GET',<br/>headers: <br/>{<br/>auth: 'YOUR_TOKEN_GOES_HERE',<br/>userId : 'YOUR USER ID GOES HERE'<br/>},<br/>body: 'Your Body goes here'  <br/>}} <br/>style={{ width: 400, height: 400 }}/&gt;</span></pre><p id="f0f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是上面的代码看起来有点乱，如果你在一个容器组件中有多个图像标签，那么你的代码行数会因此而增加。我们可以通过创建实用方法来优化它，以获得标题和正文。(如下图所示)。</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="9594" class="ll lm in lh b gy ln lo l lp lq">&lt;Image  <br/>source={{    <br/>uri: 'https://reactjs.org/logo-og.png',<br/>method: 'GET',<br/>headers: yourUtitlityClass.getHeaders(),<br/>body: yourUtitlityClass.getBody()<br/>}} <br/>style={{ width: 400, height: 400 }}/&gt;</span></pre><p id="d0e2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在有另一个场景，更大尺寸的图像可能需要时间来加载，在这种情况下，我们需要显示一个加载器，直到图像被加载。但是如何知道图像何时开始下载，何时完成加载？为了解决这个问题，Image标签公开了接受函数的<strong class="jm io"> onLoadStart </strong>和<strong class="jm io"> onLoadEnd </strong> prop。我们可以用它来显示loader，直到图像被加载。下面的片段解释了它，</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="1545" class="ll lm in lh b gy ln lo l lp lq">...<br/>const [showImageLoader, setShowImageLoader] = useState(true);<br/>...</span><span id="ab17" class="ll lm in lh b gy lr lo l lp lq">&lt;View &gt;<br/>  &lt;Image  <br/>   source={{    <br/>   uri: 'https://reactjs.org/logo-og.png',<br/>   method: 'GET',<br/>   headers: yourUtitlityClass.getHeaders(),<br/>   body: yourUtitlityClass.getBody()<br/>   }} <br/>   style={{ width: 400, height: 400 }}<br/>   onLoadStart={() =&gt; setShowImageLoader(true)}<br/>   onLoadEnd={() =&gt; setShowImageLoader(false)}<br/>/&gt;</span><span id="353d" class="ll lm in lh b gy lr lo l lp lq">{showImageLoader &amp;&amp; &lt;Spinner small /&gt;}</span><span id="9957" class="ll lm in lh b gy lr lo l lp lq">&lt;/View&gt;</span></pre><p id="5c8d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在只有优秀程序员才会意识到这一点，如果API调用失败了怎么办？？由于网络问题或服务器停机，如何处理这种情况？在这种情况下，上面的代码片段将永远显示加载程序。为了避免图像标记，还会给出一个适当错误，该错误可用于处理API故障。下面的片段(最后一个)包含它。(您可以扩展这个示例，以便在API失败时显示一些错误UI。)</p><pre class="kq kr ks kt gt lg lh li lj aw lk bi"><span id="42b8" class="ll lm in lh b gy ln lo l lp lq">...<br/>const [showImageLoader, setShowImageLoader] = useState(true);<br/>...</span><span id="5126" class="ll lm in lh b gy lr lo l lp lq">&lt;View &gt;<br/>  &lt;Image  <br/>   source={{    <br/>   uri: 'https://reactjs.org/logo-og.png',<br/>   method: 'GET',<br/>   headers: yourUtitlityClass.getHeaders(),<br/>   body: yourUtitlityClass.getBody()<br/>   }} <br/>   style={{ width: 400, height: 400 }}<br/>   onLoadStart={() =&gt; setShowImageLoader(true)}<br/>   onLoadEnd={() =&gt; setShowImageLoader(false)}<br/>   onError={() =&gt; setShowImageLoader(false)}<br/>/&gt;</span><span id="adb3" class="ll lm in lh b gy lr lo l lp lq">{showImageLoader &amp;&amp; &lt;Spinner small /&gt;}</span><span id="b106" class="ll lm in lh b gy lr lo l lp lq">&lt;/View&gt;</span></pre><p id="7763" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">参考react本地官方<a class="ae lf" href="https://reactnative.dev/docs/images#network-requests-for-images" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于图像标签的信息。</p><p id="ba04" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">同一作者的更多文章:</strong></p><ol class=""><li id="1208" class="ls lt in jm b jn jo jr js jv lu jz lv kd lw kh lx ly lz ma bi translated"><a class="ae lf" href="https://mevasanth.medium.com/how-everything-is-object-in-javascript-a4164d7e6a2d" rel="noopener">JavaScript中的一切都是对象吗？</a></li><li id="6367" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae lf" rel="noopener ugc nofollow" target="_blank" href="/problem-with-returning-values-from-async-await-function-javascript-e99c94a47ca5">异步Await函数返回值的问题</a></li><li id="ffe6" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae lf" href="https://mevasanth.medium.com/hoisting-in-javascript-hot-topic-for-interview-43b463a6a77?source=follow_footer---------0----------------------------" rel="noopener">JavaScript中的提升:访谈热点</a></li><li id="e79d" class="ls lt in jm b jn mb jr mc jv md jz me kd mf kh lx ly lz ma bi translated"><a class="ae lf" href="https://mevasanth.medium.com/memoization-in-javascript-hot-topic-for-interview-815475544ab0" rel="noopener">JavaScript中的记忆化——采访热门话题</a></li></ol><p id="bae6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这里阅读作者<a class="ae lf" href="https://mevasanth.medium.com/" rel="noopener">的所有文章。</a></p></div></div>    
</body>
</html>