# Node.js |æ£€æŸ¥ Apollo.js æœåŠ¡å™¨

> åŸæ–‡ï¼š<https://javascript.plainenglish.io/node-js-inspecting-an-apollo-js-server-7e0b1e86b401?source=collection_archive---------17----------------------->

![](img/4dd7a0ba5de7c008681f95c8ecfa8d81.png)

Photo by [Raoul Droog](https://unsplash.com/@raouldroog?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

è¦ç»§ç»­æ“ä½œï¼Œè¿è¡Œæœ¬æ–‡æœ«å°¾çš„æ–‡ä»¶ï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè½¬åˆ°æœåŠ¡å™¨æ³¨é”€çš„ URLã€‚GraphQL playground å°†è‡ªåŠ¨æä¾›ç»™ä½ çš„æµè§ˆå™¨ã€‚

åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ ApolloServer æ„é€ å‡½æ•°å®ä¾‹åŒ–äº†ä¸€ä¸ª Apollo.js æœåŠ¡å™¨ã€‚æ„é€ å‡½æ•°å°†é€‰é¡¹å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç”¨äºé…ç½®æœåŠ¡å™¨ã€‚è¯·å‚è€ƒä»¥ä¸‹é“¾æ¥ï¼ŒæŸ¥çœ‹æ‰€æœ‰å¯èƒ½çš„é€‰é¡¹å’Œé…ç½®ã€‚

API å‚è€ƒ:
[https://www . apollographql . com/docs/Apollo-server/API/Apollo-server/](https://www.apollographql.com/docs/apollo-server/api/apollo-server/)

```
const { ApolloServer, gql } = require(`apollo-server`);const mockData = `qux`;new ApolloServer({
  typeDefs,
  resolvers,
  context({ req, res }) {
    return { mockData, req, res };
  },
})
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªå…³å¿ƒä¸‰ä¸ªé€‰é¡¹:typeDefsã€resolvers å’Œ contextã€‚TypeDefs è¡¨ç¤ºæœåŠ¡å™¨çš„ GraphQL æ¨¡å¼ã€‚è§£æå™¨æ˜¯æ˜ å°„åˆ°æ¨¡å¼çš„å‡½æ•°ã€‚å“åº”ç”±è§£æå™¨çš„è§£æå™¨å‡½æ•°ç”Ÿæˆï¼Œè¿™äº›å‡½æ•°æŒ‰ç…§ typeDefs å®šä¹‰çš„é¡ºåºæ‰§è¡Œã€‚

Context è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä½œä¸ºå˜é‡ä¼ é€’ç»™æ¯ä¸ªè§£æå™¨å‡½æ•°çš„ context å‚æ•°ã€‚

æˆ‘ä»¬ä½¿ç”¨æ¨¡å¼å®šä¹‰è¯­è¨€æ¥åˆ›å»ºæˆ‘ä»¬çš„ç±»å‹å®šä¹‰ã€‚å½“æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªä¾›æœåŠ¡å™¨éµå¾ªçš„æ˜ å°„ã€‚è¯¥æ˜ å°„å¯¼è‡´ä¸€ç³»åˆ—è§£æå™¨åŠŸèƒ½æ‰§è¡Œã€‚

æœ‰ä¸‰ç§ç‰¹æ®Šçš„ç±»å‹ï¼Œå®ƒä»¬ä¹Ÿæ˜¯å¯¹åº”äºä¸‰ç§å¯èƒ½çš„å®¢æˆ·ç«¯æ“ä½œçš„å…¥å£ç‚¹:æŸ¥è¯¢ã€å˜å¼‚å’Œè®¢é˜…ã€‚ä½ å¯ä»¥æŠŠè¿™äº›ç±»å‹çœ‹ä½œæ—…ç¨‹çš„å¼€å§‹ã€‚å’Œå®ƒä»¬çš„å­å¯¹è±¡ä½œä¸ºæ—…ç¨‹çš„ä¸‹ä¸€æ­¥ã€‚

æ¨¡å¼å®šä¹‰è¯­è¨€æœ‰ä¸¤ç§ç±»å‹:åŸºæœ¬ç±»å‹å’Œå¯¹è±¡ç±»å‹ã€‚åŸºæœ¬ç±»å‹è¡¨ç¤ºå•ä¸ªå€¼ï¼Œè€Œå¯¹è±¡ç±»å‹æ˜¯å…·æœ‰å­—æ®µçš„ç±»å‹ã€‚åµŒå¥—çš„å¯¹è±¡ç±»å‹è¡¨ç¤ºå­å¯¹è±¡å’Œçˆ¶å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚çˆ¶é¡¹çš„è§£æå‡½æ•°æ€»æ˜¯åœ¨å­é¡¹çš„è§£æå‡½æ•°ä¹‹å‰æ‰§è¡Œï¼Œä¾æ­¤ç±»æ¨ã€‚åµŒå¥—æœ€å¤šçš„å¯¹è±¡ç±»å‹å°†å¯¹åº”äºæœ€åä¸€æ¬¡æ‰§è¡Œçš„è§£æå™¨å‡½æ•°ã€‚

åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒQuery æ˜¯å…¥å£ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é¢„æœŸæŸ¥è¯¢è§£æå™¨å¯¹è±¡æœ‰ä¸¤ä¸ªå‡½æ•° bar å’Œ fooã€‚foo çš„è§£æå‡½æ•°è¿”å› baz çš„çˆ¶å¯¹è±¡ï¼Œfoo æ²¡æœ‰çˆ¶å¯¹è±¡ã€‚foo æŸ¥è¯¢çš„è§£æå™¨æ‰§è¡Œå°†é€šè¿‡åœ¨æŸ¥è¯¢å¯¹è±¡ä¸Šæœç´¢ä¸ foo åŒ¹é…çš„å±æ€§å¼€å§‹ï¼Œå¦‚æœæŸ¥è¯¢è¦æ±‚ baz å±æ€§ï¼Œåˆ™ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„è§£æå™¨å‡½æ•°å°†åœ¨åä¸º Foo çš„å¯¹è±¡ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸”è¯¥å‡½æ•°å°†å­˜åœ¨äºåä¸º baz çš„å±æ€§ä¸Šã€‚æ ¹æ® baz çš„ç±»å‹å®šä¹‰ï¼Œbazï¼ŒBaz å‡½æ•°å°†è¿”å›ä¸€ä¸ªå…·æœ‰åä¸º qux çš„å•ä¸ªå±æ€§çš„å¯¹è±¡ï¼Œè¯¥å±æ€§ä¿å­˜ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ã€‚

```
const typeDefs = gql`
type Query {
  bar: String!
  foo(id: Int!): Foo!
}type Foo {
  id: Int!
  baz: Baz!
}type Baz {
  qux: String
}
`;// The Resolver Object:const resolvers = {
 Query: {
   foo: (parent, args, context, info) => {
     return { id: args.id };
   },
   bar: () => `bar`,
 },
 Foo: {
   baz: (parent, args, context, info) => {
     return { qux: context.mockData };
   },
 },
};
```

è§£æå™¨å¯¹è±¡æ˜¯å¯¹è±¡çš„é›†åˆã€‚æ¯ä¸ªé¡¶çº§å¯¹è±¡å¯¹åº”äºä¸€ä¸ªæ“ä½œç±»å‹æˆ–ä¸€ä¸ªå¯¹è±¡ç±»å‹ã€‚

ä¸‹é¢çš„ä»£ç è¡¨ç¤ºæŸ¥è¯¢ç±»å‹çš„å®¢æˆ·ç«¯æ“ä½œã€‚

åœ¨ GraphQL playground ä¸­è¿è¡Œè¿™ä¸ªæŸ¥è¯¢ã€‚

```
query {
  bar
}
```

ä¸å®¢æˆ·ç«¯æ“ä½œåŒ¹é…çš„æ“ä½œç±»å‹çš„åç§°å°†æ˜¯æœåŠ¡å™¨åœ¨è§£æå™¨å¯¹è±¡ä¸ŠæŸ¥æ‰¾è§£æå™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªä½ç½®ã€‚æ¥ä¸‹æ¥ï¼Œå®ƒå°†æŸ¥çœ‹å®¢æˆ·ç«¯æ“ä½œçš„æœ€é¡¶å±‚å­—æ®µ barï¼Œå¹¶ä½¿ç”¨è¯¥åç§° bar æ¥æŸ¥æ‰¾è§£æå™¨ã€‚

ä¸€æ—¦è§£æå™¨ bar è¢«æ‰§è¡Œå¹¶ä¸”è§£æå™¨è¿”å›äº†è¿”å›å€¼â€˜bar â€™,æœåŠ¡å™¨å°†å‘é€å›ä¸‹é¢çš„ JSON æœ‰æ•ˆè´Ÿè½½ã€‚

```
{
  â€œdataâ€: {
    â€œbarâ€: â€œbarâ€
  }
}
```

ç”¨äºæŸ¥è¯¢å’Œ Foo çš„æ¨¡å¼å®šä¹‰è¯­è¨€(SDL ):

```
type Query {
  bar: String!
  foo(id: Int!): Foo!
}type Foo {
  id: Int!
  baz: Baz!
}
```

åœ¨ GraphQL Playground ä¸­è¿è¡Œä¸‹é¢çš„æŸ¥è¯¢ã€‚

foo çš„æŸ¥è¯¢ç±»å‹çš„å®¢æˆ·ç«¯æ“ä½œ:

```
query {
  foo(id: 1) {
    id
    baz {
      qux
    }
  }
}
```

çœ‹çœ‹ Query çš„ç±»å‹å®šä¹‰ï¼Œfoo å­—æ®µéœ€è¦ä¸€ä¸ªå‚æ•°ã€‚æˆ‘ä»¬é€šè¿‡å‘ä¸Šé¢ä»£ç ä¸­æ‹¬å·å†…çš„ id å­—æ®µä¼ é€’ä¸€ä¸ªæ•´æ•°å‚æ•°æ¥æŸ¥è¯¢ fooã€‚

ç±»å‹æŸ¥è¯¢ä¸­ foo å­—æ®µçš„å®šä¹‰ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ç¦ï¼æ„Ÿå¹å·æ„å‘³ç€å®ƒæ˜¯ä¸€ä¸ªå¿…éœ€çš„è¿”å›å€¼ï¼Œå› æ­¤åœ¨ resolver å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å†æ¬¡éå†ï¼Œé¦–å…ˆæ˜¯æ“ä½œåæŸ¥è¯¢å¯¹è±¡ï¼Œç„¶åæ˜¯åä¸º foo çš„å±æ€§ï¼Œä»¥æ‰¾åˆ°è§£æå™¨ã€‚

foo å±æ€§è§£æå™¨å‡½æ•°é€šè¿‡è®¿é—® foo è§£æå™¨å‡½æ•°çš„ args å‚æ•°ï¼Œå°†ä½œä¸ºå‚æ•°ä¼ é€’çš„ id ä½œä¸ºå“åº”çš„å€¼è¿”å›ã€‚æœåŠ¡å™¨ä»ç„¶æ²¡æœ‰æ‰¾åˆ°å¯¹è±¡ç±»å‹ä¸º baz çš„ç±»å‹ä¸º Fooï¼ŒBaz çš„ç¬¬äºŒä¸ªæ•°æ®å­—æ®µã€‚æ£€ç´¢ baz å­—æ®µï¼Œå¹¶ä¼ é€’ Baz ç±»å‹çš„æ•°æ®ã€‚æœåŠ¡å™¨åœ¨è§£æå™¨å¯¹è±¡çš„æœ€é¡¶ç«¯å­—æ®µä¸­æŸ¥æ‰¾çˆ¶å¯¹è±¡çš„åç§°ã€‚

åœ¨è¿™é‡Œï¼ŒæœåŠ¡å™¨æ‰¾åˆ°ä¸ Foo ç±»å‹åŒ¹é…çš„ Foo å±æ€§ã€‚æœåŠ¡å™¨è¯†åˆ«å‡º Foo å¯¹è±¡æŒæœ‰å¯¹åº”äº Foo ç±»å‹å±æ€§ä¸Šçš„å¯¹è±¡ç±»å‹çš„è§£æå™¨ã€‚æœåŠ¡å™¨åœ¨ Foo å¯¹è±¡ä¸Šæ‰¾åˆ° baz è§£æå™¨ï¼Œå¹¶æ‰§è¡Œè¯¥å‡½æ•°ã€‚baz è§£æå™¨åˆ°è¾¾ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œä¸º qux è¿”å›ä»»æ„æ¨¡æ‹Ÿæ•°æ®ã€‚

```
const resolvers = {
  Query: {
    foo: (parent, args, context, info) => {
      return { id: args.id };
    },
    bar: () => `bar`,
  },
  Foo: {
   baz: (parent, args, context, info) => {
     return { qux: context.mockData };
   },
  },
};
```

ç„¶åï¼ŒApollo Server å°†èšåˆæ•°æ®ï¼Œå¹¶å°†è¿™ä¸ª JSON æœ‰æ•ˆè´Ÿè½½å‘é€å›å®¢æˆ·æœº:

```
{
  â€œdataâ€: {
    â€œfooâ€: {
      â€œidâ€: 1,
      â€œbazâ€: {
        â€œquxâ€: â€œquxâ€
      }
    }
  }
}
```

åœ¨æœåŠ¡å™¨å®ä¾‹åŒ–æœŸé—´ï¼Œä½¿ç”¨ context é€‰é¡¹å°† mockData ä¼ é€’ç»™ ApolloServerã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

ä¸Šä¸‹æ–‡é€‰é¡¹æ˜¾ç¤ºä¸ºä¼ é€’ç»™æ¯ä¸ªè§£æå™¨å‡½æ•°çš„ä¸Šä¸‹æ–‡å‚æ•°çš„å¯¹è±¡å±æ€§ã€‚ä¸Šä¸‹æ–‡å¯¹è±¡è¿˜å¯ä»¥ç”¨äºä¸ reqã€res ç­‰å¯¹è±¡è¿›è¡Œäº¤äº’ï¼Œè¿™äº›å¯¹è±¡å¯¹åº”äºåº•å±‚çš„ HTTP è¯·æ±‚å“åº”å¯¹è±¡ã€‚

```
const { ApolloServer, gql } = require(`apollo-server`);const mockData = `qux`;new ApolloServer({
 typeDefs,
 resolvers,
 context({ req, res }) {
   return { mockData, req, res };
 },
})
```

æœ‰å…³è§£æå™¨å‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»æ­¤[é“¾æ¥](https://www.apollographql.com/docs/apollo-server/data/resolvers/#resolver-arguments)ã€‚

æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨çš„ä¸¤ä¸ªå‚æ•°æ˜¯ info å’Œ parent å‚æ•°ã€‚çˆ¶å‚æ•°æ˜¯ä¿å­˜çˆ¶è§£æå™¨çš„è¿”å›å€¼çš„åœ°æ–¹ã€‚å®ƒä¸éœ€è¦ç”¨åœ¨å­èŠ‚ç‚¹çš„è¿”å›å€¼ä¸­ã€‚å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„è¿”å›å€¼å°†è¢«è‡ªåŠ¨èšåˆåˆ°ä¸€ä¸ªåŒ¹é…ç›¸åº”å­—æ®µçš„ JSON æœ‰æ•ˆè´Ÿè½½å“åº”ä¸­ã€‚çˆ¶å¯¹è±¡å¯ç”¨äºå…¶ä»–ç›®çš„ï¼Œä¾‹å¦‚æ„å»ºæ•°æ®åº“æŸ¥è¯¢ã€‚å‘ info å‚æ•°ä¼ é€’ä¸€ä¸ªè¡¨ç¤ºæ‰§è¡ŒçŠ¶æ€çš„å‚æ•°ï¼Œè¯¥å‚æ•°æè¿°äº†å½“å‰çš„è§£æå™¨æ‰§è¡Œä»¥åŠä¹‹å‰å’Œå³å°†æ‰§è¡Œçš„è§£æå™¨æ‰§è¡Œã€‚

æœåŠ¡å™¨çš„å®Œæ•´ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

æŒ‰é¡ºåºè¿è¡Œä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ã€‚

```
npm init -y
npm i -S apollo-server graphql
```

ğŸ‘‡ğŸ»(è¿è¡Œè¯¥æ–‡ä»¶)

`node server.js`

server.jsğŸ‘‡ğŸ»

```
const { ApolloServer, gql } = require(`apollo-server`);const typeDefs = gql`
 type Query {
 bar: String!
 foo(id: Int!): Foo!
 }type Foo {
 id: Int!
 baz: Baz!
 }type Baz {
 qux: String
 }
`;const mockData = `qux`;const resolvers = {
  Query: {
    foo: (parent, args, context, info) => {
      return { id: args.id };
    },
    bar: () => `bar`,
  },
  Foo: {
    baz: (parent, args, context, info) => {
      return { qux: context.mockData };
    },
  },
};new ApolloServer({
  typeDefs,
  resolvers,
  context({ req, res }) {
    return { mockData, req, res };
  },
})
.listen()
.then(({ url }) => console.log(url));
```

è°¢è°¢ï¼

*æ›´å¤šå†…å®¹çœ‹*[*plain English . io*](http://plainenglish.io/)