<html>
<head>
<title>Creating Dynamic Discord Bots with JavaScript ES6 and Realm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用JavaScript ES6和Realm创建动态不和谐机器人</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-dynamic-discord-bots-with-javascript-es6-and-realm-fa51dea5af21?source=collection_archive---------10-----------------------#2021-04-20">https://javascript.plainenglish.io/creating-dynamic-discord-bots-with-javascript-es6-and-realm-fa51dea5af21?source=collection_archive---------10-----------------------#2021-04-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fcb4820fd8fd919b646fb02782a3cec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a9dDiQq3joypsKR3"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@alexbemore?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alexander Shatov</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ccc0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在疫情期间，Discord的用户群大幅增加。虽然许多服务器都有通用的bot，但是编写自己的bot才是服务器真正的改变点。</p><p id="611e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Discord机器人是非常方便的工具，让用户在Discord上的生活变得更加容易和愉快。虽然周围有许多像<a class="ae jz" href="https://yagpdb.xyz" rel="noopener ugc nofollow" target="_blank"> YAG </a>、<a class="ae jz" href="https://mee6.xyz" rel="noopener ugc nofollow" target="_blank"> MEE6 </a>等伟大的机器人，但从<strong class="kc io">开始写自己的</strong>有许多<strong class="kc io">好处</strong>。所以我们来探讨一下如何在<strong class="kc io"> JavaScript </strong>中创建一个Discord bot。</p><h1 id="eb95" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">项目</h1><h2 id="f1bc" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">描述</h2><p id="e997" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">我们将创建一个简单的Discord bot，允许您将消息输入日志，其他用户可以阅读。</p><p id="93a2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，用户将能够运行<strong class="kc io">命令</strong> <em class="mn">！记录</em>消息。为了获得所有的日志，<em class="mn">！使用日志</em>命令。这也会清除所有以前的日志。</p><blockquote class="mo mp mq"><p id="9845" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated"><strong class="kc io">命令</strong>是特定的消息<strong class="kc io">意为</strong>对于不和谐<strong class="kc io">机器人</strong>。机器人<strong class="kc io">解析</strong>该消息，并从中获取<strong class="kc io">参数</strong>。它们遵循一个定制的<strong class="kc io">模式</strong>，由机器人程序员自由决定。</p></blockquote><h2 id="92f5" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">创建机器人</h2><p id="9d5f" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">你要做的第<strong class="kc io">件事就是创建你的不和谐机器人。为此，请前往<a class="ae jz" href="https://discord.com/developers/applications" rel="noopener ugc nofollow" target="_blank"> Discord开发者</a>并创建一个新的<strong class="kc io">应用</strong>。您可以在下图中看到该按钮的外观。</strong></p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/8b0322c0596a2ca0797210c50d4e18ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*4XG1nZgY0_ER4I3Jql6SOg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Clicking this creates your awesome discord application</figcaption></figure><p id="7741" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当你完成这些后，移动到你的应用程序的“<strong class="kc io"> Bot </strong>”部分。再次，见下面的图片附上供参考。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/e1241cad4ba765415673de0de704ce07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*Ta7UDnq7KiNjdj_F7TnWzg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The Bot Section found in the most left menu</figcaption></figure><p id="6cd8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你想点击“添加机器人”并继续。你将会被<strong class="kc io">提示</strong>机器人不能被删除。<strong class="kc io">确认</strong>并继续前进。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d32432b39c503d61d176c3f8b2e5d696.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*H5Ywt7k_A230tRbjn9J1Bw.png"/></div></figure><p id="da10" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是时候复制<strong class="kc io">机器人令牌</strong>了。这个文本序列被你的机器人用来登录。<strong class="kc io">千万不要</strong>让任何人知道这个令牌。否则，入侵者可以代表你做机器人能够做的任何事情。点击“复制”进行复制。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/1bbfa12d0eba425bde68a6f0478ab098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yA1MSklzV7Gj33XKxrpF5g.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Our unique token</figcaption></figure><p id="6525" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后但同样重要的一点是，请前往您的应用程序的“OAuth2”部分。</p><p id="3081" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在“S <strong class="kc io"> copes </strong>下选择“<strong class="kc io"> bot </strong>”。一个新的“Bot权限”窗口将出现在Scopes下方。从那里选择<strong class="kc io">需要的</strong>权限。首先，选择administrator是没问题的，但是您可能<strong class="kc io">而不是</strong>稍后需要它。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/9c11e0b0dee7af88d9e59977c32b7b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9_uoL7zq-W71FJzCIFoiw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The bot has administrator rights</figcaption></figure><p id="0e84" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，您已经完成了bot应用程序的配置。要邀请它加入您的服务器，请访问“<strong class="kc io"> Scopes </strong>”下显示的链接。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="aab1" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">Bot项目</h2><p id="b6ff" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">打开您选择的<strong class="kc io">终端</strong>，输入:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="65d2" class="lw kz in nk b gy no np l nq nr">npm init</span></pre><p id="dfbb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">根据你的喜好调整所有设置。如果你之前<strong class="kc io">没有</strong>用过Node.js，我<strong class="kc io">推荐</strong>先读<a class="ae jz" href="https://nodejs.dev/learn/how-to-install-nodejs" rel="noopener ugc nofollow" target="_blank">安装Node.js </a>。</p><p id="8c1b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，安装<a class="ae jz" href="https://discord.js.org/?source=post_page---------------------------#/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> discord.js </strong> </a>和<a class="ae jz" href="https://github.com/realm/realm-js" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">领域</strong> </a>，输入:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="a59b" class="lw kz in nk b gy no np l nq nr">npm install discord.js realm esm</span></pre><p id="9882" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">打开您的<strong class="kc io"> package.json </strong>文件，编辑启动脚本，如下所示:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="3b46" class="lw kz in nk b gy no np l nq nr">“scripts”: {</span><span id="810e" class="lw kz in nk b gy ns np l nq nr">“start”: “node -r esm index.js”</span><span id="8c12" class="lw kz in nk b gy ns np l nq nr">}</span></pre><blockquote class="mo mp mq"><p id="65d6" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated">ESM是一个几乎即插即用的模块，允许你立即运行ES6 JS，而不需要Babel或任何其他transpiler。你可以在这里阅读更多相关信息。</p></blockquote><p id="8053" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在创建并打开您的<strong class="kc io"> index.js </strong>文件(或者您在上面输入的内容)。</p><h2 id="dab0" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">陷入不和</h2><p id="64af" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">在文件的开头，包含discord.js和Realm:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="3369" class="lw kz in nk b gy no np l nq nr">import Discord from ‘discord.js’</span><span id="a31d" class="lw kz in nk b gy ns np l nq nr">import Realm, { Results } from ‘realm’</span></pre><p id="a537" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">完成后，创建真正的<a class="ae jz" href="https://discord.js.org/?source=post_page---------------------------#/docs/main/stable/class/Client" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">客户端</strong> </a>，它负责与您的服务器交互。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="6859" class="lw kz in nk b gy no np l nq nr">let client = new Discord.Client()</span></pre><p id="8c72" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在某些情况下，你可能希望允许<strong class="kc io">意图</strong>。这些可以在你的<strong class="kc io"> Bot应用面板</strong>中配置。关于它们的信息也在那里给出。此时，你很可能不再需要它们了。</p><p id="85e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了让机器人对几乎任何事情做出反应，我们需要绑定discord.js <strong class="kc io">事件监听器</strong>。discord.js模块公开了许多我们可以绑定机器人的<strong class="kc io">事件</strong>。最重要的如下:</p><ul class=""><li id="dadf" class="nt nu in kc b kd ke kh ki kl nv kp nw kt nx kx ny nz oa ob bi translated"><strong class="kc io">消息</strong> : <strong class="kc io"> </strong>当连接的服务器收到消息时触发。消息事件只保存一个参数，即<a class="ae jz" href="https://discord.js.org/?source=post_page---------------------------#/docs/main/stable/class/Message" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">消息</strong> </a>对象</li><li id="b7fa" class="nt nu in kc b kd oc kh od kl oe kp of kt og kx ny nz oa ob bi translated"><strong class="kc io"> messageReactionAdd </strong>:收到反应时触发。该事件持有<a class="ae jz" href="https://discord.js.org/?source=post_page---------------------------#/docs/main/stable/class/MessageReaction" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">反应</strong> </a>，以及反应<a class="ae jz" href="https://discord.js.org/?source=post_page---------------------------#/docs/main/stable/class/User" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">用户</strong> </a></li></ul><blockquote class="mo mp mq"><p id="23bb" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated">你可以在这里阅读更多关于discord.js事件<a class="ae jz" href="https://discordjs.guide/event-handling/" rel="noopener ugc nofollow" target="_blank">。这里的</a>列出了可用的赛事。</p></blockquote><p id="ba1e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">对于这个项目，只有消息事件是相关的。</p><p id="0c8a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了<strong class="kc io">将我们的监听器</strong>绑定到消息事件，我们调用客户端的方法上的<strong class="kc io">,它充当接受一个方法的<strong class="kc io">事件处理程序</strong>。</strong></p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="962b" class="lw kz in nk b gy no np l nq nr">client.on(‘message’ , (msg) =&gt; {</span><span id="ee17" class="lw kz in nk b gy ns np l nq nr">    (…)</span><span id="f460" class="lw kz in nk b gy ns np l nq nr">})</span></pre><p id="66f3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每当机器人收到消息时，这个事件就会被调用。</p><h2 id="4c10" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">解析命令</h2><p id="dbcc" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">为了监听<strong class="kc io">命令</strong>，我们需要检查我们的消息是否有自定义的<strong class="kc io">前缀</strong>。</p><p id="a275" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为此，我们可以利用字符串函数<a class="ae jz" href="https://www.w3schools.com/jsref/jsref_startswith.asp" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mn">starts with(str)</em></strong></a>。因为Message通过content属性公开了它的内容，所以我们可以对它运行startsWith。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="be67" class="lw kz in nk b gy no np l nq nr">client.on(‘message’ , (msg) =&gt; {</span><span id="7f50" class="lw kz in nk b gy ns np l nq nr">   if(!msg.content.startsWith(‘!’)) {</span><span id="86a6" class="lw kz in nk b gy ns np l nq nr">      console.log(‘Not a command, abort’)</span><span id="0551" class="lw kz in nk b gy ns np l nq nr">      return</span><span id="33ac" class="lw kz in nk b gy ns np l nq nr">   }</span><span id="b678" class="lw kz in nk b gy ns np l nq nr">})</span></pre><p id="f53a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以<strong class="kc io">从内容字符串中提取</strong>我们的<strong class="kc io">命令</strong>，而<strong class="kc io"> <em class="mn"> substr(start，end) </em> </strong>是一个完美的选择。它可以取一个<strong class="kc io">开始</strong>和<strong class="kc io">结束</strong>(可选)的索引，并返回得到的<a class="ae jz" href="https://www.w3schools.com/jsref/jsref_obj_string.asp" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">字符串</strong> </a>。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="1bdf" class="lw kz in nk b gy no np l nq nr">let command = msg.content.substr(1)</span></pre><p id="7c31" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将上面一行代码放在if语句下面。</p><p id="3986" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">由于我们想在日志中记录<strong class="kc io"/>消息，我们需要一种方法来<strong class="kc io">区分</strong>我们的<strong class="kc io">命令</strong>和我们的<strong class="kc io">参数</strong>。一种方法是<strong class="kc io">用<strong class="kc io">空间</strong>分隔</strong>命令的各个部分，然后用于拆分参数。再次，JavaScript对此有一个功能，叫做<a class="ae jz" href="https://www.w3schools.com/jsref/jsref_split.asp" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mn">拆分(character) </em> </strong> </a>。查看下面的代码。首先，我们创建一个<strong class="kc io">数组</strong><strong class="kc io">字符串</strong>，当我们用空格分割时，它保存了我们信息的每个<strong class="kc io">子字符串</strong>。第二，我们检查第一个参数(在“！”后面的那个<em class="mn"> ) </em>是<em class="mn">日志</em>，这是我们的第一个命令。将代码粘贴到我们插入的最后一行下面。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="948b" class="lw kz in nk b gy no np l nq nr">let args = command.split(‘ ‘)</span><span id="397e" class="lw kz in nk b gy ns np l nq nr">if(args[0] == ‘log’) {</span><span id="1a3e" class="lw kz in nk b gy ns np l nq nr">}</span></pre><p id="9af1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，我们要检查第二个<strong class="kc io"/>参数，在这种情况下-我们的<strong class="kc io">信息</strong>是否存在。为此，我们可以<strong class="kc io">检查</strong>是否有<strong class="kc io">未定义的</strong>。如果它存在，我们继续。如果它丢失，我们会向用户显示一条错误消息。将代码粘贴到前面if语句的括号中。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="8f29" class="lw kz in nk b gy no np l nq nr">if (args[1] === undefined) {</span><span id="3a66" class="lw kz in nk b gy ns np l nq nr">   msg.channel.send(‘Missing message to log’)</span><span id="ec4a" class="lw kz in nk b gy ns np l nq nr">} else {</span><span id="b2fb" class="lw kz in nk b gy ns np l nq nr">}</span></pre><p id="8f71" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我们利用先前创建的<strong class="kc io">参数</strong>数组。但是这个代码有一个问题。因为我们要记录的消息可能包含空格。为了解决这个问题，我们可以从第二个参数<strong class="kc io">开始，将每个子字符串<strong class="kc io">连接起来。同样，JavaScript对此有内置的方法。将以下代码添加到else分支。</strong></strong></p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="70e8" class="lw kz in nk b gy no np l nq nr">let content = args.slice(1).join(‘ ‘)</span></pre><p id="d71e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae jz" href="https://www.w3schools.com/jsref/jsref_splice.asp" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mn">数组。切片(索引)</em> </strong> </a>可以用来得到从<strong class="kc io">索引</strong>开始的数组。一旦我们这样做了，我们就可以再次从所有的子字符串条目中创建一个字符串。这可以通过方便的方法<a class="ae jz" href="https://www.w3schools.com/jsref/jsref_join.asp" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mn">array . join(str)</em></strong></a>来完成。它创建一个<strong class="kc io">组合的</strong>字符串，用<strong class="kc io">字符串</strong>分隔每个条目。</p><blockquote class="mo mp mq"><p id="7556" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated">对于数组和字符串，JavaScript有很多更有用的方法。详见<a class="ae jz" href="https://www.w3schools.com/jsref/jsref_obj_array.asp" rel="noopener ugc nofollow" target="_blank">阵</a>和<a class="ae jz" href="https://www.w3schools.com/js/js_strings.asp" rel="noopener ugc nofollow" target="_blank">串</a>。</p></blockquote><h2 id="bd78" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">存储数据</h2><p id="2bd5" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">当我们想要持久化数据时，<strong class="kc io"> Realm </strong>是Discord bots的绝佳选择。它是<a class="ae jz" href="https://en.wikipedia.org/wiki/ACID" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"/></a>的符合，既不是<strong class="kc io">的关系型</strong>，也不是<strong class="kc io">的文档型</strong>，特点是<strong class="kc io">的炽热</strong>的快速存取，并且具有非常直观和简单的<strong class="kc io">语法</strong>。关于<strong class="kc io">领域</strong>的更多信息，请参见<a class="ae jz" href="https://docs.mongodb.com/realm/sdk/node/quick-start-local/" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io">领域快速入门</strong> </a>。</p><p id="ab4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了<strong class="kc io">存储</strong>数据，我们创建/打开一个<strong class="kc io">领域</strong>并提供一个<strong class="kc io">对象定义</strong>，该领域中的每个对象都必须符合该定义。我们的对象定义如下:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="3269" class="lw kz in nk b gy no np l nq nr">const LogEntry = {</span><span id="11cb" class="lw kz in nk b gy ns np l nq nr">  name: ‘LogEntry’,</span><span id="e3cb" class="lw kz in nk b gy ns np l nq nr">  properties: {</span><span id="be39" class="lw kz in nk b gy ns np l nq nr">    _id: ‘string’,</span><span id="a7e5" class="lw kz in nk b gy ns np l nq nr">    user: ‘string’,</span><span id="4330" class="lw kz in nk b gy ns np l nq nr">    message: ‘string’</span><span id="c6af" class="lw kz in nk b gy ns np l nq nr">  },</span><span id="b1e5" class="lw kz in nk b gy ns np l nq nr">  primaryKey: ‘_id’,</span><span id="19e2" class="lw kz in nk b gy ns np l nq nr">}</span></pre><p id="5342" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">每个定义都需要一个主键。Realm推荐命名为<em class="mn"> _id </em>。</p><p id="beed" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将对象定义粘贴到我们的导入下面。</p><p id="fe1f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们可以<strong class="kc io">打开</strong>我们的领域了。领域<strong class="kc io">构造器</strong>接受一个<strong class="kc io">配置</strong>对象，我们提供了<strong class="kc io">路径</strong>和要使用的<strong class="kc io">模式</strong>(我们的对象定义)。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="06b5" class="lw kz in nk b gy no np l nq nr">const logs = new Realm({</span><span id="7b6e" class="lw kz in nk b gy ns np l nq nr">path: `./realm/logs`,</span><span id="8219" class="lw kz in nk b gy ns np l nq nr">schema: [LogEntry]</span><span id="e640" class="lw kz in nk b gy ns np l nq nr">})</span></pre><p id="b04c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">随着我们的领域打开并准备好使用，我们可以创建我们的第一个写操作。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="8dec" class="lw kz in nk b gy no np l nq nr">logs.write(() =&gt; {</span><span id="fa79" class="lw kz in nk b gy ns np l nq nr">  logs.create(‘LogEntry’, {</span><span id="6495" class="lw kz in nk b gy ns np l nq nr">    _id: msg.id,</span><span id="8e18" class="lw kz in nk b gy ns np l nq nr">    user: msg.author.id,</span><span id="1837" class="lw kz in nk b gy ns np l nq nr">    message: content</span><span id="7d17" class="lw kz in nk b gy ns np l nq nr">  })</span><span id="1017" class="lw kz in nk b gy ns np l nq nr">})</span><span id="067a" class="lw kz in nk b gy ns np l nq nr">logs.close()</span><span id="f8af" class="lw kz in nk b gy ns np l nq nr">msg.channel.send(`${msg.author} Added '${content}' to logs`)</span></pre><p id="f083" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">写入完成后，我们向<strong class="kc io">通道</strong>发送<strong class="kc io">确认</strong>消息，我们<strong class="kc io">从该通道接收</strong>日志。</p><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/37b37f5b8bef156a7c5a4ecbe997669b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mz6Zx6LbtgtuR0s846E--A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Our bot reacts to our log command</figcaption></figure><p id="429b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Realm中的写<strong class="kc io">动作</strong>总是发生在提供给<strong class="kc io"><em class="mn">Realm . write(callback)</em></strong>的写<strong class="kc io">回调</strong>中。当你<strong class="kc io">完成</strong>写作、阅读或更新时，总是<strong class="kc io">关闭</strong>领域。</p><p id="eb40" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们教程的最后一部分涵盖了从我们的<strong class="kc io">领域</strong>读取消息日志。</p><p id="b71a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">将这段代码粘贴到我们的第一个命令检查(检查“log”)旁边。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="1700" class="lw kz in nk b gy no np l nq nr">else if (args[0] === 'logs') {</span><span id="3aa5" class="lw kz in nk b gy ns np l nq nr">  const logs = new Realm({</span><span id="1bf3" class="lw kz in nk b gy ns np l nq nr">    path: `./realm/logs`,</span><span id="f094" class="lw kz in nk b gy ns np l nq nr">    schema: [LogEntry]</span><span id="90bd" class="lw kz in nk b gy ns np l nq nr">  })</span><span id="4073" class="lw kz in nk b gy ns np l nq nr">  let str = ''</span><span id="3008" class="lw kz in nk b gy ns np l nq nr">  const result = logs.objects('LogEntry')</span><span id="70bc" class="lw kz in nk b gy ns np l nq nr">  result.forEach(element =&gt; {</span><span id="9496" class="lw kz in nk b gy ns np l nq nr">    str += `User: &lt;@${element.user}&gt;: ${element.message}\n`</span><span id="8cdd" class="lw kz in nk b gy ns np l nq nr">  })</span><span id="b214" class="lw kz in nk b gy ns np l nq nr">  if (str === '') {</span><span id="2ea3" class="lw kz in nk b gy ns np l nq nr">    msg.channel.send({ embed: { description: 'There are no logs'}})</span><span id="283b" class="lw kz in nk b gy ns np l nq nr">} else {</span><span id="1540" class="lw kz in nk b gy ns np l nq nr">    let logsEmbed = { description: `${str}`, color: 'AAFFAA' }</span><span id="3738" class="lw kz in nk b gy ns np l nq nr">    msg.channel.send({ embed: logsEmbed })</span><span id="033d" class="lw kz in nk b gy ns np l nq nr">    logs.write(() =&gt; {</span><span id="b6cb" class="lw kz in nk b gy ns np l nq nr">      logs.delete(result) // delete the Results collection</span><span id="d238" class="lw kz in nk b gy ns np l nq nr">    })</span><span id="0f19" class="lw kz in nk b gy ns np l nq nr">  }</span><span id="8275" class="lw kz in nk b gy ns np l nq nr">logs.close()</span><span id="5ccf" class="lw kz in nk b gy ns np l nq nr">}</span></pre><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/3cf6d63b693f1875d2af1d46d7e8621f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJ9C5lknSJF81wtJKERedw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Our bot lists all our stored logs</figcaption></figure><figure class="mv mw mx my gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/fe13d419ce3d59c4aee9f92a716eaef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PIRx9xZ0fmaOEMDm8NOVLw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">We don’t have any logs stored</figcaption></figure><p id="e6a9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这段代码和你已经学过的差不多。新的是在我们的领域中查询ob对象、删除条目和嵌入消息。</p><p id="3037" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">删除我们的领域是通过我们的领域公开的<strong class="kc io"> <em class="mn"> delete() </em> </strong>消息来完成的。</p><p id="ede0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">发送<a class="ae jz" href="https://discordjs.guide/popular-topics/embeds.html#using-an-embed-object" rel="noopener ugc nofollow" target="_blank"> <strong class="kc io"> <em class="mn">嵌入</em> </strong> </a>(丰富消息)是通过<strong class="kc io">发送</strong>消息方法完成的，提供了一个<strong class="kc io"> JSON </strong>对象，包含作为<strong class="kc io">嵌入</strong>属性的嵌入。</p><blockquote class="mo mp mq"><p id="4a8e" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated">当查询我们的领域时，我们可以查询所有对象，或者符合特定标准的对象。虽然本教程中没有使用过滤器，但这里提供了一个示例以供快速参考:</p></blockquote><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="62a2" class="lw kz in nk b gy no np l nq nr">const result = logs.objects(‘LogEntry’)</span><span id="b07f" class="lw kz in nk b gy ns np l nq nr">const userLogs = result.filtered(`user == ‘${msg.author.id}’`</span></pre><blockquote class="mo mp mq"><p id="ffa1" class="ka kb mn kc b kd ke kf kg kh ki kj kk mr km kn ko ms kq kr ks mt ku kv kw kx ig bi translated">这行代码将为请求用户过滤所有日志。</p></blockquote><p id="06fd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的简单机器人的最后一行登录我们的机器人，并使它准备好被使用。在这里插入您自己在本文开始时获得的令牌。</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="aad7" class="lw kz in nk b gy no np l nq nr">client.login(‘your-t-o-k-e-n’)</span></pre><p id="9c9e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你的机器人现在应该已经准备好了。</p><p id="f1e5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以下是完整的代码:</p><pre class="mv mw mx my gt nj nk nl nm aw nn bi"><span id="bdb0" class="lw kz in nk b gy no np l nq nr">import Discord from 'discord.js'</span><span id="d5e1" class="lw kz in nk b gy ns np l nq nr">import Realm from 'realm'<br/></span><span id="795f" class="lw kz in nk b gy ns np l nq nr">const LogEntry = {</span><span id="e555" class="lw kz in nk b gy ns np l nq nr">  name: 'LogEntry',</span><span id="f89b" class="lw kz in nk b gy ns np l nq nr">  properties: {</span><span id="cfcc" class="lw kz in nk b gy ns np l nq nr">    _id: 'string',</span><span id="22e9" class="lw kz in nk b gy ns np l nq nr">    user: 'string',</span><span id="2e6e" class="lw kz in nk b gy ns np l nq nr">    message: 'string'</span><span id="67bc" class="lw kz in nk b gy ns np l nq nr">  },</span><span id="0e2e" class="lw kz in nk b gy ns np l nq nr">  primaryKey: '_id',</span><span id="fcf9" class="lw kz in nk b gy ns np l nq nr">}</span><span id="5381" class="lw kz in nk b gy ns np l nq nr">let client = new Discord.Client()</span><span id="47cf" class="lw kz in nk b gy ns np l nq nr">client.on('message', (msg) =&gt; {</span><span id="b13d" class="lw kz in nk b gy ns np l nq nr">  if (!msg.content.startsWith('!')) {</span><span id="e2e4" class="lw kz in nk b gy ns np l nq nr">    console.log('Not a command, abort')</span><span id="9e95" class="lw kz in nk b gy ns np l nq nr">    return</span><span id="7c38" class="lw kz in nk b gy ns np l nq nr">  }</span><span id="981b" class="lw kz in nk b gy ns np l nq nr">  let command = msg.content.substr(1)</span><span id="5fa1" class="lw kz in nk b gy ns np l nq nr">  let args = command.split(' ')</span><span id="ebb4" class="lw kz in nk b gy ns np l nq nr">  if (args[0] === 'log') {</span><span id="4540" class="lw kz in nk b gy ns np l nq nr">    if (args[1] === undefined) {</span><span id="c3b1" class="lw kz in nk b gy ns np l nq nr">      msg.channel.send('Missing message to log')</span><span id="9dde" class="lw kz in nk b gy ns np l nq nr">    } else {</span><span id="5e76" class="lw kz in nk b gy ns np l nq nr">      let content = args.slice(1).join(' ')</span><span id="e36b" class="lw kz in nk b gy ns np l nq nr">      const logs = new Realm({</span><span id="c31c" class="lw kz in nk b gy ns np l nq nr">        path: `./realm/logs`,</span><span id="c8b0" class="lw kz in nk b gy ns np l nq nr">        schema: [LogEntry]</span><span id="3278" class="lw kz in nk b gy ns np l nq nr">      })</span><span id="90b2" class="lw kz in nk b gy ns np l nq nr">      logs.write(() =&gt; {</span><span id="5ef2" class="lw kz in nk b gy ns np l nq nr">        logs.create('LogEntry', {</span><span id="9dc9" class="lw kz in nk b gy ns np l nq nr">          _id: msg.id,</span><span id="3388" class="lw kz in nk b gy ns np l nq nr">          user: msg.author.id,</span><span id="f2a0" class="lw kz in nk b gy ns np l nq nr">          message: content</span><span id="d79d" class="lw kz in nk b gy ns np l nq nr">        })</span><span id="1c3a" class="lw kz in nk b gy ns np l nq nr">      })</span><span id="5e75" class="lw kz in nk b gy ns np l nq nr">      logs.close()</span><span id="986d" class="lw kz in nk b gy ns np l nq nr">      msg.channel.send(`${msg.author} Added '${content}' to logs`)</span><span id="cce1" class="lw kz in nk b gy ns np l nq nr">    }</span><span id="ee02" class="lw kz in nk b gy ns np l nq nr">  } else if (args[0] === 'logs') {</span><span id="f022" class="lw kz in nk b gy ns np l nq nr">      const logs = new Realm({</span><span id="6749" class="lw kz in nk b gy ns np l nq nr">        path: `./realm/logs`,</span><span id="9eeb" class="lw kz in nk b gy ns np l nq nr">        schema: [LogEntry]</span><span id="5811" class="lw kz in nk b gy ns np l nq nr">      })</span><span id="0f3d" class="lw kz in nk b gy ns np l nq nr">      let str = ''</span><span id="7418" class="lw kz in nk b gy ns np l nq nr">      const result = logs.objects('LogEntry')</span><span id="2237" class="lw kz in nk b gy ns np l nq nr">      result.forEach(element =&gt; {</span><span id="658d" class="lw kz in nk b gy ns np l nq nr">        str += `User: &lt;@${element.user}&gt;: ${element.message}\n`</span><span id="e6b2" class="lw kz in nk b gy ns np l nq nr">      })</span><span id="b411" class="lw kz in nk b gy ns np l nq nr">      if (str === '') {</span><span id="32ba" class="lw kz in nk b gy ns np l nq nr">        msg.channel.send({ embed: { description: 'There are no logs', color: 'AAFFAA' } })</span><span id="ac43" class="lw kz in nk b gy ns np l nq nr">        return</span><span id="4fb5" class="lw kz in nk b gy ns np l nq nr">      } else {</span><span id="e678" class="lw kz in nk b gy ns np l nq nr">        let logsEmbed = { description: `${str}`, color: 'AAFFAA' }</span><span id="f575" class="lw kz in nk b gy ns np l nq nr">        msg.channel.send({ embed: logsEmbed })</span><span id="e873" class="lw kz in nk b gy ns np l nq nr">        logs.write(() =&gt; {</span><span id="bbff" class="lw kz in nk b gy ns np l nq nr">        logs.delete(result)</span><span id="7911" class="lw kz in nk b gy ns np l nq nr">      })</span><span id="18ca" class="lw kz in nk b gy ns np l nq nr">    }</span><span id="e237" class="lw kz in nk b gy ns np l nq nr">    logs.close()</span><span id="0356" class="lw kz in nk b gy ns np l nq nr">  }</span><span id="bc34" class="lw kz in nk b gy ns np l nq nr">})</span><span id="c4aa" class="lw kz in nk b gy ns np l nq nr">client.login('token')</span></pre></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="1b52" class="lw kz in bd la lx ly dn le lz ma dp li kl mb mc lm kp md me lq kt mf mg lu mh bi translated">概述</h2><p id="f6ca" class="pw-post-body-paragraph ka kb in kc b kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt mm kv kw kx ig bi translated">用discord.js和Realm创建动态强大的bot是一个非常快速直观的过程。有了整个Node.js生态系统和一个现代化的移动优化数据库，构建Discord机器人从未像现在这样简单和强大。</p></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><p id="e7bc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想要更多的不和谐、领域和/或JavaScript教程，请在评论中告诉我。</p><p id="ed77" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mn">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="mn">plain English . io</em></a></p></div></div>    
</body>
</html>