<html>
<head>
<title>Using Dependency Injection with Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Express使用依赖注入</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/using-dependency-injection-with-express-17487c2378e1?source=collection_archive---------4-----------------------#2021-05-05">https://javascript.plainenglish.io/using-dependency-injection-with-express-17487c2378e1?source=collection_archive---------4-----------------------#2021-05-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/61832566bc39254e2bf0dc0dfa92e887.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tstyMdSYEzs2QvS-wHMkeQ.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo Illustration by David Fekke</figcaption></figure><p id="e97a" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">原发布于</em><a class="ae lb" href="https://fek.io/blog/use-dependency-injection-with-express" rel="noopener ugc nofollow" target="_blank"><em class="la">https://fek . io</em></a><em class="la">。</em></p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="lg lh l"/></div></figure><p id="53fd" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我最近写了一篇关于在JavaScript中使用<a class="ae lb" rel="noopener ugc nofollow" target="_blank" href="/should-you-use-dependency-injection-in-javascript-3751bdf3f198">依赖注入</a>的博文。这种技术非常方便，并且在使用像<a class="ae lb" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express </a>这样的web应用程序框架时非常有用。</p><p id="9d9d" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">Express使得通过中间件向您的web应用程序或单个路由注入依赖关系变得非常容易。在我的Express应用程序中，当我需要一个依赖项时，我通过将它作为请求对象上的一个服务直接注入到一个路由中。但在此之前，让我们将我们的应用程序分解成不同的模块化组件。</p><h1 id="af4b" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">服务</h1><p id="8386" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">对于这个应用程序的第一部分，我们将使用<a class="ae lb" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>库创建实际的HTTP请求。我们将使这些请求异步。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="4c1c" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我用<a class="ae lb" href="https://swapi.dev/" rel="noopener ugc nofollow" target="_blank">星球大战API </a>作为我的例子。我为<code class="fe mm mn mo mp b">getVehicles</code>、<code class="fe mm mn mo mp b">getPlanets</code>和<code class="fe mm mn mo mp b">getStarships</code>创建了三个函数。这些方法使用了<code class="fe mm mn mo mp b">async/await</code>语法，这将允许导入这些函数的模块异步使用它们。</p><h1 id="5266" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">路线</h1><p id="834c" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">对于我的快速路线，我喜欢将处理程序分解到它们自己的模块中。然后，我们可以在实际的路由中使用这些处理程序，这将使它们更容易测试。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="bf76" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从上面的例子可以看出，每个处理程序都可以通过<code class="fe mm mn mo mp b">req</code>参数发出服务请求，我们并没有将服务显式地导入到我们的处理程序中。现在，我们可以为我们的API调用在它自己的模块中创建路由。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="3ba5" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">上例显示了本模块中的样板快速路线设置。我们现在可以在我们的主express应用程序模块中引用它。</p><h1 id="4790" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">注入服务</strong></h1><p id="29e3" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">为了注入我们的服务，我们需要创建一个可以附加到<code class="fe mm mn mo mp b">req</code>对象的服务对象，并创建一个中间件组件，将服务注入到我们的API路径中。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="d350" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">从上面的例子中我们可以看到，我们现在正在导入使用<code class="fe mm mn mo mp b">axios</code>创建的单个API函数，并创建一个服务工厂，将所有三个函数合并成一个服务对象。然后，我们创建<code class="fe mm mn mo mp b">exposeService</code>中间件，它将把这个服务注入到我们的路由中。</p><p id="1fca" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们完成的应用程序应该看起来像下面的例子；</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="ml lh l"/></div></figure><p id="7da7" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在示例应用程序中，我们已经将服务注入到我们的<code class="fe mm mn mo mp b">api</code>路线中，因此它可以访问<code class="fe mm mn mo mp b">req</code>参数的<code class="fe mm mn mo mp b">service</code>属性上的星球大战API。我们还有一个默认的指向'/'路由的索引路由。这个“索引”路由不能访问服务，因为我们没有全局传递中间件，我们只是将它传递到“api”路由中。</p><h1 id="530e" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">结论</strong></h1><p id="6e4a" class="pw-post-body-paragraph kc kd iq ke b kf mg kh ki kj mh kl km kn mi kp kq kr mj kt ku kv mk kx ky kz ij bi translated">依赖注入是一个非常强大的工具，它允许我们分离我们的应用程序。通过将这些服务分解到它们自己的模块中，我们也使得我们的应用程序更容易使用JavaScript可用的众多测试框架之一进行测试。愿国庆日与你同在！</p></div><div class="ab cl mq mr hu ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ij ik il im in"><p id="b255" class="pw-post-body-paragraph kc kd iq ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="la">更多内容请看</em><a class="ae lb" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke ir"><em class="la">plain English . io</em></strong></a></p></div></div>    
</body>
</html>