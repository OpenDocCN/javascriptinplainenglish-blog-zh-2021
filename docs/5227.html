<html>
<head>
<title>Next.js Firebase v9: Detect Input Area</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Next.js Firebase v9:检测输入区域</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/nextjs-firebase-v9-part-8-detect-input-area-e3d93222b50?source=collection_archive---------4-----------------------#2021-10-24">https://javascript.plainenglish.io/nextjs-firebase-v9-part-8-detect-input-area-e3d93222b50?source=collection_archive---------4-----------------------#2021-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9ad8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">第8部分:使用React useRef检查用户是否想要更新或添加新的待办事项。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/7df820b34e29efca9bcfde2c5cf54a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*C6tSS3vcKao3M7O9.png"/></div></figure><p id="2624" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><a class="ae lj" href="https://youtu.be/A-Ce4YyHMGk" rel="noopener ugc nofollow" target="_blank">视频教程</a>和<a class="ae lj" href="https://www.udemy.com/course/complete-nextjs-firebase-firestore-course/?couponCode=FREESOURCE" rel="noopener ugc nofollow" target="_blank">源代码</a></p><p id="3491" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了确定用户是否点击了输入区域，我们必须使用<code class="fe lk ll lm ln b">useRef</code>，所以我们导入它。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="cbf4" class="ls lt iq ln b gy lu lv l lw lx">import { useContext, useEffect, useRef, useState } from "react";</span><span id="7b63" class="ls lt iq ln b gy ly lv l lw lx">const inputAreaRef = useRef();</span></pre><p id="14b0" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将<code class="fe lk ll lm ln b">inputAreaRef</code>绑定到输入表单。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="c04a" class="ls lt iq ln b gy lu lv l lw lx">&lt;div ref={inputAreaRef}&gt;</span><span id="561c" class="ls lt iq ln b gy ly lv l lw lx">&lt;TextField</span><span id="4beb" class="ls lt iq ln b gy ly lv l lw lx">fullWidth</span><span id="743e" class="ls lt iq ln b gy ly lv l lw lx">label="Title"</span><span id="be8f" class="ls lt iq ln b gy ly lv l lw lx">margin="normal"</span><span id="fb98" class="ls lt iq ln b gy ly lv l lw lx">value={todo.title}</span><span id="b81c" class="ls lt iq ln b gy ly lv l lw lx">onChange={e =&gt; setTodo({ ...todo, title: e.target.value })}</span></pre><p id="d8a7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然后我们添加下面的<code class="fe lk ll lm ln b">useEffect</code>来检测用户是否点击了输入区域。如果用户在输入区域之外点击，它将清除待办事项的标题和细节，而没有时间戳。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="8652" class="ls lt iq ln b gy lu lv l lw lx">useEffect(() =&gt; {</span><span id="bc3a" class="ls lt iq ln b gy ly lv l lw lx">const checkIfClickedOutside = e =&gt; {</span><span id="dabd" class="ls lt iq ln b gy ly lv l lw lx">if (!inputAreaRef.current.contains(e.target)) {</span><span id="0803" class="ls lt iq ln b gy ly lv l lw lx">console.log('Outside input area');</span><span id="0ff1" class="ls lt iq ln b gy ly lv l lw lx">setTodo({ title: '', detail: '' })</span><span id="39e2" class="ls lt iq ln b gy ly lv l lw lx">} else {</span><span id="923e" class="ls lt iq ln b gy ly lv l lw lx">console.log('Inside input area');</span><span id="641d" class="ls lt iq ln b gy ly lv l lw lx">}</span><span id="0478" class="ls lt iq ln b gy ly lv l lw lx">}</span><span id="2820" class="ls lt iq ln b gy ly lv l lw lx">document.addEventListener("mousedown", checkIfClickedOutside)</span><span id="3696" class="ls lt iq ln b gy ly lv l lw lx">return () =&gt; {</span><span id="ca8a" class="ls lt iq ln b gy ly lv l lw lx">document.removeEventListener("mousedown", checkIfClickedOutside)</span><span id="4893" class="ls lt iq ln b gy ly lv l lw lx">}</span><span id="53cd" class="ls lt iq ln b gy ly lv l lw lx">}, [])</span></pre><h2 id="f2fb" class="ls lt iq bd lz ma mb dn mc md me dp mf kw mg mh mi la mj mk ml le mm mn mo mp bi translated">点击待办事宜</h2><p id="0281" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">我们已经有一个可以清除待办事项的场景，我们还想选取现有待办事项的值，这样用户就可以更新该待办事项。</p><p id="c44f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">所以我们需要回到<code class="fe lk ll lm ln b">&lt;Todo&gt;</code>。转到列表项，添加<code class="fe lk ll lm ln b">onClick</code>，将待办事项值设置为当前待办事项值。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="820a" class="ls lt iq ln b gy lu lv l lw lx">&lt;ListItem onClick={() =&gt; setTodo({ id, title, detail, timestamp })}</span></pre><p id="6545" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">但是你可能已经注意到我们在<code class="fe lk ll lm ln b">&lt;Todo&gt;</code>组件上没有<code class="fe lk ll lm ln b">setTodo</code>功能。它只是出现在<code class="fe lk ll lm ln b">&lt;TodoForm&gt;</code>上。</p><h2 id="9f7e" class="ls lt iq bd lz ma mb dn mc md me dp mf kw mg mh mi la mj mk ml le mm mn mo mp bi translated">提取状态并将其放入ContextProvider中</h2><p id="0931" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">所以我们需要把它从<code class="fe lk ll lm ln b">&lt;TodoForm&gt;</code>中拿出来，放在<strong class="kp ir"> index.js </strong>里面。</p><p id="22d2" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将值<code class="fe lk ll lm ln b">todo</code>和<code class="fe lk ll lm ln b">setTodo</code>传递给<code class="fe lk ll lm ln b">Provider</code>。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="a4d4" class="ls lt iq ln b gy lu lv l lw lx">&lt;TodoContext.Provider value={{ showAlert, todo, setTodo }}&gt;</span><span id="3a75" class="ls lt iq ln b gy ly lv l lw lx">&lt;Container maxWidth="sm"&gt;</span><span id="db68" class="ls lt iq ln b gy ly lv l lw lx">&lt;TodoForm /&gt;</span></pre><h2 id="b2c6" class="ls lt iq bd lz ma mb dn mc md me dp mf kw mg mh mi la mj mk ml le mm mn mo mp bi translated">在<todoform>和<todo>处将待办事项设置回原位</todo></todoform></h2><p id="ef26" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated">转到<strong class="kp ir"> TodoForm.js </strong>。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="2ba2" class="ls lt iq ln b gy lu lv l lw lx">const { showAlert, todo, setTodo } = useContext(TodoContext)</span></pre><p id="e2a5" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">转到<strong class="kp ir"> Todo.js </strong>。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="89d6" class="ls lt iq ln b gy lu lv l lw lx">const { showAlert, setTodo } = useContext(TodoContext);</span></pre><p id="b1b8" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">为了看看它是否工作，我们转到<code class="fe lk ll lm ln b">&lt;TodoForm&gt;</code>，添加<code class="fe lk ll lm ln b">JSON.stringify</code>来显示待办状态。</p><pre class="kg kh ki kj gt lo ln lp lq aw lr bi"><span id="6011" class="ls lt iq ln b gy lu lv l lw lx">&lt;div ref={inputAreaRef}&gt;</span><span id="98ff" class="ls lt iq ln b gy ly lv l lw lx">&lt;pre&gt;{JSON.stringify(todo, null, '\t')}&lt;/pre&gt;</span><span id="cc7d" class="ls lt iq ln b gy ly lv l lw lx">&lt;TextField</span></pre><p id="bf17" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果我们点击其中一个待办事项，它会显示带有时间戳的待办事项。</p><p id="d845" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">该值也会添加到输入框中。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mv"><img src="../Images/1b8f57203ad39717d89b060bf4242f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWvzA2vCSMR_k8J-ElOKKg.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi na"><img src="../Images/681b1b0117bfdb424f016364c8e4310f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rM_4il3qkqrPEZl1h0j0Sw.png"/></div></div></figure><h1 id="9e39" class="nb lt iq bd lz nc nd ne mc nf ng nh mf jw ni jx mi jz nj ka ml kc nk kd mo nl bi translated">关注我们:<a class="ae lj" href="https://www.youtube.com/channel/UCu4-4FnutvSHVo9WHvq80Ww?sub_confirmation=1" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae lj" href="https://ckmobile.medium.com/" rel="noopener"> Medium </a>，<a class="ae lj" href="https://www.udemy.com/user/cyruschan2/" rel="noopener ugc nofollow" target="_blank"> Udemy </a>，<a class="ae lj" href="https://www.linkedin.com/company/ckmobi/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>，<a class="ae lj" href="https://twitter.com/ckmobilejavasc1" rel="noopener ugc nofollow" target="_blank"> Twitter </a>，<a class="ae lj" href="https://www.instagram.com/ckmobile8050" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae lj" href="https://app.gumroad.com/ckmobile" rel="noopener ugc nofollow" target="_blank"> Gumroad </a></h1><p id="56b7" class="pw-post-body-paragraph kn ko iq kp b kq mq jr ks kt mr ju kv kw ms ky kz la mt lc ld le mu lg lh li ij bi translated"><em class="nm">更多内容看</em> <a class="ae lj" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kp ir"> <em class="nm">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>