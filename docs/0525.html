<html>
<head>
<title>Scraping For Images Using Puppeteer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用木偶师抓取图像</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/scraping-for-images-using-puppeteer-9a3700bd5a2d?source=collection_archive---------2-----------------------#2021-02-01">https://javascript.plainenglish.io/scraping-for-images-using-puppeteer-9a3700bd5a2d?source=collection_archive---------2-----------------------#2021-02-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a671" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">自动化枯燥的东西</h2></div><p id="66a4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事实上，当我偶然发现木偶师时，我正在寻找一种方法来自动化我必须在几个网页上做的无聊的事情。是的…不，我不是在说那个操纵娃娃的家伙，但是是的，一个浏览器自动化的软件！</p><h1 id="0ee9" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">但是木偶师到底是什么？</h1><p id="b909" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">根据文档，Puppeteer是一个节点库，它提供了一个高级API来控制Chrome或DevTools协议上的Chrome。让我用简单的术语来解释一下。</p><p id="503f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Puppeteer是Node.js中的一个库或模块，它使你能够<em class="lv">在网络上执行某些动作</em>，比如打开页面、浏览网站、评估javascript等等，自动<em class="lv"/>。它使用Node.js和Chrome来创造奇迹。</p><blockquote class="lw lx ly"><p id="ae11" class="kc kd lv ke b kf kg jo kh ki kj jr kk lz km kn ko ma kq kr ks mb ku kv kw kx ig bi translated"><em class="in">然而，最近有一个版本的木偶师可以让你用火狐代替Chrome。</em></p></blockquote><p id="8fb7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">浏览器(Chrome)和Node.js之间的关系实际上编码在它们的徽标中，如下所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/d880cfc049ac1e371a6196a5140a1d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mVzL3TUbbqT0dIwi.jpg"/></div></div></figure><p id="9163" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我喜欢木偶师的一点是你可以轻而易举地抓取网页。事实上，在这篇文章中，我将向您展示如何使用Puppeteer从一个漫画网站获取图像src URL值。很酷，对吧？😎</p><p id="4aed" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">关于木偶师有太多要说的了。如果您有兴趣了解更多信息，可以访问他们的官方文档网站👉🏽<a class="ae mo" href="https://pptr.dev/" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="8824" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">介绍够了。现在让我们开始收集一些数据！</p><h1 id="971e" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">目标</h1><p id="9b52" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">你如何在网站上获得图片的源“src”值？简单—将鼠标指针放在图像上，右键单击，选择“inspect”…打开开发工具，这就是您的:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/4df9bf984bc00a38cfa315cd403164d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/0*TRveGmmT5cy_H_bg.JPG"/></div></figure><p id="67a1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">一张照片没什么大不了的，对吧？但是如果你重复同样的步骤，比如说一百张图片，会怎么样呢？这很容易变成一场噩梦。相信我，我知道。</p><p id="eaaa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是我们要用木偶师写一个脚本的地方，它会立刻自动为我们完成这个无聊的任务，节省我们大量的时间和压力。</p><p id="209d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将从一个我经常去看漫画书的网站上获取数据。(对了，我爱看漫画书。这是童年的事情…别担心😉)</p><h1 id="1739" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">网站</h1><p id="4bfd" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">你要做的第一件事是<em class="lv">知道你想从什么网站刮，并了解网站的元素是如何构成的</em>。前者应该不成问题。在我们的例子中，它是一个漫画网站，我们试图收集一些图片价值。现在，我们如何知道图像是如何构成的？让我来指导你:</p><p id="b12e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">前往<a class="ae mo" href="https://comicpunch.net/" rel="noopener ugc nofollow" target="_blank">漫画网站</a>。您将在主页上看到以下界面:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mu"><img src="../Images/b69d75fca66aa67a57dc139245be0304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sDmuHCQCOr9n1-As.jpg"/></div></div></figure><p id="c476" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些是我们想要的图像吗？对你来说也许是。但我们正在寻找任何漫画标题的任何问题的一组图像。所以我们必须导航到另一个页面。</p><p id="63a8" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">假设我们的目标是《蝙蝠侠:冒险继续(2020)》这个标题。我们必须从主页上的“热门标题”部分点击那个标题。</p><blockquote class="lw lx ly"><p id="6653" class="kc kd lv ke b kf kg jo kh ki kj jr kk lz km kn ko ma kq kr ks mb ku kv kw kx ig bi translated"><em class="in">如果您在阅读本文时，在网站主页的“热门书目”部分找不到该书名，请在网站上搜索该书名或使用您选择的另一书名，您将能够很好地理解。模式保持不变。</em></p></blockquote><p id="c521" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们进入了概览页面。在这一页上，我们有该漫画的所有可用问题的列表，在我们的情况下是“蝙蝠侠:冒险继续(2020)”。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mu"><img src="../Images/6cbe6ad7d83c750e6fbbccd985a42763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OOmq4Td5YyuegYy4.jpg"/></div></div></figure><p id="45c3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">请记住，我们的目标是获得漫画标题<em class="lv">发行</em>的图像(或页面)。</p><p id="8f0c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要进入“书籍页面”页面，我们必须选择一期。所以，让我们选择“蝙蝠侠:冒险继续2020年第一期”。</p><p id="b44a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们在这里！😎</p><p id="d438" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你会很快注意到在这个网站上浏览书籍页面的常见模式。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mu"><img src="../Images/78870437ad568e69a8e6ecc04bb3c1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8RyiZ1DGJRlEJ50Z.jpg"/></div></div></figure><p id="c8ab" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我想你一直在观察我们是如何转到这一页的？我们将指导木偶师走同样的路线。我们还会告诉木偶师如何找到我们想要的图像。</p><p id="1458" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们深入木偶师！</p><h1 id="38a0" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">机器人</h1><p id="7b0c" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">好的，首先，确保你已经安装了节点和NPM——木偶师非常依赖它们。点击了解如何下载Node.js安装程序和NPM <a class="ae mo" href="https://phoenixnap.com/kb/install-node-js-npm-on-windows" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="4410" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来要做的是初始化一个新的node.js项目。为此，创建一个新文件夹，并命名为您喜欢的任何名称。在我的情况下，我会把它命名为木偶师教程。打开你的终端和<code class="fe mq mr ms mt b">cd</code>到你新创建的目录。</p><p id="fe2f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Pssst:可以在Github上找到<a class="ae mo" href="https://github.com/Glitzyken/Puppeteer-Tutorial" rel="noopener ugc nofollow" target="_blank">这篇文章的代码。</a></p><p id="a935" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在运行:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="b399" class="mz kz in mt b gy na nb l nc nd">npm init</span></pre><p id="c8a9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行该命令时，会提示您填写新项目的一些基本信息。就这样做吧，跳过那些你真的不需要的(我让你来决定)。最后，您应该会看到类似这样的结果:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/352d1477e8dc3206715aaf5d9ae19b97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WCJh70C2o_BkT7ox.jpg"/></div></div></figure><p id="b3c6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这仅仅意味着您的项目已经用package.json文件进行了初始化，该文件包含了您之前传递给它的所有信息。</p><p id="c2e7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在是你安装木偶师的时候了。但是在安装Puppeteer之前，您应该用您的代码编辑器(最好是VS Code)打开您的项目，并在与您的package.json文件相同的路径级别上创建一个<strong class="ke io"> index.js </strong>文件。</p><p id="8c93" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后运行:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="f46f" class="mz kz in mt b gy na nb l nc nd">npm install puppeteer</span></pre><p id="ffa3" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将从NPM图书馆安装木偶师。您还会注意到，它下载了一个最新版本的Chromium(～170 MB Mac、282MB Linux、280MB Win)，该版本保证能与API一起工作。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/b53cd3162482097122fdf32dcbb9e7d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RhywNVylWdpEHaoL.jpg"/></div></div></figure><p id="0ee5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后你应该有一个3个文件的列表，分别是<strong class="ke io"> index.js </strong>、<strong class="ke io"> package-lock.json </strong>和<strong class="ke io"> package.json </strong>，以及一个<strong class="ke io"> node_modules </strong>文件夹。当您打开package.json文件时，您应该看到一个新创建的类似于对象的<code class="fe mq mr ms mt b">dependencies</code>,里面有一对<code class="fe mq mr ms mt b">"puppeteer": "&lt;lastest version&gt;"</code>。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/229d01f818db508463a95e4c377011ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*B8vojLlpESbHAxSP.jpg"/></div></div></figure><p id="161d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在搓搓你们的手掌，因为我们将要第一次测试木偶师！这难道不令人兴奋吗？😃</p><p id="cc70" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了运行测试，我们将使用文档中的典型示例。</p><p id="1b96" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建一个新的<strong class="ke io"> test.js </strong>文件，并将以下代码粘贴到其中:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="4ae7" class="mz kz in mt b gy na nb l nc nd">const puppeteer = require("puppeteer");<br/><br/>(async () =&gt; {<br/>  const browser = await puppeteer.launch();<br/>  const page = await browser.newPage();<br/>  await page.goto("https://kenjimmy.me");<br/>  await page.screenshot({ path: "example.png" });<br/><br/>  await browser.close();<br/>})();</span></pre><p id="25b6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，通过按ctrl (cmd) +`，在VS代码中打开集成终端。然后，运行:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="f051" class="mz kz in mt b gy na nb l nc nd">node test.js</span></pre><p id="1e82" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">node</code>是一个可执行的命令，因为您的机器上已经安装了Node.js。因此，<code class="fe mq mr ms mt b">node test.js</code>在Node.js运行时执行test.js文件中的JavaScript代码(在本例中尤其是Puppeteer代码)。</p><p id="3ec1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我不会解释test.js文件中每一行代码的作用，因为我只想测试是否正确安装了Puppeteer。我们将把对实际脚本的解释留到后面。</p><p id="9ce6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行该命令时，您应该会看到一个图像文件，其中包含我的网站主页的截图，大小为800×600px。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/9790ab859992e41a10aadb45dfb8dee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oGWghiUTBL2aQSly.jpg"/></div></div></figure><p id="7399" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以走了。</p><h1 id="ecae" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">使用木偶师抓取图像src</h1><p id="44d1" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">在您的<strong class="ke io"> index.js </strong>文件中，我们需要<code class="fe mq mr ms mt b">fs</code>(文件系统)模块。这将允许你把从漫画网站获取的数据写入一个文件。</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="06e2" class="mz kz in mt b gy na nb l nc nd">const fs = require("fs");</span></pre><p id="e03e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为您要将一些数据写入文件，所以要求您已经创建了该文件。因此，继续创建一个<strong class="ke io"> data.json </strong>文件。</p><p id="3a0c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">除了文件系统，我们肯定需要导入或需要木偶师。下面的代码就可以做到这一点:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="d267" class="mz kz in mt b gy na nb l nc nd">const puppeteer = require("puppeteer");</span></pre><p id="2daa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在JavaScript中，有一个被称为立即调用函数表达式(IIFE)的概念。简而言之，生命是一个JavaScript函数，一旦被定义，它就会运行。我们要用生活来包装我们的剧本，这是编写木偶剧本的常见方式。</p><p id="7dbd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是我们如何书写生活:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="8b59" class="mz kz in mt b gy na nb l nc nd">(async () =&gt; {<br/> // your code goes here...<br/>})();</span></pre><p id="ef6a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意，我们的匿名函数前面是关键字<code class="fe mq mr ms mt b">async</code>。这是从ES8开始引入JavaScript的一种特殊语法，以更舒适的方式处理承诺。它正在等待一个<code class="fe mq mr ms mt b">await</code>声明，我们将在一瞬间提供一些。</p><p id="4786" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在我们的IFFE中，让我们写一个<code class="fe mq mr ms mt b">try...catch</code>语句。这将有助于我们正确处理错误。</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="df5d" class="mz kz in mt b gy na nb l nc nd">(async () =&gt; {<br/>  try {<br/>    // ...<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>})();</span></pre><p id="df81" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在<code class="fe mq mr ms mt b">catch</code>块中所做的就是将<code class="fe mq mr ms mt b">error</code>记录到控制台，如果它捕捉到任何。</p><p id="54e1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们在<code class="fe mq mr ms mt b">try</code>块中编写脚本。</p><p id="3a62" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们以无头模式启动Chromium。这仅仅意味着当Chromium浏览器操作网站时，你不会看到它在运行。然后，打开我们想要操作的网页:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="4242" class="mz kz in mt b gy na nb l nc nd">// ...<br/><br/>// Initialize Puppeteer<br/>const browser = await puppeteer.launch();<br/>const page = await browser.newPage();<br/><br/>// Specify comic issue page url<br/>await page.goto(<br/>      "https://comicpunch.net/readme/index.php?title=batman-the-adventures-continue-2020&amp;chapter=1"<br/>);<br/>console.log("page has been loaded!");<br/><br/>// ...</span></pre><p id="0d69" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在<code class="fe mq mr ms mt b">page.goto()</code>中传递的URL是从哪里得到的？</p><p id="d61e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还记得漫画扉页吗？我们只需复制其中一个问题链接:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi nf"><img src="../Images/9d4257d279700e2a991470377dadbb25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Sqr6VsBk8DG79LUm.jpg"/></div></div></figure><p id="06fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们刚刚告诉木偶师要做的是通过使用<code class="fe mq mr ms mt b">.launch()</code>方法启动Chromium浏览器，并通过使用<code class="fe mq mr ms mt b">.newPage()</code>和<code class="fe mq mr ms mt b">.goto()</code>方法转到我们指定的URL。</p><p id="6920" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">它下一步应该做什么？它应该点击页面上的“全章”按钮:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/ed0fc54bb9631f404fc2501f541e69b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s-SBUJGCWttP5gZg.jpg"/></div></div></figure><p id="69fb" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">点击“整章”按钮将在页面上呈现我们需要的所有图像。这正是我们想要的。</p><p id="a8a1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要一种方法让木偶师知道“全章”按钮在哪里并点击它。因此，我们需要使用<code class="fe mq mr ms mt b">.click()</code>。此方法需要一个选择器。</p><p id="8d46" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们可以通过在浏览器上检查来获得任何元素的选择器。在这种情况下，我们将针对“button.button4”，其中“. button4”是赋予“Full Chapter”按钮的类名。</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="b8e4" class="mz kz in mt b gy na nb l nc nd">// ...<br/><br/>// While page is waiting for 1s, click on the 'Full Chapter' button and do the rest<br/>await page.waitFor(1000);<br/>await page.click("button.button4");<br/>console.log("'Full Chapter' button has been clicked!");<br/><br/>// ...</span></pre><p id="f143" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">哦天啊！<code class="fe mq mr ms mt b">.click()</code>前有一行。是的，我们必须使用<code class="fe mq mr ms mt b">.waitFor()</code>并在1000毫秒内通过，因为我们需要多一点时间让剩余的代码按预期工作。如果你想用它做实验，就把这条线去掉，看看会发生什么。😁</p><blockquote class="lw lx ly"><p id="8348" class="kc kd lv ke b kf kg jo kh ki kj jr kk lz km kn ko ma kq kr ks mb ku kv kw kx ig bi translated"><em class="in">对了，。waitFor()已被弃用，并将在未来的版本中删除。</em></p></blockquote><p id="5c8a" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，让我们告诉Puppeteer评估或计算主要任务，即将从DOM返回的图像的<a class="ae mo" href="https://developer.mozilla.org/en-US/docs/Web/API/NodeList" rel="noopener ugc nofollow" target="_blank"> nodelist </a>转换为一个数组，然后映射每个项目并获取src属性值，并将其存储在src变量中，该变量因此返回为issueSrcs变量的值。</p><p id="f63c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mq mr ms mt b">.evaluate()</code>接受要在页面上下文中评估的函数。所以这就是我们写主要代码的地方，来获取所有带有“.comicpic”类别:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="566e" class="mz kz in mt b gy na nb l nc nd">// ...<br/><br/>const issueSrcs = await page.evaluate(() =&gt; {<br/>      const srcs = Array.from(<br/>        document.querySelectorAll(".comicpic")<br/>      ).map((image) =&gt; image.getAttribute("src"));<br/>      return srcs;<br/>});<br/>console.log("Page has been evaluated!");<br/><br/>// ...</span></pre><p id="64b4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我们将所有数据存储在“issueSrcs”变量中。但是我们还没有完成。我们需要将数据持久化到data.json文件中，对吗？这就是我们使用<code class="fe mq mr ms mt b">fs.writeFileSync()</code>方法的地方:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="6d7d" class="mz kz in mt b gy na nb l nc nd">// ...<br/><br/>// Persist data into data.json file<br/>fs.writeFileSync("./data.json", JSON.stringify(issueSrcs));<br/>console.log("File is created!");<br/><br/>// ...</span></pre><p id="fc4c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，我们使用<code class="fe mq mr ms mt b">.close()</code>方法结束木偶。不然呢？良好的...😆</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="0b5e" class="mz kz in mt b gy na nb l nc nd">// ...<br/><br/>// End Puppeteer<br/>await browser.close();<br/><br/>// ...</span></pre><p id="2a8c" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最后，您的检修代码应该如下所示:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="fc7d" class="mz kz in mt b gy na nb l nc nd">const fs = require("fs");<br/>const puppeteer = require("puppeteer");<br/><br/>(async () =&gt; {<br/>  try {<br/>    // Initialize Puppeteer<br/>    const browser = await puppeteer.launch();<br/>    const page = await browser.newPage();<br/><br/>    // Specify comic issue page url<br/>    await page.goto(<br/>      "https://comicpunch.net/readme/index.php?title=batman-the-adventures-continue-2020&amp;chapter=1"<br/>    );<br/>    console.log("page has been loaded!");<br/><br/>    // While page is waiting for 1s, click on the 'Full Chapter' button and do the rest<br/>    await page.waitFor(1000);<br/>    await page.click("button.button4");<br/>    console.log("'Full Chapter' button has been clicked!");<br/><br/>    // Evaluate/Compute the main task:<br/>    // Here, we convert the Nodelist of images returned from the DOM into an array, then map each item and get the src attribute value, and store it in 'src' variable, which is therefore returned to be the value of 'issueSrcs' variable.<br/>    const issueSrcs = await page.evaluate(() =&gt; {<br/>      const srcs = Array.from(<br/>        document.querySelectorAll(".comicpic")<br/>      ).map((image) =&gt; image.getAttribute("src"));<br/>      return srcs;<br/>    });<br/>    console.log("Page has been evaluated!");<br/><br/>    // Persist data into data.json file<br/>    fs.writeFileSync("./data.json", JSON.stringify(issueSrcs));<br/>    console.log("File is created!");<br/><br/>    // End Puppeteer<br/>    await browser.close();<br/>  } catch (error) {<br/>    console.log(error);<br/>  }<br/>})();</span></pre><p id="9dd1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">酷！我们准备试验我们的剧本。我很好奇。你呢？😃</p><p id="1595" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，在您的终端中，运行:</p><pre class="md me mf mg gt mv mt mw mx aw my bi"><span id="73ba" class="mz kz in mt b gy na nb l nc nd">node index.js</span></pre><p id="ab76" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">还有…耶！我们做到了！！是的，我们成功获取了所有类别为'的漫画图像URL。并将它们以JSON格式存储在我们的<strong class="ke io"> data.json </strong>文件中。干得好。干得好！你刚刚把智商提高了10。(显然，那是个玩笑)</p><p id="c3fd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您打开您的<strong class="ke io"> data.json </strong>文件时，您应该会看到类似这样的内容:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi ne"><img src="../Images/7b4e45d06a4736798421032291fa4beb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*inDbPCNCUpZHqe_B.jpg"/></div></div></figure><h1 id="1bda" class="ky kz in bd la lb lc ld le lf lg lh li jt lj ju lk jw ll jx lm jz ln ka lo lp bi translated">结论</h1><p id="faa2" class="pw-post-body-paragraph kc kd in ke b kf lq jo kh ki lr jr kk kl ls kn ko kp lt kr ks kt lu kv kw kx ig bi translated">对于web自动化甚至web测试来说，Puppeteer是一个非常棒的工具。大多数你可以在浏览器中手动完成的事情都可以使用木偶师来完成！</p><p id="9fc9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，我们已经通过从网页中抓取一些图像src值进行了试验，但是这里还有几个您可以自己尝试的例子:</p><ul class=""><li id="b3ec" class="ng nh in ke b kf kg ki kj kl ni kp nj kt nk kx nl nm nn no bi translated">抓取SPA(单页应用程序)并生成预呈现内容(即“SSR”(服务器端呈现))。</li><li id="2dc0" class="ng nh in ke b kf np ki nq kl nr kp ns kt nt kx nl nm nn no bi translated">自动化表单提交、UI测试、键盘输入等。</li><li id="0d13" class="ng nh in ke b kf np ki nq kl nr kp ns kt nt kx nl nm nn no bi translated">创建一个最新的自动化测试环境。使用最新的JavaScript和浏览器功能，在最新版本的Chrome中直接运行测试。</li><li id="4035" class="ng nh in ke b kf np ki nq kl nr kp ns kt nt kx nl nm nn no bi translated">捕获站点的时间线跟踪，以帮助诊断性能问题。</li><li id="3722" class="ng nh in ke b kf np ki nq kl nr kp ns kt nt kx nl nm nn no bi translated">测试Chrome扩展。</li></ul><p id="d4b2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">充分利用这个神奇的工具！(为什么不呢😎)</p></div><div class="ab cl nu nv hr nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ig ih ii ij ik"><p id="0a51" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lv">最初发布于</em><a class="ae mo" href="https://kenjimmy.me/shelf/web-scraping-using-puppeteer" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://kenjimmy . me</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>