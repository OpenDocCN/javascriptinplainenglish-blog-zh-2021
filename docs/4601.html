<html>
<head>
<title>How to Watch for DOM Changes with JavaScript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用JavaScript观察DOM的变化？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-watch-for-dom-changes-with-javascript-311c5deeb270?source=collection_archive---------1-----------------------#2021-09-14">https://javascript.plainenglish.io/how-to-watch-for-dom-changes-with-javascript-311c5deeb270?source=collection_archive---------1-----------------------#2021-09-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3942eda47d8a3e0555cbb34a3ae71366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qXd8EIhV129kuNf9"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@maritafox?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marita Kavelashvili</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5de1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能希望观察web应用程序中DOM的变化。</p><p id="6e25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用JavaScript观察DOM中的变化。</p><h1 id="eba6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><code class="fe lz ma mb mc b">MutationObserver</code></h1><p id="7f9c" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">在我们的JavaScript web应用程序中观察DOM变化的一种方法是使用<code class="fe lz ma mb mc b">MutationObserver</code>构造函数。</p><p id="c35e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="4646" class="mq lc iq mc b gy mr ms l mt mu">const observer = new MutationObserver((mutations, observer) =&gt; {<br/>  console.log(mutations, observer);<br/>});</span><span id="1eea" class="mq lc iq mc b gy mv ms l mt mu">observer.observe(document, {<br/>  subtree: true,<br/>  attributes: true<br/>});</span><span id="ea35" class="mq lc iq mc b gy mv ms l mt mu">const sleep = ms =&gt; new Promise(resolve =&gt; setTimeout(resolve, ms));</span><span id="2bbd" class="mq lc iq mc b gy mv ms l mt mu">(async () =&gt; {<br/>  for (let i = 0; i &lt; 5; i++) {<br/>    const p = document.createElement('p')<br/>    p.textContent = 'hello'<br/>    document.body.appendChild(p)<br/>    await sleep(1000)<br/>  }<br/>})();</span></pre><p id="6b8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用一个循环创建<code class="fe lz ma mb mc b">MutationObserver</code>实例，将子元素添加到异步函数的主体中。</p><p id="2cd5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在1秒钟后插入一个新的p元素5次。</p><p id="bb74" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将回调传递给在DOM改变时运行的<code class="fe lz ma mb mc b">MutationObserver</code>构造函数。</p><p id="88d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们在想要观察变化的元素上调用<code class="fe lz ma mb mc b">observe</code>。</p><p id="c2c8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">subtree</code>设置为<code class="fe lz ma mb mc b">true</code>意味着我们观察子元素的变化。</p><p id="970c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">attributes</code>设置为<code class="fe lz ma mb mc b">true</code>意味着我们观察元素属性的变化。</p><p id="3911" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其他选项包括:</p><ul class=""><li id="5a21" class="mw mx iq kf b kg kh kk kl ko my ks mz kw na la nb nc nd ne bi translated"><code class="fe lz ma mb mc b">childList</code> —设置为<code class="fe lz ma mb mc b">true</code>观察目标的孩子</li><li id="902b" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lz ma mb mc b">characterData</code> —设置为<code class="fe lz ma mb mc b">true</code>观察目标的数据</li><li id="0239" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lz ma mb mc b">attributeOldValue</code> —设置为<code class="fe lz ma mb mc b">true</code>以观察DOM更改前元素的属性值</li><li id="71de" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lz ma mb mc b">characterDataOldValue</code> —设置为<code class="fe lz ma mb mc b">true</code>，在改变前观察目标的角色数据</li><li id="eea4" class="mw mx iq kf b kg nf kk ng ko nh ks ni kw nj la nb nc nd ne bi translated"><code class="fe lz ma mb mc b">attributeFilter</code> —设置为要观察的属性的本地名称。</li></ul><p id="9e7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">mutations</code>参数有一组应用了更改的属性。</p><p id="f7b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">mutations.target</code>属性的目标元素已经改变。</p><p id="3e53" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">mutations.target.lastChild</code>在被监视的元素中有最底层的子节点。</p><p id="6e31" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">mutations.target.lastElementChild</code>在被监视的元素中有最底层的子元素节点。</p><h1 id="3dec" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">侦听DOMSubtreeModified事件</h1><p id="e53b" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">另一种监听DOM结构变化的方法是监听<code class="fe lz ma mb mc b">DOMSubtreeModified</code>事件。</p><p id="f7b3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mc mn mo aw mp bi"><span id="d500" class="mq lc iq mc b gy mr ms l mt mu">document.addEventListener('DOMSubtreeModified', (e) =&gt; {<br/>  console.log(e)<br/>})</span><span id="6225" class="mq lc iq mc b gy mv ms l mt mu">const sleep = ms =&gt; new Promise(resolve =&gt; setTimeout(resolve, ms));</span><span id="9f4d" class="mq lc iq mc b gy mv ms l mt mu">(async () =&gt; {<br/>  for (let i = 0; i &lt; 5; i++) {<br/>    const p = document.createElement('p')<br/>    p.textContent = 'hello'<br/>    document.body.appendChild(p)<br/>    await sleep(1000)<br/>  }<br/>})();</span></pre><p id="e308" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为文档的<code class="fe lz ma mb mc b">DOMSubtreeModified</code>事件添加一个事件监听器。</p><p id="e4a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">e</code>参数是一个<code class="fe lz ma mb mc b">MutationEvent</code>对象。</p><p id="2550" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">属性的元素已经改变。</p><p id="9f09" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">e.path</code>具有指向已更改元素的路径，作为指向已更改元素的元素数组。</p><p id="e00b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lz ma mb mc b">e.children</code>具有一个元素已更改的HTMLCollection对象。</p><h1 id="93b4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="2758" class="pw-post-body-paragraph kd ke iq kf b kg md ki kj kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la ij bi translated">我们可以使用<code class="fe lz ma mb mc b">MutationObserver</code>和<code class="fe lz ma mb mc b">DOMSubtreeModified</code>事件来监听DOM的变化。</p></div></div>    
</body>
</html>