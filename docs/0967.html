<html>
<head>
<title>How to test publishing your JavaScript package locally</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何测试在本地发布JavaScript包</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-test-publishing-your-javascript-package-locally-b97e23c270c0?source=collection_archive---------18-----------------------#2021-02-28">https://javascript.plainenglish.io/how-to-test-publishing-your-javascript-package-locally-b97e23c270c0?source=collection_archive---------18-----------------------#2021-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8b8d" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">验证您发布的内容是否正确的简单快捷的方法。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a14bdaaddfa43daf1de2e85504ccefa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yxMX7-BrW-6J0k7mos00Ww.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@mbaumi?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Mika Baumeister</a> on <a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4a67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">自从我开始使用npm作为JS包管理器(可能早在2015年)，我就一直想发布我自己的包，它可以是我在自己的项目中使用的一个非常特殊的包，也可以是试图解决一个常见问题并帮助其他开发人员的包。</p><p id="d794" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每次我需要这样做的时候，我还想测试本地发布和安装的工作流程。此外，我想看看它发布时的“预览”，即“真正的”npm页面，例如，看看自述文件是否合适。</p><p id="6d83" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过大量的斗争和尝试，用各种方法来解决这个问题，我想我终于找到了最好的(至少对我来说)解决这两个问题的方法。</p><p id="2fe8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在深入研究最终解决方案之前，让我告诉你我在其他解决方案中遇到的问题。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="30be" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">符号链接</h1><p id="48d8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">回到2016年，我试图找到一种方法来做到这一点，我看到很多人都在谈论<code class="fe mw mx my mz b">Symlink</code>。</p><p id="55bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，<code class="fe mw mx my mz b">Symbolic Link</code>(或符号链接)，就是当你在两个(或更多)文件之间创建一个引用链接，使它们互相引用。</p><p id="fb98" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设您有一个库(my-library ),并希望在您的项目(网站)中使用它的本地文件。在这种情况下，一个符号链接将在<code class="fe mw mx my mz b">node_modules</code>中，而不是拥有<code class="fe mw mx my mz b">my-library</code>的生产文件，它指向它的本地文件夹。</p><p id="deee" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是…怎么做呢？</p><h1 id="b109" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">NPM/纱线符号链接</h1><p id="10a4" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当然，我并不是这个世界上唯一一个渴望找到正确方法的人。这就是为什么<code class="fe mw mx my mz b">npm</code>和<code class="fe mw mx my mz b">yarn</code>都提供了一种开箱即用的方式。</p><p id="7ab2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我不会在本文中解释如何使用它，但是如果你仍然想知道，你可以找到一个链接。</p><p id="da02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">简而言之，通过这样做，<code class="fe mw mx my mz b">npm</code>或<code class="fe mw mx my mz b">yarn</code>将:</p><ol class=""><li id="f0d3" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">创建对您的包的全局引用；</li><li id="2698" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">用你的<code class="fe mw mx my mz b">node_modules</code>中的引用替换真实的模块</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/c5080e2999fd7eb8128fd303ded3cd96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jKFBG-dnRQnwaRuz.png"/></div></div></figure><p id="2ea5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用这种方法解决了大部分跨项目测试包的问题… <strong class="ky ir">直到它不</strong>。</p><h1 id="b8b8" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">符号链接问题</h1><p id="18aa" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我对全局符号链接最大的痛苦是嵌套的node_modules，以及工具(至少支持它们)如何解析模块A(在项目和库中都使用)的哪个版本应该被解析。</p><p id="eb6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我第一次看到这种情况是在写React组件库的时候。工作流程是:</p><ol class=""><li id="ac28" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">去我的图书馆</li><li id="0a4c" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">运行<code class="fe mw mx my mz b">yarn link</code>创建一个符号链接</li><li id="c4cf" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">转到我的项目</li><li id="54ee" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">链接<code class="fe mw mx my mz b">my-library</code></li><li id="e93e" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">启动我的开发服务器</li></ol><p id="31f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅仅这样做，我就开始对一些React内部规则产生了疑问。这很奇怪，因为错误消息是真的。</p><p id="7ac0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">经过几个小时对这个问题的深入研究，我终于<a class="ae kv" href="https://github.com/facebook/react/issues/14257" rel="noopener ugc nofollow" target="_blank">在React的回购上发现了一个问题</a>报告了我遇到的完全相同的问题，他指出了关于符号链接的问题:</p><p id="e63c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">维护者的回答很明确:</p><blockquote class="nu nv nw"><p id="6aa6" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated"><em class="iq">除非你将react从你的模块链接回你的应用程序，否则它不会起作用。</em></p><p id="62f9" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated"><em class="iq">事实上一直都是这样的(React应用在有两个React模块副本的情况下会被微妙地破坏)。钩子立即浮出水面，我想这是好的。</em></p><p id="dc50" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated"><em class="iq">对于这种情况，我们确实有另一个问题来跟踪更好的错误消息。</em></p></blockquote><p id="2344" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当然，这很有道理。在我的组件库中，React是一个peerDependency，我没有在包中提供它。现在，通过Symlink使用它，React被安装在我的库和我的项目中。</p><p id="a268" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有人发布了一个解决方法，在这个方法中，您还需要在库中链接<code class="fe mw mx my mz b">react</code>和<code class="fe mw mx my mz b">react-dom</code>，并在我们的项目中使用这个链接。所以我的流程是:</p><ol class=""><li id="c726" class="nf ng iq ky b kz la lc ld lf nh lj ni ln nj lr nk nl nm nn bi translated">去我的图书馆</li><li id="dc28" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">导航到<code class="fe mw mx my mz b">node_modules/react</code></li><li id="44cb" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">运行<code class="fe mw mx my mz b">yarn link</code>创建一个反应符号链接</li><li id="f4ee" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">导航到<code class="fe mw mx my mz b">node_modules/react-dom</code></li><li id="69a1" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">运行<code class="fe mw mx my mz b">yarn link</code>创建一个反应符号链接</li><li id="e7a4" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">回到根级别，运行<code class="fe mw mx my mz b">yarn link</code>符号链接我的库</li><li id="373a" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">转到我的项目</li><li id="b8c5" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">使用<code class="fe mw mx my mz b">my-library</code>、<code class="fe mw mx my mz b">react</code>和<code class="fe mw mx my mz b">react-dom</code>的链接</li><li id="5f5c" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr nk nl nm nn bi translated">启动我的开发服务器</li></ol><p id="ca54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样做，我的问题就解决了！但是…天啊。真的吗？</p><p id="df4f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成我的测试后，我必须从你的项目中删除这3个链接，并强制安装依赖项。</p><p id="a32b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样做几次还可以，但是10次之后，我真的很烦，创建了一个bash脚本来执行这些步骤。</p><p id="7394" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，现在我使用Docker来运行我的项目，我意识到Symlink不能与我的基本设置一起工作。</p><p id="304c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">可能是因为当我运行我的容器时，我只创建了一个当前项目文件夹的卷。当容器启动并试图使用该符号链接时，它可能需要浏览我的文件系统，我认为这是不可能的。</p><p id="fe45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过添加一些额外的配置也许可以做到这一点，但我不想这样做。我想要一个简单的方法在我的lib中做一些事情，每当我需要使用它的时候就推送并安装它，而不会污染我在npm的真实包。</p><p id="7c71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，使用Symlink，您无法确定是否正在传送您的应用程序需要工作的所有文件。</p><p id="e3f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">幸运的是，我找到了一个非常简单的方法来解决这个问题，我想和你分享一下。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="cce5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">NPM代理注册中心</h1><p id="8463" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">公司也希望在他们的项目中掌握包管理，但也许其中一些需要是私有的，以保护他们的业务和知识产权。</p><p id="bf70" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">NPM提供使用私人套餐的服务，但你可以想象，它向公司收取费用。</p><p id="2ea1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个解决方案是使用npm代理。</p><p id="8a27" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">npm代理只是一个位于官方<code class="fe mw mx my mz b">npm</code>注册服务器前面的服务器，为您解析依赖关系。</p><p id="c3b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可以使用它发布一个内部包，而不是代理将你的包推给<code class="fe mw mx my mz b">npm</code>服务器，它会将它存储在自己的服务器上。</p><p id="93f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过使用代理服务器运行<code class="fe mw mx my mz b">npm install</code>，在幕后你会传递一个你想要安装的软件包列表。如果代理在其“数据库”中发布了一个包，它会将该包返回给您。如果没有，它会要求NPM服务器打包并返回给您:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/a1a33a7943f5d7d5e227598416e928a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iGCHvmfoKItj_D1M.png"/></div></div></figure><p id="7471" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">私有包是npm代理的功能之一。</p><p id="74cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">想象一下，您派生出axios并将修改后的版本发布到您的代理服务器。当您运行install时，代理将返回您发布的版本，而不是从NPM返回axios。</p><p id="62f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">你可能会想:</p><blockquote class="nu nv nw"><p id="e2de" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated">嗯……如果我们可以在云服务器上设置这个系统……如果我们在本地使用这个系统会怎么样？</p></blockquote><p id="d7a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">是的……这是我在观察那个解决方案时得出的结论，这就是我们将如何解决本地测试包的问题。</p><p id="f75f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有几个选项可以执行这个工作流，但是在本文中，我将向您展示如何使用Verdaccio来执行。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f8f8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">韦尔达乔</h1><p id="bd24" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Verdaccio是:</p><blockquote class="nu nv nw"><p id="02cc" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated"><em class="iq">一个轻量级开源私有npm代理注册表</em></p></blockquote><p id="612b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">它非常强大，在版本4中，它没有配置来开始使用它，这不一定意味着我们不需要配置，但不是真的在代理本身中。</p><h1 id="aa15" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">运行本地服务器</h1><p id="a1a5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在本地使用Verdaccio的最简单方法是作为全局npm依赖项进行安装:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="fde7" class="og ma iq mz b gy oh oi l oj ok">yarn global add verdaccio</span><span id="8ffb" class="og ma iq mz b gy ol oi l oj ok">## Or with npm</span><span id="6c44" class="og ma iq mz b gy ol oi l oj ok">npm install -g verdaccio</span></pre><p id="381b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">之后，您可以通过运行以下命令来启动服务器:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="92ec" class="og ma iq mz b gy oh oi l oj ok">verdaccio</span></pre><p id="1581" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您愿意，也可以使用docker运行该服务器:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="dc18" class="og ma iq mz b gy oh oi l oj ok">docker run -it --rm --name verdaccio -p 4873:4873 verdaccio/verdaccio</span></pre><blockquote class="nu nv nw"><p id="d3cc" class="kw kx nx ky b kz la jr lb lc ld ju le ny lg lh li nz lk ll lm oa lo lp lq lr ij bi translated">请记住，当容器停止时，您要发布的包将被删除。</p></blockquote><p id="0727" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">运行服务器后，您可以在<code class="fe mw mx my mz b">http://localhost:4873</code>(或<code class="fe mw mx my mz b"><a class="ae kv" href="http://0.0.0.0:4873)" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:4873</a></code> <a class="ae kv" href="http://0.0.0.0:4873)" rel="noopener ugc nofollow" target="_blank"> ) </a>查看网站</p><h1 id="75c7" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">添加您的npm用户</h1><p id="8cca" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">为了能够将包发布到您的本地Verdaccio，您首先必须在那里注册一个npm用户。为此，请运行:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="4ead" class="og ma iq mz b gy oh oi l oj ok">npm adduser --registry http://localhost:4873 # OR <a class="ae kv" href="http://0.0.0.0:4873" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:4873</a></span></pre><p id="d353" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">信息不需要安全或准确。记住，这只是当地的事情！:)</p><h1 id="3dcc" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">出版和消费</h1><p id="286a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">对于发布和使用您的本地包，您必须始终指定注册表URL。换句话说，npm必须找到包所在的服务器。</p><p id="8ab4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一种方法是在repo的根级别创建您想要消费/发布的名为<code class="fe mw mx my mz b">.npmrc</code>的文件，并在那里指定注册表链接:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="d731" class="og ma iq mz b gy oh oi l oj ok"># /my-project/.npmrc</span><span id="d58e" class="og ma iq mz b gy ol oi l oj ok">registry=http://localhost:4873 # OR <a class="ae kv" href="http://0.0.0.0:4873" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:4873</a></span></pre><p id="4eb8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我强烈推荐<code class="fe mw mx my mz b">npm</code>用户使用这种方法。原因是npm要求你在package.json中通过<code class="fe mw mx my mz b">npm config set</code>或<code class="fe mw mx my mz b">publishConfig.registry</code>设置一个全局注册表。当你想使用常规的<code class="fe mw mx my mz b">npmjs.org</code>注册表时，这两种方法都很麻烦。</p><p id="ef05" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当你想从官方注册表中使用时，你所要做的就是注释掉该文件中的注册表行。</p><p id="49de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个选项用于纱线用户，包括指定标志<code class="fe mw mx my mz b">--registry</code>:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="4af4" class="og ma iq mz b gy oh oi l oj ok"># For publishing<br/>yarn publish --registry http://localhost:4873 # OR http://0.0.0.0:4873</span><span id="dc23" class="og ma iq mz b gy ol oi l oj ok"># For consuming<br/>yarn add my-private-pkg --registry http://localhost:4873 # OR <a class="ae kv" href="http://0.0.0.0:4873" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:4873</a></span></pre><p id="3d4c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通过这样做，yarn将无需任何额外的文件或配置就能解析注册表。如果您最终对必须编写注册表标志感到厌烦，您也可以创建一个<code class="fe mw mx my mz b">.npmrc</code>文件，yarn也将能够从那里解析注册表URL。</p><p id="aafa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成此配置后，当您发布或安装您的本地包时，npm或yarn将首先向您的Verdaccio本地服务器请求该包，Verdaccio将完成所有工作，以存储或检索本地包并在NPM解析公共包。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4665" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">警告</h1><p id="d433" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">当我们安装一个依赖项时，一堆关于它的信息被添加到<code class="fe mw mx my mz b">package.lock.json</code>或<code class="fe mw mx my mz b">yarn.lock</code>文件中，其中一个是<code class="fe mw mx my mz b">resolved</code>，我们获得该依赖项的URL:</p><pre class="kg kh ki kj gt oc mz od oe aw of bi"><span id="3fb3" class="og ma iq mz b gy oh oi l oj ok">// package.lock<br/>{<br/>  // ....<br/> "node_modules/my-package": {<br/>      "version": "1.6.0",<br/>      "resolved": "http://localhost:4873/my-package-1.6.0.tgz",<br/>   // ....<br/>  }<br/>}</span></pre><p id="6c5f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这意味着，如果您使用本地服务器URL提交和推送锁文件，无论您的项目将在哪里构建或测试(比如CI/CD)，它都会失败，因为那里没有localhost:4887。</p><p id="5733" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从这个意义上来说，我们总是想记住在推送任何代码之前清理这个变更。</p><p id="c762" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">此外，与Symlink不同的是，在Symlink中，您可以打开一个<code class="fe mw mx my mz b">watch</code>模式来编译文件并直接在您的项目中看到这些更改，使用这种方法，您需要发布一个新版本，并在您做出每个新更改时安装该版本。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fb32" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="75c0" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">我希望你喜欢这个。</p><p id="08d3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有了这样一个简单的解决方案，现在您就能够毫无困难地测试产品发布/消费包工作流了。</p><h1 id="31fe" class="lz ma iq bd mb mc na me mf mg nb mi mj jw nc jx ml jz nd ka mn kc ne kd mp mq bi translated">参考</h1><ul class=""><li id="aa5d" class="nf ng iq ky b kz mr lc ms lf om lj on ln oo lr op nl nm nn bi translated"><a class="ae kv" href="https://verdaccio.org/" rel="noopener ugc nofollow" target="_blank"> Verdaccio网站</a></li><li id="a9ea" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated"><a class="ae kv" href="https://classic.yarnpkg.com/en/docs/cli/link/" rel="noopener ugc nofollow" target="_blank">纱线符号链</a></li><li id="74bb" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated"><a class="ae kv" href="https://docs.npmjs.com/cli/v6/commands/npm-link" rel="noopener ugc nofollow" target="_blank"> NPM符号链</a></li><li id="330e" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Symbolic_link" rel="noopener ugc nofollow" target="_blank">符号链接—维基百科</a></li><li id="de5d" class="nf ng iq ky b kz no lc np lf nq lj nr ln ns lr op nl nm nn bi translated"><a class="ae kv" href="https://dev.to/khenhey/test-global-npm-packages-in-a-quick-and-easy-way-4nld" rel="noopener ugc nofollow" target="_blank">卡琳以快速简单的方式测试全球国家预防机制包</a></li></ul></div></div>    
</body>
</html>