<html>
<head>
<title>JavaScript Closures and Their Scope Bubbles</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript闭包及其范围气泡</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/javascript-closures-and-their-scope-bubbles-a6bef7a4824e?source=collection_archive---------20-----------------------#2021-08-02">https://javascript.plainenglish.io/javascript-closures-and-their-scope-bubbles-a6bef7a4824e?source=collection_archive---------20-----------------------#2021-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="03f8" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">JavaScript闭包的初学者友好指南。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d6b02d4addbca31b41c8f2e27e60243d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xILq_xDniXAR8qUdf0NpfQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@marcsm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Marc Sendra Martorell</a> on <a class="ae kv" href="https://unsplash.com/s/photos/bubbles?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b44e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">当我第一次开始深入学习JavaScript时，闭包的概念对我来说是比较难的概念之一。虽然我读了很多关于它的东西，但直到我开始在工作中使用它，我才真正理解它。</p><p id="24db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果您是闭包的新手，让我们从这里开始:闭包本质上是一个对象，它具有一个或多个与对象周围环境捆绑在一起的函数。环境通常包括闭包需要的变量，这些变量不能在程序的主范围内直接访问。</p><p id="fdb1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我们将看一个简单的闭包，然后看看它是如何使用的。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="630e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">一个例子</h1><p id="a1b8" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">一个闭包通常驻留在一个更大的函数中，这个更大的函数中的环境充当闭包的环境“气泡”换句话说，闭包的<a class="ae kv" href="https://www.w3schools.com/js/js_scope.asp" rel="noopener ugc nofollow" target="_blank">范围</a>是由这个更大的函数划分的。</p><p id="437f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个函数及其周围范围气泡的例子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">An example of a simple closure</figcaption></figure><p id="ac65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为这四个函数是附加在一个对象上的，所以我们也可以称之为<em class="my">方法。</em>当我们在代码中找到这些方法之一时—</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="4fe2" class="ne ma iq na b gy nf ng l nh ni">let num = counter.get();</span></pre><p id="8dba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">—我们访问函数<em class="my">加上</em>它的周围环境，这就是闭包。所以你可以说上面的代码片段提供了四种不同的闭包。</p><p id="c6a6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们看一下代码片段中的几个关键行。</p><p id="2028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在第1行，<code class="fe nj nk nl na b">counter</code>变量被设置为等于一个立即调用的函数表达式(life)——我们所说的“气泡”。由于第20行末尾的括号，当程序开始时，生命就开始了。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="2f75" class="ne ma iq na b gy nf ng l nh ni">let counter = (function() {</span><span id="0299" class="ne ma iq na b gy nm ng l nh ni">   // code hidden for clarity</span><span id="2d94" class="ne ma iq na b gy nm ng l nh ni">})(); // &lt;-- the parenthesis make the function start immediately</span></pre><p id="93fa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个生命返回一个具有四种功能的对象:</p><ul class=""><li id="924a" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated"><code class="fe nj nk nl na b">get</code>，它简单地获取<code class="fe nj nk nl na b">count</code>值。</li><li id="ef40" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><code class="fe nj nk nl na b">set</code>，它将<code class="fe nj nk nl na b">count</code>值设置为我们想要的任何值。</li><li id="fe21" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><code class="fe nj nk nl na b">increment,</code>它将现有值增加作为参数传入的数量。如果没有传入任何值，它会将该值递增1。</li><li id="89ea" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated"><code class="fe nj nk nl na b">reset</code>方法将<code class="fe nj nk nl na b">count</code>值重置为零。</li></ul><p id="7b76" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">由于这些方法都需要那个<code class="fe nj nk nl na b">count</code>变量，JavaScript引擎足够聪明，能够意识到<code class="fe nj nk nl na b">count</code>变量的重要性——所以引擎的垃圾收集器不会删除它。</p><p id="93a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些方法是用户访问<code class="fe nj nk nl na b">count</code>值的唯一方式。这样，闭包的使用使得<code class="fe nj nk nl na b">count</code>值的行为类似于Java等更传统的面向对象语言中的私有变量。私有变量不能在它们所在的对象之外直接访问，因此需要方法来检索或更新它们的值。这使得它们更难被无意中弄乱。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f937" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">演示</h1><p id="2590" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">在下面的演示中，您将看到实际操作中的封口。所有四个都被使用，结果打印出三个值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ob mx l"/></div></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="993e" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">调用闭包的方法</h1><p id="bd24" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">下面是调用闭包的每个方法的<code class="fe nj nk nl na b">init</code>函数。看看它是如何工作的，看看您是否能理解是什么决定了要打印的三个值。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="0e67" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们回顾一下发生了什么。首先，我们首先获取要打印的HTML元素的引用。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ef7f" class="ne ma iq na b gy nf ng l nh ni">let span1 = document.querySelector('#test1 span');<br/>let span2 = document.querySelector('#test2 span');<br/>let span3 = document.querySelector('#test3 span');</span></pre><p id="4acb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们使用<code class="fe nj nk nl na b">counter</code>对象将<code class="fe nj nk nl na b">count</code>的值<code class="fe nj nk nl na b">set</code>转换为<code class="fe nj nk nl na b">10</code>。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="5ab7" class="ne ma iq na b gy nf ng l nh ni">counter.set(10);</span></pre><p id="73bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们<code class="fe nj nk nl na b">get</code>值<code class="fe nj nk nl na b">count</code>，将其存储在<code class="fe nj nk nl na b">val1</code>中，并将<code class="fe nj nk nl na b">10</code>的结果值打印到第一个<code class="fe nj nk nl na b">&lt;span&gt;</code>元素。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="f8f2" class="ne ma iq na b gy nf ng l nh ni">let val1 = counter.get();</span><span id="40d9" class="ne ma iq na b gy nm ng l nh ni">span1.textContent = val1;</span></pre><p id="1c39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">接下来，我们通过<code class="fe nj nk nl na b">2</code>得到<code class="fe nj nk nl na b">increment</code>的<code class="fe nj nk nl na b">count</code>值。我们再次<code class="fe nj nk nl na b">get</code>修改后的值，现在是<code class="fe nj nk nl na b">12</code>，并打印出来。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="528f" class="ne ma iq na b gy nf ng l nh ni">counter.increment(2);<br/>let val2 = counter.get();<br/>span2.textContent = val2;</span></pre><p id="b994" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后我们将值<code class="fe nj nk nl na b">reset</code>给<code class="fe nj nk nl na b">0</code>并不带参数调用<code class="fe nj nk nl na b">increment</code>，因此值增加了<code class="fe nj nk nl na b">1</code>。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="ac9c" class="ne ma iq na b gy nf ng l nh ni">counter.reset();<br/>counter.increment();</span></pre><p id="f131" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这之后，我们最后一次<code class="fe nj nk nl na b">get</code>这个值，现在是<code class="fe nj nk nl na b">1,</code>并打印它。</p><pre class="kg kh ki kj gt mz na nb nc aw nd bi"><span id="7981" class="ne ma iq na b gy nf ng l nh ni">let val3 = counter.get();<br/>span3.textContent = val3;</span></pre><p id="cd90" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你试图在生活之外直接调用<code class="fe nj nk nl na b">count</code>，你将一事无成——你必须使用这些方法来检索和更新<code class="fe nj nk nl na b">count</code>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f2bb" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">外卖食品</h1><p id="7ba7" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">由于能够理解它们，我发现闭包非常有用，尤其是当我有多个相关变量，而我不想污染全局名称空间的时候。当编写复杂的程序时，您可以构建多个函数表达式，每个表达式都作为自己的作用域气泡，具有自己不同的目的、方法和私有变量。这种用内置闭包创建立即调用函数表达式的方式也被称为<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/data-hiding-with-javascript-module-pattern-62b71520bddd">模块设计模式</a>。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="decc" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">后续步骤</h1><p id="f634" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">如果您有兴趣学习更多关于JavaScript中闭包的知识，请尝试以下方法:</p><ul class=""><li id="d7c3" class="nn no iq ky b kz la lc ld lf np lj nq ln nr lr ns nt nu nv bi translated">下次你写程序的时候，试着用上面的风格创建一个带有闭包的表达式来代替其他的解决方案，比如全局变量。</li><li id="0eed" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">探索现有的方法，比如<code class="fe nj nk nl na b">setTimeout</code>，如何使用闭包。</li><li id="dcc9" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">将闭包与JavaScript类进行比较，评估哪一个更适合特定的用例。</li><li id="2811" class="nn no iq ky b kz nw lc nx lf ny lj nz ln oa lr ns nt nu nv bi translated">如果你申请的是一个开发人员的职位，寻找那些关注闭包的面试问题，并练习回答它们。</li></ul><p id="a28b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇快速的帖子能让你对闭包有一个坚实的概念。感谢阅读！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="fa89" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">在别处</h1><p id="a737" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">下面是另外两篇关于JavaScript的文章，可能对你有所帮助。</p><div class="oc od gp gr oe of"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-create-a-timestamp-from-a-date-object-in-javascript-760d58a3511f"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">如何用JavaScript创建时间戳</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">让我们解包一个日期对象并提取我们需要的信息。</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oo l"><div class="op l oq or os oo ot kp of"/></div></div></a></div><div class="oc od gp gr oe of"><a rel="noopener  ugc nofollow" target="_blank" href="/from-camel-case-to-dash-syntax-in-javascript-c685206ee682"><div class="og ab fo"><div class="oh ab oi cl cj oj"><h2 class="bd ir gy z fp ok fr fs ol fu fw ip bi translated">JavaScript中从骆驼大小写到破折号的语法</h2><div class="om l"><h3 class="bd b gy z fp ok fr fs ol fu fw dk translated">仔细看看一个概念丰富的代码片段。</h3></div><div class="on l"><p class="bd b dl z fp ok fr fs ol fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="oo l"><div class="ou l oq or os oo ot kp of"/></div></div></a></div><p id="98d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="my">更多内容尽在</em><a class="ae kv" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir"><em class="my">plain English . io</em></strong></a></p></div></div>    
</body>
</html>