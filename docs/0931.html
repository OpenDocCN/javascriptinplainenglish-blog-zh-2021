<html>
<head>
<title>Server-Side Development with Fastify — Route Declarations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Fastify进行服务器端开发—路由声明</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/server-side-development-with-fastify-route-declarations-ad32f0e16f15?source=collection_archive---------13-----------------------#2021-02-26">https://javascript.plainenglish.io/server-side-development-with-fastify-route-declarations-ad32f0e16f15?source=collection_archive---------13-----------------------#2021-02-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/96fa767b385367254daa8d2693ea79bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pi_r7nbc7wYzsZm6"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@i_am_g?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Guillaume Jaillet</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a83e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fastify是一个用于开发后端web应用程序的小型节点框架。</p><p id="af85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何使用Fastify创建后端应用程序。</p><h1 id="8876" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">路线声明速记</h1><p id="1233" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Fastify附带了声明路线的简写方法。</p><p id="2e2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些方法包括:</p><ul class=""><li id="7164" class="me mf iq kf b kg kh kk kl ko mg ks mh kw mi la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.get(path, [options], handler)</code></li><li id="7751" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.head(path, [options], handler)</code></li><li id="65ab" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.post(path, [options], handler)</code></li><li id="7503" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.put(path, [options], handler)</code></li><li id="595b" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.delete(path, [options], handler)</code></li><li id="a311" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.options(path, [options], handler)</code></li><li id="c2ad" class="me mf iq kf b kg mr kk ms ko mt ks mu kw mv la mj mk ml mm bi translated"><code class="fe mn mo mp mq b">fastify.patch(path, [options], handler)</code></li></ul><p id="655f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="ff33" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="f270" class="ne lc iq mq b gy nj ng l nh ni">const opts = {<br/>  schema: {<br/>    response: {<br/>      200: {<br/>        type: 'object',<br/>        properties: {<br/>          hello: { type: 'string' }<br/>        }<br/>      }<br/>    }<br/>  }<br/>}<br/>fastify.get('/', opts, (request, reply) =&gt; {<br/>  reply.send({ hello: 'world' })<br/>})</span><span id="91ee" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="827e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建<code class="fe mn mo mp mq b">opts</code>来设置响应模式。</p><p id="5d24" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们把它作为第二个参数传递给<code class="fe mn mo mp mq b">get</code>方法。</p><p id="b51d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以写:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="bccb" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="abb1" class="ne lc iq mq b gy nj ng l nh ni">const opts = {<br/>  schema: {<br/>    response: {<br/>      200: {<br/>        type: 'object',<br/>        properties: {<br/>          hello: { type: 'string' }<br/>        }<br/>      }<br/>    }<br/>  },<br/>  handler: function (request, reply) {<br/>    reply.send({ hello: 'world' })<br/>  }<br/>}<br/>fastify.get('/', opts)</span><span id="7ed6" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="3c4b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">将<code class="fe mn mo mp mq b">handler</code>方法放在<code class="fe mn mo mp mq b">opts</code>对象中，而不是传递给第三个参数。</p><h1 id="7b6c" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Url构建</h1><p id="866c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Fastify支持静态和动态URL。</p><p id="94a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以通过编写以下内容来注册参数路径:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="6544" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="1f4c" class="ne lc iq mq b gy nj ng l nh ni">fastify.get('/example/:userId', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})<br/>fastify.get('/example/:userId/:secretToken', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})<br/>fastify.get('/example/*', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})</span><span id="0769" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="f966" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加路线。</p><p id="99be" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mn mo mp mq b">:userId</code>和<code class="fe mn mo mp mq b">:secretToken</code>是URL参数。</p><p id="7aae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe mn mo mp mq b">*</code>是通配符。</p><p id="67fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们可以使用正则表达式来匹配URL路由模式。</p><p id="996b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="9438" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="9cd0" class="ne lc iq mq b gy nj ng l nh ni">fastify.get('/example/:file(^\\d+).png', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})</span><span id="367b" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="2cb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将URL模式与<code class="fe mn mo mp mq b">(^\\d+)</code>模式进行匹配。</p><p id="3e1d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，当我们转到<code class="fe mn mo mp mq b">/example/1.png</code>时，我们会看到返回的响应。</p><p id="82e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用斜杠定义多个路由参数。</p><p id="2091" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="e43c" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="9cfc" class="ne lc iq mq b gy nj ng l nh ni">fastify.get('/example/near/:lat-:lng/radius/:r', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})</span><span id="a8d5" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><p id="f209" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加<code class="fe mn mo mp mq b">:lat-lng</code>和<code class="fe mn mo mp mq b">:r</code>路线参数。</p><p id="238e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用正则表达式做同样的事情:</p><pre class="mw mx my mz gt na mq nb nc aw nd bi"><span id="9f53" class="ne lc iq mq b gy nf ng l nh ni">const fastify = require('fastify')()</span><span id="94c0" class="ne lc iq mq b gy nj ng l nh ni">fastify.get('/example/at/:hour(^\\d{2})h:minute(^\\d{2})m', (request, reply) =&gt; {<br/>  reply.send('example')<br/>})</span><span id="c988" class="ne lc iq mq b gy nj ng l nh ni">const start = async () =&gt; {<br/>  try {<br/>    await fastify.listen(3000, '0.0.0.0')  <br/>  } catch (err) {<br/>    fastify.log.error(err)    <br/>    process.exit(1)<br/>  }<br/>}<br/>start()</span></pre><h1 id="f46d" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="ed7f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用Fastify声明具有各种匹配模式的路线。</p><p id="33ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="nk">查看更多内容请点击</em><a class="ae kc" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kf ir"><em class="nk">plain English . io</em></strong></a></p></div></div>    
</body>
</html>