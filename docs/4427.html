<html>
<head>
<title>Essential JavaScript Tooling</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基本JavaScript工具</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/essential-javascript-tooling-574797521da4?source=collection_archive---------15-----------------------#2021-09-03">https://javascript.plainenglish.io/essential-javascript-tooling-574797521da4?source=collection_archive---------15-----------------------#2021-09-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="207d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">开发者体验很重要</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/66b891ecae184bf43036cc61d3ac9c18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IDVb8B7Wh_ictHSg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@jeshoots?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">JESHOOTS.COM</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0948" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">快速小结</h1><p id="5223" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">软件开发很棒也很有趣，但是如果开发人员的体验没有得到重视和优先考虑，它会变得一塌糊涂并产生非常坏的影响。一些标准的开发实践和适当的工具可以极大地改善这种体验。这也有助于保持代码库的干净和存储库的健康。在本文中，我们将介绍一些开发实践和基本工具，以帮助您改善开发体验。</p><h1 id="3daf" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">观众</h1><p id="1802" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">本文主要面向JS开发人员，涵盖了JS生态系统中的工具，但是，同样的概念也可以用其他语言中可用的工具来应用。我们将在本文中讨论以下主题。</p><ul class=""><li id="6bd6" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated">使用<a class="ae ks" href="https://eslint.org/" rel="noopener ugc nofollow" target="_blank"> ESLint </a>对林挺进行编码。</li><li id="e73a" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">使用<a class="ae ks" href="https://prettier.io/" rel="noopener ugc nofollow" target="_blank">更漂亮的</a>进行代码格式化。</li><li id="536b" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">为林挺和代码格式化设置<a class="ae ks" href="https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks" rel="noopener ugc nofollow" target="_blank"> Git挂钩</a>。</li><li id="2bbc" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated">常规提交使用<a class="ae ks" href="https://github.com/commitizen/cz-cli" rel="noopener ugc nofollow" target="_blank">提交</a>。</li><li id="8373" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><a class="ae ks" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank">用于CI/CD的Github操作</a>。</li></ul><h1 id="7211" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">代码-林挺</h1><p id="cf58" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">代码林挺是必不可少的，尤其是当你使用JavaScript这样的解释性语言时。Linters本质上是静态代码分析器，它扫描你的代码而不运行它，并标记任何编程错误、风格错误和任何可疑的契约。在您的代码库中正确设置linter有助于尽早发现错误，并确保遵循一些标准实践。这使得代码库干净并且有助于代码审查。</p><p id="a6b4" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">Linters可以强制执行代码样式和规则，比如没有未使用的变量或没有console.log语句或没有未使用的导入事实上，它是一个非常强大的工具，可以做的远不止这些。</p><p id="0d52" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">设置Linters可能是乏味和累人的，但一旦你采用它并开始在你的团队中正确使用它，它会带来很大的效果。我个人认为，linters和这样的工具应该与语言本身一起提供，开发人员不应该担心设置一个。这种体验通过<a class="ae ks" href="https://deno.land/" rel="noopener ugc nofollow" target="_blank">deno</a>(JavaScript和TypeScript的安全运行时)得到了很大的改善，它带有内置的linter和JavaScript和TypeScript格式化程序。</p><p id="a93b" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在我们对linters有了基本的了解，让我们看看如何在TypeScript项目中设置它。我们将使用ESLint，它在JS生态系统中非常流行，并且是完全可插拔的。ESLint中的每个规则都是一个插件，这意味着你可以从一个基本配置开始，然后通过添加更多的规则作为插件来扩展规则以满足你的需求。</p><p id="bcff" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">创建一个新文件夹并运行<code class="fe na nb nc nd b">npm init -y</code>来初始化您的项目，这将在根目录中创建一个带有一些存根字段的<code class="fe na nb nc nd b">package.json</code>。</p><p id="6ff5" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">接下来，将所需的<code class="fe na nb nc nd b">dev-dependencies</code>安装到项目中。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="bd83" class="ni ku in nd b gy nj nk l nl nm">yarn add -D nodemon ts-node eslint typescript @typescript-eslint/eslint-plugin @typescript-eslint/parser</span></pre><p id="13b6" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">让我们首先通过运行<code class="fe na nb nc nd b">tsc --init</code>快速设置TypeScript，这将初始化项目根目录中的<code class="fe na nb nc nd b">tsconfig.json</code>文件，我们唯一要改变的是<code class="fe na nb nc nd b">outdir</code>选项并将其改为<code class="fe na nb nc nd b">dist</code></p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="5fb7" class="ni ku in nd b gy nj nk l nl nm">// tsconfig.json</span><span id="600d" class="ni ku in nd b gy nn nk l nl nm">"outDir": "dist"</span></pre><p id="dbcf" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">接下来，在项目的根目录中添加一个<code class="fe na nb nc nd b">.eslintrc</code>文件。这将是<code class="fe na nb nc nd b">eslint</code>的配置文件，我们可以在这里定制我们的规则。为了快速开始，让我们向该文件添加一个最低限度的配置。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="37b1" class="ni ku in nd b gy nj nk l nl nm">{<br/>  "root": true,<br/>  "parser": "@typescript-eslint/parser",<br/>  "plugins": ["@typescript-eslint"],<br/>  "extends": [<br/>    "eslint:recommended",<br/>    "plugin:@typescript-eslint/recommended",<br/>  ]<br/>}</span></pre><p id="564a" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">让我们简单地看一下这些选项，<code class="fe na nb nc nd b">root</code>键基本上告诉eslint停止在父目录中查找配置文件。默认情况下，eslint会在所有父文件夹中查找配置文件，直到找到根目录，这可能会导致意外的结果，此外，当您有一个monorepo并且每个项目使用不同的配置时，这个选项会非常方便。</p><p id="7101" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated"><code class="fe na nb nc nd b">extends</code>键允许您添加您想要用于项目的配置。这可以是指定配置的字符串或配置文件的路径，这里我们使用了两个配置，第一个是<a class="ae ks" href="https://eslint.org/docs/rules/" rel="noopener ugc nofollow" target="_blank"> eslint推荐的</a>，下一个是typescript-eslint推荐的。也可以用<a class="ae ks" href="https://www.npmjs.com/package/eslint-config-airbnb-typescript" rel="noopener ugc nofollow" target="_blank">Airbnb-typescript</a>config，也很受欢迎。</p><p id="5db1" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在让我们在<code class="fe na nb nc nd b">package.json</code>中添加一些脚本，以开发模式运行我们的项目，并为林挺添加一个脚本。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="e882" class="ni ku in nd b gy nj nk l nl nm">"dev": "nodemon --watch '**/*.ts' --exec 'ts-node' src/index.ts",<br/>"lint": "eslint . --ext .ts"</span></pre><p id="c602" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">为了测试我们的eslint设置，让我们创建一个<code class="fe na nb nc nd b">index.ts</code>文件和一个非常简单的for循环，其中包含一个未使用的变量。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="5925" class="ni ku in nd b gy nj nk l nl nm">//src/index.ts</span><span id="3920" class="ni ku in nd b gy nn nk l nl nm">const range = 10;</span><span id="41eb" class="ni ku in nd b gy nn nk l nl nm">for (let i = 0; i &lt; 10; i++) {<br/>  console.log("i : ", i);<br/>}</span></pre><p id="f980" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在让我们运行<code class="fe na nb nc nd b">yarn lint</code>，我们将在控制台上得到一个警告。</p><p id="3801" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这很好，我们的eslint设置正在工作，但是假设我们希望对我们的代码库更加严格，希望这是一个错误，并导致lint失败，那么就在您的<code class="fe na nb nc nd b">.eslintrc</code>文件中添加下面的规则。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="eab6" class="ni ku in nd b gy nj nk l nl nm">{<br/>  "root": true,<br/>  "parser": "@typescript-eslint/parser",<br/>  "plugins": ["@typescript-eslint"],<br/>  "extends": ["eslint:recommended", "plugin:@typescript-       eslint/recommended"],<br/>  "rules": {<br/>    "no-unused-vars": "error"  // "error" | "warn" | "off"<br/>  }<br/>}</span></pre><p id="2a1a" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在，如果你运行<code class="fe na nb nc nd b">yarn lint</code>，你的控制台会显示这是一个错误，lint不会成功，如果你在vs代码上安装了eslint扩展，它也会突出显示这个问题。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi no"><img src="../Images/3c0ebe1ae148683cfd6045cd8e4a6f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kgkv0tDerIeZmSNTGpoKTg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Lint-error</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi np"><img src="../Images/6252c11d81218e83c2411a16631d1835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9ryGfz35LyS-7FNuYeJUA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Lint-script-result</figcaption></figure><p id="e900" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">我们还可以添加另一个脚本来自动修复lint问题，请注意，并非所有问题都可以自动修复，您可以在这里<a class="ae ks" href="https://eslint.org/docs/rules/" rel="noopener ugc nofollow" target="_blank">获得可以自动修复的所有规则的列表</a>。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="2a52" class="ni ku in nd b gy nj nk l nl nm">"lint-fix": "eslint . --ext .ts --fix"</span></pre><p id="0ce3" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这就是林挺的设置，我希望你现在可以为自己创建一个心智模型，看看这个工具如果使用得当会有多有用。</p><h1 id="de5c" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">代码格式</h1><p id="9b42" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">让我们接受这一点，在回购中看到不同的代码风格是混乱的，如果不加以控制，你可以看到回购中遵循的各种代码约定。这就是代码格式化程序帮助我们的地方，但是在我们开始在项目中设置代码格式化程序之前，我们首先需要理解代码格式化程序和linters本质上是不同的东西，尽管它们之间只有一线之隔，但是它们都服务于不同的目的。代码格式化程序本质上处理代码的格式化，并应用您指定的代码样式，它们不检查代码中潜在的错误或问题，并遵循样式。</p><p id="3257" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">prettle是JS生态系统中一个非常著名的工具，我们将在我们的项目中设置它，用它我们可以强制样式规则，比如最大长度、标签宽度、单引号、分号等等。它基本上是一个自以为是的代码格式化程序，获取您的代码并将其解析为AST(抽象语法树),放弃原始样式，之后它只是用您指定的代码样式漂亮地打印AST。</p><p id="f3ca" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">让我们开始吧，首先我们需要安装开发依赖项:</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="b0f2" class="ni ku in nd b gy nj nk l nl nm">yarn add -D prettier eslint-config-prettier eslint-plugin-prettier</span></pre><p id="a5e4" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">让我们快速解释一下上面的开发依赖性以及它们的用途。</p><ul class=""><li id="f0ae" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated"><code class="fe na nb nc nd b">prettier</code>:固执己见的代码格式化者。</li><li id="ca3d" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><code class="fe na nb nc nd b">eslint-config-prettier</code>:用于禁用所有可能与prettier冲突的eslint规则。</li><li id="ce74" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><code class="fe na nb nc nd b">eslint-plugin-prettier</code>:作为一个eslint规则运行起来更漂亮</li></ul><p id="fb09" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在在你的根目录下创建一个<code class="fe na nb nc nd b">.prettierrc</code>文件，并添加下面的配置。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="f05c" class="ni ku in nd b gy nj nk l nl nm">//.prettierrc</span><span id="c2dd" class="ni ku in nd b gy nn nk l nl nm">{<br/>  "semi": true,<br/>  "trailingComma": "none",<br/>  "singleQuote": false,<br/>  "printWidth": 120,<br/>  "tabWidth": 2,<br/>  "arrowParens": "always",<br/>  "bracketSpacing": true<br/>}</span></pre><p id="43fa" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这些规则指定在末尾使用分号，删除尾部逗号，对字符串使用双引号等，你可以在这里阅读更多关于规则<a class="ae ks" href="https://prettier.io/docs/en/options.html" rel="noopener ugc nofollow" target="_blank">的内容，并根据你的喜好设置它们。</a></p><p id="bcad" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在我们已经设置好了规则，让我们添加一个脚本来格式化我们的代码。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="1cba" class="ni ku in nd b gy nj nk l nl nm">"format": "prettier --config .prettierrc 'src/**/*.ts' --write"</span></pre><p id="cc38" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这就是我们已经在我们的项目中配置得更漂亮了，现在每当你运行这个脚本时，它将根据你定义的配置格式化你在<code class="fe na nb nc nd b">src</code>目录中的所有源代码。测试一下，使用一些单引号或者去掉分号，然后运行<code class="fe na nb nc nd b">yarn format</code>。也可以安装更漂亮的vs代码扩展，并在保存时将其设置为format。</p><p id="56c6" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在我们有了更漂亮的设置，让我们用eslint配置它，如下更新你的<code class="fe na nb nc nd b">.eslintrc</code>,你就可以更漂亮地使用eslint并在eslint配置中配置为插件。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="19d1" class="ni ku in nd b gy nj nk l nl nm">{<br/>  "root": true,<br/>  "parser": "@typescript-eslint/parser",<br/>  "plugins": ["@typescript-eslint", "prettier"],<br/>  "extends": [<br/>    "eslint:recommended",<br/>    "plugin:@typescript-eslint/recommended",<br/>    "prettier"<br/>  ],<br/>  "rules": {<br/>    "no-unused-vars": "error",<br/>    "prettier/prettier": "error"<br/>  }<br/>}</span></pre><h1 id="cbc4" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">Git挂钩</h1><p id="912d" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">酷，如果你一直在关注这里，这是最令人兴奋的地方，你一定想知道我们设置了这些工具是多么好，但有人仍然可以在不运行这些脚本的情况下提交回购，这就是g it钩子来拯救我们的地方。Git挂钩只是每当存储库中发生事件时自动运行的脚本。我们将使用一个叫做<a class="ae ks" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank"> husky </a>的工具，它使得使用git-hooks变得容易。</p><p id="695d" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">让我们快速地将它安装为一个开发依赖项。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="a091" class="ni ku in nd b gy nj nk l nl nm">yarn add -D husky</span><span id="8573" class="ni ku in nd b gy nn nk l nl nm">// Also add a prepare script to your package.json as below.</span><span id="37f0" class="ni ku in nd b gy nn nk l nl nm">"prepare": "husky install"</span><span id="80df" class="ni ku in nd b gy nn nk l nl nm">// Now run</span><span id="6631" class="ni ku in nd b gy nn nk l nl nm">yarn prepare</span></pre><p id="1987" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated"><code class="fe na nb nc nd b">prepare</code>是一个npm生命周期脚本，将在<code class="fe na nb nc nd b">npm install</code>上运行，这将确保无论何时安装节点模块，husky也会被安装。点击阅读更多关于生命周期脚本的信息<a class="ae ks" href="https://docs.npmjs.com/cli/v7/using-npm/scripts#life-cycle-scripts" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="0f5e" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">就这样，<a class="ae ks" href="https://github.com/typicode/husky" rel="noopener ugc nofollow" target="_blank"> husky </a>现在已经在我们的项目中设置好了，我们可以配置它在提交之前运行我们的<code class="fe na nb nc nd b">lint</code>和<code class="fe na nb nc nd b">format</code>脚本，为此我们可以使用在提交之前运行的<code class="fe na nb nc nd b">pre-commit</code>钩子。现在让我们添加钩子，到终端，运行下面的命令。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="bf43" class="ni ku in nd b gy nj nk l nl nm">npx husky add .husky/pre-commit "yarn lint &amp;&amp; yarn format"</span></pre><p id="5e39" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">您会注意到，现在在您的repo的根目录下有一个<code class="fe na nb nc nd b">.husky</code>文件夹，其中包含一个文件<code class="fe na nb nc nd b">pre-commit</code>，其内容如下。这个钩子会在你每次提交回购时运行。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="8d1f" class="ni ku in nd b gy nj nk l nl nm">#!/bin/sh<br/>. "$(dirname "$0")/_/husky.sh"</span><span id="8857" class="ni ku in nd b gy nn nk l nl nm">yarn lint &amp;&amp; yarn format</span></pre><p id="0be8" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在试着在repo中提交一些东西，你会注意到<code class="fe na nb nc nd b">lint</code>和<code class="fe na nb nc nd b">format</code>脚本首先被执行。如果一切正常，您的提交将被成功添加，如果出现问题，它将不会被提交到回购，您必须解决这些问题才能进行提交。现在，您应该能够对此建立一个心理模型，这可以确保没有潜在错误或样式问题的代码提交到回购中。如果正确遵循这些约定，这可以帮助您节省大量的代码审查时间。</p><p id="7f69" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这种配置很好，但如果您注意到这种方法有一个问题，如果我们有一个非常大的代码库，并且我们在代码库中对每次提交都运行林挺和格式化，这可能会花费更长时间，这不是预期的用例，我们只想对已准备提交的文件运行它，因为理想情况下，只应检查那些正在提交到回购的文件，这是另一个工具<code class="fe na nb nc nd b">lint-staged</code>来拯救我们的地方，它将确保我们的预提交挂钩只在准备文件上运行。这也可以快速配置。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="bc88" class="ni ku in nd b gy nj nk l nl nm">yarn add -D lint-staged</span><span id="c447" class="ni ku in nd b gy nn nk l nl nm">// Add below config to your package.json</span><span id="78ec" class="ni ku in nd b gy nn nk l nl nm">"lint-staged": {<br/>  "src/**/*.ts": [<br/>    "yarn lint",<br/>    "yarn format"<br/>  ],<br/>},</span></pre><p id="1c1f" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">并且更新你的<code class="fe na nb nc nd b">pre-commit</code>钩子运行<code class="fe na nb nc nd b">npx lint-staged</code>而不是运行<code class="fe na nb nc nd b">yarn lint &amp;&amp; yarn format</code></p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="4a75" class="ni ku in nd b gy nj nk l nl nm">#!/bin/sh<br/>. "$(dirname "$0")/_/husky.sh"</span><span id="ccfb" class="ni ku in nd b gy nn nk l nl nm">npx lint-staged</span></pre><p id="7797" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">就是这样，现在lint将只对暂存的文件运行，您可以通过在repo中创建一个有lint问题的文件来快速测试它，并且不要暂存它，同时暂存一些符合lint规则的其他文件，您应该注意到git commit将正常运行，但是如果您暂存有lint问题的文件，它将阻止提交，并在终端上向您提供应该修复的lint错误。如果你想lint整个项目，你仍然可以通过运行<code class="fe na nb nc nd b">yarn lint</code>来完成。现在，我们的工具已经设置得足够好了，可以确保整个团队能够遵循它，并坚持相同的编码标准和风格指南。</p><h1 id="3f76" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">常规提交</h1><p id="ba82" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们的开发设置已经非常完整了，但是团队仍然有一个地方可以采用不同的约定，那就是提交消息，是的，没错，人们在添加提交消息时可以有不同的偏好，我们需要确保团队符合标准约定。我们将在我们的项目中采用<a class="ae ks" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交规范</a>，并使用名为<code class="fe na nb nc nd b">commitizen</code>的工具来确保它</p><p id="fe5b" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">该规范的一般语法如下:</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="3d28" class="ni ku in nd b gy nj nk l nl nm">&lt;type&gt;[optional scope]: &lt;description&gt;</span><span id="3b87" class="ni ku in nd b gy nn nk l nl nm">[optional body]</span><span id="4a90" class="ni ku in nd b gy nn nk l nl nm">[optional footer(s)]</span><span id="7034" class="ni ku in nd b gy nn nk l nl nm">// Example</span><span id="047d" class="ni ku in nd b gy nn nk l nl nm">feat(landing-page): add new landing page</span><span id="519d" class="ni ku in nd b gy nn nk l nl nm">A new landing page for the website...</span><span id="b458" class="ni ku in nd b gy nn nk l nl nm">Closes #&lt;github-issue-number&gt;</span></pre><p id="27d7" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">好了，现在我们已经理解了规范，让我们配置我们的项目来使用这个工具。</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="d556" class="ni ku in nd b gy nj nk l nl nm">yarn add -D commitizen cz-conventional-changelog</span></pre><p id="8bdd" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">并将此添加到您的<code class="fe na nb nc nd b">pacakge.json</code>:</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="3656" class="ni ku in nd b gy nj nk l nl nm">"config": {<br/>  "commitizen": {<br/>    "path": "cz-conventional-changelog"<br/>  }<br/>}</span><span id="6109" class="ni ku in nd b gy nn nk l nl nm">"scripts": {<br/>  "cz": "cz",<br/>	... <br/>}</span></pre><p id="063e" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated"><em class="nq">注意:如果您最终将脚本命名为</em> <code class="fe na nb nc nd b"><em class="nq">commit</em></code> <em class="nq">，那么它可能会运行两次，因为回购协议上提到了</em> <a class="ae ks" href="https://github.com/commitizen/cz-cli#optional-install-and-run-commitizen-locally" rel="noopener ugc nofollow" target="_blank"> <em class="nq">这个问题</em> </a> <em class="nq">。</em></p><p id="7b2f" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">现在，尝试通过运行<code class="fe na nb nc nd b">yarn cz</code>提交回购，终端上会提示您几个问题，以便正确提交。很好，现在我们的常规提交已经设置好了，我们也可以通过运行下面的命令，并使用由<code class="fe na nb nc nd b">git commit</code>调用的<code class="fe na nb nc nd b">prepare-commit-msg</code>钩子运行commitizen，将其设置为git钩子，但是这种方法有一个问题，当运行<code class="fe na nb nc nd b">yarn cz</code>时会触发git提交两次。这个问题是在回购<a class="ae ks" href="https://github.com/commitizen/cz-cli/issues/844" rel="noopener ugc nofollow" target="_blank">这里</a>打开的，我会建议不要使用这种方法，直到这个问题得到解决，并依靠以前的脚本<code class="fe na nb nc nd b">yarn cz</code></p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="cf9b" class="ni ku in nd b gy nj nk l nl nm">npx husky add .husky/prepare-commit-msg "exec &lt; /dev/tty &amp;&amp; node_modules/.bin/cz --hook || true"</span></pre><h1 id="0ba3" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">Github操作</h1><p id="196a" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">在最后一部分中，我们将重点介绍如何设置Github动作，以确保每次提交时都运行lint和format作业，以及GitHub动作如何在CI/CD管道中提供帮助。在现代软件开发中，建立一个好的、快速的CI/CD管道是非常必要的。随着软件的发展，手动编译版本可能会成为一项非常乏味的任务，如果需要在多个平台上编译，可以想象这会花费多长时间。</p><p id="15d0" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">Github actions是一个自动化软件工作流的便捷工具，它提供了您的Github代码报告之外的CI/CD。Github动作是事件驱动的，基本上需要一个<code class="fe na nb nc nd b">.yml</code>文件，您可以在其中逐步提供您的配置。</p><p id="2844" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">使用Github动作时需要考虑的一些关键术语包括</p><ul class=""><li id="2694" class="mh mi in ln b lo mj lr mk lu ml ly mm mc mn mg mo mp mq mr bi translated"><strong class="ln io">工作流程:</strong>包含一个或多个作业的自动化工作程序。</li><li id="2131" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><strong class="ln io">事件:</strong>触发工作流的活动(如推送到分支)</li><li id="c094" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><strong class="ln io">作业:</strong>在同一个流道上执行的一组步骤。</li><li id="637d" class="mh mi in ln b lo ms lr mt lu mu ly mv mc mw mg mo mp mq mr bi translated"><strong class="ln io">步骤:</strong>可以在作业上执行命令的任务。</li></ul><p id="2e35" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">你可以在官方文件上读到更多关于这些的信息。</p><p id="0276" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">首先，通过运行<code class="fe na nb nc nd b">git init</code>初始化项目中的git repo，并将您的更改提交给repo。确保您添加了一个<code class="fe na nb nc nd b">.gitignore</code>文件，并在其中添加了<code class="fe na nb nc nd b">node_modules</code>和<code class="fe na nb nc nd b">dist</code>，这样它们就不会被提交给回购。</p><p id="263d" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">接下来，在你的Github账户上创建一个repo，复制遥控器的原始URL，现在转到你的本地repo并运行</p><pre class="kd ke kf kg gt ne nd nf ng aw nh bi"><span id="d2a9" class="ni ku in nd b gy nj nk l nl nm">git remote add origin &lt;remote-repo-origin&gt;<br/>git push -u origin &lt;branch-name&gt;</span></pre><p id="21d8" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">接下来转到你的Github repo，点击Actions选项卡，选择set up a workflow yourself</p><p id="90ae" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">在编辑器中，将文件命名为<code class="fe na nb nc nd b">lint.yml</code>，并清除默认动作，将其替换为。</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nr ns l"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Lint-action</figcaption></figure><p id="1fd2" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">这个操作文件非常简单，您应该能够很容易地浏览它，我们将工作流名称声明为Lint，它只有一个作业<code class="fe na nb nc nd b">lint</code>。一个工作流可以有多个作业，默认情况下，作业并行运行，但是可以通过使用<code class="fe na nb nc nd b">.yml</code>文件中的<code class="fe na nb nc nd b">needs &lt;job-id&gt;</code>语法对其进行配置，使其按顺序运行</p><p id="5fc6" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">接下来，我们指定在Ubuntu的最新版本上运行作业，并使用<a class="ae ks" href="https://github.com/marketplace/actions/setup-node-js-environment" rel="noopener ugc nofollow" target="_blank"> marketplace动作</a>设置节点v14.16.1。之后，我们只是安装节点模块并运行lint/format脚本。</p><p id="730d" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">请注意，这是一个非常简单的示例，但是您可以根据需要扩展它，例如，假设您已经在repo中设置了测试，那么您可以定义在<code class="fe na nb nc nd b">lint</code>作业之后运行的另一个<code class="fe na nb nc nd b">test</code>作业，如果测试作业成功，您可以运行<code class="fe na nb nc nd b">build</code>作业来编译构建并部署到staging。您基本上可以配置它来适应您的需求并自动化您的开发工作流。Github actions确实是一个强大的工具，你绝对应该探索它们。</p><p id="3640" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated">你可以在我的GitHub repo <a class="ae ks" href="https://github.com/asjadanis/ts-tooling" rel="noopener ugc nofollow" target="_blank">这里</a>看到这一切</p><h1 id="3990" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">结论</h1><p id="b282" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">这个博客的想法不是深入每个工具，而是给你一个所有这些工具的概述，这些工具可以在我们的开发过程中帮助你，并确保更好的开发人员体验。设置这些工具可能是一项非常无聊和繁琐的任务，但这些工具是你的朋友，一旦你在代码库中恰当地采用它们，你就不会后悔。欢迎在评论区与我分享你的想法，或者在Twitter上与我联系。</p><p id="bc6f" class="pw-post-body-paragraph ll lm in ln b lo mj jo lq lr mk jr lt lu mx lw lx ly my ma mb mc mz me mf mg ig bi translated"><em class="nq">更多内容请看</em><a class="ae ks" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="ln io"><em class="nq">plain English . io</em></strong></a></p></div></div>    
</body>
</html>