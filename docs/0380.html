<html>
<head>
<title>Unit Test Vue Apps with Vue Test Utils — Keyboard and Mouse Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vue测试工具对Vue应用进行单元测试——键盘和鼠标事件</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/unit-test-vue-apps-with-vue-test-utils-keyboard-and-mouse-events-26e77d73399f?source=collection_archive---------11-----------------------#2021-01-22">https://javascript.plainenglish.io/unit-test-vue-apps-with-vue-test-utils-keyboard-and-mouse-events-26e77d73399f?source=collection_archive---------11-----------------------#2021-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/15899ce8015c31072f6802255864c80b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zrB-2kVs4uZaBj0V"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@mylifeasaryan_?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aryan Dhiman</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a73d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有了Vue Test Utils库，我们可以轻松地为Vue应用编写和运行单元测试。</p><p id="0eb9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将看看如何用Vue Test Utils库编写单元测试。</p><h1 id="64dc" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">键盘事件测试</h1><p id="cc5b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在代码中测试键盘事件。</p><p id="6bb6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="1680" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="a925" class="mn lc iq mj b gy ms mp l mq mr">const KEY_DOWN = 40<br/>const KEY_UP = 38<br/>const ESCAPE = 27</span><span id="3cc5" class="mn lc iq mj b gy ms mp l mq mr">const QuantityComponent = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;input type="text" <a class="ae kc" href="http://twitter.com/keydown" rel="noopener ugc nofollow" target="_blank">@keydown</a>.prevent="onKeydown" v-model="quantity" /&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      quantity: 0<br/>    }<br/>  },<br/>  methods: {<br/>    increment() {<br/>      this.quantity += 1<br/>    },<br/>    decrement() {<br/>      this.quantity -= 1<br/>    },<br/>    clear() {<br/>      this.quantity = 0<br/>    },<br/>    onKeydown(e) {<br/>      if (e.keyCode === ESCAPE) {<br/>        this.clear()<br/>      }<br/>      if (e.keyCode === KEY_DOWN) {<br/>        this.decrement()<br/>      }<br/>      if (e.keyCode === KEY_UP) {<br/>        this.increment()<br/>      }<br/>      if (e.key === 'a') {<br/>        this.quantity = 10<br/>      }<br/>    }<br/>  },<br/>  watch: {<br/>    quantity(newValue) {<br/>      this.$emit('input', newValue)<br/>    }<br/>  }<br/>}</span><span id="8167" class="mn lc iq mj b gy ms mp l mq mr">describe('Key event tests', () =&gt; {<br/>  it('Quantity is zero by default', () =&gt; {<br/>    const wrapper = mount(QuantityComponent)<br/>    expect(wrapper.vm.quantity).toBe(0)<br/>  })</span><span id="ed89" class="mn lc iq mj b gy ms mp l mq mr">  it('Up arrow key increments quantity by 1', async () =&gt; {<br/>    const wrapper = mount(QuantityComponent)<br/>    await wrapper.find('input').trigger('keydown.up')<br/>    expect(wrapper.vm.quantity).toBe(1)<br/>  })</span><span id="a321" class="mn lc iq mj b gy ms mp l mq mr">  it('Down arrow key decrements quantity by 1', async () =&gt; {<br/>    const wrapper = mount(QuantityComponent)<br/>    wrapper.vm.quantity = 2<br/>    await wrapper.find('input').trigger('keydown.down')<br/>    expect(wrapper.vm.quantity).toBe(1)<br/>  })</span><span id="3fef" class="mn lc iq mj b gy ms mp l mq mr">  it('Escape sets quantity to 0', async () =&gt; {<br/>    const wrapper = mount(QuantityComponent)<br/>    wrapper.vm.quantity = 3<br/>    await wrapper.find('input').trigger('keydown.esc')<br/>    expect(wrapper.vm.quantity).toBe(0)<br/>  })</span><span id="d0fe" class="mn lc iq mj b gy ms mp l mq mr">  it('Magic character "a" sets quantity to 10', async () =&gt; {<br/>    const wrapper = mount(QuantityComponent)<br/>    await wrapper.find('input').trigger('keydown', {<br/>      key: 'a'<br/>    })<br/>    expect(wrapper.vm.quantity).toBe(10)<br/>  })<br/>})</span></pre><p id="c6ce" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在每次测试中触发键盘事件。</p><p id="4813" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">QuantityComponent</code>有一个输入元素，它监听<code class="fe mt mu mv mj b">keydown</code>事件并相应地更新<code class="fe mt mu mv mj b">quantity</code>。</p><p id="1f7b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">onKeydown</code>方法更新<code class="fe mt mu mv mj b">quantity</code>反应属性，根据按下的键设置值。</p><p id="9e85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在我们的测试中，我们用<code class="fe mt mu mv mj b">find</code>方法获得了<code class="fe mt mu mv mj b">input</code>元素。</p><p id="c55c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe mt mu mv mj b">trigger</code>来触发各种<code class="fe mt mu mv mj b">keydown</code>事件。</p><p id="3ed3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">keydown.up</code>模拟按下向上箭头。</p><p id="3e05" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">keydown.up</code>模拟按下向下箭头。</p><p id="1c1a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe mt mu mv mj b">keydown.up</code>模拟按下esc键。</p><p id="22c6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个测试模拟按下<code class="fe mt mu mv mj b">'a'</code>键。</p><p id="d3e9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们这样做了，我们就可以检查<code class="fe mt mu mv mj b">quantity</code>的反应属性以获得最终结果。</p><h1 id="f6c5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试异步行为</h1><p id="ffa0" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以使用与上一个例子相同的原理来测试异步行为。</p><p id="2257" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="2bc5" class="mn lc iq mj b gy mo mp l mq mr">import { mount } from '@vue/test-utils'</span><span id="9c9f" class="mn lc iq mj b gy ms mp l mq mr">const Counter = {<br/>  template: `<br/>    &lt;div&gt;<br/>      &lt;button @click='count++'&gt;add&lt;/button&gt;<br/>      &lt;p&gt;{{count}}&lt;/p&gt;<br/>    &lt;/div&gt;<br/>  `,<br/>  data() {<br/>    return {<br/>      count: 0<br/>    }<br/>  },<br/>}</span><span id="39e7" class="mn lc iq mj b gy ms mp l mq mr">describe('Counter tests', () =&gt; {<br/>  it('count is set to 1 after click', async () =&gt; {<br/>    const wrapper = mount(Counter)<br/>    expect(wrapper.text()).toContain('0')<br/>    const button = wrapper.find('button')<br/>    await button.trigger('click')<br/>    expect(wrapper.text()).toContain('1')<br/>  })</span><span id="9368" class="mn lc iq mj b gy ms mp l mq mr">})</span></pre><p id="f7ba" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们有一个<code class="fe mt mu mv mj b">Counter</code>组件，当我们单击add按钮时，它会更新<code class="fe mt mu mv mj b">count</code> reactive属性。</p><p id="63f9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后在我们的测试中，我们用<code class="fe mt mu mv mj b">text</code>方法检查呈现的内容。</p><p id="d333" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们点击按钮，再次进行检查。</p><h1 id="3073" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="5db5" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在测试中模拟点击和键盘事件，并测试呈现的内容。</p><p id="e2d4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>