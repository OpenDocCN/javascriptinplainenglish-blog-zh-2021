<html>
<head>
<title>Build a Custom React Hook in 5 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在5分钟内建立一个自定义的反应钩</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-custom-react-hook-in-5-minutes-2988c65e5e10?source=collection_archive---------14-----------------------#2021-06-09">https://javascript.plainenglish.io/build-a-custom-react-hook-in-5-minutes-2988c65e5e10?source=collection_archive---------14-----------------------#2021-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9975" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">自定义反应挂钩快速指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/f18e907b4a0d2abc1995bbc736cd5870.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUi3vkj06Vqp_sXeiI-UbQ.jpeg"/></div></div></figure><p id="dd5f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">React挂钩为编写React组件提供了一种极好的方式，而无需定义一个类。相反，我们采用功能方法来创建组件。这使得我们的代码更加模块化，因为我们不再依赖于生命周期方法来分割它们，而是根据它们的用例和目的来分割组件。</p><p id="1e50" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你是钩子新手，一定要在这里查看钩子概述<a class="ae ln" href="https://reactjs.org/docs/hooks-overview.html" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="db37" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="http://twitter.com/sdolidze" rel="noopener ugc nofollow" target="_blank"> @sdolidze </a>发表了一篇名为<a class="ae ln" href="https://medium.com/@sdolidze/the-iceberg-of-react-hooks-af0b588f43fb" rel="noopener">“React钩子的冰山”</a>的优秀深度文章，其中他一层一层地介绍了React提供的各种钩子。在本文中，我们将看看如何创建我们自己的自定义React挂钩。</p><h1 id="73fa" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">到底什么是自定义挂钩？</h1><p id="4d95" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">钩子允许我们连接、修改和更新组件的状态和生命周期。参考<a class="ae ln" href="https://reactjs.org/docs/hooks-custom.html" rel="noopener ugc nofollow" target="_blank"> React文档</a>，定制钩子最简单的规则是它必须总是以前缀<code class="fe ml mm mn mo b">use</code>开始。自定义钩子就像一个普通的函数，因为我们可以决定它需要什么参数。自定义钩子也应该遵循钩子的所有定义的<a class="ae ln" href="https://reactjs.org/docs/hooks-rules.html" rel="noopener ugc nofollow" target="_blank">规则。</a></p><p id="4443" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">构建定制钩子的主要优点是，我们能够将组件逻辑提取到可重用的函数中。这使得我们的代码更加模块化和“干净”。</p><h1 id="8e8c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">我们在建造什么？</h1><p id="6b92" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">在React应用程序中持久化数据的最常见方式之一是使用浏览器自带的本地存储。我们可以把它想象成一个小的存储区域，在这里我们可以保存一些简单的键和值对来持久化一些数据。这些数据可以是任何东西，包括存储的用户配置文件属性、搜索查询，甚至是应用程序主题等偏好。</p><p id="5f74" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">与本地存储接口非常简单。我们有两个主要功能:<code class="fe ml mm mn mo b">setItem</code>和<code class="fe ml mm mn mo b">getItem</code>。我们可以如下所示使用它们:</p><pre class="kg kh ki kj gt mp mo mq mr aw ms bi"><span id="4e6d" class="mt lp iq mo b gy mu mv l mw mx">// Set a key-value pair<br/>localStorage.setItem('userId', 'john_doe');</span><span id="c51b" class="mt lp iq mo b gy my mv l mw mx">// Retrieve value by key<br/>localStorage.getItem('userId');</span></pre><h1 id="46fe" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">建筑垃圾仓库</h1><p id="48e0" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">现在，让我们开始吧。首先让我们在一个名为<code class="fe ml mm mn mo b">useLocalStorage.js</code>的新文件中定义我们的<code class="fe ml mm mn mo b">useLocalStorage</code>钩子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="a4b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这段代码中，我们定义了一个新函数，它接受一个键和初始值，并将其存储在一个名为<code class="fe ml mm mn mo b">value</code>的状态变量中。我们还定义了一个名为<code class="fe ml mm mn mo b">storeValue</code>的函数，它有助于将函数存储到浏览器的本地存储中。</p><p id="9705" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">最后，我们将<code class="fe ml mm mn mo b">value</code>和<code class="fe ml mm mn mo b">storeValue</code>函数返回给调用者。</p><p id="7640" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们在另一个文件中使用这个钩子，如下所示:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="281e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们简单地通过导入<code class="fe ml mm mn mo b">useLocalStorage</code>钩子并给它一个键来消费它。一旦组件呈现出来，我们调用<code class="fe ml mm mn mo b">setUserId</code>函数来设置一个用户ID<code class="fe ml mm mn mo b">john_doe</code>。</p><h1 id="4bf4" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">从本地存储初始化我们的值</h1><p id="1f67" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们想从本地存储器初始化我们的值，看看我们是否有任何先前保存的值。为此，让我们对<code class="fe ml mm mn mo b">useLocalStorage.js</code>中的<code class="fe ml mm mn mo b">value</code>状态进行惰性初始化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="c32b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在上面的代码中，我们做了一个惰性初始化，因为与本地存储接口是一个潜在的昂贵的操作，可能会很慢。所以我们只想在应用程序第一次运行时初始化这个值。</p><p id="2f7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">为此，我们向<code class="fe ml mm mn mo b">useState</code>钩子提供了一个函数，在这个函数中，我们试图从本地存储中检索一个键。如果存在任何值，并且我们能够将它解析成有效的JSON，那么我们返回它。如果出现解析错误，或者没有键，我们只需返回<code class="fe ml mm mn mo b">initialValue</code>。</p><h1 id="f76f" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">提高存储价值</h1><p id="5c7a" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">最后，让我们增强storeValue函数，将它转换成一个<code class="fe ml mm mn mo b">useEffect </code>钩子，并在存储值之前将其字符串化。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div></figure><p id="ff68" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">通过使用<code class="fe ml mm mn mo b">useEffect</code>钩子并在依赖数组中指定<code class="fe ml mm mn mo b">value</code>，我们将能够在每次<code class="fe ml mm mn mo b">value</code>更新时将值保存到本地存储中。我们将<code class="fe ml mm mn mo b">value</code>和<code class="fe ml mm mn mo b">setValue</code>返回给我们的调用函数。</p><h1 id="fedc" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="8d66" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">就是这样！只用几行代码，我们就创建了一个专用的钩子来与浏览器的本地存储接口。现在，每次我们更新变量时，它都会自动保存到本地存储中。即使浏览器重新加载，我们也能够从浏览器的本地存储中检索值并初始化我们的变量。</p><p id="3ad0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">自定义钩子在React应用程序中非常有用，可以简化重复的逻辑。</p><p id="2f7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果你有兴趣看看来自开发社区的一些有用的自定义React挂钩，请查看由<a class="nb nc ep" href="https://medium.com/u/a1ee806e09de?source=post_page-----2988c65e5e10--------------------------------" rel="noopener" target="_blank">奇杜梅·纳姆迪撰写的这篇文章🔥💻🎵🎮</a></p><p id="7edb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">编码快乐！💻</p><p id="88c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nd">更多内容尽在</em><a class="ae ln" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="nd">plain English . io</em></a></p></div></div>    
</body>
</html>