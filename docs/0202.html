<html>
<head>
<title>Creating a Financial App with the Plaid API, Node.js/Express, and React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用格子API、Node.js/Express,和React创建一个金融应用</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-financial-app-with-the-plaid-api-nodejs-express-and-react-4e142066eb6c?source=collection_archive---------1-----------------------#2021-01-12">https://javascript.plainenglish.io/creating-a-financial-app-with-the-plaid-api-nodejs-express-and-react-4e142066eb6c?source=collection_archive---------1-----------------------#2021-01-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/80d737e4d7d5d3189c840452eacedc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7DPLnnCFGvdUKpBFvoqzQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@austindistel?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Austin Distel</a> on <a class="ae jz" href="https://unsplash.com/s/photos/financial-app?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0595" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我为Flatiron做的最后一个项目是一个预算工具，用户可以按类别和月份创建预算，并根据他们的支出进行分析。我更喜欢使用<a class="ae jz" href="https://plaid.com/" rel="noopener ugc nofollow" target="_blank"> Plaid API </a>在实时事务中实现这一点，但不幸的是，我使用的后端Ruby on Rails没有太多的文档。用1.5周的时间完成这个项目，我最终创建了自己的交易清单。</p><p id="eaa6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">毕业后决心搞清楚格子API。我必须决定我是想让API与Rails一起工作(使用Plaid的Sinatra文档应该是可能的)，还是想学习另一种语言，在那里他们有更充分的文档。我最终决定学习Node.js，因为我已经知道了Javascript。</p><p id="dcd2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在尝试了Node/Express之后，我重新开始使用Plaid，后端变得更容易理解了，但是他们的Quickstart使用了jQuery。Plaid React链接文档很棒，我发现其他人也有很棒的资源，他们成功地构建了一个具有Node/Express后端和React前端的Plaid应用程序，包括这里的<a class="ae jz" href="https://blog.bitsrc.io/build-a-full-stack-banking-web-app-with-plaid-the-mern-stack-508914ce5694" rel="noopener ugc nofollow" target="_blank">和这里的</a>和<a class="ae jz" href="https://medium.com/@dereksams/building-a-react-app-with-the-plaid-api-93e45ae61b58" rel="noopener">和</a>。然而，博客文章要求你注意你的<code class="fe ky kz la lb b">public_key</code>，格子从2020年7月起停止提供。通过修改后的流程，应用服务器请求Plaid生成一个临时的<code class="fe ky kz la lb b">link_token</code>(而不是预先用<code class="fe ky kz la lb b">secret_key</code>和<code class="fe ky kz la lb b">client_key</code>提供的<code class="fe ky kz la lb b">public_key</code>)。然后<code class="fe ky kz la lb b">link_token</code>被发送回应用服务器和客户端。</p><p id="7de9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">剩下的过程与之前类似——Plaid用<code class="fe ky kz la lb b">public_token</code>响应初始化的<code class="fe ky kz la lb b">link_token</code>,它被发送回应用服务器以交换一个永久的<code class="fe ky kz la lb b">access_token</code>。</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/99e199380fd9fa5aa6213b37e0f534cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*dFg9227Sk3SEMC8qxJyBog.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">The Plaid Flow per the Quickstart docs <a class="ae jz" href="https://plaid.com/docs/quickstart/" rel="noopener ugc nofollow" target="_blank">https://plaid.com/docs/quickstart/</a></figcaption></figure><p id="15de" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">更简洁地总结一下:</p><ol class=""><li id="a202" class="lh li in kc b kd ke kh ki kl lj kp lk kt ll kx lm ln lo lp bi translated">应用服务器发出临时请求<code class="fe ky kz la lb b">link_token</code></li><li id="54af" class="lh li in kc b kd lq kh lr kl ls kp lt kt lu kx lm ln lo lp bi translated"><code class="fe ky kz la lb b">link_token</code>被发送到客户端，用户可以在那里初始化链接</li><li id="79e3" class="lh li in kc b kd lq kh lr kl ls kp lt kt lu kx lm ln lo lp bi translated">如果链接成功初始化，则生成一个<code class="fe ky kz la lb b">public_token</code>并发送给应用服务器</li><li id="9749" class="lh li in kc b kd lq kh lr kl ls kp lt kt lu kx lm ln lo lp bi translated">应用服务器请求Plaid将<code class="fe ky kz la lb b">public_token</code>换成永久的<code class="fe ky kz la lb b">access_token</code></li></ol><p id="c519" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果我们在这个例子中使用数据库，我们会将<code class="fe ky kz la lb b">access_token</code>存储到用户中，这样他们就不需要在每次登录时进行身份验证。理解这一点的一个好方法是以Venmo这样的金融app为例:你只需要对你的银行账户进行一次认证，因为Plaid的访问令牌是存储到你的账户中的。但是，你仍然需要登录和退出Venmo来发送或接收金钱，你只是因为你的<code class="fe ky kz la lb b">access_token</code>而不必每次都使用Plaid来认证你的帐户。</p><p id="1f1e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在以后的例子中，我将使用一个登录和数据库，但是今天，我想展示Node/Express、React和Plaid之间的流程，以便从Plaid生成一个事务列表。这篇博文假设您对Node/Express和React有一定的了解。最终结果看起来会像这样:</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/d882b019e1c5867d88de916b1f8fbec2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Bbq17P2uuij0_-qgMlgCgA.gif"/></div></div></figure><p id="3cf6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">入门</strong></p><p id="5536" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了节省设置文件结构和分别安装依赖项的时间，您可以在这里克隆框架<a class="ae jz" href="https://github.com/catd825/plaid_project_no_db" rel="noopener ugc nofollow" target="_blank">，并一次安装所有的依赖项:</a></p><pre class="ld le lf lg gt lw lb lx ly aw lz bi"><span id="1526" class="ma mb in lb b gy mc md l me mf">cd server &amp;&amp; npm install<br/>cd client &amp;&amp; npm install</span></pre><p id="6302" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意——服务器中的<code class="fe ky kz la lb b">package.json</code>被配置为使用<code class="fe ky kz la lb b">npm run dev</code>同时运行后端和前端。</p><p id="e186" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你还需要创建一个免费的格子账户来获得钥匙，你可以在这里做<a class="ae jz" href="https://dashboard.plaid.com/signup" rel="noopener ugc nofollow" target="_blank">。一旦有了密钥，就需要创建密钥文件。下<code class="fe ky kz la lb b">server</code>、<code class="fe ky kz la lb b">cd config</code>，再下<code class="fe ky kz la lb b">touch keys.js</code>。</a></p><p id="9403" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在文件中，添加以下内容:</p><pre class="ld le lf lg gt lw lb lx ly aw lz bi"><span id="58ae" class="ma mb in lb b gy mc md l me mf">module.exports = {<br/>    PLAID_CLIENT_ID: 'ADD CLIENT KEY',<br/>    PLAID_SECRET: 'ADD SANDBOX SECRET KEY'<br/>};</span></pre><p id="2e0a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">可选:如果你想把你的工作推给Github，记得通过以下操作隐藏你的密钥:</p><p id="4288" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe ky kz la lb b">server</code>中，在您的终端中输入<code class="fe ky kz la lb b">touch .gitignore</code>。在<code class="fe ky kz la lb b">.gitignore</code>文件中，添加<code class="fe ky kz la lb b">keys.js</code>并保存。</p><p id="1528" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">设置后端</strong></p><p id="4f7b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在服务器目录中，导航到<code class="fe ky kz la lb b">index.js</code>文件。增加以下要求。</p><pre class="ld le lf lg gt lw lb lx ly aw lz bi"><span id="b8d5" class="ma mb in lb b gy mc md l me mf">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const keys = require('./config/keys');<br/>const cors = require('cors');<br/>const plaid = require('plaid');</span><span id="5caa" class="ma mb in lb b gy mg md l me mf">const app = express();<br/>app.use(cors())<br/>app.use(bodyParser.json());</span><span id="f6c1" class="ma mb in lb b gy mg md l me mf">//add code here</span><span id="ce28" class="ma mb in lb b gy mg md l me mf">const PORT = 5000;</span><span id="5e29" class="ma mb in lb b gy mg md l me mf">app.listen(PORT, () =&gt; console.log(`listening on port ${PORT}!`));</span></pre><p id="5dd8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要确认服务器正在运行，请在您的终端中运行<code class="fe ky kz la lb b">npm run dev</code>。确保我们的控制台确认它运行在端口5000上。如果在更新代码时不想让服务器运行，可以用<code class="fe ky kz la lb b">ctrl c</code>终止它。</p><p id="0dbd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您将通过添加以下代码来初始化一个Plaid客户机的实例。</p><pre class="ld le lf lg gt lw lb lx ly aw lz bi"><span id="7352" class="ma mb in lb b gy mc md l me mf">const client = new plaid.Client({<br/>    clientID: keys.PLAID_CLIENT_ID,<br/>    secret: keys.PLAID_SECRET,<br/>    env: plaid.environments.sandbox<br/>  });</span></pre><p id="4209" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我强烈建议通过在这段代码后添加<code class="fe ky kz la lb b">console.log(client)</code>来确认您的键正在工作，否则下一步将无法工作。如果运行<code class="fe ky kz la lb b">npm run dev</code>，客户端对象带有API键。(如果服务器已经在运行，您可能需要重新启动它。)</p><p id="5c70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建链接令牌</strong></p><p id="5edf" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了创建临时的<code class="fe ky kz la lb b">link_token</code>，应用服务器需要向Plaid发出请求。下面的示例使用了示例用户凭证，如果您使用数据库，则需要更新这些凭证。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="88de" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加下面的代码来获得关于您刚刚<a class="ae jz" href="https://plaid.com/docs/api/tokens/#linktokenget" rel="noopener ugc nofollow" target="_blank">创建的</a>的<code class="fe ky kz la lb b">link_token</code>的信息。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="11cc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">在客户端处理链接令牌</strong></p><p id="2c78" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，导航到客户端文件夹中的<code class="fe ky kz la lb b">App.js</code>。为App类添加以下代码。这将获取您的应用服务器从Plaid中获取的<code class="fe ky kz la lb b">link_token</code>,并确保客户端可以在页面加载时访问它。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="65d9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">导航到src文件夹中的<code class="fe ky kz la lb b">Link.js</code>文件，并使用以下代码进行更新(基于<a class="ae jz" href="https://github.com/plaid/react-plaid-link/blob/master/examples/hoc.js" rel="noopener ugc nofollow" target="_blank">链接</a>文档。)我们从<code class="fe ky kz la lb b">App</code>传递道具，以确保组件可以访问<code class="fe ky kz la lb b">link_token</code>。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="00f1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">此时，您现在可以在您的终端中运行<code class="fe ky kz la lb b">npm run dev</code>来初始化Link！如果您点击按钮，您可以输入测试凭证<code class="fe ky kz la lb b">user_good</code>和<code class="fe ky kz la lb b">pass_good</code>并开始Plaid认证过程。然而，这不是整个认证过程，您还不能访问数据。这就是<code class="fe ky kz la lb b">public_token</code>和<code class="fe ky kz la lb b">access_token</code>出现的原因。</p><p id="efa4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">用公共令牌交换访问令牌</strong></p><p id="2e25" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当用户凭证在Link中提交后，我们通过<code class="fe ky kz la lb b">onSuccess</code>回调得到一个<code class="fe ky kz la lb b">public_token</code>。我们需要把这个换成永久的<code class="fe ky kz la lb b">access_token</code>。在<code class="fe ky kz la lb b">Link.js</code>文件中，用以下代码更新功能组件:</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="94f4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<code class="fe ky kz la lb b">App.js</code>文件中，更新代码如下。这会将Plaid生成的<code class="fe ky kz la lb b">public_token</code>从客户端发送到应用服务器。确保你更新了传递<code class="fe ky kz la lb b">.getAccessToken</code>功能的道具。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="f75e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用下面的代码更新服务器中的<code class="fe ky kz la lb b">index.js</code>。这将触发服务器将<code class="fe ky kz la lb b">public_token</code>换成格子里的<code class="fe ky kz la lb b">access_token</code>。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a349" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你现在应该完全连接了！现在，让我们让一些交易出现…</p><p id="76e7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">创建交易</strong></p><p id="50e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为这篇文章更多的是关于Plaid、应用服务器和客户端之间的流程，而不是React，所以我提供了一些代码来展示我们现在可以呈现事务了。</p><p id="bbd3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">先把这个加到<code class="fe ky kz la lb b">index.js</code>上。第14行的控制台日志将在控制台上显示完整的JSON对象，如果您想调整任何数据，这将非常有用。注意—如果您得到一个空数组但没有错误，您可能需要将日期范围调整为过去30天内的某个时间。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="ee14" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要将事务呈现到前端，您需要将下面的代码片段添加到<code class="fe ky kz la lb b">App.js</code>。同样，剩下的代码已经在我设置的模板中了。</p><figure class="ld le lf lg gt jo"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="f555" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">至此，您应该能够完成整个链接过程并看到交易了！(提醒—这是一个示例帐户，不是我的交易:)</p><figure class="ld le lf lg gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/056c694769e4b58cb4315eff285a5485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aWyReVsQBViO2V5G4_SgrQ.gif"/></div></div></figure><p id="e593" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在你知道了！如您所见，对于看似简单的身份验证过程，有相当多的工作要做，但结果是值得的。一旦你连接到格子，有很多金融应用程序可以建立。同样，这是没有数据库，但我希望这能帮助你开始！</p></div></div>    
</body>
</html>