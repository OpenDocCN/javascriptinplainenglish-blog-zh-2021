<html>
<head>
<title>Build a Scalable GraphQL Server With NestJS, MongoDB &amp; TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用NestJS、MongoDB和TypeScript构建一个可伸缩的GraphQL服务器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-scalable-graphql-server-with-nestjs-mongodb-typescript-1eeda049f7c8?source=collection_archive---------1-----------------------#2021-01-26">https://javascript.plainenglish.io/build-a-scalable-graphql-server-with-nestjs-mongodb-typescript-1eeda049f7c8?source=collection_archive---------1-----------------------#2021-01-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cb62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本指南中，我们将使用<a class="ae kl" href="https://nestjs.com/" rel="noopener ugc nofollow" target="_blank">nestj</a>构建一个GraphQL API。NestJS是一个NodeJS框架，旨在构建可伸缩、高效和可靠的应用程序。该框架是开源的，并且有易于遵循的文档。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/daf77228296c0a780c8368038d755bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2kN_4IEZFb81lAEBy9aCDQ.png"/></div></div></figure><p id="f5ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">遵循本指南的结果是，您将拥有一个构建在NestJS之上的GraphQL API，它可以部署在Docker容器中。GraphQL层将使用<a class="ae kl" href="https://typegraphql.com/" rel="noopener ugc nofollow" target="_blank"> TypeGraphQL </a>开发，减少了对TypeScript &amp; GraphQL样板文件的需求。</p><p id="7fc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> ⭐You可以找到成品库here⭐:</strong><a class="ae kl" href="https://github.com/tomanagle/GraphQL-NestJS-MongoDB-TypeScript-Tutorial" rel="noopener ugc nofollow" target="_blank">https://github . com/tomanagle/graph QL-nestjs-MongoDB-typescript-tutorial</a></p><p id="e25a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">⚠️警告⚠️:·内斯特带有很多样板文件。如果你以前没用过，跟着这个教程你就知道我的意思了。不要因此而放弃NestJS，它是一个很棒的框架。样板文件意味着您的代码组织得非常好，非常适合有很多开发人员参与的大型应用程序。因此，初创公司和大公司可能会越来越多地使用NestJS，所以现在学习如何使用它是一个好主意。</p><h2 id="327f" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">第一部分。项目设置</h2><p id="eebb" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">全局安装NestJS并创建一个新的NestJS应用程序:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="8d6f" class="ky kz iq lx b gy mb mc l md me">npm i -g @nestjs/cli</span><span id="8843" class="ky kz iq lx b gy mf mc l md me">nest new my-project</span></pre><p id="8f65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开项目目录并安装所需的依赖项:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="a28f" class="ky kz iq lx b gy mb mc l md me">cd my-project</span><span id="7e52" class="ky kz iq lx b gy mf mc l md me">yarn add @nestjs/graphql graphql-tools graphql apollo-server-express mongoose</span></pre><p id="89b7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">给你的<code class="fe mg mh mi lx b">tsconfig.json</code>文件设置两个属性，<code class="fe mg mh mi lx b">esModuleInterop</code> &amp; <code class="fe mg mh mi lx b">skipLibCheck</code>为真。您的<code class="fe mg mh mi lx b">tsconfig.json</code>文件现在应该如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="3200" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">esModuleInterop: true</code>告诉TypeScript我们希望能够将CommonJS模块导入到ES6模块代码库中。参考:<a class="ae kl" href="https://www.typescriptlang.org/tsconfig#esModuleInterop" rel="noopener ugc nofollow" target="_blank">https://www.typescriptlang.org/tsconfig#esModuleInterop</a></p><p id="9212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">skipLibCheck: true</code>告诉TypeScript我们想要跳过<code class="fe mg mh mi lx b">node_modules</code>文件夹中的类型检查ob库。这可以节省编译时间，并防止节点模块中的冲突类型破坏编译。参考:<a class="ae kl" href="https://www.typescriptlang.org/tsconfig#skipLibCheck" rel="noopener ugc nofollow" target="_blank">https://www.typescriptlang.org/tsconfig#skipLibCheck</a></p><p id="f43c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也喜欢把<code class="fe mg mh mi lx b">package.json</code>中的开始命令从<code class="fe mg mh mi lx b">start</code>改成<code class="fe mg mh mi lx b">dev</code>。</p><h2 id="c99d" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">第二部分。MongoDB &amp; Mongoose设置</h2><ol class=""><li id="2ec3" class="ml mm iq jp b jq lr ju ls jy mn kc mo kg mp kk mq mr ms mt bi translated">生成数据库模块:</li></ol><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="1e46" class="ky kz iq lx b gy mb mc l md me">nest g mo database</span></pre><p id="fef9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.生成数据库提供程序:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="9524" class="ky kz iq lx b gy mb mc l md me">touch src/database/database.providers.ts</span></pre><p id="908c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.创建一个常量文件:</p><p id="2d76" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">touch src/constants.ts</code></p><p id="c811" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.将以下代码添加到您的<code class="fe mg mh mi lx b">database.module.ts</code>中:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8bdc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.将数据库连接字符串添加到常量文件中:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="2290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.将以下代码添加到<code class="fe mg mh mi lx b">database.providers.ts</code>文件中:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="24b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi lx b">app.module</code>,确保代码如下所示:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="c166" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">文档:</strong><a class="ae kl" href="https://docs.nestjs.com/recipes/mongodb" rel="noopener ugc nofollow" target="_blank">https://docs.nestjs.com/recipes/mongodb</a></p><h2 id="740c" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">第三部分。创建GraphQL服务器</h2><p id="da62" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">这是NestJS样板文件的开始。在我们开始生成所需的文件之前，有必要了解用户的请求将如何在应用程序中流动，如何得到解决，以及如何从应用程序返回到用户界面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/b4739b0038e9fe7fe22686815ade2910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cufx_hNNvWZDa3Q4gVoitQ.png"/></div></div></figure><p id="13ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的图表，从GraphQL框往下，显示了我们在这一步将构建什么。</p><p id="7b18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下命令来自<a class="ae kl" href="https://docs.nestjs.com/cli/usages" rel="noopener ugc nofollow" target="_blank"> NestJS CLI </a>。这些命令使用别名，所以例如<code class="fe mg mh mi lx b">s</code>指的是一个服务。</p><ol class=""><li id="338e" class="ml mm iq jp b jq jr ju jv jy mv kc mw kg mx kk mq mr ms mt bi translated"><strong class="jp ir">生成用户服务:</strong></li></ol><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="cc3d" class="ky kz iq lx b gy mb mc l md me">nest g s User</span></pre><p id="2b37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">服务层是一个薄层，包括创建、更新、读取和删除数据库中的数据所需的方法。它通过提供程序直接连接到数据库。</p><p id="d27d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。生成用户模块</strong></p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="506c" class="ky kz iq lx b gy mb mc l md me">nest g mo User</span></pre><p id="e14b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">NestJs模块用于组织应用程序的结构。</p><p id="d519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。生成用户解析器</strong></p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="2603" class="ky kz iq lx b gy mb mc l md me">nest g r User</span></pre><p id="6a7e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为API使用的是TypeGraphQL，所以解析器将负责查询、变异、订阅和解析器。因此，如果我们在解析器中定义一个查询，我们只需要用<code class="fe mg mh mi lx b">@Query</code>对它进行注释，它就会被添加到GraphQL模式中。</p><p id="eabd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。创建用户模式:</strong></p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="ba90" class="ky kz iq lx b gy mb mc l md me">touch src/user/user.schema.ts</span></pre><p id="b9d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户模式包括Mongoose模式和用户类型定义。你可以把这两个分开，但是，我们已经有足够多的文件，我发现它们经常一起使用，足以保证它们在同一个文件中。</p><p id="26ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。创建用户输入文件:</strong></p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="c283" class="ky kz iq lx b gy mb mc l md me">touch src/user/user.input.ts</span></pre><p id="a9df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入包括由<code class="fe mg mh mi lx b">@InputType</code>装饰器注释的输入定义。通常创建数据传输对象(DTO)文件来保存输入定义和类型定义，例如用户类型定义，这种风格只是个人偏好。</p><p id="b33e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">6。创建用户提供商</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="3ad3" class="ky kz iq lx b gy mb mc l md me">touch src/user/user.providers.ts</span></pre><p id="e1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，提供者用于注入依赖项。在这种情况下，我们将使用提供者将数据库连接依赖注入到用户服务中。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="3236" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi lx b">user.schema.ts</code>并添加以下代码:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="3ea8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以修改用户模式以适合您的用户类型。您的用户类型需要扩展可以从mongoose包导入的<code class="fe mg mh mi lx b">Document</code>。</p><p id="1a0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要了解更多关于集成mongose和TypeScript的信息，请阅读<a class="ae kl" href="https://tomanagle.medium.com/strongly-typed-models-with-mongoose-and-typescript-7bc2f7197722" rel="noopener">使用mongose和TypeScript的强类型模型</a></p><p id="edca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi lx b">user.service.ts</code>文件并添加以下代码:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="59c9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述服务包括创建一个用户、查找一个用户和查找多个用户的三种方法。</p><p id="2ef4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🔥热点建议🔥:使用来自Mongoose的输入类型使服务更容易使用。在这里可以看到强类型服务的相关文章:<a class="ae kl" href="https://tomanagle.medium.com/even-stronger-typed-models-with-mongoose-and-typescript-916f0a9e5c3c" rel="noopener">https://tomanagle . medium . com/even-strong-typed-models-with-mongose-and-typescript-916 f 0 a 9 e 5c 3 c</a></p><p id="d548" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi lx b">user.input.ts</code>并添加以下代码:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="6348" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输入文件指定解析器函数将接收什么类型的TypeScript和GraphQL。</p><p id="0c67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开<code class="fe mg mh mi lx b">user.resolver.ts</code>文件并添加以下代码。</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="8edd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">解析器是定义所有查询、变异和订阅的地方。每个查询、变异和下标都将被标注上相应的修饰符<code class="fe mg mh mi lx b">@Query</code>、<code class="fe mg mh mi lx b">@Mutation</code>或<code class="fe mg mh mi lx b">@Subscription</code>。</p><p id="b470" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将以下内容添加到<code class="fe mg mh mi lx b">user.providers.ts</code>文件中:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="dcf9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户提供者将把数据库连接注入用户服务。</p><p id="5424" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将用户提供者添加到应用程序模块:</p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="4e58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在NestJS中，模块将应用程序的不同部分粘合在一起。用户模块将所有部件粘合在一起以提供这个模块，然后用户模块将被插入到应用程序模块中。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="1962" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mg mh mi lx b">yarn start</code>或<code class="fe mg mh mi lx b">yarn dev</code>启动服务器，如果您有启动脚本。在<a class="ae kl" href="http://localhost:3000/graphql" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/GraphQL</a>访问graph QL游乐场</p><p id="bdad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您将能够看到包含带有<code class="fe mg mh mi lx b">users</code>查询和<code class="fe mg mh mi lx b">createUser</code>变异的文档的运动场。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi nf"><img src="../Images/c9ac52706263961554d113c45709edc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZimnFRO053VwO_Rmi-gqcw.png"/></div></div></figure><p id="5fe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要测试API，请创建一个具有以下变体的用户:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="bca0" class="ky kz iq lx b gy mb mc l md me">mutation createUser($input: CreateUserInput!) {<br/>  createUser(input: $input) {<br/>    email<br/>    age<br/>    name<br/>  }<br/>}</span></pre><p id="f7ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的变化表明我们将提供符合<code class="fe mg mh mi lx b">CreateUserInput!</code>定义的输入。</p><p id="1e98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<code class="fe mg mh mi lx b">QUERY VARIABLES</code>输入中使用以下输入:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="0900" class="ky kz iq lx b gy mb mc l md me">{<br/>  "input": {<br/>    "age": 30,<br/>    "name": "Tom",<br/>    "email": "<a class="ae kl" href="mailto:test@exmaple.com" rel="noopener ugc nofollow" target="_blank">test@exmaple.com</a>"<br/>  }<br/>}</span></pre><p id="ea11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用户现在应该在数据库中了，让我们通过查询所有用户来测试它。</p><p id="183c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<code class="fe mg mh mi lx b">users</code>查询来查找所有用户:</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="3e04" class="ky kz iq lx b gy mb mc l md me">query getUsers {<br/>  users {<br/>    age<br/>    name<br/>    email<br/>  }<br/>}</span></pre><p id="dbeb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该会看到上面的用户返回到用户数组中。</p><h2 id="b4f6" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">第四部分。用Docker将应用程序容器化</h2><p id="233b" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">既然标题说应用程序将是可伸缩的，它应该用Docker容器化。</p><p id="55ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设您已经安装了Docker，如果没有，请按照<a class="ae kl" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">获取Docker </a>页面上的说明进行操作。</p><p id="cc47" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们的应用程序有一个MongoDB数据库，所以我们需要在应用程序旁边运行一个MongoDB实例，或者使用一个外部数据库提供者，比如MongoDB Atlas。最简单和最安全的方法是使用外部数据库提供者。</p><p id="f5f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我假设你有一个<a class="ae kl" href="https://www.mongodb.com/cloud/atlas" rel="noopener ugc nofollow" target="_blank"> MongoDB Atlas </a>账户，并且已经建立了一个数据库。</p><ol class=""><li id="bd28" class="ml mm iq jp b jq jr ju jv jy mv kc mw kg mx kk mq mr ms mt bi translated"><strong class="jp ir">创造一个</strong>T2】</li></ol><p id="7cca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在根目录下创建一个名为<code class="fe mg mh mi lx b">Dockerfile</code>的文件:</p><p id="ef84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">touch Dockerfile</code></p><p id="753f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。在根目录下创建一个名为</strong>T5】的文件</p><p id="8ecf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">touch docker-compose.yml</code></p><p id="bfce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。可选:在根目录下创建一个流程文件</strong></p><p id="792f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">touch process.json</code></p><p id="84d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">process.json</code>文件将包括<a class="ae kl" href="https://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> PM2 </a>的配置，一个Node.js的进程管理器</p><p id="8a00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以使用node，<code class="fe mg mh mi lx b">node dist/main.js</code>运行应用程序，但是，如果应用程序在容器中死亡，就没有重新启动它的机制。更高级的实现将终止容器，将流量路由到另一个容器，并启动一个新容器。然而，我们不会在这篇文章中讨论这样的实现。</p><p id="002a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。将下面的代码添加到</strong> <code class="fe mg mh mi lx b"><strong class="jp ir">Dockerfile</strong></code> <strong class="jp ir"> : </strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="491d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 5。将以下代码添加到</strong> <code class="fe mg mh mi lx b"><strong class="jp ir">docker-compose.yml</strong></code> <strong class="jp ir">文件中:</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="d020" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">确保取消注释并用MongoDB连接字符串替换第9行的字符串。</p><p id="9a60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 6。将以下内容添加到</strong> <code class="fe mg mh mi lx b"><strong class="jp ir">process.json</strong></code> <strong class="jp ir">文件中:</strong></p><figure class="kn ko kp kq gt kr"><div class="bz fp l di"><div class="mj mk l"/></div></figure><p id="7544" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">流程文件将告诉PM2生成尽可能多的节点应用程序实例。因为Node是单线程的，所以它将只使用一个内核。如果您的机器有多个内核，您会希望它为每个内核生成一个实例。</p><p id="04e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">https://pm2.keymetrics.io/docs/usage/quick-start/PM2文献</p><p id="8cee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 7。开始你的应用</strong></p><p id="b421" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要启动应用程序运行，请执行以下操作:</p><p id="cb56" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe mg mh mi lx b">docker-compose up</code></p><h2 id="c1d5" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">进一步阅读</h2><p id="1dbe" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">⭐ <strong class="jp ir">完整资源库:</strong><a class="ae kl" href="https://github.com/tomanagle/GraphQL-NestJS-MongoDB-TypeScript-Tutorial" rel="noopener ugc nofollow" target="_blank">https://github . com/tomanagle/graph QL-nestjs-MongoDB-typescript-tutorial</a></p><p id="4053" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🏁<strong class="jp ir">带NextJs启动器的NestJS graph QL:</strong><a class="ae kl" href="https://github.com/tomanagle/NextJS-NestJS-GraphQL-Starter" rel="noopener ugc nofollow" target="_blank">https://github.com/tomanagle/NextJS-NestJS-GraphQL-Starter</a></p><p id="a3f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🐈<strong class="jp ir"> NestJS文档:</strong><a class="ae kl" href="https://docs.nestjs.com/" rel="noopener ugc nofollow" target="_blank">https://docs.nestjs.com/</a></p><p id="544d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🌞<strong class="jp ir"> TypeGraphQL文档:</strong><a class="ae kl" href="https://typegraphql.com/docs/introduction.html" rel="noopener ugc nofollow" target="_blank">https://typegraphql.com/docs/introduction.html</a></p><p id="ca60" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">🎼【https://docs.docker.com/compose/】Docker-compose documentation:T23</p><div class="ng nh gp gr ni nj"><a href="https://plainenglish.io/blog/how-to-build-a-graphql-ecommerce-app-from-scratch" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd ir gy z fp no fr fs np fu fw ip bi translated">如何从头开始构建一个GraphQL电子商务应用程序</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">这就是你要建造的东西！埃森哲的一项调查(19个国家的20，000多名消费者)发现，47%的人…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">简明英语. io</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx kw nj"/></div></div></a></div><p id="9cc2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您有任何问题或反馈，请留下评论。我阅读了所有的评论，并在需要的地方进行了调整。感谢您的阅读。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="09b9" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">🌎让我们保持联系</h2><p id="27df" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://www.youtube.com/TomDoesTech" rel="noopener ugc nofollow" target="_blank">在YouTube上订阅</a> <br/> <a class="ae kl" href="https://discord.gg/4ae2Esm6P7" rel="noopener ugc nofollow" target="_blank">不和</a> <br/> <a class="ae kl" href="https://twitter.com/tomdoes_tech" rel="noopener ugc nofollow" target="_blank">推特</a> <br/> <a class="ae kl" href="https://www.tiktok.com/@tomdoestech" rel="noopener ugc nofollow" target="_blank">抖音</a> <br/> <a class="ae kl" href="https://www.facebook.com/tomdoestech" rel="noopener ugc nofollow" target="_blank">脸书</a><br/><a class="ae kl" href="https://www.instagram.com/tomdoestech" rel="noopener ugc nofollow" target="_blank">insta gram</a><br/><a class="ae kl" href="https://www.buymeacoffee.com/tomn" rel="noopener ugc nofollow" target="_blank">给我买杯咖啡</a></p><p id="5c3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="ny">更多内容请看</em><a class="ae kl" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ny">plain English . io</em></strong></a><em class="ny">。报名参加我们的</em> <a class="ae kl" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ny">免费周报</em> </strong> </a> <em class="ny">。关注我们关于</em><a class="ae kl" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ny">Twitter</em></strong></a><a class="ae kl" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ny">LinkedIn</em></strong></a><em class="ny"/><a class="ae kl" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ny">YouTube</em></strong></a><em class="ny"/><a class="ae kl" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ny">不和</em> </strong> </a> <em class="ny">。对增长黑客感兴趣？检查</em> <a class="ae kl" href="https://circuit.ooo/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ny">电路</em> </strong> </a> <em class="ny">。</em></p></div></div>    
</body>
</html>