<html>
<head>
<title>Beautiful Styling for Drag-and-Drop Rows in the Angular DataTable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度数据表中拖放行的漂亮样式</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/beautiful-styling-for-drag-and-drop-rows-in-the-angular-datatable-6870768c5a8f?source=collection_archive---------2-----------------------#2021-03-07">https://javascript.plainenglish.io/beautiful-styling-for-drag-and-drop-rows-in-the-angular-datatable-6870768c5a8f?source=collection_archive---------2-----------------------#2021-03-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="21bb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">角材料为它们的组成部分提供了丰富的例子。在我看来，这是对图书馆最强有力的支持之一。组件拥有最多的例子，但是在添加拖放功能上有点欠缺，尤其是在让它成为一种美好体验的时候。</p><p id="1a92" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这篇文章将介绍如何使用材料组件建立一个简单的数据表，拖放模块的结构，以及如何使其美观。</p><p id="ff2f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">更喜欢学习代码？这是GitHub回购协议。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/9e41d394ca9eb150e7bd02bacbc6a60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGRvXkzzytZ-8YxKaxYEBA.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Angular Logo (<a class="ae km" href="https://angular.io/presskit" rel="noopener ugc nofollow" target="_blank">https://angular.io/presskit</a>)</figcaption></figure><h2 id="0d86" class="ld le in bd lf lg lh dn li lj lk dp ll jv lm ln lo jz lp lq lr kd ls lt lu lv bi translated">基本数据表示例</h2><p id="3f64" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">角度材质数据表入门有很多精彩的教程(<a class="ae km" href="https://material.angular.io/components/table/examples" rel="noopener ugc nofollow" target="_blank">示例</a>、<a class="ae km" rel="noopener ugc nofollow" target="_blank" href="/implementing-angular-material-table-with-pagination-server-side-filtering-and-sorting-58e6a2ba4a48">演练</a>、<a class="ae km" href="https://material.angular.io/cdk/drag-drop/examples" rel="noopener ugc nofollow" target="_blank">拖放api </a>)，这里只简单介绍一下初始设置。如果你已经熟悉基本的数据表，你可以跳到下一节。</p><p id="830c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一个漂亮的拖放表依赖于:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="5ecf" class="ld le in kl b gy mf mg l mh mi">ng new draggable-data-table<br/>npm install --save @angular/material<br/>npm install --save @angular/cdk<br/>npm install --save @angular/flex-layout</span></pre><p id="e270" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们的组件中，我们定义了一个简单的数据源，以及数据表中需要的列。</p><p id="c16b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ki kj kk kl b">app.component.ts</code>:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="4578" class="ld le in kl b gy mf mg l mh mi">import { <strong class="kl io"><em class="mj">Component </em></strong>} from '@angular/core';<br/><br/>export interface PeriodicElement {<br/>  name: string;<br/>  weight: number;<br/>  symbol: string;<br/>}<br/><br/>const ELEMENT_DATA: PeriodicElement[] = [<br/>  {name: 'Hydrogen', weight: 1.0079, symbol: 'H'},<br/>  {name: 'Helium', weight: 4.0026, symbol: 'He'},<br/>  {name: 'Lithium', weight: 6.941, symbol: 'Li'},<br/>  {name: 'Beryllium', weight: 9.0122, symbol: 'Be'},<br/>  {name: 'Boron', weight: 10.811, symbol: 'B'},<br/>  {name: 'Carbon', weight: 12.0107, symbol: 'C'},<br/>  {name: 'Nitrogen', weight: 14.0067, symbol: 'N'},<br/>  {name: 'Oxygen', weight: 15.9994, symbol: 'O'},<br/>  {name: 'Fluorine', weight: 18.9984, symbol: 'F'},<br/>  {name: 'Neon', weight: 20.1797, symbol: 'Ne'},<br/>];<br/><br/>@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  displayedColumns: string[] = ['name', 'weight', 'symbol'];<br/>  dataSource = ELEMENT_DATA;<br/>}</span></pre><p id="b7a6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">材料数据表由绑定数组数据源的模板定义。它通过迭代数组的元素来生成表行和数据。<code class="fe ki kj kk kl b">fxFlex</code>和<code class="fe ki kj kk kl b">fxLayout</code>指令指定表格从左边距的5%开始，占据窗口宽度的50%。</p><p id="2fa2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ki kj kk kl b">app.component.html</code>:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="88aa" class="ld le in kl b gy mf mg l mh mi">&lt;div fxFlex fxLayout="row wrap"&gt;<br/>  &lt;div fxFlex="5"&gt;&lt;/div&gt;<br/>  &lt;div fxFlex="50" class="mat-elevation-z8"&gt;<br/>    &lt;table mat-table<br/>           #<strong class="kl io"><em class="mj">dataTable<br/>           </em></strong>fxFlex<br/>           [dataSource]="dataSource"&gt;<br/><br/>      &lt;!-- Name Column --&gt;<br/>      &lt;ng-container matColumnDef="name"&gt;<br/>        &lt;th mat-header-cell <em class="mj">*matHeaderCellDef</em>&gt; Name &lt;/th&gt;<br/>        &lt;td mat-cell <em class="mj">*matCellDef</em>="let <strong class="kl io"><em class="mj">element</em></strong>"&gt; {{<strong class="kl io"><em class="mj">element</em></strong>.name}} <br/>        &lt;/td&gt;<br/>      &lt;/ng-container&gt;<br/><br/>      &lt;!-- Weight Column --&gt;<br/>      &lt;ng-container matColumnDef="weight"&gt;<br/>        &lt;th mat-header-cell <em class="mj">*matHeaderCellDef</em>&gt; Weight &lt;/th&gt;<br/>        &lt;td mat-cell <em class="mj">*matCellDef</em>="let <strong class="kl io"><em class="mj">element</em></strong>"&gt; {{<strong class="kl io"><em class="mj">element</em></strong>.weight}} <br/>        &lt;/td&gt;<br/>      &lt;/ng-container&gt;<br/><br/>      &lt;!-- Symbol Column --&gt;<br/>      &lt;ng-container matColumnDef="symbol"&gt;<br/>        &lt;th mat-header-cell <em class="mj">*matHeaderCellDef</em>&gt; Symbol &lt;/th&gt;<br/>        &lt;td mat-cell <em class="mj">*matCellDef</em>="let <strong class="kl io"><em class="mj">element</em></strong>"&gt; {{<strong class="kl io"><em class="mj">element</em></strong>.symbol}}<br/>        &lt;/td&gt;<br/>      &lt;/ng-container&gt;<br/><br/>      &lt;tr mat-header-row <em class="mj">*matHeaderRowDef</em>="displayedColumns"&gt;&lt;/tr&gt;<br/>      &lt;tr mat-row<br/>          <em class="mj">*matRowDef</em>="let <strong class="kl io"><em class="mj">row</em></strong>;<br/>          columns: displayedColumns;"&gt;&lt;/tr&gt;<br/><br/>    &lt;/table&gt;<br/>  &lt;/div&gt;<br/>  &lt;div fxFlex="45"&gt;&lt;/div&gt;<br/>&lt;/div&gt;</span></pre><p id="65d9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">将导入添加到您的<code class="fe ki kj kk kl b">app.module.ts</code></p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="7e94" class="ld le in kl b gy mf mg l mh mi">imports: [<br/>...<br/>  DragDropModule,<br/>  MatTableModule,<br/>  FlexLayoutModule,<br/>...</span><span id="5b5c" class="ld le in kl b gy mk mg l mh mi">]</span></pre><h2 id="9573" class="ld le in bd lf lg lh dn li lj lk dp ll jv lm ln lo jz lp lq lr kd ls lt lu lv bi translated">添加拖放</h2><p id="35df" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">要添加拖放功能，我们必须将表格定义为<code class="fe ki kj kk kl b">cdkDropList</code>，将行定义为<code class="fe ki kj kk kl b">cdkDrag</code>。<code class="fe ki kj kk kl b">cdkDropList</code>是一个容器，当包装在<code class="fe ki kj kk kl b">cdkDrag</code>元素周围时，它将拖动元素分组到一个可重新排序的列表中。还有许多其他方式来利用拖放模块，但是对于列表或表格之类的数据，它提供了我们良好的用户交互所需的大部分逻辑。</p><p id="d061" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">它没有提供的一点是更新数据源的逻辑。我们将监听<code class="fe ki kj kk kl b">cdkDropList</code>上的drop事件，并在事件发出时自己更新数据:<code class="fe ki kj kk kl b">(cdkDropListDropped)="dropTable($event)"</code>，其中<code class="fe ki kj kk kl b">dropTable</code>在组件上定义。我们移动数组中的项目，然后触发表重新呈现行。</p><p id="1aa6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">新表:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="f37d" class="ld le in kl b gy mf mg l mh mi">&lt;table mat-table<br/>       #<strong class="kl io"><em class="mj">dataTable<br/>       </em></strong>fxFlex<br/>       [dataSource]="dataSource"<br/>       cdkDropList<br/>       (cdkDropListDropped)="dropTable(<strong class="kl io"><em class="mj">$event</em></strong>)"&gt;</span></pre><p id="d9e9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">表格行:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="3695" class="ld le in kl b gy mf mg l mh mi">&lt;tr mat-row<br/>    <em class="mj">*matRowDef</em>="let <strong class="kl io"><em class="mj">row</em></strong>;<br/>    columns: displayedColumns;"<br/>    cdkDrag<br/>&gt;&lt;/tr&gt;</span></pre><p id="e2fa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">修订后的应用程序组件:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="0fa1" class="ld le in kl b gy mf mg l mh mi">import { MatTable } from '@angular/material/table';<br/>import { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';</span><span id="f15a" class="ld le in kl b gy mk mg l mh mi">...</span><span id="f69f" class="ld le in kl b gy mk mg l mh mi">export class AppComponent {<br/>  @ViewChild('dataTable') table: MatTable&lt;PeriodicElement&gt;;<br/>  displayedColumns: string[] = ['name', 'weight', 'symbol'];<br/>  dataSource = ELEMENT_DATA;<br/><br/>  dropTable(event: CdkDragDrop&lt;PeriodicElement[]&gt;): void {<br/>    moveItemInArray(this.dataSource, event.previousIndex, event.currentIndex);<br/>    this.table.renderRows();<br/>  }<br/>}</span></pre><p id="fa17" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">此时，该表具有拖放功能，但它非常难看。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/2e4153564db6e8f2bca913b2265006ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*5y8WgtVbgYPEo7cz5HQn5A.gif"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Animated Table — Initial version that needs styling.</figcaption></figure><h2 id="25e3" class="ld le in bd lf lg lh dn li lj lk dp ll jv lm ln lo jz lp lq lr kd ls lt lu lv bi translated">让拖放变得漂亮</h2><p id="c494" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">为了让桌子看起来漂亮，我们首先需要设计<code class="fe ki kj kk kl b">cdkDragPlaceholder</code>和<code class="fe ki kj kk kl b">cdkDragPreview</code>的样式。当主动拖动时，预览是被拖动的UI组件。占位符是表中呈现的临时UI元素。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="gh gi kn"><img src="../Images/8862afda119551f44da8d7f086b8bacd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOkH9cSOK4qWa4HNVEyz5Q.png"/></div></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Preview vs. Placeholder in the Angular Drag and Drop CDK</figcaption></figure><p id="9941" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">预览样式有两个方面。预览本身必须进行样式化，但是，作为预览子元素的表格数据元素也必须进行样式化。目标是让样式表明用户点击的是UI元素。不幸的是，来自<code class="fe ki kj kk kl b">mat-table</code>的造型在拖动预览中丢失了，所以我们必须通知它的关键部分。</p><p id="a67a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于预览，样式的关键是设置<code class="fe ki kj kk kl b">display: table;</code>并使预览的高度与表格行的高度相同。表格数据元素利用<code class="fe ki kj kk kl b">flex-grow</code>在行内适当调整大小。</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="e595" class="ld le in kl b gy mf mg l mh mi">.cdk-drag-preview {<br/>  box-sizing: border-box;<br/>  border-radius: 4px;<br/>  box-shadow: 0 5px 5px -3px rgba(0, 0, 0, 0.2), 0 8px 10px 1px   <br/>              rgba(0, 0, 0, 0.14), 0 3px 14px 2px <br/>              rgba(0, 0, 0, 0.12);<br/><br/>  height: 48px;<br/>  background-color: white;<br/>  display: table;<br/>}<br/><br/>.cdk-drag-preview td {<br/>  flex-grow: 2;<br/>  font-size: 14px;<br/>  padding: 4px;<br/>  vertical-align: middle;<br/>}</span></pre><p id="987e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">用作占位符的<code class="fe ki kj kk kl b">div</code>被添加到表格HTML中。它的风格有点简单。</p><p id="71f8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">修改后的应用程序HTML:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="bdff" class="ld le in kl b gy mf mg l mh mi">...<br/>&lt;tr mat-header-row <em class="mj">*matHeaderRowDef</em>="displayedColumns"&gt;&lt;/tr&gt;<br/>  &lt;tr mat-row<br/>      <em class="mj">*matRowDef</em>="let <strong class="kl io"><em class="mj">row</em></strong>;<br/>      columns: displayedColumns;"<br/>      cdkDrag<br/>  &gt;&lt;/tr&gt;<br/><br/>  &lt;div <em class="mj">*cdkDragPlaceholder</em>&gt;&lt;/div&gt;<br/><br/>&lt;/table&gt;<br/>...</span></pre><p id="7c09" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">占位符的背景为灰色:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="9fe1" class="ld le in kl b gy mf mg l mh mi">.cdk-drag-placeholder {<br/>  background-color: grey;<br/>}</span></pre><p id="25a0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">造型的最后一点是由两个动画完成的。我喜欢拖动的行滑入位置的动画，以及行滑出占位符的动画。这些可以通过以下方式添加:</p><pre class="ko kp kq kr gt mb kl mc md aw me bi"><span id="536d" class="ld le in kl b gy mf mg l mh mi">.cdk-drag-animating {<br/>  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);<br/>}<br/><br/>.cdk-drop-list-dragging .mat-row:not(.cdk-drag-placeholder) {<br/>  transition: transform 250ms cubic-bezier(0, 0, 0.2, 1);<br/>}</span></pre><h2 id="1b42" class="ld le in bd lf lg lh dn li lj lk dp ll jv lm ln lo jz lp lq lr kd ls lt lu lv bi translated">齐心协力</h2><p id="58f5" class="pw-post-body-paragraph jk jl in jm b jn lw jp jq jr lx jt ju jv ly jx jy jz lz kb kc kd ma kf kg kh ig bi translated">表格现在有了很棒的拖放样式。你可以看到它的样子:</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/15c46d4d4b5e5f841e183e925ae6ca48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*o1tsQqxZprPcvSGzMo4CRQ.gif"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk">Data table with all of our styling and animations</figcaption></figure><p id="936f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">完整的例子，你可以从<a class="ae km" href="https://github.com/matteson/drag-drop-data-table" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获取代码。</p></div></div>    
</body>
</html>