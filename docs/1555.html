<html>
<head>
<title>Build a Multiplayer Browser Game with Phaser and Web Sockets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Phaser和Web Sockets构建一个多人浏览器游戏</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/develop-your-first-multiplayer-browser-game-io-99931c7d3a5b?source=collection_archive---------2-----------------------#2021-04-03">https://javascript.plainenglish.io/develop-your-first-multiplayer-browser-game-io-99931c7d3a5b?source=collection_archive---------2-----------------------#2021-04-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="ac2c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">浏览器游戏不需要安装任何客户端软件或任何东西。有些人绝对喜欢它，是了不起的游戏玩家，而对另一些人来说，这可能是消除紧张和转移注意力的好方法(我属于后一类)。没有任何麻烦—您需要做的只是打开网络浏览器，与朋友或网上的人一起玩您喜欢的任何游戏。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/78258687b80833b5d6db455c37583a49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XyIieh0lQw3kfk1x"/></div></div></figure><p id="7e70" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一款撞球游戏或者射击游戏，通常免费玩，多人浏览器游戏值得一试。说到这里，在这篇文章中，我将指导你开发你的第一个多人浏览器游戏。在开始开发游戏之前，确保你有下面提到的东西:</p><ul class=""><li id="8a96" class="ku kv in jm b jn jo jr js jv kw jz kx kd ky kh kz la lb lc bi translated">这是一个服务器环境，我们将使用它来提供文件和处理Web套接字。(下载:【https://nodejs.org/en/download/ T2】</li><li id="c57b" class="ku kv in jm b jn le jr lf jv lg jz lh kd li kh kz la lb lc bi translated"><a class="ae ld" href="http://localhost" rel="noopener ugc nofollow" target="_blank"><strong class="jm io">http://localhost</strong></a>—这是计算机的本地主机地址，用于运行只能从您的机器访问的服务器。</li><li id="009c" class="ku kv in jm b jn le jr lf jv lg jz lh kd li kh kz la lb lc bi translated">这是一个桌面和移动HTML5游戏框架，我们用于客户端游戏逻辑。(下载:<a class="ae ld" href="https://phaser.io/download/stable)" rel="noopener ugc nofollow" target="_blank">https://phaser.io/download/stable)</a>从此链接下载JS文件。</li><li id="53ca" class="ku kv in jm b jn le jr lf jv lg jz lh kd li kh kz la lb lc bi translated"><strong class="jm io"> NPM </strong> —这是一个软件包管理器，使得管理软件包和从终端下载项目变得更加容易。(下载:<a class="ae ld" href="https://www.npmjs.com/get-npm)" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/get-npm)</a></li><li id="5016" class="ku kv in jm b jn le jr lf jv lg jz lh kd li kh kz la lb lc bi translated"><strong class="jm io">Express JS framework</strong>—帮助我们托管服务器并将文件从服务器发送到客户端。(“npm快速安装”)</li><li id="7ee9" class="ku kv in jm b jn le jr lf jv lg jz lh kd li kh kz la lb lc bi translated"><strong class="jm io">web sockets</strong>—NPM:“NPM安装socket.io”</li></ul><p id="3dbf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">一旦我们安装完上面提到的东西，我们现在就可以开始编码了。</p><h2 id="9169" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">设置服务器</h2><p id="0940" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">打开你的VS代码，新建一个名为“Game”的文件夹。在游戏文件夹中，创建一个名为<strong class="jm io"> server.js </strong>的文件。该<em class="mh"> </em>将成为服务器的主入口，即<strong class="jm io">主文件</strong>。我们将处理从这里开始的所有服务器。下面是server.js的代码:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="ed5b" class="lj lk in mj b gy mn mo l mp mq">// loading all dependencies</span><span id="b7c8" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var express = require(‘express’);<br/>var http = require(‘http’);<br/>var path = require(‘path’);<br/>var socketIO = require(‘socket.io’);</strong></span><span id="777b" class="lj lk in mj b gy mr mo l mp mq">//setting the port</span><span id="9c67" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var port = 8080;</strong></span><span id="cf99" class="lj lk in mj b gy mr mo l mp mq">//initializing framework</span><span id="b748" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var players = {};</strong></span><span id="1b99" class="lj lk in mj b gy mr mo l mp mq">// instancing</span><span id="ff7a" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var app = express();</strong> //default constructor<br/><strong class="mj io">var server = http.Server(app);</strong> //to launch Express<br/><strong class="mj io">var io = socketIO(server);</strong> //passing ‘server’ so that it runs on IO server<br/><strong class="mj io">app.set(‘port’, port);</strong></span><span id="0572" class="lj lk in mj b gy mr mo l mp mq">//used ‘public’ folder to use external CSS and JS</span><span id="8dd7" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">app.use(‘/public’, express.static(__dirname + “/public”));</strong></span><span id="ef04" class="lj lk in mj b gy mr mo l mp mq">//port listening</span><span id="b474" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">server.listen(port, function() {<br/>console.log(“listening…”);<br/>});</strong></span><span id="54f8" class="lj lk in mj b gy mr mo l mp mq">//handling requests and responses by setting the Express framework</span><span id="e69d" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">app.get(“/”, function (req, res) {<br/>res.sendFile(path.join(__dirname, “landing.html”));<br/>});</strong></span><span id="030f" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">io.on(‘connection’, function (socket) {</strong> //returns socket which is a piece of data that talks with server and client</span><span id="7435" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">console.log(“Someone has connected”);<br/>players[socket.id] = {<br/>player_id: socket.id,<br/>x: 500,<br/>y: 500<br/>};<br/>socket.emit(‘actualPlayers’, players); </strong>//sends info back to that socket and not to all the other sockets<br/><strong class="mj io">socket.broadcast.emit(‘new_player’, players[socket.id]);</strong></span><span id="6474" class="lj lk in mj b gy mr mo l mp mq">// when player moves send data to others</span><span id="15b8" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">socket.on(‘player_moved’, function(movement_data) {<br/>players[socket.id].x = movement_data.x;<br/>players[socket.id].y = movement_data.y;<br/>players[socket.id].angle = movement_data.angle;</strong></span><span id="5094" class="lj lk in mj b gy mr mo l mp mq">// send the data of movement to all players</span><span id="182d" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">socket.broadcast.emit(‘enemy_moved’, players[socket.id]);<br/>});</strong></span><span id="0df5" class="lj lk in mj b gy mr mo l mp mq">//synchronizing shooting</span><span id="16d4" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">socket.on(‘new_bullet’, function(bullet_data) {<br/>socket.emit(‘new_bullet’, bullet_data);<br/>socket.broadcast.emit(‘new_bullet’, bullet_data);<br/>});<br/>socket.on(‘disconnect’, function () {<br/>console.log(“someone has disconnected”);<br/>delete players[socket.id];<br/>socket.broadcast.emit(‘player_disconnect’, socket.id);<br/>});<br/>});</strong></span></pre><p id="9480" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在上面的代码中，我们使用了一个名为<strong class="jm io">landing.html</strong>的HTML文件，它包含了建立基本网页结构的代码。这个html文件是在游戏文件夹中创建的。landing.html的代码如下所示:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="7faa" class="lj lk in mj b gy mn mo l mp mq">&lt;!DOCTYPE html&gt;<br/>&lt;html lang=”en”&gt;<br/>&lt;head&gt;<br/>&lt;meta charset=”UTF-8"&gt;<br/>&lt;meta name=”viewport” content=”width=device-width, initial-scale=1.0"&gt;<br/>&lt;meta http-equiv=”X-UA-Compatible” content=”ie=edge”&gt;<br/>&lt;script src=”/public/js/phaser.js”&gt;&lt;/script&gt;<br/>&lt;script src=”/public/js/player.js”&gt;&lt;/script&gt;<br/>&lt;script src=”/public/js/shot.js”&gt;&lt;/script&gt;<br/>&lt;script src=”/public/js/enemy.js”&gt;&lt;/script&gt;<br/>&lt;script src=”/socket.io/socket.io.js”&gt;&lt;/script&gt;<br/>&lt;script src=”/public/js/main_game.js”&gt;&lt;/script&gt;<br/>&lt;title&gt;Document&lt;/title&gt;<br/>&lt;style&gt;<br/>body, html {<br/>margin: 0;<br/>padding: 0;<br/>}<br/>&lt;/style&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="5092" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，在游戏文件夹里面新建一个文件夹，命名为“Public”。此外，在公共文件夹中创建一个新文件夹，并将其命名为<strong class="jm io"> js </strong>。将phaser.js文件放入该文件夹。我们现在已经创建了主JS文件，它将在浏览器中启动我们的游戏。</p><h2 id="d332" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">文件和服务器配置</h2><p id="4dd9" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">现在，我们必须创建一个管理整个游戏的文件。我们将在这个文件中初始化游戏和画布。因此，在js文件夹中创建一个新的JS文件，并将其命名为main_game.js。</p><h2 id="a79b" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">扩展类，创建玩家类。</h2><p id="b009" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">Phaser框架提供了基本功能和基本游戏对象。为了让代码<strong class="jm io"> </strong>尽可能的像<strong class="jm io">一样干净和模块化</strong>，我们需要<strong class="jm io">扩展类</strong>。扩展<strong class="jm io">意味着向已经存在的类添加功能</strong>，比如变量、方法和事件。</p><p id="eaf6" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们为玩家使用的游戏对象被称为精灵。<strong class="jm io"> Sprite </strong>是一个可以分配物理碰撞器及其<strong class="jm io">更多功能图像</strong>的类。如果我们想要创建一个类“player”，<strong class="jm io">我们需要扩展我们将使用的类</strong>(这是Sprite类)。</p><p id="b87f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">首先，在js文件夹中创建一个“player.js”文件。在JavaScript中，我们能够通过<strong class="jm io">定义一个类</strong>来扩展类:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="edbd" class="lj lk in mj b gy mn mo l mp mq">class Player {<br/>}</span></pre><p id="0343" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如您所见，第一个关键字是“class ”,表示我们正在创建一个类。第二个关键字是我们的类的名称，它必须与所有其他类不同。</p><p id="33ed" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，让我们<strong class="jm io">延伸一下:</strong></p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="1d0c" class="lj lk in mj b gy mn mo l mp mq">class Player extends Phaser.Physics.Arcade.Sprite {<br/>}</span></pre><p id="9110" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们现在已经<strong class="jm io">定义了</strong>一个叫做Player的类，这个类<strong class="jm io">继承了</strong>Phaser类的功能。物理.街机.雪碧”。</p><p id="9643" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还需要为我们的类定义一个构造函数。构造函数是当我们创建一个类的对象时执行的主入口函数。这可以通过键入<strong class="jm io">构造函数(参数)</strong>来完成:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="a854" class="lj lk in mj b gy mn mo l mp mq">class Player extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y){<br/>}<br/>}</span></pre><p id="d9b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要输入<strong class="jm io"> 3个参数→ </strong> <strong class="jm io">场景</strong>在我们已经在main_game.js中创建的场景上创建一个玩家，<strong class="jm io"> x </strong>和<strong class="jm io"> y </strong>为我们玩家的位置。我们需要调用<strong class="jm io"> super </strong>，这是一个调用扩展类的构造函数的函数，当从我们的player类创建一个对象时，我们会调用它:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="4ddd" class="lj lk in mj b gy mn mo l mp mq">class Player extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y){<br/>super(scene, x, y, "player");<br/>}<br/>}</span></pre><p id="97cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在超级函数中，我们需要通过<strong class="jm io">场景</strong>、<strong class="jm io"> x </strong>和<strong class="jm io"> y坐标</strong>，因为Sprite类的构造函数需要它们。sprite类构造函数<strong class="jm io">也需要一个图像</strong>，它将用于渲染Sprite。我们可以通过键入图像的名称来实现(可以是您选择的任何名称)。</p><p id="c129" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们需要调用的最后一个函数是“add”→一个现有的函数，它将类发送到游戏的渲染部分，并将它渲染到显示器上，以便我们可以看到它。</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="f0c9" class="lj lk in mj b gy mn mo l mp mq">class Player extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y){<br/>super(scene, x, y, "player");<br/>scene.add.existing(this);<br/>}<br/>}</span></pre><p id="40c8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们需要在create函数中将一个对象从player类初始化到Player变量<strong class="jm io"/></p><p id="2e72" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe ms mt mu mj b">this.player = new Player(this, 500, 500);</code></p><p id="59b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">因此，我们在main_game.js中创建了一个播放器。</p><h2 id="aa0d" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">球员运动</h2><p id="1112" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">我们将让我们的玩家移动，但是因为我们必须扩展这个职业，我们可能还需要编辑我们的主游戏循环。那么，这个<strong class="jm io">主游戏循环</strong>是什么？主游戏循环基本上是由函数表示的循环<strong class="jm io">，该函数<strong class="jm io">在每个<strong class="jm io"> CPU滴答</strong>时执行</strong>。这个<strong class="jm io">导致</strong>T21玩家移动</strong>，每秒渲染<strong class="jm io">新帧</strong>。这确实是我们游戏中最重要的功能。正如我之前所说的，我们希望<strong class="jm io">有一个干净的代码</strong>，为此<strong class="jm io"> </strong>我们将<strong class="jm io">在我们的玩家类中创建一个伪主</strong> <strong class="jm io">游戏</strong>循环。这是一个名为“更新”的功能，但它本身并不执行。所以，我们必须在main_game.js的更新函数中执行它。</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="6f74" class="lj lk in mj b gy mn mo l mp mq">class Player extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y){<br/>super(scene, x, y, "player");<br/>scene.add.existing(this);<br/>}<br/>update () { // pseudo update loop in Player class<br/>}<br/>}</span></pre><p id="17f2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在这个更新函数中，我们将制作玩家的运动逻辑。但是有一个先决条件，即<strong class="jm io">在主游戏更新</strong>循环中调用它。我们将通过打开main_game.js和<strong class="jm io">在<strong class="jm io"> update </strong>函数中调用我们的玩家变量</strong>的update方法来做到这一点。</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="7a9e" class="lj lk in mj b gy mn mo l mp mq">function update() {<br/>this.player.update();<br/>}</span></pre><p id="512a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在我们已经理解了大部分内容，我们终于可以为player.js文件编写代码了。player.js文件的代码是:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="0933" class="lj lk in mj b gy mn mo l mp mq"><strong class="mj io">class Player extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y) {</strong></span><span id="535e" class="lj lk in mj b gy mr mo l mp mq">// super</span><span id="0049" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">super(scene, x, y, “player”);</strong></span><span id="ea59" class="lj lk in mj b gy mr mo l mp mq">// render</span><span id="4fa7" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.add.existing(this);</strong></span><span id="314a" class="lj lk in mj b gy mr mo l mp mq">// physics rendering to move around and shoot with our players</span><span id="94fa" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.physics.add.existing(this);<br/>this.player_speed = 600;<br/>this.depth = 5;</strong></span><span id="60fd" class="lj lk in mj b gy mr mo l mp mq">// holds scene</span><span id="7cfd" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.scene = scene;<br/>this.setInteractive();<br/>this.setCollideWorldBounds(true);</strong> //to ensure that the player stays in the window<br/><strong class="mj io">self = this;</strong></span><span id="91ea" class="lj lk in mj b gy mr mo l mp mq">// input handlers</span><span id="4059" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.keyUp = scene.input.keyboard.addKey(‘W’);<br/>this.keyDown = scene.input.keyboard.addKey(‘S’);<br/>this.keyLeft = scene.input.keyboard.addKey(‘A’);<br/>this.keyRight = scene.input.keyboard.addKey(‘D’);</strong></span><span id="963a" class="lj lk in mj b gy mr mo l mp mq">//scene.bullets is a group</span><span id="a50c" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.physics.add.collider(this, scene.bullets, function() {<br/>alert(“You’re dead”);<br/>});</strong></span><span id="d5c5" class="lj lk in mj b gy mr mo l mp mq">// set the players to rotate towards the cursor</span><span id="3b67" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.input.on(“pointermove”, function(pointer) {</strong></span><span id="d59b" class="lj lk in mj b gy mr mo l mp mq">//convert the x and y axis from pointer to world axis</span><span id="5814" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.angle = Phaser.Math.RAD_TO_DEG * Phaser.Math.Angle.Between(this.x, this.y, pointer.x, pointer.y);<br/>this.setAngle(this.angle);<br/>}, this);</strong></span><span id="63f6" class="lj lk in mj b gy mr mo l mp mq">//shoot with the player on pressing F</span><span id="3ad5" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.input.keyboard.on(‘keydown-F’, function() {</strong></span><span id="8c1c" class="lj lk in mj b gy mr mo l mp mq">// player method shoot</span><span id="0529" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var x = self.x;<br/>var y = self.y;<br/>var angle = self.angle;<br/>self.scene.io.emit(‘new_bullet’, {x: x, y: y, angle: angle});</strong> //for synchronizing shooting<br/><strong class="mj io">});<br/>this.old_x = this.x;<br/>this.old_y = this.y;<br/>this.old_angle = this.angle;<br/>}</strong></span><span id="6f58" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">update() {<br/>this.setVelocity(0, 0);</strong> //with every CPU tick, reset velocity to 0 since we don’t want it to forever move upwards or downwards</span><span id="d1fe" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">if (this.keyUp.isDown) {<br/>this.setVelocityY(this.player_speed * -1);<br/>}else if(this.keyDown.isDown){<br/>this.setVelocityY(this.player_speed);<br/>}<br/>if (this.keyRight.isDown) {<br/>this.setVelocityX(this.player_speed);<br/>}else if(this.keyLeft.isDown){<br/>this.setVelocityX(this.player_speed * -1);<br/>}</strong></span><span id="848c" class="lj lk in mj b gy mr mo l mp mq">//synchronizing enemy movement</span><span id="b960" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var x = this.x;<br/>var y = this.y;<br/>var angle = this.angle;</strong></span><span id="e451" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">if (x != this.old_x || y != this.old_y || angle != this.old_angle) {</strong> //this if statement exists only when the player moves</span><span id="2043" class="lj lk in mj b gy mr mo l mp mq">// send socket to server</span><span id="2509" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.scene.io.emit(‘player_moved’, {x: x, y: y, angle: angle});</strong> //the object contains the movement data</span><span id="9076" class="lj lk in mj b gy mr mo l mp mq">//assigning new movement data after the player has moved</span><span id="dbcf" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.old_x = x;<br/>this.old_y = y;<br/>this.old_angle = angle;<br/>}<br/>}<br/>}</strong></span></pre><p id="d607" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">现在，我们需要在js文件夹中创建一个名为shot.js的JavaScript文件，其中包含发射子弹的代码。shot.js的代码如下所示:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="a011" class="lj lk in mj b gy mn mo l mp mq"><strong class="mj io">class Shot extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y, angle) {</strong></span><span id="ccd0" class="lj lk in mj b gy mr mo l mp mq">// super</span><span id="636d" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">super(scene, x, y, “bullet”);</strong></span><span id="1444" class="lj lk in mj b gy mr mo l mp mq">// render</span><span id="583c" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.add.existing(this);</strong></span><span id="3f44" class="lj lk in mj b gy mr mo l mp mq">// physics rendering</span><span id="5455" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.physics.add.existing(this);</strong></span><span id="94d8" class="lj lk in mj b gy mr mo l mp mq">// set angle to shoot in the right direction</span><span id="c44f" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.setAngle(angle);<br/>this.setCollideWorldBounds(true);<br/>this.bullet_speed = 800;<br/>scene.bullets.add(this);</strong></span><span id="c4e6" class="lj lk in mj b gy mr mo l mp mq">// layer depth</span><span id="f069" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.depth = 0;</strong></span><span id="a301" class="lj lk in mj b gy mr mo l mp mq">// DEG TO RAD</span><span id="6751" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">angle = angle * (Math.PI / 180);<br/>this.vx = this.bullet_speed * Math.cos(angle);<br/>this.vy = this.bullet_speed * Math.sin(angle);<br/>this.setVelocity(this.vx, this.vy);<br/>}<br/>}</strong></span></pre><p id="7739" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这是一个多人浏览器游戏，很明显会有敌人。每个客户都认为自己是玩家，其余的是敌人或对手。因此，敌人. js文件的代码是:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="6385" class="lj lk in mj b gy mn mo l mp mq"><strong class="mj io">class Enemy extends Phaser.Physics.Arcade.Sprite {<br/>constructor (scene, x, y, id) {</strong></span><span id="e921" class="lj lk in mj b gy mr mo l mp mq">// super</span><span id="20fa" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">super(scene, x, y, “enemy”);</strong></span><span id="e2ea" class="lj lk in mj b gy mr mo l mp mq">// render</span><span id="b710" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.add.existing(this);</strong></span><span id="df40" class="lj lk in mj b gy mr mo l mp mq">// physics rendering</span><span id="0b27" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.physics.add.existing(this);<br/>this.depth = 5;<br/>this.id = id;<br/>}<br/>shoot() {</strong></span><span id="d6be" class="lj lk in mj b gy mr mo l mp mq">//this function will initialize a shooting from the player. It will spawn a bullet and send it somewhere</span><span id="b96e" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">new Shot(this.scene, this.x, this.y, this.angle);<br/>}<br/>}</strong></span></pre><p id="18ad" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们已经完成了玩家创建、敌人移动、子弹方向和整体配置。现在是时候将所有内容合并到最终的主游戏中了，即main_game.js文件。main_game.js文件的代码如下所示:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="b5c5" class="lj lk in mj b gy mn mo l mp mq">//storing height and width of the client’s browser</span><span id="919b" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var window_height = window.innerHeight;<br/>var window_width = window.innerWidth;</strong></span><span id="09b0" class="lj lk in mj b gy mr mo l mp mq">//since we’re using a phaser, we have to create a variable that holds the config data for the phaser.</span><span id="4ca4" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var config = {<br/>type: Phaser.AUTO,<br/>width: window_width,<br/>height: window_height,<br/>backgroundColor: ‘#000000’,</strong></span><span id="c70c" class="lj lk in mj b gy mr mo l mp mq">//this object will hold configuration for arcade physics</span><span id="2f3e" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">physics: {<br/>default: ‘arcade’,<br/>arcade: {<br/>gravity: {<br/>y: 0,<br/>},</strong></span><span id="1982" class="lj lk in mj b gy mr mo l mp mq">//this means it will not cross 60</span><span id="5940" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">fps: 60,<br/>}<br/>},<br/>scene: {</strong></span><span id="dde3" class="lj lk in mj b gy mr mo l mp mq">//function where the statements and the comments will be executed pre initializing the game</span><span id="296b" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">preload: preload,</strong></span><span id="33c6" class="lj lk in mj b gy mr mo l mp mq">//create function works when the game is initialized only once at a time</span><span id="e0f0" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">create: create,</strong></span><span id="59ea" class="lj lk in mj b gy mr mo l mp mq">//main game loop that executes every CPU tick since we are modifying it upto 60 only</span><span id="de83" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">update: update,<br/>}<br/>}</strong></span><span id="f019" class="lj lk in mj b gy mr mo l mp mq">// holds a game instance</span><span id="9e83" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">var game = new Phaser.Game(config);<br/>var player;<br/>var player_init = false;<br/>function preload() {</strong></span><span id="982b" class="lj lk in mj b gy mr mo l mp mq">// loading images</span><span id="e466" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.load.image(‘player’, ‘public/img/player.png’);<br/>this.load.image(‘bullet’, ‘public/img/bullet.png’);<br/>this.load.image(‘enemy’, ‘public/img/enemy.png’);<br/>}<br/>function create() {<br/>this.io = io();</strong> //initializing a new io server<br/><strong class="mj io">self = this;</strong> //because we have an event handler<br/><strong class="mj io">this.enemies = this.physics.add.group();<br/>this.bullets = this.physics.add.group();<br/>this.io.on(‘actualPlayers’, function(players) {<br/>Object.keys(players).forEach(function (id) {</strong> //looping through the players</span><span id="1e57" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">if (players[id].player_id == self.io.id) {</strong></span><span id="d439" class="lj lk in mj b gy mr mo l mp mq">//we are in the array</span><span id="c5b4" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">createPlayer(self, players[id].x, players[id].y);<br/>}else {</strong></span><span id="86e2" class="lj lk in mj b gy mr mo l mp mq">// we are creating other players</span><span id="8788" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">createEnemy(self, players[id]);<br/>}<br/>});<br/>});<br/>this.io.on(‘new_player’, function (pInfo) {</strong> //we’re sending info about the new player from the server. So, we accept the info by pInfo<br/><strong class="mj io">createEnemy(self.scene, pInfo);<br/>});</strong></span><span id="ba6e" class="lj lk in mj b gy mr mo l mp mq">//synchronizing enemy movement</span><span id="b384" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">enemies_ref = this.enemies;</strong> //holds the reference to the enemy’s group<br/><strong class="mj io">this.io.on(‘enemy_moved’, function(player_data) {<br/>enemies_ref.getChildren().forEach(function(enemy) {<br/>if (player_data.player_id == enemy.id) {</strong> //set a new position for the enemy because the player data and enemy id in the enemy’s group match together</span><span id="83f4" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">enemy.setPosition(player_data.x, player_data.y);<br/>enemy.setAngle(player_data.angle);<br/>}<br/>});<br/>});</strong></span><span id="9173" class="lj lk in mj b gy mr mo l mp mq">//synchronizing shooting</span><span id="1849" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">this.io.on(‘new_bullet’, function(bullet_data) {<br/>new Shot(self.scene, bullet_data.x, bullet_data.y,<br/>bullet_data.angle);<br/>});<br/>}<br/>function update() {<br/>if (this.player_init == true) {<br/>this.player.update();<br/>}<br/>}<br/>function createPlayer(scene, x, y) {</strong></span><span id="91a0" class="lj lk in mj b gy mr mo l mp mq">//creating the player on the scene i.e making the new players visible</span><span id="78ac" class="lj lk in mj b gy mr mo l mp mq"><strong class="mj io">scene.player_init = true;<br/>scene.player = new Player(scene, x, y);<br/>}<br/>function createEnemy(scene, enemy_info) {<br/>const enemy = new Enemy(scene, enemy_info.x, enemy_info.y, enemy_info.player_id);<br/>scene.enemies.add(enemy);<br/>}</strong></span></pre><p id="4856" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们完了。玩游戏很有趣，但是开发自己的游戏太有趣了。当您最终开始使用“node server.js”运行节点服务器，并在浏览器的两个选项卡中键入“localhost:8080”时(扮演两个玩家)，您的游戏是这样运行的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h2 id="75c3" class="lj lk in bd ll lm ln dn lo lp lq dp lr jv ls lt lu jz lv lw lx kd ly lz ma mb bi translated">结论</h2><p id="d611" class="pw-post-body-paragraph jk jl in jm b jn mc jp jq jr md jt ju jv me jx jy jz mf kb kc kd mg kf kg kh ig bi translated">我希望这篇文章对你们在这个单调的时代做一些有趣的事情有足够的帮助。谢谢你阅读它。祝你今天开心！玩的开心！</p><p id="8a84" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="mh">更多内容看</em><a class="ae ld" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jm io"><em class="mh">plain English . io</em></strong></a></p></div></div>    
</body>
</html>