<html>
<head>
<title>How to Detect Clicks Outside a React Component Using Hooks?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用钩子检测React组件外部的点击？</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-detect-clicks-outside-a-react-component-using-hooks-dc8050331b77?source=collection_archive---------5-----------------------#2021-09-05">https://javascript.plainenglish.io/how-to-detect-clicks-outside-a-react-component-using-hooks-dc8050331b77?source=collection_archive---------5-----------------------#2021-09-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/79f671c47479d733411b0bd640a95e27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hd00LmEoYW2RTHdG"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@idellamaeland?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Idella Maeland</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="12f3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时，我们可能希望检测React组件外部的单击，例如我们希望创建一个弹出菜单，当我们在外部单击时它会关闭。</p><p id="5974" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将研究如何用钩子检测React组件外部的点击。</p><h1 id="2742" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">监听页面上的点击</h1><p id="bb32" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以监听页面上的点击来检测我们点击了页面的哪个位置。</p><p id="49b2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我们在组件外部单击，那么我们就从DOM中移除React组件。</p><p id="9ebd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">检查我们点击的位置并相应地运行代码称为事件委托。</p><p id="7da6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="dbdd" class="mn lc iq mj b gy mo mp l mq mr">import React, { useEffect, useRef, useState } from "react";</span><span id="76e8" class="mn lc iq mj b gy ms mp l mq mr">const useComponentVisible = (initialIsVisible) =&gt; {<br/>  const [isComponentVisible, setIsComponentVisible] = useState(<br/>    initialIsVisible<br/>  );<br/>  const ref = useRef(null);</span><span id="75b1" class="mn lc iq mj b gy ms mp l mq mr">  const handleClickOutside = (event) =&gt; {<br/>    if (ref.current &amp;&amp; !ref.current.contains(event.target)) {<br/>      setIsComponentVisible(false);<br/>    }<br/>  };</span><span id="7ded" class="mn lc iq mj b gy ms mp l mq mr">  useEffect(() =&gt; {<br/>    document.addEventListener("click", handleClickOutside, true);<br/>    return () =&gt; {<br/>      document.removeEventListener("click", handleClickOutside, true);<br/>    };<br/>  });</span><span id="ac54" class="mn lc iq mj b gy ms mp l mq mr">return { ref, isComponentVisible, setIsComponentVisible };<br/>};</span><span id="7867" class="mn lc iq mj b gy ms mp l mq mr">  const DropDown = () =&gt; {<br/>  const { ref, isComponentVisible } = useComponentVisible(true);</span><span id="b6ea" class="mn lc iq mj b gy ms mp l mq mr">  return &lt;div ref={ref}&gt;{isComponentVisible &amp;&amp; &lt;p&gt;drop down&lt;/p&gt;}&lt;/div&gt;;<br/>};</span><span id="0b5b" class="mn lc iq mj b gy ms mp l mq mr">export default function App() {<br/>  return (<br/>    &lt;div&gt;<br/>      &lt;DropDown /&gt;<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="6407" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建了<code class="fe mt mu mv mj b">useComponentVisible</code>钩子来观察页面上的点击。</p><p id="7c7d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们首先定义<code class="fe mt mu mv mj b">isComponentVisible</code>状态来跟踪组件何时应该可见。</p><p id="fa33" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将它设置为<code class="fe mt mu mv mj b">initialVisible</code>的适当值。</p><p id="c167" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们定义一个<code class="fe mt mu mv mj b">ref</code>，当我们点击外部时，它被分配给我们想要关闭的组件。</p><p id="7dad" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe mt mu mv mj b">handleClickOutside</code>函数中做元素检查。</p><p id="316f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这时我们调用<code class="fe mt mu mv mj b">contains</code>来检查我们点击的元素是否在组件之外。</p><p id="f192" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果<code class="fe mt mu mv mj b">!ref.current.contains(event.target)</code>是<code class="fe mt mu mv mj b">true</code>，那么我们知道我们点击了组件外部。</p><p id="ea5c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们调用<code class="fe mt mu mv mj b">document.addEventListener</code>来监听整个页面上的点击，这样我们就可以进行上面的检查。</p><p id="6617" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们卸载组件时，我们返回一个调用<code class="fe mt mu mv mj b">removeEventListener</code>来删除事件监听器的回调。</p><p id="1d8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">接下来，我们将<code class="fe mt mu mv mj b">DropDown</code>组件定义为获取我们返回的ref和<code class="fe mt mu mv mj b">isComponentVisible</code>状态。</p><p id="b4c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我们将ref分配给div，因此我们使用click事件侦听器来进行比较。</p><p id="70f7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，我们将<code class="fe mt mu mv mj b">DropDown</code>组件添加到<code class="fe mt mu mv mj b">App</code>中，这样我们就可以看到它了。</p><p id="fb15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，当我们在文本外单击时，文本应该会消失。</p><h1 id="f687" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="5e06" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以检测React组件外部的点击，方法是当我们在组件外部点击时，给我们想要关闭的组件分配一个ref。</p><p id="696a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们可以将一个事件处理程序附加到<code class="fe mt mu mv mj b">document</code>上，并检查我们是否在被分配了ref的元素之外单击了鼠标。</p></div></div>    
</body>
</html>