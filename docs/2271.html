<html>
<head>
<title>Building iDrift, An Online Racing Game</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建在线赛车游戏iDrift</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/idrift-3d7c6b7cdcd1?source=collection_archive---------24-----------------------#2021-05-11">https://javascript.plainenglish.io/idrift-3d7c6b7cdcd1?source=collection_archive---------24-----------------------#2021-05-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9e58" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个全新的赛车游戏，类似于旧的遥控赛车电路</h2></div><h1 id="cd50" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="4321" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个项目的目的是开发一个<a class="ae lt" href="https://idrift.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">在线游戏</a>(请给网页几秒钟时间充电)，类似于老式的RC汽车电路，其中的部件只有1个自由度(图1)。这里考虑了两个。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/613201f304e1f932aa4014db01e0a4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nBlX57-Uv1MtNjDF"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk"><strong class="bd mk">Figure 1</strong> Old RC car circuits</figcaption></figure><h1 id="d5ec" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">发展</h1><p id="0288" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了创建网站和嵌入式游戏，使用了HTML、CSS和JavaScript编程语言。网站的页眉、页脚和类似控制台的图像都是用HTML添加的。前面元素的每一个个性化(大小、颜色……)都是使用CSS实现的。最后，JavaScript允许用户和游戏本身之间的交互。此外，每次点击按钮时增加一个动态行为。</p><p id="f8be" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">沿着这一节，将解释游戏的核心功能。这个描述将不仅包括服务器细节，还包括游戏范围限制，棋子和一些通用工具，允许用户控制汽车，暂停，恢复，重置和静音游戏。</p><h2 id="4810" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">服务器</strong></h2><p id="e8cb" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">它没有在GitHub的静态网页中运行游戏，而是被认为是在web服务器(Heroku)中运行，这样它就可以允许动态内容，例如:带有玩家姓名的最高分数列表。由于时间限制，并且因为Heroku的免费帐户不会保存最近生成的信息超过一天，所以没有包括在内。</p><p id="3177" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">关于实施的更多细节，请点击<a class="ae lt" href="https://github.com/warcraft12321/iDrift/blob/gh-pages/server.js" rel="noopener ugc nofollow" target="_blank">这里。</a></p><h2 id="4d18" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">游戏限制</strong></h2><p id="5c79" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了限制汽车在道路上的运动，设计了几个多边形，使它们的形状与背景图像中的草地重合(图2)。做了这个，汽车就不允许跨过去了。</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="f4b4" class="mq kg iq nd b gy nh ni l nj nk">const polygon = [[270,141],[291,144],[308,153],[320,161],[332,173],[343,188],[352,198],[362,208],[371,219],[381,233],[391,245],[403,254],[417,269],[430,283],[446,296],[460,311],[476,322],[488,332],[504,344],[517,353],[531,361],[544,367],[559,374],[574,382],[590,385],[606,390],[624,392],[641,393],[659,393],[676,392],[695,389],[711,384],[740,375],[760,364],[780,352],[825,319],[854,293],[883,262],[906,232],[935,194],[957,164],[976,139],[989,131],[1001,123],[1015,118],[1030,118],[1045,121],[1055,124],[1066,130],[1075,136],[1083,147],[1092,155],[1100,167],[1107,179],[1113,190],[1117,206],[1121,223],[1123,238],[1123,260],[1124,407],[1122,439],[1116,465],[1109,482],[1101,500],[1090,515],[1079,530],[1065,544],[1053,556],[1039,567],[1017,581],[996,590],[971,599],[936,604],[903,606],[874,605],[842,605],[814,602],[784,602],[750,604],[715,605],[236,608],[210,604],[199,599],[193,596],[187,593],[181,587],[175,581],[171,571],[165,559],[163,547],[161,534],[159,520],[158,252],[159,226],[166,210],[174,193],[182,182],[194,168],[209,157],[226,150],[243,144],[254,141]];</span></pre><p id="fa39" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">每个多边形由一系列依次相连的点(x和y坐标)组成。为了实时测试汽车的位置是否不在任何定义的多边形内，实现了以下功能:</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="79ef" class="mq kg iq nd b gy nh ni l nj nk">function isPointInPoly(point, vs) {</span><span id="20f5" class="mq kg iq nd b gy nl ni l nj nk">    let x = point[0], y = point[1];</span><span id="c5ea" class="mq kg iq nd b gy nl ni l nj nk">    let inside = false;<br/>    for (let i = 0, j = vs.length - 1; i &lt; vs.length; j = i++) {<br/>        let xi = vs[i][0], yi = vs[i][1];<br/>        let xj = vs[j][0], yj = vs[j][1];</span><span id="cede" class="mq kg iq nd b gy nl ni l nj nk">        let intersect = ((yi &gt; y) !== (yj &gt; y))<br/>            &amp;&amp; (x &lt; (xj - xi) * (y - yi) / (yj - yi) + xi);<br/>        if (intersect) inside = !inside;<br/>    }</span><span id="6d02" class="mq kg iq nd b gy nl ni l nj nk">    return inside;<br/>}</span></pre><p id="474f" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">无论前面的条件是否得到验证，它都返回一个布尔值。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/b43d0e15225a9fa15c09985c8d9d2598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zPFYzDnaNF8RNII4"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk"><strong class="bd mk">Figure 2</strong> Circuit designed using Pixelmator Pro</figcaption></figure><p id="84d7" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">有关实施的更多详情，请点击<a class="ae lt" href="https://github.com/warcraft12321/iDrift/blob/gh-pages/website/index.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h2 id="8fbb" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">游戏棋子</strong></h2><p id="c325" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">每块的形状如下所示(图3)。前面的线代表汽车的前部。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/13371619df623545a27acd95ec9b7b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hugY3B0sSj2KAVBA"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk"><strong class="bd mk">Figure 3</strong> Game piece. Front face highlighted with a vertical black line</figcaption></figure><p id="d049" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">下面，是部分代表了游戏棋子的一些属性。即它的宽度、高度、速度、角度、运动角度和它的当前位置。</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="a741" class="mq kg iq nd b gy nh ni l nj nk">function Component(width, height, color, x, y, type) {</span><span id="8a46" class="mq kg iq nd b gy nl ni l nj nk">            this.type = type;<br/>            if (type === "image") {<br/>                this.image = new Image();<br/>                this.image.src = color;<br/>            }<br/>            this.width = width;<br/>            this.height = height;<br/>            this.speed = 0;<br/>            this.angle = 0;<br/>            this.moveAngle = 0;<br/>            this.x = x;<br/>            this.y = y;<br/>.<br/>.<br/>.<br/>        }</span></pre><p id="6be7" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">通过点击顶部或底部箭头之一，用户改变汽车的加速度模块(常数值= 2)。这是由重力速度变量给出的。</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="be66" class="mq kg iq nd b gy nh ni l nj nk">if (myGameArea.keys &amp;&amp; myGameArea.keys[38]) {myGamePiece.speed = 2; carSound1.play(); if(gravitySpeed1 &lt; 7){gravitySpeed1 += 0.1;}}<br/>if (myGameArea.keys &amp;&amp; myGameArea.keys[40]) {myGamePiece.speed = -2; carSound1.play(); if(gravitySpeed1 &gt; -7){gravitySpeed1 -= 0.1;}}</span></pre><p id="797e" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">因此，棋子移动的速度由下式给出:</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="2a03" class="mq kg iq nd b gy nh ni l nj nk">finalSpeed = this.speed + gravitySpeed1;</span></pre><p id="c10e" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">并且位置不仅根据汽车的速度更新，而且根据角度更新:</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="2acd" class="mq kg iq nd b gy nh ni l nj nk">this.x += (this.speed + gravitySpeed1) * Math.sin(this.angle);<br/>this.y -= (this.speed + gravitySpeed1) * Math.cos(this.angle);</span></pre><p id="96cc" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">这3个值每20毫秒更新一次。</p><p id="85d1" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">有关实施的更多详情，请单击此处的<a class="ae lt" href="https://github.com/warcraft12321/iDrift/blob/gh-pages/website/index.html" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="1fdf" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">启动、暂停、重启&amp;静音</strong></h2><p id="5000" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">游戏界面中有4个按钮，允许用户开始游戏、暂停、重启和静音。作为一个例子，下面显示了每当玩家暂停游戏时执行的功能。其余3个遵循类似的方法。</p><pre class="lv lw lx ly gt nc nd ne nf aw ng bi"><span id="ccde" class="mq kg iq nd b gy nh ni l nj nk">function pauseGame() {</span><span id="a964" class="mq kg iq nd b gy nl ni l nj nk">    if (pauseGameAux === false) {<br/>        document.getElementById("pause").style.width = "30px";<br/>        document.getElementById("pause").setAttribute("src","../img/play.png");</span><span id="d5e3" class="mq kg iq nd b gy nl ni l nj nk">        pauseGameAux = true;<br/>        myGameArea.stop();<br/>        music.muted = true;<br/>        music.pause();</span><span id="6a15" class="mq kg iq nd b gy nl ni l nj nk">    } else if(pauseGameAux === true) {</span><span id="3e3a" class="mq kg iq nd b gy nl ni l nj nk">        document.getElementById("pause").style.width = "45px";<br/>        document.getElementById("pause").setAttribute("src","../img/pause.png");<br/>        if(muteAudioAux === false){<br/>            music.muted = false;<br/>            music.play();<br/>        }<br/>        pauseGameAux = false;<br/>        myGameArea.restart();</span><span id="0cb4" class="mq kg iq nd b gy nl ni l nj nk">    }<br/>}</span></pre><p id="224c" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">它首先检查游戏是否处于暂停模式。如果不是，则按钮标志更新为暂停模式；游戏画面定格，音乐停止。反之亦然。</p><p id="8207" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated">关于实施的更多细节，请点击<a class="ae lt" href="https://github.com/warcraft12321/iDrift/blob/gh-pages/website/index.html" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><h2 id="6c22" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">命令</strong></h2><p id="09a4" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这个游戏有4个基本命令(图4)。如果您单击顶部箭头，您将能够向前移动。通过点击指向底部的按钮，如果你向前移动棋子，你将会先后退或减速。侧箭头可以让你向左或向右转动棋子。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/923a8ac7c68d7d2f1c5a5ba981dfed0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/0*ZP37gMxqbjQzKNoy"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk"><strong class="bd mk">Figure 4</strong> Keyboard controllers</figcaption></figure><h2 id="81a8" class="mq kg iq bd kh mr ms dn kl mt mu dp kp lg mv mw kr lk mx my kt lo mz na kv nb bi translated"><strong class="ak">结论</strong></h2><p id="bbd9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">开发了一款功能齐全的单人网络游戏。该电路经过精心设计，类似于图2所示的老式遥控汽车游戏。生活不能全是解决问题。我们应该找到激励我们的东西。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi nn"><img src="../Images/616e605d0391678684e362b8a09bc86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1p7ek9p3sbLBCjia4y4rDQ.jpeg"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk"><strong class="bd mk">Figure 5 </strong>iDrift screenshot</figcaption></figure><div class="no np gp gr nq nr"><a href="https://github.com/warcraft12321/iDrift" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd ir gy z fp nw fr fs nx fu fw ip bi translated">warcraft12321/iDrift</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">Permalink无法加载最新的提交信息。一个全新的赛车游戏，类似于旧的遥控赛车电路…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">github.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of me nr"/></div></div></a></div><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="9651" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated"><a class="ae lt" href="https://idrift.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://idrift.herokuapp.com/</a></p><p id="4c58" class="pw-post-body-paragraph kx ky iq kz b la ml jr lc ld mm ju lf lg mn li lj lk mo lm ln lo mp lq lr ls ij bi translated"><em class="oi">更多内容请看</em><a class="ae lt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="oi">plain English . io</em></a></p></div></div>    
</body>
</html>