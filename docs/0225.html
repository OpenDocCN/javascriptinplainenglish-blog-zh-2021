<html>
<head>
<title>Adding Authentication to a Nuxt App with the Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase向Nuxt应用程序添加身份验证</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/adding-authentication-to-a-nuxt-app-with-the-firebase-cb9739583a2f?source=collection_archive---------7-----------------------#2021-01-13">https://javascript.plainenglish.io/adding-authentication-to-a-nuxt-app-with-the-firebase-cb9739583a2f?source=collection_archive---------7-----------------------#2021-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/4b7d5fe42ba827a4edf3c13161525c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9FGr7ZLiUxF-S-rS"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@feliixlam?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Félix Lam</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2c21" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用Nuxt Auth模块，我们可以轻松地将身份验证添加到我们的Nuxt应用程序中。</p><p id="aa00" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一种方法是用Firebase添加身份验证。</p><p id="d053" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何向服务器端呈现的Nuxt应用程序添加Firebase身份验证。</p><h1 id="0fe4" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装软件包</h1><p id="0b7c" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须添加一些包来将Firebase添加到我们的Nuxt应用程序中。</p><p id="a170" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们运行:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="91db" class="mn lc iq mj b gy mo mp l mq mr">npm i @nuxtjs/firebase @nuxtjs/pwa firebase firebase-admin</span></pre><p id="b2b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">添加所需的包。</p><h1 id="f0bd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">配置</h1><p id="34af" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须向我们的Nuxt应用程序添加配置，以便我们可以在加载页面时获取用户。</p><p id="fa4e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<code class="fe ms mt mu mj b">nuxt.config.js</code>中，我们写道:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="26e4" class="mn lc iq mj b gy mo mp l mq mr">export default {<br/>  /*<br/>  ** Nuxt rendering mode<br/>  ** See https://nuxtjs.org/api/configuration-mode<br/>  */<br/>  mode: 'universal',<br/>  /*<br/>  ** Nuxt target<br/>  ** See https://nuxtjs.org/api/configuration-target<br/>  */<br/>  target: 'server',<br/>  /*<br/>  ** Headers of the page<br/>  ** See https://nuxtjs.org/api/configuration-head<br/>  */<br/>  head: {<br/>    title: process.env.npm_package_name || '',<br/>    meta: [<br/>      { charset: 'utf-8' },<br/>      { name: 'viewport', content: 'width=device-width, initial-scale=1' },<br/>      { hid: 'description', name: 'description', content: process.env.npm_package_description || '' }<br/>    ],<br/>    link: [<br/>      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }<br/>    ]<br/>  },<br/>  /*<br/>  ** Global CSS<br/>  */<br/>  css: [<br/>  ],<br/>  /*<br/>  ** Plugins to load before mounting the App<br/>  ** https://nuxtjs.org/guide/plugins<br/>  */<br/>  plugins: [<br/>  ],<br/>  /*<br/>  ** Auto import components<br/>  ** See https://nuxtjs.org/api/configuration-components<br/>  */<br/>  components: true,<br/>  /*<br/>  ** Nuxt.js dev-modules<br/>  */<br/>  buildModules: [<br/>  ],<br/>  /*<br/>  ** Nuxt.js modules<br/>  */<br/>  modules: [<br/>    // Doc: https://axios.nuxtjs.org/usage<br/>    '@nuxtjs/axios',<br/>    '@nuxtjs/pwa',<br/>    [<br/>      '@nuxtjs/firebase',<br/>      {<br/>        config: {<br/>          apiKey: "api-key",<br/>          authDomain: "project-id.firebaseapp.com",<br/>          databaseURL: "https://project-id.firebaseio.com",<br/>          projectId: "project-id",<br/>          storageBucket: "project-id.appspot.com",<br/>          messagingSenderId: 'message-sender-id',<br/>          appId: "BookDb"<br/>        },<br/>        services: {<br/>          auth: {<br/>            persistence: 'local',<br/>            initialize: {<br/>              onAuthStateChangedMutation: "SET_USER",<br/>              onAuthStateChangedAction: 'onAuthStateChangedAction',<br/>            },<br/>            ssr: {<br/>              serverLogin: {<br/>                sessionLifetime: 60 * 60 * 1000,<br/>                loginDelay: 50<br/>              }<br/>            }<br/>          }<br/>        }<br/>      }<br/>    ]<br/>  ],<br/>  /*<br/>  ** Axios module configuration<br/>  ** See https://axios.nuxtjs.org/options<br/>  */<br/>  axios: {</span><span id="1bb9" class="mn lc iq mj b gy mv mp l mq mr">},<br/>  /*<br/>  ** Build configuration<br/>  ** See https://nuxtjs.org/api/configuration-build/<br/>  */<br/>  build: {<br/>  },<br/>  firebase: {<br/>    services: {<br/>      auth: {<br/>        ssr: true<br/>      }<br/>    }<br/>  },<br/>  pwa: {<br/>    meta: false,<br/>    icon: false,<br/>    workbox: {<br/>      importScripts: [<br/>        '/firebase-auth-sw.js'<br/>      ],<br/>      dev: true<br/>    }<br/>  }<br/>}</span></pre><p id="e280" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们添加了带有许多选项的<code class="fe ms mt mu mj b">@nuxtjs/firebase</code>模块。</p><p id="3349" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">config</code>属性有Firebase配置选项。</p><p id="d751" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">services</code>配置<code class="fe ms mt mu mj b">auth</code>服务来持久化用户。</p><p id="cf8d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">onAuthStateChangeMutation</code>动作是保存认证用户数据的Vuex动作。</p><p id="c807" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">ssr</code>有保留用户数据多长时间的选项。</p><p id="c8ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">sessionLifetime</code>属性具有会话生存期。</p><p id="9a84" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">而<code class="fe ms mt mu mj b">loginDelay</code>是成功登录后保存用户数据的延迟。</p><h1 id="29d9" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Vuex商店</h1><p id="7479" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们必须创建一个Vuex商店来存储数据。</p><p id="1c75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，我们创建一个<code class="fe ms mt mu mj b">store/index.js</code>文件并编写:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="9f05" class="mn lc iq mj b gy mo mp l mq mr">export const state = () =&gt; ({<br/>  authUser: {}<br/>})</span><span id="1b19" class="mn lc iq mj b gy mv mp l mq mr">export const actions = {<br/>  async onAuthStateChangedAction({ commit }, { authUser, claims }) {<br/>    const { uid, email, emailVerified, displayName, photoURL } = authUser</span><span id="5172" class="mn lc iq mj b gy mv mp l mq mr">  commit('SET_USER', {<br/>      uid,<br/>      email,<br/>      emailVerified,<br/>      displayName,<br/>      photoURL,<br/>      isAdmin: claims.custom_claim<br/>    })<br/>  },<br/>  async nuxtServerInit({ dispatch, commit }, { res }) {<br/>    console.log(res.locals)<br/>    if (res &amp;&amp; res.locals &amp;&amp; res.locals.user) {<br/>      const { allClaims: claims, idToken: token, ...authUser } = res.locals.user<br/>      await dispatch('onAuthStateChangedAction', {<br/>        authUser,<br/>        claims,<br/>        token<br/>      })<br/>      commit('ON_AUTH_STATE_CHANGED_MUTATION', { authUser, claims, token })<br/>    }<br/>  }<br/>}</span><span id="8f7a" class="mn lc iq mj b gy mv mp l mq mr">export const mutations = {<br/>  ON_AUTH_STATE_CHANGED_MUTATION(state, { authUser, claims }) {<br/>    const { uid, email, emailVerified, displayName, photoURL } = authUser</span><span id="0430" class="mn lc iq mj b gy mv mp l mq mr">    state.authUser = {<br/>      uid,<br/>      displayName,<br/>      email,<br/>      emailVerified,<br/>      photoURL: photoURL || null,<br/>      isAdmin: claims.custom_claim<br/>    }<br/>  },<br/>  SET_USER(state, payload) {<br/>    console.log(payload)<br/>    state.authUser = payload;<br/>  }<br/>}</span></pre><p id="78fc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">onAuthStateChanged</code>动作由<code class="fe ms mt mu mj b">nuxtServerInit</code>调用，以在页面加载时设置认证用户的数据。</p><p id="be1b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">页面加载时运行<code class="fe ms mt mu mj b">nuxtServerInit</code>。</p><p id="aa5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">ON_AUTH_STATE_CHANGED_MUTATION</code>是保存<code class="fe ms mt mu mj b">authUser</code>状态的突变。</p><p id="9c4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe ms mt mu mj b">SET_USER</code>设置<code class="fe ms mt mu mj b">authUser</code>状态。</p><p id="4494" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当我们运行<code class="fe ms mt mu mj b">this.$fireAuth.signInWithEmailAndPassword</code>方法时，通过正确的凭证验证运行成功，那么动作和突变将会运行。</p><p id="cbd4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还将设置<code class="fe ms mt mu mj b">nuxtServerInit</code>中的<code class="fe ms mt mu mj b">res.locals.user</code>属性，以便我们在页面加载时拥有当前登录用户的数据。</p><h1 id="96d6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">登录表单</h1><p id="0cc2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">最后，我们需要一个登录表单，以便我们可以登录。</p><p id="0f3f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建一个<code class="fe ms mt mu mj b">login.vue</code>文件并添加:</p><pre class="me mf mg mh gt mi mj mk ml aw mm bi"><span id="78d8" class="mn lc iq mj b gy mo mp l mq mr">&lt;template&gt;<br/>  &lt;div class="container"&gt;<br/>    &lt;form @submit="signIn"&gt;<br/>      &lt;div&gt;<br/>        &lt;label&gt;Username&lt;/label&gt;<br/>        &lt;input type="text" v-model="login.email" /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;label&gt;Password&lt;/label&gt;<br/>        &lt;input type="text" v-model="login.password" /&gt;<br/>      &lt;/div&gt;<br/>      &lt;div&gt;<br/>        &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>      &lt;/div&gt;<br/>    &lt;/form&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="57da" class="mn lc iq mj b gy mv mp l mq mr">&lt;script&gt;<br/>export default {<br/>  data() {<br/>    return {<br/>      login: {},<br/>    };<br/>  },<br/>  methods: {<br/>    async signIn() {<br/>      try {<br/>        const { email, password } = this.login;<br/>        await this.$fireAuth.signInWithEmailAndPassword(email, password);<br/>      } catch (error) {<br/>        console.log(error);<br/>      }<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="ca22" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建一个登录表单，如果我们使用正确的电子邮件和密码登录，就会运行Vuex操作来设置数据。</p><p id="46a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是因为Nuxt Firebase自带的<code class="fe ms mt mu mj b">static/assets/firebase-auth-sw.js</code>服务人员会在后台为我们工作。</p><p id="e6ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>