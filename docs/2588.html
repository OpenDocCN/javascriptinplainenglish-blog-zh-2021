<html>
<head>
<title>How to Upload an Image to the Laravel API in React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中将图像上传到Laravel API</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-upload-an-image-to-laravel-api-in-react-native-4176f1c00b97?source=collection_archive---------3-----------------------#2021-05-28">https://javascript.plainenglish.io/how-to-upload-an-image-to-laravel-api-in-react-native-4176f1c00b97?source=collection_archive---------3-----------------------#2021-05-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/aa2f4950701711354c91f094b34e7999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pFr4Jq3-qkiVk7mi"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@danielkorpai?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Daniel Korpai</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="c8e3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在大多数移动应用程序中，将图像上传到服务器是一项非常常见的任务。这项任务对一些开发人员来说可能具有挑战性。本文将一步一步地向您展示如何将React本机应用程序上的图像上传到Laravel API。</p><p id="711b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文分为两部分。</p><ul class=""><li id="db47" class="ky kz in kc b kd ke kh ki kl la kp lb kt lc kx ld le lf lg bi translated">拉勒韦尔API</li><li id="baea" class="ky kz in kc b kd lh kh li kl lj kp lk kt ll kx ld le lf lg bi translated">React原生应用</li></ul></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><h2 id="262b" class="lt lu in bd lv lw lx dn ly lz ma dp mb kl mc md me kp mf mg mh kt mi mj mk ml bi translated"><strong class="ak">第1部分:Laravel API </strong></h2><p id="93e3" class="pw-post-body-paragraph ka kb in kc b kd mm kf kg kh mn kj kk kl mo kn ko kp mp kr ks kt mq kv kw kx ig bi translated"><strong class="kc io">步骤1: </strong>使用composer创建一个新的Laravel项目。你可以给它取任何名字，但是在这种情况下，我们将把它命名为<em class="mr"> ImageApi </em>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="42b9" class="lt lu in mx b gy nb nc l nd ne">composer create-project --prefer-dist laravel/laravel ImageApi</span></pre><p id="24bb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤2: </strong>在ImageApi项目中创建一个迁移来创建一个<em class="mr"> images </em>表。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b521" class="lt lu in mx b gy nb nc l nd ne">php artisan make:migration create_images_table --create=images</span></pre><p id="9970" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤3: </strong>在迁移中添加图像字段<em class="mr"> Title </em>和<em class="mr"> Uri。</em></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="b65f" class="lt lu in mx b gy nb nc l nd ne">&lt;?php</span><span id="4648" class="lt lu in mx b gy nf nc l nd ne">use Illuminate\Support\Facades\Schema;<br/>use Illuminate\Database\Schema\Blueprint;<br/>use Illuminate\Database\Migrations\Migration;</span><span id="1a41" class="lt lu in mx b gy nf nc l nd ne">class CreateImagesTable extends Migration<br/>{<br/>    <br/>    public function up()<br/>    {<br/>        Schema::create('images', function (Blueprint $table) {<br/>            $table-&gt;increments('id');<br/>            $table-&gt;string('title');<br/>            $table-&gt;string('uri');<br/>            $table-&gt;timestamps();<br/>        });<br/>    }</span><span id="06fe" class="lt lu in mx b gy nf nc l nd ne"><br/>    public function down()<br/>    {<br/>        Schema::drop('images');<br/>    }<br/>}</span></pre><p id="0e34" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤4: </strong>接下来，创建一个名为Image的模型</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="dd40" class="lt lu in mx b gy nb nc l nd ne">php artisan make:model Image</span></pre><p id="6f9d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤5: </strong>在模型中，在可填充数组中添加图像字段和Uri字段。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="18da" class="lt lu in mx b gy nb nc l nd ne">&lt;?php</span><span id="86e9" class="lt lu in mx b gy nf nc l nd ne">namespace App;</span><span id="a5e6" class="lt lu in mx b gy nf nc l nd ne">use Illuminate\Database\Eloquent\Model;</span><span id="7c1b" class="lt lu in mx b gy nf nc l nd ne">class Image extends Model<br/>{<br/>    protected $table = 'images';</span><span id="7387" class="lt lu in mx b gy nf nc l nd ne">    protected $fillable = [<br/>        'title', 'url'<br/>    ];<br/>}</span></pre><p id="e212" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第五步:接下来，创建一个控制器，命名为ImageController。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="6ad5" class="lt lu in mx b gy nb nc l nd ne">php artisan make:controller ImageController</span></pre><p id="a69f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第六步:</strong>给图像控制器添加一个名为<em class="mr"> addimage的函数。</em></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="45ad" class="lt lu in mx b gy nb nc l nd ne">&lt;?php</span><span id="0490" class="lt lu in mx b gy nf nc l nd ne">namespace App\Http\Controllers;</span><span id="421b" class="lt lu in mx b gy nf nc l nd ne">use App\Image;<br/>use App\Http\Controllers\Controller;</span><span id="1116" class="lt lu in mx b gy nf nc l nd ne">class ImageController extends Controller<br/>{<br/>   <br/>    public function addimage(Request $request)<br/>    {</span><span id="f970" class="lt lu in mx b gy nf nc l nd ne">        $image = new Image;</span><span id="cdd8" class="lt lu in mx b gy nf nc l nd ne">        $image-&gt;title = $request-&gt;title;<br/>        <br/>        if ($request-&gt;hasFile('image')) {<br/>            <br/>            $path = $request-&gt;file('image')-&gt;store('images');</span><span id="79f5" class="lt lu in mx b gy nf nc l nd ne">            $image-&gt;url = $path;<br/>        }</span><span id="68fd" class="lt lu in mx b gy nf nc l nd ne">        $image-&gt;save();</span><span id="ad8f" class="lt lu in mx b gy nf nc l nd ne">        return new ImageResource($image);<br/>    }<br/>}<br/></span></pre><p id="3738" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第七步:</strong>最后在api.php文件的routes文件夹中</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2c67" class="lt lu in mx b gy nb nc l nd ne">&lt;?php</span><span id="56c2" class="lt lu in mx b gy nf nc l nd ne">use Illuminate\Http\Request;</span><span id="4ac3" class="lt lu in mx b gy nf nc l nd ne"><br/><br/>Route::resource('imageadd', 'Api\ImageController@addimage');<br/></span></pre><p id="17e8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建一个Api端点</p><blockquote class="ng nh ni"><p id="0af5" class="ka kb mr kc b kd ke kf kg kh ki kj kk nj km kn ko nk kq kr ks nl ku kv kw kx ig bi translated"><domain-name> /api/imageadd</domain-name></p></blockquote><p id="f69d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">React本机应用程序将访问这个API端点。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="b412" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第二部分:React原生应用</strong></p><p id="38b7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤1: </strong>使用expo创建一个新的React原生项目。称之为imageUploaderApp。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4e88" class="lt lu in mx b gy nb nc l nd ne">expo init imageUploaderApp</span></pre><p id="c85c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第二步:</strong>然后把formik库安装到app上。点击阅读Formik文档<a class="ae jz" href="https://formik.org/docs/overview" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="c962" class="lt lu in mx b gy nb nc l nd ne">npm install formik --save</span></pre><p id="ee4c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第三步:</strong>将Expo image Picker安装到应用程序中。点击阅读Expo图像拾取器文档<a class="ae jz" href="https://docs.expo.io/versions/latest/sdk/imagepicker/" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="979f" class="lt lu in mx b gy nb nc l nd ne">expo install expo-image-picker</span></pre><p id="3f83" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第四步:</strong>接下来，安装RN Blob Fetch到app。阅读RN Blob获取文档<a class="ae jz" href="https://www.npmjs.com/package/rn-fetch-blob" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="adee" class="lt lu in mx b gy nb nc l nd ne">npm install --save rn-fetch-blob</span></pre><p id="02c9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在React原生应用的<em class="mr"> App.js </em>上</p><p id="4877" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤5: </strong>使用<em class="mr"> useState创建两个状态变量。</em>第一个变量将存储<strong class="kc io">图像文件</strong>，第二个变量将存储<strong class="kc io">图像URI </strong>。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f745" class="lt lu in mx b gy nb nc l nd ne">const [fileContent, setFileContent] = useState(null);<br/>const [fileUri, setFileUri] = useState(null);</span></pre><p id="244a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">步骤6: </strong>创建一个处理函数，从系统映像库中选择一个映像。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="3224" class="lt lu in mx b gy nb nc l nd ne">onChooseImagePress = async () =&gt; {<br/>  let result = await ImagePicker.launchImageLibraryAsync();<br/>  <br/>  if (!result.cancelled){<br/>    setFileContent(result.uri);<br/>    setFileUri(result.uri.toString());<br/>  }<br/>}</span></pre><p id="606c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="kc io">第7步:</strong>然后使用useFormik状态钩子创建一个formik常量</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="180a" class="lt lu in mx b gy nb nc l nd ne">const formik = useFormik({<br/>  initialValues: { title: '' },<br/>  onSubmit: values =&gt; {<br/>    RNFetchBlob.fetch('POST', `&lt;domain-name&gt;/api/imageadd`, {<br/>      <br/>      'Content-Type' : 'multipart/form-data',<br/>    }, <br/>[<br/>  { <br/>     name : 'image', <br/>     filename : fileUri, <br/>     type:'image/jpeg', <br/>     data:    RNFetchBlob.wrap(fileContent)<br/>  },<br/>  { <br/>     name : 'title', <br/>     data : values.title<br/>  },<br/>      <br/>    ]).then((resp) =&gt; {<br/>      // ...<br/>    }).catch((err) =&gt; {<br/>      Alert.alert('An error occurred!', err.message, [{ text: 'Okay' }]);<br/>    })<br/>  }<br/>});</span></pre><p id="4ea4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">最终的app.js文件应该如下所示:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="889a" class="lt lu in mx b gy nb nc l nd ne">import React, { useState, useEffect } from 'react';<br/><br/>import { StyleSheet, View, Text, Image, Alert} from 'react-native';<br/><br/>import { useFormik } from 'formik';<br/>import * as ImagePicker from 'expo-image-picker';<br/><br/>import RNFetchBlob from 'rn-fetch-blob';</span><span id="f946" class="lt lu in mx b gy nf nc l nd ne">const App = () =&gt; {</span><span id="cc3a" class="lt lu in mx b gy nf nc l nd ne">const [fileContent, setFileContent] = useState(null);<br/>const [fileUri, setFileUri] = useState('');<br/>  </span><span id="7149" class="lt lu in mx b gy nf nc l nd ne">onChooseImagePress = async () =&gt; {<br/>  let result = await ImagePicker.launchImageLibraryAsync();<br/>  <br/>  if (!result.cancelled){<br/>    setFileContent(result.uri);<br/>    setFileUri(result.uri.toString());<br/>  }<br/>}</span><span id="73ed" class="lt lu in mx b gy nf nc l nd ne">const formik = useFormik({<br/>  initialValues: { title: '' },<br/>  onSubmit: values =&gt; {<br/>    RNFetchBlob.fetch('POST', `&lt;domain-name&gt;/api/imageadd`,{<br/>      <br/>      'Content-Type' : 'multipart/form-data',<br/>    }, <br/>[<br/>  { <br/>     name : 'image', <br/>     filename : fileUri, <br/>     type:'image/jpeg', <br/>     data:    RNFetchBlob.wrap(fileContent)<br/>  },<br/>  { <br/>     name : 'title', <br/>     data : values.title<br/>  },<br/>      <br/>    ]).then((resp) =&gt; {<br/>      // ...<br/>    }).catch((err) =&gt; {<br/>      Alert.alert('An error occurred!', err.message, [{ text: 'Okay' }]);<br/>    })<br/>  }<br/>});</span><span id="c382" class="lt lu in mx b gy nf nc l nd ne">return(<br/>        &lt;View&gt;<br/>          &lt;Text&gt;{fileUri}&lt;/Text&gt;<br/>          &lt;TextInput<br/>           onChangeText={formik.handleChange('title')}<br/>           value={formik.values.title}<br/>           label='Title'<br/>           placeholder='e.g My Awesome Selfie'<br/>          /&gt;<br/>            <br/>                <br/>          &lt;Button onPress={() =&gt;    {onChooseImagePress()}} &gt;Choose image...&lt;/Button&gt;  <br/>          &lt;Button title='submit' onPress={formik.handleSubmit} &gt;Enter Picture&lt;/Button&gt;<br/>        &lt;/View&gt;<br/>            <br/>    )<br/>}</span><span id="a7a3" class="lt lu in mx b gy nf nc l nd ne">export default App;</span></pre></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="0256" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们有了。我希望你已经发现这是有用的。我会带着更多有趣的文章回来。感谢您的阅读。</p><p id="6b5f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="mr">更多内容看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kc io"><em class="mr">plain English . io</em></strong></a></p></div></div>    
</body>
</html>