<html>
<head>
<title>Create a To Do App with React, Recoil and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React、反冲和打字稿创建一个待办事项应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/creating-a-todo-app-using-recoil-and-typescript-25ca5e1b7669?source=collection_archive---------0-----------------------#2021-03-09">https://javascript.plainenglish.io/creating-a-todo-app-using-recoil-and-typescript-25ca5e1b7669?source=collection_archive---------0-----------------------#2021-03-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/16582344ff09afc56a83a590ada97b3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ty4dVdmBt-ebhdUA.jpg"/></div></div></figure><h1 id="f92d" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">首先，关于后座力</h1><p id="3d33" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">反冲是一个由脸书开发的状态管理库，最初由脸书自己使用，但现在开放源代码。根据它的官方网站，<a class="ae lr" href="https://recoiljs.org/" rel="noopener ugc nofollow" target="_blank">recoiljs.org</a>，这是它的3个显著特点:</p><ol class=""><li id="629a" class="ls lt in kv b kw lu la lv le lw li lx lm ly lq lz ma mb mc bi translated"><em class="md">最小和反应式</em>:使用灵活的、共享的类似反应式的状态。</li><li id="4972" class="ls lt in kv b kw me la mf le mg li mh lm mi lq lz ma mb mc bi translated"><em class="md">数据流图</em>:“纯函数和高效订阅驯服了派生数据和异步查询。”</li><li id="69b9" class="ls lt in kv b kw me la mf le mg li mh lm mi lq lz ma mb mc bi translated"><em class="md">跨应用观察</em>:“在不影响代码拆分的情况下，通过观察应用的所有状态变化，实现持久性、路由、时间旅行调试或撤销。”</li></ol><p id="f9c2" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">你可以在这里看一下它的文档<a class="ae lr" href="https://recoiljs.org/docs/introduction/getting-started" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="95fc" class="jv jw in bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">给我看看代码！</h1><p id="7bde" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">让我们开始构建应用程序。我们将使用<code class="fe mm mn mo mp b">create-react-app</code>。如果已经安装了节点模块，请在终端中运行以下命令:</p><p id="29d0" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">create-react-app todo-with-recoil --template typescript</code></p><p id="58d3" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">或者，如果您希望它在您自己的项目目录中，运行:</p><p id="d83a" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">create-react-app . --template typescript</code></p><p id="737d" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">如果没有，使用<code class="fe mm mn mo mp b">npx</code>:</p><p id="e108" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">npx create-react-app todo-with-recoil --template typescript</code></p></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><p id="0ed8" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">如果我们没有错误，我们就可以走了。首先，我们必须删除所有不必要的文件和文件夹。应该删除选定的文件(不要忘记也删除它们的导入！):</p><figure class="my mz na nb gt jo gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/e55f7d0861f7ec135261e9439d6b6e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*ra1FWE1FcTcYQHJbLShnig.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">Files to delete (optional)</figcaption></figure><p id="ad91" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">现在，是时候安装后坐力了。</p><p id="f004" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在您的终端中，如果您喜欢使用纱线，运行<code class="fe mm mn mo mp b">npm i --save recoil</code>或<code class="fe mm mn mo mp b">yarn add recoil</code>。</p></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><h1 id="3be9" class="jv jw in bd jx jy ng ka kb kc nh ke kf kg ni ki kj kk nj km kn ko nk kq kr ks bi translated">创建组件</h1><p id="1986" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">首先，从<code class="fe mm mn mo mp b">App.tsx</code>组件中删除<code class="fe mm mn mo mp b">return</code>语句，并将其替换为<code class="fe mm mn mo mp b">return null</code>。我们一会儿将使用这个组件。</p><p id="0b99" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在Typescript中有一种常见的做法，即您必须先定义自己的类型，然后才能开始处理真正的应用程序。为此，在您的<code class="fe mm mn mo mp b">src</code>目录中创建一个<code class="fe mm mn mo mp b">types.d.ts</code>文件。从填这个开始:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="14e9" class="np jw in mp b gy nq nr l ns nt">// types.d.ts</span><span id="dee1" class="np jw in mp b gy nu nr l ns nt">export interface TodoContent {<br/>    id: string;<br/>    title: string;<br/>    description: string;<br/>}</span></pre><p id="6989" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">现在在<code class="fe mm mn mo mp b">src</code>目录下创建一个名为“components”的新文件夹。这里是创建所有Todo组件的地方。在这个文件夹中创建一个名为<code class="fe mm mn mo mp b">TodoItem.tsx</code>的新文件。我们将像这样初始化它:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="988c" class="np jw in mp b gy nq nr l ns nt">// TodoItem.tsx</span><span id="831d" class="np jw in mp b gy nu nr l ns nt">import { TodoContent } from "../types";</span><span id="0e10" class="np jw in mp b gy nu nr l ns nt">export function TodoItem(props: TodoContent) {<br/>    return &lt;div&gt;&lt;/div&gt;;<br/>}</span></pre><p id="3e99" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在同一个文件夹中创建另一个名为<code class="fe mm mn mo mp b">TodoList.tsx</code>的文件，并将其初始化如下:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="8fa8" class="np jw in mp b gy nq nr l ns nt">export function TodoList() {<br/>    return &lt;div&gt;&lt;/div&gt;;<br/>}</span></pre><p id="8ddf" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">是我们开始创造反冲状态的时候了。</p></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><h1 id="cb74" class="jv jw in bd jx jy ng ka kb kc nh ke kf kg ni ki kj kk nj km kn ko nk kq kr ks bi translated">最后，一些国家</h1><p id="2a35" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">转到你的<code class="fe mm mn mo mp b">index.tsx</code>文件，将你的<code class="fe mm mn mo mp b">App</code>组件包装在<code class="fe mm mn mo mp b">RecoilRoot</code>组件中。</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="4e6d" class="np jw in mp b gy nq nr l ns nt">import ReactDOM from "react-dom";<br/>import App from "./App";<br/>import { RecoilRoot } from "recoil";</span><span id="ce40" class="np jw in mp b gy nu nr l ns nt">ReactDOM.render(<br/>    &lt;React.StrictMode&gt;<br/>        <strong class="mp io">&lt;RecoilRoot&gt;</strong><br/>            &lt;App /&gt;<br/>        <strong class="mp io">&lt;/RecoilRoot&gt;</strong><br/>    &lt;/React.StrictMode&gt;,<br/>    document.getElementById("root")<br/>);</span></pre><p id="fd6d" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在您的<code class="fe mm mn mo mp b">src</code>目录中，创建一个新的文件夹“state”并添加一个新文件<code class="fe mm mn mo mp b">todoState.ts</code>。</p><p id="b499" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在反冲中，我们使用一个叫做<code class="fe mm mn mo mp b">atom</code>的函数来定义状态。它是这样的:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="bbb6" class="np jw in mp b gy nq nr l ns nt">// todoState.ts</span><span id="861d" class="np jw in mp b gy nu nr l ns nt">import { atom } from "recoil";<br/>import { TodoContent } from "../types";</span><span id="df54" class="np jw in mp b gy nu nr l ns nt">export const todoContentState = atom&lt;TodoContent[]&gt;({<br/>    key: "todoContents",<br/>    default: [],<br/>});</span></pre><p id="24a8" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">key</code>是<code class="fe mm mn mo mp b">todoContentState </code>的唯一标识符，默认只是默认状态。使用TypeScript，您还可以在尖括号之间添加状态类型。</p><p id="0925" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">继续并添加以下内容:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="7c17" class="np jw in mp b gy nq nr l ns nt">// todoState.ts</span><span id="e8c3" class="np jw in mp b gy nu nr l ns nt">...</span><span id="c78a" class="np jw in mp b gy nu nr l ns nt">export const todoCompleteState = atomFamily&lt;boolean, string&gt;({<br/>    key: "todoCompleteState",<br/>    default: false,<br/>});</span></pre><p id="ad1f" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">atomFamily</code>返回一个函数，向该函数传递一个唯一的标识，为您的组件启用一个唯一的状态。</p><p id="b7e0" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">这部分状态是针对每个单独的Todo项目的；它不需要通过传递道具来喂养或更新，所以通过防止不必要的重新渲染来显著提高性能。我们存储静态数据(不太可能在单一状态下发生变化的数据，如<code class="fe mm mn mo mp b">todoContentState</code>)。让我们通过编辑我们的<code class="fe mm mn mo mp b">TodoItem</code>组件来看看这个动作。</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="a265" class="np jw in mp b gy nq nr l ns nt">// TodoItem.tsx</span><span id="8468" class="np jw in mp b gy nu nr l ns nt">import { useRecoilState, useSetRecoilState } from "recoil";<br/>import { todoCompleteState, todoContentState } from "../state/todoState";<br/>import { TodoContent } from "../types";</span><span id="1031" class="np jw in mp b gy nu nr l ns nt">export function TodoItem(props: TodoContent) {<br/>    const { description, title, id } = props;<br/>    const [isComplete, setIsComplete] =<br/>        useRecoilState(todoCompleteState(props.id));<br/>    const setTodos = useSetRecoilState(todoContentState);</span><span id="f736" class="np jw in mp b gy nu nr l ns nt">    const toggleComplete = () =&gt; setIsComplete(prevState =&gt;<br/>        !prevState);</span><span id="5c4f" class="np jw in mp b gy nu nr l ns nt">    const deleteTodo = () =&gt; setTodos(todos =&gt; todos.filter(todo =&gt;<br/>        todo.id !== id));</span><span id="801d" class="np jw in mp b gy nu nr l ns nt">    return (<br/>        &lt;div&gt;<br/>            &lt;h2&gt;{title}&lt;/h2&gt;<br/>            {description &amp;&amp; &lt;p&gt;{description}&lt;/p&gt;}<br/>            &lt;div&gt;<br/>                &lt;button onClick={toggleComplete}&gt;<br/>                   {isComplete ? "Not complete" : "Complete"}<br/>                &lt;/button&gt;<br/>                &lt;button onClick={deleteTodo}&gt;Delete&lt;/button&gt;<br/>            &lt;/div&gt;<br/>       &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="8e77" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">注意使用钩子<code class="fe mm mn mo mp b">useRecoilState</code>获取该ID特有的状态<strong class="kv io"/>。所以，当我们改变反冲状态时，这只会导致<strong class="kv io">这个组件</strong>重新渲染。出现这种情况的另一个原因是，子组件的状态没有存储在父组件的状态中。</p><p id="b8fa" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">在我们继续之前，您的项目目录应该如下所示:</p><figure class="my mz na nb gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/01f5471444cbdb5ba9143be26bfefa00.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*uddjNx45h2IV1WfcTSHRiQ.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">Updated project directory</figcaption></figure><p id="e790" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">我们现在可以将反冲状态添加到我们的<code class="fe mm mn mo mp b">TodoList</code>组件中，这将渲染所有的待办事项。</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="67f6" class="np jw in mp b gy nq nr l ns nt">// TodoList.tsx</span><span id="bf87" class="np jw in mp b gy nu nr l ns nt">import { useRecoilValue } from "recoil";<br/>import { todoContentState } from "../state/todoState";<br/>import { TodoItem } from "./TodoItem";</span><span id="640a" class="np jw in mp b gy nu nr l ns nt">export function TodoList() {<br/>    const todos = useRecoilValue(todoContentState);</span><span id="2148" class="np jw in mp b gy nu nr l ns nt">    return (<br/>        &lt;div&gt;<br/>            {todos.map(todoProps =&gt; (<br/>                &lt;TodoItem {...todoProps}<br/>                 key={todoProps.id}<br/>                /&gt;<br/>            ))}<br/>        &lt;/div&gt;<br/>    );<br/>}</span></pre><p id="d4f6" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">现在，客户端需要一个组件来实际添加待办事项。我们在名为<code class="fe mm mn mo mp b">AddTodo.tsx</code>的文件中创建了一个名为<code class="fe mm mn mo mp b">AddTodo</code>的新组件。在此之前，我们必须安装一个名为<code class="fe mm mn mo mp b">nanoid</code>的JS模块来帮助为每个任务生成唯一的id。</p><p id="36a3" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><code class="fe mm mn mo mp b">npm i nanoid</code>或<code class="fe mm mn mo mp b">yarn add nanoid</code>。</p><p id="bbd4" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">您的组件应该是这样的:</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="4269" class="np jw in mp b gy nq nr l ns nt">import { <br/>    ChangeEventHandler, <br/>    FormEventHandler, <br/>    useState <br/>} from "react";<br/>import { useSetRecoilState } from "recoil";<br/>import { todoContentState } from "../state/todoState";<br/>import { nanoid } from "nanoid";<br/>import { TodoContent } from "../types";</span><span id="b6ac" class="np jw in mp b gy nu nr l ns nt">export function AddTodo() {<br/>    const [content, setContent] = useState&lt;Omit&lt;TodoContent, "id"&gt;&gt;<br/>        ({ description: "", title: "" });</span><span id="000e" class="np jw in mp b gy nu nr l ns nt">    const handleChange: ChangeEventHandler&lt;HTMLInputElement&gt; = e =&gt;<br/>        setContent(prev =&gt; ({ ...prev, [e.target.id]: e.target.value <br/>    }));</span><span id="c884" class="np jw in mp b gy nu nr l ns nt">    const setTodos = useSetRecoilState(todoContentState);</span><span id="0d6c" class="np jw in mp b gy nu nr l ns nt"><br/>    const addTodo: FormEventHandler&lt;HTMLFormElement&gt; = e =&gt; {<br/>        e.preventDefault();<br/>        setTodos(todos =&gt; [...todos, { ...content, id: nanoid() }]);<br/>};</span><span id="cb04" class="np jw in mp b gy nu nr l ns nt">    return (<br/>        &lt;form onSubmit={addTodo}&gt;<br/>            &lt;input onChange={handleChange} value={content.title} <br/>            id="title" required /&gt;<br/>            &lt;input onChange={handleChange}<br/>            value={content.description} id="description" /&gt;<br/>            &lt;button type="submit" disabled={!content.title}&gt;<br/>                Add Todo<br/>            &lt;/button&gt;<br/>        &lt;/form&gt;<br/>    );<br/>}</span></pre></div><div class="ab cl mq mr hr ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="ig ih ii ij ik"><h1 id="b8df" class="jv jw in bd jx jy ng ka kb kc nh ke kf kg ni ki kj kk nj km kn ko nk kq kr ks bi translated">最终汇编</h1><p id="7807" class="pw-post-body-paragraph kt ku in kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq ig bi translated">所有必需的组件现在都已构建完毕。是时候将它们添加到<code class="fe mm mn mo mp b">App</code>组件中了。</p><pre class="my mz na nb gt nl mp nm nn aw no bi"><span id="e602" class="np jw in mp b gy nq nr l ns nt">// App.tsx</span><span id="bde1" class="np jw in mp b gy nu nr l ns nt">import { AddTodo } from "./components/AddTodo";<br/>import { TodoList } from "./components/TodoList";</span><span id="be9a" class="np jw in mp b gy nu nr l ns nt">const App = () =&gt; {<br/>    return (<br/>        &lt;div&gt;<br/>            &lt;AddTodo /&gt;<br/>            &lt;TodoList /&gt;<br/>        &lt;/div&gt;<br/>     );<br/>};</span><span id="4a17" class="np jw in mp b gy nu nr l ns nt">export default App;</span></pre><p id="1afa" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">应用程序已完成。耶！</p><p id="db30" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">很快，我也会在更新中添加GitHub repo链接。</p><p id="f630" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated"><em class="md">GitHub Repo:</em><a class="ae lr" href="https://github.com/theruler007/todo-app-medium-1.git" rel="noopener ugc nofollow" target="_blank"><em class="md">https://github.com/krishna-kapoor/todo-app-medium-1.git</em></a></p><p id="b565" class="pw-post-body-paragraph kt ku in kv b kw lu ky kz la lv lc ld le mj lg lh li mk lk ll lm ml lo lp lq ig bi translated">谢谢你阅读这篇文章。</p></div></div>    
</body>
</html>