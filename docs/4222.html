<html>
<head>
<title>Build a Cryptocurrency Returns Calculator with React + CoinGecko API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React + CoinGecko API构建加密货币回报计算器</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/build-a-cryptocurrency-returns-calculator-with-reactjs-coingecko-api-part-1-a286ceada6ff?source=collection_archive---------2-----------------------#2021-08-22">https://javascript.plainenglish.io/build-a-cryptocurrency-returns-calculator-with-reactjs-coingecko-api-part-1-a286ceada6ff?source=collection_archive---------2-----------------------#2021-08-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="676d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">构建加密货币计算器的分步入门教程—第1部分</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f99ff3de98eede51bf706b5dd174c318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3OfURl4bJaC6GldXNQfMg.jpeg"/></div></div></figure><p id="e181" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">构建自己的加密货币回报计算器对任何开发人员的投资组合来说都是一个很棒的补充，尤其是如果你是一个加密货币爱好者。如果你是一名正在接受培训的开发人员，并且你的Twitter简历中有#Bitcoin，那么这篇文章就是为你而写的。本教程完全适合初级和中级反应学习者！我在CodeSandbox中添加了各个步骤的代码，这样你可以很容易地跟着做。在本教程中，我们将学习如何使用钩子来输入数据，如何从API中提取返回的数据，以及如何显示和使用这些数据。给定日期的硬币价格将从<a class="ae lk" href="https://www.coingecko.com/en/api" rel="noopener ugc nofollow" target="_blank"> CoinGecko API中获取。</a>API给出的硬币数据稍有延迟，因此计算器不会返回最近日期的任何数据。</p><h1 id="348e" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">工作原理</strong></h1><p id="7d13" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">用户将输入他们购买的硬币、购买日期、出售日期以及他们购买的代币数量。计算器将返回他们的总收益或损失。你可以在<a class="ae lk" href="https://cryptoreturnscalc.netlify.app/" rel="noopener ugc nofollow" target="_blank">https://cryptoreturnscalc.netlify.app/</a>查看我的最终项目版本，源代码可以在<a class="ae lk" href="https://gitlab.com/adamshinder/crypto-returns-calculator" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/adamshinder/crypto-returns-calculator</a>找到。就这样，让我们开始吧！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mi"><img src="../Images/6fc8060a0596dda1ae39d3519dbafd93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQhg6f1_7iRmjO9w7FmPwg.png"/></div></div><figcaption class="mj mk gj gh gi ml mm bd b be z dk">Final Application</figcaption></figure><h1 id="2da3" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">步骤1:设置和使用状态</strong></h1><p id="d93d" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">首先，让我们启动并运行一个样板React项目。使用终端中的<code class="fe mn mo mp mq b">npm create-react-app crypto-calc-tutorial</code>或<code class="fe mn mo mp mq b">yarn create-react-app crypto-calc-tutorial</code>。这将创建一个名为<code class="fe mn mo mp mq b">crypto-calc-tutorial</code>的React项目的基本模板文件夹。通过执行<code class="fe mn mo mp mq b">cd crypto-calc-tutorial</code>进入该文件夹，进入该文件夹后，打开您选择的代码编辑器。如果你像我一样使用VSCode，那么你可以做，<code class="fe mn mo mp mq b">code .</code>。</p><p id="e2f5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">进入文件夹后，打开src/App.js，就可以清空文件了。只留下以下内容:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="c799" class="mv lm in mq b gy mw mx l my mz">import React from “react”;<br/>import “./styles.css”;</span><span id="e95b" class="mv lm in mq b gy na mx l my mz">export default function App() {<br/>  return (<br/>    &lt;div className=”App”&gt;<br/>      Welcome to the Tutorial!<br/>    &lt;/div&gt;<br/>  );<br/>}</span></pre><p id="5e70" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，让我们创建一个输入字段。我们将需要一个函数来接受输入，并改变用户输入的变量。为此，我们将使用useState钩子。用<code class="fe mn mo mp mq b">import React, { useState } from “react”;</code>导入使用状态。</p><p id="1aef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，让我们设置useState函数来接收输入。第一个输入字段将是购买变量。您可以声明用<code class="fe mn mo mp mq b">setBuy</code>函数设置的<code class="fe mn mo mp mq b">buy</code>，并将其值设置为一个空字符串，如下所示。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="df3f" class="mv lm in mq b gy mw mx l my mz">const [buy, setBuy] = useState(“”);</span></pre><p id="d135" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我们现在需要在屏幕上输入内容。你可以在渲染函数的<code class="fe mn mo mp mq b">&lt;div&gt;</code>中用<code class="fe mn mo mp mq b">&lt;input&gt; &lt;/input&gt;</code>来做这件事。一个空的输入框将出现在你的屏幕上。现在，让我们添加以下功能:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="4477" class="mv lm in mq b gy mw mx l my mz">&lt;input defaultValue={buy} onChange={(e) =&gt; setBuy(e.target.value)} /&gt;</span></pre><p id="6c5e" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">这将输入的内容设置为购买值，当它改变时，用<code class="fe mn mo mp mq b">e</code>的道具获取一个函数，并将其值传递给setBuy函数。这会将buy变量更改为您在输入空间中键入的任何值。为了证明这一点，用<code class="fe mn mo mp mq b">&lt;h3&gt; {buy} &lt;/h3&gt;</code>将输入添加到DOM中。</p><p id="6495" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">你可以用</strong> <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-usestate-example-0u988?file=/src/App.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">这个CodeSandbox </strong> </a> <strong class="kq io">看到这个例子。</strong></p><h1 id="cfca" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">步骤2:从CoinGecko API中提取数据</strong></h1><p id="cb6d" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">现在，让我们用这个输入元素来接收某个日期的比特币价格。假设这个输入是买入或卖出的日期输入。查看<a class="ae lk" href="https://www.coingecko.com/en/api#explore-api" rel="noopener ugc nofollow" target="_blank"> CoinGecko API页面</a>，看起来<code class="fe mn mo mp mq b">/coins/{id}/history</code>是我们想要的页面，因为它接受一个硬币和一个日期来接收价格。完美！</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nb"><img src="../Images/11b2e9e5fbd821474d393a7c8773b73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T4g5qoiBL62b6r2Z1eqFnQ.png"/></div></div></figure><p id="15b4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我们将它添加到应用程序之前，让我们看看以下URL返回了什么。<code class="fe mn mo mp mq b"><a class="ae lk" href="https://api.coingecko.com/api/v3/coins/bitcoin/history?date=1-1-2018&amp;localization=false" rel="noopener ugc nofollow" target="_blank"><em class="nc">https://api.coingecko.com/api/v3/coins/bitcoin/history?date=1-1-2018&amp;localization=false</em></a></code></p><p id="6788" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">正如你所看到的，对于日期为<em class="nc">1–1–2018</em>的硬币<em class="nc">比特币</em>，API返回我们可能想要的所有数据，如名称、股票代码、图像资产、市场数据(如当前价格)以及其他面向社区的指标(如社交媒体关注者)。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nd"><img src="../Images/2f5b6016d29a1daf97294ebb734c7bff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sD1IMj9wSlbEw7P1"/></div></div></figure><p id="4c0c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">使用正确的URL，让我们设置接收这些信息并显示返回数据的函数。首先，我们需要创建一个函数，将日期输入API的url并返回上面的文本。我们通过以下方式做到这一点:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="0640" class="mv lm in mq b gy mw mx l my mz">const coingeckoUrl = (date) =&gt; {<br/>  return `https://api.coingecko.com/api/v3/coins/bitcoin/history?             date=${date}&amp;localization=false`;<br/>};</span></pre><p id="f52c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如您所见，它将正确的日期传递到输入日期的URL中。因此，如果日期属性为“1–1–2018”，coingeckoUrl函数将返回如上所示的文本。</p><p id="0682" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在我们使用大量信息之前，我们需要将数据解析成JSON格式。这样做将会把那个斑点变成像这样容易寻址的信息。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ne"><img src="../Images/c33bdab1140f1f4f669cbdc0ef64b3cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F3SM58VTCM0aEYwg"/></div></div></figure><p id="cebe" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">解析该信息的函数如下:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="593e" class="mv lm in mq b gy mw mx l my mz">const coingeckoFetch = async (date) =&gt; {<br/>  fetch(coingeckoUrl(date)).then((response) =&gt;<br/>    response.json().then((jsonData) =&gt; {<br/>      setBuy(jsonData);<br/>      console.log(jsonData);<br/>     })<br/>  );<br/>};</span></pre><p id="8585" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">该函数接受日期属性，并获取由<code class="fe mn mo mp mq b">coingeckoUrl</code>返回的任何内容。假设日期是“2018年1月1日”，这个<code class="fe mn mo mp mq b">coingeckoUrl(date) </code>就是那团信息。然后，获取响应(blob)并用<code class="fe mn mo mp mq b">respone.json()</code>将其解析成JSON格式。然后，获取jsonData并将其设置为setBuy函数，我们从useState部分了解到了这个函数，所以现在，<code class="fe mn mo mp mq b">buy</code>返回解析后的数据。这不是存储信息的最有效方式，但我们会很快清理它。</p><p id="e61a" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，让我们回到我们的返回函数，而不是用<code class="fe mn mo mp mq b">onChange={(e) =&gt; setBuy(e.target.value)</code>来改变setBuy函数，我们将把输入设置为输入到coingeckoUrl函数的日期。这显示在下面:</p><p id="1087" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><code class="fe mn mo mp mq b">onChange={(e) =&gt; coingeckoFetch(e.target.value)</code></p><p id="ce51" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">因此，输入现在是输入到coingeckoFetch函数中的日期！为了进一步说明，这个日期输入被传递给coingeckoFetch函数，然后被传递给coingeckoUrl函数。</p><p id="89ef" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">到目前为止的所有代码都可以在CodeSandbox </strong> <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-basic-krjhr?file=/src/App.js:280-490" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">这里</strong> </a>找到。<em class="nc">记住，在整个教程中，你需要的格式是dd-mm-yyyy格式。任何其他格式和API都不会呈现输出。</em>你现在有了一个可以返回给定日期的比特币数据的应用程序。为了证明这一点，检查控制台；)</p><p id="dddb" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">到目前为止，应用程序做得很好！你应该对自己很满意。您刚刚学习了如何输入数据，从API中提取数据，然后解析响应！接下来，我们将展示这些信息。</p><h1 id="cb50" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated">第3部分:显示数据</h1><p id="a592" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">返回的数据如预期的那样出现在控制台中，那么我们如何让它出现在DOM中呢？首先，记住数据存储在buy变量中的什么地方。因此，您可以使用以下代码调用数据:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="467f" class="mv lm in mq b gy mw mx l my mz">&lt;h3&gt; {buy.market_data?.current_price.usd}{“ “}USD&lt;/h3&gt;</span></pre><p id="021d" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">此时，在应用程序上，当您输入一个日期时，您将看到比特币在该日期的美元价格。你可以从<code class="fe mn mo mp mq b">console.log(buy)</code>的日志中看到我们为什么使用上面的代码。从<code class="fe mn mo mp mq b">buy</code>变量开始，然后是<code class="fe mn mo mp mq b">.market_data </code>来访问json的那个部分，然后是<code class="fe mn mo mp mq b">.current_price</code>，然后我们想要那个以美元表示的价格，所以是<code class="fe mn mo mp mq b">.usd</code>。这是返回给定日期价格的路径。该路径如下所示。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nf"><img src="../Images/5b99b7b6e27cf84877261a0be4747ac8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CYPf6ELQiGf9d_9i"/></div></div></figure><p id="b298" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">你可能会奇怪为什么market_data旁边有个<code class="fe mn mo mp mq b">?</code>。这个问号叫做<a class="ae lk" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining" rel="noopener ugc nofollow" target="_blank">可选链接</a>，它允许你<em class="nc">读取一个位于连接对象链深处的属性值，而不必检查链中的每个引用是否有效。</em></p><h1 id="67c2" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">第四部分:接收多条数据</strong></h1><p id="8414" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">在我们能够接收到一个日期输入(即买入)的值之后，我们还需要接收一个卖出日期的数据。为此，我们将创建两个函数。一个接收日期，然后输出并存储买入价格，另一个接收卖出日期和价格。在我们担心为购买和销售创建两个不同的函数之前，让我们首先创建一个函数，类似于我们在onChange元素中所做的，可以只为购买日期调用。</p><p id="ef4f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，让我们创建一个函数，名为<code class="fe mn mo mp mq b">handleBuyChange</code>，我们将调用这个新函数，而不是直接调用coingeckoFetch。创建一个函数，它接受来自现场的输入，并调用<code class="fe mn mo mp mq b">coingeckoFetch</code>和<code class="fe mn mo mp mq b">setBuy</code>。</p><p id="f033" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">下面是这个函数的样子。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="8c9d" class="mv lm in mq b gy mw mx l my mz">const handleBuyChange = (e) =&gt; {<br/>  let val = e.target.value;<br/>  setBuy(val);<br/>  coingeckoFetch(val);<br/>};</span></pre><p id="5461" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">然后在input元素的onChange中，删除<code class="fe mn mo mp mq b">coingeckFetch</code>并用输入的值调用这个函数。不再需要做<code class="fe mn mo mp mq b">e.target.value</code>，因为它已经在<code class="fe mn mo mp mq b">val</code>中被考虑。</p><p id="8d67" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">太好了！现在让我们做同样的事情来销售。还记得我们开始时为购买输入所做的步骤吗？我们首先需要为sell和setSell创建一个新的使用状态。在这一点上，我更改了变量的名称，以便更清楚地表明我们正在输入<code class="fe mn mo mp mq b">sellDate</code>和<code class="fe mn mo mp mq b">setSellDate</code>。我们将开始将来自API的响应存储在一个不同的变量中。一分钟后会有更多。</p><p id="f162" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">首先，我们将复制buy for sell的所有输入和功能。复制并粘贴buy <code class="fe mn mo mp mq b">&lt;input&gt;</code>元素和<code class="fe mn mo mp mq b">handleBuyChange</code>函数，并将它们适当地重命名为“sell”。更改输入中的<code class="fe mn mo mp mq b">defaultValue</code>，渲染值的名称，将<code class="fe mn mo mp mq b">setSellDate</code>添加到<code class="fe mn mo mp mq b">coingeckoFetch</code>函数中，并编写<code class="fe mn mo mp mq b">handleSellChange</code>函数，就像对购买日期输入所做的那样。你可以在CodeSandbox  <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-step4-bdsi2?file=/src/App.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">这里</strong> </a> <strong class="kq io">看到所有这些<strong class="kq io">的改动。</strong></strong></p><p id="c504" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">我相信你看到了上面的CodeSandbox的问题，销售和购买组件是一样的，所以它获取最后输入的日期。以前，我们建立了不同的买卖日期输入，但是现在，我们需要区分买卖数据。为了解决这个问题，我们需要创建两个变量。一个可以存储为买入返回的数据，另一个返回卖出日期的数据(输入)。我用设置为空对象的变量<code class="fe mn mo mp mq b">sellData</code>和<code class="fe mn mo mp mq b">buyData</code>来标记这个、<code class="fe mn mo mp mq b">trade</code>和<code class="fe mn mo mp mq b">setTrade</code>。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="436e" class="mv lm in mq b gy mw mx l my mz"><em class="nc">const</em> [trade, setTrade] = useState({<br/>  sellData: {},<br/>  buyData: {},<br/>});</span></pre><p id="1c5c" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在前面的fetch函数中，我们只是将jsonData传递到了<code class="fe mn mo mp mq b">setBuyDate</code>中，如下所示。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="1553" class="mv lm in mq b gy mw mx l my mz">setBuyDate(jsonData);<br/>setSellDate(jsonData);</span></pre><p id="462b" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在我们已经有了存储数据的变量，我们将想要做以下事情。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="f482" class="mv lm in mq b gy mw mx l my mz">setTrade({ …trade, buyData: jsonData });</span></pre><p id="8793" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，我们如何区分销售和购买，以便fetch知道返回哪些数据？为此，我们将使用一个名为buy的布尔值。如果是买入，它将被传递，这个买入等于真，如果是卖出，买入将被设置为假。当我们将日期输入传递给<code class="fe mn mo mp mq b">coingeckoFetch</code>时，我们还将提供true或false。</p><p id="e42f" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">在<code class="fe mn mo mp mq b">coingeckoFetch</code>函数中，添加一个名为buy的附加属性，并使用if语句根据<code class="fe mn mo mp mq b">buy</code>的值将jsonData设置为<code class="fe mn mo mp mq b">buyData</code>或<code class="fe mn mo mp mq b">sellData</code>。下面是带有buy和sell if语句的函数，它根据传递给变量的布尔值来设置变量。不要将买入传递给<code class="fe mn mo mp mq b">coingeckoUrl</code>，因为它不关心这是买入还是卖出。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="d0cf" class="mv lm in mq b gy mw mx l my mz"><em class="nc">const</em> coingeckoFetch = <em class="nc">async</em> (buy, date) =&gt; {<br/>  fetch(coingeckoUrl(date)).then((response) =&gt;<br/>    response.json().then((jsonData) =&gt; {<br/>      <em class="nc">if</em> (buy) {<br/>      setTrade({ …trade, buyData: jsonData });<br/>      } <em class="nc">else</em> {<br/>      setTrade({ …trade, sellData: jsonData });<br/>      }<br/>    })<br/>  );<br/>};</span></pre><p id="a700" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">既然coingeckoFetch期望一个布尔值被传递给它，我们需要如下所示更改我们的<code class="fe mn mo mp mq b">handleSellChange</code>和<code class="fe mn mo mp mq b">handleBuyChange</code>函数，为sell传递变量false。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="eb11" class="mv lm in mq b gy mw mx l my mz"><em class="nc">const</em> handleSellChange = (e) =&gt; {<br/>  <em class="nc">let</em> val = e.target.value;<br/>  setSellDate(val);<br/>  coingeckoFetch(<em class="nc">false</em>, val);<br/>};</span></pre><p id="8bc5" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">最后，只需将我们放置<code class="fe mn mo mp mq b">sellDate</code>和<code class="fe mn mo mp mq b">buyDate</code>的地方改为<code class="fe mn mo mp mq b">trade.sellData</code>和<code class="fe mn mo mp mq b">trade.buyData</code>，因为这些数据现在有了自己的变量。</p><p id="6d31" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">所有这些变化都可以在</strong> <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-step4-boolean-nh9s0?file=/src/App.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">这个CodeSandbox </strong> </a>上找到，现在，你有了一个可以输入日期、接收数据、存储和显示价格的应用程序。恭喜你！从现在开始一切都很顺利。最困难的部分已经过去了。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ng"><img src="../Images/8ba6cbb7bc6633203e6016bab1b18553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C9ZiBfy7Ww56YWLW"/></div></div></figure><h1 id="403c" class="ll lm in bd ln lo lp lq lr ls lt lu lv jt lw ju lx jw ly jx lz jz ma ka mb mc bi translated"><strong class="ak">第5部分:添加体积并计算回报</strong></h1><p id="8623" class="pw-post-body-paragraph ko kp in kq b kr md jo kt ku me jr kw kx mf kz la lb mg ld le lf mh lh li lj ig bi translated">我们现在在两个不同的日期有两种不同的比特币价格！现在，让我们添加一个体积区域(代币购买量)。这并不太难。简单地说，创建一个<code class="fe mn mo mp mq b">volume</code>和<code class="fe mn mo mp mq b">setVolume</code> useState并将该值设置为0，如下所示:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="6975" class="mv lm in mq b gy mw mx l my mz"><em class="nc">const</em> [volume, setVol] = useState(<em class="nc">0</em>);</span></pre><p id="2f80" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">为了改变音量，我们需要创建一个输入字段来设置音量的值。这将类似于我们对买卖日期输入所做的。因此，在<code class="fe mn mo mp mq b">return()</code>中，添加以下内容:</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="56f1" class="mv lm in mq b gy mw mx l my mz">&lt;input value={volume} onChange={(e) =&gt; setVolume(e.target.value)} /&gt;</span></pre><p id="9b99" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><strong class="kq io">你可以在这里看到所有的</strong> <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-volume-i9eiy?file=/src/App.js" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">更新代码</strong> </a> <strong class="kq io"> </strong>然后，嘭！现在你有了计算交易回报的三个必要变量。我们现在将计算回报，但首先，我们需要一个变量来存储回报，并将其设置为零。声明一个新的变量，我很乐观你会赚钱，所以我将在常量<code class="fe mn mo mp mq b">trade</code>中调用这个变量<code class="fe mn mo mp mq b">gains</code>。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="fb91" class="mv lm in mq b gy mw mx l my mz">const [trade, setTrade] = useState({<br/>  sellData: {},<br/>  buyData: {},<br/>  gains:0<br/>});</span></pre><p id="17da" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有了这些，试着自己制作这个函数。我非常有信心你能做到！记住什么值返回买卖数据。然后为它们的差异设置增益，乘以代币的数量。</p><p id="ced4" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">有了这些，是时候创建一个函数来计算这些收益(或损失)了。我们知道基于输入日期的比特币价格存储在<code class="fe mn mo mp mq b">trade.sellData</code>和<code class="fe mn mo mp mq b">trade.buyData</code>中，因此要获得美元价格，我们将获得<code class="fe mn mo mp mq b">trade.sellData.market_data?.current_price.usd </code>和<code class="fe mn mo mp mq b">trade.buyData.market_data?.current_price.usd</code>之间的差额。<strong class="kq io">该函数应设置sellData的增益减去buyData乘以成交量的值。</strong>这显示在下面的calcGains函数中。增益被设置为这些操作的结果。</p><pre class="kd ke kf kg gt mr mq ms mt aw mu bi"><span id="dc54" class="mv lm in mq b gy mw mx l my mz">const calcGains = () =&gt; {<br/>  setTrade({<br/>     ...trade,<br/>     gains:<br/>       (trade.sellData.market_data?.current_price.usd -<br/>         trade.buyData.market_data?.current_price.usd) *<br/>       volume,<br/>  });<br/>};</span></pre><p id="b108" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">现在，制作一个调用calcGains并打印输出的按钮！然后，你将完成一个比特币回报计算器！使用调用calcGains的onClick添加button元素。瞧啊。你有一个功能齐全的比特币回报计算器！<strong class="kq io">你可以在CodeSandbox </strong> <a class="ae lk" href="https://codesandbox.io/s/coingecko-api-calcgains-bk67x?file=/src/App.js:1881-1963" rel="noopener ugc nofollow" target="_blank"> <strong class="kq io">这里</strong> </a> <strong class="kq io">看看，玩玩。</strong></p><p id="3f46" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">恭喜你构建了一个比特币回报计算器！这是您前端开发旅程中非常棒的第一步。我强烈推荐这个造型，让它看起来很漂亮。如果你有兴趣将这个比特币计算器转换成许多不同的加密货币以供选择，请前往本教程的<a class="ae lk" href="https://adamshinder.medium.com/build-a-cryptocurrency-returns-calculator-with-reactjs-coingecko-api-part-2-e0cd5f9cf83c" rel="noopener">第2部分</a>。我在那边等你！</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><p id="39ca" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">如果您有任何问题、意见或想要联系我，请在Twitter上联系我，电话:<a class="ae lk" href="https://twitter.com/adshinder" rel="noopener ugc nofollow" target="_blank"> @adshinder </a>。另外，非常感谢Lior Ben-David对这篇文章的帮助。在Twitter @Lior_bendavid上关注他吧！</p><p id="1160" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated"><em class="nc">更多内容请看</em><a class="ae lk" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kq io"><em class="nc">plain English . io</em></strong></a></p></div></div>    
</body>
</html>