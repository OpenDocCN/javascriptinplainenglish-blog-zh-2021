<html>
<head>
<title>How to use Relay with Next.js and TypeScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Next.js和TypeScript中使用Relay</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-use-relay-with-nextjs-and-typescript-40d7a00a137b?source=collection_archive---------5-----------------------#2021-06-12">https://javascript.plainenglish.io/how-to-use-relay-with-nextjs-and-typescript-40d7a00a137b?source=collection_archive---------5-----------------------#2021-06-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><h1 id="e142" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">问题是</h1><p id="94d7" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">如果您有这样的一些中继代码:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="0bef" class="lp jl in ll b gy lq lr l ls lt">import { Suspense } from "react";<br/>import { graphql } from "relay-runtime";<br/>import { useLazyLoadQuery } from "react-relay";</span><span id="7ad1" class="lp jl in ll b gy lu lr l ls lt">const RelayTestQuery = graphql`<br/>  query RelayTestQuery {<br/>    viewer {<br/>      id<br/>    }<br/>  }<br/>`;</span><span id="8ebb" class="lp jl in ll b gy lu lr l ls lt">function RelayTestInner() {<br/>  const data = useLazyLoadQuery(RelayTestQuery, {<br/>    variables: {},<br/>  });</span><span id="4d4d" class="lp jl in ll b gy lu lr l ls lt">  return &lt;div&gt;hi&lt;/div&gt;;<br/>}</span><span id="55f1" class="lp jl in ll b gy lu lr l ls lt">export default function RelayTest() {<br/>  return (<br/>    &lt;Suspense fallback={&lt;div&gt;Loading&lt;/div&gt;}&gt;<br/>      &lt;RelayTestInner /&gt;<br/>    &lt;/Suspense&gt;<br/>  );<br/>}</span></pre><p id="be85" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">你把它渲染成这样:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="ce9a" class="lp jl in ll b gy lq lr l ls lt">export default function Home() {<br/>  return (<br/>    &lt;RelayEnvironmentProvider environment={RelayEnvironment}&gt;<br/>      &lt;RelayTest /&gt;<br/>    &lt;/RelayEnvironmentProvider&gt;<br/>  );<br/>}</span></pre><p id="848d" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">那么您将得到以下错误:</p><figure class="lg lh li lj gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi ma"><img src="../Images/29fcd2f3f94b7cf368f3e3d550980788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9k2f6zNE4iRoSTGn4Yu84w.png"/></div></div><figcaption class="mi mj gj gh gi mk ml bd b be z dk">ReactDOMServer does not yet support Suspense.</figcaption></figure></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="aa5c" class="jk jl in bd jm jn mt jp jq jr mu jt ju jv mv jx jy jz mw kb kc kd mx kf kg kh bi translated">解决方案</h1><h2 id="261b" class="lp jl in bd jm my mz dn jq na nb dp ju kt nc nd jy kx ne nf kc lb ng nh kg ni bi translated"><strong class="ak">动态导入</strong></h2><p id="7c40" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">要解决这个问题，您可以使用<code class="fe nj nk nl ll b">RelayTestDynamic</code>来代替:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="c1f3" class="lp jl in ll b gy lq lr l ls lt">import dynamic from "next/dynamic";</span><span id="c379" class="lp jl in ll b gy lu lr l ls lt">const RelayTestDynamic = dynamic(() =&gt; import("./RelayTest"), {<br/>  ssr: false,<br/>});</span><span id="425e" class="lp jl in ll b gy lu lr l ls lt">export default RelayTestDynamic;</span></pre><p id="4015" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">虽然这样做有点烦人，如果使用Relay的组件在初始加载时是可见的(它们可能是可见的)，这对性能是不利的(现在浏览器需要对JS发出另一个请求，而这个请求可能已经在初始响应中发送了)。</p><h2 id="093a" class="lp jl in bd jm my mz dn jq na nb dp ju kt nc nd jy kx ne nf kc lb ng nh kg ni bi translated"><strong class="ak"> Alpha版本</strong></h2><p id="9b5c" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">或者，你可以使用<code class="fe nj nk nl ll b">react</code>和<code class="fe nj nk nl ll b">react-dom</code>的alpha版本。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="9f9d" class="lp jl in ll b gy lq lr l ls lt">yarn add react@alpha react-dom@alpha</span></pre><p id="7780" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">对于alpha版本，不再需要动态导入。它会导致一些警告，但似乎工作正常。</p><figure class="lg lh li lj gt mb gh gi paragraph-image"><div role="button" tabindex="0" class="mc md di me bf mf"><div class="gh gi nm"><img src="../Images/83c108f2c46bbf2492d52c4e020584a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sy7KYiFzmHOV9EKyWGmig.png"/></div></div></figure></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><h1 id="8ae2" class="jk jl in bd jm jn mt jp jq jr mu jt ju jv mv jx jy jz mw kb kc kd mx kf kg kh bi translated">关于TSConfig</h1><p id="a079" class="pw-post-body-paragraph ki kj in kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><a class="ae nn" href="https://github.com/relay-tools/relay-compiler-language-typescript#typescript" rel="noopener ugc nofollow" target="_blank">https://github . com/relay-tools/relay-compiler-language-typescript # typescript</a>提到了以下内容:</p><p id="ccf7" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">还要确保将TypeScript编译器配置为传输到<code class="fe nj nk nl ll b">es2015</code>模块，并使用以下<code class="fe nj nk nl ll b">tsconfig.json</code>设置将传输到<code class="fe nj nk nl ll b">commonjs</code>模块的任务留给Babel:</p><p id="6f2e" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">我发现那是不必要的。不确定为什么，可能用中继钩的时候不适用？</p><p id="9206" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated">查看这些回购的例子。</p><ul class=""><li id="5edb" class="no np in kk b kl lv kp lw kt nq kx nr lb ns lf nt nu nv nw bi translated"><a class="ae nn" href="https://github.com/arcticmatt/relay-nextjs-typescript" rel="noopener ugc nofollow" target="_blank">https://github.com/arcticmatt/relay-nextjs-typescript</a></li><li id="275e" class="no np in kk b kl nx kp ny kt nz kx oa lb ob lf nt nu nv nw bi translated"><a class="ae nn" href="https://github.com/arcticmatt/relay-nextjs" rel="noopener ugc nofollow" target="_blank">https://github.com/arcticmatt/relay-nextjs</a></li></ul><p id="cbb4" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated"><strong class="kk io"><em class="oc">https://github.com/reactwg/react-18/discussions/9:</em></strong><em class="oc">要么使用动态导入要么使用React 18 alpha</em><a class="ae nn" href="https://github.com/reactwg/react-18/discussions/9" rel="noopener ugc nofollow" target="_blank"><em class="oc"/></a></p></div><div class="ab cl mm mn hr mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ig ih ii ij ik"><p id="8434" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated"><em class="oc">更多内容请看</em><a class="ae nn" href="https://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kk io"><em class="oc">plain English . io</em></strong></a><em class="oc">。</em></p><p id="399e" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated"><em class="oc">报名参加我们的</em> <a class="ae nn" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="oc">免费周报</em> </strong> </a> <em class="oc">。关注我们关于</em><a class="ae nn" href="https://twitter.com/inPlainEngHQ" rel="noopener ugc nofollow" target="_blank"><strong class="kk io"><em class="oc">Twitter</em></strong></a>，<a class="ae nn" href="https://www.linkedin.com/company/inplainenglish/" rel="noopener ugc nofollow" target="_blank"><strong class="kk io"><em class="oc">LinkedIn</em></strong></a><em class="oc">，</em><a class="ae nn" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw" rel="noopener ugc nofollow" target="_blank"><strong class="kk io"><em class="oc">YouTube</em></strong></a><em class="oc">，以及</em> <a class="ae nn" href="https://discord.gg/GtDtUAvyhW" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="oc">不和</em> </strong> </a> <strong class="kk io"> <em class="oc">。</em>T41】</strong></p><p id="a434" class="pw-post-body-paragraph ki kj in kk b kl lv kn ko kp lw kr ks kt lx kv kw kx ly kz la lb lz ld le lf ig bi translated"><strong class="kk io"> <em class="oc">有兴趣缩放你的软件启动</em> </strong> <em class="oc">？检查</em> <a class="ae nn" href="https://circuit.ooo?utm=publication-post-cta" rel="noopener ugc nofollow" target="_blank"> <strong class="kk io"> <em class="oc">电路</em> </strong> </a> <em class="oc">。</em></p><h1 id="5d49" class="jk jl in bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">进一步阅读</h1><div class="od oe gp gr of og"><a rel="noopener  ugc nofollow" target="_blank" href="/typescript-made-easy-a-guide-to-your-first-type-safe-app-with-next-js-wundergraph-and-prisma-e197a59e2b30"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">轻松编写类型脚本:使用Next.js、WunderGraph和Prisma编写第一个类型安全应用程序的指南</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">是时候抛开恐惧，学习TypeScript了。让我们给你第一次“发现！”瞬间通过建立一个完整的…</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">javascript.plainenglish.io</p></div></div><div class="op l"><div class="oq l or os ot op ou mg og"/></div></div></a></div></div></div>    
</body>
</html>