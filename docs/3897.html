<html>
<head>
<title>Build a Video Recording &amp; Playback App in React Native Expo (Android &amp; IOS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在React Native Expo中构建视频录制和播放应用程序(Android和IOS)</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/video-recording-and-playback-app-in-react-native-expo-android-ios-f6390bab65e8?source=collection_archive---------0-----------------------#2021-08-05">https://javascript.plainenglish.io/video-recording-and-playback-app-in-react-native-expo-android-ios-f6390bab65e8?source=collection_archive---------0-----------------------#2021-08-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d372" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何使用JavaScript代码构建一个适用于Android和IOS设备的视频录制应用程序？</h2></div><p id="938b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">各位原生开发者好！</p><p id="5b93" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当您开始学习React Native时，您会经历不同的讲座、教程和文章，以构建不同的项目和学习内容。录音应用就是这样一个应用。对于一个录制应用程序，你必须知道相机应用程序如何工作，如何管理视频质量，比特率，持续时间等等。如何停止视频录制或视频播放？还有更多的东西需要了解。所以，让我们先来一杯咖啡。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/87a6bde207beac2641a2acca5207a9c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H7nYGZK3JvZ8D6zI"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Photo by <a class="ae lo" href="https://unsplash.com/@onice?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Joey Huang</a> on <a class="ae lo" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f04d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你喜欢视频教程，那么它就在这里:</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="lp lq l"/></div></figure><h1 id="f67e" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">设置和安装</h1><p id="9726" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">使用命令:<code class="fe mo mp mq mr b">expo init videoRec</code>在您的首选目录中启动一个<strong class="ke io"> expo-CLI </strong>项目(您可以根据自己的选择将其命名为<strong class="ke io"> <em class="ms"> </em> </strong>)。选择空白模板并完成JavaScript依赖项的安装。之后，使用命令在父目录中安装以下软件包:</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="62bd" class="mx ls in mr b gy my mz l na nb">npm install expo-camera</span><span id="1c97" class="mx ls in mr b gy nc mz l na nb">npm install expo-av</span></pre><p id="2089" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe mo mp mq mr b">expo-camera</code>用于操作React原生应用程序中的摄像头功能，<code class="fe mo mp mq mr b">expo-av</code>用于显示应用程序中的视频。借助expo-av软件包，您可以在应用程序中播放、停止和转发视频。</p><p id="74ba" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们已经完成了安装部分。让我们现在开始黑吧。</p><h1 id="e742" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">视频录制应用程序代码(React Native)</h1><h2 id="8a2c" class="mx ls in bd lt nd ne dn lx nf ng dp mb kl nh ni md kp nj nk mf kt nl nm mh nn bi translated">App.js</h2><p id="8d72" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">从各自的包中导入以下组件，因为我们将在我们的项目中使用它们。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="a51e" class="mx ls in mr b gy my mz l na nb">import React, { useState, useEffect } from 'react';<br/>import { StyleSheet ,Text, View, Button,} from 'react-native';<br/>import { Camera } from 'expo-camera';<br/>import { Video } from 'expo-av';</span></pre><p id="79fc" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们要设置摄像机进行录像。然后我们将切换到显示该视频。现在，对于视频录制，您需要从用户那里访问两件东西。一个是摄像头，另一个是用于音频目的的麦克风接口。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="cef4" class="mx ls in mr b gy my mz l na nb">const [hasAudioPermission, setHasAudioPermission] = useState(null);<br/>const [hasCameraPermission, setHasCameraPermission] =useState(null);<br/>const [camera, setCamera] = useState(null);<br/>const [record, setRecord] = useState(null);<br/>const [type, setType] = useState(Camera.Constants.Type.back);</span></pre><p id="7417" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将对音频、视频、相机许可、类型和记录使用react-hook。因为我们请求用户允许访问，然后将我们的状态从null更改为其他字段。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="a060" class="mx ls in mr b gy my mz l na nb">useEffect(() =&gt; {<br/>    (async () =&gt; {<br/>      const cameraStatus = await Camera.requestPermissionsAsync();<br/>      setHasCameraPermission(cameraStatus.status === 'granted');</span><span id="6d1d" class="mx ls in mr b gy nc mz l na nb">const audioStatus = await Camera.requestMicrophonePermissionsAsync();<br/>      setHasAudioPermission(audioStatus.status === 'granted');</span><span id="7c17" class="mx ls in mr b gy nc mz l na nb">})();<br/>  }, []);</span></pre><p id="98d5" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上述代码用于访问用户设备的摄像头和麦克风的权限。一旦用户给予许可，那么摄像机和麦克风的无效状态将被更新的状态所取代。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="064f" class="mx ls in mr b gy my mz l na nb">const takeVideo = async () =&gt; {<br/>    if(camera){<br/>        const data = await camera.recordAsync()<br/>        setRecord(data.uri);<br/>        console.log(data.uri);<br/>    }<br/>  }</span></pre><p id="7313" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这个箭头功能将负责您的视频记录，我们将视频的URI设置为数据。只需控制台日志这个URI如上所述，你会看到视频网址链接在您的内部存储。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="61d3" class="mx ls in mr b gy my mz l na nb">const stopVideo = async () =&gt; {<br/>    camera.stopRecording();<br/>  }</span></pre><p id="e848" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要停止录像，我们需要上面的箭头功能。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="5832" class="mx ls in mr b gy my mz l na nb">if (hasCameraPermission === null || hasAudioPermission === null ) {<br/>    return &lt;View /&gt;;<br/>  }<br/>if (hasCameraPermission === false || hasAudioPermission === false) {<br/>    return &lt;Text&gt;No access to camera&lt;/Text&gt;;<br/>  }</span></pre><p id="87d1" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果用户拒绝访问权限，那么我们将在屏幕上显示“禁止访问摄像机”。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="9b64" class="mx ls in mr b gy my mz l na nb">&lt;View style={styles.cameraContainer}&gt;<br/>     &lt;Camera <br/>      ref={ref =&gt; setCamera(ref)}<br/>      style={styles.fixedRatio} <br/>      type={type}<br/>      ratio={'4:3'} /&gt;<br/> &lt;/View&gt;</span></pre><p id="863b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">上面的代码是用来显示摄像头的。我们想要一个4:3比例的摄像机屏幕。您可以相应地自定义它们。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="e408" class="mx ls in mr b gy my mz l na nb">&lt;Button<br/>   title="Flip Video"<br/>   onPress={() =&gt; {<br/>   setType(<br/>     type === Camera.Constants.Type.back<br/>     ? Camera.Constants.Type.front<br/>     : Camera.Constants.Type.back<br/>     );<br/>     }}&gt;<br/>&lt;/Button&gt;<br/>&lt;Button title="Take video" onPress={() =&gt; takeVideo()} /&gt;<br/>&lt;Button title="Stop Video" onPress={() =&gt; stopVideo()} /&gt;</span></pre><p id="fe2e" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这些是我们将要使用的基本按钮。第一个是翻转摄像头，这意味着您可以从前置或后置摄像头录制视频。另外两个是记录视频和停止视频。</p><p id="19a9" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我们可以拍摄视频了。我们要怎么玩呢？</p><h1 id="de43" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">使用React Native播放视频</h1><p id="9ae3" class="pw-post-body-paragraph kc kd in ke b kf mj jo kh ki mk jr kk kl ml kn ko kp mm kr ks kt mn kv kw kx ig bi translated">为了播放视频，我们需要两个新的react挂钩。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="1398" class="mx ls in mr b gy my mz l na nb">const video = React.useRef(null);<br/>const [status, setStatus] = React.useState({});</span></pre><p id="28ff" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在添加视频播放屏幕和播放按钮。</p><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="1ce6" class="mx ls in mr b gy my mz l na nb">&lt;Video<br/>   ref={video}<br/>   style={styles.video}<br/>   source={{<br/>     uri: record,<br/>   }}<br/>   useNativeControls<br/>   resizeMode="contain"<br/>   isLooping<br/>   onPlaybackStatusUpdate={status =&gt; setStatus(() =&gt; status)}<br/>/&gt;<br/>&lt;View style={styles.buttons}&gt;<br/>  &lt;Button<br/>    title={status.isPlaying ? 'Pause' : 'Play'}<br/>    onPress={() =&gt;<br/>       status.isPlaying ? video.current.pauseAsync() : video.current.playAsync()<br/>    }<br/>   /&gt;<br/>&lt;/View&gt;</span></pre><p id="6364" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要播放视频，您需要该视频的URI。我们已经制作了录制视频的URI，并将其保存在录制状态。我们只需要在这里使用它。</p><p id="3662" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，您也可以自定义您的视频。怎么做呢？</p><h1 id="0b1f" class="lr ls in bd lt lu lv lw lx ly lz ma mb jt mc ju md jw me jx mf jz mg ka mh mi bi translated">使用React Native Expo定制视频质量、时长、比特率</h1><pre class="kz la lb lc gt mt mr mu mv aw mw bi"><span id="14b5" class="mx ls in mr b gy my mz l na nb">const takeVideo = async () =&gt; {<br/>    if(camera){<br/>        const data = await camera.recordAsync({<br/>          VideoQuality:['2160p'],<br/>          maxDuration:10,<br/>          maxFileSize:200,<br/>          mute:false,<br/>          videoBitrate:5000000<br/>        })<br/>        setRecord(data.uri);<br/>        console.log(data.uri);<br/>    }<br/>  }</span></pre><p id="0a0d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">记住这一点:我们正在使用摄像机录制视频。现在根据您的选择添加变量。这里我们将视频质量设置为2160p，最大持续时间以秒计算。文件大小以字节计算。静音字段为布尔型。我们已经将视频比特率设置为5mbps。根据您的选择和要求进行设置。</p><p id="3ea7" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因为我们主要关注这些东西的功能而不是样式。您可以相应地设计它们的样式。现在，在终端窗口中运行这个应用程序，并在您的设备上运行expo应用程序。您将在设备屏幕上看到类似这样的输出。</p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi no"><img src="../Images/e39770b5d6caccec41c19c428007d587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*weBHTLqPbBcOT3THMqwAYg.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Video Record using React Native Expo</figcaption></figure><p id="f8b6" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">本文到此为止。如果你在某个地方迷路了或者需要完整的代码访问，那么<strong class="ke io"> Github代码</strong>就是这里的<a class="ae lo" href="https://github.com/imrohit007/Video-Recording-React-Native-Expo" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="73f2" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">感谢阅读！而且如果这篇文章对你有帮助，那就尽情鼓掌吧。</p><p id="af0b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="ms">更多内容尽在</em><a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="ke io"><em class="ms">plain English . io</em></strong></a></p></div></div>    
</body>
</html>