<html>
<head>
<title>Connect MongoDB to Node using Express and Mongoose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express和Mongoose将MongoDB连接到节点</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/connect-mongodb-to-node-using-express-and-mongoose-c405d1158c?source=collection_archive---------1-----------------------#2021-09-02">https://javascript.plainenglish.io/connect-mongodb-to-node-using-express-and-mongoose-c405d1158c?source=collection_archive---------1-----------------------#2021-09-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fa9210ef404e9669df37bc50e91dfa5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Hzy7I8_xafBjbde3.jpg"/></div></div></figure><blockquote class="jv jw jx"><p id="61ca" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">m<strong class="kb io">on godb</strong><br/><a class="ae kx" href="https://www.mongodb.com/" rel="noopener ugc nofollow" target="_blank">MongoDB</a>是一个源代码可用的跨平台面向文档的数据库程序。归类为NoSQL数据库程序。</p><p id="ff21" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">Node<br/></strong><a class="ae kx" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">Node . js</a>是一个开源、跨平台、后端的JavaScript运行时环境，运行在V8引擎上，在web浏览器之外执行JavaScript代码。</p><p id="c0a5" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">Express<br/></strong><a class="ae kx" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">Express . js</a>或简称Express，是Node.js的后端web应用框架，在MIT许可下作为免费开源软件发布。它是为构建web应用程序和API而设计的。</p><p id="d521" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">m<strong class="kb io">on goose</strong><br/><a class="ae kx" href="https://mongoosejs.com" rel="noopener ugc nofollow" target="_blank">mongose . js</a>将您的MongoDB集群或集合与您的Node.js应用程序连接起来。它使您能够为您的文档创建模式。Mongoose在创建和使用模式时提供了很多功能。</p></blockquote><h2 id="8737" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">你的外卖是什么</h2><p id="4e6c" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">在本文中，您将了解如何将MongoDB实例与Node.js应用程序连接起来。让我们开始吧…💃</p><h2 id="df28" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">先决条件</h2><ul class=""><li id="8256" class="lz ma in kb b kc lu kg lv lh mb ll mc lp md kw me mf mg mh bi translated">Node.js安装在您的计算机上。</li><li id="9fdd" class="lz ma in kb b kc mi kg mj lh mk ll ml lp mm kw me mf mg mh bi translated">在您的机器上运行的MongoDB实例。</li><li id="beb2" class="lz ma in kb b kc mi kg mj lh mk ll ml lp mm kw me mf mg mh bi translated">Node.js和Express.js的一些知识。</li><li id="32f7" class="lz ma in kb b kc mi kg mj lh mk ll ml lp mm kw me mf mg mh bi translated">测试API端点的邮差。</li></ul><h2 id="f5ea" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">1.安装Express和Mongoose</h2><p id="0298" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">创建一个新目录<code class="fe mn mo mp mq b">men_tutorial</code>并移动到其中</p><p id="aebb" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">键入<code class="fe mn mo mp mq b">npm init -y</code>创建一个避免npm提示的项目</p><p id="104b" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">使用<br/> <code class="fe mn mo mp mq b">npm install express mongoose --save</code>命令安装Express和Mongoose</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mr"><img src="../Images/d4adee79fc2122eb1211d78e49fac9b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQxKTG-qD7MvqAhhYJemaQ.png"/></div></div></figure><h2 id="7653" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated"><strong class="ak"> 2。创建连接</strong></h2><p id="d906" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">创建一个新文件<code class="fe mn mo mp mq b">server.js</code>来启动我们的Express.js服务器。</p><p id="2635" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">通过向<code class="fe mn mo mp mq b">server.js</code>添加以下代码来加载<code class="fe mn mo mp mq b">mongoose</code>和<code class="fe mn mo mp mq b">express</code>。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="474e" class="ky kz in mq b gy na nb l nc nd">const express = require("express");<br/>const mongoose = require("mongoose");<br/>const Router = require("./routes")<br/><br/>const app = express();<br/><br/>app.use(express.json());</span></pre><p id="d798" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">然后使用<code class="fe mn mo mp mq b">mongoose.connect()</code>函数连接到本地MongoDB实例。我们通过<code class="fe mn mo mp mq b">useNewUrlParser: true</code>等。为了避开<code class="fe mn mo mp mq b"><a class="ae kx" href="https://mongoosejs.com/docs/deprecations.html" rel="noopener ugc nofollow" target="_blank">DeprecationWarning</a></code>。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="4d35" class="ky kz in mq b gy na nb l nc nd">mongoose.connect('mongodb://localhost:27017/usersdb',<br/>  {<br/>    useNewUrlParser: true<br/>  }<br/>);</span></pre><p id="1317" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">为了确保连接成功，在您的<code class="fe mn mo mp mq b">mongoose.connect()</code>下面添加以下代码。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="784b" class="ky kz in mq b gy na nb l nc nd">const db = mongoose.connection;<br/>db.on("error", console.error.bind(console, "connection error: "));<br/>db.once("open", function () {<br/>  console.log("Connected successfully");<br/>});</span></pre><p id="e145" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">然后，设置app监听端口3000。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="4735" class="ky kz in mq b gy na nb l nc nd">app.use(Router);<br/><br/>app.listen(3000, () =&gt; {<br/>  console.log("Server is running at port 3000");<br/>});</span></pre><p id="64ff" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated"><em class="ka">结束</em> <code class="fe mn mo mp mq b">server.js</code> <em class="ka">文件。</em></p><h2 id="ee6a" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">3.创建模式</h2><p id="116c" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">创建另一个文件<code class="fe mn mo mp mq b">models.js</code>并添加以下代码。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="2a79" class="ky kz in mq b gy na nb l nc nd">const mongoose = require("mongoose");</span><span id="8fe0" class="ky kz in mq b gy ne nb l nc nd">const UserSchema = new mongoose.Schema({</span><span id="ba8b" class="ky kz in mq b gy ne nb l nc nd">name: {</span><span id="9f7b" class="ky kz in mq b gy ne nb l nc nd">type: String,</span><span id="ca00" class="ky kz in mq b gy ne nb l nc nd">required: true,</span><span id="3626" class="ky kz in mq b gy ne nb l nc nd">},</span><span id="1f59" class="ky kz in mq b gy ne nb l nc nd">lucky_number: {</span><span id="5903" class="ky kz in mq b gy ne nb l nc nd">type: Number,</span><span id="ab01" class="ky kz in mq b gy ne nb l nc nd">default: 0,</span><span id="65ef" class="ky kz in mq b gy ne nb l nc nd">},</span><span id="87be" class="ky kz in mq b gy ne nb l nc nd">});</span><span id="ebb6" class="ky kz in mq b gy ne nb l nc nd">const User = mongoose.model("User", UserSchema);</span><span id="ca8b" class="ky kz in mq b gy ne nb l nc nd">module.exports = User;</span></pre><p id="1464" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">我们使用<code class="fe mn mo mp mq b">mongoose.Schema()</code>方法创建一个模式<code class="fe mn mo mp mq b">UserSchema</code>。该模式收集来自请求的<code class="fe mn mo mp mq b">name</code>和<code class="fe mn mo mp mq b">lucky_number</code>字段。</p><p id="dfc5" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">然后，我们使用最后两行导出模式。</p><p id="9ec1" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated"><em class="ka">结束</em> <code class="fe mn mo mp mq b">model.js</code> <em class="ka">文件。</em></p><h2 id="f1fe" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">4.正在创建发布端点</h2><p id="928a" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">创建一个新文件<code class="fe mn mo mp mq b">routes.js</code>。这个文件定义了我们应用程序的端点。</p><p id="336e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">通过添加以下代码，加载<code class="fe mn mo mp mq b">express</code>和我们在步骤3中创建的模式。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="9b16" class="ky kz in mq b gy na nb l nc nd">const express = require("express");<br/>const userModel = require("./models");<br/>const app = express();</span></pre><p id="1136" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">然后通过添加以下代码来创建POST端点。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="4e91" class="ky kz in mq b gy na nb l nc nd">app.post("/add_user", async (request, response) =&gt; {<br/>    const user = new userModel(request.body);<br/>  <br/>    try {<br/>      await user.save();<br/>      response.send(user);<br/>    } catch (error) {<br/>      response.status(500).send(error);<br/>    }<br/>});</span></pre><p id="554d" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">我们创建一个路由<code class="fe mn mo mp mq b">/add_user</code>来向数据库添加一个新用户。我们使用行<code class="fe mn mo mp mq b">const user = new userModel(request.body);</code>解析要保存到数据库的内容。</p><p id="e17b" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">然后我们使用<code class="fe mn mo mp mq b">try/catch</code>块通过<code class="fe mn mo mp mq b">.save()</code>方法将对象保存到数据库中。</p><h2 id="d5af" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">5.正在创建获取端点</h2><p id="c3b1" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">将以下代码行添加到<code class="fe mn mo mp mq b">routes.js</code>文件中。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="e041" class="ky kz in mq b gy na nb l nc nd">app.get("/users", async (request, response) =&gt; {<br/>  const users = await userModel.find({});<br/><br/>  try {<br/>    response.send(users);<br/>  } catch (error) {<br/>    response.status(500).send(error);<br/>  }<br/>});</span></pre><p id="0bac" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">我们创建一个路由<code class="fe mn mo mp mq b">/users</code>来检索使用<code class="fe mn mo mp mq b">/add_user</code>路由保存的所有用户。我们使用<code class="fe mn mo mp mq b">.find()</code>方法从数据库中收集这些用户。然后，我们使用一个<code class="fe mn mo mp mq b">try/catch</code>块将用户“发送”到这个端点。</p><p id="89e1" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">最后，通过添加下面的行来导出这些端点。</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="8466" class="ky kz in mq b gy na nb l nc nd">module.exports = app;</span></pre><h2 id="f0de" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">6。你的申请已经准备好了…💃</h2><p id="722e" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">通过运行以下命令为应用程序提供服务:</p><pre class="ms mt mu mv gt mw mq mx my aw mz bi"><span id="e08e" class="ky kz in mq b gy na nb l nc nd">node server.js<!-- --> </span></pre><p id="7519" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">输出:</p><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/9d8b417207ca8d8a38d2188e9f57cc24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*Kn3Q949fopmD0AYKkgQApA.png"/></div></figure><h2 id="898e" class="ky kz in bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">7.使用Postman测试端点</h2><p id="905c" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated"><a class="ae kx" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>是一个用于API测试的应用。它是一个HTTP客户端，利用一个图形用户界面来测试HTTP请求，通过这个界面我们可以获得不同类型的响应，这些响应需要随后进行验证。敬请关注邮差<a class="ae kx" href="https://sahil-more.medium.com" rel="noopener">的安装使用这里</a>。</p><p id="abab" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">让我们看看我们的应用程序是如何工作的…</p><blockquote class="jv jw jx"><p id="81f3" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">POST</strong>T34】打开Postman，向<code class="fe mn mo mp mq b">http://localhost:3000/add_user</code>端点发出<code class="fe mn mo mp mq b">POST</code>请求。</p></blockquote><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ng"><img src="../Images/1bcf49d9c409dbaf0a38a3d3ecb8206f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKIgUgtmLKld2fN0xAKd3g.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk"><code class="fe mn mo mp mq b"><strong class="bd nl">POST</strong></code><strong class="bd nl"> Request</strong></figcaption></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nm"><img src="../Images/93dacd4b94e9b69d0edbd84817cb6bee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5B2utYzl36mH7vofG8IdA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk"><strong class="bd nl">POST Success</strong></figcaption></figure><p id="3b8e" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">每当我们执行<code class="fe mn mo mp mq b">POST</code>请求时，新的<code class="fe mn mo mp mq b">users</code>就会被添加到数据库中。我们将能够看到所有使用<code class="fe mn mo mp mq b">GET</code>端点的用户，这也将在下面演示。</p><blockquote class="jv jw jx"><p id="a1c7" class="jy jz ka kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">得到<br/> </strong>打开邮递员，向<br/> <code class="fe mn mo mp mq b">http://localhost:3000/users</code>端点发出<code class="fe mn mo mp mq b">GET</code>请求。</p></blockquote><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nn"><img src="../Images/988dc01e5dbe5857e89256ef127e8210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RIQnLdKAX13Equ9lFPrWsg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk"><strong class="bd nl">GET Request</strong></figcaption></figure><figure class="ms mt mu mv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/f1ad45b4c3ec4284b636caaa09dae1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v8DAkIASPxlYMqUQRmIAkw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk"><strong class="bd nl">GET Success</strong></figcaption></figure><p id="a471" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">我已经添加了两个以上的用户，只是为了演示🙌</p><p id="3686" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated">终于到了。我们已经学习了如何使用Node.js、Express.js和Mongoose模式来设置MongoDB。您还可以连接到MongoDB Atlas或位于远程级别的任何其他数据库。过程是相同的，您只需在建立连接时更新数据库凭证。🔏</p><blockquote class="np"><p id="086c" class="nq nr in bd ns nt nu nv nw nx ny kw dk translated">所有的文件都可以在我的github <a class="ae kx" href="https://github.com/sahilmore-git/MEN-Connection-Example" rel="noopener ugc nofollow" target="_blank">这里</a>找到🚀</p></blockquote></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><h1 id="f45b" class="og kz in bd la oh oi oj ld ok ol om lg on oo op lk oq or os lo ot ou ov ls ow bi translated">谢谢:)</h1><p id="d9fa" class="pw-post-body-paragraph jy jz in kb b kc lu ke kf kg lv ki kj lh lw km kn ll lx kq kr lp ly ku kv kw ig bi translated">希望你们喜欢这篇文章💌<br/>请在评论中留言让我知道<br/>在这里发表你对新文章的建议<a class="ae kx" href="mailto:sahilmore19999@gmail.com" rel="noopener ugc nofollow" target="_blank">📬你也可以在这里给我买杯咖啡☕️</a></p></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><p id="4cde" class="pw-post-body-paragraph jy jz in kb b kc kd ke kf kg kh ki kj lh kl km kn ll kp kq kr lp kt ku kv kw ig bi translated"><em class="ka">更多内容看</em> <a class="ae kx" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"> <strong class="kb io"> <em class="ka">说白了. io </em> </strong> </a></p></div></div>    
</body>
</html>