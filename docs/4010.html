<html>
<head>
<title>Schedule Repetitive Tasks in Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Node.js中计划重复性任务</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/schedule-repetitive-tasks-in-node-js-3bef27515ce5?source=collection_archive---------4-----------------------#2021-08-11">https://javascript.plainenglish.io/schedule-repetitive-tasks-in-node-js-3bef27515ce5?source=collection_archive---------4-----------------------#2021-08-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/76b802d9ba6b6adc632700c6fee6be3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uB3ZS4gr62m9KkE4"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@agebarros?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Agê Barros</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl ka kb hr kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ig ih ii ij ik"><p id="ed28" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><strong class="kj io"> <em class="lf">注:</em> </strong> <em class="lf">这篇博客将通过例子向你概述如何使用NPM的node-cron库调度任务。如果你想了解更多，我会在下面提供一个链接。</em></p></div><div class="ab cl ka kb hr kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ig ih ii ij ik"><p id="edc8" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">作为一名开发人员，在很多情况下，您希望每天运行一些对应用程序很重要但本质上是重复的任务。您当然不能避免这些任务，因为您的应用程序依赖于它们。不管是黎明还是午夜，你都必须运行它们。</p><p id="0b67" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">但是有一种方法可以让你自动化那些重复的任务。通过编写几行代码，您可以将自己从那些无聊的重复任务中解放出来，并完全专注于应用程序的开发。</p><p id="04d9" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">这些任务可以是诸如每日数据库备份、发送电子邮件、下载文件等。在这篇博客中，我们将学习如何用Node.js自动完成这类任务。</p><p id="5882" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">Cron是自动化任务编程中使用的术语。你可以在这里阅读更多关于<strong class="kj io">Cron</strong>T12】的内容。</p><p id="4c28" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">我们将使用名为<strong class="kj io"> node-cron </strong>的NPM模块来实现我们的目标。我将简要介绍这个模块。如果你愿意，你可以在这里了解更多。</p></div><div class="ab cl ka kb hr kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ig ih ii ij ik"><h1 id="e131" class="lg lh in bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak">设置工作目录</strong></h1><p id="e8fa" class="pw-post-body-paragraph kh ki in kj b kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la mi lc ld le ig bi translated">在您的计算机上创建一个空文件夹，并在您首选的文本编辑器中打开该文件夹。为此，我将使用VS代码。你可以在这里从<a class="ae jz" href="https://code.visualstudio.com/Download" rel="noopener ugc nofollow" target="_blank">下载VS代码。</a></p><p id="c8ce" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">在文本编辑器中打开文件夹后，如果在Windows上，按<code class="fe mj mk ml mm b">Ctrl + J</code>键；如果在macOS上，按<code class="fe mj mk ml mm b">Cmd + J</code>键，在Visual Studio中打开内置终端。VS代码中内置的终端将被导航到我们正在工作的当前目录。</p><p id="ecff" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">如果你正在使用一些其他的文本编辑器，打开你机器的终端并导航到我们正在工作的目录。</p><p id="9946" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">打开终端后，让我们在其中运行一些命令:</p><ol class=""><li id="460f" class="mn mo in kj b kk kl ko kp ks mp kw mq la mr le ms mt mu mv bi translated">初始化目录。这个命令将给出我们的<em class="lf"> package.json </em>文件。</li></ol><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="c000" class="ne lh in mm b gy nf ng l nh ni">npm init -y</span></pre><p id="3577" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">2.安装<em class="lf">节点-cron </em>库。该命令将安装<em class="lf"> node-cron </em>文件，并将创建一个<em class="lf"> node_modules </em>文件夹和一个<em class="lf"> package-lock.json </em>文件。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="f211" class="ne lh in mm b gy nf ng l nh ni">npm i node-cron</span></pre><p id="3d10" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">3.使用以下命令创建一个<em class="lf"> server.js文件</em>:</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="ff75" class="ne lh in mm b gy nf ng l nh ni">touch server.js</span></pre><p id="2ada" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">运行以上命令后，您的目录应该看起来像下图所示:</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/fda812bfa983f502b7beeea6ef9a8b92.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*E6tSQmWZisX4lfkzam0bIg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">image by author</figcaption></figure><h1 id="efa2" class="lg lh in bd li lj nk ll lm ln nl lp lq lr nm lt lu lv nn lx ly lz no mb mc md bi translated">写一些代码</h1><p id="f633" class="pw-post-body-paragraph kh ki in kj b kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la mi lc ld le ig bi translated">现在，我们已经初始化了存储库并安装了我们需要的库。我们不会创建任何类型的“GET”或“post”请求，但会为这个POST将所有内容打印到终端。</p><p id="2bab" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在，在文本编辑器中打开<em class="lf"> server.js </em>文件，并需要<em class="lf"> node-cron </em>模块。使用以下代码导入<em class="lf"> node-cron </em>模块:</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="aed3" class="ne lh in mm b gy nf ng l nh ni">const cron = require("node-cron");</span></pre><p id="90d1" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">在请求“cron”库之后，我们将在每一秒钟之后向终端输出“Hello world”。在文本编辑器中编写以下代码:</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="e9af" class="ne lh in mm b gy nf ng l nh ni">cron.schedule('* * * * * *', () =&gt; {<br/>    console.log('Hello World');<br/>});</span></pre><p id="416b" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><code class="fe mj mk ml mm b">cron.schedule(a, b)</code>是我们用来安排任务的方法。它需要两个参数。“a”&amp;“b”只是占位符。“a”是一个字符串，而“b”是一个回调函数。</p><p id="d3a5" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">我们上面写的代码将每秒向终端输出“Hello World”。“*”号代表时间单位。下图将使“*”代表什么单位变得更加清晰。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/e3fe7fe4bef4fb47e29d78bf37f1e670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VJ8PXjTziPE6KwyqjmoSnw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">image by <a class="ae jz" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank">npmjs.com</a></figcaption></figure><p id="942a" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">至少需要5个星号符号，用空格分隔，以使回调函数工作。虽然我们也可以用一个数字来代替星号符号，但是我们还是想安排一个任务。但稍后会详细介绍。</p><p id="ce48" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">如果有5个星号，回调函数将每分钟运行一次。有了6个星号，回调函数就会每秒运行一次，我们刚才写的代码就是这种情况。</p><p id="206d" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">我们可以用数字代替星号，这样我们就可以完全控制何时运行任务。这些是允许代替星号符号的一些值。</p><figure class="mw mx my mz gt jo gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/8cb8e2ddd3a96a55ad9258c8c970667b.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*K7btPRZJf5jVeTPvME58WQ.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">image by <a class="ae jz" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank">npmjs.com</a></figcaption></figure><p id="3820" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">让我给你一个例子来说明我们如何使用数字来代替星号。看看下面的代码。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="861f" class="ne lh in mm b gy nf ng l nh ni">const cron = require('node-cron');<br/>cron.schedule('25 * * * * *', () =&gt; {<br/>     console.log('Hello World');<br/>});</span></pre><p id="d2ed" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">我们用数字25代替了代表秒的第一个星号。现在，“Hello World”只会在每分钟的第25秒印上。那么，现在你已经明白了。您可以用数字替换这些星号，只有当实际时间与字符串匹配时，回调才会运行。您可以使用它在每天的特定时间运行任务，每隔一天或每周运行一次任务，等等。它让您可以完全控制何时安排任务。</p><p id="4116" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">看看另一个例子。假设我想在每天晚上11点备份我的数据库。我可以简单地编写下面的代码，它将在每晚11点运行，并备份我的数据库。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="4fb4" class="ne lh in mm b gy nf ng l nh ni">cron.schedule('0 0 23 * * *', () =&gt; {<br/>     // backup the database<br/>});</span></pre><p id="1da1" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">您还可以为特定的时间单位添加逗号分隔的数字。逗号分隔的值有助于为特定时间单位添加多个值。看看下面给出的例子。回拨功能将在每天的第25分钟和第50分钟的12点和6点运行。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="9a3a" class="ne lh in mm b gy nf ng l nh ni">cron.schedule('0 25,50 12,18 * * *', () =&gt; {<br/>     // This code will run on the 25th and the 50th minute<br/>     // at 12 PM noon and in the evening at 6 PM every day<br/>});</span></pre><p id="f053" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">您还可以添加一系列值来运行回调函数。看看下面的代码，你会对输入数值范围有一个清晰的了解。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="c783" class="ne lh in mm b gy nf ng l nh ni">cron.schedule('1-10 * * * * *', () =&gt; {<br/>     console.log('Hello World');<br/>});</span></pre><p id="8974" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">上面的代码将在每分钟的前10秒内将<code class="fe mj mk ml mm b">Hello World</code>打印到终端。回调将只运行前10秒，因为我们已经明确定义了一个范围<code class="fe mj mk ml mm b">1-10</code>。你也可以将类似的情况应用于其他时间单位。</p><p id="2ea5" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在，我想你已经知道如何在特定的时间安排任务了。但是如果您想在指定的时间间隔后运行一个任务呢？。比如说，你想每隔2分钟运行一次任务，还是每隔3小时运行一次？。这个图书馆也提供了一个解决方案。看看下面给出的代码。</p><pre class="mw mx my mz gt na mm nb nc aw nd bi"><span id="fd3f" class="ne lh in mm b gy nf ng l nh ni">cron.schedule('*/2 * * * * *', () =&gt; {<br/>     console.log('Hello World');<br/>});</span></pre><p id="5193" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">这段代码将把<code class="fe mj mk ml mm b">Hello World</code>输出到终端，不是每秒，而是每隔一秒。<code class="fe mj mk ml mm b">*/2</code>告诉回调函数每隔2秒运行一次。我们可以用<code class="fe mj mk ml mm b">1-59</code>之间的任何其他数字替换<code class="fe mj mk ml mm b">2</code>这个数字。<strong class="kj io">类似的事情也适用于其他时间单位。但是请确保输入特定时间单位的正确数字。使用上表作为参考，了解可以为特定时间单位输入什么值。</strong></p><p id="e0aa" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">现在，我已经介绍了两种场景<strong class="kj io"> I)在指定的时间</strong>运行任务，以及<strong class="kj io"> II)在指定的时间间隔后运行任务。</strong></p><p id="816a" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">在我结束这篇博客之前，我只想指出JavaScript的原生库<code class="fe mj mk ml mm b">setInterval</code>和我们正在使用的库<code class="fe mj mk ml mm b">node-cron</code>之间的区别。众所周知，<code class="fe mj mk ml mm b">setInterval</code>是函数接受两个参数，第一个是我们想要运行的函数，第二个是函数再次运行的时间。第二个参数接受毫秒数。</p><p id="eee9" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">假设您想在每周的星期一运行任务。用<code class="fe mj mk ml mm b">setInterval</code>你必须首先计算从现在到星期一的毫秒数。然后，您将清除当前间隔，然后再次计算从一个星期一到下一个星期一的毫秒数。</p><p id="4952" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated">使用<code class="fe mj mk ml mm b">node-cron</code>,你可以完全控制如何运行这个只有3行代码的函数。如果你想了解更多关于<code class="fe mj mk ml mm b">node-cron</code>的信息，你可以点击查看<a class="ae jz" href="https://www.npmjs.com/package/node-cron" rel="noopener ugc nofollow" target="_blank">模块的包装页面。</a></p><h1 id="4eae" class="lg lh in bd li lj nk ll lm ln nl lp lq lr nm lt lu lv nn lx ly lz no mb mc md bi translated">结论</h1><p id="8ede" class="pw-post-body-paragraph kh ki in kj b kk me km kn ko mf kq kr ks mg ku kv kw mh ky kz la mi lc ld le ig bi translated">由于有可用的包，用Node.js调度任务相当容易。它非常方便，因为它节省了我们的时间，并允许我们作为开发人员专注于手头的实际任务。我已经向您介绍了<code class="fe mj mk ml mm b">node-cron</code>库，阅读了更多关于它的内容，并且使用了这个库。你可能会找到完全符合你需要的东西。</p><p id="7fd4" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><em class="lf">我是Node.js的开发人员，如果你在Node.js中有一些工作要做，请随时在Fiverr上联系我。在这里看我的Fiverr简介:</em><a class="ae jz" href="https://www.fiverr.com/share/1W8WA9" rel="noopener ugc nofollow" target="_blank">【https://www.fiverr.com/share/1W8WA9】</a></p><p id="a703" class="pw-post-body-paragraph kh ki in kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ig bi translated"><em class="lf">更多内容请看</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kj io"><em class="lf">plain English . io</em></strong></a></p></div></div>    
</body>
</html>