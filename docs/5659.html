<html>
<head>
<title>Create a Node.js Video Streaming Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Node.js视频流应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-a-node-js-video-streaming-application-3095cb2aa52c?source=collection_archive---------0-----------------------#2021-11-27">https://javascript.plainenglish.io/create-a-node-js-video-streaming-application-3095cb2aa52c?source=collection_archive---------0-----------------------#2021-11-27</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="6100" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">大家好，在这篇文章中，我将向大家展示一个非常简单的Node.js应用程序来在线播放视频。本文只涉及后端。在下一部分，我将使用Vue.js创建前端。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/505b69553bfd66cf923137cb8b93573c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2LFSiLHKeo2joJm5ejHvFQ.png"/></div></div></figure><p id="efa0" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">所以，不多说，让我们直接进入这个过程。</p><blockquote class="ku kv kw"><p id="a384" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">步骤1:初始化npm配置并安装依赖项</p></blockquote><pre class="kj kk kl km gt lb lc ld le aw lf bi"><span id="5425" class="lg lh in lc b gy li lj l lk ll">npm i express cors <br/>npm i -D nodemon</span></pre><p id="172d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">您的package.json文件应该如下所示</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><blockquote class="ku kv kw"><p id="7ce2" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">第2步:设置一个基本的express服务器开始。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><blockquote class="ku kv kw"><p id="61de" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">第三步:在你的应用程序中添加一个新的index.html文件。您的文件src必须指向您要继续进行流式处理的服务器端点。</p></blockquote><p id="a4be" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">注意:这个HTML文件将被你的前端应用程序替换。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><blockquote class="ku kv kw"><p id="4f39" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">步骤4:现在我们需要设置'/video '路径和合适的控制器。另外，作为我们的索引路径，我们还需要发送这个HTML文件进行渲染。让我们更新app.js文件来完成这些更改。</p></blockquote><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="8aa5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Routes.js</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="2eea" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">视频控制器. js</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="6c2a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">让我们分析一下控制器中发生了什么。</p><p id="767b" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在我们的头中，我们提取出范围(范围是你当前在视频缓冲区中的部分)。如果range不存在，我们抛出一个错误，说明没有找到请求的头范围。否则，我们在我们的文件系统中定位文件。(如果您使用数据库存储，请参考网格文件系统)。</p><p id="d8b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">然后我们决定每个并发请求要发送的块大小(在上面的例子中是1mb——math . pow(10，6)或简单的10**⁶).然后我们需要决定开始和结束变量。start变量决定了我们正在发送的视频的起点。对于结束变量，我们需要确定(开始+块)或视频大小长度之间的最小值。这是因为(start +chunk)可能会大于视频长度，因此我们无法发送任何内容，这将导致错误。</p><p id="6dcd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最后，我们确定实际发送的内容长度。内容长度是开始值和结束值之差。然后，我们使用上面计算的值生成我们的header对象。</p><p id="7257" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在最后一部分中，我们发送部分内容响应(206 ),这也是express框架的一部分，并使用fs (Node.js core)模块通过管道将该响应与读取流连接起来。这就是使用Node JS服务器传输视频所需的全部内容。</p><blockquote class="ku kv kw"><p id="a2e1" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">我们首先检查范围是否不存在，然后抛出错误。/</p><p id="b718" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">videoPath(第8行)是您想要传输的文件的相对路径。</p><p id="4eb6" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">videoSize(第9行)是所选文件的文件大小。</p><p id="1d8e" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">chunkSize(第10行)是您希望为每个集成发送的文件缓冲区。在上面的例子中，它是1兆字节。</p><p id="d921" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">start(第11行)是视频的开始范围。</p><p id="a0ee" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">end(第12行)是视频的结束范围。</p><p id="fbfc" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">contentLength(第13行)需要从流应用程序发送的视频缓冲区。</p><p id="21a5" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">第(14–19)行然后我们设置标题，将我们所有的配置应用到响应对象。</p><p id="f695" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">(第20行)然后我们发送206响应指示我们正在发送部分内容响应。</p><p id="1aa8" class="jk jl kx jm b jn jo jp jq jr js jt ju ky jw jx jy kz ka kb kc la ke kf kg kh ig bi translated">(第21–22行)最后，利用Fs(在core node js中可用)模块，我们创建一个读取流，并通过管道将其发送到我们的响应对象。</p></blockquote><p id="eb02" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在下一部分，我将使用Vue.js设计前端。如果你喜欢这篇文章，你会爱上前端集成。您可以关注我以立即获得更新。</p><p id="090d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="kx">更多内容看</em> <a class="ae lo" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="kx">说白了. io </em> </strong> </a> <strong class="jm io"> <em class="kx">。</em> </strong> <em class="kx">报名参加我们的</em> <a class="ae lo" href="http://newsletter.plainenglish.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="jm io"> <em class="kx">免费每周简讯点击这里</em> </strong> </a> <strong class="jm io"> <em class="kx">。</em> </strong></p></div></div>    
</body>
</html>