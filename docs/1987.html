<html>
<head>
<title>From Zero to WebHero [7] — Going Live</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到web hero[7]——上线</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/lets-build-a-svelte-sapper-app-3404c215777e?source=collection_archive---------15-----------------------#2021-04-25">https://javascript.plainenglish.io/lets-build-a-svelte-sapper-app-3404c215777e?source=collection_archive---------15-----------------------#2021-04-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c49e" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">web应用程序已经设置好了，所以在最后一章中，我们将部署它，这样每个人都可以使用它。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/91d0ef7e63b6ea56356f4dabc969c620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sp-3sWxaxXRV9UTA"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@ravipalwe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ravi Palwe</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="81cc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">继上周的<a class="ae ks" rel="noopener ugc nofollow" target="_blank" href="/lets-build-a-svelte-sapper-app-703ec9e779dd">之后，大结局已经到来！虽然我称之为大结局，但之后还有很多工作要做，例如，编写一个合适的测试套件。但在本章中，我们将最终部署web应用程序并投入使用。</a></p><p id="227a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你想直接跳到代码，你可以在这里找到它<a class="ae ks" href="https://github.com/omirobarcelo/retro-ps5" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="046c" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">数据库ˌ资料库</h1><p id="fa2c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">遵循本<a class="ae ks" href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/mongoose" rel="noopener ugc nofollow" target="_blank">指南</a>中的步骤，这些是我们可以创建云数据库的完整步骤列表，因此我们可以从我们的服务器访问数据。</p><ul class=""><li id="3e92" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">在<a class="ae ks" href="https://www.mongodb.com/cloud/atlas/register" rel="noopener ugc nofollow" target="_blank">https://www.mongodb.com/cloud/atlas/register</a>创建账户</li><li id="9f07" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">遵循给出的说明</li><li id="f056" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">选择空闲层</li><li id="cd32" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">选择一个地区</li><li id="b2f5" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">选择集群选项并命名集群</li><li id="c94a" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">等待几分钟，直到集群创建完毕</li><li id="ae32" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">遵循入门说明</li><li id="213c" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">1.创建您的第一个数据库用户<br/> —添加新的数据库用户<br/> —选择密码验证<br/> —输入用户和密码(尽量避免使用特殊字符，这样Mongoose就不会出现解析问题)<br/> —选择Atlas管理权限<br/> —(可选)选择用户有权访问的集群<br/> —单击添加用户</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/1a0682cfbb37954af6f67c0aaa5977cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lG-pVFEAtiR9mcNtUW7uHg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Create your first database user</figcaption></figure><ul class=""><li id="73ac" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">2.白名单IP地址<br/> —添加IP地址<br/> —为简单起见，让我们允许从任何地方访问<br/> —点击确认</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nb"><img src="../Images/7f031fcf7064710bc46501f8f3bfe4ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qbGPHXSWn2DQI80M_87cA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Whitelist IP addresses</figcaption></figure><ul class=""><li id="85f3" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">3.(可选)加载样本数据</li><li id="8e03" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">4.连接到您的集群<br/> —连接我们的应用程序</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/0528796025a2cc138f7dbb8c9948f20e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZUkpMkIVEcAEfCcBVOgtw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Connect to your cluster</figcaption></figure><ul class=""><li id="5c97" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">转到集合<br/> —点击添加我自己的数据<br/> —添加数据库名称和集合名称</li></ul><p id="3b1e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在我们可以在本地测试它的工作。我们用新的数据库链接修改我们的<code class="fe nd ne nf ng b">.env</code>文件，并用生产数据播种。如果我们检查地图集数据库，我们将在那里看见比赛。</p><h1 id="0a6b" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">赫罗库</h1><p id="f506" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们将把我们的应用程序部署到Heroku，因为它易于使用。我们可以按照这个脚本来做。</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="082d" class="nl lq in ng b gy nm nn l no np">heroku login -i<br/>heroku create -a retro-ps5<br/>heroku config:set NODE_ENV='production'<br/>heroku config:set MONGO_INITDB_SERVER='...'<br/>heroku config:set DB_DROP='false'<br/>heroku config:set DB_SEED='false'<br/>git push heroku main</span></pre><p id="cdac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">自2019年3月11日起，Heroku自动执行可用的构建脚本，因此我们不需要手动运行它。对于Node.js应用程序——Sapper最终是node . js——Heroku执行启动脚本，无需进一步配置。</p><p id="1ed3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这样，我们的应用程序就可以运行了！你可以在https://retro-ps5.herokuapp.com/的<a class="ae ks" href="https://retro-ps5.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">查到。</a></p><h1 id="cffd" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">错误修复</h1><p id="61d6" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">如果我们检查或创建任何一个新的游戏，其正面或负面的票数都是0，那么饼图就没有被正确绘制。一个简单的解决方案是添加1e-6——一个非常小的数字——以避免正百分比完全为0。</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="f32f" class="nl lq in ng b gy nm nn l no np">$: positivePercent = calcPercent(game.positiveVotes, game.positiveVotes + game.negativeVotes) + (game.positiveVotes === 0 ? 1e-6 : 0);</span></pre><p id="07f2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们使用<code class="fe nd ne nf ng b">git push heroku main</code>提交和推送变更并再次部署。在未来，我们可以实现CI/CD管道，这样我们就不需要自动部署我们实现的每个变更。</p><h1 id="6ce9" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">自定义域</h1><p id="f325" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们的应用程序已经是活的，但它会很好有一个自定义域。让我们从买一个开始吧！就我而言，我是在<a class="ae ks" href="https://www.cdmon.com/" rel="noopener ugc nofollow" target="_blank">买的CDMON </a>。</p><p id="6ac6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在Heroku这边，我们用下面的命令添加域。</p><pre class="kd ke kf kg gt nh ng ni nj aw nk bi"><span id="fbd7" class="nl lq in ng b gy nm nn l no np">heroku domains:add <a class="ae ks" href="http://www.caniplayitonps5.site" rel="noopener ugc nofollow" target="_blank">www.caniplayitonps5.site</a><br/>heroku domains:add caniplayitonps5.site<br/>heroku domains # prints the domains, for checking</span></pre><p id="1558" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">第一个命令添加CNAME，第二个命令添加别名。</p><p id="d843" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在Heroku中添加域后，我们转到CDMON，转到我们的域，管理DNS，并添加两者。然后，我们等待更改传播。</p><p id="c98f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">可悲的是，Heroku和CDMON之间的集成不是很好，我需要请求他们的客户服务最终站在他们一边。</p><p id="af75" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，现在我们的网站是在我们自己的领域！去http://www.caniplayitonps5.site/的<a class="ae ks" href="http://www.caniplayitonps5.site/" rel="noopener ugc nofollow" target="_blank">看看吧</a></p><h1 id="98fc" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">谷歌广告</h1><p id="cf84" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">要设置谷歌广告，首先我们需要在他们的广告系统中创建一个帐户。他们将为我们提供一个链接，我们复制并粘贴到<code class="fe nd ne nf ng b">template.html</code>中。遗憾的是，我们的网络应用程序中没有足够的内容来投放谷歌广告。</p></div><div class="ab cl nq nr hr ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ig ih ii ij ik"><p id="9252" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">并且，苦中带甜，这个系列结束了！我们从零到网络英雄；我们从零开始创建了自己的web应用程序，现在它生活在一个定制的领域中。</p><p id="e8d6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我希望你喜欢这个系列。对我来说，这是一份非常有意义的工作！</p><p id="e409" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以在<a class="ae ks" href="https://github.com/omirobarcelo/retro-ps5" rel="noopener ugc nofollow" target="_blank">https://github.com/omirobarcelo/retro-ps5</a>中看到所有的代码。</p><h1 id="e604" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">资源</h1><div class="nx ny gp gr nz oa"><a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/mongoose" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">快速教程第3部分:使用数据库(使用Mongoose)</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">在本文中，我们学习了一些关于Node/Express上的数据库和ORM的知识，以及很多关于Mongoose模式和</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">developer.mozilla.org</p></div></div><div class="oj l"><div class="ok l ol om on oj oo km oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://devcenter.heroku.com/changelog-items/1557" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">Node.js部署将从3月11日开始自动运行“构建”脚本</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">从3月11日开始。2019年，Node.js部署将在构建期间自动执行应用程序的构建脚本，如果一个是…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">devcenter.heroku.com</p></div></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://devcenter.heroku.com/articles/custom-domains" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">应用程序的自定义域名</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">默认情况下，Heroku应用程序在其Heroku域中可用，其格式为[应用程序名称].herokuapp.com。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">devcenter.heroku.com</p></div></div><div class="oj l"><div class="op l ol om on oj oo km oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://imranhsayed.medium.com/adding-your-custom-domain-to-heroku-app-cdd68d2db67f" rel="noopener follow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">将您的自定义域添加到Heroku应用程序</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">为了让你的Heroku应用程序在你的自定义域名(如www.yourdomain.com)上可用(而不是像…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">imranhsayed.medium.com</p></div></div><div class="oj l"><div class="oq l ol om on oj oo km oa"/></div></div></a></div><div class="nx ny gp gr nz oa"><a href="https://www.cdmon.com/" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd io gy z fp of fr fs og fu fw im bi translated">易易工作室-各种在线工具，站长网志，以及多个应用项目。</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">我们在网上有很多网站，虚拟主机，相关专业服务，虚拟助理，专业服务等等。</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">www.cdmon.com</p></div></div><div class="oj l"><div class="or l ol om on oj oo km oa"/></div></div></a></div></div></div>    
</body>
</html>