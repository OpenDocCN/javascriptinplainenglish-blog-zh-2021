<html>
<head>
<title>Deno — HTTP Requests and File Manipulation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Deno — HTTP请求和文件操作</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/deno-http-requests-and-file-manipulation-bc06713647df?source=collection_archive---------12-----------------------#2021-02-16">https://javascript.plainenglish.io/deno-http-requests-and-file-manipulation-bc06713647df?source=collection_archive---------12-----------------------#2021-02-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/ca127db0fe50e2b5765cfd0bd2b2b1a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DG8VYBUfABAMYe0I"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@viktortalashuk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Viktor Talashuk</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e5ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Deno是一个新的服务器端运行时环境，用于运行JavaScript和TypeScript应用程序。</p><p id="2c2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我们将了解如何开始为Deno开发应用程序。</p><h1 id="5d85" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">管理依赖关系</h1><p id="cb0b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以在Deno应用中管理依赖关系。</p><p id="851b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以用<code class="fe me mf mg mh b">export</code>语句重新导出模块:</p><p id="bb0d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">math.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4e3e" class="mq lc iq mh b gy mr ms l mt mu">export {<br/>  add,<br/>  multiply,<br/>} from "https://x.nest.land/ramda@0.27.0/source/index.js";</span></pre><p id="4684" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f9ad" class="mq lc iq mh b gy mr ms l mt mu">import { add, multiply } from "./math.ts";</span><span id="2c3a" class="mq lc iq mh b gy mv ms l mt mu">console.log(add(1, 2))<br/>console.log(multiply(1, 2))</span></pre><p id="ef2f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们在<code class="fe me mf mg mh b">math.ts</code>转口货物，在<code class="fe me mf mg mh b">index.ts</code>进口。</p><h1 id="d95b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">取数据</h1><p id="f60b" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用带Deno的Fetch API获取数据。</p><p id="e067" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Fetch API是用Deno实现的。</p><p id="3001" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="b76a" class="mq lc iq mh b gy mr ms l mt mu">const res = await fetch("https://yesno.wtf/api");<br/>const json = await res.json()<br/>console.log(json);</span></pre><p id="0b93" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4672" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-net index.ts</span></pre><p id="f53e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们会得到这样的结果:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="4b6c" class="mq lc iq mh b gy mr ms l mt mu">{<br/>  answer: "yes",<br/>  forced: false,<br/>  image: "https://yesno.wtf/assets/yes/7-653c8ee5d3a6bbafd759142c9c18d76c.gif"<br/>}</span></pre><p id="679b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">记录在案。</p><p id="2296" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">--allow-net</code>标志在我们的脚本中启用网络通信。</p><p id="cefe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要得到HTML，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="67fd" class="mq lc iq mh b gy mr ms l mt mu">const res = await fetch("https://deno.land/");<br/>const html = await res.text()<br/>console.log(html);</span></pre><p id="3b9d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们从<code class="fe me mf mg mh b">deno.land</code> URL下载HTML代码。</p><p id="b485" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了捕捉错误，我们编写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="d50a" class="mq lc iq mh b gy mr ms l mt mu">try {<br/>  await fetch("https://does.not.exist/");<br/>} catch (error) {<br/>  console.log(error.message)<br/>}</span></pre><p id="2c5f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们记录来自<code class="fe me mf mg mh b">error.message</code>属性的消息。</p><h1 id="35b5" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">读写文件</h1><p id="d586" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">Deno附带了一个用于读写文件的API。</p><p id="ff2a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它们有同步和异步两种版本。</p><p id="f626" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获得文件系统的访问权限需要<code class="fe me mf mg mh b">--allow-read</code>和<code class="fe me mf mg mh b">--allow-write</code>权限。</p><p id="0791" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><p id="8441" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">index.ts</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="f80a" class="mq lc iq mh b gy mr ms l mt mu">const text = await Deno.readTextFile("./people.json");<br/>console.log(text)</span></pre><p id="af87" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">people.json</code></p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="1230" class="mq lc iq mh b gy mr ms l mt mu">[<br/>  {<br/>    "id": 1,<br/>    "name": "John",<br/>    "age": 23<br/>  },<br/>  {<br/>    "id": 2,<br/>    "name": "Sandra",<br/>    "age": 51<br/>  },<br/>  {<br/>    "id": 5,<br/>    "name": "Devika",<br/>    "age": 11<br/>  }<br/>]</span></pre><p id="d666" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="20f9" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-read index.ts</span></pre><p id="3fbf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们读取JSON文件并记录数据。</p><p id="314e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Deno.readTextFile</code>返回一个承诺，这样我们就可以使用<code class="fe me mf mg mh b">await</code>。</p><h1 id="2b10" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">编写文本文件</h1><p id="dbc6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">要写一个文本文件，我们可以使用<code class="fe me mf mg mh b">writeTextFile</code>方法。</p><p id="20a1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="897d" class="mq lc iq mh b gy mr ms l mt mu">await Deno.writeTextFile("./hello.txt", "Hello World");<br/>console.log('success')</span></pre><p id="ef25" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建<code class="fe me mf mg mh b">hello.txt</code>并使用第二个参数中的字符串作为内容。</p><p id="43f4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们跑的时候:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="46d1" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-write index.ts</span></pre><p id="0ae6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们也可以使用<code class="fe me mf mg mh b">writeTextFileSync</code>方法同步写文本文件。</p><p id="1e2e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，我们可以写:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="3128" class="mq lc iq mh b gy mr ms l mt mu">try {<br/>  Deno.writeTextFileSync("./hello.txt", "Hello World");<br/>  console.log("Written to hello.txt");<br/>} catch (e) {<br/>  console.log(e.message);<br/>}</span></pre><h1 id="f2d8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">读取多个文件</h1><p id="6866" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以通过写来读取多个文件:</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="5120" class="mq lc iq mh b gy mr ms l mt mu">for (const filename of Deno.args) {  <br/>  const file = await Deno.open(filename);<br/>  await Deno.copy(file, Deno.stdout);<br/>  file.close();<br/>}</span></pre><p id="4985" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后当我们运行时:“</p><pre class="mi mj mk ml gt mm mh mn mo aw mp bi"><span id="8ead" class="mq lc iq mh b gy mr ms l mt mu">deno run --allow-read index.ts foo.txt bar.txt</span></pre><p id="8d2b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们应该看到打印出的<code class="fe me mf mg mh b">foo.txt</code>和<code class="fe me mf mg mh b">bar.txt</code>的内容。</p><p id="e163" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们调用<code class="fe me mf mg mh b">Deno.open</code>来打开每个文件。</p><p id="ff60" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe me mf mg mh b">Deno.args</code>有命令行参数，也就是<code class="fe me mf mg mh b">['foo.txt', 'bar.txt']</code>。</p><p id="b3b9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们调用<code class="fe me mf mg mh b">Deno.copy</code>将内容复制到<code class="fe me mf mg mh b">stdout</code>。</p><p id="dc0c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们用<code class="fe me mf mg mh b">file.close</code>关闭文件句柄。</p><h1 id="72a1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="9fd9" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">我们可以用fetch API发出HTTP请求，用Deno读写文件。</p><p id="7d40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">喜欢这篇文章吗？如果有，通过<a class="ae kc" href="https://www.youtube.com/channel/UCtipWUghju290NWcn8jhyAw?sub_confirmation=true" rel="noopener ugc nofollow" target="_blank"> <strong class="kf ir">订阅我们的YouTube频道</strong> </a> <strong class="kf ir">获取更多类似内容！</strong></p></div></div>    
</body>
</html>