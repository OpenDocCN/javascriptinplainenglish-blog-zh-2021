<html>
<head>
<title>Node.js Best Practices for Beginners and Experts Alike</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js初学者和专家的最佳实践</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/node-js-best-practices-for-beginners-and-experts-alike-49a1f67318ce?source=collection_archive---------0-----------------------#2021-07-01">https://javascript.plainenglish.io/node-js-best-practices-for-beginners-and-experts-alike-49a1f67318ce?source=collection_archive---------0-----------------------#2021-07-01</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div class="gh gi jk"><img src="../Images/2442e8f4a0b31090a47f82a7ce20179b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*QCHcK6ec52wHeZwD5XuNcg.jpeg"/></div><figcaption class="jr js gj gh gi jt ju bd b be z dk">Node JS Best Practices</figcaption></figure><p id="4839" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Node.js是最流行的web开发框架之一。</p><p id="919b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">任何人都可以通过学习Node.js爱上JavaScript，因为它完全基于JavaScript。</p><p id="5875" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过在浏览器之外编写javascript代码，可以创建轻量级、无阻塞、可伸缩、快速且健壮的服务器端web应用程序。</p><p id="411d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">今天，我们将讨论一些有用的<a class="ae kt" href="https://www.tatvasoft.com/blog/node-js-best-practices/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io"> Node.js最佳实践</strong> </a>，它们将帮助各类开发人员——初学者和专家——创建一个高效且最可持续的应用程序。</p><p id="cf50" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以请继续阅读！</p><h2 id="d1bb" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">每次更改代码时借助工具重启应用</strong></h2><p id="f871" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">在开发阶段，编码人员停止并重新启动应用程序来实现对代码的更改。这可能是一个麻烦，会让你在主要任务上失去注意力。</p><p id="e992" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以使用工具作为这个问题的解决方案，这样您就不必为了反映更改而一遍又一遍地重新启动应用程序。</p><p id="11f0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">以下是Node.js最流行的代码监控包:</p><ul class=""><li id="95f6" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated"><em class="mb"> Forever: </em>它提供了自动重启功能以及额外的配置，如写日志和设置工作目录，这些将打印到一个特定的文件中。</li><li id="6162" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">Nodemon: 它还提供了一个自动重启选项，只要代码有新的变化。要初始化nodemon，请在命令lone中将node替换为nodemon。</li><li id="738b" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">PM2:另一个过程管理工具，与上面两个相比，它有极好的控制和特性。</li></ul><p id="1844" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">永久和PM2罐甚至适用于生产环境。它确保代码在运行时错误后被恢复。它还可以确保应用程序在服务器停机的情况下快速重启。</p><h2 id="1d27" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">用异步/等待替换回调</strong></h2><p id="2ce1" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">最初，<a class="ae kt" href="https://nodejs.org/en/knowledge/getting-started/control-flow/what-are-callbacks/" rel="noopener ugc nofollow" target="_blank">回调</a>用于维护节点的异步特性，但它会导致回调在连续嵌套后失控。这是代码变得不可读的地方。</p><p id="3328" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">随着async/await的引入，开发人员已经看到这个问题有所减少。然而，为了避免回调，必须确保使用async/await。</p><p id="23b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过用async和await替换回调，可以很容易地防止回调。</p><h2 id="e844" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">采用小写</strong></h2><p id="ec0e" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">在某些编程语言中，文件名必须与类名匹配</p><p id="c777" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">避免在node.js中这样做，坚持小写。</p><p id="abed" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Node.js是一个以Linux为中心的工具，支持跨平台。然而，Windows和OSX会以相同的方式对待大写(' MyClass.js ')和小写(' myclass.js)，但Linux不会。要为跨平台编写代码，您应该满足确切的需求陈述，还要考虑大小写。</p><p id="c2d6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最好的方法是坚持只用小写字母。</p><h2 id="6738" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">应用集群</strong></h2><p id="26e6" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">节点运行时仅限于单个CPU内核，在大型服务器上部署非集群节点应用程序可能会浪费资源。</p><p id="fd74" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要充分利用多核和超过1.5GB的扩展内存，请在您的应用中添加集群支持。在集群的帮助下，即使在小型硬件上运行单个进程，您也可以获得灵活性。</p><p id="85f9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过全面的测试，您可以确定一个应用程序的集群进程的精确数量。然而，首先使用默认值总是一个好主意。</p><p id="e361" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过选择集群抽象，您可以避免反复重新发现流程管理轮。</p><h2 id="1da1" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">避开垃圾</strong></h2><p id="39b9" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">节点有一个默认限制为1.5 GB的惰性垃圾收集器。这个垃圾收集器将等待，直到它实际上有未使用的内存需要回收。</p><p id="1bac" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果内存不足，不是因为泄漏，而是垃圾收集器的懒惰行为。</p><p id="6c2f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是，可以通过向V8提供标志来完全控制垃圾收集器。</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="3ba6" class="ku kv in mm b gy mq mr l ms mt">web: node — optimize_for_size — max_old_space_size=920 — gc_interval=100 server.js</span></pre><p id="83c0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">做到这一点至关重要，尤其是当您在一个少于1.5Gb内存的环境中运行一个节点时。</p><p id="ec7d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">例如:</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="5d87" class="ku kv in mm b gy mq mr l ms mt">web: node — optimize_for_size — max_old_space_size=460 — gc_interval=100 server.js</span></pre><p id="4317" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">上述代码可用于将节点定制为512 MB的容器。</p><h2 id="f64b" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">干净的代码&amp;易读性</strong></h2><p id="dba7" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">毫无疑问，整洁有助于提高代码的质量。</p><p id="ca7b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">几乎每个代码都包含linter和formatter。</p><p id="f498" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Linter搜索并警告语法和语义上的错误代码，而格式化程序的工作就像更多的样式因素一样，以确保一组格式和样式在整个项目中保持一致。</p><p id="aa51" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最著名的linters是ESLint、JSLint和JSHint。</p><p id="5418" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">大部分IDEs代码编辑器如Atom、VSCode (Visual Studio Code)等。重视质量代码，提供直观且易于设置的林挺和格式插件。</p><p id="2b24" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不仅如此，这些ide还提供了额外的特性，比如重构、智能代码完成、悬停文档支持、自动导入、调试工具、代码导航等等。</p><p id="6a85" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">因此，强烈建议您获得这些ide中的一个，并设置一个流畅的编码工作流。</p><h2 id="d10d" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">依赖注入软件</strong></h2><p id="b038" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">这种软件设计提倡将依赖项或服务作为参数注入或传递给模块，而不是创建或要求它们。</p><p id="8837" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个奇特的术语使你的模块在应用中保持独立、灵活、可伸缩和可测试。</p><p id="ef9c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设你有一个模块，它公开了两个函数来处理一个随机的表情类。它还使用黄色表情模块来处理黄色表情数据库。</p><p id="4207" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">这里的问题是设置只服务于一组特定的表情符号——黄色。因此，如果你想使用不同的表情符号集或多个表情符号集，你可以创建单独的功能，或者修复现有的功能。</em></p><p id="4f8c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是为什么创建以多种方式工作的函数是至关重要的。</p><p id="dcfb" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">通过依赖注入，您可以使您的函数更加通用和灵活。</p><p id="c88f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们用一个例子来理解这一点</p><p id="d15b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">假设你创建了一个新函数——表情服务——它将依赖关系——表情颜色——作为参数，而不是固定为一种颜色类型(黄色)。</em></p><p id="7ffa" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这就是依赖注入的工作方式。</p><p id="396f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">由于这一点，该服务将有一个更通用的接口，易于使用和测试。</p><p id="b3ff" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们可以直接向测试用例传递表情颜色依赖，而不是创建黄色表情。</p><p id="42ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为了更加完美，请遵循给定的实践:</p><ul class=""><li id="3f2c" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated">不要重复你自己</li><li id="de82" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated"><a class="ae kt" href="https://stackify.com/solid-design-principles/" rel="noopener ugc nofollow" target="_blank"> <strong class="jx io">单一责任原则</strong> </a></li><li id="4415" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">保持简单</li><li id="0502" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">关注点划分</li><li id="b1ce" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">避免早期优化</li><li id="8733" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">依赖注入</li></ul><h2 id="2ef1" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">使用安全、分层和环境感知配置</strong></h2><p id="453e" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">无故障配置设置的标志包括:秘密放在提交的代码之外，配置遵循分层模式以便于搜索，密钥可以从环境变量和文件中读取。</p><p id="50de" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">rc、nconf、config、discrete等包遵循上述。</p><p id="6338" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您不能满足配置需求，它将会使开发人员或开发团队陷入困境，或者两者都陷入困境。</p><h2 id="4496" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">一些特定的插件</strong></h2><p id="eb8a" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">有一些插件覆盖了普通的JavaScript，比如eslint-plugin-mocha、eslint-plugin-node和eslint-plugin-node-security。</p><p id="2551" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">然而，各种错误的节点代码模式可能会被忽略；例如，开发人员可能需要将变量作为路径的“variableAsPath”文件，这为攻击者执行任何JavaScript打开了大门。Linters可以检测到这些模式，并提醒开发人员采取必要的措施。</p><h2 id="3230" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">使用头盔进行网络应用</strong></h2><p id="af04" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">构建Web应用程序非常有趣。为了使您的编码更简单，首先保护您的应用程序。</p><p id="aa6b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用:</p><ul class=""><li id="7884" class="ls lt in jx b jy jz kc kd kg lu kk lv ko lw ks lx ly lz ma bi translated">XSS保护</li><li id="3c0e" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">设置上下文安全策略头</li><li id="6390" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">确保所有连接都是HTTPS</li><li id="26d1" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">使用X-Frame-Options避免点击劫持</li><li id="b699" class="ls lt in jx b jy mc kc md kg me kk mf ko mg ks lx ly lz ma bi translated">禁用X-Powered-By标头，使攻击者无法将其攻击渗透到特定的软件</li></ul><p id="e0c3" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你觉得做上面的练习有点令人生畏，简单地使用头盔，将它们都设置为合理的默认，你将能够调整所需的。</p><p id="218e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">为JavaScript应用程序设置头盔非常简单。</p><p id="ca04" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你只需要使用-</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="5c99" class="ku kv in mm b gy mq mr l ms mt">“$ npm install helmet”</span></pre><p id="a417" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在你的代码中，然后添加-</p><pre class="mh mi mj mk gt ml mm mn mo aw mp bi"><span id="8868" class="ku kv in mm b gy mq mr l ms mt">var helmet = require(‘helmet’);</span><span id="ab89" class="ku kv in mm b gy mu mr l ms mt">app.use(helmet());</span></pre><p id="2aa8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">瞧啊。你可以走了！</p><h2 id="85e6" class="ku kv in bd kw kx ky dn kz la lb dp lc kg ld le lf kk lg lh li ko lj lk ll lm bi translated"><strong class="ak">结束</strong></h2><p id="b07b" class="pw-post-body-paragraph jv jw in jx b jy ln ka kb kc lo ke kf kg lp ki kj kk lq km kn ko lr kq kr ks ig bi translated">除非你遇到某些错误，否则任何编码都不会很难；除非你找到最佳实践，否则任何语言都不会很容易。所以在你的项目中使用提到的<strong class="jx io"> Node.js后端最佳实践</strong>，让编码变得有趣。</p><p id="c9dd" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">使用Node.js构建健壮、可伸缩且灵活的应用程序或软件</p><p id="7f44" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="mb">更多内容尽在</em><a class="ae kt" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="mb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>