<html>
<head>
<title>How to Connect MongoDB with a Node.js Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将MongoDB与Node.js应用程序连接</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/how-to-connect-mongodb-with-a-nodejs-application-782dbee4383d?source=collection_archive---------3-----------------------#2021-08-22">https://javascript.plainenglish.io/how-to-connect-mongodb-with-a-nodejs-application-782dbee4383d?source=collection_archive---------3-----------------------#2021-08-22</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/a5f5e1a2a6cd0f4c995d21918fda2c55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtUBG4zC1-JD6Km2mr3Zvg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Connecting MongoDB with a NodeJS Application</figcaption></figure><p id="def9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">你有MongoDB数据库吗？是否要用Node.js管理此数据库？</p><p id="d7f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在本快速入门指南中，我将向您介绍使用MongoDB和Node.js的基础知识。我们将从Node.js脚本建立到MongoDB数据库的连接，检索数据库列表，并将结果打印到您的控制台。</p><h1 id="341f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置好一切</h1><p id="92e4" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">在我们开始之前，要求我们已经满足了使用MongoDB和Node.js的所有先决条件。</p><h1 id="4269" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">设置Node.js</h1><p id="637f" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">首先，我们需要确保你有Node.js的支持版本。如果你没有Node.js的支持版本，这里有一篇文章可以帮助你升级到最新版本。MongoDB的最新版本需要Node.js版本<em class="mb"> 4.0 </em>或更高版本。对于本文，我们将使用Node.js版本<em class="mb"> 14.15.4 </em>。</p><h1 id="692f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">安装MongoDB Node.js包</h1><p id="a4fa" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">MongoDB Node.js包允许您在Node.js应用程序中轻松地与MongoDB数据库交互并执行查询。该软件包是本快速入门指南所必需的。</p><p id="55d3" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果您还没有安装MongoDB Node.js包，您可以通过执行以下命令来安装它:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="cf46" class="ml ky in mh b gy mm mn l mo mp"><em class="mb">npm install mongodb</em></span></pre><p id="00e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">运行该命令还将显示当前安装的软件包版本号。请参见<a class="ae ma" href="https://docs.mongodb.com/drivers/node/compatibility" rel="noopener ugc nofollow" target="_blank"> MongoDB兼容性</a>文档，了解每个版本的Node.js需要哪个版本的Node.js。</p><h1 id="b53d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建一个MongoDB atlas集群并加载数据</h1><p id="c163" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">接下来您需要的是一个MongoDB数据库。如果您还没有数据库，可以使用Atlas创建一个。Atlas是MongoDB的完全托管数据库服务，允许您随意创建和操作数据库。Atlas帮助您创建一个集群，一组存储数据库副本的节点。</p><h1 id="d491" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">集群的连接信息</h1><p id="bbc2" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">最后一步是让集群为连接做好准备。</p><p id="b047" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在Atlas中，导航到您的集群并单击connect将会弹出客户端连接向导。向导将显示您当前的IP地址，并将其添加到IP访问列表中。如果您还没有创建MongoDB用户，可以在这里创建。请务必记下您的用户名和密码，因为稍后会用到它们。</p><p id="777c" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，向导将提示您选择一种连接方法。在这里，您必须选择“连接您的应用程序”,这将提示选择驱动程序版本。这将为您提供一个连接字符串，您需要复制该字符串以供以后使用。</p><h1 id="4cb1" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">从Node.js连接到您的数据库</h1><p id="7564" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">现在一切都设置好了，是时候编写一个Node.js脚本来连接到您的数据库并列出集群中的所有数据库了。</p><h1 id="d4db" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">导入MongoClient</h1><p id="aa13" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">MongoDB的模块导出MongoClient，我们将使用它连接到我们的MongoDB数据库。我们将使用MongoClient的一个实例连接到一个集群，访问集群中的一个特定数据库，并关闭我们的连接。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="66ff" class="ml ky in mh b gy mm mn l mo mp">const {MongoClient} = require(“mongodb”)</span></pre><h1 id="afc9" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">创建我们的主要功能</h1><p id="dddd" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">接下来，我们将创建一个main()函数，它将允许我们连接到MongoDB集群，调用函数来查询数据库，并关闭我们的连接。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="4a67" class="ml ky in mh b gy mm mn l mo mp">async function main() {</span><span id="e941" class="ml ky in mh b gy mq mn l mo mp">// Code</span><span id="5fde" class="ml ky in mh b gy mq mn l mo mp">}</span></pre><p id="e30d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">在main函数中，我们将为我们的连接URL创建一个常量实例。连接URL是包用来连接MongoDB数据库的一组指令。它指示包如何连接到MongoDB以及它应该如何表现。连接URL定义如下:</p><p id="e23a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有关建立连接的更多信息，请访问官方文档。</p><p id="d92e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">快速入门指南的连接URI是您在上一节中在Atlas中复制的那个。粘贴时不要忘记用您在上一节中创建的凭证更新<em class="mb"> &lt;用户名&gt; </em>和<em class="mb"> &lt;密码&gt; </em>标签。该字符串还包括<em class="mb"> &lt; dbname &gt; </em>标记，该标记应该用您希望在集群中访问的数据库的名称进行更新。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="5614" class="ml ky in mh b gy mm mn l mo mp">const uri = “mongodb+srv://&lt;username&gt;:&lt;password&gt;@&lt;your-cluster-url&gt;/test?retryWrites=true&amp;w=majority”;</span></pre><p id="5834" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我们已经创建了我们的URI，我们将创建我们的MongoClient的一个实例。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f46b" class="ml ky in mh b gy mm mn l mo mp">const client = new MongoClient(uri);</span></pre><p id="605e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io">注意:</strong>当您运行这段代码时，您可能会收到一些关于URL字符串的反对警告。您可以通过将选项传递给MongoClient来删除它。参见<a class="ae ma" href="https://mongodb.github.io/node-mongodb-native/3.6/api/MongoClient.html" rel="noopener ugc nofollow" target="_blank"> Node.js MongoDB API文档</a>获得更多帮助。</p><p id="c93d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们现在准备使用MongoClient建立到集群的连接。我们将使用<em class="mb"> client.connect() </em>连接到我们的数据库。我们将使用await关键字来指示我们应该阻止进一步的代码执行，直到操作完成。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="ac4a" class="ml ky in mh b gy mm mn l mo mp"><em class="mb">await</em> client.connect();</span></pre><p id="19e9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们现在可以与我们的数据库进行交互。对于本指南，我们将构建一个函数来打印集群中所有数据库的列表。通常的做法是使用逻辑名称来提高代码的可读性。现在让我们调用函数<em class="mb"> listDatabases() </em>。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="deff" class="ml ky in mh b gy mm mn l mo mp"><em class="mb">await</em> listDatabases(client);</span></pre><p id="85f9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们可以通过将代码包装在一个try and catch语句中来进一步改进代码。这将允许我们处理和处理任何意外的错误。我们还想确保我们的连接是安全的，所以我们将使用finally语句来结束我们的连接:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="7989" class="ml ky in mh b gy mm mn l mo mp"><em class="mb">try</em> {</span><span id="49ff" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> client.connect();</span><span id="74ac" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> listDatabases(client);</span><span id="d805" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="3996" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">catch</em> (e) {</span><span id="bd9a" class="ml ky in mh b gy mq mn l mo mp">console.error(e);</span><span id="ae35" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="f3d3" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">finally</em> {</span><span id="85c3" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> client.close();</span><span id="8703" class="ml ky in mh b gy mq mn l mo mp">}</span></pre><p id="4734" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">现在我们已经准备好了主函数，我们需要调用它并将错误发送到控制台。将所有这些放在一起，我们的代码看起来像这样:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="dfa1" class="ml ky in mh b gy mm mn l mo mp">async function main(){</span><span id="4f67" class="ml ky in mh b gy mq mn l mo mp">const uri = “mongodb+srv://&lt;username&gt;:&lt;password&gt;@&lt;your-cluster-url&gt;/test?retryWrites=true&amp;w=majority”;</span><span id="44d8" class="ml ky in mh b gy mq mn l mo mp">const client = new MongoClient(uri);</span><span id="1ed9" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">try</em> {</span><span id="e205" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> client.connect();</span><span id="0aeb" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> listDatabases(client);</span><span id="95fd" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="7c9a" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">catch</em> (e) {</span><span id="1b8f" class="ml ky in mh b gy mq mn l mo mp">console.error(e);</span><span id="3783" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="64f1" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">finally</em> {</span><span id="b596" class="ml ky in mh b gy mq mn l mo mp"><em class="mb">await</em> client.close();</span><span id="53e1" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="b237" class="ml ky in mh b gy mq mn l mo mp">}</span><span id="4b68" class="ml ky in mh b gy mq mn l mo mp">main.catch(console.error);</span></pre><h1 id="1646" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">列出集群中的数据库</h1><p id="b0e6" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">Node.js允许我们创建不同的函数，以不同的方式操作我们的MongoDB集群。对于本快速入门指南，我们将创建一个<em class="mb"> listDatabases </em>函数，该函数将列出集群中的所有数据库。在需要小心管理多个数据库的情况下，或者在一个数据库中的趋势可能与另一个数据库相关的数据分析中，这种功能非常有用。</p><p id="dd93" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我们的函数将检索集群中所有数据库的名称，并将它们打印到控制台:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="9627" class="ml ky in mh b gy mm mn l mo mp">async function listDatabases(client){</span><span id="e8bc" class="ml ky in mh b gy mq mn l mo mp">databasesList = <em class="mb">await</em> client.db().admin().listDatabases();</span><span id="e438" class="ml ky in mh b gy mq mn l mo mp">console.log(“Databases:”);</span><span id="971a" class="ml ky in mh b gy mq mn l mo mp">databasesList.databases.forEach(db =&gt; console.log(` — ${db.name}`));</span><span id="c2f4" class="ml ky in mh b gy mq mn l mo mp">};</span></pre><h1 id="7e8d" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">执行您的代码</h1><p id="e235" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">在执行代码之前，将脚本保存在文件中是很重要的。它可以被命名为任何东西，但是给你的文件起一个逻辑名是一个常见的惯例。为此，我将我的文件命名为“demo.js”。</p><p id="0749" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">可以通过在终端中运行命令行来执行该脚本:</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="3c46" class="ml ky in mh b gy mm mn l mo mp"><em class="mb">node demo.js</em></span></pre><p id="a5be" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">终端将显示集群中所有数据库的名称。</p><h1 id="4885" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">最后的想法</h1><p id="32d0" class="pw-post-body-paragraph jz ka in kb b kc lv ke kf kg lw ki kj kk lx km kn ko ly kq kr ks lz ku kv kw ig bi translated">今天，我们能够建立到MongoDB数据库的连接。我们能够编写Node.js脚本，检索集群中的数据库列表，并在控制台中查看结果。我们还理解了连接URL和它如何改变我们的连接行为，以及编写可以帮助查询我们的数据库的函数。</p><p id="ae6b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">我希望这篇文章能帮助您理解连接Node.js和MongoDB的基础知识。要获得进一步的帮助，你可以访问<a class="ae ma" href="https://docs.atlas.mongodb.com/connect-to-database-deployment/" rel="noopener ugc nofollow" target="_blank"> MongoDB的官方文档</a>，在那里他们给出了你在安装或连接数据库时可能遇到的任何问题的详细信息。</p><p id="bd26" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="mb">更多内容尽在</em><a class="ae ma" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><strong class="kb io"><em class="mb">plain English . io</em></strong></a></p></div></div>    
</body>
</html>