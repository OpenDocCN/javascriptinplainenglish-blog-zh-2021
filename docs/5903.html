<html>
<head>
<title>Create an OTP-based User Sign-Up using Node.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Node.js创建一个基于OTP的用户注册</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/create-otp-based-user-sign-up-using-node-js-cc4defc54123?source=collection_archive---------0-----------------------#2021-12-18">https://javascript.plainenglish.io/create-otp-based-user-sign-up-using-node-js-cc4defc54123?source=collection_archive---------0-----------------------#2021-12-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3c1f2f58fdb231e78dabc5836841f01a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PJml0_OSR5-K8VLF"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@desola?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Desola Lanre-Ologun</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f288" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这篇文章是关于创建一个OTP风格的用户注册系统。我将路线图分成几个部分，这样您就可以直接看到您实际需要的部分。</p><p id="5411" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">第1部分:在Express JS中设置后端。第2部分:创建OTP服务。<br/>第3部分:创建电子邮件服务。<br/>第4节:数据库持久性。<br/>第5部分:用路由和控制器组装服务。</p><h1 id="b940" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">第1部分:设置后端</h1><p id="340f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">因为您需要提交的表单数据，这是您需要做的第一步。在这一部分中，我们</p><blockquote class="mb mc md"><p id="6bc6" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">创建基本快速应用程序。<br/>创建处理端点的路线。<br/>不创建控制器，因为这是一个简单的过程，不需要多个路线/控制器</p></blockquote><h2 id="7f73" class="mi kz in bd la mj mk dn le ml mm dp li kl mn mo lm kp mp mq lq kt mr ms lu mt bi translated">第1部分:创建基本Express应用程序</h2><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><h2 id="d678" class="mi kz in bd la mj mk dn le ml mm dp li kl mn mo lm kp mp mq lq kt mr ms lu mt bi translated">第2节:创建OTP服务</h2><p id="3813" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">我们在npm上有多个可用的OTP生成器。我为这个特定的应用程序选择了<strong class="kc io"> otp生成器。</strong></p><p id="2e3d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们创建了一个名为services的目录，存放我们的邮件服务和OTP服务。</p><p id="16cb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在服务目录中，我创建了一个文件otp.js，它实现了otp生成工具。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><blockquote class="mb mc md"><p id="4f39" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">要了解更多关于图书馆的信息，你可以浏览https://www.npmjs.com/package/otp-generator.的文献</p></blockquote><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/e5f1a27091e039d4e57e0289c284cf09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Flkp8vF311ogxhA_"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@brett_jordan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brett Jordan</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="06ce" class="mi kz in bd la mj mk dn le ml mm dp li kl mn mo lm kp mp mq lq kt mr ms lu mt bi translated">第3部分:创建电子邮件服务</h2><p id="58be" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在这一部分，我想提一下，我们有多种选择来创建电子邮件服务。我会选择的主要选择是—</p><ul class=""><li id="ca15" class="nb nc in kc b kd ke kh ki kl nd kp ne kt nf kx ng nh ni nj bi translated">AWS SES</li><li id="22a0" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">发送网格</li><li id="794f" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">NPM邮件地址</li></ul><blockquote class="mb mc md"><p id="bc5a" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">我将使用nodemailer npm包来简化在这里发送电子邮件的过程。对于Sendgrid来说，这个过程相当长，你需要进行大量的注册。对于AWS SES，您需要首先让您的帐户退出沙盒模式，这需要提供大量的详细信息。由于这是一篇演示设计模式的文章，为了简单起见，我不打算深入研究sendgrid和aws ses。</p></blockquote><p id="13bb" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">要开始使用nodemailer，您需要确定邮件服务。就我而言，我使用GMAIL服务发送邮件。另一种方法是使用带有SMTP信息的域电子邮件。我假设大多数人不使用域名邮件和SMTP，GMAIL是这里最好的演示服务。</p><p id="7e83" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在启动nodemailer之前，需要在Gmail帐户上配置一项设置。<strong class="kc io">要从您的Gmail帐户发送电子邮件，您需要启用“不太安全的应用程序”设置。</strong>这是一个重要的设置，缺少它会导致发送邮件失败。请确保启用该功能。也除了以上一点。<strong class="kc io">安全性较低的应用程序无法与具有多因素身份验证(MFA)的帐户配合使用</strong>。我建议你只发送带有服务账户或单独账户的电子邮件，这些账户仅用于邮寄目的。<strong class="kc io">出于安全考虑，不建议使用Gmail和nodemailer发送电子邮件，即使在nodemailer文档中也是如此</strong></p><p id="3493" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">启用“不太安全的应用程序”设置后。下面是需要做的事情。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="5bf4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">您可以从env文件中提供您的“GMAIL电子邮件和密码”。该文件将初始化transporter对象，然后可以从适当的控制器使用<strong class="kc io"> sendMail </strong> wrapper。</p><h2 id="9a97" class="mi kz in bd la mj mk dn le ml mm dp li kl mn mo lm kp mp mq lq kt mr ms lu mt bi translated">第4节:数据库持久性</h2><p id="8c4c" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在这一节中，我将设置auth控制器，生成OTP和user并将它们关联起来。</p><p id="566f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在我的auth.route.js看起来像</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2e13" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">/ route处理用户和OTP的创建。</p><p id="5e7a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">/ verify路由处理OTP的验证。</p><p id="4f5b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:为了处理逻辑，您可以使用相同的路径，但是为了简化，我使用了不同的路径。</p><p id="8971" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我设计的MongoDB模型是:</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><blockquote class="mb mc md"><p id="69b1" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">编辑-我将创建的属性类型更改为日期</p></blockquote><p id="2701" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">活动状态决定了用户是否通过验证。只要用户登录或执行某些应用程序逻辑，就可以使用最后一个活动状态。otp存储生成的OTP。</p><p id="a372" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">控制器文件是一个有趣的文件，所有的逻辑都在这里定义。</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="2fa5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">当用户注册时。我们首先检查它是否已经存在。如果存在，我们可以在这个场景中执行自定义逻辑。否则，我们用散列密码创建一个新用户。我用bcrypt散列密码，你可以用任何。</p><p id="7286" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">总结上述代码</p><blockquote class="mb mc md"><p id="1164" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">当用户首次注册时</p></blockquote><ul class=""><li id="fdd9" class="nb nc in kc b kd ke kh ki kl nd kp ne kt nf kx ng nh ni nj bi translated">检查电子邮件/用户是否存在</li><li id="3525" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">如果存在，可以执行自定义逻辑并返回</li><li id="77e0" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">如果没有，通过散列密码和生成OTP来创建一个新用户</li></ul><blockquote class="mb mc md"><p id="2833" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">验证动态口令</p></blockquote><ul class=""><li id="1c5b" class="nb nc in kc b kd ke kh ki kl nd kp ne kt nf kx ng nh ni nj bi translated">我们向控制器发送电子邮件和动态口令</li><li id="2164" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">如果电子邮件不存在，抛出一个错误</li><li id="154e" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">如果电子邮件已经存在，而动态口令不正确，则抛出一个错误</li><li id="f1eb" class="nb nc in kc b kd nk kh nl kl nm kp nn kt no kx ng nh ni nj bi translated">如果没有一个检查失败，那么将active更新为true并返回</li></ul><h2 id="624e" class="mi kz in bd la mj mk dn le ml mm dp li kl mn mo lm kp mp mq lq kt mr ms lu mt bi translated">第5部分:组装路线图</h2><p id="0e11" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">这里剩下的最后一部分是当用户尝试注册时发送邮件。我们将我们的邮件服务集成到我们的控制器中，以执行剩下的最后一步。然后我们的控制器看起来像</p><figure class="mu mv mw mx gt jo"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="fdd0" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">注意:错误处理可以在整个过程中得到极大的改善。本文只关注设计数据流的路线图的重要方面。</p><p id="27c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用邮递员发送请求</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/e06aac5e8e5513a37f7c491679fe70f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XiwNNDMUzHuxesWk8kTHjg.png"/></div></div></figure><p id="db30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">nodemailer发送的邮件</p><figure class="mu mv mw mx gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/8b2ca65a9c7932b5a22531d8d5b3e070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlD7KyndxLy8hZy1blhxVA.png"/></div></div></figure><p id="8859" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我将为所有代码的集中化添加一个到GitHub库的链接。谢谢你的时间。如果您有任何问题/建议，请在评论区留言或留下您的评论。</p><blockquote class="mb mc md"><p id="1604" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">编辑— Github存储库链接</p></blockquote><div class="nr ns gp gr nt nu"><a href="https://github.com/akshay271703/node-otp-email-auth" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">GitHub-akshay 271703/Node-otp-email-auth:用于基于OTP和电子邮件的注册的节点应用程序</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jt nu"/></div></div></a></div><blockquote class="mb mc md"><p id="9607" class="ka kb me kc b kd ke kf kg kh ki kj kk mf km kn ko mg kq kr ks mh ku kv kw kx ig bi translated">编辑-NestJs/Typescript/AWS SES中的项目</p></blockquote><div class="nr ns gp gr nt nu"><a href="https://github.com/akshay271703/nest-email-otp" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">GitHub-akshay 271703/nest-email-OTP</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">npm install #用于运行应用程序NPM I PM2-g # development $ NPM run start:PM2确保安装pm2…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oj l of og oh od oi jt nu"/></div></div></a></div></div></div>    
</body>
</html>