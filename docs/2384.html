<html>
<head>
<title>Build a React Native Video Chat App with In-Call Statistics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个具有通话统计的React原生视频聊天应用程序</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/building-a-react-native-video-chat-app-with-in-call-statistics-550a55266d9e?source=collection_archive---------21-----------------------#2021-05-17">https://javascript.plainenglish.io/building-a-react-native-video-chat-app-with-in-call-statistics-550a55266d9e?source=collection_archive---------21-----------------------#2021-05-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/3fd77d1288874247a85d2cea7509daf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lkO-kSQVCZ0cY4PKNX3G4A.png"/></div></div></figure><p id="a971" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当您构建实时互动应用程序时，需要监控大量指标，以便为最终用户提供流畅的体验。在调试次优用户体验、高CPU使用率、低互联网带宽、丢帧等等时，可能会面临许多挑战。通话统计可用于监控、维护和改善用户体验。</p><p id="825f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本教程中，我们将在React Native <a class="ae kt" href="https://github.com/EkaanshArora/Agora-RN-Quickstart" rel="noopener ugc nofollow" target="_blank">快速入门应用</a>中添加通话统计。如果你是Agora SDK的新手，你可以在这里学习演示如何工作。我们将了解如何访问和显示本地视频、远程视频和其他重要呼叫方面的统计数据，如带宽和CPU使用率。</p><h1 id="d636" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">先决条件</h1><ul class=""><li id="a12e" class="ls lt in jx b jy lu kc lv kg lw kk lx ko ly ks lz ma mb mc bi translated">Node.js LTS版本</li><li id="aa1a" class="ls lt in jx b jy md kc me kg mf kk mg ko mh ks lz ma mb mc bi translated">安卓或iOS设备</li><li id="4a7f" class="ls lt in jx b jy md kc me kg mf kk mg ko mh ks lz ma mb mc bi translated">一个<a class="ae kt" href="https://sso.agora.io/en/signup?utm_source=medium&amp;utm_medium=blog&amp;utm_campaign=build-a-react-native-video-chat-app-with-in-call-statistics" rel="noopener ugc nofollow" target="_blank"> Agora开发者账户</a></li><li id="e59d" class="ls lt in jx b jy md kc me kg mf kk mg ko mh ks lz ma mb mc bi translated">对React Native和Agora SDK的基本了解</li></ul><p id="a86a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">快速启动应用程序是一个很好的起点，因为它已经内置了视频通话功能，并且不包含我们不需要的功能。您可以按照<code class="fe mi mj mk ml b">readme.md</code>中的说明让应用程序在您的设备上运行。如果你只是想要有通话统计的最终应用，你可以在这里找到应用<a class="ae kt" href="https://github.com/EkaanshArora/Agora-RN-CallStats" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="fc06" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">访问通话统计</h1><figure class="mn mo mp mq gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mm"><img src="../Images/c4ae4b9f8eec33fceb140ca5f28138d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAN2SElZPcgRogm-WrI-PA.png"/></div></div></figure><p id="bb4c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们开始为我们的演示应用程序编写通话统计代码。</p><h2 id="ee45" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">更新状态</h2><p id="b0ef" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们将向状态添加三个对象(<code class="fe mi mj mk ml b">remoteStats</code>、<code class="fe mi mj mk ml b">rtcStats</code>和<code class="fe mi mj mk ml b">localStats</code>)，以存储三种不同类型的统计数据。<code class="fe mi mj mk ml b">localStats</code>和<code class="fe mi mj mk ml b">rtcStats</code>将是直接包含不同属性的对象。我们将使用<code class="fe mi mj mk ml b">remoteStats</code>对象将远程用户的UID存储为键，并将该用户的统计数据存储为键-值对中的值。我们将添加一个Boolean <code class="fe mi mj mk ml b">showStats</code>来隐藏和取消隐藏我们UI中的统计数据:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="3303" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">收听统计数据</h2><p id="2c65" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们可以通过监听<code class="fe mi mj mk ml b">LocalVideoStats</code>、<code class="fe mi mj mk ml b">RemoteVideoStats</code>和<code class="fe mi mj mk ml b">RtcStats</code>事件来访问通话中的统计数据。让我们添加事件侦听器来访问和存储状态中的统计信息。每个事件每两秒触发一次。(如果我们有<em class="ni"> N </em>个用户在通话中，<code class="fe mi mj mk ml b">RemoteVideoStats</code>每2秒触发<em class="ni"> N </em>次。)</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="3f07" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">切换showStats的函数</h2><p id="8d3c" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">让我们创建一个当我们按下切换按钮时翻转showStats布尔值的函数:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="21a9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">显示统计数据</h1><p id="5891" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">现在我们已经有了所有的逻辑，让我们在UI中显示这些统计数据。我们将使用Boolean showStats来有条件地呈现统计数据。</p><h2 id="9da5" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">开关按钮</h2><p id="ef9c" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们将在render方法中的start和end call按钮旁边添加一个按钮来隐藏和取消隐藏统计信息:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="4b24" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">本地视频统计和RTC统计</h2><p id="ee07" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们将定义一个函数<code class="fe mi mj mk ml b">_renderLocalStats</code>来使用平面列表呈现本地统计数据。我们遍历对象的键，并在文本组件中显示它们的值。(<code class="fe mi mj mk ml b">_localStatItem</code>和<code class="fe mi mj mk ml b">_rtcStatItem</code>是我们列表的辅助函数。)</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="0761" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将<code class="fe mi mj mk ml b">_renderLocalStats</code>函数添加到<code class="fe mi mj mk ml b">_renderVideos</code>函数中，如下所示:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h2 id="2612" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">远程视频统计</h2><p id="905c" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们将创建一个函数，使用他们的<code class="fe mi mj mk ml b">UID</code>来呈现给定远程用户的远程统计数据。我们将使用一个FlatList来呈现在我们的<code class="fe mi mj mk ml b">remoteStats</code>对象上迭代的<code class="fe mi mj mk ml b">Text</code>组件，并将它们的<code class="fe mi mj mk ml b">UID</code>作为键:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="a924" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将这个组件渲染成我们的<code class="fe mi mj mk ml b">RtcRemoteView</code>组件的覆盖图。你可以在这里找到样式定义<a class="ae kt" href="https://github.com/EkaanshArora/Agora-RN-CallStats/blob/main/components/Style.ts" rel="noopener ugc nofollow" target="_blank"/>:</p><figure class="mn mo mp mq gt jo"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="a28a" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">结论</h1><p id="fc56" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">这就是我们如何收听、监控和显示视频体验中的通话统计数据。您甚至可以构建函数来记录这些值的变化或对这些变化做出反应，从而提供出色的用户体验。</p><h2 id="f2a0" class="mr kv in bd kw ms mt dn la mu mv dp le kg mw mx li kk my mz lm ko na nb lq nc bi translated">其他资源</h2><p id="9348" class="pw-post-body-paragraph jv jw in jx b jy lu ka kb kc lv ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">如果你想了解演示应用程序是如何工作的，请看这个<a class="ae kt" href="https://www.agora.io/en/blog/building-a-react-native-video-chat-app-using-agora/" rel="noopener ugc nofollow" target="_blank">教程</a>。如果你想了解Agora SDK的其他特性，请参见<a class="ae kt" href="https://docs.agora.io/en/Video/API%20Reference/react_native/index.html" rel="noopener ugc nofollow" target="_blank"> API参考</a>。我也邀请你加入Agora <a class="ae kt" href="https://www.agora.io/en/join-slack/" rel="noopener ugc nofollow" target="_blank"> Slack社区</a>。</p><p id="98d5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="ni">更多内容看</em><a class="ae kt" href="http://plainenglish.io" rel="noopener ugc nofollow" target="_blank"><strong class="jx io"><em class="ni">plain English . io</em></strong></a></p></div></div>    
</body>
</html>