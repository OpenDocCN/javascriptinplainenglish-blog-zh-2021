<html>
<head>
<title>Pagination with the Rick and Morty API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rick和Morty API进行分页</h1>
<blockquote>原文：<a href="https://javascript.plainenglish.io/pagination-with-the-rick-and-morty-api-1e136be0f225?source=collection_archive---------1-----------------------#2021-05-24">https://javascript.plainenglish.io/pagination-with-the-rick-and-morty-api-1e136be0f225?source=collection_archive---------1-----------------------#2021-05-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/7a12692c1eb154aa15e4a3785b2fd7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8N1D3-5jKtgcubgx"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@benceboros?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">BENCE BOROS</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="539d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如今的大多数网站都无法一次展示用户需要看到的所有数据。最好不要显示所有数据，因为这有助于更好的用户体验，也使网站更容易导航。</p><p id="cd70" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为了显示更多的数据，可以实现一个称为分页的特性。我决定尝试分页，并使用Rick和Morty API实现它。我选择这个API是因为在我看来，它更容易实现分页。我将展示我自己的分页方法。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="c924" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我打算用最少的钱开始我的项目。我将只保留应用程序和索引CSS文件和应用程序和索引组件。我将使用钩子，所以我将从React导入useState和useEffect钩子。首先，我将声明应用程序组件中需要的所有状态变量。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="f7b2" class="lo lp in lk b gy lq lr l ls lt">const [loading, setLoading] = useState(true)</span><span id="28ce" class="lo lp in lk b gy lu lr l ls lt">const [characters, setCharacters] = useState([])</span><span id="7620" class="lo lp in lk b gy lu lr l ls lt">const [currentPageUrl, setCurrentPageUrl] = useState("https://rickandmortyapi.com/api/character")</span><span id="a114" class="lo lp in lk b gy lu lr l ls lt">const [nextPageUrl, setNextPageUrl] = useState()</span><span id="50f1" class="lo lp in lk b gy lu lr l ls lt">const [prevPageUrl, setPrevPageUrl] = useState()</span><span id="c125" class="lo lp in lk b gy lu lr l ls lt">const [pages, setPages] = useState()</span></pre><p id="f9f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我将使用Effect钩子从API获取数据。首先，我将loading的值设置为true，以确保首先显示加载屏幕。数据到达后，该值可以设置为false。该效果将在每次当前页面URL更改时运行。这就是它的样子。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="9293" class="lo lp in lk b gy lq lr l ls lt">useEffect(() =&gt; {</span><span id="bbdf" class="lo lp in lk b gy lu lr l ls lt">  const url = currentPageUrl</span><span id="740e" class="lo lp in lk b gy lu lr l ls lt">  setLoading(true)</span><span id="d869" class="lo lp in lk b gy lu lr l ls lt">  const fetchData = async () =&gt; {</span><span id="d59e" class="lo lp in lk b gy lu lr l ls lt">    const res = await fetch(url);</span><span id="eb22" class="lo lp in lk b gy lu lr l ls lt">    const data = await res.json();</span><span id="9cca" class="lo lp in lk b gy lu lr l ls lt">    setCharacters(data.results)</span><span id="16de" class="lo lp in lk b gy lu lr l ls lt">    setLoading(false);</span><span id="b351" class="lo lp in lk b gy lu lr l ls lt">    setNextPageUrl(data.info.next);</span><span id="458a" class="lo lp in lk b gy lu lr l ls lt">    setPrevPageUrl(data.info.prev);</span><span id="d60d" class="lo lp in lk b gy lu lr l ls lt">    setPages(data.info.pages)</span><span id="12e6" class="lo lp in lk b gy lu lr l ls lt">  }</span><span id="b272" class="lo lp in lk b gy lu lr l ls lt">  fetchData();</span><span id="424a" class="lo lp in lk b gy lu lr l ls lt">},[currentPageUrl])</span></pre><p id="0720" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">现在，我将创建一些功能，这些功能将被分配给页面导航按钮。这些功能将改变当前页面。我将把我们获取的字符映射到一个名为charList的变量，该变量将保存一个组件列表。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="1843" class="lo lp in lk b gy lq lr l ls lt">function nextPage() {</span><span id="0e60" class="lo lp in lk b gy lu lr l ls lt">setCurrentPageUrl(nextPageUrl)</span><span id="f50a" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="b26d" class="lo lp in lk b gy lu lr l ls lt">function prevPage() {</span><span id="f497" class="lo lp in lk b gy lu lr l ls lt">setCurrentPageUrl(prevPageUrl)</span><span id="5ae1" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="42ea" class="lo lp in lk b gy lu lr l ls lt">function goToPage(num) {</span><span id="6d85" class="lo lp in lk b gy lu lr l ls lt">setCurrentPageUrl(`https://rickandmortyapi.com/api/character?page=${num}`)</span><span id="a61c" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="db76" class="lo lp in lk b gy lu lr l ls lt">if (loading) return "Loading..."</span><span id="2d28" class="lo lp in lk b gy lu lr l ls lt">const charList = characters.map(char =&gt; &lt;Character key={Math.floor(Math.random() * 10000)} name={char.name} img={char.image} /&gt;)</span></pre><p id="2875" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是角色组件的样子。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="4c22" class="lo lp in lk b gy lq lr l ls lt">import React from 'react'</span><span id="41b5" class="lo lp in lk b gy lu lr l ls lt">const Character = ({ name, img }) =&gt; {</span><span id="e27a" class="lo lp in lk b gy lu lr l ls lt">  return (</span><span id="762d" class="lo lp in lk b gy lu lr l ls lt">    &lt;div className="character-card"&gt;</span><span id="16be" class="lo lp in lk b gy lu lr l ls lt">      &lt;img src={img} alt="" /&gt;</span><span id="0b27" class="lo lp in lk b gy lu lr l ls lt">      &lt;div&gt;{name}&lt;/div&gt;</span><span id="fb0f" class="lo lp in lk b gy lu lr l ls lt">    &lt;/div&gt;</span><span id="407f" class="lo lp in lk b gy lu lr l ls lt">)</span><span id="e148" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="521d" class="lo lp in lk b gy lu lr l ls lt">export default Character</span></pre><p id="c485" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们把角色的名字和形象作为道具传递下去。现在我们需要为分页特性创建按钮。我将在它自己的部分做这件事。我们需要将nextPage、prevPage和goToPage函数作为道具传递给这个组件，同时传递页数。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="fdec" class="lo lp in lk b gy lq lr l ls lt">import React from 'react'</span><span id="1954" class="lo lp in lk b gy lu lr l ls lt">const Pagination = ({ nextPage, prevPage, goToPage, pages }) =&gt; {</span><span id="99e8" class="lo lp in lk b gy lu lr l ls lt">  let pageButtons = []</span><span id="e1ce" class="lo lp in lk b gy lu lr l ls lt">  for (let i = 1; i &lt;= pages; i++) {</span><span id="871f" class="lo lp in lk b gy lu lr l ls lt">  pageButtons.push(&lt;button key={i} onClick={() =&gt; goToPage(i)}&gt;{i}&lt;/button&gt;)</span><span id="fc8d" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="387a" class="lo lp in lk b gy lu lr l ls lt">  return (</span><span id="e274" class="lo lp in lk b gy lu lr l ls lt">    &lt;div&gt;</span><span id="24da" class="lo lp in lk b gy lu lr l ls lt">      {prevPage &amp;&amp; (&lt;button onClick={prevPage}&gt;Previous&lt;/button&gt;)}</span><span id="922b" class="lo lp in lk b gy lu lr l ls lt">      {pageButtons}</span><span id="55c7" class="lo lp in lk b gy lu lr l ls lt">      {nextPage &amp;&amp; (&lt;button onClick={nextPage}&gt;Next&lt;/button&gt;)}</span><span id="f936" class="lo lp in lk b gy lu lr l ls lt">    &lt;/div&gt;</span><span id="b135" class="lo lp in lk b gy lu lr l ls lt">  )</span><span id="6238" class="lo lp in lk b gy lu lr l ls lt">}</span><span id="33b8" class="lo lp in lk b gy lu lr l ls lt">export default Pagination</span></pre><p id="5de2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这里，我创建了一个赋有空数组的变量。然后，我遍历所有的页面，并为每个页面创建一个按钮。</p><p id="eb15" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这将创建浏览所有页面所需的所有按钮。在return语句中,“上一步”和“下一步”按钮是根据它们的值是否为null有条件地呈现的。现在，我们只需要将这个组件添加到我们的App组件中。我将在页面的底部和顶部显示分页。它看起来会像这样。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="7079" class="lo lp in lk b gy lq lr l ls lt">return (</span><span id="53d0" class="lo lp in lk b gy lu lr l ls lt">  &lt;div className="App"&gt;</span><span id="2d9c" class="lo lp in lk b gy lu lr l ls lt">    &lt;Pagination</span><span id="1a90" class="lo lp in lk b gy lu lr l ls lt">    nextPage={nextPageUrl ? nextPage : null}</span><span id="1f1e" class="lo lp in lk b gy lu lr l ls lt">    prevPage={prevPageUrl ? prevPage : null}</span><span id="c28d" class="lo lp in lk b gy lu lr l ls lt">    goToPage={goToPage}</span><span id="486c" class="lo lp in lk b gy lu lr l ls lt">    pages={pages}</span><span id="3167" class="lo lp in lk b gy lu lr l ls lt">  /&gt;</span><span id="2498" class="lo lp in lk b gy lu lr l ls lt">  &lt;div className="char-cards"&gt;</span><span id="31e2" class="lo lp in lk b gy lu lr l ls lt">    {charList}</span><span id="015d" class="lo lp in lk b gy lu lr l ls lt">  &lt;/div&gt;</span><span id="f242" class="lo lp in lk b gy lu lr l ls lt">  &lt;Pagination</span><span id="1af6" class="lo lp in lk b gy lu lr l ls lt">    nextPage={nextPageUrl ? nextPage : null}</span><span id="f5e5" class="lo lp in lk b gy lu lr l ls lt">    prevPage={prevPageUrl ? prevPage : null}</span><span id="338d" class="lo lp in lk b gy lu lr l ls lt">    goToPage={goToPage}</span><span id="8ef2" class="lo lp in lk b gy lu lr l ls lt">    pages={pages}</span><span id="3230" class="lo lp in lk b gy lu lr l ls lt">  /&gt;</span><span id="5763" class="lo lp in lk b gy lu lr l ls lt">&lt;/div&gt;</span><span id="752d" class="lo lp in lk b gy lu lr l ls lt">);</span></pre></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><p id="5319" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这就是我们使用这个API获得一些页面所需要的全部内容。如果您正在使用的API已经显示了可用的总页数，那么这是实现页面的一个非常简单的方法。这是最终的结果。</p><figure class="lf lg lh li gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lv"><img src="../Images/017c4ec49f1144ea455ae8c65f735f76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nvDF6vFinqASarJOUFdQcA.gif"/></div></div></figure><p id="3de7" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我在尝试这个过程中获得了很多乐趣。希望我的做法对一些人有帮助。编码快乐！</p><p id="6f1e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><em class="lw">更多内容尽在</em><a class="ae jz" href="http://plainenglish.io/" rel="noopener ugc nofollow" target="_blank"><em class="lw">plain English . io</em></a></p></div></div>    
</body>
</html>